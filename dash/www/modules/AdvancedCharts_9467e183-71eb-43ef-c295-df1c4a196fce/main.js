define(["backbone","Handlebars","jqueryui","QuickBase","moment","css!./css/chart-default.css","css!./css/chart-light-diff.css","css!./css/chart-dark-diff.css","css!./css/jquery-ui-1.10.4-supplement.css"],function(Backbone,Handlebars,jqueryui,QuickBase,moment){"use strict";var __extends=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a,ComponentDefinition=(m.getComponentDefinition=function(e){var t,i;if(0<_.keys(e.settingsModel.attributes).length)for(i=m.upgrades.indexOf(_.find(m.upgrades,{version:e.settingsModel.get("version")}))+1;i<m.upgrades.length;i+=1)(t=m.upgrades[i]).fn(e.settingsModel),e.settingsModel.set("version",t.version);return{id:4,componentName:"financial chart",componentDescription:"This element displays financial charts.",appKey:"AdvancedChartsApp",ghostViewThumb:null,buildViewThumb:null,appArgs:{json:{version:"4.6.2",Basics:{data:"",stockDisplayType:"CandleStick",decimalPlaces:4,viewFrom:"",viewTo:"",crosshair:"none",showInfoBorder:!1,showDisclaimer:!1,showVolume:!1,annotations:"",indicators:""},ViewState:{Focus:null},Toolbar:{showChartToolbar:!0,showDrawMenu:!0,showIndicators:!0},Style:{advanced:"",chartDisplayAreaHorizontalGridLinesColor:null,chartDisplayAreaVerticalGridLinesColor:null,crosshairColor:null,chartDisplayAreaBackground:null,chartDisplayAreaAlternativeBackground:null,chartBorderColor:null,axisTextMajor:null,axisTextMinor:null,selectedBackground:null,selectedForeground:null,chartDisplayAreaCandleStickUpFill:null,chartDisplayAreaCandleStickDownFill:null}},schema:{type:"object",title:"Properties",properties:{Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{data:{propertyOrder:1001,type:"data",title:"Data Source"},decimalPlaces:{propertyOrder:1004,type:"number",title:"Decimal Places"},viewFrom:{propertyOrder:1005,type:"string",title:"Display From",default:""},viewTo:{propertyOrder:1006,type:"string",title:"Display To",default:""},stockDisplayType:{propertyOrder:1007,type:"string",title:"Chart Type",enum:["LineOpen","LineHigh","LineLow","LineClose","CandleStick","OHLCBar","Kagi","HeikinAshi","Mountain"],options:{enum_titles:["Open","High","Low","Close","Candlestick","Bar","Kagi","Heikin Ashi","Mountain"]},default:"CandleStick"},crosshair:{propertyOrder:1009,type:"string",title:"Crosshair",enum:["none","price","freeflow"],options:{enum_titles:["None","Snap to Price","Free Flow"]},default:"none"},showInfoBorder:{propertyOrder:1010,type:"boolean",format:"checkbox",title:"Show Info Box",default:!1},showDisclaimer:{propertyOrder:1011,type:"boolean",format:"checkbox",title:"Show Disclaimer",default:!1},showVolume:{propertyOrder:1012,type:"boolean",format:"checkbox",title:"Show Volume",default:!1},annotations:{propertyOrder:1013,type:"string",format:"checkbox",title:"Annotations",default:""},indicators:{propertyOrder:1014,type:"string",format:"checkbox",title:"Indicators",default:""}}},ViewState:{type:"object",title:"View State",options:{collapsed:!0,hidden:!0},properties:{Focus:{type:"string",title:"Stock Symbol",default:""}}},Toolbar:{type:"object",title:"Toolbar",options:{collapsed:!0},properties:{showChartToolbar:{type:"boolean",format:"checkbox",title:"Show Toolbar",default:!0},showDrawMenu:{type:"boolean",format:"checkbox",title:"Show Draw Menu",default:!0},showIndicators:{type:"boolean",format:"checkbox",title:"Show Indicators Menu",default:!0}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""},chartDisplayAreaHorizontalGridLinesColor:{propertyOrder:1,type:"gradient",title:"Horizontal Grid Lines",default:null},chartDisplayAreaVerticalGridLinesColor:{propertyOrder:2,type:"gradient",title:"Vertical Grid Lines",default:null},crosshairColor:{propertyOrder:3,type:"gradient",title:"Crosshair",default:null},chartDisplayAreaBackground:{propertyOrder:4,type:"gradient",title:"Background",default:null},chartDisplayAreaAlternativeBackground:{propertyOrder:5,type:"gradient",title:"Alternative Background",default:null},chartBorderColor:{propertyOrder:6,type:"gradient",title:"Chart Border",default:null},axisTextMajor:{propertyOrder:7,type:"gradient",title:"Text Major",default:null},axisTextMinor:{propertyOrder:8,type:"gradient",title:"Text Minor",default:null},selectedBackground:{propertyOrder:9,type:"gradient",title:"Selected Background",default:null},selectedForeground:{propertyOrder:10,type:"gradient",title:"Selected Foreground",default:null},chartDisplayAreaCandleStickUpFill:{propertyOrder:11,type:"gradient",title:"Candlestick Up",default:null},chartDisplayAreaCandleStickDownFill:{propertyOrder:12,type:"gradient",title:"Candlestick Down",default:null}}}}}}}},m.upgrades=[{version:"4.0.0d2",fn:function(e){e.set("Style.advanced","")}},{version:"4.0.1t7",fn:function(e){e.set("Basics.data",""),e.set("Basics.bucketSize","OneMinute"),e.set("Basics.decimalPlaces",4),e.set("Basics.viewFrom",null),e.set("Basics.viewTo",null),delete e.attributes.ViewState,delete e.attributes.old_options,delete e.attributes.Basics.sym,e.set("Basics.showVolume",!1),delete e.attributes.Toolbar.isStockPickerEnabled}},{version:"4.6.0",fn:function(e){e.get("Basics.displayText")&&e.unset("Basics.displayText"),e.get("Basics.viewFrom")||e.set("Basics.viewFrom",""),e.get("Basics.viewTo")||e.set("Basics.viewTo",""),e.get("Basics.bucketSize")&&e.unset("Basics.bucketSize"),e.get("Basics.showViewMenu")&&e.unset("Basics.showViewMenu")}},{version:"4.6.1",fn:function(e){e.get("Basics.annotations")||e.set("Basics.annotations","")}},{version:"4.6.2",fn:function(e){e.get("Basics.indicators")||e.set("Basics.indicators","")}}],m);function m(){}var dateFormat=(w=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,x=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,y=/[^-+\dA-Z]/g,function(e,t,i){var a=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(e)||/\d/.test(e)||(t=e,e=void 0),e=e?new Date(e):new Date,isNaN(e))throw SyntaxError("invalid date");"UTC:"==(t=String(a.masks[t]||t||a.masks.default)).slice(0,4)&&(t=t.slice(4),i=!0);var n=i?e.getUTCDate():e.getDate(),o=i?e.getUTCDay():e.getDay(),r=i?e.getUTCMonth():e.getMonth(),s=i?e.getUTCFullYear():e.getFullYear(),l=i?e.getUTCHours():e.getHours(),d=i?e.getUTCMinutes():e.getMinutes(),c=i?e.getUTCSeconds():e.getSeconds(),h=i?e.getUTCMilliseconds():e.getMilliseconds(),p=i?0:e.getTimezoneOffset(),u={d:n,dd:z(n),ddd:a.i18n.dayNames[o],dddd:a.i18n.dayNames[o+7],m:r+1,mm:z(r+1),mmm:a.i18n.monthNames[r],mmmm:a.i18n.monthNames[r+12],yy:String(s).slice(2),yyyy:s,h:l%12||12,hh:z(l%12||12),H:l,HH:z(l),M:d,MM:z(d),s:c,ss:z(c),l:z(h,3),L:z(99<h?Math.round(h/10):h),t:l<12?"a":"p",tt:l<12?"am":"pm",T:l<12?"A":"P",TT:l<12?"AM":"PM",Z:i?"UTC":(String(e).match(x)||[""]).pop().replace(y,""),o:(0<p?"-":"+")+z(100*Math.floor(Math.abs(p)/60)+Math.abs(p)%60,4),S:["th","st","nd","rd"][3<n%10?0:(n%100-n%10!=10)*n%10]};return t.replace(w,function(e){return e in u?u[e]:e.slice(1,e.length-1)})}),w,x,y;function z(e,t){for(e=String(e),t=t||2;e.length<t;)e="0"+e;return e}dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,t){return dateFormat(this,e,t)};var StockDataProvider=(U.prototype.getDeltaGranularity=function(e){var t=null;switch(e){case"OneMinute":t="1min";break;case"TwoMinute":t="2min";break;case"ThreeMinute":t="3min";break;case"FiveMinute":t="5min";break;case"FifteenMinute":t="15min";break;case"ThirtyMinute":t="30min";break;case"SixtyMinute":t="1hour";break;case"FourHour":t="4hour";break;case"OneDay":t="daily";break;case"OneWeek":t="weekly";break;case"OneMonth":t="monthly"}return t},U.prototype.formatEodDataSource=function(e,i){return _.map(e.reset,function(e){var t=QuickBase.Tools.convertKDBTemporalToMoment(e.Time);return{Symbol:i,Date:new Date(t.year(),t.month(),t.day()-1,t.hours(),t.minutes(),t.seconds()),Open:e.Open,High:e.High,Low:e.Low,Close:e.Close,Volume:e.Volume}})},U.prototype.getStock=function(e,t,i,a){this.firstExtrdaDataDownloaded=!1,a&&(this.stockData={},this.stockData.keys=[]),this.historyLoaded=!1,this.noDataLimit=5,this.isOngoingCall?(this.callToIgnore=this.callCounter,this.ignoreCallback=!0):this.isOngoingCall=!0,this.callCounter+=1;for(var n=[],o=_.find(this.model.get("viewOptions"),{value:t}).timeframes,r=0;r<o.length&&(n.push(o[r].value),o[r].value!==i);r+=1);},U.prototype.getStockCallback=function(e,t,i,a,n,o,r,s){var l,d,c,h=this,p=this.formatEodDataSource(e,t.id);if(p&&0<p.length){e=[];for(e=this.refreshPeriods(this.model.get("granularity"),p),_.each(e,function(e){e.loaded=!0}),a=e[e.length-1].period,l={symbol:t.id,displaySymbol:t.symbol,eodData:p,decimals:t.decimalPlaces,granularity:i,periods:e},this.stockData[l.symbol]||this.stockData.keys.push(l.symbol),this.stockData[l.symbol]=l,d=0;d<l.periods.length&&l.periods[d].loaded;d+=1)this.lastLoadedPeriodIndex=d;for(i=0<(t=(t=_.find(l.periods,{period:a}))||_.last(l.periods)).firstIndex?l.eodData.slice(t.firstIndex):l.eodData.slice(),$(this).trigger("stockPartDownloaded",{type:"stockPartDownloaded",stock:{symbol:l.symbol,displaySymbol:l.displaySymbol,eodData:i},granularity:l.granularity,period:t.period,decimals:l.decimals,lastDate:t.lastDate,firstDate:t.firstDate,isLastDataPointOpen:!1}),$(this).trigger("perioddownloaded",{type:"perioddownloaded",period:a,symbol:l.symbol,displaySymbol:l.displaySymbol,eodData:i,reloadIndicators:!s}),c=e.length-1,this.firstExtrdaDataDownloaded||(this.firstExtrdaDataDownloaded=!0,$(this).trigger("firstextradatadownloaded",{type:"firstextradatadownloaded",dontMoveIntoPast:!0})),d=this.lastLoadedPeriodIndex;d<l.periods.length;d+=1)l.periods[d].loaded&&d!==c||$(this).trigger("perioddownloaded",{type:"perioddownloaded",period:l.periods[d].period,symbol:l.symbol,displaySymbol:this.stockData[l.symbol].displaySymbol,eodData:this.stockData[l.symbol].eodData.slice(l.periods[d].period.firstIndex),reloadIndicators:c<=d});this.historyLoaded=!0,_.each(e,function(e){$(h).trigger("periodenabled",{type:"periodenabled",period:e.period})}),this.onDataLoaded(),o&&o()}else this.onDataLoaded(),console.log("StockDataProvider no data returned"),o&&o("noData")},U.prototype.onDataLoaded=function(){var e=this.loadingQ.pop();e?(e(),this.onDataLoaded()):this.loadingData=!1},U.prototype.isPeriodLoaded=function(t){var e=!1,i=this.stockData.keys[0];return e=this.stockData[i]?0<(i=_.filter(this.stockData[i].periods,function(e){return e.period===t})).length&&i[0].loaded:e},U.prototype.refreshPeriods=function(e,t){var i,a=[],n=t.length-1;return _.each(this.fixPeriods(this.model.get("granularity"),t.length),function(e){i||(a.push({period:e.Name,firstDate:t[e.StartIndex].Date,firstIndex:e.StartIndex,lastDate:t[n].Date,lastIndex:n,loaded:!1}),n=0<e.StartIndex-1?e.StartIndex-1:0,e.StartIndex<=0&&(i=!0))}),a},U.prototype.fixPeriods=function(e,t){var i,a,e=_.find(this.model.get("viewOptions"),{value:e}),n=[],o=moment.duration(e.momentValue,e.momentKey).asMilliseconds();return _.each(e.timeframes,function(e){i=moment.duration(e.momentValue,e.momentKey).asMilliseconds(),a=parseInt((i/o).toString(),10),n.push({Name:e.value,StartIndex:t<a?0:t-a})}),n[n.length-1].StartIndex=0,n},U.prototype.getLoadedBaseIndex=function(){var e=0,t=_.filter(this.stockData[this.stockData.keys[0]].periods,function(e){return!e.loaded});return e=0<t.length?_.first(t).lastIndex:e},U.prototype.getPeriodInfo=function(e){var t=this.stockData.keys[0];return _.first(_.filter(this.stockData[t].periods,{period:e}))},U.prototype.getNextPeriod=function(){var e,t=this.lastLoadedPeriodIndex+1,i=this.stockData.keys[0];return t<this.stockData[i].periods.length&&(this.lastLoadedPeriodIndex=t,(e=this.stockData[i].periods[t]).loaded=!0,e=this.stockData[i].eodData.slice(e.firstIndex,e.lastIndex+1)),e},U.prototype.onDataSourceData=function(e,t){this.loadingData=!0,this.firstExtrdaDataDownloaded=!1,this.stockData={},this.stockData.keys=[];var i={id:"XXX",symbol:"XXX",decimalPlaces:this.model.get("originalDecimalPlaces")};this.model.set({stockPickerSymbol:i,stockSymbol:"XXX"},{silent:!0}),this.getStockCallback(e,i,"OneMinute","ThreeDays",!0,t,!1,!0),this.onDataLoaded()},U);function U(e){this.loadingQ=[],this.callCounter=1,this.previousPeriod=[],this.model=e.model}var Vector=(k0.prototype.add=function(e,t){return new k0(this.x+e,this.y+t)},k0.prototype.divide=function(e){this.x/=e,this.y/=e},k0.prototype.fromPoints=function(e,t,i,a){this.x=i-e,this.y=a-t},k0.prototype.findPerpendicular=function(e){var t=new k0(-this.y,this.x);return t.normalize(),e&&t.multiply(e),t},k0.prototype.intersection=function(e,t,i,a){var n=t.x-e.x,o=t.y-e.y,r=a.x-i.x,s=a.y-i.y,t=n*s-o*r;if(0==t)return null;a=e.x-i.x,i=e.y-i.y,s=(i*r-a*s)/t,t=(i*n-a*o)/t;return 0==s&&0==t||s<0||1<s||t<0||1<t?null:new k0(e.x+s*n,e.y+s*o)},k0.prototype.multiply=function(e){this.x*=e,this.y*=e},k0.prototype.negate=function(){return new k0(-this.x,-this.y)},k0.prototype.normalize=function(){var e=Math.max(Math.abs(this.x),Math.abs(this.y));this.divide(e),this.divide(this.magnitude(this.x,this.y))},k0.prototype.subsctract=function(e,t){return new k0(this.x-e,this.y-t)},k0);function k0(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=0,this.y=0,this.magnitude=function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},this.x=e,this.y=t}var Helpers=(N0.getGUID=function(){function e(){return Math.floor(65536*Math.random()).toString(16)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},N0.filteredMin=function(e,t,i){var a,n,o=_.find(e,function(e){return a=e.get(t),e=(e=e&&_.isNumber(a)&&!_.isNaN(a)&&_.isFinite(a))&&i&&a<=0?!1:e});if(o)return o=n=o.get(t),_.each(e,function(e){a=e.get(t),e=e&&_.isNumber(a)&&!_.isNaN(a)&&_.isFinite(a)?a:o,(e=i&&e<=0?o:e)<n&&(n=e)}),n},N0.filteredMax=function(e,t,i){var a,n,o=_.find(e,function(e){return a=e.get(t),e=(e=e&&_.isNumber(a)&&!_.isNaN(a)&&_.isFinite(a))&&i&&a<=0?!1:e});if(o)return o=n=o.get(t),_.each(e,function(e){a=e.get(t),e=e&&_.isNumber(a)&&!_.isNaN(a)&&_.isFinite(a)?a:o,n<(e=i&&e<=0?o:e)&&(n=e)}),n},N0.getDateTag=function(e,t){var i,a,n,o,r=e.getFullYear(),s=e.getMonth(),l=e.getDate(),d=e.getHours(),c=e.getMinutes(),h=e.getSeconds(),r=t?(i=t.getFullYear(),a=t.getMonth(),n=t.getDate(),o=t.getHours(),e=t.getMinutes(),t=t.getSeconds(),r!==i?r%10==0?"10year":r%5==0?"5year":"1year":s!==a?(s+1)%3==0?"3month":"1month":l!==n?l%15==0?"15day":"1day":d!==o?d%6==0?"6h":d%3==0?"3h":"1h":c!==e?c%15==0?"15min":c%5==0?"5min":"1min":h!==t?"1sec":"1tick"):r%10==0?"10year":r%5==0?"5year":"1year";return r},N0.hexToRgb=function(e){var t,i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return 0===e.indexOf("rgb")?(t=(t=(t=e.split("("))[1].split(")"))[0].split(","),t={r:parseInt(t[0],10),g:parseInt(t[1],10),b:parseInt(t[2],10)}):i?t={r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:(i=e.match(/\d+/g))&&(t=[null].concat(t)),t},N0.getNextDate=function(e,t){var i;switch(t){case"Tick":i=new Date(e.getTime()+1);break;case"OneMinute":i=new Date(e.getTime()+6e4);break;case"TwoMinute":i=new Date(e.getTime()+12e4);break;case"ThreeMinute":i=new Date(e.getTime()+18e4);break;case"FiveMinute":i=new Date(e.getTime()+3e5);break;case"FifteenMinute":i=new Date(e.getTime()+9e5);break;case"ThirtyMinute":i=new Date(e.getTime()+18e5);break;case"SixtyMinute":i=new Date(e.getTime()+36e5);break;case"FourHour":i=new Date(e.getTime()+144e5);break;case"OneDay":(i=new Date(e)).setDate(e.getDate()+1);break;case"OneWeek":(i=new Date(e)).setDate(e.getDate()+7);break;case"OneMonth":i=new Date(e),i=new Date(i.setMonth(e.getMonth()+1));break;default:throw"granulatiry not suported"}return i},N0);function N0(){}var T=(Db.AnnotationContextMenu=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div class="charting context-menu ui-widget ui-widget-content ui-corner-all">\r\n    <ul id="menu">\r\n        <li><a href="#">edit</a></li>\r\n        <li><a href="#">copy</a></li>\r\n        <li><a href="#">delete</a></li>\r\n    </ul>\r\n</div>'},useData:!0}),Db.AnnotationEditForm=Handlebars.template({1:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression,l="                        <label>"+l(typeof(d=null!=(d=i.title||(null!=t?t.title:t))?d:r)==s?d.call(o,{name:"title",hash:{},data:n}):d)+' <input type="checkbox" name="'+l(typeof(d=null!=(d=i.name||(null!=t?t.name:t))?d:r)==s?d.call(o,{name:"name",hash:{},data:n}):d)+'"',d=null!=(d=i.selected||(null!=t?t.selected:t))?d:r,n={name:"selected",hash:{},fn:e.program(2,n,0),inverse:e.noop,data:n},d=typeof d==s?d.call(o,n):d;return null!=(d=!i.selected?i.blockHelperMissing.call(t,d,n):d)&&(l+=d),l+"></label><br />\r\n"},2:function(e,t,i,a,n){return" checked"},compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression,d='<div style="white-space: nowrap;" class="annotationEditForm">\r\n    <div class="options">\r\n        <table style="width: 100%;">\r\n            <tr>\r\n                <td>\r\n                    Options:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <div class="options-checkboxes">\r\n',c=null!=(c=i.Options||(null!=t?t.Options:t))?c:r,h={name:"Options",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n},e=typeof c==s?c.call(o,h):c;return null!=(e=!i.Options?i.blockHelperMissing.call(t,e,h):e)&&(d+=e),d+'                    </div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n        \r\n    <div class="line">\r\n        <table style="width: 100%;">\r\n            <tr>\r\n                <td>\r\n                    Line Thickness:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input class="line-thickness" name="value" style="max-width: 75px; text-align: right;" />\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    Line Color:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input name="line-color"\r\n                           style="width: 0; display: none;"\r\n                           class="strokeColor colorPicker evo-cp0"\r\n                           data-property-name="line-color"\r\n                        />\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    Line Opacity:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td>\r\n                    <div class="line-opacity-slider" style="margin-top: 3px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    Line Type:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <select class="line-type">\r\n                        <option value="line">Line</option>\r\n                        <option value="dashes">Dashes</option>\r\n                        <option value="dots">Dots</option>\r\n                    </select>\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    Extend:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <div class="extend-line">\r\n                        <label><input type="checkbox" value="future"> '+l(typeof(c=null!=(c=i.ExtendFutureLabel||(null!=t?t.ExtendFutureLabel:t))?c:r)==s?c.call(o,{name:"ExtendFutureLabel",hash:{},data:n}):c)+'</label>\r\n                        <label><input type="checkbox" value="past"> '+l(typeof(c=null!=(c=i.ExtendPastLabel||(null!=t?t.ExtendPastLabel:t))?c:r)==s?c.call(o,{name:"ExtendPastLabel",hash:{},data:n}):c)+'</label>\r\n                    </div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n\r\n    <div class="text">\r\n        <table style="width: 100%;">\r\n            <tr>\r\n                <td>\r\n                    Text:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td>\r\n                    <textarea class="note-text" rows="4" cols="25" style="resize: none;" />\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    Text Size:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input class="text-size" name="value" style="max-width: 75px; text-align: right;" />\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    Text Margin:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input class="text-margin" name="value" style="max-width: 75px; text-align: right;" />\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    Text Color:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input name="text-color"\r\n                           style="width: 0; display: none;"\r\n                           class="strokeColor colorPicker evo-cp0"\r\n                           data-property-name="text-color"\r\n                        />\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n\r\n    <div class="shape">\r\n        <table style="width: 100%;">\r\n            <tr style="height: 25px;">\r\n                <td>\r\n                    Fill Color:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input name="fill-color"\r\n                           style="width: 0; display: none;"\r\n                           class="strokeColor colorPicker evo-cp0"\r\n                           data-property-name="fill-color"\r\n                        />\r\n                </td>\r\n            </tr>\r\n            <tr style="height: 25px;">\r\n                <td>\r\n                    Fill Opacity:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td>\r\n                    <div class="fill-opacity-slider" style="margin-top: 3px;"></div>\r\n                </td>\r\n            </tr>\r\n            <tr style="height: 25px;">\r\n                <td>\r\n                    Border Thickness:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input class="border-thickness" name="value" style="max-width: 75px; text-align: right;" />\r\n                </td>\r\n            </tr>\r\n            <tr style="height: 25px;">\r\n                <td>\r\n                    Border Color:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input name="border-color"\r\n                           style="width: 0; display: none;"\r\n                           class="strokeColor colorPicker evo-cp0"\r\n                           data-property-name="border-color"\r\n                        />\r\n                </td>\r\n            </tr>\r\n            <tr style="height: 25px;">\r\n                <td>\r\n                    Border Opacity:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td>\r\n                    <div class="border-opacity-slider" style="margin-top: 3px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n\r\n    <div class="advanced">\r\n        <table style="width: 100%;">\r\n            <tr>\r\n                <td>\r\n                    Line Thickness:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input class="line-thickness" name="value" style="max-width: 75px; text-align: right;" />\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    Line Color:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td style="float: right;">\r\n                    <input name="line-color"\r\n                           style="width: 0; display: none;"\r\n                           class="strokeColor colorPicker evo-cp0"\r\n                           data-property-name="line-color"\r\n                        />\r\n                </td>\r\n            </tr>\r\n            <tr>\r\n                <td>\r\n                    Line Opacity:\r\n                </td>\r\n                <td style="width: 7px;"></td>\r\n                <td>\r\n                    <div class="line-opacity-slider" style="margin-top: 3px;"></div>\r\n                </td>\r\n            </tr>\r\n        </table>\r\n    </div>\r\n    \r\n    <div style="margin-top: 13px;">\r\n        <input type="button" name="remove" value="remove" style="float: left;" />\r\n        <input type="button" name="ok" value="OK" style="float: right;"/>\r\n    </div>\r\n    <div style="clear: both;"></div>\r\n</div>'},useData:!0}),Db.Chart=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'\r\n<div class="MainChartAreaDiv" style="position: absolute;"></div>\r\n<div class="IndicatorsChartAreaDiv" style="position: absolute;"></div>\r\n<div class="VolumeChartAreaDiv" style="position: absolute;"></div>\r\n\r\n<div class="InfoAreaDiv" style="position: absolute; padding-top: 2px;">\r\n    <span class="info-value" id="dateInfo" style="margin-right: 13px;"></span>\r\n    <span class="info-label" style="margin-right: 7px;">O:</span><span id="openInfo" class="info-value"></span>\r\n    <span class="info-label" style="margin-left: 7px; margin-right: 7px;">H:</span><span id="highInfo" class="info-value"></span>\r\n    <span class="info-label" style="margin-left: 7px; margin-right: 7px;">L:</span><span id="lowInfo" class="info-value"></span>\r\n    <span class="info-label" style="margin-left: 7px; margin-right: 7px;">C:</span><span id="closeInfo" class="info-value"></span>\r\n</div>\r\n\r\n<div class="RangeSelectorDiv" style="position: absolute; z-index: 100;"></div>\r\n\r\n<div class="IndicatorsToolbarDiv" style="position: absolute;"></div>\r\n\r\n<div class="InfoBorderDiv" style="position: absolute; left: 42px; top: 27px; width: 0; height: 0; z-index: 1001;"></div>\r\n\r\n<div class="resize-indicator-interaction" style="display: none; position: absolute; background-color: transparent; z-index: 1000;"></div>\r\n\r\n'},useData:!0}),Db.ChartArea=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div class="Background" style="position: absolute;"></div>\r\n\r\n<canvas class="VerticalGrid" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\r\n<canvas class="HorizontalGrid" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\r\n\r\n<div class="DisplayText"></div>\r\n\r\n<div class="DisplayAreaDiv" style="position: absolute;"></div>\r\n<canvas class="CrosshairCanvas" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\r\n<div class="LeftAxisDiv" style="position: absolute;"></div>\r\n<div class="RightAxisDiv" style="position: absolute; overflow: visible;"></div>\r\n<div class="BottomAxisDiv" style="position: absolute; z-index: 1000;"></div>\r\n<canvas class="DrawingCanvas" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\r\n<canvas class="ZoomingCanvas" style="position: absolute; left: 0; top: 0; width: 0; height: 0;" />\r\n\r\n<div class="InteractionLayer" style="position: absolute; background-color: transparent;">\r\n</div>\r\n\r\n<div class="SeriesBarDiv" style="position: absolute;"></div>'},useData:!0}),Db.ChartToolbar=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div style="position: relative;">\r\n    \r\n    <div class="ui-widget-header buttons-div">\r\n        <div class="toolbar-left" style="display: inline-block;">\r\n            <div class="stock-picker-div" style="width: 175px; display: inline-block; margin-right: 7px; float: left; margin-top: 3px;" data-overflow-index="2">\r\n\r\n            </div>\r\n\t\t\t\r\n            <button class="zoom toolbar-btn" type="button" data-overflow-index="4">Click to focus/zoom in on any area</button>\r\n\r\n            <button class="save toolbar-btn" type="button" data-overflow-index="1">Save chart image</button>\r\n\r\n            <button class="draw toolbar-btn" type="button" data-overflow-index="7">Draw</button>\r\n\r\n            <button class="indicators toolbar-btn" type="button" data-overflow-index="6">Indicators</button>\r\n\r\n            <button class="options toolbar-btn" type="button" data-overflow-index="3">Options</button>\r\n            \r\n            <button class="overflow-btn toolbar-btn" type="button">More</button>\r\n        </div>\r\n\r\n    </div>\r\n\r\n    <div class="indicators-menu chart-menu ui-widget-content ui-corner-all">\r\n        <div class="chart-menu-section">\r\n            <div class="scroll-pane">\r\n                <ul class="chartTypeMenu">\r\n                </ul>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \r\n    <div class="options-menu chart-menu ui-widget-content ui-corner-all">\r\n        <div class="chart-menu-section">\r\n            <div class="chart-menu-column-header chart-menu-column-header-with-padding">Chart Type</div>\r\n            <ul class="chartTypeMenu">\r\n                <li><a href="#LineOpen">Open</a></li>\r\n                <li><a href="#LineHigh">High</a></li>\r\n                <li><a href="#LineLow">Low</a></li>\r\n                <li><a href="#LineClose">Close</a></li>\r\n                <li><a href="#CandleStick">Candlestick</a></li>\r\n                <li><a href="#OHLCBar">Bar</a></li>\r\n                <li class="notMobile"><a href="#Kagi">Kagi</a></li>\r\n                <li class="notMobile"><a href="#HeikinAshi">Heikin Ashi</a></li>\r\n                <li><a href="#Mountain">Mountain</a></li>\r\n            </ul>\r\n        </div>\r\n\r\n        <div class="chart-menu-section">\r\n            <div class="chart-menu-column-header">More</div>\r\n            \r\n            <div class="notMobile">\r\n                <span class="chart-menu-text chart-menu-section-header">Crosshair</span>\r\n\r\n                <div class="crosshair-types">\r\n                    <a href="#none">None</a>\r\n                    <a href="#price">Price</a>\r\n                    <a href="#cursor">Cursor</a>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="notMobile">\r\n                <span class="chart-menu-text chart-menu-section-header">Price Info</span>\r\n\r\n                <div class="border-types">\r\n                    <a href="#off">Off</a>\r\n                    <a href="#on">On</a>\r\n                    <a href="#cursor">On Pause</a>\r\n                </div>\r\n            </div>\r\n\r\n            \x3c!-- <a class="settings-link notCompact" href="#settings">Settings</a> --\x3e\r\n            \r\n            <div class="themes">\r\n                <span class="chart-menu-text chart-menu-section-header">Themes</span>\r\n                <div class="themes-list">\r\n                </div>\r\n            </div>\r\n\r\n        </div>\r\n    </div>\r\n    \r\n    <div class="draw-menu chart-menu ui-widget-content ui-corner-all">\r\n        \r\n        <div class="chart-menu-section">\r\n            <div class="chart-menu-column-header chart-menu-column-header-with-padding">Basic</div>\r\n            <ul class="annotations">\r\n                <li><a href="#trend-line">Trend Line</a></li>\r\n                <li><a href="#horizontal-line">Horizontal Line</a></li>\r\n                <li><a href="#vertical-line">Vertical Line</a></li>\r\n                <li><a href="#level">Target Line</a></li>\r\n            </ul>\r\n        </div>\r\n\r\n        <div class="chart-menu-section">\r\n            <div class="chart-menu-column-header chart-menu-column-header-with-padding">Shapes and Text</div>\r\n            <ul class="annotations">\r\n                <li><a href="#ellipse">Ellipse</a></li>\r\n                <li><a href="#rectangle">Rectangle</a></li>\r\n                <li><a href="#rotation-rectangle">Rotation Rectangle</a></li>\r\n                <li><a href="#text-note">Text Note</a></li>\r\n            </ul>\r\n        </div>\r\n\r\n        <div class="chart-menu-section">\r\n            <div class="chart-menu-column-header chart-menu-column-header-with-padding">Advanced</div>\r\n            <ul class="annotations">\r\n                <li><a href="#fibonacci-retracements">Fibonacci Retracements</a></li>\r\n                <li><a href="#fibonacci-time-zones">Fibonacci Time Zones</a></li>\r\n                <li><a href="#fibonacci-fan">Fibonacci Fan</a></li>\r\n                <li><a href="#fibonacci-arcs">Fibonacci Arcs</a></li>\r\n                <li><a href="#dinapoli">DiNapoli Levels</a></li>\r\n                <li><a href="#gann-box">Gann Box</a></li>\r\n                <li><a href="#gann-fan">Gann Fan</a></li>\r\n                <li><a href="#andrews-pitchfork">Andrews Pitchfork</a></li>\r\n            </ul>\r\n        </div>\r\n\r\n        <div class="chart-menu-section">\r\n            <div class="chart-menu-column-header">Shape properties</div>\r\n            <div>\r\n                <table style="width: 220px;">\r\n                    <tr style="height: 30px;">\r\n                        <td class="chart-menu-text">Stroke Thickness</td>\r\n                        <td>\r\n                            <div class="line-thickness" style="width: 100px;">\r\n                                <a href="#" class="lt1">x1</a>\r\n                                <a href="#" class="lt2">x2</a>\r\n                                <a href="#" class="lt3">x3</a>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr style="height: 30px;">\r\n                        <td class="chart-menu-text">Stroke Color</td>\r\n                        <td style="vertical-align: middle; padding-left: 25px;">\r\n                            <input style="width: 0; display: none;" class="strokeColor colorPicker evo-cp0" />\r\n                        </td>\r\n                    </tr>\r\n                    <tr style="height: 30px;">\r\n                        <td class="chart-menu-text">Fill Color</td>\r\n                        <td style="vertical-align: middle; padding-left: 25px;">\r\n                            <input style="width: 0; display: none;" class="fillColor colorPicker evo-cp0" />\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </div>\r\n        </div>\r\n        \r\n        <div class="buttons-panel">\r\n            <button class="undo-button" type="button" >Undo</button>\r\n            <button class="redo-button" type="button" >Redo</button>\r\n            <button class="clear-button" type="button" >Remove All</button>    \r\n        </div>\r\n        \r\n    </div>\r\n    \r\n    <div class="overflow-menu chart-menu ui-widget-content ui-corner-all"></div>\r\n    \r\n</div>'},useData:!0}),Db.DisplayArea=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<canvas class="MainCanvas" style="position: absolute; left: 0; top: 0;" />\r\n<canvas class="LiveElementsCanvas" style="position: absolute; top: 0;" />\r\n<canvas class="AnnotationsCanvas" style="position: absolute; left: 0; top: 0;" />\r\n'},useData:!0}),Db.HorizontalAxis=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'\r\n<div class="TextsDiv" style="position: absolute; top: 0; left: 0; overflow: hidden;"></div>\r\n<div class="borderDiv" style="height: 100%; width: 1px; border-left: 1px solid #9eafb6; border-right: 1px solid #9eafb6; background-color: #010b12;"></div>\r\n<canvas class="MainCanvas" style="position: absolute; top: 0; left: 0;" />'},useData:!0}),Db.IndicatorForm=Handlebars.template({1:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression,d=i.blockHelperMissing,c="        <tr>\r\n            <td>\r\n                "+l(typeof(h=null!=(h=i.Name||(null!=t?t.Name:t))?h:r)==s?h.call(o,{name:"Name",hash:{},data:n}):h)+'\r\n            </td>\r\n            <td style="vertical-align: middle;">\r\n                <input name="number"\r\n                        value="'+l(typeof(h=null!=(h=i.Value||(null!=t?t.Value:t))?h:r)==s?h.call(o,{name:"Value",hash:{},data:n}):h)+'"\r\n                        data-parameter-order-index="'+l(typeof(h=null!=(h=i.OrderIndex||(null!=t?t.OrderIndex:t))?h:r)==s?h.call(o,{name:"OrderIndex",hash:{},data:n}):h)+'"\r\n                        ',h=null!=(h=i.MinSet||(null!=t?t.MinSet:t))?h:r,p={name:"MinSet",hash:{},fn:e.program(2,n,0),inverse:e.noop,data:n},l=typeof h==s?h.call(o,p):h;return null!=(l=!i.MinSet?d.call(t,l,p):l)&&(c+=l),c+="\r\n                        ",h=null!=(h=i.StepSet||(null!=t?t.StepSet:t))?h:r,p={name:"StepSet",hash:{},fn:e.program(4,n,0),inverse:e.noop,data:n},l=typeof h==s?h.call(o,p):h,null!=(l=!i.StepSet?d.call(t,l,p):l)&&(c+=l),c+" />\r\n            </td>\r\n        </tr>\r\n"},2:function(e,t,i,a,n){var o;return' data-min="'+e.escapeExpression("function"==typeof(o=null!=(o=i.Min||(null!=t?t.Min:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"Min",hash:{},data:n}):o)+'"'},4:function(e,t,i,a,n){var o;return' data-step="'+e.escapeExpression("function"==typeof(o=null!=(o=i.Step||(null!=t?t.Step:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"Step",hash:{},data:n}):o)+'"'},6:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression,l="        <tr>\r\n            <td>\r\n                "+l(typeof(d=null!=(d=i.Name||(null!=t?t.Name:t))?d:r)==s?d.call(o,{name:"Name",hash:{},data:n}):d)+'\r\n            </td>\r\n            <td>\r\n                <select class="ui-widget" data-parameter-order-index="'+l(typeof(d=null!=(d=i.OrderIndex||(null!=t?t.OrderIndex:t))?d:r)==s?d.call(o,{name:"OrderIndex",hash:{},data:n}):d)+'">\r\n',d=null!=(d=i.Options||(null!=t?t.Options:t))?d:r,n={name:"Options",hash:{},fn:e.program(7,n,0),inverse:e.noop,data:n},d=typeof d==s?d.call(o,n):d;return null!=(d=!i.Options?i.blockHelperMissing.call(t,d,n):d)&&(l+=d),l+"                </select>\r\n            </td>\r\n        </tr>\r\n"},7:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression,d='                    <option value="'+l(typeof(c=null!=(c=i.Value||(null!=t?t.Value:t))?c:r)==s?c.call(o,{name:"Value",hash:{},data:n}):c)+'"',c=null!=(c=i.Selected||(null!=t?t.Selected:t))?c:r,h={name:"Selected",hash:{},fn:e.program(8,n,0),inverse:e.noop,data:n},e=typeof c==s?c.call(o,h):c;return null!=(e=!i.Selected?i.blockHelperMissing.call(t,e,h):e)&&(d+=e),d+">"+l(typeof(c=null!=(c=i.Name||(null!=t?t.Name:t))?c:r)==s?c.call(o,{name:"Name",hash:{},data:n}):c)+"</option>\r\n"},8:function(e,t,i,a,n){return" selected"},10:function(e,t,i,a,n,o,r){var s="",l=null!=(l=i.nonConfigurable||(null!=t?t.nonConfigurable:t))?l:i.helperMissing,n={name:"nonConfigurable",hash:{},fn:e.noop,inverse:e.program(11,n,0,o,r),data:n},l="function"==typeof l?l.call(null!=t?t:e.nullContext||{},n):l;return null!=(l=!i.nonConfigurable?i.blockHelperMissing.call(t,l,n):l)&&(s+=l),s},11:function(e,t,i,a,n,o,r){var s=null!=t?t:e.nullContext||{},l=i.helperMissing,d="function",c=i.blockHelperMissing,h="        <tr>\r\n            <td>\r\n                "+e.escapeExpression(typeof(p=null!=(p=i.discreteName||(null!=t?t.discreteName:t))?p:l)==d?p.call(s,{name:"discreteName",hash:{},data:n}):p)+'\r\n            </td>\r\n            <td style="text-align: right; float: right;">\r\n                \r\n',p=null!=(p=i.color||(null!=t?t.color:t))?p:l,u={name:"color",hash:{},fn:e.program(12,n,0,o,r),inverse:e.noop,data:n},m=typeof p==d?p.call(s,u):p;return null!=(m=!i.color?c.call(t,m,u):m)&&(h+=m),h+="\r\n                    \r\n",p=null!=(p=i.profitColor||(null!=t?t.profitColor:t))?p:l,u={name:"profitColor",hash:{},fn:e.program(14,n,0,o,r),inverse:e.noop,data:n},m=typeof p==d?p.call(s,u):p,null!=(m=!i.profitColor?c.call(t,m,u):m)&&(h+=m),h+="\r\n",p=null!=(p=i.lossColor||(null!=t?t.lossColor:t))?p:l,u={name:"lossColor",hash:{},fn:e.program(16,n,0,o,r),inverse:e.noop,data:n},m=typeof p==d?p.call(s,u):p,null!=(m=!i.lossColor?c.call(t,m,u):m)&&(h+=m),h+="                \r\n            </td>\r\n        </tr>\r\n        \r\n",p=null!=(p=i.lineThickness||(null!=t?t.lineThickness:t))?p:l,u={name:"lineThickness",hash:{},fn:e.program(18,n,0,o,r),inverse:e.noop,data:n},m=typeof p==d?p.call(s,u):p,null!=(m=!i.lineThickness?c.call(t,m,u):m)&&(h+=m),h+"\r\n"},12:function(e,t,i,a,n,o,r){return'                \x3c!--<div style="margin: 3px;">--\x3e\r\n                    <input name="color"\r\n                            style="width: 0; display: none;"\r\n                            class="strokeColor colorPicker evo-cp0"\r\n                            data-indicator-discrete-id="'+e.escapeExpression(e.lambda(null!=r[1]?r[1].discreteIndicatorID:r[1],t))+'"\r\n                            data-color-type="lineColor"\r\n                        />\r\n                    \x3c!--</div>--\x3e\r\n\r\n'},14:function(e,t,i,a,n,o,r){return'                \x3c!--<div style="margin: 3px;">--\x3e\r\n                <input name="color"\r\n                        style="width: 0; display: none;"\r\n                        class="strokeColor colorPicker evo-cp0"\r\n                        data-indicator-discrete-id="'+e.escapeExpression(e.lambda(null!=r[1]?r[1].discreteIndicatorID:r[1],t))+'"\r\n                        data-color-type="profitColor"\r\n                    />\r\n                    \x3c!--</div>--\x3e\r\n'},16:function(e,t,i,a,n,o,r){return'                \x3c!--<div style="margin: 3px;">--\x3e\r\n                <input name="color"\r\n                        style="width: 0; display: none;"\r\n                        class="strokeColor colorPicker evo-cp0"\r\n                        data-indicator-discrete-id="'+e.escapeExpression(e.lambda(null!=r[1]?r[1].discreteIndicatorID:r[1],t))+'"\r\n                        data-color-type="lossColor"\r\n                    />\r\n                    \x3c!--</div>--\x3e\r\n'},18:function(e,t,i,a,n,o,r){var s=e.lambda,e=e.escapeExpression;return'        <tr>\r\n            <td>\r\n                Thickness:\r\n            </td>\r\n            <td style="text-align: right; vertical-align: middle;">\r\n                <input name="thickness" value="'+e(s(null!=r[1]?r[1].lineThickness:r[1],t))+'"\r\n                        data-indicator-discrete-id="'+e(s(null!=r[1]?r[1].discreteIndicatorID:r[1],t))+'"/>\r\n            </td>\r\n        </tr>\r\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n,o,r){var s=e.lambda,l=i.blockHelperMissing,d='<div class="charting IndicatorForm" style="width: auto;">\r\n    <table>\r\n'+(null!=(c=l.call(t,s(null!=(c=null!=t?t.parameters:t)?c.number:c,t),{name:"parameters.number",hash:{},fn:e.program(1,n,0,o,r),inverse:e.noop,data:n}))?c:"")+(null!=(c=l.call(t,s(null!=(c=null!=t?t.parameters:t)?c.list:c,t),{name:"parameters.list",hash:{},fn:e.program(6,n,0,o,r),inverse:e.noop,data:n}))?c:""),s=null!=(s=i.discreteIndicators||(null!=t?t.discreteIndicators:t))?s:i.helperMissing,n={name:"discreteIndicators",hash:{},fn:e.program(10,n,0,o,r),inverse:e.noop,data:n},c="function"==typeof s?s.call(null!=t?t:e.nullContext||{},n):s;return null!=(c=!i.discreteIndicators?l.call(t,c,n):c)&&(d+=c),d+"    </table>\r\n</div>"},useData:!0,useDepths:!0}),Db.IndicatorsToolbar=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<ul class="IndicatorsToolbar" style="position: relative; margin: 0; padding: 0; border: none; list-style-type: none; width: 100%;">\r\n\r\n</ul>'},useData:!0}),Db.InfoBorder=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div class="RootDiv InfoBorder">\r\n    \r\n    <table>\r\n        <tr>\r\n            <td>Open:</td>\r\n            <td style="width: 7px;"></td>\r\n            <td style="text-align: right;"><div class="OpenPrice"></div></td>\r\n        </tr>\r\n        <tr>\r\n            <td>High:</td>\r\n            <td style="width: 7px;"></td>\r\n            <td style="text-align: right;"><div class="HighPrice"></div></td>\r\n        </tr>\r\n        <tr>\r\n            <td>Low:</td>\r\n            <td style="width: 7px;"></td>\r\n            <td style="text-align: right;"><div class="LowPrice"></div></td>\r\n        </tr>\r\n        <tr>\r\n            <td>Last:</td>\r\n            <td style="width: 7px;"></td>\r\n            <td style="text-align: right;"><div class="LastPrice"></div></td>\r\n        </tr>\r\n    </table>\r\n    \r\n    <div style="width: 100%;" class="IndicatorsDiv">\r\n        \r\n    </div>\r\n\r\n    <table>\r\n        <tr>\r\n            <td>Date (Bar Start):</td>\r\n            <td style="width: 7px;"></td>\r\n            <td style="text-align: right;"><div class="DateValue"></div></td>\r\n        </tr>\r\n    </table>\r\n\r\n</div>'},useData:!0}),Db.LevelDialog=Handlebars.template({1:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression;return'    <div class="levels-group">\r\n        <span class="gray-label">entry / point of control </span>\r\n        <span class="white-label">\r\n            '+l(typeof(e=null!=(e=i.currentEntry||(null!=t?t.currentEntry:t))?e:r)==s?e.call(o,{name:"currentEntry",hash:{},data:n}):e)+'\r\n        </span>\r\n        <a class="remove-list-entry" data-levelid="'+l(typeof(e=null!=(e=i.currentEntryid||(null!=t?t.currentEntryid:t))?e:r)==s?e.call(o,{name:"currentEntryid",hash:{},data:n}):e)+'" data-type="entry">\r\n            <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\r\n        </a>\r\n    </div>\r\n'},3:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression,d=i.blockHelperMissing,c='    <div class="levels-group">\r\n        <div style="position: relative;">\r\n            <span class="gray-label">take profit / resistance </span>\r\n            <span class="white-label">\r\n                '+l(typeof(h=null!=(h=i.profit0||(null!=t?t.profit0:t))?h:r)==s?h.call(o,{name:"profit0",hash:{},data:n}):h)+'\r\n            </span>\r\n            <a class="remove-list-entry" data-levelid="'+l(typeof(h=null!=(h=i.profit0id||(null!=t?t.profit0id:t))?h:r)==s?h.call(o,{name:"profit0id",hash:{},data:n}):h)+'" data-type="profit">\r\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\r\n            </a>\r\n        </div>\r\n',h=null!=(h=i.profit1||(null!=t?t.profit1:t))?h:r,p={name:"profit1",hash:{},fn:e.program(4,n,0),inverse:e.noop,data:n},l=typeof h==s?h.call(o,p):h;return null!=(l=!i.profit1?d.call(t,l,p):l)&&(c+=l),h=null!=(h=i.profit2||(null!=t?t.profit2:t))?h:r,p={name:"profit2",hash:{},fn:e.program(6,n,0),inverse:e.noop,data:n},l=typeof h==s?h.call(o,p):h,null!=(l=!i.profit2?d.call(t,l,p):l)&&(c+=l),h=null!=(h=i.profit3||(null!=t?t.profit3:t))?h:r,p={name:"profit3",hash:{},fn:e.program(8,n,0),inverse:e.noop,data:n},l=typeof h==s?h.call(o,p):h,null!=(l=!i.profit3?d.call(t,l,p):l)&&(c+=l),c+"    </div>\r\n"},4:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression;return'        <div style="position: relative; margin: 2px 0;">\r\n            <span class="gray-label">take profit / resistance </span>\r\n            <span class="white-label">\r\n                '+l(typeof(e=null!=(e=i.profit1||(null!=t?t.profit1:t))?e:r)==s?e.call(o,{name:"profit1",hash:{},data:n}):e)+'\r\n            </span>\r\n            <a class="remove-list-entry" data-levelid="'+l(typeof(e=null!=(e=i.profit1id||(null!=t?t.profit1id:t))?e:r)==s?e.call(o,{name:"profit1id",hash:{},data:n}):e)+'" data-type="profit">\r\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\r\n            </a>\r\n        </div>\r\n'},6:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression;return'        <div style="position: relative; margin: 2px 0;">\r\n            <span class="gray-label">take profit / resistance </span>\r\n            <span class="white-label">\r\n                '+l(typeof(e=null!=(e=i.profit2||(null!=t?t.profit2:t))?e:r)==s?e.call(o,{name:"profit2",hash:{},data:n}):e)+'\r\n            </span>\r\n            <a class="remove-list-entry" data-levelid="'+l(typeof(e=null!=(e=i.profit2id||(null!=t?t.profit2id:t))?e:r)==s?e.call(o,{name:"profit2id",hash:{},data:n}):e)+'" data-type="profit">\r\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\r\n            </a>\r\n        </div>\r\n'},8:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression;return'        <div style="position: relative; margin: 2px 0;">\r\n            <span class="gray-label">take profit / resistance </span>\r\n            <span class="white-label">\r\n                '+l(typeof(e=null!=(e=i.profit3||(null!=t?t.profit3:t))?e:r)==s?e.call(o,{name:"profit3",hash:{},data:n}):e)+'\r\n            </span>\r\n            <a class="remove-list-entry" data-levelid="'+l(typeof(e=null!=(e=i.profit3id||(null!=t?t.profit3id:t))?e:r)==s?e.call(o,{name:"profit3id",hash:{},data:n}):e)+'" data-type="profit">\r\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\r\n            </a>\r\n        </div>\r\n'},10:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression,d=i.blockHelperMissing,c='    <div class="levels-group">\r\n        <div style="position: relative;">\r\n            <span class="gray-label">stop loss / support </span>\r\n            <span class="white-label">\r\n                '+l(typeof(h=null!=(h=i.stop0||(null!=t?t.stop0:t))?h:r)==s?h.call(o,{name:"stop0",hash:{},data:n}):h)+'\r\n            </span>\r\n            <a class="remove-list-entry" data-levelid="'+l(typeof(h=null!=(h=i.stop0id||(null!=t?t.stop0id:t))?h:r)==s?h.call(o,{name:"stop0id",hash:{},data:n}):h)+'" data-type="stop">\r\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\r\n            </a>\r\n        </div>\r\n',h=null!=(h=i.stop1||(null!=t?t.stop1:t))?h:r,p={name:"stop1",hash:{},fn:e.program(11,n,0),inverse:e.noop,data:n},l=typeof h==s?h.call(o,p):h;return null!=(l=!i.stop1?d.call(t,l,p):l)&&(c+=l),h=null!=(h=i.stop2||(null!=t?t.stop2:t))?h:r,p={name:"stop2",hash:{},fn:e.program(13,n,0),inverse:e.noop,data:n},l=typeof h==s?h.call(o,p):h,null!=(l=!i.stop2?d.call(t,l,p):l)&&(c+=l),h=null!=(h=i.stop3||(null!=t?t.stop3:t))?h:r,p={name:"stop3",hash:{},fn:e.program(15,n,0),inverse:e.noop,data:n},l=typeof h==s?h.call(o,p):h,null!=(l=!i.stop3?d.call(t,l,p):l)&&(c+=l),c+"    </div>\r\n"},11:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression;return'        <div style="position: relative; margin: 2px 0;">\r\n            <span class="gray-label">stop loss / support </span>\r\n            <span class="white-label">\r\n                '+l(typeof(e=null!=(e=i.stop1||(null!=t?t.stop1:t))?e:r)==s?e.call(o,{name:"stop1",hash:{},data:n}):e)+'\r\n            </span>\r\n            <a class="remove-list-entry" data-levelid="'+l(typeof(e=null!=(e=i.stop1id||(null!=t?t.stop1id:t))?e:r)==s?e.call(o,{name:"stop1id",hash:{},data:n}):e)+'" data-type="stop">\r\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\r\n            </a>\r\n        </div>\r\n'},13:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression;return'        <div style="position: relative; margin: 2px 0;">\r\n            <span class="gray-label">stop loss / support </span>\r\n            <span class="white-label">\r\n                '+l(typeof(e=null!=(e=i.stop2||(null!=t?t.stop2:t))?e:r)==s?e.call(o,{name:"stop2",hash:{},data:n}):e)+'\r\n            </span>\r\n            <a class="remove-list-entry" data-levelid="'+l(typeof(e=null!=(e=i.stop2id||(null!=t?t.stop2id:t))?e:r)==s?e.call(o,{name:"stop2id",hash:{},data:n}):e)+'" data-type="stop">\r\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\r\n            </a>\r\n        </div>\r\n'},15:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression;return'        <div style="position: relative; margin: 2px 0;">\r\n            <span class="gray-label">stop loss / support </span>\r\n            <span class="white-label">\r\n                '+l(typeof(e=null!=(e=i.stop3||(null!=t?t.stop3:t))?e:r)==s?e.call(o,{name:"stop3",hash:{},data:n}):e)+'\r\n            </span>\r\n            <a class="remove-list-entry" data-levelid="'+l(typeof(e=null!=(e=i.stop3id||(null!=t?t.stop3id:t))?e:r)==s?e.call(o,{name:"stop3id",hash:{},data:n}):e)+'" data-type="stop">\r\n                <span class="ui-button-icon-primary ui-icon ui-icon-closethick"></span>\r\n            </a>\r\n        </div>\r\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=i.blockHelperMissing,d=e.escapeExpression,c='<div class="charting IndicatorForm level-dialog">\r\n\r\n    <table style="margin: 7px auto;">\r\n        <tr>\r\n            <td style="padding-right: 7px; font-size: 14px; vertical-align: middle; text-align: center; width: 50%;">\r\n                Target:\r\n            </td>\r\n            <td>\r\n                <input class="level-input" style="max-width: 80px; text-align: right;">\r\n            </td>\r\n        </tr>\r\n    </table>\r\n\r\n',h=null!=(h=i.currentEntry||(null!=t?t.currentEntry:t))?h:r,p={name:"currentEntry",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n},u=typeof h==s?h.call(o,p):h;return null!=(u=!i.currentEntry?l.call(t,u,p):u)&&(c+=u),c+="\r\n",h=null!=(h=i.profit0||(null!=t?t.profit0:t))?h:r,p={name:"profit0",hash:{},fn:e.program(3,n,0),inverse:e.noop,data:n},u=typeof h==s?h.call(o,p):h,null!=(u=!i.profit0?l.call(t,u,p):u)&&(c+=u),c+="\r\n",h=null!=(h=i.stop0||(null!=t?t.stop0:t))?h:r,p={name:"stop0",hash:{},fn:e.program(10,n,0),inverse:e.noop,data:n},u=typeof h==s?h.call(o,p):h,null!=(u=!i.stop0?l.call(t,u,p):u)&&(c+=u),c+'\r\n\r\n    <div class="level-radios">\r\n\r\n        <input type="radio" id="'+d(typeof(h=null!=(h=i.r1||(null!=t?t.r1:t))?h:r)==s?h.call(o,{name:"r1",hash:{},data:n}):h)+'" name="level" value="entry" />\r\n        <label for="'+d(typeof(h=null!=(h=i.r1||(null!=t?t.r1:t))?h:r)==s?h.call(o,{name:"r1",hash:{},data:n}):h)+'" style="margin: 7px;">entry / point of control</label>\r\n\r\n        <input type="radio" id="'+d(typeof(h=null!=(h=i.r2||(null!=t?t.r2:t))?h:r)==s?h.call(o,{name:"r2",hash:{},data:n}):h)+'" name="level" value="profit" />\r\n        <label for="'+d(typeof(h=null!=(h=i.r2||(null!=t?t.r2:t))?h:r)==s?h.call(o,{name:"r2",hash:{},data:n}):h)+'" style="margin: 7px;">take profit / resistance</label>\r\n\r\n        <input type="radio" id="'+d(typeof(h=null!=(h=i.r3||(null!=t?t.r3:t))?h:r)==s?h.call(o,{name:"r3",hash:{},data:n}):h)+'" name="level" value="stop" />\r\n        <label for="'+d(typeof(h=null!=(h=i.r3||(null!=t?t.r3:t))?h:r)==s?h.call(o,{name:"r3",hash:{},data:n}):h)+'" style="margin: 7px;">stop loss / support</label>\r\n\r\n    </div>\r\n\r\n</div>\r\n'},useData:!0}),Db.SaveDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div style="width: 100%; text-align: center; height: 100%; position: relative; overflow: hidden;">\r\n    \r\n    <div class="img-loading" style="font-size: 1.2em; position: absolute; top: 0; text-align: center; width: 100%; height: 100%; display: none;">\r\n        <div style="position: absolute; text-align: center; left: 0; right: 0; top: 50%;">\r\n            Loading\r\n        </div>\r\n    </div>\r\n    \r\n    <div class="save-header" style="font-size: 1.2em;">\r\n        <div style="text-align: left; padding-bottom: 5px;">\r\n            <span style="margin: 5px 1% 1% 0; white-space: nowrap;">\r\n                Width:\r\n                <select class="chart-width-select">\r\n                    <option value="360">360px</option>\r\n                    <option value="460">460px</option>\r\n                    <option value="520">520px</option>\r\n                    <option value="620">620px</option>\r\n                    <option value="780">780px</option>\r\n                    <option value="900">900px</option>\r\n                    <option value="1024" selected="selected">1024px</option>\r\n                    <option value="1280">1280px</option>\r\n                    <option value="1600">1600px</option>\r\n                </select>\r\n            </span>\r\n        \r\n            <span class="chart-theme-section" style="margin: 5px 1% 1% 0; white-space: nowrap;">\r\n                Theme:\r\n                <select class="chart-theme-select"></select>\r\n            </span>\r\n            \r\n            <a class="download-button" download="chart.png" style="margin: 5px 1% 1% 0; display: none;">Download</a>\r\n        </div>\r\n    \r\n        <div class="download-instructions" style="height: 25px;">\r\n            To save chart, right-click on image and \'Save Image As...\'\r\n        </div>\r\n    </div>\r\n\r\n    <div class="img-wrapper" style="position: absolute; left: 0; right: 0; top: 25px; bottom: 0; display: block; overflow: auto;">\r\n        <img class="chart-image" style="display: block;" />\r\n    </div>\r\n</div>\r\n'},useData:!0}),Db.SeriesForm=Handlebars.template({1:function(e,t,i,a,n){var o="",r=null!=(r=i.displaySeries||(null!=t?t.displaySeries:t))?r:i.helperMissing,n={name:"displaySeries",hash:{},fn:e.program(2,n,0),inverse:e.noop,data:n},r="function"==typeof r?r.call(null!=t?t:e.nullContext||{},n):r;return null!=(r=!i.displaySeries?i.blockHelperMissing.call(t,r,n):r)&&(o+=r),o},2:function(e,t,i,a,n){var o="",r=null!=(r=i.attributes||(null!=t?t.attributes:t))?r:i.helperMissing,n={name:"attributes",hash:{},fn:e.program(3,n,0),inverse:e.noop,data:n},r="function"==typeof r?r.call(null!=t?t:e.nullContext||{},n):r;return null!=(r=!i.attributes?i.blockHelperMissing.call(t,r,n):r)&&(o+=r),o},3:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression;return'        <tr>\r\n            <td>\r\n                Color:\r\n            </td>\r\n            <td>\r\n        <div style="float: right; margin: 3px;">\r\n            <input name="color"\r\n                   style="width: 0; display: none;"\r\n                   class="strokeColor colorPicker evo-cp0"\r\n                   data-indicator-discrete-id="ugh"\r\n                   data-init-color="'+l(typeof(e=null!=(e=i.displayColor||(null!=t?t.displayColor:t))?e:r)==s?e.call(o,{name:"displayColor",hash:{},data:n}):e)+'"\r\n                />\r\n        </div>\r\n                \r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td>\r\n                Thickness:\r\n            </td>\r\n            <td style="text-align: right;">\r\n                <input name="thickness" value="'+l(typeof(e=null!=(e=i.lineThickness||(null!=t?t.lineThickness:t))?e:r)==s?e.call(o,{name:"lineThickness",hash:{},data:n}):e)+'"\r\n                       data-indicator-discrete-id="'+l(typeof(e=null!=(e=i.discreteIndicatorID||(null!=t?t.discreteIndicatorID:t))?e:r)==s?e.call(o,{name:"discreteIndicatorID",hash:{},data:n}):e)+'"/>\r\n            </td>\r\n        </tr>\r\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){var o='<div class="charting SeriesForm" style="width: auto;">\r\n    <table>\r\n',r=null!=(r=i.series||(null!=t?t.series:t))?r:i.helperMissing,n={name:"series",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n},r="function"==typeof r?r.call(null!=t?t:e.nullContext||{},n):r;return null!=(r=!i.series?i.blockHelperMissing.call(t,r,n):r)&&(o+=r),o+"        </table>\r\n</div>"},useData:!0}),Db.SeriesToolbar=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div class="RootDiv SeriesToolbar" style="position: relative; width: 100%; height: 100%;">\r\n    \r\n</div>'},useData:!0}),Db.SettingsContextMenu=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div class="charting context-menu ui-widget ui-widget-content ui-corner-all">\r\n    <ul id="menu-left" class="context-menu-column">\r\n\r\n        <li class="notCompact not-indicator-menu-item settings-btn"><a href="#">settings</a></li>\r\n        <li class="paste-btn" style="display: none;"><a href="#paste">paste</a></li>\r\n        <li class="remove-all-btn" style="display: none;"><a href="#delete">remove all</a></li>\r\n        <li class="remove-indicator-button remove-indicator-btn" style="display: none;"><a href="#">remove indicator</a></li>\r\n    </ul>\r\n</div>'},useData:!0}),Db.TimeSlider=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'\r\n<div>\r\n    <div class="topScroll" style="position: absolute; left: 0; top: 0;">\r\n    </div>\r\n\r\n    <div class="bottomScroll" style="position: absolute; left: 0; bottom: 0;">\r\n    </div>\r\n\r\n    <div class="centerBox"></div>\r\n    <div class="leftBox"></div>\r\n    <div class="rightBox"></div>\r\n\r\n    <div class="datesBox" style="position: absolute; left: 0; top: 0; overflow: hidden; background-color: transparent;"></div>\r\n\r\n    <button class="LeftArrow" type="button" style="position: absolute; left: 1px; bottom: -1px; z-index: 13;"></button>\r\n\r\n    <button class="RightArrow" type="button" style="position: absolute; right: 16px; bottom: -1px; z-index: 13;"></button>\r\n</div>'},useData:!0}),Db.VerticalAxis=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div class="TextsDiv VerticalTextsDiv" style="position: absolute; top: 0; left: 0;"></div>\r\n<canvas class="vertical-axis-canvas" style="position: absolute; top: 0; left: -3px;" />'},useData:!0}),Db.VisualSettings=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div class="visual-settings">\r\n    \r\n    <table>\r\n        <tr>\r\n            <td>Theme</td>\r\n            <td style="width: 40px;"></td>\r\n            <td>Data Points</td>\r\n        </tr>\r\n        <tr>\r\n            <td style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Chart Background:</td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Main Color</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaBackground"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Alternative Color</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaAlternativeBackground"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n            <td></td>\r\n            <td style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Line:</td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Up</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaLineUpColor"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Down</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaLineDownColor"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n            <td></td>\r\n        </tr>\r\n        <tr>\r\n            <td style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Grid Lines:</td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Visibility</td>\r\n                        <td style="float: right;">\r\n                            <select class="grid-lines-visibility">\r\n                                <option value="both" selected="selected">Both</option>\r\n                                <option value="horizontal">Horizontal</option>\r\n                                <option value="vertical">Vertical</option>\r\n                                <option value="none">None</option>\r\n                            </select>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Color</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="grid-lines-color"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Line Type</td>\r\n                        <td style="float: right;">\r\n                            <select class="grid-line-type">\r\n                                <option value="line">Line</option>\r\n                                <option value="dashes">Dashes</option>\r\n                                <option value="dots">Dots</option>\r\n                            </select>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Opacity</td>\r\n                        <td>\r\n                            <div class="grid-lines-opacity-slider" style="margin-top: 3px;"></div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n            <td></td>\r\n            <td style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Candle Stick:</td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Up Border</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaCandleStickUpStroke"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>\r\n                            Up Fill \r\n                            <input name="candle-stick-up-hollow" type="checkbox"/>\r\n                        </td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaCandleStickUpFill"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Down Border</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaCandleStickDownStroke"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Down Fill</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaCandleStickDownFill"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n            <td></td>\r\n        </tr>\r\n        <tr>\r\n            <td style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Axis Labels:</td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Minor Color</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="axisTextMinor"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Major Color</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="axisTextMajor"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n            <td></td>\r\n            <td style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Bars:</td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Up</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaBarUpColor"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Down</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaBarDownColor"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n            <td></td>\r\n        </tr>\r\n        <tr>\r\n            <td style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Axis Highlight:</td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Background</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="selectedBackground"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Text</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="selectedForeground"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Crosshair</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="crosshairColor"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n            <td></td>\r\n            <td style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Kagi:</td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Up</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaKagiUpColor"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Down</td>\r\n                        <td style="float: right;">\r\n                            <input name="color"\r\n                                   style="width: 0; display: none;"\r\n                                   class="strokeColor colorPicker evo-cp0"\r\n                                   data-property-name="chartDisplayAreaKagiDownColor"\r\n                                />\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td class="axis-font-size-section "style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Axis Font Size:</td>\r\n                        <td style="width: 50px;"></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Horizontal</td>\r\n                        <td>\r\n                            <div class="axis-font-size-horizontal-slider" style="margin-top: 3px;"></div>\r\n                        </td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Vertical</td>\r\n                        <td>\r\n                            <div class="axis-font-size-vertical-slider" style="margin-top: 3px;"></div>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n            <td></td>\r\n            <td class="chart-dimensions-section" style="vertical-align: top;">\r\n                <table style="width: 100%;" class="settings-section">\r\n                    <tr>\r\n                        <td style="font-weight: bold; padding-top: 0em;">Chart Dimensions:</td>\r\n                        <td></td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td>Type</td>\r\n                        <td style="float: right;">\r\n                            <select class="chart-dimensions-type">\r\n                                <option value="fit" selected="selected">Fit to Window</option>\r\n                                <option value="set-width">Set width</option>\r\n                                <option value="custom">Custom</option>\r\n                            </select>\r\n                        </td>\r\n                    </tr>\r\n                    <tr class="chart-dimensions-set-width-row">\r\n                        <td>Width</td>\r\n                        <td style="float: right;">\r\n                            <select class="chart-width-select">\r\n                                <option value="360">360px</option>\r\n                                <option value="460">460px</option>\r\n                                <option value="520">520px</option>\r\n                                <option value="620">620px</option>\r\n                                <option value="780">780px</option>\r\n                                <option value="900">900px</option>\r\n                                <option value="1024">1024px</option>\r\n                                <option value="1280">1280px</option>\r\n                                <option value="1600">1600px</option>\r\n                            </select>\r\n                        </td>\r\n                    </tr>\r\n                    <tr class="chart-dimensions-custom-row">\r\n                        <td>Width</td>\r\n                        <td style="float: right;">\r\n                            <input name="custom-width" style="width: 50px;"/>\r\n                        </td>\r\n                    </tr>\r\n                    <tr class="chart-dimensions-custom-row">\r\n                        <td>Height</td>\r\n                        <td style="float: right;">\r\n                            <input name="custom-height" style="width: 50px;"/>\r\n                        </td>\r\n                    </tr>\r\n                </table>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n    \r\n    <div>\r\n        <input type="button" name="default" value="DEFAULT"/>\r\n        <input type="button" name="ok" value="OK" style="float: right;"/>\r\n    </div>\r\n\r\n</div>'},useData:!0}),Db.app=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){return'<div class="charting ChartRoot" style="height: 100%; width: 100%; position: relative;">\r\n    <div class="ChartToolbar toolbar" style="position: absolute; left: 0; top: 0; width: 100%; z-index: 3;"></div>\r\n    <div class="ChartDiv" style="position: absolute; left: 0; top: 0; right: 0; z-index: 1; overflow: hidden;"></div>\r\n    <div class="disclaimer">Disclaimer: Mid price chart data is indicative only.</div>\r\n\r\n    <div class="no-data" style="display: table; width: 100%; height: 100%; opacity: 0.9;">\r\n        <div style="display: table-cell; width: 100%; height: 100%; vertical-align: middle; text-align: center;">\r\n            <span class="no-data-text">\r\n                There is no data available for the selected instrument. Please contact technical support for further information.\r\n            </span>\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n'},useData:!0}),Db.indicatorListItem=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,a,n){var o=null!=t?t:e.nullContext||{},r=i.helperMissing,s="function",l=e.escapeExpression;return"<li>\r\n    <label>\r\n        <span class='indicatorListName'>"+l(typeof(e=null!=(e=i.IndicatorName||(null!=t?t.IndicatorName:t))?e:r)==s?e.call(o,{name:"IndicatorName",hash:{},data:n}):e)+"</span>\r\n        <input type='checkbox' name='customIndicator' value='"+l(typeof(e=null!=(e=i.IndicatorCode||(null!=t?t.IndicatorCode:t))?e:r)==s?e.call(o,{name:"IndicatorCode",hash:{},data:n}):e)+"' "+l(typeof(e=null!=(e=i.listItemChecked||(null!=t?t.listItemChecked:t))?e:r)==s?e.call(o,{name:"listItemChecked",hash:{},data:n}):e)+" />\r\n        <span class='indicatorCheckbox'></span>\r\n    </label>\r\n</li>"},useData:!0}),Db);function Db(){}var AnnotationEditForm=(R4=Backbone.View,__extends(S4,R4),S4.prototype.applyTemplate=function(){var e=this;switch($(this.el).html(T.AnnotationEditForm({ExtendFutureLabel:"vertical-line"===this.annotation.drawTool.tool?"Down":"Future",ExtendPastLabel:"vertical-line"===this.annotation.drawTool.tool?"Up":"Past",Options:this.annotation.drawTool.options})),this.$options=this.$el.find(".options"),this.$options.hide(),this.annotation.drawTool.tool){case"trend-line":case"horizontal-line":case"vertical-line":this.$el.find(".shape").detach(),this.$el.find(".text").detach(),this.$el.find(".advanced").detach(),this.arrangeLine();break;case"ellipse":case"rectangle":case"rotation-rectangle":this.$el.find(".line").detach(),this.$el.find(".text").detach(),this.$el.find(".advanced").detach(),this.arrangeShape();break;case"text-note":this.$el.find(".line").detach(),this.$el.find(".advanced").detach(),this.arrangeText(),this.arrangeShape();break;case"gann-box":case"fibonacci-fan":case"andrews-pitchfork":case"fibonacci-time-zones":case"fibonacci-arcs":case"dinapoli":this.$el.find(".line").detach(),this.$el.find(".shape").detach(),this.$el.find(".text").detach(),this.arrangeLine();break;case"fibonacci-retracements":case"gann-fan":this.$el.find(".line").detach(),this.$el.find(".shape").detach(),this.$el.find(".text").detach(),this.arrangeLine(),this.arrangeOptions();break;default:throw"annotation not supported"}this.$el.find('input[name="ok"]').button().on("click",function(){$(e).trigger("close")}),this.$el.find('input[name="remove"]').button().on("click",function(){$(e).trigger("close"),$(e).trigger("remove")}),this.$el.find(".ui-spinner").addClass("text-box")},S4.prototype.arrangeLine=function(){var i,a=this;this.lineThickness=this.$el.find(".line-thickness").spinner({max:5,min:1,spin:function(e,t){a.annotation.drawTool.lineThickness=t.value,$(a).trigger("change")}}),this.lineThickness.spinner("value",this.annotation.drawTool.lineThickness),this.lineColorPicker=this.$el.find("input[name=line-color]"),$(this.lineColorPicker).colorpicker({displayIndicator:!1,color:this.annotation.drawTool.lineColorDef}),$(this.lineColorPicker).on("change.color",function(e,t){a.annotation.drawTool.lineColorDef=t,i=Helpers.hexToRgb(t),a.annotation.drawTool.lineColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.lineOpacity/100+")",$(a).trigger("change")}),this.linesOpacitySlider=this.$el.find(".line-opacity-slider"),$(this.linesOpacitySlider).slider({min:1,max:100,step:1,value:this.annotation.drawTool.lineOpacity,slide:function(e,t){a.annotation.drawTool.lineOpacity=t.value,i=Helpers.hexToRgb(a.annotation.drawTool.lineColorDef),a.annotation.drawTool.lineColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.lineOpacity/100+")",$(a).trigger("change")}});var e=this.annotation.drawTool.lineType?this.annotation.drawTool.lineType[1]:0;this.lineTypeSelect=this.$el.find(".line-type"),0===e?this.lineTypeSelect.find('option[value="line"]').prop("selected","selected"):3===e?this.lineTypeSelect.find('option[value="dots"]').prop("selected","selected"):5===e&&this.lineTypeSelect.find('option[value="dashes"]').prop("selected","selected"),$(this.lineTypeSelect).on("change",function(){switch(a.lineTypeSelect.prop("value")){case"line":a.annotation.drawTool.lineType=null;break;case"dashes":a.annotation.drawTool.lineType=[5,5];break;case"dots":a.annotation.drawTool.lineType=[2,3]}$(a).trigger("change")}),this.lineExtend=this.$el.find(".extend-line"),this.lineExtendFuture=this.lineExtend.find("input[value=future]"),this.lineExtendPast=this.lineExtend.find("input[value=past]"),this.annotation.extendFuture&&this.lineExtendFuture.prop("checked",!0),this.annotation.extendPast&&this.lineExtendPast.prop("checked",!0),this.lineExtendFuture.change(function(){a.annotation.extendFuture=!a.annotation.extendFuture,$(a).trigger("change")}),this.lineExtendPast.change(function(){a.annotation.extendPast=!a.annotation.extendPast,$(a).trigger("change")})},S4.prototype.arrangeOptions=function(){var t=this;this.$options.show(),_.each(this.annotation.drawTool.options,function(e){t.$options.find("input[name="+e.name+"]").change(function(){e.selected=!e.selected,$(t).trigger("change")})})},S4.prototype.arrangeShape=function(){var i,a=this;this.borderThickness=this.$el.find(".border-thickness").spinner({max:5,min:1,spin:function(e,t){a.annotation.drawTool.lineThickness=t.value,$(a).trigger("change")}}),this.borderThickness.spinner("value",this.annotation.drawTool.lineThickness),this.borderColorPicker=this.$el.find("input[name=border-color]"),$(this.borderColorPicker).colorpicker({displayIndicator:!1,color:this.annotation.drawTool.lineColorDef}),$(this.borderColorPicker).on("change.color",function(e,t){a.annotation.drawTool.lineColorDef=t,i=Helpers.hexToRgb(t),a.annotation.drawTool.lineColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.lineOpacity/100+")",$(a).trigger("change")}),this.borderOpacitySlider=this.$el.find(".border-opacity-slider"),$(this.borderOpacitySlider).slider({min:1,max:100,step:1,value:this.annotation.drawTool.lineOpacity,slide:function(e,t){a.annotation.drawTool.lineOpacity=t.value,i=Helpers.hexToRgb(a.annotation.drawTool.lineColorDef),a.annotation.drawTool.lineColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.lineOpacity/100+")",$(a).trigger("change")}}),this.fillColorPicker=this.$el.find("input[name=fill-color]"),$(this.fillColorPicker).colorpicker({displayIndicator:!1,color:this.annotation.drawTool.fillColorDef}),$(this.fillColorPicker).on("change.color",function(e,t){a.annotation.drawTool.fillColorDef=t,i=Helpers.hexToRgb(t),a.annotation.drawTool.fillColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.fillOpacity/100+")",$(a).trigger("change")}),this.fillOpacitySlider=this.$el.find(".fill-opacity-slider"),$(this.fillOpacitySlider).slider({min:1,max:100,step:1,value:this.annotation.drawTool.fillOpacity,slide:function(e,t){a.annotation.drawTool.fillOpacity=t.value,i=Helpers.hexToRgb(a.annotation.drawTool.fillColorDef),a.annotation.drawTool.fillColor="rgba("+i.r+","+i.g+","+i.b+","+a.annotation.drawTool.fillOpacity/100+")",$(a).trigger("change")}})},S4.prototype.arrangeText=function(){var i=this;this.textMargin=this.$el.find(".text-margin").spinner({max:50,min:0,spin:function(e,t){i.annotation.drawTool.textMargin=t.value,$(i).trigger("change")}}),this.textMargin.spinner("value",this.annotation.drawTool.textMargin),this.textSize=this.$el.find(".text-size").spinner({max:50,min:0,spin:function(e,t){i.annotation.drawTool.textSize=t.value,$(i).trigger("change")}}),this.textSize.spinner("value",this.annotation.drawTool.textSize),this.textColor=this.$el.find("input[name=text-color]"),$(this.textColor).colorpicker({displayIndicator:!1,color:this.annotation.drawTool.textColor}),$(this.textColor).on("change.color",function(e,t){i.annotation.drawTool.textColor=t,$(i).trigger("change")}),this.text=this.$el.find(".note-text"),$(this.text).val(this.annotation.text),$(this.text).on("change",function(e){i.annotation.text=$(e.target).prop("value"),$(i).trigger("change")})},S4.prototype.initialize2=function(e){var t=this;this.options=e,this.annotation=e.annotation,this.colorPickers=[],this.applyTemplate(),this.originalDrawTool=$.extend(!0,{},this.annotation.drawTool),this.$el.on("dialogclose",function(e){e.originalEvent&&$(e.originalEvent.target).closest(".ui-dialog-titlebar-close").length&&(t.annotation.drawTool=t.originalDrawTool,$(t).trigger("change"))})},S4),R4;function S4(e){var t=R4.call(this)||this;return t.colorPickers=[],t.initialize2(e),t}var AnnotationContextMenu=(D5=Backbone.View,__extends(E5,D5),E5.prototype.show=function(e){var a,o=this,t=this.model.get("currentTheme"),i=this.model.get("supportedThemes"),n=this.$el.find(".context-menu");_.each(i,function(e){n.removeClass(e)}),n.addClass(t),this.$el.appendTo($("body")),this.contextMenu.css({left:e.pageX+"px",top:e.pageY+"px"}),$(this.$el.find("#menu")).menu({select:function(e,t){e.stopPropagation();t=t.item;if("delete"===t.text())$(o).trigger("delete");else if("edit"===t.text()){if(o.annotationsManager.openDialog)return o.annotationsManager.openDialog.$el.parent().toggleClass("flash",!1),void _.defer(function(){o.annotationsManager.openDialog.$el.parent().toggleClass("flash",!0)});var i=new AnnotationEditForm({annotation:o.annotation});(o.annotationsManager.openDialog=i).$el.dialog({dialogClass:"charting "+o.model.get("currentTheme"),title:"Edit",resizable:!1,width:"auto",open:function(e){$(e.target).css("overflow","visible"),a=$(e.target).parent(),o.model.changeThemeClassForElementWhenThemeChanges(a)},close:function(){o.annotationsManager.openDialog=null,i.$el.dialog("destroy"),o.annotationsManager.updateAnnotationsStorage()}}),$(i).on("change",function(){$(o).trigger("change")}),$(i).on("remove",function(){$(o).trigger("delete")}),$(i).on("close",function(){$(i.$el).dialog("close")})}else"copy"===t.text()&&$(o).trigger("copy",{type:"copy",item:$.extend({},o.annotation)});e.preventDefault(),o.$el.detach()}}),$(document).on("mouseup",function(e){var t=parseFloat(o.contextMenu.css("left")),i=t+o.contextMenu.width(),a=parseFloat(o.contextMenu.css("top")),n=a+o.contextMenu.height();(e.pageX<t||e.pageX>i||e.pageY<a||e.pageY>n)&&o.$el.detach()})},E5),D5;function E5(e){var t=D5.call(this,e)||this;return t.options=e,t.annotation=e.annotation,t.annotationsManager=e.annotationsManager,t.$el.html(T.AnnotationContextMenu()),t.contextMenu=t.$el.find(".context-menu"),t}var AnnotationsManager=(Y5.prototype.addAnnotation=function(e,t){var i=this;void 0===t&&(t=!1);var a,n,o=$(this.displayArea.$mainCanvas[0]).offset(),r=(e.drawStartPoint.selectedIndex-this.displayArea.displayFromIndex)*this.displayArea.xRatio,s=e.drawStartPoint.x-(r+o.left);return e.drawStartPoint.xAddOn=s/this.displayArea.xRatio,r=(e.drawEndPoint.selectedIndex-this.displayArea.displayFromIndex)*this.displayArea.xRatio,s=e.drawEndPoint.x-(r+o.left),e.drawEndPoint.xAddOn=s/this.displayArea.xRatio,a=e.drawStartPoint.selectedItem.get("quoteDate"),n=Helpers.getNextDate(a,this.model.get("granularity")),a=a.getTime(),n=n.getTime(),e.drawStartTime=a+(n-a)*e.drawStartPoint.xAddOn,a=e.drawEndPoint.selectedItem.get("quoteDate"),n=Helpers.getNextDate(a,this.model.get("granularity")),a=a.getTime(),n=n.getTime(),e.drawEndTime=a+(n-a)*e.drawEndPoint.xAddOn,"text-note"===e.drawTool.tool&&_.each(e.notePoints,function(e){r=(e.selectedIndex-i.displayArea.displayFromIndex)*i.displayArea.xRatio,s=e.x-(r+o.left),e.xAddOn=s/i.displayArea.xRatio,a=e.selectedItem.get("quoteDate"),n=Helpers.getNextDate(a,i.model.get("granularity")),a=a.getTime(),n=n.getTime(),e.drawTime=a+(n-a)*e.xAddOn}),this.allAnnotations.push(e),this.filteredAnnotations.push(e),t||this.updateAnnotationsStorage(),e},Y5.prototype.addLevel=function(e,t){var i,a,n,o=this,r={};if(r.value=e,r.type=t,this.onLevelAdded(r)){switch(r.type){case"entry":a=this.model.get("levelColorHexEntry"),i="rgba("+(n=Helpers.hexToRgb(a)).r+","+n.g+","+n.b+",1)";break;case"profit":a=this.model.get("levelColorHexProfit"),i="rgba("+(n=Helpers.hexToRgb(a)).r+","+n.g+","+n.b+",1)";break;case"stop":a=this.model.get("levelColorHexStop"),i="rgba("+(n=Helpers.hexToRgb(a)).r+","+n.g+","+n.b+",1)"}for(var s={tool:"horizontal-line",lineThickness:1,lineColor:i,lineColorDef:a,lineOpacity:100,fillColor:i,fillColorDef:a,fillOpacity:100,textMargin:7,textSize:12},l={x:this.displayArea.allSeries[0].get("elements")[this.displayArea.displayFromIndex].bounds.right,y:this.displayArea.getValuePosition(e),selectedItem:this.displayArea.allSeries[0].get("elements")[this.displayArea.displayFromIndex],selectedIndex:this.displayArea.displayFromIndex,selectedPrice:e},d=void 0,c=this.displayArea.allSeries[0].get("elements").length-1;0<=c&&!(d=this.displayArea.allSeries[0].get("elements")[c]).bounds;--c);t={x:d.bounds.left,y:this.displayArea.getValuePosition(e),selectedItem:d,selectedIndex:this.displayArea.displayToIndex,selectedPrice:e},r.annotation=r={extendFuture:!0,extendPast:!0,drawTool:s,drawStartPoint:l,drawEndPoint:t,maxPrice:e,minPrice:e,extendedChildren:[],extendedChartAreas:[],onRemoved:function(e){return o.onLevelRemoved(e)},onChanged:function(){return o.onLevelChanged()},removeVisual:function(e,t){return o.removeAnnotation(e,t)},level:r},this.addAnnotation(r),this.displayArea.updateDisplay()}},Y5.prototype.applyAnnotationsStorage=function(){var t,s=this;if(this.enableSave){if(!this.model.get("savedAnnotations"))return this.clearAnnotationsForced(!0),void this.displayArea.onResize();try{t=JSON.parse(this.model.get("savedAnnotations"))}catch(e){console.log("Annotations string is in wrong format."),t=null}_.each(t,function(e){for(var t,i,a=e.drawStartPoint.selectedItemQuoteDate,n=e.drawEndPoint.selectedItemQuoteDate,o=0;o<s.displayArea.allSeries[0].get("elements").length;o+=1){var r=s.displayArea.allSeries[0].get("elements")[o];a>=r.get("quoteDate").valueOf()&&!t?(e.drawStartPoint.selectedIndex=r.get("index"),e.drawStartPoint.selectedItem=r):t=!0,n>=r.get("quoteDate").valueOf()&&!i?(e.drawEndPoint.selectedIndex=r.get("index"),e.drawEndPoint.selectedItem=r):i=!0,e.notePoints&&_.each(e.notePoints,function(e){for(var t,i=e.selectedItemQuoteDate,a=0;a<s.displayArea.allSeries[0].get("elements").length;a+=1){var n=s.displayArea.allSeries[0].get("elements")[a];i>=n.get("quoteDate").valueOf()&&!t?(e.selectedIndex=n.get("index"),e.selectedItem=n):t=!0}})}}),this.applyingAnnotations=!0,_.each(t,function(e){s.scalePendingAnnotations.push(e)}),this.clearAnnotationsForced(!0),this.scalingPending=!0,this.scaleAnnotations(),this.displayArea.onResize(),this.applyingAnnotations=!1}},Y5.prototype.onLevelAdded=function(e){var t=!1;switch(this.levels||(this.levels={entry:null,profits:[],stops:[]},this.model.set("levels",this.levels)),e.id=Helpers.getGUID(),e.type){case"entry":this.levels.entry||(this.levels.entry=e,t=!0);break;case"profit":this.levels.profits.length<3&&(this.levels.profits.push(e),t=!0);break;case"stop":this.levels.stops.length<3&&(this.levels.stops.push(e),t=!0);break;default:QuickBase.Log.Error("level type not supported: "+e.type)}return t},Y5.prototype.onLevelChanged=function(){this.level.value=this.maxPrice},Y5.prototype.onLevelRemoved=function(e){var t=e.level,i=-1;switch(t.type){case"entry":this.levels.entry=null;break;case"profit":-1!==(i=this.levels.profits.indexOf(t))&&this.levels.profits.slice(i,1);break;case"stop":-1!==(i=this.levels.stops.indexOf(t))&&this.levels.stops.slice(i,1);break;default:console.log("onLevelRemoved: level type not supported",t.type)}e.level=null},Y5.prototype.buildNotePoly=function(e,t){var i=[],a=0,n=1;e[0].x>e[1].x&&(a=1,n=0),i.push(e[a]),i.push({x:e[a].x,y:e[a].y+t}),i.push({x:e[n].x,y:e[a].y+t}),i.push({x:e[n].x,y:e[a].y});for(var o=(e[0].x+e[1].x)/2,r=(e[0].y+e[1].y)/2+t/2,a=2;a<e.length;a++){var s={x:e[a].x-o,y:e[a].y-r},l=Math.sqrt(s.x*s.x+s.y*s.y);s.x/=l,s.y/=l;for(var l=4*-s.y,s=4*s.x,d={x:o+l,y:r+s},c={x:o-l,y:r-s},h=void 0,p=void 0,u=void 0,m=void 0,u=0;u<i.length&&null===h;u++)n=(u+1)%i.length,h=Vector.prototype.intersection(d,e[a],i[u],i[n]);for(m=0;m<i.length&&null===p;m++)n=(m+1)%i.length,p=Vector.prototype.intersection(c,e[a],i[m],i[n]);null!==h&&null!==p&&(u!==m&&(m<u?(i=i.slice(m,m+(u-m)),u=0):i.splice(u,m-u)),i.splice(u%i.length,0,h,e[a],p))}return i},Y5.prototype.clearAnnotations=function(){this.scalePendingAnnotations=this.scalePendingAnnotations.concat(this.allAnnotations),this.allAnnotations=[],this.filteredAnnotations=[],this.scalingPending=!0,this.updateAnnotationsStorage()},Y5.prototype.clearAnnotationsForced=function(e){for(var t=0;t<this.allAnnotations.length;t+=1)this.allAnnotations[t].onRemoved&&this.allAnnotations[t].onRemoved(this.allAnnotations[t]);this.currentSymbol=this.model.get("stockSymbol"),this.scalingPending=!1,this.allAnnotations=[],this.filteredAnnotations=[],this.levels=null,this.model.set("levels",null),this.removedAnnotations=[],e||(this.clearAnnotationsCanvas(),this.displayArea.updateDisplay()),this.updateAnnotationsStorage()},Y5.prototype.clearAnnotationsCanvas=function(){var e,t,i;this.isCanvasClear||(e=this.$annotationsCanvas[0].getContext("2d"),t=this.$annotationsCanvas.width(),i=this.$annotationsCanvas.height(),e.clearRect(0,0,t,i),this.isCanvasClear=!0)},Y5.prototype.clearDrawingCanvas=function(){var e=this.$drawingCanvas[0].getContext("2d"),t=this.$drawingCanvas.width(),i=this.$drawingCanvas.height();e.clearRect(0,0,t,i)},Y5.prototype.drawAnnotationAndrewsPitchfork=function(t,e,i,a,n,o,r,d){function s(e,t,i,a,n,o,r){var s=(a+o)/2,l=((n+r)/2-i)/(s-t);return[{x1:t,y1:i,x2:e=t<=s?e:0,y2:l*e+(i-l*t)},{x1:a,y1:n,x2:e,y2:l*e+(n-l*a)},{x1:o,y1:r,x2:e,y2:l*e+(r-l*o)}]}var l,c,h=this,p=e.offset(),u=this.$drawingCanvas.offset(),m=this.$drawingCanvas[0].getContext("2d"),g=p.left-u.left,u=p.top-u.top,f=d&&d.drawAdditionalPoint?(l=d.drawAdditionalPoint.x,d.drawAdditionalPoint.y):((f=new Vector).fromPoints(o,n,o,r),l=o-f.x,n-f.y);t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,c=s(e.width(),a,n,o,r,l,f),_.each(c,function(e){t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.closePath(),t.stroke()}),t.beginPath(),t.moveTo(o,r),t.lineTo(l,f),t.closePath(),t.stroke(),d&&(d.setTrasformPoints=function(e,t,i,a,n,o,r,s,l){d.trasformPoints=[{x:e+r.left,y:t+r.top,dcx:e+s,dcy:t+l,cursor:"move"},{x:i+r.left,y:a+r.top,dcx:i+s,dcy:a+l,cursor:"move"},{x:n+r.left,y:o+r.top,dcx:n+s,dcy:o+l,cursor:"move"}];n+=(i-n)/2,a=o+(a-o)/2,o=new Vector;o.fromPoints(e,t,n,a);o=o.findPerpendicular(2);d.boundsPoints=[{x:e+o.x+r.left,y:t+o.y+r.top,dcx:e+o.x+s,dcy:t+o.y+l},{x:n+o.x+r.left,y:a+o.y+r.top,dcx:n+o.x+s,dcy:a+o.y+l},{x:n-o.x+r.left,y:a-o.y+r.top,dcx:n-o.x+s,dcy:a-o.y+l},{x:e-o.x+r.left,y:t-o.y+r.top,dcx:e-o.x+s,dcy:t-o.y+l}]},d.isMouseOver=function(t,i){return d.isOverPoint=!1,_.each(d.trasformPoints,function(e){e.isMouseOverPoint=!1,h.isPointOverEllipse(t,i,e.x,e.y,h.transformPointRadius,h.transformPointRadius)&&(d.isOverPoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverShape=!1,d.isOverPoint||(d.isOverShape=h.isPointOverPolygon(t,i,d.boundsPoints)),d.isOverPoint||d.isOverShape},d.drawDc=function(){m.lineWidth=d.drawTool.lineThickness,m.strokeStyle=d.drawTool.lineColor,c=s(h.$drawingCanvas.width(),d.trasformPoints[0].dcx,d.trasformPoints[0].dcy,d.trasformPoints[1].dcx,d.trasformPoints[1].dcy,d.trasformPoints[2].dcx,d.trasformPoints[2].dcy),_.each(c,function(e){m.beginPath(),m.moveTo(e.x1,e.y1),m.lineTo(e.x2,e.y2),m.closePath(),m.stroke()}),m.beginPath(),m.moveTo(d.trasformPoints[1].dcx,d.trasformPoints[1].dcy),m.lineTo(d.trasformPoints[2].dcx,d.trasformPoints[2].dcy),m.closePath(),m.stroke()},d.highlight=function(){_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(m.fillStyle="red",h.cursor=e.cursor):m.fillStyle="white",m.lineWidth=h.transformPointStrokeWidth,m.strokeStyle="black",m.beginPath(),m.arc(e.dcx,e.dcy,h.transformPointRadius,0,2*Math.PI,!1),m.closePath(),m.fill(),m.stroke()}),d.isOverShape&&(h.cursor="move")},d.beginTransforming=function(e,t){h.filteredAnnotations=_.without(h.filteredAnnotations,d),h.allAnnotations=_.without(h.allAnnotations,d),h.clearAnnotationsCanvas(),h.drawAnnotations(h.lastxRatio,h.lastDisplayFromIndex),d.drawDc(),d.movePoint={x:e,y:t},d.isOverPoint&&(_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(m.fillStyle="red",h.cursor=e.cursor):m.fillStyle="white",m.lineWidth=h.transformPointStrokeWidth,m.strokeStyle="black",m.beginPath(),m.arc(e.dcx,e.dcy,h.transformPointRadius,0,2*Math.PI,!1),m.closePath(),m.fill(),m.stroke()}),h.showCrosshair=!0)},d.transform=function(e,t){var i=e-d.movePoint.x,a=t-d.movePoint.y;d.movePoint={x:e,y:t},h.clearDrawingCanvas(),d.isOverPoint?(d.mousePoint.x+=i,d.mousePoint.y+=a,d.mousePoint.dcx+=i,d.mousePoint.dcy+=a):d.isOverShape&&_.each(d.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),d.drawDc()},d.finishTransforming=function(){h.clearDrawingCanvas();var e=h.displayArea.getPositionIndex(d.trasformPoints[0].x);d.drawStartPoint={x:d.trasformPoints[0].x,y:d.trasformPoints[0].y,selectedItem:h.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:h.displayArea.getPositionValue(d.trasformPoints[0].y)},e=h.displayArea.getPositionIndex(d.trasformPoints[1].x),d.drawEndPoint={x:d.trasformPoints[1].x,y:d.trasformPoints[1].y,selectedItem:h.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:h.displayArea.getPositionValue(d.trasformPoints[1].y)},e=h.displayArea.getPositionIndex(d.trasformPoints[2].x),d.drawAdditionalPoint={x:d.trasformPoints[2].x,y:d.trasformPoints[2].y,selectedItem:h.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:h.displayArea.getPositionValue(d.trasformPoints[2].y)},d.maxPrice=(d.drawStartPoint.selectedPrice>d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,d.minPrice=(d.drawStartPoint.selectedPrice<d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,h.addAnnotation(d),h.drawAnnotations(h.lastxRatio,h.lastDisplayFromIndex)},d.setTrasformPoints(a,n,o,r,l,f,p,g,u))},Y5.prototype.drawAnnotationEllipse=function(e,t,i,a,n,o,r,s){var l=this,d=t.offset(),c=this.$drawingCanvas.offset(),h=this.$drawingCanvas[0].getContext("2d"),t=d.left-c.left,c=d.top-c.top,p=o<a?o:a,u=o<a?a:o,m=r<n?r:n,g=r<n?n:r,f=m+(g-m)/2;e.lineWidth=i.lineThickness,e.strokeStyle=i.lineColor,e.fillStyle=i.fillColor,e.beginPath(),e.moveTo(p,f),e.bezierCurveTo(p,m,u,m,u,f),e.bezierCurveTo(u,g,p,g,p,f),e.closePath(),e.fill(),e.stroke(),s&&(s.setTrasformPoints=function(e,t,i,a,n,o,r){s.trasformPoints=[{x:t+n.left,y:e+n.top,dcx:t+o,dcy:e+r,cursor:"se-resize"},{x:i+n.left,y:e+n.top,dcx:i+o,dcy:e+r,cursor:"sw-resize"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+r,cursor:"se-resize"},{x:t+n.left,y:a+n.top,dcx:t+o,dcy:a+r,cursor:"sw-resize"}],s.trasformPoints[0].connectedX=s.trasformPoints[3],s.trasformPoints[0].connectedY=s.trasformPoints[1],s.trasformPoints[1].connectedX=s.trasformPoints[2],s.trasformPoints[1].connectedY=s.trasformPoints[0],s.trasformPoints[2].connectedX=s.trasformPoints[1],s.trasformPoints[2].connectedY=s.trasformPoints[3],s.trasformPoints[3].connectedX=s.trasformPoints[0],s.trasformPoints[3].connectedY=s.trasformPoints[2]},s.isMouseOver=function(t,i){return s.isOverPoint=!1,_.each(s.trasformPoints,function(e){e.isMouseOverPoint=!1,l.isPointOverEllipse(t,i,e.x,e.y,l.transformPointRadius,l.transformPointRadius)&&(s.isOverPoint=!0,e.isMouseOverPoint=!0,s.mousePoint=e)}),s.isOverShape=!1,s.isOverPoint||(s.isOverShape=l.isPointOverPolygon(t,i,s.trasformPoints)),s.isOverPoint||s.isOverShape},s.drawDc=function(){h.lineWidth=s.drawTool.lineThickness,h.strokeStyle=s.drawTool.lineColor,h.fillStyle=s.drawTool.fillColor,p=Math.min(s.trasformPoints[0].dcx,s.trasformPoints[1].dcx,s.trasformPoints[2].dcx,s.trasformPoints[3].dcx),u=Math.max(s.trasformPoints[0].dcx,s.trasformPoints[1].dcx,s.trasformPoints[2].dcx,s.trasformPoints[3].dcx),m=Math.min(s.trasformPoints[0].dcy,s.trasformPoints[1].dcy,s.trasformPoints[2].dcy,s.trasformPoints[3].dcy),g=Math.max(s.trasformPoints[0].dcy,s.trasformPoints[1].dcy,s.trasformPoints[2].dcy,s.trasformPoints[3].dcy),f=m+(g-m)/2,h.beginPath(),h.moveTo(p,f),h.bezierCurveTo(p,m,u,m,u,f),h.bezierCurveTo(u,g,p,g,p,f),h.closePath(),h.fill(),h.stroke()},s.highlight=function(){_.each(s.trasformPoints,function(e){e.isMouseOverPoint?(h.fillStyle="red",l.cursor=e.cursor):h.fillStyle="white",h.lineWidth=l.transformPointStrokeWidth,h.strokeStyle="black",h.beginPath(),h.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),h.closePath(),h.fill(),h.stroke()}),s.isOverShape&&(l.cursor="move")},s.beginTransforming=function(e,t){l.filteredAnnotations=_.without(l.filteredAnnotations,s),l.allAnnotations=_.without(l.allAnnotations,s),l.clearAnnotationsCanvas(),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex),s.drawDc(),s.movePoint={x:e,y:t},s.isOverPoint&&(_.each(s.trasformPoints,function(e){e.isMouseOverPoint?(h.fillStyle="red",l.cursor=e.cursor):h.fillStyle="white",h.lineWidth=l.transformPointStrokeWidth,h.strokeStyle="black",h.beginPath(),h.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),h.closePath(),h.fill(),h.stroke()}),l.showCrosshair=!0)},s.transform=function(e,t){var i=e-s.movePoint.x,a=t-s.movePoint.y;s.movePoint={x:e,y:t},l.clearDrawingCanvas(),s.isOverPoint?(s.mousePoint.x+=i,s.mousePoint.y+=a,s.mousePoint.dcx+=i,s.mousePoint.dcy+=a,s.mousePoint.connectedX.x+=i,s.mousePoint.connectedX.dcx+=i,s.mousePoint.connectedY.y+=a,s.mousePoint.connectedY.dcy+=a):s.isOverShape&&_.each(s.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),s.drawDc()},s.finishTransforming=function(){l.clearDrawingCanvas(),p=Math.min(s.trasformPoints[0].x,s.trasformPoints[1].x,s.trasformPoints[2].x,s.trasformPoints[3].x),u=Math.max(s.trasformPoints[0].x,s.trasformPoints[1].x,s.trasformPoints[2].x,s.trasformPoints[3].x),m=Math.min(s.trasformPoints[0].y,s.trasformPoints[1].y,s.trasformPoints[2].y,s.trasformPoints[3].y),g=Math.max(s.trasformPoints[0].y,s.trasformPoints[1].y,s.trasformPoints[2].y,s.trasformPoints[3].y);var e=l.displayArea.getPositionIndex(p);s.drawStartPoint={x:p,y:m,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(m)},e=l.displayArea.getPositionIndex(s.trasformPoints[1].x),s.drawEndPoint={x:u,y:g,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(g)},s.maxPrice=(s.drawStartPoint.selectedPrice>s.drawEndPoint.selectedPrice?s.drawStartPoint:s.drawEndPoint).selectedPrice,s.minPrice=(s.drawStartPoint.selectedPrice<s.drawEndPoint.selectedPrice?s.drawStartPoint:s.drawEndPoint).selectedPrice,l.addAnnotation(s),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex)},s.setTrasformPoints(m,p,u,g,d,t,c))},Y5.prototype.drawAnnotationFibonacciArcs=function(t,e,i,a,n,o,r,l){function s(e,t,i,a,n){var o=Math.sqrt(Math.pow(a-t,2)+Math.pow(n-i,2));return d.startPoint=a<t?{x:t,y:i}:{x:a,y:n},d.endPoint=t<a?{x:t,y:i}:{x:a,y:n},[{x:d.startPoint.x,y:d.startPoint.y,param:.236,r:.236*o,text:"23.6 %"},{x:d.startPoint.x,y:d.startPoint.y,param:.382,r:.382*o,text:"38.2 %"},{x:d.startPoint.x,y:d.startPoint.y,param:.5,r:.5*o,text:"50.0 %"},{x:d.startPoint.x,y:d.startPoint.y,param:.618,r:.618*o,text:"61.8 %"},{x:d.startPoint.x,y:d.startPoint.y,param:1,r:o,text:"100.0 %"}]}var d=this,c=e.offset(),h=this.$drawingCanvas.offset(),p=this.$drawingCanvas[0].getContext("2d"),u=c.left-h.left,h=c.top-h.top;t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,t.fillStyle=i.lineColor,t.textAlign="right",this.mainLines=s(e.width(),a,n,o,r),t.beginPath(),t.moveTo(a,n),t.lineTo(o,r),t.closePath(),t.stroke();i=Math.atan2(this.endPoint.x-this.startPoint.x,this.endPoint.y-this.startPoint.y),e=Math.atan2(this.endPoint.x-this.startPoint.x,0);this.angle=i-e,_.each(this.mainLines,function(e){t.beginPath(),t.arc(e.x,e.y,e.r,Math.PI-d.angle,-d.angle,d.endPoint.y>d.startPoint.y),t.stroke(),t.fillText(e.text,d.startPoint.x+(d.endPoint.x-d.startPoint.x)*e.param,d.startPoint.y+(d.endPoint.y-d.startPoint.y)*e.param)}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,r){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+r,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+r,cursor:"move"}];var s=new Vector;s.fromPoints(e,t,i,a);s=s.findPerpendicular(2);l.boundsPoints=[{x:e+s.x+n.left,y:t+s.y+n.top,dcx:e+s.x+o,dcy:t+s.y+r},{x:i+s.x+n.left,y:a+s.y+n.top,dcx:i+s.x+o,dcy:a+s.y+r},{x:i-s.x+n.left,y:a-s.y+n.top,dcx:i-s.x+o,dcy:a-s.y+r},{x:e-s.x+n.left,y:t-s.y+n.top,dcx:e-s.x+o,dcy:t-s.y+r}]},l.isMouseOver=function(t,i){return l.isOverPoint=!1,_.each(l.trasformPoints,function(e){e.isMouseOverPoint=!1,d.isPointOverEllipse(t,i,e.x,e.y,d.transformPointRadius,d.transformPointRadius)&&(l.isOverPoint=!0,e.isMouseOverPoint=!0,l.mousePoint=e)}),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=d.isPointOverPolygon(t,i,l.boundsPoints)),l.isOverPoint||l.isOverShape},l.drawDc=function(){p.lineWidth=l.drawTool.lineThickness,p.strokeStyle=l.drawTool.lineColor,p.fillStyle=l.drawTool.lineColor,d.mainLines=s(d.$drawingCanvas.width(),l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),p.beginPath(),p.moveTo(d.startPoint.x,d.startPoint.y),p.lineTo(d.endPoint.x,d.endPoint.y),p.closePath(),p.stroke();var e=Math.atan2(d.endPoint.x-d.startPoint.x,d.endPoint.y-d.startPoint.y),t=Math.atan2(d.endPoint.x-d.startPoint.x,0);d.angle=e-t,_.each(d.mainLines,function(e){p.beginPath(),p.arc(e.x,e.y,e.r,Math.PI-d.angle,-d.angle,d.endPoint.y>d.startPoint.y),p.stroke(),p.fillText(e.text,d.startPoint.x+(d.endPoint.x-d.startPoint.x)*e.param,d.startPoint.y+(d.endPoint.y-d.startPoint.y)*e.param)})},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(p.fillStyle="red",d.cursor=e.cursor):p.fillStyle="white",p.lineWidth=d.transformPointStrokeWidth,p.strokeStyle="black",p.beginPath(),p.arc(e.dcx,e.dcy,d.transformPointRadius,0,2*Math.PI,!1),p.closePath(),p.fill(),p.stroke()}),l.isOverShape&&(d.cursor="move")},l.beginTransforming=function(e,t){d.filteredAnnotations=_.without(d.filteredAnnotations,l),d.allAnnotations=_.without(d.allAnnotations,l),d.clearAnnotationsCanvas(),d.drawAnnotations(d.lastxRatio,d.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(p.fillStyle="red",d.cursor=e.cursor):p.fillStyle="white",p.lineWidth=d.transformPointStrokeWidth,p.strokeStyle="black",p.beginPath(),p.arc(e.dcx,e.dcy,d.transformPointRadius,0,2*Math.PI,!1),p.closePath(),p.fill(),p.stroke()}),d.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},d.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){d.clearDrawingCanvas();var e=d.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:d.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:d.displayArea.getPositionValue(l.trasformPoints[0].y)},e=d.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:d.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:d.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=(l.drawStartPoint.selectedPrice>l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,l.minPrice=(l.drawStartPoint.selectedPrice<l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,d.addAnnotation(l),d.drawAnnotations(d.lastxRatio,d.lastDisplayFromIndex)},l.setTrasformPoints(a,n,o,r,c,u,h))},Y5.prototype.drawAnnotationFibonacciFan=function(t,e,i,a,n,o,r,l){function s(e,t,i,a,n,o){var r=(o=o||[10,0]).length;e.moveTo(t,i);for(var s=a-t+1e-8,l=(n=n-i)/s,d=Math.sqrt(s*s+n*n),c=0,h=!0;.1<=d;){var p=o[c++%r];d<p&&(p=d);var u=Math.sqrt(p*p/(1+l*l));t+=u=s<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}}function d(e,t,i,a,n){var o,r,s=c.displayArea.$annotationsCanvas.height(),l=[];return t===a&&i===n?null:(r=t===a?(o=t,i<n?s:0):(n-i)/(a-t)*((o=t<=a?e:0)-t)+i,l.push({x1:t,y1:i,x2:o,y2:r,lineType:[5,5]}),_.each([.382,.5,.618],function(e){l.push({x1:t,y1:i,x2:o,y2:r+(i-r)*e})}),l)}var c=this,h=e.offset(),p=this.$drawingCanvas.offset(),u=this.$drawingCanvas[0].getContext("2d"),m=h.left-p.left,p=h.top-p.top;t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,this.mainLines=d(e.width(),a,n,o,r),_.each(this.mainLines,function(e){t.beginPath(),e.lineType?s(t,e.x2,e.y2,e.x1,e.y1,e.lineType):(t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)),t.closePath(),t.stroke()}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,r){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+r,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+r,cursor:"move"}];var s=new Vector;s.fromPoints(e,t,i,a);s=s.findPerpendicular(2);l.boundsPoints=[{x:e+s.x+n.left,y:t+s.y+n.top,dcx:e+s.x+o,dcy:t+s.y+r},{x:i+s.x+n.left,y:a+s.y+n.top,dcx:i+s.x+o,dcy:a+s.y+r},{x:i-s.x+n.left,y:a-s.y+n.top,dcx:i-s.x+o,dcy:a-s.y+r},{x:e-s.x+n.left,y:t-s.y+n.top,dcx:e-s.x+o,dcy:t-s.y+r}]},l.isMouseOver=function(t,i){return l.isOverPoint=!1,_.each(l.trasformPoints,function(e){e.isMouseOverPoint=!1,c.isPointOverEllipse(t,i,e.x,e.y,c.transformPointRadius,c.transformPointRadius)&&(l.isOverPoint=!0,e.isMouseOverPoint=!0,l.mousePoint=e)}),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=c.isPointOverPolygon(t,i,l.boundsPoints)),l.isOverPoint||l.isOverShape},l.drawDc=function(){u.lineWidth=l.drawTool.lineThickness,u.strokeStyle=l.drawTool.lineColor,c.mainLines=d(c.$drawingCanvas.width(),l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),_.each(c.mainLines,function(e){e.lineType?(u.beginPath(),s(u,e.x2,e.y2,e.x1,e.y1,e.lineType)):(u.beginPath(),u.moveTo(e.x1,e.y1),u.lineTo(e.x2,e.y2)),u.closePath(),u.stroke()})},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),l.isOverShape&&(c.cursor="move")},l.beginTransforming=function(e,t){c.filteredAnnotations=_.without(c.filteredAnnotations,l),c.allAnnotations=_.without(c.allAnnotations,l),c.clearAnnotationsCanvas(),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",c.cursor=e.cursor):u.fillStyle="white",u.lineWidth=c.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,c.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),c.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},c.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){c.clearDrawingCanvas();var e=c.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(l.trasformPoints[0].y)},e=c.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:c.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:c.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=(l.drawStartPoint.selectedPrice>l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,l.minPrice=(l.drawStartPoint.selectedPrice<l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,c.addAnnotation(l),c.drawAnnotations(c.lastxRatio,c.lastDisplayFromIndex)},l.setTrasformPoints(a,n,o,r,h,m,p))},Y5.prototype.drawAnnotationFibonacciRetracements=function(t,e,u,i,a,n,o,l){function r(e,t,i,a,n){var o,r=[],s=i<n?i:n,l=i<n?n:i,d=t<a?t:a,n=i<=n,c=e.width(),h=e.offset(),p=[0,1];return _.each(u.options,function(e){e.selected&&p.push(e.fibNum)}),n?_.each(p,function(e){o=s+(l-s)*(1-e),r.push({x1:d,y1:o,x2:c,y2:o,value:m.displayArea.getPositionValue(o+h.top).toFixed(m.fixedSize)+" ("+(100*e).toFixed(2)+"%)"})}):_.each(p,function(e){o=s+(l-s)*e,r.push({x1:d,y1:o,x2:c,y2:o,value:m.displayArea.getPositionValue(o+h.top).toFixed(m.fixedSize)+" ("+(100*e).toFixed(2)+"%)"})}),r}var m=this,s=e.offset(),d=this.$drawingCanvas.offset(),c=this.$drawingCanvas[0].getContext("2d"),h=s.left-d.left,d=s.top-d.top;u.options||(u.options=[{fibNum:.236,name:"show23",title:"23.6%",selected:!0},{fibNum:.382,name:"show38",title:"38.2%",selected:!0},{fibNum:.5,name:"show50",title:"50%",selected:!0},{fibNum:.618,name:"show61",title:"61.8%",selected:!0},{fibNum:.786,name:"show78",title:"78.6%",selected:!1},{fibNum:1.618,name:"show161",title:"161.8%",selected:!1},{fibNum:2.618,name:"show261",title:"261.8%",selected:!1},{fibNum:4.236,name:"show423",title:"423.6%",selected:!1}]),t.lineWidth=u.lineThickness,t.strokeStyle=u.lineColor,t.beginPath(),t.moveTo(i,a),t.lineTo(n,o),t.closePath(),t.stroke(),this.mainLines=r(e,i,a,n,o),_.each(this.mainLines,function(e){t.fillStyle=t.strokeStyle,t.textBaseline="middle",t.textAlign="right",t.fillText(e.value,e.x2,e.y1-u.textSize/2-1),t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.closePath(),t.stroke()}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,r){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+r,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+r,cursor:"move"}];var s=new Vector;s.fromPoints(e,t,i,a);s=s.findPerpendicular(2);l.boundsPoints=[{x:e+s.x+n.left,y:t+s.y+n.top,dcx:e+s.x+o,dcy:t+s.y+r},{x:i+s.x+n.left,y:a+s.y+n.top,dcx:i+s.x+o,dcy:a+s.y+r},{x:i-s.x+n.left,y:a-s.y+n.top,dcx:i-s.x+o,dcy:a-s.y+r},{x:e-s.x+n.left,y:t-s.y+n.top,dcx:e-s.x+o,dcy:t-s.y+r}]},l.isMouseOver=function(t,i){return l.isOverPoint=!1,_.each(l.trasformPoints,function(e){e.isMouseOverPoint=!1,m.isPointOverEllipse(t,i,e.x,e.y,m.transformPointRadius,m.transformPointRadius)&&(l.isOverPoint=!0,e.isMouseOverPoint=!0,l.mousePoint=e)}),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=m.isPointOverPolygon(t,i,l.boundsPoints)),l.isOverPoint||l.isOverShape},l.drawDc=function(){c.lineWidth=l.drawTool.lineThickness,c.strokeStyle=l.drawTool.lineColor,m.mainLines=r(m.$drawingCanvas,l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),_.each(m.mainLines,function(e){c.fillStyle=c.strokeStyle,c.textBaseline="middle",c.textAlign="right",c.fillText(e.value,e.x2,e.y1-6),c.beginPath(),c.moveTo(e.x1,e.y1),c.lineTo(e.x2,e.y2),c.closePath(),c.stroke()}),c.beginPath(),c.moveTo(l.trasformPoints[0].dcx,l.trasformPoints[0].dcy),c.lineTo(l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),c.closePath(),c.stroke()},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",m.cursor=e.cursor):c.fillStyle="white",c.lineWidth=m.transformPointStrokeWidth,c.strokeStyle="black",c.beginPath(),c.arc(e.dcx,e.dcy,m.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),l.isOverShape&&(m.cursor="move")},l.beginTransforming=function(e,t){m.filteredAnnotations=_.without(m.filteredAnnotations,l),m.allAnnotations=_.without(m.allAnnotations,l),m.clearAnnotationsCanvas(),m.drawAnnotations(m.lastxRatio,m.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(c.fillStyle="red",m.cursor=e.cursor):c.fillStyle="white",c.beginPath(),c.arc(e.dcx,e.dcy,m.transformPointRadius,0,2*Math.PI,!1),c.closePath(),c.fill(),c.stroke()}),m.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},m.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){m.clearDrawingCanvas();var e=m.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(l.trasformPoints[0].y)},e=m.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=(l.drawStartPoint.selectedPrice>l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,l.minPrice=(l.drawStartPoint.selectedPrice<l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,m.addAnnotation(l),m.drawAnnotations(m.lastxRatio,m.lastDisplayFromIndex)},l.setTrasformPoints(i,a,n,o,s,h,d))},Y5.prototype.drawAnnotationFibonacciTimeZones=function(t,e,i,a,n,o,r,l){var s=this;void 0===l&&(l=null);function d(e,t,i,a,n,o){var r=(o=o||[10,0]).length;e.moveTo(t,i);for(var s=a-t+1e-8,l=(n=n-i)/s,d=Math.sqrt(s*s+n*n),c=0,h=!0;.1<=d;){var p=o[c++%r];d<p&&(p=d);var u=Math.sqrt(p*p/(1+l*l));t+=u=s<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}}function c(e,t,i,a){var n,o=s.displayArea.$annotationsCanvas.height(),r=[];return t===a?null:(a<t?r=[{x1:t,y1:0,x2:t,y2:o,value:0},{x1:a,y1:0,x2:a,y2:o,value:1}]:(n=a-t,_.each(g,function(e){r.push({x1:t+n*e,y1:0,x2:t+n*e,y2:o,value:e})})),r)}var h=e.offset(),p=this.$drawingCanvas.offset(),u=this.$drawingCanvas[0].getContext("2d"),m=h.left-p.left,p=h.top-p.top,g=[0,1,2,3,5,8,13,21,34,55,89,144,233,377,610,987];t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,t.beginPath(),t.moveTo(a,n),t.lineTo(o,r),t.closePath(),t.stroke(),this.mainLines=c(e.width(),a,0,o),_.each(this.mainLines,function(e){t.fillStyle=t.strokeStyle,t.textBaseline="middle",t.textAlign="right",t.fillText(e.value,e.x1-5,e.y1+i.textSize),t.beginPath(),d(t,e.x1,e.y1,e.x2,e.y2,[5,5]),t.closePath(),t.stroke()}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,r){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+r,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+r,cursor:"move"}];var s=new Vector;s.fromPoints(e,t,i,a);s=s.findPerpendicular(2);l.boundsPoints=[{x:e+s.x+n.left,y:t+s.y+n.top,dcx:e+s.x+o,dcy:t+s.y+r},{x:i+s.x+n.left,y:a+s.y+n.top,dcx:i+s.x+o,dcy:a+s.y+r},{x:i-s.x+n.left,y:a-s.y+n.top,dcx:i-s.x+o,dcy:a-s.y+r},{x:e-s.x+n.left,y:t-s.y+n.top,dcx:e-s.x+o,dcy:t-s.y+r}]},l.isMouseOver=function(t,i){return l.isOverPoint=!1,_.each(l.trasformPoints,function(e){e.isMouseOverPoint=!1,s.isPointOverEllipse(t,i,e.x,e.y,s.transformPointRadius,s.transformPointRadius)&&(l.isOverPoint=!0,e.isMouseOverPoint=!0,l.mousePoint=e)}),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=s.isPointOverPolygon(t,i,l.boundsPoints)),l.isOverPoint||l.isOverShape},l.drawDc=function(){u.lineWidth=l.drawTool.lineThickness,u.strokeStyle=l.drawTool.lineColor,s.mainLines=c(s.$drawingCanvas.width(),l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx),_.each(s.mainLines,function(e){u.fillStyle=u.strokeStyle,u.textBaseline="middle",u.textAlign="right",u.fillText(e.value,e.x1-5,e.y1+i.textSize),u.beginPath(),d(u,e.x1,e.y1,e.x2,e.y2,[5,5]),u.closePath(),u.stroke()}),u.beginPath(),u.moveTo(l.trasformPoints[0].dcx,l.trasformPoints[0].dcy),u.lineTo(l.trasformPoints[1].dcx,l.trasformPoints[1].dcy),u.closePath(),u.stroke()},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",s.cursor=e.cursor):u.fillStyle="white",u.lineWidth=s.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,s.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),l.isOverShape&&(s.cursor="move")},l.beginTransforming=function(e,t){s.filteredAnnotations=_.without(s.filteredAnnotations,l),s.allAnnotations=_.without(s.allAnnotations,l),s.clearAnnotationsCanvas(),s.drawAnnotations(s.lastxRatio,s.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",s.cursor=e.cursor):u.fillStyle="white",u.lineWidth=s.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,s.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),s.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},s.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){s.clearDrawingCanvas();var e=s.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:s.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:s.displayArea.getPositionValue(l.trasformPoints[0].y)},e=s.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:s.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:s.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=(l.drawStartPoint.selectedPrice>l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,l.minPrice=(l.drawStartPoint.selectedPrice<l.drawEndPoint.selectedPrice?l.drawStartPoint:l.drawEndPoint).selectedPrice,s.addAnnotation(l),s.drawAnnotations(s.lastxRatio,s.lastDisplayFromIndex)},l.setTrasformPoints(a,n,o,r,h,m,p))},Y5.prototype.drawAnnotationGannBox=function(e,t,i,a,n,o,r,s){var l=this;void 0===s&&(s=null);var d,c,h,p,u,m=t.offset(),g=this.$drawingCanvas.offset(),f=this.$drawingCanvas[0].getContext("2d"),t=m.left-g.left,g=m.top-g.top,y=((p=r<n?n:r)-(h=r<n?r:n))/2,D=(u=((c=o<a?a:o)-(d=o<a?o:a))/2)/2;e.lineWidth=i.lineThickness,e.strokeStyle=i.lineColor,e.beginPath(),e.moveTo(d,h),e.lineTo(c,h),e.lineTo(c,p),e.lineTo(d,p),e.lineTo(d,h),e.moveTo(d,h),e.lineTo(c,p),e.moveTo(c,h),e.lineTo(d,p),e.moveTo(d+u,h),e.lineTo(c,h+y),e.lineTo(d+u,p),e.lineTo(d,h+y),e.lineTo(d+u,h),e.lineTo(c,p),e.lineTo(d,h+y),e.lineTo(c,h),e.lineTo(c-D,p),e.lineTo(d+u,h),e.lineTo(d+D,p),e.lineTo(d,h),e.lineTo(c,h+y),e.lineTo(d,p),e.lineTo(d+D,h),e.lineTo(d+u,p),e.lineTo(c-D,h),e.lineTo(c,p),e.moveTo(c,h),e.lineTo(d+u,p),e.moveTo(d,h),e.lineTo(d+u,p),e.moveTo(d,p),e.lineTo(d+u,h),e.stroke(),s&&(s.setTrasformPoints=function(e,t,i,a,n,o,r){s.trasformPoints=[{x:t+n.left,y:e+n.top,dcx:t+o,dcy:e+r,cursor:"se-resize"},{x:i+n.left,y:e+n.top,dcx:i+o,dcy:e+r,cursor:"sw-resize"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+r,cursor:"se-resize"},{x:t+n.left,y:a+n.top,dcx:t+o,dcy:a+r,cursor:"sw-resize"}],s.trasformPoints[0].connectedX=s.trasformPoints[3],s.trasformPoints[0].connectedY=s.trasformPoints[1],s.trasformPoints[1].connectedX=s.trasformPoints[2],s.trasformPoints[1].connectedY=s.trasformPoints[0],s.trasformPoints[2].connectedX=s.trasformPoints[1],s.trasformPoints[2].connectedY=s.trasformPoints[3],s.trasformPoints[3].connectedX=s.trasformPoints[0],s.trasformPoints[3].connectedY=s.trasformPoints[2]},s.isMouseOver=function(t,i){return s.isOverPoint=!1,_.each(s.trasformPoints,function(e){e.isMouseOverPoint=!1,l.isPointOverEllipse(t,i,e.x,e.y,l.transformPointRadius,l.transformPointRadius)&&(s.isOverPoint=!0,e.isMouseOverPoint=!0,s.mousePoint=e)}),s.isOverShape=!1,s.isOverPoint||(s.isOverShape=l.isPointOverPolygon(t,i,s.trasformPoints)),s.isOverPoint||s.isOverShape},s.drawDc=function(){f.lineWidth=s.drawTool.lineThickness,f.strokeStyle=s.drawTool.lineColor,d=Math.min(s.trasformPoints[0].dcx,s.trasformPoints[1].dcx,s.trasformPoints[2].dcx,s.trasformPoints[3].dcx),c=Math.max(s.trasformPoints[0].dcx,s.trasformPoints[1].dcx,s.trasformPoints[2].dcx,s.trasformPoints[3].dcx),h=Math.min(s.trasformPoints[0].dcy,s.trasformPoints[1].dcy,s.trasformPoints[2].dcy,s.trasformPoints[3].dcy),p=Math.max(s.trasformPoints[0].dcy,s.trasformPoints[1].dcy,s.trasformPoints[2].dcy,s.trasformPoints[3].dcy),y=(p-h)/2,D=(u=(c-d)/2)/2,f.beginPath(),f.moveTo(d,h),f.lineTo(c,h),f.lineTo(c,p),f.lineTo(d,p),f.lineTo(d,h),f.moveTo(d,h),f.lineTo(c,p),f.moveTo(c,h),f.lineTo(d,p),f.moveTo(d+u,h),f.lineTo(c,h+y),f.lineTo(d+u,p),f.lineTo(d,h+y),f.lineTo(d+u,h),f.lineTo(c,p),f.lineTo(d,h+y),f.lineTo(c,h),f.lineTo(c-D,p),f.lineTo(d+u,h),f.lineTo(d+D,p),f.lineTo(d,h),f.lineTo(c,h+y),f.lineTo(d,p),f.lineTo(d+D,h),f.lineTo(d+u,p),f.lineTo(c-D,h),f.lineTo(c,p),f.moveTo(c,h),f.lineTo(d+u,p),f.moveTo(d,h),f.lineTo(d+u,p),f.moveTo(d,p),f.lineTo(d+u,h),f.stroke()},s.highlight=function(){_.each(s.trasformPoints,function(e){e.isMouseOverPoint?(f.fillStyle="red",l.cursor=e.cursor):f.fillStyle="white",f.lineWidth=l.transformPointStrokeWidth,f.strokeStyle="black",f.beginPath(),f.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),f.closePath(),f.fill(),f.stroke()}),s.isOverShape&&(l.cursor="move")},s.beginTransforming=function(e,t){l.filteredAnnotations=_.without(l.filteredAnnotations,s),l.allAnnotations=_.without(l.allAnnotations,s),l.clearAnnotationsCanvas(),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex),s.drawDc(),s.movePoint={x:e,y:t},s.isOverPoint&&(_.each(s.trasformPoints,function(e){e.isMouseOverPoint?(f.fillStyle="red",l.cursor=e.cursor):f.fillStyle="white",f.lineWidth=l.transformPointStrokeWidth,f.strokeStyle="black",f.beginPath(),f.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),f.closePath(),f.fill(),f.stroke()}),l.showCrosshair=!0)},s.transform=function(e,t){var i=e-s.movePoint.x,a=t-s.movePoint.y;s.movePoint={x:e,y:t},l.clearDrawingCanvas(),s.isOverPoint?(s.mousePoint.x+=i,s.mousePoint.y+=a,s.mousePoint.dcx+=i,s.mousePoint.dcy+=a,s.mousePoint.connectedX.x+=i,s.mousePoint.connectedX.dcx+=i,s.mousePoint.connectedY.y+=a,s.mousePoint.connectedY.dcy+=a):s.isOverShape&&_.each(s.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),s.drawDc()},s.finishTransforming=function(){l.clearDrawingCanvas(),d=Math.min(s.trasformPoints[0].x,s.trasformPoints[1].x,s.trasformPoints[2].x,s.trasformPoints[3].x),c=Math.max(s.trasformPoints[0].x,s.trasformPoints[1].x,s.trasformPoints[2].x,s.trasformPoints[3].x),h=Math.min(s.trasformPoints[0].y,s.trasformPoints[1].y,s.trasformPoints[2].y,s.trasformPoints[3].y),p=Math.max(s.trasformPoints[0].y,s.trasformPoints[1].y,s.trasformPoints[2].y,s.trasformPoints[3].y);var e=l.displayArea.getPositionIndex(d);s.drawStartPoint={x:d,y:h,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(h)},e=l.displayArea.getPositionIndex(s.trasformPoints[1].x),s.drawEndPoint={x:c,y:p,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(p)},s.maxPrice=(s.drawStartPoint.selectedPrice>s.drawEndPoint.selectedPrice?s.drawStartPoint:s.drawEndPoint).selectedPrice,s.minPrice=(s.drawStartPoint.selectedPrice<s.drawEndPoint.selectedPrice?s.drawStartPoint:s.drawEndPoint).selectedPrice,l.addAnnotation(s),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex)},s.setTrasformPoints(h,d,c,p,m,t,g))},Y5.prototype.drawAnnotationGannFan=function(t,i,e,a,n,o,r,l){var s=this;void 0===l&&(l=null);function d(e,t,i,a,n,o){var r=(o=o||[10,0]).length;e.moveTo(t,i);for(var s=a-t+1e-8,l=(n=n-i)/s,d=Math.sqrt(s*s+n*n),c=0,h=!0;.1<=d;){var p=o[c++%r];d<p&&(p=d);var u=Math.sqrt(p*p/(1+l*l));t+=u=s<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}}function c(t,i,a,n,o){var r,s,l,d,c,h,p=[],u=[];return i===n&&a===o?null:(h=i===n?(c=i,a<o?f:0):(o-a)/(n-i)*((c=i<=n?t:0)-i)+a,p.push({x1:i,y1:a,x2:c,y2:h,lineType:[5,5]}),u=[.5,2],_.each(e.options,function(e){e.selected&&(u=u.concat(e.angles))}),_.each(u,function(e){r=Math.atan(e)-Math.PI/4,s=n-i,d=o-a,l=Math.cos(r)*s-Math.sin(r)*d,d=Math.sin(r)*s+Math.cos(r)*d,d=d+a,c=i<=(l=l+i)?t:0,h=l-i==0?0:(d-a)/(l-i)*(c-i)+a,p.push({x1:i,y1:a,x2:c,y2:h})}),p)}var h=i.offset(),p=this.$drawingCanvas.offset(),u=this.$drawingCanvas[0].getContext("2d"),m=h.left-p.left,g=h.top-p.top,f=this.displayArea.$annotationsCanvas.height();e.options||(e.options=[{angles:[3,1/3],name:"show3",title:"3x1, 1x3",selected:!0},{angles:[4,.25],name:"show4",title:"4x1, 1x4",selected:!0},{angles:[8,1/8],name:"show8",title:"8x1, 1x8",selected:!0},{angles:[16,1/16],name:"show16",title:"16x1, 1x16",selected:!1}]),t.lineWidth=e.lineThickness,t.strokeStyle=e.lineColor;p=i.width(),p=c(p,a,n,o,r);_.each(p,function(e){t.beginPath(),e.lineType?d(t,e.x1,e.y1,e.x2,e.y2,e.lineType):(t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2)),t.closePath(),t.stroke()}),l&&(l.setTrasformPoints=function(e,t,i,a,n,o,r){l.trasformPoints=[{x:e+n.left,y:t+n.top,dcx:e+o,dcy:t+r,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+r,cursor:"move"}];var s=new Vector;s.fromPoints(e,t,i,a);s=s.findPerpendicular(2);l.boundsPoints=[{x:e+s.x+n.left,y:t+s.y+n.top,dcx:e+s.x+o,dcy:t+s.y+r},{x:i+s.x+n.left,y:a+s.y+n.top,dcx:i+s.x+o,dcy:a+s.y+r},{x:i-s.x+n.left,y:a-s.y+n.top,dcx:i-s.x+o,dcy:a-s.y+r},{x:e-s.x+n.left,y:t-s.y+n.top,dcx:e-s.x+o,dcy:t-s.y+r}]},l.isMouseOver=function(e,t){return l.isOverPoint=!1,l.trasformPoints[1].isMouseOverPoint=!1,s.isPointOverEllipse(e,t,l.trasformPoints[1].x,l.trasformPoints[1].y,s.transformPointRadius,s.transformPointRadius)&&(l.isOverPoint=!0,l.trasformPoints[1].isMouseOverPoint=!0,l.mousePoint=l.trasformPoints[1]),l.isOverShape=!1,l.isOverPoint||(l.isOverShape=s.isPointOverPolygon(e,t,l.boundsPoints)||s.isPointOverEllipse(e,t,l.trasformPoints[0].x,l.trasformPoints[0].y,s.transformPointRadius,s.transformPointRadius)),l.isOverPoint||l.isOverShape},l.drawDc=function(){u.lineWidth=l.drawTool.lineThickness,u.strokeStyle=l.drawTool.lineColor;var e=i.width(),e=c(e,l.trasformPoints[0].dcx,l.trasformPoints[0].dcy,l.trasformPoints[1].dcx,l.trasformPoints[1].dcy);_.each(e,function(e){u.beginPath(),e.lineType?d(u,e.x1,e.y1,e.x2,e.y2,e.lineType):(u.moveTo(e.x1,e.y1),u.lineTo(e.x2,e.y2)),u.closePath(),u.stroke()})},l.highlight=function(){_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",s.cursor=e.cursor):u.fillStyle="white",u.lineWidth=s.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,s.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),l.isOverShape&&(s.cursor="move")},l.beginTransforming=function(e,t){s.filteredAnnotations=_.without(s.filteredAnnotations,l),s.allAnnotations=_.without(s.allAnnotations,l),s.clearAnnotationsCanvas(),s.drawAnnotations(s.lastxRatio,s.lastDisplayFromIndex),l.drawDc(),l.movePoint={x:e,y:t},l.isOverPoint&&(_.each(l.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",s.cursor=e.cursor):u.fillStyle="white",u.lineWidth=s.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,s.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),s.showCrosshair=!0)},l.transform=function(e,t){var i=e-l.movePoint.x,a=t-l.movePoint.y;l.movePoint={x:e,y:t},s.clearDrawingCanvas(),l.isOverPoint?(l.mousePoint.x+=i,l.mousePoint.y+=a,l.mousePoint.dcx+=i,l.mousePoint.dcy+=a):l.isOverShape&&_.each(l.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),l.drawDc()},l.finishTransforming=function(){s.clearDrawingCanvas();var e=s.displayArea.getPositionIndex(l.trasformPoints[0].x);l.drawStartPoint={x:l.trasformPoints[0].x,y:l.trasformPoints[0].y,selectedItem:s.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:s.displayArea.getPositionValue(l.trasformPoints[0].y)},e=s.displayArea.getPositionIndex(l.trasformPoints[1].x),l.drawEndPoint={x:l.trasformPoints[1].x,y:l.trasformPoints[1].y,selectedItem:s.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:s.displayArea.getPositionValue(l.trasformPoints[1].y)},l.maxPrice=l.drawStartPoint.selectedPrice,l.minPrice=l.drawStartPoint.selectedPrice,s.addAnnotation(l),s.drawAnnotations(s.lastxRatio,s.lastDisplayFromIndex)},l.setTrasformPoints(a,n,o,r,h,m,g))},Y5.prototype.drawAnnotationLine=function(e,t,n,i,a,o,r,c){var s=this;void 0===c&&(c=null);function l(e,t,i,a,n,o){var r=(o=o||[10,0]).length;e.moveTo(t,i);for(var s=a-t+1e-8,l=(n=n-i)/s,d=Math.sqrt(s*s+n*n),c=0,h=!0;.1<=d;){var p=o[c++%r];d<p&&(p=d);var u=Math.sqrt(p*p/(1+l*l));t+=u=s<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}}function d(e,t,i,a,n){var o,r,s,l=i<e&&a<t||i<e&&t<a?(o=i,r=e,s=a,t):(o=e,r=i,s=t,a),d=r-o==0?1:(l-s)/(r-o);switch(n){case"future":return[{x:i,y:a},{x:r=e===i?e:f,y:l=1===d?y:s+d*(r-o)}];case"past":return e===i?r=e:o=0,[{x:o,y:s=1===d?0:l-d*(r-o)},{x:e,y:t}];default:return QuickBase.Log.Error("extend - direction not supported"),[]}}var h=t.offset(),p=this.$drawingCanvas.offset(),u=this.$drawingCanvas[0].getContext("2d"),m=h.left-p.left,g=h.top-p.top,f=t.width(),y=this.displayArea.$annotationsCanvas.height(),D=[],C={},p={};e.lineWidth=n.lineThickness,e.strokeStyle=n.lineColor;t=e.font;e.font=n.textSize+"px Arial",e.fillStyle=e.strokeStyle,e.textBaseline="middle",e.textAlign="right",e.beginPath(),c&&c.extendPast&&(D=d(i,a,o,r,"past"),n.lineType?l(e,D[0].x,D[0].y,D[1].x,D[1].y,n.lineType):(e.moveTo(D[0].x,D[0].y),e.lineTo(D[1].x,D[1].y)),C=_.minBy(D,function(e){return i===o?-e.y:e.x})),0<D.length&&D[0].y===y&&"vertical-line"===n.tool&&this.displayArea.getPositionDate(i+h.left)&&e.fillText(this.displayArea.getPositionDate(i+h.left)[0].format("d mmm yyyy HH:MM"),i-2,y-n.textSize/2-1),n.lineType?l(e,i,a,o,r,n.lineType):(e.moveTo(i,a),e.lineTo(o,r)),c&&c.extendFuture&&(D=d(i,a,o,r,"future"),n.lineType?l(e,D[0].x,D[0].y,D[1].x,D[1].y,n.lineType):(e.moveTo(D[0].x,D[0].y),e.lineTo(D[1].x,D[1].y)),p=_.maxBy(D,function(e){return i===o?-e.y:e.x})),e.closePath(),e.stroke(),0<D.length&&D[1].x===f&&"horizontal-line"===n.tool&&e.fillText(this.displayArea.getPositionValue(a+h.top).toFixed(this.fixedSize),f-1,a-n.textSize/2-1),e.font=t,c&&(c.setTrasformPoints=function(t,e,i,a,n,o,r,s,l){var d=[];c.trasformPoints=[{x:t+n.left,y:e+n.top,dcx:t+o,dcy:e+r,cursor:"move"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+r,cursor:"move"}];d=[{x:t,y:e},{x:i,y:a},{x:s.x,y:s.y},{x:l.x,y:l.y}],s=_.minBy(d,function(e){return t===i?e.y:e.x}),l=_.maxBy(_.without(d,s),function(e){return t===i?e.y:e.x}),d=new Vector;d.fromPoints(s.x,s.y,l.x,l.y);d=d.findPerpendicular(6);c.boundsPoints=[{x:s.x+d.x+n.left,y:s.y+d.y+n.top,dcx:s.x+d.x+o,dcy:s.y+d.y+r},{x:l.x+d.x+n.left,y:l.y+d.y+n.top,dcx:l.x+d.x+o,dcy:l.y+d.y+r},{x:l.x-d.x+n.left,y:l.y-d.y+n.top,dcx:l.x-d.x+o,dcy:l.y-d.y+r},{x:s.x-d.x+n.left,y:s.y-d.y+n.top,dcx:s.x-d.x+o,dcy:s.y-d.y+r}]},c.isMouseOver=function(t,i){return c.isOverPoint=!1,_.each(c.trasformPoints,function(e){e.isMouseOverPoint=!1,s.isPointOverEllipse(t,i,e.x,e.y,s.transformPointRadius,s.transformPointRadius)&&(c.isOverPoint=!0,e.isMouseOverPoint=!0,c.mousePoint=e)}),c.isOverShape=!1,c.isOverPoint||(c.isOverShape=s.isPointOverPolygon(t,i,c.boundsPoints)),c.isOverPoint||c.isOverShape},c.drawDc=function(){u.lineWidth=c.drawTool.lineThickness,u.strokeStyle=c.drawTool.lineColor,u.beginPath(),c.extendPast&&(D=d(c.trasformPoints[0].dcx,c.trasformPoints[0].dcy,c.trasformPoints[1].dcx,c.trasformPoints[1].dcy,"past"),n.lineType?l(u,D[0].x,D[0].y,D[1].x,D[1].y,n.lineType):(u.moveTo(D[0].x,D[0].y),u.lineTo(D[1].x,D[1].y))),n.lineType?l(u,c.trasformPoints[0].dcx,c.trasformPoints[0].dcy,c.trasformPoints[1].dcx,c.trasformPoints[1].dcy,n.lineType):(u.moveTo(c.trasformPoints[0].dcx,c.trasformPoints[0].dcy),u.lineTo(c.trasformPoints[1].dcx,c.trasformPoints[1].dcy)),c.extendFuture&&(D=d(c.trasformPoints[0].dcx,c.trasformPoints[0].dcy,c.trasformPoints[1].dcx,c.trasformPoints[1].dcy,"future"),n.lineType?l(u,D[0].x,D[0].y,D[1].x,D[1].y,n.lineType):(u.moveTo(D[0].x,D[0].y),u.lineTo(D[1].x,D[1].y))),u.closePath(),u.stroke()},c.highlight=function(){_.each(c.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",s.cursor=e.cursor):u.fillStyle="white",u.lineWidth=s.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,s.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),c.isOverShape&&(s.cursor="move")},c.beginTransforming=function(e,t){s.filteredAnnotations=_.without(s.filteredAnnotations,c),s.allAnnotations=_.without(s.allAnnotations,c),s.clearAnnotationsCanvas(),s.drawAnnotations(s.lastxRatio,s.lastDisplayFromIndex),c.drawDc(),c.movePoint={x:e,y:t},c.isOverPoint&&(_.each(c.trasformPoints,function(e){e.isMouseOverPoint?(u.fillStyle="red",s.cursor=e.cursor):u.fillStyle="white",u.lineWidth=s.transformPointStrokeWidth,u.strokeStyle="black",u.beginPath(),u.arc(e.dcx,e.dcy,s.transformPointRadius,0,2*Math.PI,!1),u.closePath(),u.fill(),u.stroke()}),s.showCrosshair=!0)},c.transform=function(e,t){var i=e-c.movePoint.x,a=t-c.movePoint.y;if(c.movePoint={x:e,y:t},s.clearDrawingCanvas(),c.isOverPoint)switch(n.tool){case"trend-line":c.mousePoint.x+=i,c.mousePoint.y+=a,c.mousePoint.dcx+=i,c.mousePoint.dcy+=a;break;case"horizontal-line":c.mousePoint.x+=i,c.mousePoint.dcx+=i;break;case"vertical-line":c.mousePoint.y+=a,c.mousePoint.dcy+=a;break;default:QuickBase.Log.Error("drawing tool not supported")}else c.isOverShape&&_.each(c.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a});c.drawDc()},c.finishTransforming=function(){s.clearDrawingCanvas();var e=s.displayArea.getPositionIndex(c.trasformPoints[0].x);c.drawStartPoint={x:c.trasformPoints[0].x,y:c.trasformPoints[0].y,selectedItem:s.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:s.displayArea.getPositionValue(c.trasformPoints[0].y)},e=s.displayArea.getPositionIndex(c.trasformPoints[1].x),c.drawEndPoint={x:c.trasformPoints[1].x,y:c.trasformPoints[1].y,selectedItem:s.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:s.displayArea.getPositionValue(c.trasformPoints[1].y)},c.maxPrice=(c.drawStartPoint.selectedPrice>c.drawEndPoint.selectedPrice?c.drawStartPoint:c.drawEndPoint).selectedPrice,c.minPrice=(c.drawStartPoint.selectedPrice<c.drawEndPoint.selectedPrice?c.drawStartPoint:c.drawEndPoint).selectedPrice,s.addAnnotation(c),s.drawAnnotations(s.lastxRatio,s.lastDisplayFromIndex)},c.setTrasformPoints(i,a,o,r,h,m,g,C,p))},Y5.prototype.drawAnnotationRectangle=function(e,t,i,a,n,o,r,s){var l=this;void 0===s&&(s=null);var d=t.offset(),c=this.$drawingCanvas.offset(),h=this.$drawingCanvas[0].getContext("2d"),t=d.left-c.left,c=d.top-c.top,p=o<a?o:a,u=o<a?a:o,m=r<n?r:n,g=r<n?n:r;e.lineWidth=i.lineThickness,e.strokeStyle=i.lineColor,e.fillStyle=i.fillColor,e.beginPath(),e.moveTo(p,m),e.lineTo(u,m),e.lineTo(u,g),e.lineTo(p,g),e.lineTo(p,m),e.closePath(),e.fill(),e.stroke(),s&&(s.setTrasformPoints=function(e,t,i,a,n,o,r){s.trasformPoints=[{x:t+n.left,y:e+n.top,dcx:t+o,dcy:e+r,cursor:"se-resize"},{x:i+n.left,y:e+n.top,dcx:i+o,dcy:e+r,cursor:"sw-resize"},{x:i+n.left,y:a+n.top,dcx:i+o,dcy:a+r,cursor:"se-resize"},{x:t+n.left,y:a+n.top,dcx:t+o,dcy:a+r,cursor:"sw-resize"}],s.trasformPoints[0].connectedX=s.trasformPoints[3],s.trasformPoints[0].connectedY=s.trasformPoints[1],s.trasformPoints[1].connectedX=s.trasformPoints[2],s.trasformPoints[1].connectedY=s.trasformPoints[0],s.trasformPoints[2].connectedX=s.trasformPoints[1],s.trasformPoints[2].connectedY=s.trasformPoints[3],s.trasformPoints[3].connectedX=s.trasformPoints[0],s.trasformPoints[3].connectedY=s.trasformPoints[2]},s.isMouseOver=function(t,i){return s.isOverPoint=!1,_.each(s.trasformPoints,function(e){e.isMouseOverPoint=!1,l.isPointOverEllipse(t,i,e.x,e.y,l.transformPointRadius,l.transformPointRadius)&&(s.isOverPoint=!0,e.isMouseOverPoint=!0,s.mousePoint=e)}),s.isOverShape=!1,s.isOverPoint||(s.isOverShape=l.isPointOverPolygon(t,i,s.trasformPoints)),s.isOverPoint||s.isOverShape},s.drawDc=function(){h.lineWidth=s.drawTool.lineThickness,h.strokeStyle=s.drawTool.lineColor,h.fillStyle=s.drawTool.fillColor,p=Math.min(s.trasformPoints[0].dcx,s.trasformPoints[1].dcx,s.trasformPoints[2].dcx,s.trasformPoints[3].dcx),u=Math.max(s.trasformPoints[0].dcx,s.trasformPoints[1].dcx,s.trasformPoints[2].dcx,s.trasformPoints[3].dcx),m=Math.min(s.trasformPoints[0].dcy,s.trasformPoints[1].dcy,s.trasformPoints[2].dcy,s.trasformPoints[3].dcy),g=Math.max(s.trasformPoints[0].dcy,s.trasformPoints[1].dcy,s.trasformPoints[2].dcy,s.trasformPoints[3].dcy),h.beginPath(),h.moveTo(p,m),h.lineTo(u,m),h.lineTo(u,g),h.lineTo(p,g),h.lineTo(p,m),h.closePath(),h.fill(),h.stroke()},s.highlight=function(){_.each(s.trasformPoints,function(e){e.isMouseOverPoint?(h.fillStyle="red",l.cursor=e.cursor):h.fillStyle="white",h.lineWidth=l.transformPointStrokeWidth,h.strokeStyle="black",h.beginPath(),h.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),h.closePath(),h.fill(),h.stroke()}),s.isOverShape&&(l.cursor="move")},s.beginTransforming=function(e,t){l.filteredAnnotations=_.without(l.filteredAnnotations,s),l.allAnnotations=_.without(l.allAnnotations,s),l.clearAnnotationsCanvas(),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex),s.drawDc(),s.movePoint={x:e,y:t},s.isOverPoint&&(_.each(s.trasformPoints,function(e){e.isMouseOverPoint?(h.fillStyle="red",l.cursor=e.cursor):h.fillStyle="white",h.lineWidth=l.transformPointStrokeWidth,h.strokeStyle="black",h.beginPath(),h.arc(e.dcx,e.dcy,l.transformPointRadius,0,2*Math.PI,!1),h.closePath(),h.fill(),h.stroke()}),l.showCrosshair=!0)},s.transform=function(e,t){var i=e-s.movePoint.x,a=t-s.movePoint.y;s.movePoint={x:e,y:t},l.clearDrawingCanvas(),s.isOverPoint?(s.mousePoint.x+=i,s.mousePoint.y+=a,s.mousePoint.dcx+=i,s.mousePoint.dcy+=a,s.mousePoint.connectedX.x+=i,s.mousePoint.connectedX.dcx+=i,s.mousePoint.connectedY.y+=a,s.mousePoint.connectedY.dcy+=a):s.isOverShape&&_.each(s.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),s.drawDc()},s.finishTransforming=function(){l.clearDrawingCanvas(),p=Math.min(s.trasformPoints[0].x,s.trasformPoints[1].x,s.trasformPoints[2].x,s.trasformPoints[3].x),u=Math.max(s.trasformPoints[0].x,s.trasformPoints[1].x,s.trasformPoints[2].x,s.trasformPoints[3].x),m=Math.min(s.trasformPoints[0].y,s.trasformPoints[1].y,s.trasformPoints[2].y,s.trasformPoints[3].y),g=Math.max(s.trasformPoints[0].y,s.trasformPoints[1].y,s.trasformPoints[2].y,s.trasformPoints[3].y);var e=l.displayArea.getPositionIndex(p);s.drawStartPoint={x:p,y:m,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(m)},e=l.displayArea.getPositionIndex(s.trasformPoints[1].x),s.drawEndPoint={x:u,y:g,selectedItem:l.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:l.displayArea.getPositionValue(g)},s.maxPrice=(s.drawStartPoint.selectedPrice>s.drawEndPoint.selectedPrice?s.drawStartPoint:s.drawEndPoint).selectedPrice,s.minPrice=(s.drawStartPoint.selectedPrice<s.drawEndPoint.selectedPrice?s.drawStartPoint:s.drawEndPoint).selectedPrice,l.addAnnotation(s),l.drawAnnotations(l.lastxRatio,l.lastDisplayFromIndex)},s.setTrasformPoints(m,p,u,g,d,t,c))},Y5.prototype.drawAnnotationRotationRectangle=function(e,t,i,a,n,o,r,d){var s=this;void 0===d&&(d=null);var l=t.offset(),c=this.$drawingCanvas.offset(),h=this.$drawingCanvas[0].getContext("2d"),p=l.left-c.left,u=l.top-c.top,t=new Vector;t.fromPoints(a,n,o,r);var c=d&&d.currentHeight||50,c=t.findPerpendicular(c/2),m=[{x:a+c.x+l.left,y:n+c.y+l.top,dcx:a+c.x+p,dcy:n+c.y+u},{x:o+c.x+l.left,y:r+c.y+l.top,dcx:o+c.x+p,dcy:r+c.y+u},{x:o-c.x+l.left,y:r-c.y+l.top,dcx:o-c.x+p,dcy:r-c.y+u},{x:a-c.x+l.left,y:n-c.y+l.top,dcx:a-c.x+p,dcy:n-c.y+u}];e.lineWidth=i.lineThickness,e.strokeStyle=i.lineColor,e.fillStyle=i.fillColor,e.beginPath(),e.moveTo(m[0].x-l.left,m[0].y-l.top),e.lineTo(m[1].x-l.left,m[1].y-l.top),e.lineTo(m[2].x-l.left,m[2].y-l.top),e.lineTo(m[3].x-l.left,m[3].y-l.top),e.lineTo(m[0].x-l.left,m[0].y-l.top),e.closePath(),e.fill(),e.stroke(),d&&(d.isMouseOver=function(t,i){return d.isOverPoint=!1,_.each(d.trasformPoints,function(e){e.isMouseOverPoint=!1,s.isPointOverEllipse(t,i,e.x,e.y,s.transformPointRadius,s.transformPointRadius)&&(d.isOverPoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverShape=!1,d.isOverPoint||(d.isOverShape=s.isPointOverPolygon(t,i,m)),d.isOverPoint||d.isOverShape},d.drawDc=function(){h.lineWidth=d.drawTool.lineThickness,h.strokeStyle=d.drawTool.lineColor,h.fillStyle=d.drawTool.fillColor,h.beginPath(),h.moveTo(d.boundsPoints[0].dcx,d.boundsPoints[0].dcy),h.lineTo(d.boundsPoints[1].dcx,d.boundsPoints[1].dcy),h.lineTo(d.boundsPoints[2].dcx,d.boundsPoints[2].dcy),h.lineTo(d.boundsPoints[3].dcx,d.boundsPoints[3].dcy),h.lineTo(d.boundsPoints[0].dcx,d.boundsPoints[0].dcy),h.closePath(),h.fill(),h.stroke()},d.updatePoints=function(e,t,i,a,n,o){var r=new Vector;r.fromPoints(e.x,e.y,t.x,t.y);var s=r.findPerpendicular(i/2),l=e.x+(t.x-e.x)/2,r=e.y+(t.y-e.y)/2;d.currentHeight=i,d.boundsPoints=[{x:e.x+s.x+a.left,y:e.y+s.y+a.top,dcx:e.x+s.x+n,dcy:e.y+s.y+o},{x:t.x+s.x+a.left,y:t.y+s.y+a.top,dcx:t.x+s.x+n,dcy:t.y+s.y+o},{x:t.x-s.x+a.left,y:t.y-s.y+a.top,dcx:t.x-s.x+n,dcy:t.y-s.y+o},{x:e.x-s.x+a.left,y:e.y-s.y+a.top,dcx:e.x-s.x+n,dcy:e.y-s.y+o}],d.trasformPoints=[{x:e.x+a.left,y:e.y+a.top,dcx:e.x+n,dcy:e.y+o,cursor:"move",action:"angle"},{x:t.x+a.left,y:t.y+a.top,dcx:t.x+n,dcy:t.y+o,cursor:"move",action:"angle"},{x:l+a.left-s.x,y:r+a.top-s.y,dcx:l-s.x+n,dcy:r-s.y+o,cursor:"move",action:"resize"},{x:l+a.left+s.x,y:r+a.top+s.y,dcx:l+s.x+n,dcy:r+s.y+o,cursor:"move",action:"resize"}],d.trasformPoints[0].pair=d.trasformPoints[1],d.trasformPoints[1].pair=d.trasformPoints[0],d.trasformPoints[2].pair=d.trasformPoints[3],d.trasformPoints[3].pair=d.trasformPoints[2]},d.highlight=function(){_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(h.fillStyle="red",s.cursor=e.cursor):h.fillStyle="white",h.lineWidth=s.transformPointStrokeWidth,h.strokeStyle="black",h.beginPath(),h.arc(e.dcx,e.dcy,s.transformPointRadius,0,2*Math.PI,!1),h.closePath(),h.fill(),h.stroke()}),d.isOverShape&&(s.cursor="move")},d.beginTransforming=function(e,t){s.filteredAnnotations=_.without(s.filteredAnnotations,d),s.allAnnotations=_.without(s.allAnnotations,d),s.clearAnnotationsCanvas(),s.drawAnnotations(s.lastxRatio,s.lastDisplayFromIndex),d.drawDc(),d.movePoint={x:e,y:t},d.isOverPoint&&(_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(h.fillStyle="red",s.cursor=e.cursor):h.fillStyle="white",h.lineWidth=s.transformPointStrokeWidth,h.strokeStyle="black",h.beginPath(),h.arc(e.dcx,e.dcy,s.transformPointRadius,0,2*Math.PI,!1),h.closePath(),h.fill(),h.stroke()}),s.showCrosshair=!0)},d.transform=function(e,t){var i=e-d.movePoint.x,a=t-d.movePoint.y;d.movePoint={x:e,y:t},s.clearDrawingCanvas(),d.isOverPoint?"resize"===d.mousePoint.action?((t=new Vector).fromPoints(d.mousePoint.pair.x,d.mousePoint.pair.y,d.movePoint.x,d.movePoint.y),t=t.magnitude(t.x,t.y),d.updatePoints({x:d.trasformPoints[0].x-l.left,y:d.trasformPoints[0].y-l.top},{x:d.trasformPoints[1].x-l.left,y:d.trasformPoints[1].y-l.top},t,l,p,u)):"angle"===d.mousePoint.action&&d.updatePoints({x:d.mousePoint.pair.x-l.left,y:d.mousePoint.pair.y-l.top},{x:d.movePoint.x-l.left,y:d.movePoint.y-l.top},d.currentHeight||50,l,p,u):d.isOverShape&&(_.each(d.boundsPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),_.each(d.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a})),d.drawDc()},d.finishTransforming=function(){s.clearDrawingCanvas();var e=s.displayArea.getPositionIndex(d.trasformPoints[0].x);d.drawStartPoint={x:d.trasformPoints[0].x,y:d.trasformPoints[0].y,selectedItem:s.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:s.displayArea.getPositionValue(d.trasformPoints[0].y)},e=s.displayArea.getPositionIndex(d.trasformPoints[1].x),d.drawEndPoint={x:d.trasformPoints[1].x,y:d.trasformPoints[1].x,selectedItem:s.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:s.displayArea.getPositionValue(d.trasformPoints[1].y)},d.maxPrice=(d.drawStartPoint.selectedPrice>d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,d.minPrice=(d.drawStartPoint.selectedPrice<d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,s.addAnnotation(d),s.drawAnnotations(s.lastxRatio,s.lastDisplayFromIndex)},d.updatePoints({x:a,y:n},{x:o,y:r},d.currentHeight||50,l,p,u))},Y5.prototype.drawAnnotationTextNote=function(i,e,a,t,n,o,r,d){var s,l,c,h,p,u,m,g,f,y,D,C=this;void 0===d&&(d=null);var v=e.offset(),e=this.$drawingCanvas.offset(),x=this.$drawingCanvas[0].getContext("2d"),w=v.left-e.left,P=v.top-e.top;for(i.font=a.textSize+"px Arial",i.textAlign="start",i.lineWidth=a.lineThickness,i.fillStyle=a.fillColor,i.strokeStyle=a.lineColor,e=d&&d.text?d.text:"edit to change text",m=e.split("\n"),p=_.max(_.map(m,function(e){return i.measureText(e).width})),u=m.length*a.textSize,s=o-(p/2+a.textMargin),c=o+(p/2+a.textMargin),l=r-(u/2+a.textMargin),h=r+(u/2+a.textMargin),f=[{x:s,y:l},{x:c,y:l}].concat(d&&d.notePoints?d.notePoints:[]),g=this.buildNotePoly(f,u+2*a.textMargin),i.beginPath(),i.moveTo(g[0].x,g[0].y),y=1;y<g.length;y++)i.lineTo(g[y].x,g[y].y);i.closePath(),i.fill(),i.stroke(),i.textBaseline="middle",i.fillStyle=a.textColor,_.each(m,function(e,t){i.fillText(e,o-p/2,l+a.textSize*(t+1))}),d&&(d.setTrasformPoints=function(e,t,i,a,n,o,r,s,l){d.trasformPoints=[{x:e+r.left,y:n+r.top,dcx:e+s,dcy:n+l,cursor:"pointer"},{x:i+r.left,y:t+r.top,dcx:i+s,dcy:t+l,cursor:"pointer"},{x:a+r.left,y:t+r.top,dcx:a+s,dcy:t+l,cursor:"pointer"},{x:e+r.left,y:o+r.top,dcx:e+s,dcy:o+l,cursor:"pointer"}],d.boundsPoints=[{x:i+r.left,y:n+r.top,dcx:i+s,dcy:n+l},{x:a+r.left,y:n+r.top,dcx:a+s,dcy:n+l},{x:a+r.left,y:o+r.top,dcx:a+s,dcy:o+l},{x:i+r.left,y:o+r.top,dcx:i+s,dcy:o+l}],d.middlePoint={x:e+r.left,y:t+r.top,dcx:e+s,dcy:t+l}},d.isMouseOver=function(t,i){return d.isOverPoint=!1,_.each(d.trasformPoints,function(e){e.isMouseOverPoint=!1,C.isPointOverEllipse(t,i,e.x,e.y,C.transformPointRadius,C.transformPointRadius)&&(d.isOverPoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverShape=!1,d.isOverNotePoint=!1,d.isOverPoint||(_.each(d.notePoints,function(e){e.isMouseOverPoint=!1,C.isPointOverEllipse(t,i,e.x+v.left,e.y+v.top,C.transformPointRadius,C.transformPointRadius)&&(d.isOverNotePoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverNotePoint||(d.isOverShape=C.isPointOverPolygon(t,i,d.boundsPoints))),d.isOverPoint||d.isOverShape||d.isOverNotePoint},d.drawDc=function(){for(x.font=a.textSize+"px Arial",x.textAlign="start",x.lineWidth=a.lineThickness,x.fillStyle=a.fillColor,x.strokeStyle=a.lineColor,d.text||(d.text="edit to change text"),m=d.text.split("\n"),p=_.max(_.map(m,function(e){return i.measureText(e).width})),u=m.length*a.textSize,s=d.middlePoint.dcx-(p/2+a.textMargin),c=d.middlePoint.dcx+(p/2+a.textMargin),l=d.middlePoint.dcy-(u/2+a.textMargin),h=d.middlePoint.dcy+(u/2+a.textMargin),D=d.notePoints,f=[{x:s,y:l},{x:c,y:l}].concat(_.map(D,function(e){return{x:e.dcx,y:e.dcy}})),g=this.buildNotePoly(f,u+2*a.textMargin),x.beginPath(),x.moveTo(g[0].x,g[0].y),y=1;y<g.length;y++)x.lineTo(g[y].x,g[y].y);x.closePath(),x.fill(),x.stroke(),x.textBaseline="middle",x.fillStyle=a.textColor,_.each(m,function(e,t){x.fillText(e,d.middlePoint.dcx-p/2,l+a.textSize*(t+1))})},d.highlight=function(){_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(x.fillStyle="red",C.cursor=e.cursor):x.fillStyle="white",x.lineWidth=C.transformPointStrokeWidth,x.strokeStyle="black",x.beginPath(),x.arc(e.dcx,e.dcy,C.transformPointRadius,0,2*Math.PI,!1),x.closePath(),x.fill(),x.stroke()}),_.each(d.notePoints,function(e){e.isMouseOverPoint?(x.fillStyle="red",C.cursor=e.cursor):x.fillStyle="white",x.beginPath(),x.arc(e.dcx,e.dcy,C.transformPointRadius,0,2*Math.PI,!1),x.closePath(),x.fill()}),d.isOverShape&&(C.cursor="move")},d.beginTransforming=function(e,t){C.filteredAnnotations=_.without(C.filteredAnnotations,d),C.allAnnotations=_.without(C.allAnnotations,d),C.clearAnnotationsCanvas(),C.drawAnnotations(C.lastxRatio,C.lastDisplayFromIndex),d.drawDc(),d.movePoint={x:e,y:t},d.isOverPoint?(d.currentNotePoint={x:e-v.left,y:t-v.top,dcx:e-v.left+w,dcy:t-v.top+P},d.notePoints.push(d.currentNotePoint)):d.isOverNotePoint&&(d.currentNotePoint=d.mousePoint,d.currentNotePoint.x=e-v.left,d.currentNotePoint.y=t-v.top,d.currentNotePoint.dcx=e-v.left+w,d.currentNotePoint.dcy=t-v.top+P)},d.transform=function(e,t){var i=e-d.movePoint.x,a=t-d.movePoint.y;d.movePoint={x:e,y:t},C.clearDrawingCanvas(),d.isOverPoint||d.isOverNotePoint?(d.currentNotePoint.x+=i,d.currentNotePoint.y+=a,d.currentNotePoint.dcx+=i,d.currentNotePoint.dcy+=a):(_.each(d.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),_.each(d.boundsPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),d.middlePoint.x+=i,d.middlePoint.y+=a,d.middlePoint.dcx+=i,d.middlePoint.dcy+=a),d.drawDc()},d.finishTransforming=function(){C.clearDrawingCanvas();var t=C.displayArea.getPositionIndex(d.middlePoint.x);d.drawStartPoint={x:d.middlePoint.x,y:d.middlePoint.y,selectedItem:C.displayArea.allSeries[0].get("elements")[t],selectedIndex:t,selectedPrice:C.displayArea.getPositionValue(d.middlePoint.y)},_.each(d.notePoints,function(e){e.x+=v.left,e.y+=v.top,t=C.displayArea.getPositionIndex(e.x),e.selectedIndex=t,e.selectedItem=C.displayArea.allSeries[0].get("elements")[t],e.selectedPrice=C.displayArea.getPositionValue(e.y)}),d.drawEndPoint=$.extend({},d.drawStartPoint),d.maxPrice=d.drawStartPoint.selectedPrice,d.minPrice=d.drawStartPoint.selectedPrice,C.addAnnotation(d),C.drawAnnotations(C.lastxRatio,C.lastDisplayFromIndex)},d.setTrasformPoints(o,r,s,c,l,h,v,w,P),d.notePoints?_.each(d.notePoints,function(e){e.dcx=e.x+w,e.dcy=e.y+P}):d.notePoints=[])},Y5.prototype.drawAnnotationDiNapoli=function(t,e,i,a,n,o,r,d){var m=this;void 0===d&&(d=null);var s,l,c=e.offset(),h=this.$drawingCanvas.offset(),p=this.$drawingCanvas[0].getContext("2d"),u=c.left-h.left,h=c.top-h.top,g=[{Name:"COP",Multiplier:.618},{Name:"OP",Multiplier:1},{Name:"XOP",Multiplier:1.618}];d&&d.drawAdditionalPoint?(s=d.drawAdditionalPoint.x,l=d.drawAdditionalPoint.y):(l=Math.max(n,r)-(Math.max(n,r)-Math.min(n,r))/2,s=Math.max(a,o)+(Math.max(n,r)-Math.min(n,r))/2);function f(e,t,i,a,n,o,r){var s,l=[],d=i<n?i:n,c=i<n?n:i,h=t<a?t:a,i=i<=n,p=e.width(),u=e.offset();return l.push({x1:a,y1:n,x2:o,y2:r}),i?_.each(g,function(e){s=(c-d)*e.Multiplier+r,l.push({x1:h,y1:s,x2:p,y2:s,value:e.Name+": "+m.displayArea.getPositionValue(s+u.top).toFixed(m.fixedSize)+" ("+(100*e.Multiplier).toFixed(2)+"%)"})}):_.each(g,function(e){s=(d-c)*e.Multiplier+r,l.push({x1:h,y1:s,x2:p,y2:s,value:e.Name+": "+m.displayArea.getPositionValue(s+u.top).toFixed(m.fixedSize)+" ("+(100*e.Multiplier).toFixed(2)+"%)"})}),l}t.lineWidth=i.lineThickness,t.strokeStyle=i.lineColor,t.beginPath(),t.moveTo(a,n),t.lineTo(o,r),t.closePath(),t.stroke(),this.mainLines=f(e,a,n,o,r,s,l),_.each(this.mainLines,function(e){e.value&&(t.fillStyle=t.strokeStyle,t.textBaseline="middle",t.textAlign="right",t.fillText(e.value,e.x2,e.y1-i.textSize/2-1)),t.beginPath(),t.moveTo(e.x1,e.y1),t.lineTo(e.x2,e.y2),t.closePath(),t.stroke()}),d&&(d.setTrasformPoints=function(e,t,i,a,n,o,r,s,l){d.trasformPoints=[{x:e+r.left,y:t+r.top,dcx:e+s,dcy:t+l,cursor:"move"},{x:i+r.left,y:a+r.top,dcx:i+s,dcy:a+l,cursor:"move"},{x:n+r.left,y:o+r.top,dcx:n+s,dcy:o+l,cursor:"move"}];o=new Vector;o.fromPoints(e,t,i,a);o=o.findPerpendicular(2);d.boundsPoints=[{x:e+o.x+r.left,y:t+o.y+r.top,dcx:e+o.x+s,dcy:t+o.y+l},{x:i+o.x+r.left,y:a+o.y+r.top,dcx:i+o.x+s,dcy:a+o.y+l},{x:i-o.x+r.left,y:a-o.y+r.top,dcx:i-o.x+s,dcy:a-o.y+l},{x:e-o.x+r.left,y:t-o.y+r.top,dcx:e-o.x+s,dcy:t-o.y+l}]},d.isMouseOver=function(t,i){return d.isOverPoint=!1,_.each(d.trasformPoints,function(e){e.isMouseOverPoint=!1,m.isPointOverEllipse(t,i,e.x,e.y,m.transformPointRadius,m.transformPointRadius)&&(d.isOverPoint=!0,e.isMouseOverPoint=!0,d.mousePoint=e)}),d.isOverShape=!1,d.isOverPoint||(d.isOverShape=m.isPointOverPolygon(t,i,d.boundsPoints)),d.isOverPoint||d.isOverShape},d.drawDc=function(){p.lineWidth=d.drawTool.lineThickness,p.strokeStyle=d.drawTool.lineColor,m.mainLines=f(m.$drawingCanvas,d.trasformPoints[0].dcx,d.trasformPoints[0].dcy,d.trasformPoints[1].dcx,d.trasformPoints[1].dcy,d.trasformPoints[2].dcx,d.trasformPoints[2].dcy),_.each(m.mainLines,function(e){e.value&&(p.fillStyle=p.strokeStyle,p.textBaseline="middle",p.textAlign="right",p.fillText(e.value,e.x2,e.y1-6)),p.beginPath(),p.moveTo(e.x1,e.y1),p.lineTo(e.x2,e.y2),p.closePath(),p.stroke()}),p.beginPath(),p.moveTo(d.trasformPoints[0].dcx,d.trasformPoints[0].dcy),p.lineTo(d.trasformPoints[1].dcx,d.trasformPoints[1].dcy),p.closePath(),p.stroke()},d.highlight=function(){_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(p.fillStyle="red",m.cursor=e.cursor):p.fillStyle="white",p.lineWidth=m.transformPointStrokeWidth,p.strokeStyle="black",p.beginPath(),p.arc(e.dcx,e.dcy,m.transformPointRadius,0,2*Math.PI,!1),p.closePath(),p.fill(),p.stroke()}),d.isOverShape&&(m.cursor="move")},d.beginTransforming=function(e,t){m.filteredAnnotations=_.without(m.filteredAnnotations,d),m.allAnnotations=_.without(m.allAnnotations,d),m.clearAnnotationsCanvas(),m.drawAnnotations(m.lastxRatio,m.lastDisplayFromIndex),d.drawDc(),d.movePoint={x:e,y:t},d.isOverPoint&&(_.each(d.trasformPoints,function(e){e.isMouseOverPoint?(p.fillStyle="red",m.cursor=e.cursor):p.fillStyle="white",p.beginPath(),p.arc(e.dcx,e.dcy,m.transformPointRadius,0,2*Math.PI,!1),p.closePath(),p.fill(),p.stroke()}),m.showCrosshair=!0)},d.transform=function(e,t){var i=e-d.movePoint.x,a=t-d.movePoint.y;d.movePoint={x:e,y:t},m.clearDrawingCanvas(),d.isOverPoint?(d.mousePoint.x+=i,d.mousePoint.y+=a,d.mousePoint.dcx+=i,d.mousePoint.dcy+=a):d.isOverShape&&_.each(d.trasformPoints,function(e){e.x+=i,e.y+=a,e.dcx+=i,e.dcy+=a}),d.drawDc()},d.finishTransforming=function(){m.clearDrawingCanvas();var e=m.displayArea.getPositionIndex(d.trasformPoints[0].x);d.drawStartPoint={x:d.trasformPoints[0].x,y:d.trasformPoints[0].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(d.trasformPoints[0].y)},e=m.displayArea.getPositionIndex(d.trasformPoints[1].x),d.drawEndPoint={x:d.trasformPoints[1].x,y:d.trasformPoints[1].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(d.trasformPoints[1].y)},e=m.displayArea.getPositionIndex(d.trasformPoints[2].x),d.drawAdditionalPoint={x:d.trasformPoints[2].x,y:d.trasformPoints[2].y,selectedItem:m.displayArea.allSeries[0].get("elements")[e],selectedIndex:e,selectedPrice:m.displayArea.getPositionValue(d.trasformPoints[2].y)},d.maxPrice=(d.drawStartPoint.selectedPrice>d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,d.minPrice=(d.drawStartPoint.selectedPrice<d.drawEndPoint.selectedPrice?d.drawStartPoint:d.drawEndPoint).selectedPrice,m.addAnnotation(d),m.drawAnnotations(m.lastxRatio,m.lastDisplayFromIndex)},d.setTrasformPoints(a,n,o,r,s,l,c,u,h))},Y5.prototype.drawAnnotations=function(t,i){var e,a,n,o,r,s=this;if(this.allAnnotations.length<=0)this.clearAnnotationsCanvas();else if(this.filteredAnnotations.length<=0)this.clearAnnotationsCanvas();else{var l=this.$annotationsCanvas[0].getContext("2d");this.lastxRatio=t,this.lastDisplayFromIndex=i,this.clearAnnotationsCanvas(),this.isCanvasClear=!1;for(var d=this.filteredAnnotations.length,c=0;c<d;c+=1)switch(e=((r=this.filteredAnnotations[c]).drawStartPoint.selectedItem.get("index")-i)*t,e+=r.drawStartPoint.xAddOn*t,n=this.displayArea.getValuePosition(r.drawStartPoint.selectedPrice),a=(r.drawEndPoint.selectedItem.get("index")-i)*t,a+=r.drawEndPoint.xAddOn*t,o=this.displayArea.getValuePosition(r.drawEndPoint.selectedPrice),_.each(r.extendedChartAreas,function(t){var e;t.displayArea!==s.displayArea&&((e=_.find(r.extendedChildren,function(e){return e.chartArea===t})).drawStartPoint=r.drawStartPoint,e.drawEndPoint=r.drawEndPoint),s.refreshPending&&(s.refreshPending=!1,t.annotationsManager.drawAnnotations(s.lastxRatio,s.lastDisplayFromIndex))}),r.drawTool.tool){case"trend-line":case"horizontal-line":case"vertical-line":this.drawAnnotationLine(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"ellipse":this.drawAnnotationEllipse(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"gann-fan":this.drawAnnotationGannFan(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"fibonacci-arcs":this.drawAnnotationFibonacciArcs(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"fibonacci-fan":this.drawAnnotationFibonacciFan(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"andrews-pitchfork":r.drawAdditionalPoint&&(r.drawAdditionalPoint.x=(r.drawAdditionalPoint.selectedItem.get("index")-i)*t,r.drawAdditionalPoint.y=this.displayArea.getValuePosition(r.drawAdditionalPoint.selectedPrice)),this.drawAnnotationAndrewsPitchfork(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"fibonacci-retracements":this.drawAnnotationFibonacciRetracements(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"fibonacci-time-zones":this.drawAnnotationFibonacciTimeZones(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"gann-box":this.drawAnnotationGannBox(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"rectangle":this.drawAnnotationRectangle(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"rotation-rectangle":this.drawAnnotationRotationRectangle(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"text-note":_.each(r.notePoints,function(e){e.x=(e.selectedItem.get("index")-i)*t,e.x+=e.xAddOn*t,e.y=s.displayArea.getValuePosition(e.selectedPrice)}),this.drawAnnotationTextNote(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;case"dinapoli":r.drawAdditionalPoint&&(r.drawAdditionalPoint.x=(r.drawAdditionalPoint.selectedItem.get("index")-i)*t,r.drawAdditionalPoint.y=this.displayArea.getValuePosition(r.drawAdditionalPoint.selectedPrice)),this.drawAnnotationDiNapoli(l,this.$annotationsCanvas,r.drawTool,e,n,a,o,r);break;default:QuickBase.Log.Error("annotation not supported")}}},Y5.prototype.filterAnnotations=function(){var e,t,i,a,n;this.filteredAnnotations=[],this.allAnnotations&&0<this.allAnnotations.length&&!this.disableAnnotations&&this.displayArea.allSeries[0].get("elements")[this.displayArea.displayFromIndex]&&this.displayArea.allSeries[0].get("elements")[this.displayArea.displayToIndex]&&(e=this.displayArea.allSeries[0].get("elements")[this.displayArea.displayFromIndex].get("quoteDate"),t=this.displayArea.allSeries[0].get("elements")[this.displayArea.displayToIndex].get("quoteDate"),t=Helpers.getNextDate(t,this.model.get("granularity")),i=e.getTime(),a=t.getTime(),this.filteredAnnotations=_.filter(this.allAnnotations,function(e){switch(e.drawTool.tool){case"horizontal-line":n=e.drawStartTime>=i&&e.drawStartTime<=a||e.drawEndTime>=i&&e.drawEndTime<=a||e.drawStartTime<=i&&e.drawEndTime>=a||e.drawEndTime<=a&&e.extendFuture||e.drawStartTime<=i&&e.extendPast;break;case"trend-line":n=e.drawStartTime>=i&&e.drawStartTime<=a||e.drawEndTime>=i&&e.drawEndTime<=a||e.drawStartTime<=i&&e.drawEndTime>=a||e.extendPast||e.extendFuture;case"vertical-line":case"ellipse":case"rectangle":case"gann-box":case"fibonacci-time-zones":case"rotation-rectangle":case"text-note":n=e.drawStartTime>=i&&e.drawStartTime<=a||e.drawEndTime>=i&&e.drawEndTime<=a||e.drawStartTime<=i&&e.drawEndTime>=a;break;case"gann-fan":n=e.drawEndTime<a;break;case"fibonacci-arcs":case"fibonacci-fan":case"andrews-pitchfork":case"fibonacci-retracements":case"dinapoli":n=e.drawEndTime<a&&e.drawStartTime<a}return n}))},Y5.prototype.findAnnotation=function(t){return _.find(this.allAnnotations,function(e){return e.drawStartTime===t.drawStartTime&&e.drawEndTime===t.drawEndTime&&e.drawTool.tool===t.drawTool.tool&&e.drawStartPoint.selectedPrice===t.drawStartPoint.selectedPrice})||null},Y5.prototype.getMin=function(){return _.min(_.map(this.filteredAnnotations,function(e){return e.minPrice}))},Y5.prototype.getMax=function(){return _.max(_.map(this.filteredAnnotations,function(e){return e.maxPrice}))},Y5.prototype.handleMouseDraw=function(e,t){var i,a,n,o,r,s,l,d=this.$drawingCanvas[0].getContext("2d"),c=this.$drawingCanvas.prop("width"),h=this.$drawingCanvas.prop("height"),p=e.pageX,u=e.pageY,m=this.displayArea.allSeries[0].get("elements")[t];switch((m=m||this.displayArea.allSeries[0].get("elements")[this.displayArea.allSeries[0].get("elements").length-1]).get("index")||m.set("index",t),this.drawTool.tool){case"vertical-line":a=this.drawStartPoint.selectedItem,n=this.drawStartPoint.selectedIndex,i=this.displayArea.getPositionValue(e.pageY),p=this.drawStartPoint.x;break;case"horizontal-line":n=(a=m).get("index"),i=this.drawStartPoint.selectedPrice,u=this.drawStartPoint.y;break;case"trend-line":case"ellipse":case"rectangle":case"gann-box":case"rotation-rectangle":case"gann-fan":case"fibonacci-arcs":case"fibonacci-fan":case"andrews-pitchfork":case"fibonacci-retracements":case"fibonacci-time-zones":case"text-note":case"dinapoli":n=(a=m).get("index"),i=this.displayArea.getPositionValue(e.pageY)}if(a)switch(this.drawEndPoint={x:p,y:u,selectedItem:a,selectedIndex:n,selectedPrice:i},t=this.$drawingCanvas.offset(),d.clearRect(0,0,c,h),o=this.drawStartPoint.x-t.left,r=this.drawStartPoint.y-t.top,s=this.drawEndPoint.x-t.left,l=this.drawEndPoint.y-t.top,this.drawTool.tool){case"vertical-line":case"horizontal-line":case"trend-line":this.drawAnnotationLine(d,this.$drawingCanvas,this.drawTool,o,r,s,l);break;case"ellipse":this.drawAnnotationEllipse(d,this.$drawingCanvas,this.drawTool,o,r,s,l,null);break;case"fibonacci-arcs":this.drawAnnotationFibonacciArcs(d,this.$drawingCanvas,this.drawTool,o,r,s,l,null);break;case"fibonacci-fan":this.drawAnnotationFibonacciFan(d,this.$drawingCanvas,this.drawTool,o,r,s,l,null);break;case"andrews-pitchfork":this.drawAnnotationAndrewsPitchfork(d,this.$drawingCanvas,this.drawTool,o,r,s,l,null);break;case"fibonacci-retracements":this.drawAnnotationFibonacciRetracements(d,this.$drawingCanvas,this.drawTool,o,r,s,l,null);break;case"fibonacci-time-zones":this.drawAnnotationFibonacciTimeZones(d,this.$drawingCanvas,this.drawTool,o,r,s,l);break;case"gann-fan":this.drawAnnotationGannFan(d,this.$drawingCanvas,this.drawTool,o,r,s,l);break;case"gann-box":this.drawAnnotationGannBox(d,this.$drawingCanvas,this.drawTool,o,r,s,l);break;case"rectangle":this.drawAnnotationRectangle(d,this.$drawingCanvas,this.drawTool,o,r,s,l);break;case"rotation-rectangle":this.drawAnnotationRotationRectangle(d,this.$drawingCanvas,this.drawTool,o,r,s,l);break;case"text-note":this.drawAnnotationTextNote(d,this.$drawingCanvas,this.drawTool,o,r,s,l);break;case"dinapoli":this.drawAnnotationDiNapoli(d,this.$drawingCanvas,this.drawTool,o,r,s,l)}else this.drawEndPoint=null},Y5.prototype.isActive=function(e,t){return this.isDrawing&&this.isDrawingStarted?(this.handleMouseDraw(e,t),!0):this.isTransforming?(this.activeItem.transform(e.pageX,e.pageY),!0):this.onMouseMove(e)},Y5.prototype.isPointOverEllipse=function(e,t,i,a,n,o){return(e-i)*(e-i)/(n*n)+(t-a)*(t-a)/(o*o)<=1},Y5.prototype.isPointOverPolygon=function(e,t,i){var a,n,o,r=!1;if(i)for(n=i.length-1,a=0;a<i.length;a++)(i[a].y<t&&i[n].y>=t||i[n].y<t&&i[a].y>=t)&&(i[a].x<=e||i[n].x<=e)&&(r=!((o=i[a].x+(t-i[a].y)/(i[n].y-i[a].y)*(i[n].x-i[a].x)<e)&&r||!o&&!r)),n=a;return r},Y5.prototype.onContextMenu=function(t){var e,i=this;if(this.activeItem=_.find(this.filteredAnnotations,function(e){return e.isMouseOver(t.pageX,t.pageY)}),this.activeItem){e=this.activeItem,this.activeItem=null;var a=new AnnotationContextMenu({annotation:e,model:this.model,annotationsManager:this});return a.show(t),$(a).on("change",function(){i.drawAnnotations(i.lastxRatio,i.lastDisplayFromIndex)}),$(a).on("copy",function(e,t){i.clipboard=t.item}),$(a).on("delete",function(){_.includes(i.allAnnotations,e)||(e=i.findAnnotation(e)),i.allAnnotations=_.without(i.allAnnotations,e),i.filteredAnnotations=_.without(i.filteredAnnotations,e),i.removedAnnotations.push(e),i.activeItem=null,i.clearDrawingCanvas(),i.clearAnnotationsCanvas(),i.drawAnnotations(i.lastxRatio,i.lastDisplayFromIndex),e.onRemoved&&e.onRemoved(e),i.updateAnnotationsStorage()}),!1}return!0},Y5.prototype.onMouseDblClick=function(t){var e,i=this;if(this.activeItem=_.find(this.filteredAnnotations,function(e){return e.isMouseOver(t.pageX,t.pageY)}),this.activeItem){if(e=this.activeItem,this.activeItem=null,this.openDialog)return this.openDialog.$el.parent().toggleClass("flash",!1),_.defer(function(){i.openDialog.$el.parent().toggleClass("flash",!0)}),!1;var a=new AnnotationEditForm({annotation:e});return(this.openDialog=a).$el.dialog({dialogClass:"charting "+this.model.get("currentTheme"),title:"Edit",resizable:!1,width:"auto",open:function(e){$(e.target).css("overflow","visible");e=$(e.target).parent();i.model.changeThemeClassForElementWhenThemeChanges(e)},close:function(){a.$el.dialog("destroy"),i.openDialog=null,i.updateAnnotationsStorage()}}),$(a).on("change",function(){i.drawAnnotations(i.lastxRatio,i.lastDisplayFromIndex)}),$(a).on("remove",function(){_.includes(i.allAnnotations,e)||(e=i.findAnnotation(e)),i.allAnnotations=_.without(i.allAnnotations,e),i.filteredAnnotations=_.without(i.filteredAnnotations,e),i.removedAnnotations.push(e),i.activeItem=null,i.clearDrawingCanvas(),i.clearAnnotationsCanvas(),i.drawAnnotations(i.lastxRatio,i.lastDisplayFromIndex),e.onRemoved&&e.onRemoved(e),i.updateAnnotationsStorage()}),$(a).on("close",function(){$(a.$el).dialog("close")}),!0}return!1},Y5.prototype.onMouseDown=function(e){var t,i=!1;return e.ctrlKey||2===e.button||(this.isDrawing?(this.isDrawingStarted=!0,t=this.displayArea.getPositionDate(e.pageX),this.drawStartPoint={x:e.pageX,y:e.pageY,selectedItem:t[2],selectedIndex:t[1],selectedPrice:this.displayArea.getPositionValue(e.pageY)},i=!0):this.activeItem&&(this.isTransforming=!0,this.activeItem.beginTransforming(e.pageX,e.pageY),i=!0)),i},Y5.prototype.onMouseMove=function(t){return 0<this.filteredAnnotations.length&&(this.clearDrawingCanvas(),this.activeItem=_.find(this.filteredAnnotations,function(e){return e.isMouseOver(t.pageX,t.pageY)})),this.activeItem&&(this.activeItem.highlight(t.pageX,t.pageY),this.showCrosshair=!1),null!==this.activeItem&&void 0!==this.activeItem},Y5.prototype.onMouseUp=function(e){var t,i=!1,a=$(this.displayArea.$mainCanvas[0]).offset(),n=this.displayArea.$annotationsCanvas.width(),o=this.displayArea.$annotationsCanvas.height(),r=e.pageX-a.left,a=e.pageY-a.top;return r<0||a<0||n<r||o<a?i=!1:this.isDrawing?(this.isDrawing=!1,this.isDrawingStarted=!1,this.clearDrawingCanvas(),this.drawEndPoint&&this.drawEndPoint.selectedItem&&("horizontal-line"===(t={drawTool:this.drawTool,drawStartPoint:this.drawStartPoint,drawEndPoint:this.drawEndPoint,maxPrice:(this.drawStartPoint.selectedPrice>this.drawEndPoint.selectedPrice?this.drawStartPoint:this.drawEndPoint).selectedPrice,minPrice:(this.drawStartPoint.selectedPrice<this.drawEndPoint.selectedPrice?this.drawStartPoint:this.drawEndPoint).selectedPrice,extendedChildren:[],extendedChartAreas:[]}).drawTool.tool&&(t.extendFuture=!0),"vertical-line"===t.drawTool.tool&&(t.extendPast=!0,t.extendFuture=!0),this.addAnnotation(t),this.displayArea.updateDisplay()),this.drawStartPoint=null,i=!(this.drawEndPoint=null)):this.isTransforming&&(t=this.activeItem,this.isTransforming=!1,this.activeItem.finishTransforming(),i=!(this.activeItem=null),t.onChanged&&t.onChanged()),i},Y5.prototype.redoAnnotations=function(){var e=this.removedAnnotations.pop();e&&(this.allAnnotations.push(e),this.filteredAnnotations.push(e),this.displayArea.updateDisplayMinMaxLength(),this.displayArea.updateDisplay(),this.updateAnnotationsStorage())},Y5.prototype.removeAnnotation=function(e,t){this.filteredAnnotations=_.without(this.filteredAnnotations,e),this.allAnnotations=_.without(this.allAnnotations,e),this.drawAnnotations(this.lastxRatio,this.lastDisplayFromIndex),e.onRemoved&&e.onRemoved(e),t&&this.displayArea.updateDisplay(),this.updateAnnotationsStorage()},Y5.prototype.scaleAnnotations=function(){var n,o,r,s,l,d,t,c=this,h=0,p=!1,u=!1,m=[];this.scalingPending&&(_.each(this.scalePendingAnnotations,function(e){for(n=parseInt(e.drawStartTime),l=new Date(n),o=parseInt(e.drawEndTime),d=new Date(o),h=c.displayArea.allDates.length-1;0<=h;--h)if(c.displayArea.allDates[h]<l){e.drawStartPoint.selectedItem=c.displayArea.allSeries[0].get("elements")[h],p=!0;break}for(p=!!e.drawStartPoint.selectedItem,h=c.displayArea.allDates.length-1;0<=h;--h)if(c.displayArea.allDates[h]<d){e.drawEndPoint.selectedItem=c.displayArea.allSeries[0].get("elements")[h],u=!0;break}var t,i,a;u=!!e.drawEndPoint.selectedItem,p&&u&&(r=e.drawStartPoint.selectedItem.get("quoteDate").getTime(),s=(c.displayArea.allSeries[0].get("elements").length>e.drawStartPoint.selectedItem.get("index")+1?c.displayArea.allSeries[0].get("elements")[e.drawStartPoint.selectedItem.get("index")+1].get("quoteDate"):Helpers.getNextDate(e.drawStartPoint.selectedItem.get("quoteDate"),c.model.get("granularity"))).getTime(),e.drawStartPoint.xAddOn=(n-r)/(s-r),e.drawStartTime=r+(s-r)*e.drawStartPoint.xAddOn,r=e.drawEndPoint.selectedItem.get("quoteDate").getTime(),s=(c.displayArea.allSeries[0].get("elements").length>e.drawEndPoint.selectedItem.get("index")+1?c.displayArea.allSeries[0].get("elements")[e.drawEndPoint.selectedItem.get("index")+1].get("quoteDate"):Helpers.getNextDate(e.drawEndPoint.selectedItem.get("quoteDate"),c.model.get("granularity"))).getTime(),e.drawEndPoint.xAddOn=(o-r)/(s-r),m.push(e),e.drawEndTime=r+(s-r)*e.drawEndPoint.xAddOn),u=p=!1,"text-note"===e.drawTool.tool&&_.each(e.notePoints,function(e){for(t=parseInt(e.drawTime),i=new Date(t),a=!1,h=c.displayArea.allDates.length-1;0<=h;--h)if(c.displayArea.allDates[h]<i){e.selectedItem=c.displayArea.allSeries[0].get("elements")[h],a=!0;break}a&&(r=e.selectedItem.get("quoteDate").getTime(),s=(c.displayArea.allSeries[0].get("elements").length>e.selectedItem.get("index")+1?c.displayArea.allSeries[0].get("elements")[e.selectedItem.get("index")+1].get("quoteDate"):Helpers.getNextDate(e.selectedItem.get("quoteDate"),c.model.get("granularity"))).getTime(),e.xAddOn=(o-r)/(s-r),e.drawTime=r+(s-r)*e.xAddOn)})}),_.each(m,function(e){c.allAnnotations.push(e),c.filteredAnnotations.push(e),-1<(t=c.scalePendingAnnotations.indexOf(e))&&c.scalePendingAnnotations.splice(t,1)}),this.scalePendingAnnotations.length<=0&&(this.scalingPending=!1))},Y5.prototype.setDecimals=function(e){e&&(this.fixedSize=e)},Y5.prototype.startDrawing=function(e){this.isDrawing=!0,this.drawTool={tool:e.tool,lineThickness:e.lineThickness,lineColorDef:e.lineColor,lineOpacity:e.strokeOpacity,fillColorDef:e.fillColor,fillOpacity:e.fillOpacity,textMargin:7,textSize:12};var t=Helpers.hexToRgb(e.lineColor);this.drawTool.lineColor="rgba("+t.r+","+t.g+","+t.b+","+e.strokeOpacity/100+")",t=Helpers.hexToRgb(e.fillColor),this.drawTool.fillColor="rgba("+t.r+","+t.g+","+t.b+","+e.fillOpacity/100+")",this.drawTool.textColor=this.drawTool.lineColorDef},Y5.prototype.stopDrawing=function(){this.isDrawing=!1,this.isDrawingStarted=!1,this.drawStartPoint=null,this.drawEndPoint=null;var e=this.$drawingCanvas[0].getContext("2d"),t=this.$drawingCanvas[0].width,i=this.$drawingCanvas[0].height;e.clearRect(0,0,t,i)},Y5.prototype.undoAnnotations=function(){var e=this.allAnnotations.pop();e&&(this.removedAnnotations.push(e),this.filteredAnnotations=_.without(this.filteredAnnotations,e),this.displayArea.updateDisplayMinMaxLength(),this.displayArea.updateDisplay()),this.updateAnnotationsStorage()},Y5.prototype.updateAnnotationsStorage=function(){var e;this.enableSave&&(this.applyingAnnotations||(this.allAnnotations.length<=0?this.model.set("savedAnnotations",""):(e=_.map(this.allAnnotations,function(e){return{drawTool:e.drawTool,drawStartPoint:{selectedPrice:e.drawStartPoint.selectedPrice,x:e.drawStartPoint.x,y:e.drawStartPoint.y,xAddOn:e.drawStartPoint.xAddOn,selectedItemQuoteDate:e.drawStartPoint.selectedItem.get("quoteDate").valueOf()},drawEndPoint:e.drawEndPoint?{selectedPrice:e.drawEndPoint.selectedPrice,x:e.drawEndPoint.x,y:e.drawEndPoint.y,xAddOn:e.drawEndPoint.xAddOn,selectedItemQuoteDate:e.drawEndPoint.selectedItem.get("quoteDate").valueOf()}:null,drawEndTime:e.drawEndTime,drawStartTime:e.drawStartTime,extendFuture:e.extendFuture,extendPast:e.extendPast,currentHeight:e.currentHeight,notePoints:e.notePoints?_.map(e.notePoints,function(e){return{selectedPrice:e.selectedPrice,x:e.x,y:e.y,xAddOn:e.xAddOn,selectedItemQuoteDate:e.selectedItem.get("quoteDate").valueOf()}}):null,text:e.text}}),this.model.set("savedAnnotations",JSON.stringify(e)))))},Y5);function Y5(e,t,i,a,n){var o=this;this.allAnnotations=[],this.filteredAnnotations=[],this.removedAnnotations=[],this.scalePendingAnnotations=[],this.model=a,this.isDrawing=!1,this.isDrawingStarted=!1,this.clipboard=null,this.drawStartPoint=null,this.drawEndPoint=null,this.drawTool=null,this.fixedSize=i,this.lastxRatio=null,this.lastDisplayFromIndex=null,this.showCrosshair=!0,this.cursor="default",this.activeItem=null,this.transformPointRadius=7,this.transformPointStrokeWidth=1,this.isTransforming=!1,this.disableAnnotations=!1,this.refreshPending=!1,this.isCanvasClear=!0,this.applyingAnnotations=!1,this.enableSave=n,this.displayArea=t,this.$drawingCanvas=e,this.$annotationsCanvas=t.$annotationsCanvas,this.allAnnotations=[],this.filteredAnnotations=[],this.removedAnnotations=[],this.scalePendingAnnotations=[],this.levels=null,this.openDialog=null,this.scalingPending=!1,this.currentSymbol=this.model.get("stockSymbol"),$(this.displayArea).on("dates-refreshed",function(){return o.scaleAnnotations()}),this.model.on("change:savedAnnotations",function(){return o.applyAnnotationsStorage()})}var ChartSeriesElement=(ks=Backbone.Model,__extends(ls,ks),ls.prototype.initialize=function(){this.set(ls.defaults)},ls.prototype.initialize2=function(){var t=this;this.updateDirection(),this.listenTo(this,"change:close",function(){return t.updateDirection()}),this.listenTo(this,"change:open",function(){return t.updateDirection()});var e=[this.get("open"),this.get("high"),this.get("low"),this.get("close")];_.each(e,function(e){e&&_.isNumber(e)&&!_.isNaN(e)&&_.isFinite(e)||(t.set("isValid",!1),t.set("isFake",!0),t.get("value")&&_.isNumber(t.get("value"))&&_.isFinite(t.get("value"))&&t.set("isFake",!1))})},ls.prototype.updateDirection=function(){this.set("direction",this.get("close")>=this.get("open")?1:2)},ls.defaults={open:null,high:null,low:null,close:null,value:null,quoteDate:null,isFake:!1,volume:null,isLiveElement:!1,index:null,letter:null,isInProfit:null,dateTag:null,direction:null,isValid:!0},ls),ks;function ls(e){var t=ks.call(this)||this;return t.set(e),t.initialize2(),t}var ChartDisplaySeries=(rs=Backbone.Model,__extends(ss,rs),ss.prototype.initialize=function(){this.set(ss.defaults)},ss.prototype.initialize2=function(){var e=this.get("elements").slice(-2);e&&1<e.length&&(e[0].get("value")>e[1].get("value")?this.set({lastChangeGreen:!1},{silent:!0}):this.set({lastChangeGreen:!0},{silent:!0}))},ss.prototype.clearLiveElement=function(){this.get("liveElement")&&$(this.get("liveElement")).off(),this.set({liveElement:null})},ss.prototype.addSeriesElement=function(e){this.get("elements").push(e)},ss.prototype.addSeriesElements=function(e){var t=this;_.each(e,function(e){t.get("elements").push(e)})},ss.prototype.addSeriesElementsInEnd=function(e){this.set({elements:this.get("elements").concat(e)});var t=e.length,i=this.get("displayFromIndex"),e=this.get("displayToIndex");this.set({displayFromIndex:i+t,displayToIndex:e+t})},ss.prototype.addSeriesElementsInFront=function(e){this.set({elements:e.concat(this.get("elements"))});var t=e.length,i=this.get("displayFromIndex"),e=this.get("displayToIndex");this.set({displayFromIndex:i+t,displayToIndex:e+t})},ss.prototype.setDisplayRange=function(e,t){this.set({displayFromIndex:e}),this.set({displayToIndex:t}),this.updateMinMax(e,t)},ss.prototype.removeFakeElements=function(e){for(var t,i=this.get("elements").length,a=this.get("elements").length-1;0<=a;a--)if(!this.get("elements")[a].get("isFake")){t=a+1;break}e&&(t+=1);i-=t;return 0<i?(this.set({elements:this.get("elements").slice(0,t)}),this.updateMinMax(null,null),i):0},ss.prototype.replaceAndAddSeriesElements=function(e,t){for(var i=this.get("elements").length,a=t.length,n=0;n<a;n+=1)i<=n+e?this.get("elements").push(t[n]):this.get("elements")[n+e].set({open:t[n].get("open"),high:t[n].get("high"),low:t[n].get("low"),close:t[n].get("close"),value:t[n].get("value"),quoteDate:t[n].get("quoteDate"),volume:t[n].get("volume"),isFake:!1,isLiveElement:!1,letter:t[n].get("letter")});this.updateMinMax(null,null)},ss.prototype.updateLiveElement=function(e,t,i,a,n,o,r){var s,l,d,c,h=(e+t)/2,p=this.get("elements")[this.get("elements").length-1];this.get("liveElement")?(s=this.get("liveElement").get("value"),l=this.get("liveElement").get("open"),c=d=this.get("liveElement").get("high"),t=e=this.get("liveElement").get("low"),n||(c=h<d?d:h),o||(t=e<h?e:h),this.get("liveElement").set({open:a||l,high:n||c,low:o||t,close:h,value:h,quoteDate:i||this.get("liveElement").get("quoteDate"),isLiveElement:!0}),h<s?this.set({lastChangeGreen:!1},{silent:!0}):this.set({lastChangeGreen:!0},{silent:!0}),this.updateMinMax(null,null)):(this.set({liveElement:new ChartSeriesElement({open:a||h,high:n||h,low:o||h,close:h,value:h,quoteDate:i,isLiveElement:!0})}),p.get("value")>h?this.set({lastChangeGreen:!1},{silent:!0}):this.set({lastChangeGreen:!0},{silent:!0})),r.onLiveElementValuesChanging({target:this})},ss.prototype.updateMinMax=function(e,t){var i,a,n;e&&t||(e=this.get("displayFromIndex"),t=this.get("displayToIndex")),-1===this.get("displayId")&&(n=!0);var o=this.get("elements").slice(e,t+1);switch(this.get("displayType")){case"Bar":case"Histogram":case"Kagi":case"Dots":case"Line":case"PivotLine":case"Mountain":i=Helpers.filteredMin(o,"value",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"value",n),_.isUndefined(a)&&(a=1/0);break;case"LineOpen":i=Helpers.filteredMin(o,"open",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"open",n),_.isUndefined(a)&&(a=1/0);break;case"LineHigh":i=Helpers.filteredMin(o,"high",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"high",n),_.isUndefined(a)&&(a=1/0);break;case"LineLow":i=Helpers.filteredMin(o,"low",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"low",n),_.isUndefined(a)&&(a=1/0);break;case"LineClose":i=Helpers.filteredMin(o,"close",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"close",n),_.isUndefined(a)&&(a=1/0);break;case"OHLCBar":case"ProfitArea":case"CandleStick":case"HeikinAshi":i=Helpers.filteredMin(o,"low",n),_.isUndefined(i)&&(i=-1/0),a=Helpers.filteredMax(o,"high",n),_.isUndefined(a)&&(a=1/0);break;default:throw new Error("Series require a display type.")}var t=this.get("markers");t&&0<t.length&&(i=Math.min.apply(null,_.union([i],this.get("markers"))),a=Math.max.apply(null,_.union([a],this.get("markers")))),a+=1e-4*(a-(i-=1e-4*(a-i))),(t=_.find(o,function(e){return e.get("value")}))?(t=t.get("value"),this.set({seriesMax:a,seriesMin:i,percentBase:t,percentMin:(i-t)/t,percentMax:(a-t)/t})):this.set({seriesMax:a,seriesMin:i,percentBase:null,percentMin:null,percentMax:null})},ss.defaults={displayName:null,displayType:null,displayColor:null,lineThickness:1,elements:null,liveElement:null,seriesMax:null,seriesMin:null,displayId:-1,displayFromIndex:null,displayToIndex:null,lastChangeGreen:null,displayArea:null,profitColor:null,lossColor:null,percentBase:null,percentMin:null,percentMax:null},ss),rs;function ss(e){var t=rs.call(this)||this;return t.set(e),t.initialize2(),t}!function(){for(var o=0,e=["ms","moz","webkit","o"],t=0;t<e.length&&!window.requestAnimationFrame;++t)window.requestAnimationFrame=window[e[t]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[t]+"CancelAnimationFrame"]||window[e[t]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e,t){var i=(new Date).getTime(),a=Math.max(0,16-(i-o)),n=window.setTimeout(function(){e(i+a)},a);return o=i+a,n}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)})}();var DisplayArea=(zt=Backbone.View,__extends(At,zt),At.prototype.addSeries=function(e,t){var i=this;this.allSeries.push(e),e.set({displayArea:this}),t&&(this.seriesMarkers=this.seriesMarkers.concat(t)),this.refreshDates(),e.on("change:liveElement",function(e){return i.onLiveElementChanged(e)}),this.newSeriesAdded=!0},At.prototype.removeSeries=function(e){for(var t=e?e.displaySeries.length:0,i=0;i<t;i+=1)this.allSeries=_.without(this.allSeries,e.displaySeries[i]),e.displaySeries[i].off()},At.prototype.applyLayout=function(){var e=this.$el.width(),t=this.$el.height();this.updateDisplayMinMaxLength(),this.xRatio=e/this.elementsCount,this.yRatio=t/(this.max-this.min),this.$mainCanvas.prop("width",e),this.$mainCanvas.prop("height",t),this.$mainCanvas.css({height:t,width:e}),this.$preRenderCanvas.prop("width",e),this.$preRenderCanvas.prop("height",t),this.$preRenderCanvas.css({height:t,width:e}),this.mainCanvasHeight=t,this.mainCanvasWidth=e,this.mainCanvasOffset=this.$mainCanvas.offset(),this.$annotationsCanvas.prop("width",e),this.$annotationsCanvas.prop("height",t),this.$annotationsCanvas.css({height:t,width:e}),this.$liveElementsCanvas.prop("height",t),this.$liveElementsCanvas.css({height:t}),this.isLayoutApplied=!0,this.isDisplayPending&&this.updateDisplay()},At.prototype.applyTemplate=function(){this.$el.html(T.DisplayArea()),this.$mainCanvas=this.$el.find(".MainCanvas"),this.mainCanvasContext=this.$mainCanvas[0].getContext("2d"),this.$preRenderCanvas=$(document.createElement("canvas")),this.preRenderCanvasContext=this.$preRenderCanvas[0].getContext("2d"),this.$annotationsCanvas=this.$el.find(".AnnotationsCanvas"),this.$liveElementsCanvas=this.$el.find(".LiveElementsCanvas")},At.prototype.calculateDisplayValues=function(e,t){var i=this.$el,a=this.niceNum(t-e,!1),i=Math.floor(i.height()/26),n=this.niceNum(a/(i-1),!0),a=Math.floor(e/n)*n,o=null,r=a=e<a?e:a;if(_.isFinite(e)&&_.isFinite(t)&&(o=[],e!==t))if(1<i)if(this.model.get("autoZoomY"))for(o.push(a);o.push(r+=n),r<t;);else for(;r+n<t;)o.push(r+=n);else o=[e,t];return _.last(o)<t&&o.push(t),o},At.prototype.clear=function(){var e,t,i;this.isLayoutApplied&&(e=this.mainCanvasContext,t=this.mainCanvasWidth,i=this.mainCanvasHeight,e.clearRect(0,0,t,i),this.$liveElementsCanvas&&(t=this.$liveElementsCanvas.prop("width"),i=this.$liveElementsCanvas.prop("height"),(e=this.$liveElementsCanvas[0].getContext("2d")).clearRect(0,0,t,i)),this.allDates=[],_.each(this.allSeries,function(e){e.off()}),this.allSeries=[],this.seriesMarkers=[],this.elementsCount=null,this.min=null,this.max=null,this.xRatio=null,this.yRatio=null,this.wasCleared=!0)},At.prototype.displaySeries=function(e,t){var i,a=this;if(!this.drawingLocked&&(-1!==t&&-1!==e||(e=this.displayFromIndex,t=this.displayToIndex),this.hasDatesRangeChanged=this.displayFromIndex!==e||this.displayToIndex!==t,this.hasDatesRangeChanged||this.newSeriesAdded)){if(this.displayFromIndex=e,this.displayToIndex=t,this.invalid=!0,_.each(this.allSeries,function(e){e.setDisplayRange(a.displayFromIndex,a.displayToIndex)}),this.updateDisplayMinMaxLength(),this.updateRatios(),this.isDisplayPending=!0,this.isLiveElementEnabled&&this.isLastElementOnDisplay()){for(this.isLiveElementsCanvasVisible=!0,this.liveCanvasWidht=Math.round(2*this.xRatio),this.lastItemIndex=this.allSeries[0].get("elements").length-1,i=this.displayToIndex;0<=i;--i)if(!this.allSeries[0].get("elements")[i].get("isFake")){this.lastItemIndex=i-this.displayFromIndex;break}}else this.isLiveElementsCanvasVisible=!1;this.updateDisplay()}},At.prototype.updateDisplay=function(){var e,t=this;if(!this.drawingLocked){var i=this.preRenderCanvasContext,a=this.mainCanvasWidth,n=this.mainCanvasHeight;i.clearRect(0,0,a,n);var o=this.allSeries.length;if(0<o)for(e=0;e<o;e+=1)switch(this.allSeries[e].get("displayType")){case"Bar":this.drawBarSeries(i,this.allSeries[e]);break;case"Kagi":this.drawKagiSeries(i,this.allSeries[e]);break;case"CandleStick":this.drawCandleStickSeries(i,this.allSeries[e]);break;case"Histogram":this.drawHistogramSeries(i,this.allSeries[e]);break;case"Line":this.drawLineSeries2(i,this.allSeries[e],"value");break;case"LineOpen":this.drawLineSeries2(i,this.allSeries[e],"open");break;case"LineHigh":this.drawLineSeries2(i,this.allSeries[e],"high");break;case"LineLow":this.drawLineSeries2(i,this.allSeries[e],"low");break;case"LineClose":this.drawLineSeries2(i,this.allSeries[e],"close");break;case"OHLCBar":this.drawOHLCBarSeries(i,this.allSeries[e]);break;case"Dots":this.drawDotSeries(i,this.allSeries[e]);break;case"ProfitArea":this.drawProfitAreaSeries(i,this.allSeries[e]);break;case"HeikinAshi":this.drawHeikinAshiSeries(i,this.allSeries[e]);break;case"PivotLine":this.drawPivotLineSeries(i,this.allSeries[e]);break;case"Mountain":this.drawMountainLineSeries(i,this.allSeries[e]);break;default:throw new Error("Series require a display type.")}this.annotationsManager.drawAnnotations(this.xRatio,this.displayFromIndex),this.isDisplayPending=!1,this.invalid=!0,requestAnimationFrame(function(){return t.displayUpdated()})}},At.prototype.displayUpdated=function(){var e;this.invalid&&(this.invalid=!1,this.mainCanvasContext.clearRect(0,0,this.mainCanvasWidth,this.mainCanvasHeight),this.mainCanvasContext.drawImage(this.$preRenderCanvas[0],0,0),this.isLiveElementsCanvasVisible?(this.$liveElementsCanvas.prop("width",this.liveCanvasWidht),e={width:this.liveCanvasWidht,left:this.lastItemIndex*this.xRatio,display:"block"},this.liveCanvasDisplayed=!0,this.$liveElementsCanvas.css(e),this.updateLiveElementsCanvas(),this.isLiveElementsCanvasVisible=!0):this.hideLiveElementsCanvas(),$(this).trigger("displayUpdated"))},At.prototype.drawBar=function(e,t,i,a){null===a||a.get("value")>i.get("value")?e.fillStyle=this.model.get("redColor"):e.fillStyle=this.model.get("greenColor");var n=this.xRatio*t+.07*this.xRatio,a=this.xRatio*(t+1)-.07*this.xRatio,t=this.getValuePosition(i.get("value"));e.fillRect(Math.floor(n)+.5,Math.floor(t)+.5,Math.floor(a-n)+.5,Math.floor(this.$mainCanvas[0].height-t)+.5),i.bounds={left:n,top:t,right:a,bottom:this.$mainCanvas[0].height}},At.prototype.drawBarSeries=function(e,t){var i,a;for(this.drawBar(e,0,t.get("elements")[this.displayFromIndex],null),i=t.get("elements")[this.displayFromIndex],a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)this.drawBar(e,a-this.displayFromIndex,t.get("elements")[a],i),i=t.get("elements")[a]},At.prototype.drawCandleStick=function(e,t,i,a){var n,o,r,s,l,d,c,h=[];i&&(n=1===i.get("direction")?(e.strokeStyle=this.model.get("chartDisplayAreaCandleStickUpStroke"),e.fillStyle=this.model.get("chartDisplayAreaCandleStickUpFill"),this.model.get("chartDisplayAreaCandleStickUpIsHollow")):(e.strokeStyle=this.model.get("chartDisplayAreaCandleStickDownStroke"),e.fillStyle=this.model.get("chartDisplayAreaCandleStickDownFill"),!1),h[0]=this.getValuePosition(i.get("open"),a),h[1]=this.getValuePosition(i.get("high"),a),h[2]=this.getValuePosition(i.get("low"),a),h[3]=this.getValuePosition(i.get("close"),a),h=_.sortBy(h,function(e){return e}),o=Math.floor(this.xRatio*(t+1)-this.xRatio/2)+.5,r=this.xRatio*t+.07*this.xRatio,s=this.xRatio*(t+1)-.07*this.xRatio,d=(l=Math.floor(h[1])+.5)+Math.floor(h[2]-h[1]),(c=Math.floor(d-l))<1&&(c=1),a=Math.floor(r)+.5,t=Math.floor(s-r),e.strokeRect(a,l,t,c),n||e.fillRect(a,l,t,c),e.beginPath(),e.moveTo(o,Math.floor(h[0])+.5),e.lineTo(o,l),e.stroke(),e.beginPath(),e.moveTo(o,d),e.lineTo(o,Math.floor(h[3])+.5),e.stroke(),i.bounds={left:r,top:h[0],right:s,bottom:h[3]})},At.prototype.calcCandleStick=function(e,t,i){(n=[])[0]=this.getValuePosition(t.get("open"),i),n[1]=this.getValuePosition(t.get("high"),i),n[2]=this.getValuePosition(t.get("low"),i),n[3]=this.getValuePosition(t.get("close"),i);var a,n=_.sortBy(n,function(e){return e}),o=Math.floor(this.xRatio*(e+1)-this.xRatio/2)+.5,r=this.xRatio*e+.07*this.xRatio,s=this.xRatio*(e+1)-.07*this.xRatio,l=Math.floor(n[1])+.5,d=l+Math.floor(n[2]-n[1]);(a=Math.floor(d-l))<1&&(a=1);i=Math.floor(r)+.5,e=Math.floor(s-r);t.bounds={left:r,top:n[0],right:s,bottom:n[3],newLeft:i,newTop:l,newRight:e,newBottom:d,newMiddle:o,newHeight:a}},At.prototype.drawCandleStickSeries=function(e,t){for(var i,a,n="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null,o=t.get("elements"),r=this.displayFromIndex;r<=this.displayToIndex;r+=1)(i=o[r])&&i.get("isValid")&&this.calcCandleStick(r-this.displayFromIndex,i,n);for(e.fillStyle=this.model.get("chartDisplayAreaCandleStickDownFill"),r=this.displayFromIndex;r<=this.displayToIndex;r+=1)(i=o[r])&&2===i.get("direction")&&i.get("isValid")&&(a=i.bounds,e.fillRect(a.newLeft,a.newTop,a.newRight,a.newHeight));if(!this.model.get("chartDisplayAreaCandleStickUpIsHollow"))for(e.fillStyle=this.model.get("chartDisplayAreaCandleStickUpFill"),r=this.displayFromIndex;r<=this.displayToIndex;r+=1)(i=o[r])&&1===i.get("direction")&&i.get("isValid")&&(a=i.bounds,e.fillRect(a.newLeft,a.newTop,a.newRight,a.newHeight));for(e.lineWidth=1,e.strokeStyle=this.model.get("chartDisplayAreaCandleStickDownStroke"),e.beginPath(),r=this.displayFromIndex;r<=this.displayToIndex;r+=1)(i=o[r])&&2===i.get("direction")&&i.get("isValid")&&(a=i.bounds,e.moveTo(a.newMiddle,Math.floor(a.top)+.5),e.lineTo(a.newMiddle,a.newTop),e.moveTo(a.newMiddle,a.newBottom),e.lineTo(a.newMiddle,Math.floor(a.bottom)+.5),e.strokeRect(a.newLeft,a.newTop,a.newRight,a.newHeight));for(e.stroke(),e.strokeStyle=this.model.get("chartDisplayAreaCandleStickUpStroke"),e.beginPath(),r=this.displayFromIndex;r<=this.displayToIndex;r+=1)(i=o[r])&&1===i.get("direction")&&i.get("isValid")&&(a=i.bounds,e.moveTo(a.newMiddle,Math.floor(a.top)+.5),e.lineTo(a.newMiddle,a.newTop),e.moveTo(a.newMiddle,a.newBottom),e.lineTo(a.newMiddle,Math.floor(a.bottom)+.5),e.strokeRect(a.newLeft,a.newTop,a.newRight,a.newHeight));e.stroke()},At.prototype.drawDot=function(e,t,i,a,n){i.x=this.xRatio*t+this.xRatio/2,i.y=this.getValuePosition(i.get("value")),e.beginPath(),e.arc(i.x,i.y,n,0,2*Math.PI,!1),a?(e.fillStyle=a,e.strokeStyle=a):this.allSeries[0].get("elements")[this.displayFromIndex+t].get("value")<i.get("value")?(e.fillStyle=this.model.get("redColor"),e.strokeStyle=this.model.get("redColor")):(e.fillStyle=this.model.get("greenColor"),e.strokeStyle=this.model.get("greenColor")),e.fill(),e.stroke(),i.bounds={left:this.xRatio*t,top:this.getValuePosition(i.get("value")),right:this.xRatio*(t+1),bottom:this.getValuePosition(i.get("value"))}},At.prototype.drawDotSeries=function(e,t){for(var i,a=t.get("elements"),n=t.get("displayColor"),o=t.get("lineThickness"),r=this.displayFromIndex+1;r<=this.displayToIndex;r+=1)(i=a[r]).get("isFake")||this.drawDot(e,r-this.displayFromIndex,i,n,o)},At.prototype.drawHeikinAshi=function(e,t,i,a,n,o){void 0===o&&(o=0);var r,s,l,d=[];0===t?(s=(i.get("open")+i.get("close"))/2,m=i.get("high"),c=i.get("low"),l=(i.get("open")+i.get("high")+i.get("low")+i.get("close"))/4):(s=(n.open+n.close)/2,l=(i.get("open")+i.get("high")+i.get("low")+i.get("close"))/4,m=Math.max(i.get("high"),s,l),c=Math.min(i.get("low"),s,l)),r=s<=l?(e.strokeStyle=this.model.get("chartDisplayAreaCandleStickUpStroke"),e.fillStyle=this.model.get("chartDisplayAreaCandleStickUpFill"),this.model.get("chartDisplayAreaCandleStickUpIsHollow")):(e.strokeStyle=this.model.get("chartDisplayAreaCandleStickDownStroke"),e.fillStyle=this.model.get("chartDisplayAreaCandleStickDownFill"),!1),d[0]=this.getValuePosition(s,o),d[1]=this.getValuePosition(m,o),d[2]=this.getValuePosition(c,o),d[3]=this.getValuePosition(l,o);var c,d=_.sortBy(d,function(e){return e}),h=Math.floor(this.xRatio*(t+1)-this.xRatio/2)+.5,p=this.xRatio*t+.07*this.xRatio,u=this.xRatio*(t+1)-.07*this.xRatio,n=Math.floor(d[1])+.5,m=n+Math.floor(d[2]-d[1]);(c=Math.floor(m-n))<1&&(c=1);o=Math.floor(p)+.5,t=Math.floor(u-p);return e.strokeRect(o,n,t,c),r||e.fillRect(o,n,t,c),e.beginPath(),e.moveTo(h,Math.floor(d[0])+.5),e.lineTo(h,n),e.stroke(),e.beginPath(),e.moveTo(h,m),e.lineTo(h,Math.floor(d[3])+.5),e.stroke(),i.bounds={left:p,top:d[0],right:u,bottom:d[3]},i.hashi={open:s,close:l},i.hashi},At.prototype.drawHeikinAshiSeries=function(e,t){var i=t.get("elements")[this.displayFromIndex],a="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&i){e.lineWidth=1;for(var n=this.drawHeikinAshi(e,0,i,null,null),o=i,r=t.get("elements").length,s=this.displayFromIndex+1;s<=this.displayToIndex&&s<r;s+=1)t.get("elements")[s].get("isFake")||(i=t.get("elements")[s],n=this.drawHeikinAshi(e,s-this.displayFromIndex,i,o,n,a),o=i)}},At.prototype.drawHistogram=function(e,t,i,a,n){var o;if(i){if(n)switch(n){case"relative":null===a||a.get("value")>i.get("value")?e.fillStyle=this.model.get("redColor"):e.fillStyle=this.model.get("greenColor");break;case"absolute":i.get("value")<0?e.fillStyle=this.model.get("redColor"):e.fillStyle=this.model.get("greenColor");break;default:e.fillStyle=n}else null===a||a.get("value")>i.get("value")?e.fillStyle=this.model.get("redColor"):e.fillStyle=this.model.get("greenColor");var r=this.xRatio*t+.07*this.xRatio,s=this.xRatio*(t+1)-.07*this.xRatio,t=0<i.get("value")?(o=this.getValuePosition(i.get("value")),this.getValuePosition(0)):(o=this.getValuePosition(0),this.getValuePosition(i.get("value")));e.fillRect(Math.floor(r)+.5,Math.floor(o)+.5,Math.floor(s-r)+.5,Math.floor(t-o)+.5),i.bounds={left:r,top:o,right:s,bottom:t}}},At.prototype.drawHistogramSeries=function(e,t){var i,a;for(this.drawHistogram(e,0,t.get("elements")[this.displayFromIndex],null,t.get("displayColor")),(a=t.get("elements")[this.displayFromIndex])&&a.get("isFake")&&(a=null),i=this.displayFromIndex+1;i<=this.displayToIndex;i+=1)t.get("elements")[i]&&!t.get("elements")[i].get("isFake")&&(this.drawHistogram(e,i-this.displayFromIndex,t.get("elements")[i],a,t.get("displayColor")),a=t.get("elements")[i])},At.prototype.drawKagi=function(e,t,i,a,n,o,r){void 0===r&&(r=0),o.isThick&&i.get("close")>=a.get("close")?(e.strokeStyle=this.model.get("chartDisplayAreaKagiUpColor"),e.lineWidth=2,e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),r)),e.stroke(),o.limitValue=i.get("close")):o.isThick&&i.get("close")<a.get("close")?(e.strokeStyle=this.model.get("chartDisplayAreaKagiUpColor"),e.lineWidth=2,o.limitValue-i.get("close")>n?i.get("close")<a.get("low")?(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("low"),r)),e.stroke(),e.beginPath(),e.strokeStyle=this.model.get("chartDisplayAreaKagiDownColor"),e.lineWidth=1,e.moveTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("low"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),r)),e.stroke(),o.isThick=!1,o.limitValue=i.get("close")):(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),r)),e.stroke()):(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),r)),e.stroke())):!o.isThick&&i.get("close")<=a.get("close")?(e.strokeStyle=this.model.get("chartDisplayAreaKagiDownColor"),e.lineWidth=1,e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),r)),e.stroke(),o.limitValue=i.get("close")):!o.isThick&&i.get("close")>a.get("close")&&(e.strokeStyle=this.model.get("chartDisplayAreaKagiDownColor"),e.lineWidth=1,i.get("close")-o.limitValue>n?i.get("close")>a.get("high")?(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("high"),r)),e.stroke(),e.beginPath(),e.strokeStyle=this.model.get("chartDisplayAreaKagiUpColor"),e.lineWidth=2,e.moveTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("high"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),r)),e.stroke(),o.isThick=!0,o.limitValue=i.get("close")):(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),r)),e.stroke()):(e.beginPath(),e.moveTo(this.xRatio*(t-1)+this.xRatio/2,this.getValuePosition(a.get("close"),r)),e.lineTo(this.xRatio*t+this.xRatio/2,this.getValuePosition(i.get("close"),r)),e.stroke())),e.fillStyle=e.strokeStyle,i.bounds={left:this.xRatio*t,top:this.getValuePosition(i.get("high"),r),right:this.xRatio*(t+1),bottom:this.getValuePosition(i.get("low"),r)}},At.prototype.drawKagiSeries=function(e,t){var i,a,n,o="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&t.get("elements").length>=this.displayFromIndex){i=t.get("elements")[this.displayFromIndex].get("close"),a=.05*(this.max-this.min),n={isThick:null,limitValue:null},t.get("elements")[this.displayFromIndex+1].get("close")>=i?n.isThick=!0:n.isThick=!1,n.limitValue=t.get("elements")[this.displayFromIndex].get("close");for(var r=t.get("elements")[this.displayFromIndex],s=t.get("elements").length,l=this.displayFromIndex+1;l<=this.displayToIndex&&l<s;l+=1)t.get("elements")[l].get("isFake")||(this.drawKagi(e,l-this.displayFromIndex,t.get("elements")[l],r,a,n,o),r=t.get("elements")[l]);this.lastKagiArgs={isThick:n.isThick,limitValue:n.limitValue,kagiBasePrice:i,kagiReversalValue:a}}},At.prototype.drawLine=function(e,t,i,a,n,o,r){var s=i.get(r=void 0===(r=void 0===r?"value":r)||"value"!==r&&"open"!==r&&"high"!==r&&"low"!==r&&"close"!==r?"value":r),o=this.getValuePosition(s,o);n?e.strokeStyle=n:null===a||a.get(r)>s?e.strokeStyle=this.model.get("chartDisplayAreaLineDownColor"):e.strokeStyle=this.model.get("chartDisplayAreaLineUpColor"),i.x=this.xRatio*t+this.xRatio/2,i.y=o,null===a?e.moveTo(i.x,i.y):(e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(i.x,i.y),e.stroke()),i.bounds={left:this.xRatio*t,top:o,right:this.xRatio*(t+1),bottom:o}},At.prototype.drawLine2=function(e,t,i,a,n,o){i&&(o=i.get(o),n=this.getValuePosition(o,n),i.x=this.xRatio*t+this.xRatio/2,i.y=n,a?(e.moveTo(a.x,a.y),e.lineTo(i.x,i.y)):e.moveTo(i.x,i.y),i.bounds={left:this.xRatio*t,top:n,right:this.xRatio*(t+1),bottom:n})},At.prototype.drawLineSeries=function(e,t,i){var a,n,o,r=t.get("displayColor"),s="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&t.get("elements").length>=this.displayFromIndex)for((void 0===i||"value"!==i&&"open"!==i&&"high"!==i&&"low"!==i&&"close"!==i)&&(i="value"),e.lineWidth=t.get("lineThickness"),o=t.get("elements")[this.displayFromIndex],this.drawLine(e,0,o,null,r,s,i),(n=o).get("isFake")&&(n=null),"ZigZag Line"===t.get("displayName")&&null===t.get("elements")[this.displayFromIndex+1].get("value")&&(this.drawLine(e,1,this.allSeries[0].get("elements")[this.displayFromIndex+1],null,r,s,"value"),n=this.allSeries[0].get("elements")[this.displayFromIndex+1]),a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)(o=t.get("elements")[a])&&!o.get("isFake")&&(this.drawLine(e,a-this.displayFromIndex,o,n,r,s,i),n=o)},At.prototype.drawLineSeries2=function(e,t,i){var a,n,o,r,s=t.get("displayColor"),l="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&t.get("elements").length>=this.displayFromIndex)if(e.lineWidth=t.get("lineThickness"),o=t.get("elements")[this.displayFromIndex],this.drawLine2(e,0,o,null,l,i),n=o&&o.get("isFake")?null:o,"ZigZag Line"===t.get("displayName")&&null===t.get("elements")[this.displayFromIndex+1].get("value")&&(this.drawLine(e,1,this.allSeries[0].get("elements")[this.displayFromIndex+1],null,s,l,"value"),n=this.allSeries[0].get("elements")[this.displayFromIndex+1]),s=!s&&this.model.get("chartDisplayAreaLineUpColor")===this.model.get("chartDisplayAreaLineDownColor")?this.model.get("chartDisplayAreaLineUpColor"):s){for(e.strokeStyle=s,e.beginPath(),a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)(o=t.get("elements")[a])&&!o.get("isFake")&&(this.drawLine2(e,a-this.displayFromIndex,o,n,l,i),n=o);e.stroke()}else{for(e.strokeStyle=this.model.get("chartDisplayAreaLineUpColor"),e.beginPath(),a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)(o=t.get("elements")[a])&&n&&!o.get("isFake")&&((r=n.get(i))<=o.get(i)?this.drawLine2(e,a-this.displayFromIndex,o,n,l,i):this.drawLine2(e,a-this.displayFromIndex,o,null,l,i)),n=o;for(e.stroke(),e.strokeStyle=this.model.get("chartDisplayAreaLineDownColor"),e.beginPath(),a=this.displayFromIndex+1;a<=this.displayToIndex;a+=1)(o=t.get("elements")[a])&&n&&!o.get("isFake")&&(r=n.get(i),o.get(i)<r?this.drawLine2(e,a-this.displayFromIndex,o,n,l,i):this.drawLine2(e,a-this.displayFromIndex,o,null,l,i)),n=o;e.stroke()}},At.prototype.drawMountainLineSeries=function(e,t){var i,a,n,o,r=t.get("displayColor"),s=[],l="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;if(t&&t.get("elements").length>=this.displayFromIndex){for(e.lineWidth=t.get("lineThickness"),n=t.get("elements")[this.displayFromIndex],this.drawLine(e,0,n,null,r,l),(a=n).x=.5*this.xRatio,a.y=this.getValuePosition(a.get("close")),a.get("isFake")&&(a=null),s.push(a),i=this.displayFromIndex+1;i<=this.displayToIndex;i+=1)(n=t.get("elements")[i])&&!n.get("isFake")&&(n.x=this.xRatio*(i-this.displayFromIndex)+this.xRatio/2,n.y=this.getValuePosition(n.get("close"),l),this.drawLine(e,i-this.displayFromIndex,n,a,r,l,"value"),a=n,s.push(n));if(e.fillStyle="rgba(127, 127, 127, 0.3)",a){for(e.moveTo(a.x,a.y);null!==(o=s.pop())&&o;)e.lineTo(o.x,o.y);e.lineTo(.5*this.xRatio,this.getValuePosition(this.min)),e.lineTo(a.x,this.getValuePosition(this.min)),e.closePath(),e.fillStyle="rgba(127, 127, 127, 0.3)",e.fill()}}},At.prototype.drawOHLCBar=function(e,t,i,a){var n,o,r,s,l;void 0===a&&(a=0),i&&(i.get("open")<=i.get("close")?e.strokeStyle=this.model.get("chartDisplayAreaBarUpColor"):e.strokeStyle=this.model.get("chartDisplayAreaBarDownColor"),n=this.getValuePosition(i.get("open"),a),o=this.getValuePosition(i.get("high"),a),r=this.getValuePosition(i.get("low"),a),s=this.getValuePosition(i.get("close"),a),l=this.xRatio*(t+1)-this.xRatio/2,a=this.xRatio*t+.07*this.xRatio,t=this.xRatio*(t+1)-.07*this.xRatio,e.beginPath(),e.moveTo(Math.floor(l)+.5,Math.floor(o)+.5),e.lineTo(Math.floor(l)+.5,Math.floor(r)+.5),e.moveTo(Math.floor(a)+.5,Math.floor(n)+.5),e.lineTo(Math.floor(l)+.5,Math.floor(n)+.5),e.moveTo(Math.floor(l)+.5,Math.floor(s)+.5),e.lineTo(Math.floor(t)+.5,Math.floor(s)+.5),e.stroke(),e.fillStyle=e.strokeStyle,i.bounds={left:a,top:o,right:t,bottom:r})},At.prototype.drawOHLCBarSeries=function(e,t){var i,a="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;for(e.lineWidth=1,i=this.displayFromIndex;i<=this.displayToIndex;i+=1)this.drawOHLCBar(e,i-this.displayFromIndex,t.get("elements")[i],a)},At.prototype.drawPivotLine=function(e,t,i,a,n,o,r,s,l){void 0===r&&(r=0),void 0===s&&(s=0),void 0===l&&(l="");var d,c;i&&(c=i.get("value"),d=this.getValuePosition(c,o),c=this.model.get("mainChartAreaValuesAxisDecimalPlaces"),n?e.strokeStyle=n:(r||i.get("value"))<this.allSeries[0].get("elements")[t+this.displayFromIndex].get("close")?e.strokeStyle=this.model.get("chartDisplayAreaLineDownColor"):e.strokeStyle=this.model.get("chartDisplayAreaLineUpColor"),i.x=this.xRatio*t+this.xRatio/2,i.y=d,null===a?e.moveTo(i.x,i.y):(e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(i.x,i.y),e.stroke()),r&&s&&(e.font="12px Arial",e.fillStyle=e.strokeStyle,e.textBaseline="middle",e.textAlign="right",e.fillText((l?l+": ":"")+r.toFixed(c),i.x-1,this.getValuePosition(r,o)-6-1)),i.bounds={left:this.xRatio*t,top:d,right:this.xRatio*(t+1),bottom:d})},At.prototype.drawPivotLineSeries=function(e,t){var i=0,a=t.get("displayColor"),n="percent"===this.model.get("stockDisplayValues")?t.get("percentBase"):null;e.lineWidth=t.get("lineThickness"),r=t.get("elements")[this.displayFromIndex],this.drawPivotLine(e,0,r,null,a,n);for(var o,r,s=r,l={"Support 1":"S1","Support 2":"S2","Support 3":"S3","Resistance 1":"R1","Resistance 2":"R2","Resistance 3":"R3"}[t.get("displayName")],d=this.displayFromIndex+1;d<=this.displayToIndex;d+=1)(r=t.get("elements")[d])&&r.get("isFake")&&(o=r.get("quoteDate"),(r=s.clone()).set("quoteDate",o)),r&&!r.get("isFake")&&(r.get("value")!==s.get("value")?(i=s.get("value"),s=null):i=0,d===this.displayToIndex-1&&(i=r.get("value")),this.drawPivotLine(e,d-this.displayFromIndex,r,s,a,n,i,t.get("displayPrices"),l),s=r)},At.prototype.drawProfitAreaSeries=function(e,t){var i,a,n,o,r,s=[],l=t.get("elements"),d=l[this.displayFromIndex],c=d.get("isInProfit"),h=c?(e.fillStyle=t.get("profitColor"),a=d.get("high"),d.get("low")):(e.fillStyle=t.get("lossColor"),a=d.get("low"),d.get("high"));for(e.beginPath(),d.x=.5*this.xRatio,d.y=this.getValuePosition(a),d.y2=this.getValuePosition(h),e.moveTo(d.x,d.y),s.push(d),i=this.displayFromIndex+1;i<=this.displayToIndex;i+=1){if((n=l[i]).get("isFake")){for(;null!==(r=s.pop());)e.lineTo(r.x,r.y2);return e.closePath(),void e.fill()}if(h=n.get("isInProfit")?(a=n.get("high"),n.get("low")):(a=n.get("low"),n.get("high")),n.get("isInProfit")===c)n.x=this.xRatio*(i-this.displayFromIndex+.5),n.y=this.getValuePosition(a),n.y2=this.getValuePosition(h),e.lineTo(n.x,n.y),s.push(n);else if(c=n.get("isInProfit"),n.x=this.xRatio*(i-this.displayFromIndex+.5),n.y=this.getValuePosition(a),n.y2=this.getValuePosition(h),o=this.findIntersection(d.x,d.y,n.x,n.y,d.x,d.y2,n.x,n.y2)){for(e.lineTo(o[0],o[1]);null!==(r=s.pop());)e.lineTo(r.x,r.y2);e.closePath(),e.fill(),e.beginPath(),e.moveTo(o[0],o[1]),e.fillStyle=c?t.get("profitColor"):t.get("lossColor"),e.lineTo(n.x,n.y),s.push(n)}d=n}for(;null!==(r=s.pop());)e.lineTo(r.x,r.y2);o&&e.lineTo(o[0],o[1]),e.closePath(),e.fill()},At.prototype.findIntersection=function(e,t,i,a,n,o,r,s){var l=a-t,d=e-i,c=i*t-e*a,h=l*n+d*o+c,p=l*r+d*s+c;if(0!=h&&0!=p&&0<=h*p&&t!==a&&t!==o&&t!==s&&a!==o&&a!==s&&o!==s)return null;var h=s-o,p=n-r,n=r*o-n*s,e=h*e+p*t+n,i=h*i+p*a+n;if(0!=e&&0!=i&&0<=e*i&&t!==a&&t!==o&&t!==s&&a!==o&&a!==s&&o!==s)return null;o=l*p-h*d;return 0==o?null:(s=o<0?-o/2:o/2,[(p=d*n-p*c)<0?(p-s)/o:(p+s)/o,(p=h*c-l*n)<0?(p-s)/o:(p+s)/o])},At.prototype.getLiveElementValue=function(e){var t="max"===e?1/0:-1/0;switch(this.allSeries[0].get("displayType")){case"Bar":case"Histogram":case"Kagi":case"Dots":case"Line":case"PivotLine":case"Mountain":t=this.allSeries[0].get("liveElement").get("value");break;case"LineOpen":t=this.allSeries[0].get("liveElement").get("open");break;case"LineHigh":t=this.allSeries[0].get("liveElement").get("high");break;case"LineLow":t=this.allSeries[0].get("liveElement").get("low");break;case"LineClose":t=this.allSeries[0].get("liveElement").get("close");break;case"OHLCBar":case"ProfitArea":case"CandleStick":case"HeikinAshi":t="max"===e?this.allSeries[0].get("liveElement").get("high"):this.allSeries[0].get("liveElement").get("low");break;default:throw new Error("Series require a display type.")}return t},At.prototype.getPositionDate=function(e){var t=e-this.$mainCanvas.offset().left,e=Math.floor(t/this.xRatio),t=[];return 0<=e&&e<=this.displayToIndex-this.displayFromIndex?t=[this.allDates[this.displayFromIndex+e],this.displayFromIndex+e,this.allSeries[0].get("elements")[this.displayFromIndex+e]]:this.isAnyLiveElementActive()&&this.displayFromIndex+e===this.displayToIndex+1&&(t=[this.allSeries[0].get("liveElement").get("quoteDate"),this.displayFromIndex+e,this.allSeries[0].get("liveElement")]),t},At.prototype.getPositionIndex=function(e){e-=this.$mainCanvas.offset().left,e=Math.floor(e/this.xRatio)+this.displayFromIndex;return e<0?e=0:e>=this.allSeries[0].get("elements").length&&(e=this.allSeries[0].get("elements").length-1),e},At.prototype.getPositionValue=function(e){e-=this.$mainCanvas.offset().top;return(this.$mainCanvas.prop("height")-e)/this.yRatio+this.min},At.prototype.getValuePosition=function(e,t){return(t=void 0===t?0:t)?this.$mainCanvas.prop("height")-((e-t)/t-this.min)*this.yRatio:this.$mainCanvas.prop("height")-(e-this.min)*this.yRatio},At.prototype.hideLiveElementsCanvas=function(){this.liveCanvasDisplayed&&(this.$liveElementsCanvas.css({display:"none"}),this.liveCanvasDisplayed=!1)},At.prototype.initializeEvents=function(){var e=this;this.model.bind("change:chartDisplayAreaLineUpColor",function(){0<e.allSeries.length&&["Line","Mountain","LineOpen","LineHigh","LineLow","LineClose"].includes(e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaLineDownColor",function(){0<e.allSeries.length&&["Line","Mountain","LineOpen","LineHigh","LineLow","LineClose"].includes(e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickUpStroke",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickDownStroke",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickUpIsHollow",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickUpFill",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaCandleStickDownFill",function(){0<e.allSeries.length&&("CandleStick"===e.allSeries[0].get("displayType")||"HeikinAshi"===e.allSeries[0].get("displayType"))&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaBarUpColor",function(){0<e.allSeries.length&&"OHLCBar"===e.allSeries[0].get("displayType")&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaBarDownColor",function(){0<e.allSeries.length&&"OHLCBar"===e.allSeries[0].get("displayType")&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaKagiUpColor",function(){0<e.allSeries.length&&"Kagi"===e.allSeries[0].get("displayType")&&e.updateDisplay()}),this.model.bind("change:chartDisplayAreaKagiDownColor",function(){0<e.allSeries.length&&"Kagi"===e.allSeries[0].get("displayType")&&e.updateDisplay()})},At.prototype.isAnyLiveElementActive=function(){return _.some(this.allSeries,function(e){return e.get("liveElement")})},At.prototype.isLastElementOnDisplay=function(){return!(!this.allSeries[0]||!this.allSeries[0].get("elements")[this.displayToIndex])&&this.allSeries[0].get("elements")[this.displayToIndex].get("isFake")},At.prototype.niceNum=function(e,t){var i=Math.floor(Math.log(e)/Math.log(10)),e=e/Math.pow(10,i);return(t?e<1.5?1:e<3?2:e<7?5:10:e<=1?1:e<=2?2:e<=5?5:10)*Math.pow(10,i)},At.prototype.onLiveElementChanged=function(e){var t=this.isLastElementOnDisplay();t&&this.isLiveElementsCanvasVisible?this.isAnyLiveElementActive()?this.updateLiveElementsCanvas():(e.updateMinMax(),this.updateDisplayMinMaxLength(),this.isDisplayPending=!0,this.applyLayout()):t&&(e.updateMinMax(),this.updateDisplayMinMaxLength(),this.isDisplayPending=!0,this.applyLayout())},At.prototype.onLiveElementValuesChanging=function(){var e,t,i=this.isLastElementOnDisplay();i&&this.isLiveElementsCanvasVisible?(e=this.min,t=this.max,this.updateDisplayMinMaxLength(),this.updateRatios(),e>this.min||t<this.max?this.updateDisplay():this.updateLiveElementsCanvas()):i?(this.updateDisplayMinMaxLength(),this.isDisplayPending=!0,this.applyLayout()):$(this).trigger("liveElementCanvasUpdated",{type:"liveElementCanvasUpdated"})},At.prototype.onResize=function(){0<this.allSeries.length&&(this.applyLayout(),(this.displayFromIndex||0===this.displayFromIndex)&&this.displayToIndex?this.updateDisplay():this.displaySeries(-1,-1))},At.prototype.refreshDates=function(){var e,t;this.allDates=[],this.allDatesTags=[];for(var i=this.allSeries[0].get("elements").length,a=0;a<i;a+=1)e=this.allSeries[0].get("elements")[a],0<a&&e.set({dateTag:Helpers.getDateTag(e.get("quoteDate"),t)}),this.allDates.push(e.get("quoteDate")),this.allDatesTags.push(e.get("dateTag")),e.set({index:a}),t=e.get("quoteDate");$(this).trigger("dates-refreshed")},At.prototype.remove=function(){return zt.prototype.remove.call(this),this},At.prototype.updateDisplayMinMaxLength=function(){var t,i,e,a,n,o,r,s="percent"===this.model.get("stockDisplayValues"),l=this.min,d=this.max;0<this.allSeries.length&&(s?(this.percentBase=this.allSeries[0].get("percentBase"),t=_.map(this.allSeries,function(e){return e.get("percentMax")}),i=_.map(this.allSeries,function(e){return e.get("percentMin")})):(t=[],i=[],_.each(this.allSeries,function(e){"PivotLine"!==e.get("displayType")&&(a=e.get("seriesMax"),_.isNaN(a)||t.push(a),a=e.get("seriesMin"),_.isNaN(a)||i.push(a))})),this.isLiveElementsCanvasVisible&&this.allSeries[0].get("liveElement")&&(o=this.getLiveElementValue("max"),r=this.getLiveElementValue("min"),s&&(o!==1/0&&(o=(o-this.percentBase)/this.percentBase),r!==-1/0&&(r=(r-this.percentBase)/this.percentBase)),t.push(o),i.push(r)),t=_.without(t,1/0),i=_.without(i,-1/0),this.realMax=_.max(t),this.realMin=_.min(i),this.model.get("autoZoomY")||(o=this.model.get("zoomYLevel"),r=.01*(this.realMax-this.realMin),0<o?(this.realMin=this.realMin+o*r,this.realMax=this.realMax-o*r):o<0?(this.realMin=this.realMin-o*-r,this.realMax=this.realMax+o*-r):this.staticRealMax&&this.staticRealMin?(this.realMin=this.staticRealMin<this.realMin?this.staticRealMin:this.realMin,this.realMax=this.staticRealMax>this.realMax?this.staticRealMax:this.realMax):void 0!==this.staticRealMaxPts&&null!==this.staticRealMaxPts&&void 0!==this.staticRealMinPts&&null!==this.staticRealMinPts&&0<=this.staticRealMaxPts&&0<=this.staticRealMinPts&&(this.staticPtsPrice||(n=_.last(this.allSeries[0].get("elements")),this.staticPtsPrice=n.get("value")),e=Math.pow(10,this.model.get("mainChartAreaValuesAxisDecimalPlaces")-1),this.realMax=Math.max(this.realMax,this.staticPtsPrice+this.staticRealMaxPts/e),n=this.staticPtsPrice-this.staticRealMinPts/e,this.realMin=Math.min(this.realMin,Math.max(n,0)))),_.isFinite(this.realMin)&&_.isFinite(this.realMax)?this.realMin===this.realMax&&(this.realMin-=.1*this.realMin,this.realMax+=.1*this.realMax):(this.realMin=_.min(this.displayValues),this.realMax=_.max(this.displayValues)),this.displayValues=this.calculateDisplayValues(this.realMin,this.realMax),this.seriesMarkers&&(this.displayValues=this.seriesMarkers.concat(this.displayValues||[])),e=_.min(this.displayValues.concat([this.realMin])),n=_.max(this.displayValues.concat([this.realMax])),_.isFinite(e)&&_.isFinite(this.realMin)?e<this.realMin?this.min=e:this.min=this.realMin:_.isFinite(e)?this.min=e:this.min=this.realMin,_.isFinite(n)&&_.isFinite(this.realMax)?n>this.realMax?this.max=n:this.max=this.realMax:_.isFinite(n)?this.max=n:this.max=this.realMax,this.elementsCount=this.displayToIndex-this.displayFromIndex+1,this.hasPriceRangeChanged=e!==l||n!==d)},At.prototype.updateLiveElementsCanvas=function(){var e,t,i,a,n;if(this.allSeries[0]){var o=this.$liveElementsCanvas[0].getContext("2d"),r=this.$liveElementsCanvas.width(),s=this.$liveElementsCanvas.height();o.clearRect(0,0,r,s),o.strokeWidth=1;switch(this.allSeries[0].get("displayType")){case"Bar":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}this.drawBar(o,1,this.allSeries[0].get("liveElement"),e);break;case"Kagi":if(this.lastKagiArgs){for(i=this.lastKagiArgs.isThick,l=this.lastKagiArgs.limitValue,t=this.lastKagiArgs.kagiReversalValue,i={isThick:i,limitValue:l},n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}var l=this.allSeries[0].get("liveElement");l&&this.drawKagi(o,1,l,e,t,i)}break;case"CandleStick":this.drawCandleStick(o,1,this.allSeries[0].get("liveElement"),!1);break;case"Histogram":throw"Drawing of histogram live element is not supported!";case"PivotLine":throw"Drawing of pivot line live element is not supported!";case"Line":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"value");break;case"LineOpen":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"open");break;case"LineHigh":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"high");break;case"LineLow":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"low");break;case"LineClose":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"close");break;case"OHLCBar":this.drawOHLCBar(o,1,this.allSeries[0].get("liveElement"));break;case"HeikinAshi":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.hashi&&this.drawHeikinAshi(o,1,this.allSeries[0].get("liveElement"),e,e.hashi);break;case"Mountain":for(n=(a=this.allSeries[0].get("elements")).length-1;0<=n;--n)if(!a[n].get("isFake")){e=a[n];break}e.x=this.xRatio/2,this.drawLine(o,1,this.allSeries[0].get("liveElement"),e,this.allSeries[0].get("displayColor"),"percent"===this.model.get("stockDisplayValues")?this.allSeries[0].get("percentBase"):null,"value"),o.fillStyle="rgba(127, 127, 127, 0.3)",o.lineTo(1.5*this.xRatio,this.getValuePosition(0)),o.lineTo(e.x,this.getValuePosition(0)),o.closePath(),o.fill();break;default:throw new Error("Series require a display type.")}$(this).trigger("liveElementCanvasUpdated",{type:"liveElementCanvasUpdated"})}},At.prototype.updateRatios=function(){var e=this.mainCanvasWidth,t=this.mainCanvasHeight,i=this.max-this.min;this.xRatio=e/this.elementsCount,this.yRatio=t/i},At),zt;function At(e){var t=zt.call(this,e)||this;return t.allDates=[],t.allDatesTags=[],t.allSeries=[],t.liveElements=[],t.seriesMarkers=[],t.options=e,t.drawingLocked=e.drawingLocked,t.isLayoutApplied=!1,t.isDisplayPending=!1,t.hideLiveElementsCanvas(),t.applyTemplate(),t.onResize(),t.initializeEvents(),t}var HorizontalAxis=(Sz=Backbone.View,__extends(Tz,Sz),Tz.prototype.applyLayout=function(e,t){this.$mainCanvas.prop("width",e),this.$mainCanvas.prop("height",t),this.$textsDiv.css({width:e,height:t})},Tz.prototype.applyTemplate=function(){var e=this.model.get("chartBorderColor");this.selectedDates=[],this.$el.html(T.HorizontalAxis()),this.$mainCanvas=this.$el.find(".MainCanvas"),this.$textsDiv=this.$el.find(".TextsDiv"),this.$borderDiv=this.$el.find(".borderDiv"),this.$axisTextMinor=this.$el.find(".axisTextMinor"),this.$axisTextMajor=this.$el.find(".axisTextMajor"),this.$borderDiv.css({"background-color":this.model.get("chartDisplayAreaBackground"),"border-left-color":e,"border-right-color":e})},Tz.prototype.drawDisplayDates=function(){if(this.displayDates){var e,t,i=void 0,a=void 0,n=void 0,o=void 0,r=-1,s=this.$textsDiv.width()-5,a=this.displayDates.length;if(this.displayDivs.length<a)for(i=this.displayDivs.length;i<a;i+=1)(n=$(document.createElement("div"))).appendTo(this.$textsDiv),this.displayDivs.push(n);for(a=this.displayDivs.length,i=0;i<a;i+=1)this.displayDates[i]&&this.displayDates[i].date&&i<this.displayDates.length?(e=this.displayDates[i].date.format(this.displayDates[i].format),this.displayDivs[i].html(e),t=this.displayDivs[i].width(),(o=this.displayDates[i].position+6-t/2)<3?o=3:s<o+t&&(o=s-(o+t+3)),o<r?this.displayDivs[i].css("display","none"):(this.displayDivs[i].css({display:"block",left:o}),r=o+t),this.displayDates[i].isMajorTick?(this.displayDivs[i].removeClass("axisTextMinor"),this.displayDivs[i].addClass("axisTextMajor"),this.displayDivs[i].css("color",this.model.get("axisTextMajor"))):(this.displayDivs[i].removeClass("axisTextMajor"),this.displayDivs[i].addClass("axisTextMinor"),this.displayDivs[i].css("color",this.model.get("axisTextMinor")))):(this.displayDivs[i].removeClass("axisTextMinor"),this.displayDivs[i].removeClass("axisTextMajor"),this.displayDivs[i].css("color",""),this.displayDivs[i].css("display","none"));this.$axisTextMinor=this.$el.find(".axisTextMinor"),this.$axisTextMajor=this.$el.find(".axisTextMajor")}},Tz.prototype.drawSelectedDate=function(e,t){var i,a,n,o,r=this.$mainCanvas[0].getContext("2d"),s=this.$mainCanvas.prop("width"),l=this.$mainCanvas.prop("height");switch(t&&r.clearRect(0,0,s,l),this.model.get("granularity")){case"OneDay":case"OneWeek":case"OneMonth":o="d mmm yyyy",a=85;break;case"Tick":o="d mmm yyyy HH:MM:ss",a=150;break;default:o="d mmm yyyy HH:MM",a=120}e&&e[0]&&(n=e[1]+this.axisLeft,i=l/2,t=e[0].format(o),l=a+8,r.font="bold 11px Verdana",(n=(e=n-a/2)-4)<0?(n=0,e=4):s<n+l&&(e=(n=s-l)+4),s=i-5.5-2,r.textAlign="center",r.textBaseline="middle",r.fillStyle=this.model.get("selectedBackground"),r.strokeStyle=this.model.get("crosshairColor"),this.fillRectRound(r,n,s,l,15,4),r.stroke(),r.fillStyle=this.model.get("selectedForeground"),r.fillText(t,Math.floor(e+a/2)+.5,Math.floor(i)+.5))},Tz.prototype.fillRectRound=function(e,t,i,a,n,o){e.beginPath(),e.moveTo(Math.floor(t+o)+.5,Math.floor(i)+.5),e.lineTo(Math.floor(t+a-o)+.5,Math.floor(i)+.5),e.quadraticCurveTo(Math.floor(t+a)+.5,Math.floor(i)+.5,Math.floor(t+a)+.5,Math.floor(i+o)+.5),e.lineTo(Math.floor(t+a)+.5,Math.floor(i+n-o)+.5),e.quadraticCurveTo(Math.floor(t+a)+.5,Math.floor(i+n)+.5,Math.floor(t+a-o)+.5,Math.floor(i+n)+.5),e.lineTo(Math.floor(t+o)+.5,Math.floor(i+n)+.5),e.quadraticCurveTo(Math.floor(t)+.5,Math.floor(i+n)+.5,Math.floor(t)+.5,Math.floor(i+n-o)+.5),e.lineTo(Math.floor(t)+.5,Math.floor(i+o)+.5),e.quadraticCurveTo(Math.floor(t)+.5,Math.floor(i)+.5,Math.floor(t+o)+.5,Math.floor(i)+.5),e.closePath(),e.fill()},Tz.prototype.initialize=function(e){this.options=e,this.axisTop=0,this.axisBottom=0,this.displayDivs=[],this.applyTemplate(),this.onResize(),this.initializeEvents()},Tz.prototype.initializeEvents=function(){var e=this;this.model.on("change:chartDisplayAreaBackground",function(){e.$borderDiv.css("background-color",e.model.get("chartDisplayAreaBackground"))}),this.model.on("change:axisTextMinor",function(){e.$axisTextMinor.css("color",e.model.get("axisTextMinor"))}),this.model.on("change:axisTextMajor",function(){e.$axisTextMajor.css("color",e.model.get("axisTextMajor"))}),this.model.on("change:chartBorderColor",function(){e.$borderDiv.css({"border-left-color":e.model.get("chartBorderColor"),"border-right-color":e.model.get("chartBorderColor")})})},Tz.prototype.onResize=function(){var e=this.$el.width(),t=this.$el.height();this.applyLayout(e,t),0<e&&0<t&&(this.drawDisplayDates(),this.updateDisplay())},Tz.prototype.setSelectedDates=function(e){this.selectedDates=e||[],this.updateDisplay()},Tz.prototype.setDates=function(e){this.displayDates=e,this.drawDisplayDates()},Tz.prototype.setAxisLeftRight=function(e,t){this.axisLeft=e,this.axisRight=t,this.$borderDiv.css("width",t)},Tz.prototype.updateDisplay=function(){this.drawSelectedDate(this.selectedDates[0],!0);for(var e=this.selectedDates.length,t=1;t<e;t+=1)this.drawSelectedDate(this.selectedDates[t],!1)},Tz),Sz;function Tz(){return null!==Sz&&Sz.apply(this,arguments)||this}var VerticalAxis=(KA=Backbone.View,__extends(LA,KA),LA.prototype.applyLayout=function(e,t){this.$mainCanvas.prop("width",e),this.$mainCanvas.prop("height",t),$(this.$textsDiv).css({width:e,height:t})},LA.prototype.applyTemplate=function(){$(this.el).html(T.VerticalAxis()),this.$mainCanvas=this.$el.find(".vertical-axis-canvas"),this.$textsDiv=this.$el.find(".TextsDiv")},LA.prototype.drawDisplayValues=function(){if(this.displayValues){var e,t=void 0,i=void 0,a=void 0,n="percent"===this.model.get("stockDisplayValues")?"%":"",i=this.displayValues.length;if(this.displayDivs.length<i)for(t=this.displayDivs.length;t<i;t+=1)(a=$(document.createElement("div"))).addClass("axisText"),a.appendTo(this.$textsDiv),this.displayDivs.push(a);for(i=this.displayDivs.length,t=0;t<i;t+=1)t<this.displayValues.length&&0<(e=Math.floor(this.displayValues[t][1]+this.axisTop))?(this.displayDivs[t].html(this.displayValues[t][0].toFixed(this.decimalPlaces)+n),this.displayDivs[t].css({display:"block",top:e})):this.displayDivs[t].css("display","none")}},LA.prototype.drawLastValue=function(){var e,t,i,a,n=this.$mainCanvas[0].getContext("2d"),o=this.$mainCanvas.prop("width"),r=this.$mainCanvas.prop("height");n.clearRect(0,0,o,r),this.lastValue?(t=o/2,i=this.displayArea.getValuePosition(this.lastValue,!1),a=this.lastValue.toFixed(this.decimalPlaces),n.font="11px Verdana",e=t-21.5-2,r=i-5.5-2,n.textAlign="center",n.textBaseline="middle",n.fillStyle=this.goingUp?this.model.get("cloudPriceUp"):this.model.get("cloudPriceDown"),n.strokeStyle="white",n.beginPath(),"Left"===this.axisSide?(n.moveTo(51+e,r),n.lineTo(51+e+7,7.5+r),n.lineTo(51+e,15+r),n.lineTo(4+e,15+r),n.quadraticCurveTo(e,15+r,e,15+r-4),n.lineTo(e,4+r),n.quadraticCurveTo(e,r,4+e,r),this.$el&&(o=this.$el.offset(),$(this).trigger("liveCloudChanged",{type:"liveCloudChanged",left:o.left+e,top:o.top+r,width:51,height:15,show:!0,source:"leftAxis"}))):"Right"===this.axisSide&&(n.moveTo(e,r),n.lineTo(e-7,7.5+r),n.lineTo(e,15+r),n.lineTo(51+e-4,15+r),n.quadraticCurveTo(51+e,15+r,51+e,15+r-4),n.lineTo(51+e,4+r),n.quadraticCurveTo(51+e,r,51+e-4,r),n.lineTo(e,r),$(this).trigger("liveCloudChanged",{type:"liveCloudChanged",left:this.$el.offset().left+e,top:this.$el.offset().top+r,width:51,height:15,show:!0,source:"rightAxis"})),n.fill(),n.stroke(),n.fillStyle="white",n.fillText(a,t,i)):$(this).trigger("liveCloudChanged",{type:"liveCloudChanged",show:!1,source:"Right"===this.axisSide?"rightAxis":"leftAxis"})},LA.prototype.drawSelectedValue=function(){var e,t,i,a,n=this.$mainCanvas[0].getContext("2d"),o=this.$mainCanvas.prop("width"),r="percent"===this.model.get("stockDisplayValues")?"%":"";this.selectedValue&&(e=o/2,t=this.selectedValue[1]+this.axisTop,i=this.selectedValue[0].toFixed(this.model.get(this.prefix+"ValuesAxisDecimalPlaces"))+r,a=n.measureText(i).width,n.font="11px Verdana",o=e-a/2-2,r=t-5.5-2,a=a+8,n.textAlign="center",n.textBaseline="middle",n.fillStyle=this.model.get("selectedBackground"),n.strokeStyle=this.model.get("crosshairColor"),n.beginPath(),"Left"===this.axisSide?(n.moveTo(o+a,r),n.lineTo(o+a+7,7.5+r),n.lineTo(o+a,15+r),n.lineTo(4+o,15+r),n.quadraticCurveTo(o,15+r,o,15+r-4),n.lineTo(o,4+r),n.quadraticCurveTo(o,r,4+o,r)):"Right"===this.axisSide&&(n.moveTo(o,r),n.lineTo(o-7,7.5+r),n.lineTo(o,15+r),n.lineTo(o+a-4,15+r),n.quadraticCurveTo(o+a,15+r,o+a,15+r-4),n.lineTo(o+a,4+r),n.quadraticCurveTo(o+a,r,o+a-4,r)),n.closePath(),n.fill(),n.stroke(),n.fillStyle=this.model.get("selectedForeground"),n.fillText(i,e,t))},LA.prototype.initialize2=function(e){var t=this;this.options=e,this.axisSide=e.axisSide,this.prefix=e.prefix,this.decimalPlaces=e.decimalPlaces,this.displayArea=e.displayArea,this.axisTop=0,this.axisBottom=0,this.displayDivs=[],this.lastBackground=this.model.get("liveGreenColor")||this.model.get("greenColor"),this.applyTemplate(),this.onResize(),e.showLastValue&&(this.listenTo(this.model,"change:lastAvgPrice",function(){return t.onLastPriceChanged()}),this.onLastPriceChanged())},LA.prototype.onLastPriceChanged=function(){var e=this.model.get("lastAvgPrice");this.lastValue&&(this.lastValue>e?this.goingUp=!1:this.lastValue<e&&(this.goingUp=!0)),this.lastValue=e,this.updateDisplay()},LA.prototype.onResize=function(){var e=this.$el.width(),t=this.$el.height();this.applyLayout(e,t),0<e&&0<t&&(this.drawDisplayValues(),this.updateDisplay())},LA.prototype.setDisplayValues=function(e){this.displayValues=e},LA.prototype.setSelectedValue=function(e){this.selectedValue=e,this.updateDisplay()},LA.prototype.setAxisTopBottm=function(e,t){this.axisTop=e,this.axisBottom=t},LA.prototype.updateDisplay=function(){this.drawLastValue(),this.drawSelectedValue()},LA),KA;function LA(e){var t=KA.call(this,e)||this;return t.lastForeground="#fff",t.goingUp=!1,t.initialize2(e),t}var SeriesToolbarItem=(HB=Backbone.Model,__extends(IB,HB),IB),HB;function IB(){return null!==HB&&HB.apply(this,arguments)||this}var SeriesToolbar=(JB=Backbone.View,__extends(KB,JB),KB.prototype.addSeries=function(e){var t=this,i=document.createElement("div"),a=document.createElement("div"),n=document.createElement("div"),o=new SeriesToolbarItem,r=document.createElement("button"),s=document.createElement("button");o.series=e,$(i).appendTo(this.rootDiv),$(i).css("display","inline"),$(n).appendTo(i),$(a).appendTo(i),$(a).css("display","inline"),$(r).appendTo(n),$(r).prop("title","edit"),$(r).prop("type","button"),$(r).html(e.displayName),r.series=e,$(s).appendTo(n),$(s).prop("type","button"),$(s).html("remove"),s.series=e,$(s).on("click",function(){t.triggetRemoveSeriesRequest($(s),t.series)}),$(r).button(),$(s).button({text:!1,icons:{primary:"ui-icon-closethick"}}),$(n).css("display","inline"),$(n).buttonset();var l=$(this.el).height(),e=$(s).height(),d=l<e;o.editButton=r,o.closeButton=s,o.buttonSet=n,o.rootDiv=i,o.infoText=a,this.allItems.push(o),d&&($(this.el).height(e),$(this).trigger("toolbarresize"))},KB.prototype.applyTemplate=function(){$(this.el).html(T.SeriesToolbar()),this.rootDiv=$(this.el).find(".RootDiv")},KB.prototype.clear=function(){$(this.rootDiv).html(""),this.allItems=[],$(this.el).height(0)},KB.prototype.initialize=function(e){this.options=e,this.allItems=[],this.elementHeight=0,this.applyTemplate()},KB.prototype.triggetRemoveSeriesRequest=function(e,t){e=_.filter(this.allItems,{closeButton:e});0<e.length&&($(e[0].buttonSet).remove(),this.allItems=_.without(this.allItems,e[0]),this.allItems<=0&&($(this.el).height(0),$(this).trigger("toolbarresize")),$(this).trigger("removeSeriesRequest",{type:"removeSeriesRequest",series:t}))},KB),JB;function KB(){return null!==JB&&JB.apply(this,arguments)||this}var ChartModel=($B=Backbone.Model,__extends(_B,$B),_B.prototype.initialize=function(){this.set(_B.defaults)},_B.prototype.initialize2=function(){var e,t=this,i={};this.setColorsForCurrentTheme(!1),i.showTimeSlider=this.get("showTimeSlider"),i.showInfoBorder=this.get("showInfoBorder"),i.isIndicatorsToolbarVisible=this.get("isIndicatorsToolbarVisible"),this.set({originalModel:i}),this.get("isMobile")&&this.set({bottomMarginPx:2,leftMarginPx:0,rightMarginPx:0,topMarginPx:2}),this.get("granularity")||(e=0,(i=(i=_.find(this.get("viewOptions"),{isDefault:!0}))||this.get("viewOptions")[0]).defaultframe&&(e=i.defaultframe),this.set({granularity:i.value,displayPeriod:i.timeframes[e].value,dataPeriod:i.timeframes[e].value},{silent:!0})),this.get("api")&&(this.set("savedAnnotations",this.get("api").getProperty("Basics.annotations")||null),this.listenTo(this,"change:savedAnnotations",function(){return t.onAnnotationsChanged()}),this.set("saved_indicators",this.get("api").getProperty("Basics.indicators")||null),this.listenTo(this,"change:saved_indicators",function(){return t.onIndicatosChanged()}),["chartDisplayAreaHorizontalGridLinesColor","chartDisplayAreaVerticalGridLinesColor","crosshairColor","chartDisplayAreaBackground","crosshairColor","chartDisplayAreaBackground","chartDisplayAreaAlternativeBackground","chartBorderColor","axisTextMajor","axisTextMinor","selectedBackground","selectedForeground","chartDisplayAreaCandleStickUpFill","chartDisplayAreaCandleStickDownFill"].forEach(function(e){t.listenTo(t,"change:"+e,function(e){Object.keys(e.changed).forEach(function(e){t.get("api").setProperty("Style."+e,t.get(e))})})}))},_B.prototype.filterUserSetColors=function(e){var i=this,a=_.clone(e);return _.each(["chartDisplayAreaHorizontalGridLinesColor","chartDisplayAreaVerticalGridLinesColor","crosshairColor","chartDisplayAreaBackground","chartDisplayAreaAlternativeBackground","chartBorderColor","axisTextMajor","axisTextMinor","selectedBackground","selectedForeground","chartDisplayAreaCandleStickUpFill","chartDisplayAreaCandleStickDownFill"],function(e){var t=i.get(e);t&&t!==_B.constants.themeDefaults[e]&&t!==_B.constants.themeOverridesMap.dark[e]&&(a[e]=t)}),a},_B.prototype.onAnnotationsChanged=function(){this.get("api").setProperty("Basics.annotations",this.get("savedAnnotations"))},_B.prototype.onIndicatosChanged=function(){this.get("api").setProperty("Basics.indicators",this.get("saved_indicators"))},_B.prototype.setColorsForCurrentTheme=function(e){var i=this,t=this.get("currentTheme"),t=_B.constants.themeOverridesMap[t]||_B.constants.themeDefaults,t=this.filterUserSetColors(t);this.set(_.extend({},_B.constants.themeDefaults,t),{silent:!0}),e&&_.each(["chartDisplayAreaBackground","chartDisplayAreaAlternativeBackground","chartBorderColor","rightAxisWidthPx"],function(e){var t=i.get(e);i.set(e," ",{silent:!0}),i.set(e,t)})},_B.prototype.changeThemeClassForElementWhenThemeChanges=function(i){var a=this;this.on("change:currentTheme",function(){var e=a.get("supportedThemes"),t=a.get("currentTheme");_.each(e,function(e){i.removeClass(e)}),i.addClass(t)})},_B.constants={themeDefaults:{chartDisplayAreaBackground:"#ffffff",chartDisplayAreaAlternativeBackground:"#ffffff",chartRenderBackground:"#ffffff",chartDisplayAreaHorizontalGridLinesColor:"#D8D8D8",chartDisplayAreaHorizontalGridLinesOpacity:1,chartDisplayAreaHorizontalGridLinesType:[2,3],chartDisplayAreaHorizontalMarkerColor:"#888888",chartDisplayAreaVerticalGridLinesColor:"#D8D8D8",chartDisplayAreaVerticalGridLinesOpacity:1,chartDisplayAreaVerticalGridLinesType:[2,3],chartDisplayAreaLineUpColor:"#0876BD",chartDisplayAreaLineDownColor:"#bd081c",chartDisplayAreaCandleStickUpStroke:"#000000",chartDisplayAreaCandleStickDownStroke:"#000000",chartDisplayAreaCandleStickUpIsHollow:0,chartDisplayAreaCandleStickUpFill:"#0876BD",chartDisplayAreaCandleStickDownFill:"#bd081c",chartDisplayAreaBarUpColor:"#0876BD",chartDisplayAreaBarDownColor:"#bd081c",chartDisplayAreaKagiUpColor:"#0876BD",chartDisplayAreaKagiDownColor:"#bd081c",chartBorderColor:"#c5c5c5",annotationStrokeColor:"#104ab3",annotationFillColor:"#acf1ae",crosshairColor:"#555555",selectedForeground:"#555555",selectedBackground:"#FFFFFF",axisTextMinor:"#646464",axisTextMajor:"#000000",bottomMarginPx:7,leftMarginPx:13,rightMarginPx:13,topMarginPx:7,leftAxisWidthPx:72,rightAxisWidthPx:52,rangeSelectorHeightPx:40},themeOverridesMap:{dark:{chartRenderBackground:"#000000",chartDisplayAreaHorizontalGridLinesColor:"#D8D8D8",chartDisplayAreaHorizontalGridLinesOpacity:.36,chartDisplayAreaHorizontalGridLinesType:[2,3],chartDisplayAreaHorizontalMarkerColor:"#ffffff",chartDisplayAreaVerticalGridLinesColor:"#D8D8D8",chartDisplayAreaVerticalGridLinesOpacity:.36,chartDisplayAreaVerticalGridLinesType:[2,3],chartDisplayAreaLineUpColor:"#ffffff",chartDisplayAreaLineDownColor:"#ffffff",chartDisplayAreaCandleStickUpStroke:"#009933",chartDisplayAreaCandleStickDownStroke:"#d00d00",chartDisplayAreaCandleStickUpIsHollow:0,chartDisplayAreaCandleStickUpFill:"#009933",chartDisplayAreaCandleStickDownFill:"#d00d00",chartDisplayAreaBarUpColor:"#009933",chartDisplayAreaBarDownColor:"#d00d00",chartDisplayAreaKagiUpColor:"#009933",chartDisplayAreaKagiDownColor:"#d00d00",crosshairColor:"#ffffff",selectedForeground:"#000000",selectedBackground:"#ffffff",axisTextMinor:"#ffffff",axisTextMajor:"#ffffff",chartDisplayAreaBackground:"#262626",chartDisplayAreaAlternativeBackground:"#262626",chartBorderColor:"#ffffff",greenColor:"#009933",redColor:"#d00d00",cloudPriceUp:"#009933",cloudPriceDown:"#d00d00",rightAxisWidthPx:59,rightMarginPx:3,rangeSelectorHeightPx:35,annotationStrokeColor:"#e8e824",annotationFillColor:"#e8e824"}}},_B.defaults={stockSymbol:null,displaySymbol:null,stockPickerSymbol:null,displayPeriod:null,dataPeriod:null,granularity:null,isTouch:!1,allowZoom:!0,allowZoomY:!0,autoZoomY:!0,zoomYLevel:0,maxValueY:null,minValueY:null,startLivePrices:!0,isContextMenuEnabled:!0,customChartName:null,showMainChartName:!0,showGranularityAsChartName:!0,snapToDataPoint:!1,fromDate:null,toDate:null,fromDateDisplay:null,toDateDisplay:null,stockDisplayType:"CandleStick",stockDisplayValues:"price",showLastValue:!0,isVolumeChartAreaVisible:!1,isIndicatorsToolbarVisible:!0,bottomMarginPx:7,leftMarginPx:13,rightMarginPx:13,topMarginPx:7,elementsSpacingPx:0,indicatorsToolbarHeightPx:25,showIndicators:!0,indicatorChartAreaHeightPx:55,volumeChartAreaHeightPx:55,rangeSelectorHeightPx:40,isChartDimensionsVisible:!1,isChartDimensionsActive:!1,chartDimensionsWidthPx:null,chartDimensionsHeightPx:null,chartDimensionsHeightPercent:.62,showCrosshair:!1,highlightSelectedValue:!0,highlightSelectedDate:!0,showThemesOptions:!0,currentTheme:"light",supportedThemes:["light","dark"],supportedThemesUItext:["Light Theme","Dark Theme"],greenColor:"#0876BD",redColor:"#bd081c",cloudPriceUp:"#0876BD",cloudPriceDown:"#bd081c",blackColor:"#23a401",isGreenCandleStickHollow:!1,showTimeSlider:!0,showInfoBorder:!0,isInfoBorderInCursorMode:!1,showSaveButton:!0,c:!1,showDrawMenu:!0,showUndoRedoButtons:!1,isZoomSelectionVisible:!0,indicators:[],originalDecimalPlaces:5,mainChartAreaIsBottomAxisVisible:!0,mainChartAreaIsRightAxisVisible:!0,mainChartAreaValuesAxisDecimalPlaces:5,mainChartAreaCanUserResize:!1,indicatorChartAreaIsBottomAxisVisible:!0,indicatorChartAreaIsRightAxisVisible:!0,indicatorChartAreaValuesAxisDecimalPlaces:5,indicatorChartAreaCanUserResize:!0,bottomInnerMarginPx:5,leftInnerMarginPx:7,rightInnerMarginPx:7,topInnerMarginPx:5,seriesBarMarginPx:7,bottomAxisHeightPx:30,leftAxisWidthPx:72,rightAxisWidthPx:52,topAxisHeightPx:30,infoAreaHeightPx:16,isInfoAreaVisible:!1,lineColor:"#1c242a",leftHandleWidhtPx:10,rightHandleWidhtPx:10,rangeSelectorTopInnderMarginPx:2,rangeSelectorBottomInnderMarginPx:2,showArrows:!1,showSliderDates:!0,savedAnnotations:"",indicatorsData:[{IndicatorCode:"ac",IndicatorName:"Accelerator Indicator",IndicatorType:-1,ShortName:"AC",Default:!1,inCompactMode:!1},{IndicatorCode:"aroon",IndicatorName:"Aroon",IndicatorType:-1,ShortName:"AR",Default:!1,inCompactMode:!1},{IndicatorCode:"aroonosc",IndicatorName:"Aroon Oscillator",IndicatorType:-1,ShortName:"OSC",Default:!1,inCompactMode:!1},{IndicatorCode:"ao",IndicatorName:"Awesome Oscillator",IndicatorType:-1,ShortName:"AO",Default:!1,inCompactMode:!1},{IndicatorCode:"atr",IndicatorName:"Average True Range",IndicatorType:-1,ShortName:"ATR",Default:!1,inCompactMode:!1},{IndicatorCode:"bb",IndicatorName:"Bollinger Bands",IndicatorType:0,ShortName:"BB",Default:!0,inCompactMode:!0},{IndicatorCode:"cci",IndicatorName:"Commodity Channel Index (CCI)",IndicatorType:-1,ShortName:"CCI",Default:!0,inCompactMode:!1},{IndicatorCode:"kc",IndicatorName:"Keltner Channels",IndicatorType:0,ShortName:"KC",Default:!1,inCompactMode:!1},{IndicatorCode:"ema",IndicatorName:"Moving Average (Exponential)",IndicatorType:0,ShortName:"EMA",Default:!0,inCompactMode:!0},{IndicatorCode:"macd",IndicatorName:"MACD",IndicatorType:-1,ShortName:"MACD",Default:!0,inCompactMode:!0},{IndicatorCode:"mom",IndicatorName:"Momentum",IndicatorType:0,ShortName:"MOM",Default:!1,inCompactMode:!1},{IndicatorCode:"maenv",IndicatorName:"Moving Average Envelope",IndicatorType:0,ShortName:"ENV",Default:!1},{IndicatorCode:"psar",IndicatorName:"Parabolic SAR",IndicatorType:-1,ShortName:"PSAR",Default:!0,inCompactMode:!1},{IndicatorCode:"po",IndicatorName:"Price Oscillator",IndicatorType:0,ShortName:"PO",Default:!1,inCompactMode:!1},{IndicatorCode:"proc",IndicatorName:"Price ROC",IndicatorType:-1,ShortName:"PROC",Default:!1,inCompactMode:!1},{IndicatorCode:"rsi",IndicatorName:"Relative Strength Index (RSI)",IndicatorType:-1,ShortName:"RSI",Default:!0,inCompactMode:!0},{IndicatorCode:"sma",IndicatorName:"Moving Average (Simple)",IndicatorType:0,ShortName:"SMA",Default:!0,inCompactMode:!0},{IndicatorCode:"stddev",IndicatorName:"Standard Deviation",IndicatorType:-1,ShortName:"SD",Default:!1,inCompactMode:!1},{IndicatorCode:"stochosc",IndicatorName:"Stochastic Oscillator",IndicatorType:-1,ShortName:"SO",Default:!0,inCompactMode:!0},{IndicatorCode:"si",IndicatorName:"Swing Index",IndicatorType:-1,ShortName:"SI",Default:!1,inCompactMode:!1},{IndicatorCode:"sr",IndicatorName:"Support/Resistance",IndicatorType:0,ShortName:"SR",Default:!1,inCompactMode:!1},{IndicatorCode:"trix",IndicatorName:"TRIX",IndicatorType:-1,ShortName:"TRIX",Default:!1,inCompactMode:!1},{IndicatorCode:"truerange",IndicatorName:"True Range",IndicatorType:-1,ShortName:"TR",Default:!0,inCompactMode:!1},{IndicatorCode:"typprice",IndicatorName:"Typical Price",IndicatorType:-1,ShortName:"TP",Default:!1,inCompactMode:!1},{IndicatorCode:"uo",IndicatorName:"Ultimate Oscillator",IndicatorType:-1,ShortName:"UO",Default:!1,inCompactMode:!1},{IndicatorCode:"wma",IndicatorName:"Moving Average (Weighted)",IndicatorType:0,ShortName:"WMA",Default:!1,inCompactMode:!1},{IndicatorCode:"wws",IndicatorName:"Welles Wilder Smoothing",IndicatorType:-1,ShortName:"WWS",Default:!1,inCompactMode:!1},{IndicatorCode:"williams",IndicatorName:"Williams %R",IndicatorType:-1,ShortName:"W%R",Default:!0,inCompactMode:!1},{IndicatorCode:"vol",IndicatorName:"Volume",IndicatorType:-1,ShortName:"VOL",Default:!1},{IndicatorCode:"zz",IndicatorName:"ZigZag",IndicatorType:0,ShortName:"ZZ",Default:!1,inCompactMode:!1}],stylesData:[{Name:"chartDisplayAreaBackground",Class:".charting .chartDisplayAreaBackground",Property:"color"},{Name:"chartDisplayAreaAlternativeBackground",Class:".charting .chartDisplayAreaAlternativeBackground",Property:"color"},{Name:"chartRenderBackground",Class:".charting .chartRenderBackground",Property:"color"},{Name:"chartDisplayAreaHorizontalGridLinesColor",Class:".charting .chartDisplayAreaHorizontalGridLinesColor",Property:"color"},{Name:"chartDisplayAreaVerticalGridLinesColor",Class:".charting .chartDisplayAreaVerticalGridLinesColor",Property:"color"},{Name:"chartDisplayAreaHorizontalGridLinesOpacity",Property:"opacity"},{Name:"chartDisplayAreaVerticalGridLinesOpacity",Property:"opacity"},{Name:"chartDisplayAreaLineUpColor",Class:".charting .chartDisplayAreaLineUpColor",Property:"color"},{Name:"chartDisplayAreaLineDownColor",Class:".charting .chartDisplayAreaLineDownColor",Property:"color"},{Name:"chartDisplayAreaCandleStickUpStroke",Class:".charting .chartDisplayAreaCandleStickUpStroke",Property:"color"},{Name:"chartDisplayAreaCandleStickDownStroke",Class:".charting .chartDisplayAreaCandleStickDownStroke",Property:"color"},{Name:"chartDisplayAreaCandleStickUpFill",Class:".charting .chartDisplayAreaCandleStickUpFill",Property:"color"},{Name:"chartDisplayAreaCandleStickDownFill",Class:".charting .chartDisplayAreaCandleStickDownFill",Property:"color"},{Name:"chartDisplayAreaCandleStickUpIsHollow",Property:"checkbox"},{Name:"chartDisplayAreaBarUpColor",Class:".charting .chartDisplayAreaBarUpColor",Property:"color"},{Name:"chartDisplayAreaBarDownColor",Class:".charting .chartDisplayAreaBarDownColor",Property:"color"},{Name:"chartDisplayAreaKagiUpColor",Class:".charting .chartDisplayAreaKagiUpColor",Property:"color"},{Name:"chartDisplayAreaKagiDownColor",Class:".charting .chartDisplayAreaKagiDownColor",Property:"color"},{Name:"chartBorderColor",Class:".charting .chartBorderColor",Property:"color"},{Name:"crosshairColor",Class:".charting .crosshairColor",Property:"color"},{Name:"greenColor",Class:".charting .greenColor",Property:"color"},{Name:"redColor",Class:".charting .redColor",Property:"color"},{Name:"blackColor",Class:".charting .blackColor",Property:"color"},{Name:"selectedForeground",Class:".charting .selectedForeground",Property:"color"},{Name:"selectedBackground",Class:".charting .selectedBackground",Property:"color"},{Name:"lineColor",Class:".charting .lineColor",Property:"color"},{Name:"axisTextMinor",Class:".charting .axisTextMinor",Property:"color"},{Name:"axisTextMajor",Class:".charting .axisTextMajor",Property:"color"},{Name:"annotationStrokeColor",Class:".charting .annotationStrokeColor",Property:"color"},{Name:"annotationFillColor",Class:".charting .annotationFillColor",Property:"color"},{Name:"bottomMarginPx",Class:".charting .bottomMarginPx",Property:"marginBottom"},{Name:"leftMarginPx",Class:".charting .leftMarginPx",Property:"marginLeft"},{Name:"rightMarginPx",Class:".charting .rightMarginPx",Property:"marginRight"},{Name:"topMarginPx",Class:".charting .topMarginPx",Property:"marginTop"}],lowerIndicatorsLimit:null,upperIndicatorsLimit:null,originalModel:null,isMobile:!1,allowScroll:!0,doubleclickNotification:!0,isAxisFontSizeVisible:!1,levels:null,levelColorHexEntry:"#00B0F0",levelColorHexProfit:"#00B050",levelColorHexStop:"#990000",lastAvgPrice:null,lastBid:null,lastOffer:null,viewOptions:[{displayName:"Tick By Tick",value:"Tick",timeframes:[{displayName:"1500",value:"1500"},{displayName:"3000",value:"3000"}]},{displayName:"1 Minute",value:"OneMinute",defaultframe:1,isDefault:!0,momentKey:"minutes",momentValue:1,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"2 Minutes",value:"TwoMinute",defaultframe:1,momentKey:"minutes",momentValue:2,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"3 Minutes",value:"ThreeMinute",defaultframe:1,momentKey:"minutes",momentValue:3,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"5 Minutes",value:"FiveMinute",defaultframe:2,momentKey:"minutes",momentValue:5,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"15 Minutes",value:"FifteenMinute",defaultframe:2,momentKey:"minutes",momentValue:15,timeframes:[{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10}]},{displayName:"30 Minutes",value:"ThirtyMinute",defaultframe:3,momentKey:"minutes",momentValue:30,timeframes:[{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10}]},{displayName:"1 Hour",value:"SixtyMinute",defaultframe:3,momentKey:"minutes",momentValue:60,timeframes:[{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10},{displayName:"1 Month",value:"OneMonth",momentKey:"months",momentValue:1},{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3}]},{displayName:"4 Hours",value:"FourHour",defaultframe:2,momentKey:"hours",momentValue:4,timeframes:[{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10},{displayName:"1 Month",value:"OneMonth",momentKey:"months",momentValue:1},{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3},{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6}]},{displayName:"Daily",value:"OneDay",defaultframe:2,momentKey:"days",momentValue:1,timeframes:[{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3},{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6},{displayName:"1 Year",value:"OneYear",momentKey:"years",momentValue:1},{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]},{displayName:"Weekly",value:"OneWeek",defaultframe:2,momentKey:"weeks",momentValue:1,timeframes:[{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6},{displayName:"1 Year",value:"OneYear",momentKey:"years",momentValue:1},{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]},{displayName:"Monthly",value:"OneMonth",defaultframe:2,momentKey:"months",momentValue:1,timeframes:[{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]}]},_B),$B;function _B(e){var t=$B.call(this)||this;return t.idAttribute="chartID",t.set(e),t.initialize2(),t}var VisualSettings=(DC=Backbone.View,__extends(EC,DC),EC.prototype.applyTemplate=function(){var t=this;$(this.el).html(T.VisualSettings()),this.colorPickers=[],_.each(this.$el.find("input[name=color]"),function(e){t.colorPickers.push(e),$(e).colorpicker({displayIndicator:!1})}),this.gridLinesOpacitySlicer=this.$el.find(".grid-lines-opacity-slider"),$(this.gridLinesOpacitySlicer).slider({min:0,max:100,step:1}),this.gridLineType=this.$el.find(".grid-line-type"),this.gridLineVisibility=this.$el.find(".grid-lines-visibility"),this.isHollowCandleStick=this.$el.find('input[name="candle-stick-up-hollow"]'),this.chartDimensionsType=this.$el.find(".chart-dimensions-type"),this.chartDimensionsWidthSelect=this.$el.find(".chart-width-select"),this.chartDimensionsWidthInput=this.$el.find('input[name="custom-width"]'),this.chartDimensionsHeightInput=this.$el.find('input[name="custom-height"]'),this.chartDimensionsSetWidthRow=this.$el.find(".chart-dimensions-set-width-row"),this.chartDimensionsCustomRow=this.$el.find(".chart-dimensions-custom-row"),this.axisFontSizeHorizontalSlider=this.$el.find(".axis-font-size-horizontal-slider"),$(this.axisFontSizeHorizontalSlider).slider({min:10,max:14,step:1}),this.axisFontSizeVerticalSlider=this.$el.find(".axis-font-size-vertical-slider"),$(this.axisFontSizeVerticalSlider).slider({min:10,max:14,step:1}),this.$el.find('input[name="default"]').button().on("click",function(){var e=t.model.get("currentTheme"),e=new ChartModel({currentTheme:e});t.model.set({chartDisplayAreaHorizontalGridLinesColor:e.get("chartDisplayAreaHorizontalGridLinesColor"),chartDisplayAreaHorizontalGridLinesOpacity:e.get("chartDisplayAreaHorizontalGridLinesOpacity"),chartDisplayAreaHorizontalGridLinesType:e.get("chartDisplayAreaHorizontalGridLinesType"),chartDisplayAreaVerticalGridLinesColor:e.get("chartDisplayAreaVerticalGridLinesColor"),chartDisplayAreaVerticalGridLinesOpacity:e.get("chartDisplayAreaVerticalGridLinesOpacity"),chartDisplayAreaVerticalGridLinesType:e.get("chartDisplayAreaVerticalGridLinesType"),chartDisplayAreaLineUpColor:e.get("chartDisplayAreaLineUpColor"),chartDisplayAreaLineDownColor:e.get("chartDisplayAreaLineDownColor"),chartDisplayAreaCandleStickUpStroke:e.get("chartDisplayAreaCandleStickUpStroke"),chartDisplayAreaCandleStickDownStroke:e.get("chartDisplayAreaCandleStickDownStroke"),chartDisplayAreaCandleStickUpIsHollow:e.get("chartDisplayAreaCandleStickUpIsHollow"),chartDisplayAreaCandleStickUpFill:e.get("chartDisplayAreaCandleStickUpFill"),chartDisplayAreaCandleStickDownFill:e.get("chartDisplayAreaCandleStickDownFill"),chartDisplayAreaBarUpColor:e.get("chartDisplayAreaBarUpColor"),chartDisplayAreaBarDownColor:e.get("chartDisplayAreaBarDownColor"),chartDisplayAreaKagiUpColor:e.get("chartDisplayAreaKagiUpColor"),chartDisplayAreaKagiDownColor:e.get("chartDisplayAreaKagiDownColor"),axisFontSizeHorizontal:e.get("axisFontSizeHorizontal"),axisFontSizeVertical:e.get("axisFontSizeVertical"),crosshairColor:e.get("crosshairColor"),selectedForeground:e.get("selectedForeground"),selectedBackground:e.get("selectedBackground"),axisTextMinor:e.get("axisTextMinor"),chartDisplayAreaBackground:e.get("chartDisplayAreaBackground"),chartDisplayAreaAlternativeBackground:e.get("chartDisplayAreaAlternativeBackground"),isChartDimensionsActive:e.get("isChartDimensionsActive"),chartDimensionsWidthPx:e.get("chartDimensionsWidthPx"),chartDimensionsHeightPx:e.get("chartDimensionsHeightPx")}),t.turnEventsOff(),t.initializeValues(),t.turnEventsOn(),$(t).trigger("redraw")}),this.$el.find('input[name="ok"]').button().on("click",function(){$(t).trigger("close")})},EC.prototype.initialize=function(e){this.options=e,this.applyTemplate(),this.initializeValues(),this.turnEventsOn()},EC.prototype.initializeValues=function(){var t,i=this;_.each(this.colorPickers,function(e){t=e.getAttribute("data-property-name"),t="grid-lines-color"===t?i.model.get("chartDisplayAreaHorizontalGridLinesColor"):i.model.get(t),$(e).colorpicker({color:t})});var e=0<this.model.get("chartDisplayAreaHorizontalGridLinesOpacity"),a=0<this.model.get("chartDisplayAreaVerticalGridLinesOpacity"),n=this.model.get("chartDisplayAreaHorizontalGridLinesType")[1];e&&a?(this.gridLineVisibility.find('option[value="both"]').prop("selected","selected"),$(this.gridLinesOpacitySlicer).slider("value",100*this.model.get("chartDisplayAreaHorizontalGridLinesOpacity"))):e?(this.gridLineVisibility.find('option[value="horizontal"]').prop("selected","selected"),$(this.gridLinesOpacitySlicer).slider("value",100*this.model.get("chartDisplayAreaHorizontalGridLinesOpacity"))):a?(this.gridLineVisibility.find('option[value="vertical"]').prop("selected","selected"),$(this.gridLinesOpacitySlicer).slider("value",100*this.model.get("chartDisplayAreaVerticalGridLinesOpacity"))):(this.gridLineVisibility.find('option[value="none"]').prop("selected","selected"),$(this.gridLinesOpacitySlicer).slider("value",0)),0===n?this.gridLineType.find('option[value="line"]').prop("selected","selected"):3===n?this.gridLineType.find('option[value="dots"]').prop("selected","selected"):5===n&&this.gridLineType.find('option[value="dashes"]').prop("selected","selected"),this.model.get("chartDisplayAreaCandleStickUpIsHollow")?this.$el.find('input[name="candle-stick-up-hollow"]').prop("checked",!1):this.$el.find('input[name="candle-stick-up-hollow"]').prop("checked",!0),this.model.get("isChartDimensionsVisible")?(this.$el.find(".chart-dimensions-section").show(),$(this.chartDimensionsWidthInput).spinner({stop:function(){return i.updateChartDimensionsInputs()},min:360,max:1600,step:5}),$(this.chartDimensionsHeightInput).spinner({stop:function(){return i.updateChartDimensionsInputs()},min:220,max:1e3,step:5}),this.$el.find(".ui-spinner").addClass("text-box"),$(this.chartDimensionsWidthInput).spinner("value",this.model.get("chartDimensionsWidthPx")),$(this.chartDimensionsHeightInput).spinner("value",this.model.get("chartDimensionsHeightPx")),(this.chartDimensionsWidthSelect.find('option[value="'+this.model.get("chartDimensionsWidthPx")+'"]').length?this.chartDimensionsWidthSelect.find('option[value="'+this.model.get("chartDimensionsWidthPx")+'"]'):this.chartDimensionsWidthSelect.find('option[value="1024"]')).prop("selected","selected"),this.model.get("isChartDimensionsActive")&&this.model.get("chartDimensionsWidthPx")&&this.model.get("chartDimensionsHeightPx")?this.chartDimensionsType.find('option[value="custom"]').prop("selected","selected"):this.model.get("isChartDimensionsActive")&&this.model.get("chartDimensionsWidthPx")&&!this.model.get("chartDimensionsHeightPx")?(this.chartDimensionsType.find('option[value="set-width"]').prop("selected","selected"),$(this.chartDimensionsHeightInput).spinner("value",this.model.get("chartDimensionsWidthPx")*this.model.get("chartDimensionsHeightPercent"))):this.chartDimensionsType.find('option[value="fit"]').prop("selected","selected"),this.updateChartDimensionsInputs()):this.$el.find(".chart-dimensions-section").hide(),this.model.get("isAxisFontSizeVisible")?(this.$el.find(".axis-font-size-section").show(),console.log("font-size",[this.model.get("axisFontSizeHorizontal"),this.model.get("axisFontSizeVertical")]),$(this.axisFontSizeHorizontalSlider).slider("value",12),$(this.axisFontSizeVerticalSlider).slider("value",12)):this.$el.find(".axis-font-size-section").hide()},EC.prototype.onColorChanged=function(e,t){e=e.target.getAttribute("data-property-name");"grid-lines-color"===e?this.model.set({chartDisplayAreaVerticalGridLinesColor:t,chartDisplayAreaHorizontalGridLinesColor:t}):this.model.set(e,t)},EC.prototype.turnEventsOff=function(){_.each(this.colorPickers,function(e){$(e).off()}),$(this.gridLinesOpacitySlicer).off(),$(this.gridLineType).off(),$(this.gridLineVisibility).off(),$(this.isHollowCandleStick).off()},EC.prototype.turnEventsOn=function(){var i,a=this;_.each(this.colorPickers,function(e){$(e).on("change.color",function(e,t){a.onColorChanged(e,t)})}),$(this.gridLinesOpacitySlicer).on("slide",function(e,t){switch(i=t.value/100,a.gridLineVisibility.prop("value")){case"both":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:i,chartDisplayAreaVerticalGridLinesOpacity:i});break;case"horizontal":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:i});break;case"vertical":a.model.set({chartDisplayAreaVerticalGridLinesOpacity:i})}}),$(this.gridLineType).on("change",function(){switch(a.gridLineType.prop("value")){case"line":a.model.set({chartDisplayAreaHorizontalGridLinesType:[5,0],chartDisplayAreaVerticalGridLinesType:[5,0]});break;case"dashes":a.model.set({chartDisplayAreaHorizontalGridLinesType:[5,5],chartDisplayAreaVerticalGridLinesType:[5,5]});break;case"dots":a.model.set({chartDisplayAreaHorizontalGridLinesType:[2,3],chartDisplayAreaVerticalGridLinesType:[2,3]})}}),$(this.gridLineVisibility).on("change",function(){switch(a.gridLineVisibility.prop("value")){case"both":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:1,chartDisplayAreaVerticalGridLinesOpacity:1}),$(a.gridLinesOpacitySlicer).slider("value",100);break;case"horizontal":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:1,chartDisplayAreaVerticalGridLinesOpacity:0}),$(a.gridLinesOpacitySlicer).slider("value",100);break;case"vertical":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:0,chartDisplayAreaVerticalGridLinesOpacity:1}),$(a.gridLinesOpacitySlicer).slider("value",100);break;case"none":a.model.set({chartDisplayAreaHorizontalGridLinesOpacity:0,chartDisplayAreaVerticalGridLinesOpacity:0}),$(a.gridLinesOpacitySlicer).slider("value",0)}}),$(this.isHollowCandleStick).on("click",function(){a.isHollowCandleStick.is(":checked")?a.model.set("chartDisplayAreaCandleStickUpIsHollow",0):a.model.set("chartDisplayAreaCandleStickUpIsHollow",1)}),$(this.chartDimensionsType).on("change",function(){return a.updateChartDimensionsInputs()}),$(this.chartDimensionsWidthSelect).on("change",function(){return a.updateChartDimensionsInputs()}),$(this.chartDimensionsWidthInput).on("change",function(){return a.updateChartDimensionsInputs()}),$(this.chartDimensionsHeightInput).on("change",function(){return a.updateChartDimensionsInputs()}),$(this.axisFontSizeHorizontalSlider).on("slide",function(e,t){i=t.value,a.model.set({axisFontSizeHorizontal:i})}),$(this.axisFontSizeVerticalSlider).on("slide",function(e,t){i=t.value,a.model.set({axisFontSizeVertical:i})})},EC.prototype.updateChartDimensionsInputs=function(){switch(this.chartDimensionsType.prop("value")){case"fit":this.chartDimensionsSetWidthRow.hide(),this.chartDimensionsCustomRow.hide(),this.model.set({isChartDimensionsActive:!1,chartDimensionsWidthPx:null,chartDimensionsHeightPx:null});break;case"set-width":this.chartDimensionsSetWidthRow.show(),this.chartDimensionsCustomRow.hide(),this.model.set({isChartDimensionsActive:!0,chartDimensionsWidthPx:parseInt(this.chartDimensionsWidthSelect.prop("value"),10),chartDimensionsHeightPx:null});break;case"custom":this.chartDimensionsSetWidthRow.hide(),this.chartDimensionsCustomRow.show(),this.model.set({isChartDimensionsActive:!0,chartDimensionsWidthPx:parseInt(this.chartDimensionsWidthInput.prop("value"),10),chartDimensionsHeightPx:parseInt(this.chartDimensionsHeightInput.prop("value"),10)})}},EC),DC;function EC(){return null!==DC&&DC.apply(this,arguments)||this}var SettingsContextMenu=(eD=Backbone.View,__extends(fD,eD),fD.prototype.initialize2=function(e){var t=this;this.options=e,this.clipboard=e.clipboard,this.hasAnnotations=e.hasAnnotations,this.onMainChart=e.onMainChart,this.layerHeight=e.layerHeight,this.positionValue=e.positionValue,this.onMouseUpWrap=function(e){return t.onMouseUp(e)},this.render(),$(document).on("mouseup",this.onMouseUpWrap)},fD.prototype.onMouseUp=function(e){var t=parseFloat(this.contextMenu.css("left")),i=t+this.contextMenu.width(),a=parseFloat(this.contextMenu.css("top")),n=a+this.contextMenu.height();(e.pageX<t||e.pageX>i||e.pageY<a||e.pageY>n)&&this.remove()},fD.prototype.onLimitBtnClick=function(){this.trigger("limit",this.positionValue)},fD.prototype.onStopBtnClick=function(){this.trigger("stop",this.positionValue)},fD.prototype.render=function(){var i=this,e=this.positionValue.toFixed(this.model.get("mainChartAreaValuesAxisDecimalPlaces")),t=this.model.get("currentTheme");return $(this.el).html(T.SettingsContextMenu({price:e})),this.$el.children(":first").addClass(t),this.contextMenu=this.$el.find(".context-menu"),this.$menuLeft=$(this.$el.find("#menu-left")),this.$pasteBtn=this.$el.find(".paste-btn"),this.$removeAllBtn=this.$el.find(".remove-all-btn"),this.$limitBtn=this.$el.find(".add-limit-btn"),this.$stopBtn=this.$el.find(".add-stop-btn"),this.$removeIndicatorButton=this.$el.find(".remove-indicator-button"),this.clipboard&&this.$pasteBtn.show(),this.hasAnnotations&&this.$removeAllBtn.show(),this.onMainChart||(this.$el.find(".not-indicator-menu-item").hide(),this.$removeIndicatorButton.show()),this.$menuLeft.menu({select:function(e,t){t=$(t.item[0]);t.hasClass("settings-btn")?i.showSettings():t.hasClass("paste-btn")?$(i).trigger("paste",{type:"paste",item:$.extend({},i.clipboard)}):t.hasClass("remove-all-btn")?$(i).trigger("delete-all"):t.hasClass("remove-indicator-btn")&&$(i).trigger("remove-indicator"),e.stopPropagation(),e.preventDefault(),i.remove()}}).removeClass("ui-widget-content"),this},fD.prototype.remove=function(){return $(document).off("mouseup",this.onMouseUpWrap),this.trigger("closed"),this.$menuLeft.menu("destroy"),this.contextMenu.remove(),this},fD.prototype.show=function(e){var t=this.$el.find(".context-menu"),i=t.height();"light"===this.model.get("currentTheme")&&t.addClass("light"),this.$el.appendTo($("body")),this.contextMenu.css({left:e.pageX+"px",top:(e.pageY+t.height()>this.layerHeight?e.pageY-i:e.pageY)+"px"})},fD.prototype.showSettings=function(){var t,i=this,e=new VisualSettings({model:this.model});e.$el.dialog({dialogClass:"charting "+this.model.get("currentTheme"),title:"Chart Properties",resizable:!1,width:"auto",close:function(){$(i).trigger("settings-closed"),$(e.$el).dialog("destroy")},open:function(e){$(e.target).css("overflow","visible"),t=$(e.target).parent(),i.model.changeThemeClassForElementWhenThemeChanges(t)}}),$(e).on("close",function(){$(e.$el).dialog("close")}),$(e).on("redraw",function(){$(i).trigger("redraw")})},fD),eD;function fD(e){var t=eD.call(this,e)||this;return t.onMainChart=!0,t.initialize2(e),t}var ChartArea=(XD=Backbone.View,__extends(YD,XD),YD.prototype.addSeries=function(e){this.allSeries.push(e),e.canUserEdit&&this.model.get(this.prefix+"isSeriesBarVisible")&&this.seriesToolbar.addSeries(e);for(var t,i=e.displaySeries.length,a=0;a<i;a+=1)this.displayArea.addSeries(e.displaySeries[a],e.seriesMarkers),this.showLastValue&&(t=e.displaySeries[0].get("elements")[e.displaySeries[0].get("elements").length-1],this.lastValue=t.get("value"));(e.chartArea=this).rightAxis.lastBackground=this.allSeries[0].displaySeries[0].get("lastChangeGreen")?this.model.get("liveGreenColor")||this.model.get("greenColor"):this.model.get("redColor"),1===this.allSeries.length&&(this.seriesMarkers=e.seriesMarkers,e.isIndicator?e.showDecimalPlaces?this.rightAxis.decimalPlaces=this.model.get(this.prefix+"ValuesAxisDecimalPlaces"):this.rightAxis.decimalPlaces=0:this.rightAxis.decimalPlaces=this.model.get("originalDecimalPlaces"))},YD.prototype.applyLayout=function(e,t){var i,a,n=0,o=0,r=0,s=0,l=0,d=0,c=0,h=0,p=0,u=0;this.model.get(this.prefix+"isSeriesBarVisible")&&(c=e,0<(d=this.seriesToolbar.$el.height())&&(h=d+this.model.get("seriesBarMarginPx"))),this.$seriesBarDiv.css({top:0,left:0,width:c,height:d}),this.$interactionLayer.css({top:n+=h,left:0,width:e,height:t-h}),this.model.get(this.prefix+"IsRightAxisVisible")&&(o=t-h,r=this.model.get("rightAxisWidthPx")),this.model.get(this.prefix+"IsBottomAxisVisible")&&(s=this.model.get("bottomAxisHeightPx"),l=e),i=e-(0+this.model.get("leftInnerMarginPx")+this.model.get("rightInnerMarginPx")+r),a=t-(h+0+this.model.get("topInnerMarginPx")+this.model.get("bottomInnerMarginPx")+s),this.$displayAreaDiv.css({top:h+0+this.model.get("topInnerMarginPx"),left:0+this.model.get("leftInnerMarginPx"),width:i,height:a}),this.$backgroundDiv.css({top:h+0,left:0,width:e-(0+r),height:t-(h+0+s)}),this.$rightAxisDiv.css({top:n,left:0+this.model.get("leftInnerMarginPx")+i+this.model.get("rightInnerMarginPx"),width:r,height:o}),this.$bottomAxisDiv.css({top:h+0+this.model.get("topInnerMarginPx")+a+this.model.get("bottomInnerMarginPx"),left:0,width:l,height:s}),p=0+i+this.model.get("leftInnerMarginPx")+this.model.get("rightInnerMarginPx")+.15*r,this.$horizontalGrid.css({top:h+0+this.model.get("topInnerMarginPx"),left:0,height:0<a?a:0,width:0<p?p:0}),this.$horizontalGrid.prop("width",0<p?p:0),this.$horizontalGrid.prop("height",0<a?a:0),u=0+a+this.model.get("topInnerMarginPx")+this.model.get("bottomInnerMarginPx")+.15*s,this.$verticalGrid.css({top:+(h+0),left:0+this.model.get("leftInnerMarginPx"),width:0<i?i:0,height:0<u?u:0}),this.$verticalGrid.prop("width",0<i?i:0),this.$verticalGrid.prop("height",0<u?u:0),p=i+this.model.get("leftInnerMarginPx")+this.model.get("rightInnerMarginPx"),u=a+this.model.get("topInnerMarginPx")+this.model.get("bottomInnerMarginPx"),this.$crosshairCanvas.css({top:h+0,left:0,width:0<p?p:0,height:0<u?u:0}),this.$crosshairCanvas.prop("width",0<p?p:0),this.$crosshairCanvas.prop("height",0<u?u:0),this.$drawingCanvas.css({top:h+0,left:0,width:0<p?p:0,height:0<u?u:0}),this.$drawingCanvas.prop("width",0<p?p:0),this.$drawingCanvas.prop("height",0<u?u:0),this.$zoomingCanvas.css({top:h+0,left:0,width:0<p?p:0,height:0<u?u:0}),this.$zoomingCanvas.prop("width",0<p?p:0),this.$zoomingCanvas.prop("height",0<u?u:0),this.rightAxis.setAxisTopBottm(0,t-s),this.bottomAxis.setAxisLeftRight(0,e-r),this.displayArea.onResize(),this.patternHighlight&&this.patternHighlight.onResize(),this.updateDisplayText(this.displayTexAlign,this.displayTexAlignV)},YD.prototype.applyTemplate=function(){var i=this,e=this.model.get("chartBorderColor");this.$el.html(T.ChartArea()),this.$backgroundDiv=this.$el.find(".Background"),this.$rightAxisDiv=this.$el.find(".RightAxisDiv"),this.$bottomAxisDiv=this.$el.find(".BottomAxisDiv"),this.$displayAreaDiv=this.$el.find(".DisplayAreaDiv"),this.$horizontalGrid=this.$el.find(".HorizontalGrid"),this.$verticalGrid=this.$el.find(".VerticalGrid"),this.$crosshairCanvas=this.$el.find(".CrosshairCanvas"),this.$drawingCanvas=this.$el.find(".DrawingCanvas"),this.$zoomingCanvas=this.$el.find(".ZoomingCanvas"),this.$seriesBarDiv=this.$el.find(".SeriesBarDiv"),this.$interactionLayer=this.$el.find(".InteractionLayer"),this.$displayText=this.$el.find(".DisplayText"),this.$interactionLayer.css("background-color","white"),this.$interactionLayer.css("opacity","0"),this.$crosshairCanvas.css({"border-left":"1px solid "+e,"border-top":"1px solid "+e,"border-right":"1px solid "+e}),this.$backgroundDiv.css("background-color",this.model.get("chartDisplayAreaBackground")),this.displayArea=new DisplayArea({el:this.$displayAreaDiv,model:this.model,drawingLocked:this.drawingLocked}),this.displayArea.displayFromIndex=this.tempDisplayFrom,this.displayArea.displayToIndex=this.tempDisplayTo,this.displayArea.isLiveElementEnabled=this.isLiveElementEnabled,this.rightAxis=new VerticalAxis({el:this.$rightAxisDiv,model:this.model,axisSide:"Right",prefix:this.prefix,showLastValue:!("indicatorChartArea"===this.prefix),decimalPlaces:"indicatorChartArea"===this.prefix?0:this.model.get("originalDecimalPlaces"),displayArea:this.displayArea}),this.bottomAxis=new HorizontalAxis({el:this.$bottomAxisDiv,model:this.model}),this.seriesToolbar=new SeriesToolbar({el:this.$seriesBarDiv}),this.annotationsManager=new AnnotationsManager(this.$drawingCanvas,this.displayArea,this.model.get(this.prefix+"ValuesAxisDecimalPlaces"),this.model,"mainChartArea"===this.options.prefix),this.listenTo(this.model,"change:"+this.prefix+"ValuesAxisDecimalPlaces",function(e,t){i.annotationsManager.setDecimals(t)}),this.displayArea.annotationsManager=this.annotationsManager},YD.prototype.calculateDisplayDates2=function(e,t,i){var a,n,o,r,s=[],l=!1,d=[],c=!0,h=!1,p=[["10year","yyyy","a"],["5year","yyyy","a"],["1year","yyyy","a"],["3month","mmm","b"],["1month","mmm","b"],["15day","d","c"],["7day","d","c"],["1day","d","c"],["6h","HH:MM","d"],["3h","HH:MM","d"],["1h","HH:MM","d"],["15min","HH:MM","e"],["5min","HH:MM","e"],["1min","HH:MM","e"],["1sec","HH:MM:ss","f"],["1tick","HH:MM:ss","g"]],u=parseInt((.021*i).toString(),10);if("number"!=typeof e||isNaN(e)||"number"!=typeof t||isNaN(t))return null;for(n=0;!l&&n<p.length;n++){for(a=e;!l&&a<=t;a++)this.displayArea.allDatesTags[a]===p[n][0]&&(d.push({index:a,isMajorTick:c||o===p[n][2],format:p[n][1],date:this.displayArea.allDates[a]}),s.length+d.length>=u&&(l=!0));!l&&0<d.length&&(c&&(c=!1,o=p[n][2],r=p[n][1]),h=!d[0].isMajorTick,s=s.concat(d),d=[])}return h||_.each(s,function(e){e.isMajorTick=!1}),0<s.length&&s[0].index!==e&&((i=new Array).push({index:e,isMajorTick:h,format:r,date:this.displayArea.allDates[e]}),s=i.concat(s)),_.sortBy(s,function(e){return e.date})},YD.prototype.checkIsMouseOverRightAxis=function(e){var t=this.$rightAxisDiv.offset(),i=this.$rightAxisDiv.width(),a=this.$rightAxisDiv.height();return e.pageX>=t.left&&e.pageX<=t.left+i&&e.pageY>=t.top&&e.pageY<=t.top+a},YD.prototype.checkIsMouseOverResizeEdge=function(e){var t,i,a=!1;return this.model.get(this.prefix+"CanUserResize")&&(t=this.$interactionLayer.offset(),i=this.$interactionLayer.width(),a=e.pageX>=t.left&&e.pageX<=t.left+i&&e.pageY>=t.top&&e.pageY<=t.top+9),a},YD.prototype.getMonthStep=function(e,t){var i=1;switch(e){case"Tick":case"OneMinute":case"TwoMinute":case"ThreeMinute":case"FiveMinute":case"FifteenMinute":case"ThirtyMinute":case"SixtyMinute":case"FourHour":break;case"OneDay":i=2.7<t?1:.64<t?3:.24<t?6:12;break;case"OneWeek":i=18<t?1:5.5<t?2:2.7<t?3:1.2<t?6:12;break;case"OneMonth":i=33<t?1:17.8<t?2:12<t?3:6<t?6:12}return i},YD.prototype.getDaysStep=function(e,t){var i=1;switch(e){case"Tick":case"OneMinute":case"TwoMinute":case"ThreeMinute":case"FiveMinute":case"FifteenMinute":case"ThirtyMinute":case"SixtyMinute":break;case"FourHour":i=9.1<t?1:4.5<t?2:3;break;case"OneDay":i=50<t?1:14<t?5:6<t?10:32;break;case"OneWeek":case"OneMonth":i=32}return i},YD.prototype.getHoursStep=function(e,t){var i=1;switch(e){case"Tick":case"OneMinute":case"TwoMinute":case"ThreeMinute":i=.85<t?1:.54<t?2:.31<t?4:.22<t?6:12;break;case"FiveMinute":i=4.1<t?1:1.8<t?2:1.2<t?4:.7<t?6:12;break;case"FifteenMinute":i=13<t?1:9<t?2:4.2<t?4:2.6<t?6:1.1<t?12:.6<t?24:48;break;case"ThirtyMinute":i=26<t?1:13.5<t?2:9.6<t?4:4.8<t?6:2.2<t?12:1<t?24:48;break;case"SixtyMinute":i=49<t?1:32<t?2:13<t?4:9.5<t?6:3.6<t?12:1.7<t?24:48;break;case"FourHour":i=51<t?4:30<t?8:16<t?12:9.1<t?24:4.5<t?48:72;break;case"OneDay":i=54<t?24:38<t?48:20<t?72:12<t?96:120;break;default:i=1}return i},YD.prototype.getMinutesStep=function(e,t){var i=1;switch(e){case"Tick":i=10<t?1:5.5<t?5:3.5<t?7:1.5<t?15:1<t?30:.6<t?60:.3<t?120:180;break;case"OneMinute":case"TwoMinute":case"ThreeMinute":i=10<t?5:5.5<t?10:3.5<t?15:1.5<t?30:1<t?60:.6<t?120:.3<t?240:360;break;case"FiveMinute":i=19<t?15:10<t?30:3.8<t?60:3<t?120:240;break;case"FifteenMinute":i=13<t?60:7.3<t?120:2.5<t?240:360;break;case"ThirtyMinute":i=50<t?30:25<t?60:14<t?120:6.1<t?240:360;break;case"SixtyMinute":i=50<t?60:32<t?120:11<t?240:360;break;default:i=1}return i},YD.prototype.clearCrosshair=function(){var e=this.$crosshairCanvas[0].getContext("2d"),t=this.$crosshairCanvas.prop("width"),i=this.$crosshairCanvas.prop("height");e.clearRect(0,0,t,i),this.model.get(this.prefix+"IsRightAxisVisible")&&this.rightAxis.setSelectedValue(null)},YD.prototype.clearMouseZoomY=function(){this.previousZoomY=null,this.isZoomingY=!1},YD.prototype.clearSelectedDates=function(){this.model.get(this.prefix+"IsBottomAxisVisible")&&this.bottomAxis.setSelectedDates(null)},YD.prototype.clearSelectedValue=function(){this.model.get(this.prefix+"IsRightAxisVisible")&&this.rightAxis.setSelectedValue(null)},YD.prototype.clearSeries=function(){this.allSeries=[],this.displayArea.clear(),this.seriesToolbar.clear(),this.patternHighlight&&this.patternHighlight.clearPatterns()},YD.prototype.display=function(e,t){this.displayArea.displaySeries(e,t),this.pendingDatesChangeEvent=!0},YD.prototype.displayCurrent=function(){this.display(this.displayArea.displayFromIndex,this.displayArea.displayToIndex)},YD.prototype.drawCrosshair=function(e,t,i,a,n,o){var r,s,l,d,c;this.model.get("showCrosshair")&&(s=r=0,l=this.$crosshairCanvas[0].getContext("2d"),d=this.$crosshairCanvas.prop("width"),c=this.$crosshairCanvas.prop("height"),o=o&&"percent"===this.model.get("stockDisplayValues")?this.displayArea.allSeries[0].get("percentBase"):null,l.clearRect(0,0,d,c),0<this.displayArea.elementsCount&&(l.strokeStyle=this.model.get("crosshairColor"),l.strokeWidth=1,s=i?(r=(n&&i.get("isFake")?this.displayArea.getValuePosition(n.get("value"),o):this.displayArea.getValuePosition(i.get("value"),o))+this.model.get("topInnerMarginPx"),this.displayArea.xRatio*(i.get("index")-this.displayArea.displayFromIndex+1)-this.displayArea.xRatio/2+this.model.get("leftInnerMarginPx")):(r=t-this.$crosshairCanvas.offset().top,e-this.$crosshairCanvas.offset().left),l.beginPath(),a||(l.moveTo(.5,Math.floor(r)+.5),l.lineTo(Math.floor(d)+.5,Math.floor(r)+.5)),l.moveTo(Math.floor(s)+.5,.5),l.lineTo(Math.floor(s)+.5,Math.floor(c)+.5),l.stroke()))},YD.prototype.drawDashedLine=function(e,t,i,a,n,o){var r=(o=o||[10,0]).length;e.moveTo(t,i);for(var s=a-t+1e-8,n=n-i,l=n/s,d=Math.sqrt(s*s+n*n),c=0,h=!0;.1<=d;){var p=o[c++%r];d<p&&(p=d);var u=Math.sqrt(p*p/(1+l*l));t+=u=s<0?-u:u,i+=l*u,h?e.lineTo(t,i):e.moveTo(t,i),d-=p,h=!h}},YD.prototype.drawSelectedDates=function(e){this.model.get(this.prefix+"IsBottomAxisVisible")&&this.bottomAxis.setSelectedDates(e)},YD.prototype.drawSelectedValue=function(e){this.model.get(this.prefix+"IsRightAxisVisible")&&this.rightAxis.setSelectedValue(e)},YD.prototype.drawHorizontalGridLines=function(e){var t,i,a,n=this.$horizontalGrid[0].getContext("2d"),o=this.$horizontalGrid.prop("width"),r=this.$horizontalGrid.prop("height");this.allSeries[0]&&this.allSeries[0].seriesMarkers?this.seriesMarkers=this.allSeries[0].seriesMarkers:this.seriesMarkers=[],this.lastDisplayValues=e;var s=_.uniqBy(e,function(e){return e[0]});if(n.clearRect(0,0,o,r),this.$horizontalGrid.css("opacity",this.model.get("chartDisplayAreaHorizontalGridLinesOpacity")),n.strokeWidth=1,s)for(a=s.length,i=0;i<a;i+=1)t=0===i?Math.round(s[i][1])-(this.model.get("topInnerMarginPx")+1):Math.round(s[i][1])-this.model.get("topInnerMarginPx"),_.includes(this.seriesMarkers,s[i][0])?(n.strokeStyle=this.model.get("chartDisplayAreaHorizontalMarkerColor"),n.beginPath(),n.moveTo(.5,Math.floor(t)+.5),n.lineTo(Math.floor(o)+.5,Math.floor(t)+.5)):(n.strokeStyle=this.model.get("chartDisplayAreaHorizontalGridLinesColor"),n.beginPath(),this.drawDashedLine(n,.5,Math.floor(t)+.5,Math.floor(o)+.5,Math.floor(t)+.5,this.model.get("chartDisplayAreaHorizontalGridLinesType"))),n.stroke()},YD.prototype.drawVerticalGidLines=function(e){var t,i,a,n,o,r=this.$verticalGrid[0].getContext("2d"),s=this.$verticalGrid.prop("width"),l=this.$verticalGrid.prop("height"),d=Helpers.hexToRgb(this.model.get("chartDisplayAreaVerticalGridLinesColor"));if(this.lastDisplayDates=e,r.clearRect(0,0,s,l),null!==e&&0<(i=e.length)){for(r.strokeStyle="rgba("+d.r+","+d.g+","+d.b+","+this.model.get("chartDisplayAreaVerticalGridLinesOpacity")+")",r.beginPath(),o=e.length%2,t=0;t<i;t+=1)this.drawDashedLine(r,Math.floor(e[t].position)+.5,.5,Math.floor(e[t].position)+.5,Math.floor(l)+.5,this.model.get("chartDisplayAreaVerticalGridLinesType")),t&&t%2==o&&(r.fillStyle=this.model.get("chartDisplayAreaAlternativeBackground"),n=Math.floor(e[t-1].position)+.5,a=Math.floor(e[t].position)-n,r.fillRect(n,.5,a,Math.floor(l)+.5));i%2==o&&(r.fillStyle=this.model.get("chartDisplayAreaAlternativeBackground"),n=Math.floor(e[i-1].position)+.5,r.fillRect(n,.5,a=s-n,Math.floor(l)+.5)),r.stroke()}},YD.prototype.handleMouseZoom=function(e,t){var i,a,n,o,r,s=this.displayArea.allSeries[0].get("elements")[t];this.isZooming&&this.model.get("allowZoom")&&s&&s.bounds&&(i=this.$zoomingCanvas[0].getContext("2d"),r=this.$zoomingCanvas[0].width,a=this.$zoomingCanvas[0].height,i.clearRect(-1,-1,r+2,a+2),this.selectedItems.length<=0?this.selectedItems.push(s):(s.get("isLiveElement")||(this.selectedItems[1]=s),i.fillStyle="rgba(84, 141, 212, 0.2)",i.strokeStyle="rgba(84, 141, 212, 1.0)",i.lineWidth=1,n=this.selectedItems[0].bounds.left,n+=this.selectedItems[0].get("isLiveElement")?this.displayArea.mainCanvas.prop("width")-this.displayArea.xRatio:0,o=this.selectedItems[0].bounds.right,o+=this.selectedItems[0].get("isLiveElement")?this.displayArea.mainCanvas.prop("width")-this.displayArea.xRatio:0,t=s.bounds.left,t+=s.get("isLiveElement")?this.displayArea.mainCanvas.prop("width")-this.displayArea.xRatio:0,r=s.bounds.right,r+=s.get("isLiveElement")?this.displayArea.mainCanvas.prop("width")-this.displayArea.xRatio:0,t=n<t?n:t,t+=this.model.get("leftInnerMarginPx"),r=r<o?o:r,r+=this.model.get("rightInnerMarginPx"),i.fillRect(t,0,r-t,a),i.beginPath(),i.moveTo(t,0),i.lineTo(t,a),i.moveTo(r,0),i.lineTo(r,a),i.stroke()))},YD.prototype.handleMouseZoomY=function(e,t,i,a){void 0===i&&(i=!1),void 0===a&&(a=!1);(t=void 0===t?!1:t)&&a||e.pageY>this.previousZoomY&&13<=e.pageY-this.previousZoomY?(this.model.set({autoZoomY:!1,zoomYLevel:this.model.get("zoomYLevel")-1}),this.previousZoomY=e.pageY):(t&&i||e.pageY<this.previousZoomY&&13<=this.previousZoomY-e.pageY)&&this.model.get("zoomYLevel")<45&&(this.model.set({autoZoomY:!1,zoomYLevel:this.model.get("zoomYLevel")+1}),this.previousZoomY=e.pageY),this.display(this.displayArea.displayFromIndex,this.displayArea.displayToIndex)},YD.prototype.cancelMouseZoom=function(){var e,t,i;this.isZooming&&(e=this.$zoomingCanvas[0].getContext("2d"),t=this.$zoomingCanvas.prop("width"),i=this.$zoomingCanvas.prop("height"),e.clearRect(0,0,t,i),this.selectedItems=[],this.isZooming=!1)},YD.prototype.handleMouseLeave=function(){var e=this.$crosshairCanvas[0].getContext("2d"),t=this.$crosshairCanvas.prop("width"),i=this.$crosshairCanvas.prop("height");e.clearRect(0,0,t,i),this.cancelMouseZoom(),this.annotationsManager.isDrawing&&this.annotationsManager.isDrawingStarted?$(this).trigger("stopDrawing",{type:"stopDrawing"}):this.isZoomingY&&(this.isZoomingY=!1,this.clearMouseZoomY(),$(this).trigger("zoomY",{type:"zoomY"})),this.model.get(this.prefix+"IsRightAxisVisible")&&this.rightAxis.setSelectedValue(null),this.model.get(this.prefix+"IsBottomAxisVisible")&&this.bottomAxis.setSelectedDates(null)},YD.prototype.handleChartDragging=function(e){var t=this.draggingStartX>e.pageX,i=t?this.draggingStartX-e.pageX:e.pageX-this.draggingStartX,i=parseInt(Math.abs(i/this.displayArea.xRatio).toString(),10);0<i&&(this.draggingStartX=e.pageX),$(this).trigger("moveChart",{type:"moveChart",direction:t?"left":"right",step:i})},YD.prototype.clearPatterns=function(){this.patternHighlight&&this.patternHighlight.clearPatterns()},YD.prototype.initialize2=function(e){this.options=e,this.tempDisplayFrom=e.displayAreaFromIndex,this.tempDisplayTo=e.displayAreaToIndex,this.isLiveElementEnabled=e.isLiveElementEnabled,this.drawingLocked=e.drawingLocked,this.prefix=e.prefix,this.showLastValue=e.showLastValue,this.isMouseOn=!1,this.selectedItems=[],this.allSeries=[],this.applyTemplate(),this.initializeEvents(),this.onResize()},YD.prototype.initializeEvents=function(){var i=this;$(this.displayArea).on("displayUpdated",function(){return i.onDisplayUpdated()}),this.listenTo(this.model,"change:lastAvgPrice",function(){return i.onDisplayUpdated()}),$(this.seriesToolbar).on("toolbarresize",function(){return i.onToolbarResize()}),$(this.seriesToolbar).on("removeSeriesRequest",function(e,t){return i.onRemoveSeriesRequest(e,t)}),$(this.rightAxis).on("liveCloudChanged",function(e,t){return i.onLiveCloudChanged(e,t)}),this.patternHighlight&&$(this.patternHighlight).on("pattern-selected-on-chart",function(e){$(i).trigger(e)}),this.model.get("isTouch")?this.initTouch():(this.$interactionLayer.dblclick(function(e){return i.onMouseDblClick(e)}),this.$interactionLayer.mouseup(function(e){return i.onMouseUp(e)}),this.$interactionLayer.mousedown(function(e){return i.onMouseDown(e)}),this.$interactionLayer.mousemove(function(e){return i.onMouseMove(e)}),this.$interactionLayer.mouseleave(function(e){return i.onMouseLeave(e)}),this.model.get("allowScroll")&&this.$interactionLayer.on("mousewheel wheel",function(e){return i.onMouseWheel(e)}),this.model.get("isContextMenuEnabled")&&(window.oncontextmenu=function(){return!window.leftClicked||(window.leftClicked=!1)},this.$interactionLayer.mousedown(function(e){return 2!==e.button||(i.onContextMenu(e),!(window.leftClicked=!0))})),this.model.get("doubleclickNotification")&&this.$interactionLayer.dblclick(function(){$(i).trigger("dblclick")})),this.model.on("change:chartDisplayAreaBackground",function(){i.$backgroundDiv.css("background-color",i.model.get("chartDisplayAreaBackground"))}),this.model.on("change:chartDisplayAreaVerticalGridLinesColor",function(){return i.drawVerticalGidLines(i.lastDisplayDates)}),this.model.on("change:chartDisplayAreaVerticalGridLinesOpacity",function(){return i.drawVerticalGidLines(i.lastDisplayDates)}),this.model.on("change:chartDisplayAreaVerticalGridLinesType",function(){return i.drawVerticalGidLines(i.lastDisplayDates)}),this.model.on("change:chartDisplayAreaAlternativeBackground",function(){return i.drawVerticalGidLines(i.lastDisplayDates)}),this.model.on("change:chartDisplayAreaHorizontalGridLinesColor",function(){return i.drawHorizontalGridLines(i.lastDisplayValues)}),this.model.on("change:chartDisplayAreaHorizontalGridLinesOpacity",function(){return i.drawHorizontalGridLines(i.lastDisplayValues)}),this.model.on("change:chartDisplayAreaHorizontalGridLinesType",function(){return i.drawHorizontalGridLines(i.lastDisplayValues)}),this.model.on("change:chartBorderColor",function(){i.$crosshairCanvas.css({"border-left":"1px solid "+i.model.get("chartBorderColor"),"border-top":"1px solid "+i.model.get("chartBorderColor"),"border-right":"1px solid "+i.model.get("chartBorderColor")})},this),this.model.on("change:axisFontSizeHorizontal",function(){i.$bottomAxisDiv.css("font-size",i.model.get("axisFontSizeHorizontal"))}),this.model.on("change:axisFontSizeVertical",function(){i.$rightAxisDiv.css("font-size",i.model.get("axisFontSizeVertical"))})},YD.prototype.initTouch=function(){var i,a,n=this,o=!1,r=_.throttle(function(e,t){$(n).trigger("moveChart",{type:"moveChart",direction:"pinchout"===e?"zoom-in":"zoom-out",step:t})},100),e=new Hammer(this.$interactionLayer[0]);e.get("pinch").set({enable:!0,threshold:0}),e.on("panstart",function(e){n.touchDrag=!0,n.isDraggingChart=!0,n.draggingStartX=e.center.x}),e.on("panmove",function(e){n.handleChartDragging({pageX:e.center.x+e.deltaX,pageY:e.center.y+e.deltaY})}),e.on("panend",function(){n.isDraggingChart=!1,n.draggingStartX=null}),e.on("pinchstart",function(){o=!0,i=0}),e.on("pinchend",function(){o=!1,i=0}),e.on("pinchin pinchout",function(e){var t;o&&(t=Math.round(e.distance-i),i=e.distance,a=n.displayArea.displayToIndex-n.displayArea.displayFromIndex,0<(t=Math.round(.01*a+t))&&r(e.type,t))})},YD.prototype.onContextMenu=function(e){var t,i,a,n,o,r=this,s=this.annotationsManager.onContextMenu(e);return s&&!this.isContextOpen&&"InteractionLayer"===e.target.className&&(t=(n=this.$interactionLayer.offset()).left,i=n.top,a=t+this.$interactionLayer.width(),n=i+this.$interactionLayer.height(),e.pageX>=t&&e.pageX<=a&&e.pageY>=i&&e.pageY<=n?(o=new SettingsContextMenu({model:this.model,clipboard:this.annotationsManager.clipboard,hasAnnotations:0<this.annotationsManager.allAnnotations.length,layerHeight:this.$interactionLayer.height(),positionValue:this.displayArea.getPositionValue(e.pageY),onMainChart:"mainChartArea"===this.prefix}),this.isContextOpen=!0,o.show(e),o.on("closed",function(){o.off(),r.isContextOpen=!1}),$(o).on("redraw",function(){r.onResize()}),$(o).on("delete-all",function(){r.annotationsManager.clearAnnotationsForced()}),$(o).on("remove-indicator",function(){$(r).trigger("remove-indicator",{type:"remove-indicator",chartArea:r})}),$(o).on("paste",function(e,t){var i,a=t.item;a.drawTool={tool:t.item.drawTool.tool,fillColorDef:t.item.drawTool.fillColorDef,fillOpacity:t.item.drawTool.fillOpacity,lineColorDef:t.item.drawTool.lineColorDef,lineOpacity:t.item.drawTool.lineOpacity,lineThickness:t.item.drawTool.lineThickness,textColor:t.item.drawTool.textColor,textMargin:t.item.drawTool.textMargin,textSize:t.item.drawTool.textSize},a.drawStartPoint={selectedIndex:t.item.drawStartPoint.selectedIndex,selectedItem:t.item.drawStartPoint.selectedItem,selectedPrice:t.item.drawStartPoint.selectedPrice,x:(t.item.drawStartPoint.selectedItem.get("index")-r.annotationsManager.lastDisplayFromIndex)*r.annotationsManager.lastxRatio+t.item.drawStartPoint.xAddOn*r.annotationsManager.lastxRatio,xAddOn:t.item.drawStartPoint.xAddOn,y:r.displayArea.getValuePosition(t.item.drawStartPoint.selectedPrice)},a.drawEndPoint={selectedIndex:t.item.drawEndPoint.selectedIndex,selectedItem:t.item.drawEndPoint.selectedItem,selectedPrice:t.item.drawEndPoint.selectedPrice,x:(t.item.drawEndPoint.selectedItem.get("index")-r.annotationsManager.lastDisplayFromIndex)*r.annotationsManager.lastxRatio+t.item.drawEndPoint.xAddOn*r.annotationsManager.lastxRatio,xAddOn:t.item.drawEndPoint.xAddOn,y:r.displayArea.getValuePosition(t.item.drawEndPoint.selectedPrice)},i=Helpers.hexToRgb(a.drawTool.lineColorDef),a.drawTool.lineColor="rgba("+i.r+","+i.g+","+i.b+","+a.drawTool.lineOpacity/100+")",i=Helpers.hexToRgb(a.drawTool.fillColorDef),a.drawTool.fillColor="rgba("+i.r+","+i.g+","+i.b+","+a.drawTool.fillOpacity/100+")","text-note"===t.item.drawTool.tool&&(a.notePoints=[]);a=r.annotationsManager.addAnnotation(a);a.drawStartTime=Helpers.getNextDate(a.drawStartPoint.selectedItem.get("quoteDate"),r.model.get("granularity")).getTime(),a.drawEndTime=Helpers.getNextDate(a.drawEndPoint.selectedItem.get("quoteDate"),r.model.get("granularity")).getTime(),r.annotationsManager.drawAnnotations(r.annotationsManager.lastxRatio,r.annotationsManager.lastDisplayFromIndex)}),s=!1):this.isContextOpen&&(this.isContextOpen=!1)),s},YD.prototype.onDisplayUpdated=function(){var e,t,i,a=this,n=this.displayArea.displayValues,o=this.calculateDisplayDates2(this.displayArea.displayFromIndex,this.displayArea.displayToIndex,this.displayArea.$el.width()),r=[],s=[];if(o){if(!this.valuesDivider){for(i=(t=[1]).length,e=0;e<i;e+=1)if(0<this.displayArea.min-t[e]){this.valuesDivider=t[e];break}0<n.length&&!this.valuesDivider&&(this.valuesDivider=1)}for(i=n.length,e=0;e<i;e+=1)r.push([n[e]/this.valuesDivider,this.displayArea.getValuePosition(n[e])+this.model.get("topInnerMarginPx")]);for(this.drawHorizontalGridLines(r),this.rightAxis.setDisplayValues(r),i=o.length,e=0;e<i;e+=1)s.push({date:this.displayArea.allDates[o[e].index],position:this.displayArea.xRatio*(o[e].index-this.displayArea.displayFromIndex),isMajorTick:o[e].isMajorTick,format:o[e].format});this.drawVerticalGidLines(s),this.bottomAxis.setDates(s),this.model.get(this.prefix+"IsRightAxisVisible")&&(this.lastBgd=null,this.rightAxis.onResize()),this.model.get(this.prefix+"IsBottomAxisVisible")&&this.bottomAxis.onResize(),this.pendingDatesChangeEvent&&(this.displayArea.hasDatesRangeChanged||this.displayArea.hasPriceRangeChanged)&&(this.pendingDatesChangeEvent=!1,this.patternHighlight&&this.patternHighlight.updateDisplay(),$(this).trigger("datesRangeChanged",{type:"datesRangeChanged",itemsOnDisplay:this.displayArea.elementsCount,startDate:this.displayArea.allDates[this.displayArea.displayFromIndex],endDate:this.displayArea.allDates[this.displayArea.displayToIndex],elements:this.displayArea.allSeries[0].get("elements").slice(this.displayArea.displayFromIndex,this.displayArea.displayToIndex+1),isLiveElementVisible:this.displayArea.displayToIndex===this.displayArea.allSeries[0].get("elements").length-1,min:this.displayArea.min,max:this.displayArea.max}))}this.firstRender&&(this.firstRender=!1,_.defer(function(){a.annotationsManager.applyAnnotationsStorage()})),$(this).trigger("chart-rendered")},YD.prototype.onLiveCloudChanged=function(e,t){t.show?"rightAxis"===t.source&&(this.rightLiveCloud={left:t.left,top:t.top,width:t.width,height:t.height}):"rightAxis"===t.source&&(this.rightLiveCloud=null)},YD.prototype.onLiveElementCanvasUpdated=function(){this.lastValue=this.model.get("lastAvgPrice"),this.isMouseOn&&this.onMouseMove({pageX:this.lastMouseX,pageY:this.lastMouseY})},YD.prototype.onMouseDblClick=function(e){this.annotationsManager.onMouseDblClick(e)},YD.prototype.onMouseDown=function(e){var t;this.checkIsMouseOverRightAxis(e)?(this.isZoomingY=!0,this.previousZoomY=e.pageY):this.annotationsManager.onMouseDown(e)||(this.isZoomingEnabled?(this.isZooming=!0,this.selectedItems=[]):this.patternHighlight&&this.patternHighlight.isActive()?(t=this.displayArea.getPositionDate(e.pageX),this.patternHighlight.startSelection(t[2])):this.checkIsMouseOverResizeEdge(e)?(this.isResizingChartArea=!0,$(this).trigger("startResize",{type:"startResize",pageX:e.pageX,pageY:e.pageY,source:this})):(this.isDraggingChart=!0,this.draggingStartX=e.pageX))},YD.prototype.onMouseUp=function(e){var t,i;this.isZooming&&this.selectedItems&&2<=this.selectedItems.length?(i=this.selectedItems[0].get("index")<this.selectedItems[1].get("index")?(t=this.selectedItems[0].get("index"),this.selectedItems[1].get("index")):(t=this.selectedItems[1].get("index"),this.selectedItems[0].get("index")),this.cancelMouseZoom(),t!==i&&$(this).trigger("zoom",{type:"zoom",fromIndex:t,toIndex:i})):this.annotationsManager.onMouseUp(e)?($(this).trigger("stopDrawing",{type:"stopDrawing"}),this.$interactionLayer.css("cursor","default")):this.isZoomingY?(this.clearMouseZoomY(),$(this).trigger("zoomY",{type:"zoomY"})):this.isDraggingChart?(this.isDraggingChart=!1,this.draggingStartX=null):this.patternHighlight&&this.patternHighlight.isActive()?this.patternHighlight.endSelection():this.isResizingChartArea&&(this.isResizingChartArea=!1,$(this).trigger("stopResize",{type:"stopResize",source:this}))},YD.prototype.onMouseMove=function(e){var t,i,a,n=this.displayArea.getPositionIndex(e.pageX),o=[];this.isMouseOn=!0,this.lastMouseX=e.pageX,this.lastMouseY=e.pageY,this.annotationsManager.isActive(e,n)?(i=this.annotationsManager.showCrosshair,this.$interactionLayer.css("cursor",this.annotationsManager.cursor)):this.isZooming&&-1!==n?(this.handleMouseZoom(e,n),1<this.selectedItems.length&&(o.push([this.selectedItems[0].get("quoteDate"),this.displayArea.xRatio*(this.selectedItems[0].get("index")-this.displayArea.displayFromIndex+1)-this.displayArea.xRatio/2+this.model.get("leftInnerMarginPx")]),o.push([this.selectedItems[1].get("quoteDate"),this.displayArea.xRatio*(this.selectedItems[1].get("index")-this.displayArea.displayFromIndex+1)-this.displayArea.xRatio/2+this.model.get("leftInnerMarginPx")]))):this.checkIsMouseOverRightAxis(e)?(this.isMouseOn=!1,this.$interactionLayer.css("cursor","n-resize"),this.isZoomingY&&this.handleMouseZoomY(null,e),this.patternHighlight&&this.patternHighlight.isActive()&&this.patternHighlight.cancelSelection()):this.isZoomingY?(this.isZoomingY=!1,this.clearMouseZoomY(),$(this).trigger("zoomY",{type:"zoomY"})):this.patternHighlight&&this.patternHighlight.isActive()&&-1!==n?(t=this.displayArea.allSeries[0].get("elements")[n])&&(t.get("isFake")||t.get("isLiveElement")?this.patternHighlight.cancelSelection():this.patternHighlight.updateSelection(t),$(this).trigger("interactionmousemove",{type:"interactionmousemove",pageX:e.pageX,pageY:e.pageY,sourceChartArea:this,mouseIndex:n,event:e})):this.isDraggingChart&&!this.model.get("isTouch")||this.isDraggingChart&&this.model.get("isTouch")&&this.touchDrag?this.handleChartDragging(e):this.checkIsMouseOverResizeEdge(e)?this.$interactionLayer.css("cursor","n-resize"):("default"!==this.$interactionLayer.css("cursor")&&this.$interactionLayer.css("cursor","default"),this.isMouseOn=!0,i=!(this.isZooming=!1)),i?(this.model.get("snapToDataPoint")&&"mainChartArea"===this.prefix?(t=t||this.displayArea.allSeries[0].get("elements")[n])&&t.get("isFake")&&this.displayArea.allSeries[0].get("liveElement")&&((i=new Date(this.displayArea.allSeries[0].get("liveElement").get("quoteDate"))).setSeconds(0),i.getTime()>=t.get("quoteDate").getTime()&&(a=this.displayArea.allSeries[0].get("liveElement"))):t=null,this.drawCrosshair(e.pageX,e.pageY,t,!1,a,"mainChartArea"===this.prefix),this.refreshSelectedPriceAndDate(e.pageX,e.pageY,n,t,a,"mainChartArea"===this.prefix),-1!==n&&$(this).trigger("interactionmousemove",{type:"interactionmousemove",pageX:e.pageX,pageY:e.pageY,sourceChartArea:this,mouseItem:t,mouseIndex:n,event:e,liveItem:a})):(this.clearCrosshair(),this.clearSelectedValue(),0<o.length?this.drawSelectedDates(o):this.clearSelectedDates())},YD.prototype.onMouseLeave=function(e){this.handleMouseLeave(),this.isMouseOn=!1,this.isDraggingChart=!1,"default"!==this.$interactionLayer.css("cursor")&&this.$interactionLayer.css("cursor","default"),this.patternHighlight&&this.patternHighlight.cancelSelection(),$(this).trigger("interactionmouseleave",{type:"interactionmouseleave",eventArgs:e,eventSource:this})},YD.prototype.onMouseWheel=function(e){var t,i,a=e.originalEvent||e;this.checkIsMouseOverRightAxis(a)?a.deltaY&&(0<a.deltaY?this.handleMouseZoomY(a,!0,!1,!0):this.handleMouseZoomY(a,!0,!0,!1),$(this).trigger("zoomY",{type:"zoomY"})):(t=this.displayArea.displayFromIndex,i=this.displayArea.displayToIndex,e=parseInt((.03*(i-t)).toString(),10),i=$(a.currentTarget).width(),t=a.clientX,e<=0&&(e=1),a.deltaY&&(a=0<a.deltaY?"zoom-in":"zoom-out",$(this).trigger("moveChart",{type:"moveChart",direction:a,step:e,leftRatio:t/i,rightRatio:(i-t)/i})))},YD.prototype.onRemoveSeriesRequest=function(e,t){this.removeSeries(t.series)},YD.prototype.onResize=function(){var e=this.$el.width(),t=this.$el.height();this.applyLayout(e,t)},YD.prototype.onToolbarResize=function(){$(this).trigger("toolbarResize")},YD.prototype.redoAnnotations=function(){this.annotationsManager.redoAnnotations()},YD.prototype.refreshSelectedPriceAndDate=function(e,t,i,a,n,o){var r=[],o=o&&"percent"===this.model.get("stockDisplayValues")?this.displayArea.allSeries[0].get("percentBase"):null,t=a?a.get("value"):this.displayArea.getPositionValue(t);n?this.drawSelectedValue(null):null!==t&&this.drawSelectedValue([t/this.valuesDivider,this.displayArea.getValuePosition(t,o)+this.model.get("topInnerMarginPx")]),r.push([this.displayArea.allDates[i],this.displayArea.xRatio*(i-this.displayArea.displayFromIndex+1)-this.displayArea.xRatio/2+this.model.get("leftInnerMarginPx")]),this.drawSelectedDates(r)},YD.prototype.remove=function(){return XD.prototype.remove.call(this),this},YD.prototype.removeSeries=function(e){this.allSeries=_.without(this.allSeries,e),this.displayArea.removeSeries(e),0<this.allSeries.length?(this.seriesToolbar.allItems<=0&&this.onResize(),this.displayCurrent()):$(this).trigger("removeChartAreaRequest",{type:"removeChartAreaRequest",chartArea:this})},YD.prototype.setChartName=function(e,t,i,a){this.displayTexAlign=i||"center",this.displayTexAlignV=a||"middle",this.$displayText.html(e),t?this.$displayText.css("font-size",t):this.$displayText.css("font-size",""),this.updateDisplayText(this.displayTexAlign,this.displayTexAlignV)},YD.prototype.toolbarHeight=function(){var e=0;return this.model.get(this.prefix+"isSeriesBarVisible")&&0<(e=$(this.seriesToolbar.el).height())&&(e+=this.model.get("seriesBarMarginPx")),e},YD.prototype.undoAnnotations=function(){this.annotationsManager.undoAnnotations()},YD.prototype.updateDisplayText=function(e,t){var i=this.$el.height(),a=this.$displayText.height();switch(t){case"top":this.$displayText.css("bottom","auto"),this.$displayText.css("top",3);break;case"bottom":this.$displayText.css("top","auto"),this.$displayText.css("bottom",3);break;case"middle":default:this.$displayText.css("bottom","auto"),this.$displayText.css("top",i/2-a/2)}},YD),XD;function YD(e){var t=XD.call(this,e)||this;return t.displayTexAlign="center",t.displayTexAlignV="middle",t.isContextOpen=!1,t.isMouseOn=!1,t.isResizingChartArea=!1,t.pendingDatesChangeEvent=!1,t.firstRender=!0,t.initialize2(e),t}var ChartSeries=(zI=Backbone.Model,__extends(AI,zI),Object.defineProperty(AI.prototype,"IndicatorParameters",{set:function(e){this.indicatorParameters=e,this.isIndicator=!0},enumerable:!1,configurable:!0}),AI.prototype.addDisplaySeries=function(e){this.displaySeries.push(e)},AI.prototype.clone=function(){var t=this,i=new AI;return i.symbol=this.symbol,i.displayName=this.displayName,i.id=this.id,i.isToolbarVisible=this.isToolbarVisible,$.each(this.displaySeries,function(e){i.addDisplaySeries(t.displaySeries[e])}),i},AI.prototype.getID=function(){function e(){return Math.floor(65536*Math.random()).toString(16)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()},AI.prototype.slice=function(t,i){var a=this,n=new AI;return n.symbol=this.symbol,n.displayName=this.displayName,n.isToolbarVisible=this.isToolbarVisible,n.id=this.id,$.each(this.displaySeries,function(e){n.addDisplaySeries(a.displaySeries[e].slice(t,i))}),n},AI),zI,NI;function AI(){var e=null!==zI&&zI.apply(this,arguments)||this;return e.id=e.getID(),e.symbol=null,e.displayName=null,e.showDecimalPlaces=!1,e.isToolbarVisible=!1,e.canUserEdit=!1,e.displaySeries=[],e.seriesMarkers=[],e.isIndicator=!1,e.indicatorParameters=null,e.displayIndex=0,e.chartArea=null,e}NI=jQuery,NI.widget("ui.dragslider",NI.ui.slider,{options:NI.extend({},NI.ui.slider.prototype.options,{rangeDrag:!1}),_create:function(){NI.ui.slider.prototype._create.apply(this,arguments),this._hoverable(this.range),this._rangeCapture=!1}});var TimeSlider=(PI=Backbone.View,__extends(QI,PI),QI.prototype.applyLayout=function(e,t){var i=this.model.get("rightAxisWidthPx"),a=this.model.get("chartBorderColor");this.model.get("showArrows")?(this.$leftArrow.css("left",0),this.$rightArrow.css("right",i)):(this.$leftArrow.css({width:0,display:"none"}),this.$rightArrow.css({width:0,display:"none"}));var n=Math.max(0,this.$leftArrow.width()),o=Math.max(0,this.$rightArrow.width());this.scrollWidth=e-(0+n+0+0+o+i),this.bottomScroll.css("left",0+n+0),this.bottomScroll.css("width",this.scrollWidth),this.bottomScroll.css("height","9.1875px"),this.model.get("showSliderDates")?this.$datesBox.css({left:0+n+0,width:this.scrollWidth,height:t}):this.$datesBox.hide(),this.topScroll.css("left",0+n+0),this.topScroll.css("width",this.scrollWidth),this.topScroll.css("height",t-9.1875),this.$leftBox.css({height:t,"border-top-color":a,"border-right-color":a}),this.$rightBox.css({height:t,"border-top-color":a,"border-left-color":a}),this.$centerBox.css({height:t})},QI.prototype.applyTemplate=function(){var e=this,t=this.model.get("chartBorderColor");$(this.el).html(T.TimeSlider()),this.bottomScroll=this.$el.find(".bottomScroll"),this.topScroll=this.$el.find(".topScroll"),this.$leftArrow=this.$el.find(".LeftArrow"),this.$rightArrow=this.$el.find(".RightArrow"),this.$centerBox=this.$el.find(".centerBox"),this.$centerBox.css("background-color",this.model.get("chartDisplayAreaBackground")),this.$leftBox=this.$el.find(".leftBox"),this.$rightBox=this.$el.find(".rightBox"),this.$datesBox=this.$el.find(".datesBox"),this.buildTopScroll(),this.buildBottomScroll(),this.buildButtons(),this.sliderRange.css({"border-top-color":t,"border-bottom-color":t}),this.model.on("change:chartDisplayAreaBackground",function(){e.$centerBox.css("background-color",e.model.get("chartDisplayAreaBackground"))})},QI.prototype.buildButtons=function(){var e=this;this.$leftArrow.button({icons:{primary:"ui-icon-triangle-1-w"},text:!1}).on("click",function(){return e.onLeftArrowClick()}),this.$rightArrow.button({icons:{primary:"ui-icon-triangle-1-e"},text:!1}).on("click",function(){return e.onRightArrowClick()})},QI.prototype.buildBottomScroll=function(){var i=this;this.bottomScroll.dragslider({animate:!1,range:!0,rangeDrag:!0,min:0,max:30,values:[7,18],step:1,slide:function(e,t){return i.onBottomSliderSlide(e,t)}}),this.bottomScroll.find(".ui-slider-handle").hide(),this.sliderRange=this.bottomScroll.find(".ui-slider-range")},QI.prototype.buildTopScroll=function(){var i=this;this.topScroll.slider({animate:!1,range:!0,min:0,max:30,values:[7,18],step:1,slide:function(e,t){return i.onTopSliderSlide(e,t)}}),this.leftHandle=_.first(this.topScroll.find(".ui-slider-handle")),$(this.leftHandle).addClass("left-handle"),this.rightHandle=_.last(this.topScroll.find(".ui-slider-handle")),$(this.rightHandle).addClass("right-handle")},QI.prototype.datesWidth=function(){return this.$datesBox.width()},QI.prototype.initialize=function(e){var t=this;this.options=e,this.isMoving=!1,this.applyTemplate(),this.onResize(),this.model.on("change:chartBorderColor",function(){t.$leftBox.css({"border-top-color":t.model.get("chartBorderColor"),"border-right-color":t.model.get("chartBorderColor")}),t.$rightBox.css({"border-top-color":t.model.get("chartBorderColor"),"border-left-color":t.model.get("chartBorderColor")}),t.sliderRange.css({"border-top-color":t.model.get("chartBorderColor"),"border-bottom-color":t.model.get("chartBorderColor")})})},QI.prototype.onBottomSliderSlide=function(e,t){$(this.topScroll).slider("option","values",t.values),this.updateBoxes(),$(this).trigger("sliderSlide",{type:"sliderSlide",fromIndex:t.values[0],toIndex:t.values[1]})},QI.prototype.onLeftArrowClick=function(){var e,t=$(this.topScroll).slider("option","values"),i=t[1]-t[0],i=t[0]-i<0?(e=0,i>this.elementsCount-1?this.elementsCount-1:i):(e=t[0]-i,t[1]-i);$(this.bottomScroll).dragslider("option","values",[e,i]),$(this.topScroll).slider("option","values",[e,i]),this.updateBoxes(),$(this).trigger("sliderSlide",{type:"sliderSlide",fromIndex:e,toIndex:i})},QI.prototype.onResize=function(){var e=this.$el.width(),t=this.$el.height();this.applyLayout(e,t),this.updateBoxes(),null!==this.currentDates&&0<this.elementsCount&&this.updateScale(this.currentDates,this.elementsCount)},QI.prototype.onRightArrowClick=function(){var e,t,i=$(this.topScroll).slider("option","values"),a=i[1]-i[0];i[1]+a>=this.elementsCount?(t=this.elementsCount+parseInt((a/2).toString(),10),e=this.elementsCount-parseInt((a/2).toString(),10)):(e=i[0]+a,t=i[1]+a),$(this.bottomScroll).dragslider("option","values",[e,t]),$(this.topScroll).slider("option","values",[e,t]),this.updateBoxes(),$(this).trigger("sliderSlide",{type:"sliderSlide",fromIndex:e,toIndex:t})},QI.prototype.onTopSliderSlide=function(e,t){$(this.bottomScroll).dragslider("option","values",t.values),this.updateBoxes(),$(this).trigger("sliderSlide",{type:"sliderSlide",fromIndex:t.values[0],toIndex:t.values[1]})},QI.prototype.remove=function(){return Backbone.View.prototype.remove.call(this),this},QI.prototype.resetSlider=function(e,t,i,a){this.elementsCount=i,$(this.topScroll).slider({min:0,max:i-1,values:[e,t],value:e}),$(this.bottomScroll).dragslider({min:0,max:i-1,values:[e,t],value:e}),this.updateBoxes(),a&&this.updateScale(a,i)},QI.prototype.updateBoxes=function(){var e=$(this.sliderRange),t=this.$el.offset().left,i=e.offset().left;this.$leftBox.css({left:0,width:i-t});i=parseFloat(this.$leftBox.css("width")),t=e.width()+2;this.$centerBox.css({left:i,width:t});e=this.scrollWidth-(i+t);this.$rightBox.css({left:i+t-1,width:0<e?2+e:0})},QI.prototype.updateScale=function(e,t){if(this.model.get("showSliderDates")){this.$datesBox.html(""),this.currentDates=e;for(var i,a=void 0,n=void 0,o=-1,r=void 0,s=this.$datesBox.width()/t,l=e.length,r=0;r<l;r+=1)(a=$(document.createElement("div"))).html(e[r].date.format(e[r].format)),a.appendTo(this.$datesBox),e[r].isMajorTick?a.addClass("axisTextMajor"):a.addClass("axisTextMinor"),i=a.width(),(n=(n=(e[r].index+1)*s-i/2)<0?0:n)<o?a.remove():(a.css("left",n),o=n+i)}},QI),PI;function QI(){return null!==PI&&PI.apply(this,arguments)||this}var InfoBorder=(SJ=Backbone.View,__extends(TJ,SJ),TJ.prototype.applyTemplate=function(){$(this.el).html(T.InfoBorder()),this.rootDiv=$(this.el).find(".RootDiv"),this.indicatorsDiv=$(this.el).find(".IndicatorsDiv"),this.openPriceTd=this.$el.find(".OpenPrice"),this.highPriceTd=this.$el.find(".HighPrice"),this.lowPriceTd=this.$el.find(".LowPrice"),this.closePriceTd=this.$el.find(".LastPrice"),this.dateTd=this.$el.find(".DateValue")},TJ.prototype.clear=function(){this.openPriceTd.text(""),this.highPriceTd.text(""),this.lowPriceTd.text(""),this.closePriceTd.text(""),this.dateTd.text(""),$(this.indicatorsDiv).html(""),$(this.el).hide(),this.visible=!1},TJ.prototype.initialize2=function(e){this.options=e,this.visible=!1,this.applyTemplate(),this.initializeEvents(),this.$el.hide()},TJ.prototype.initializeEvents=function(){var e=this;this.rootDiv.draggable(),$(this.options.dragParent).on("resized",function(){return e.updateDragLimit()}),this.model.on("change:showInfoBorder",function(){return e.onShowInfoBorderChanged()}),this.model.on("change:isInfoBorderInCursorMode",function(){return e.onIsInfoBorderInCursorModeChanged()})},TJ.prototype.onPause=function(e){e?this.$el.show():this.$el.hide()},TJ.prototype.onShowInfoBorderChanged=function(){this.model.get("showInfoBorder")?this.$el.show():this.$el.hide()},TJ.prototype.onIsInfoBorderInCursorModeChanged=function(){!this.model.get("isInfoBorderInCursorMode")&&this.model.get("showInfoBorder")?this.$el.show():this.$el.hide()},TJ.prototype.setValues=function(e,t,i){var a;e&&(this.visible||$(this.el).show(),e.get("isFake")||((a=e.get("open"))&&this.openPriceTd.text(a.toFixed(t)),(a=e.get("high"))&&this.highPriceTd.text(a.toFixed(t)),(a=e.get("low"))&&this.lowPriceTd.text(a.toFixed(t)),(a=e.get("close"))&&this.closePriceTd.text(a.toFixed(t))),this.dateTd.text(e.get("quoteDate").format(i)),this.visible=!0,this.initialized?(i=[(i=$(this.options.dragParent.el).offset()).left,i.top+5])[0]===this.prevParentOffset[0]&&i[1]===this.prevParentOffset[1]||this.updateDragLimit():(this.initialized=!0,this.updateDragLimit()))},TJ.prototype.setIndicatorsValues=function(e,t){var i="<table>";this.lastValues=e,this.lastFixedValue=t,$(this.indicatorsDiv).html(""),_.each(e,function(e){e.value&&(i+='<tr style="color: ',i+=e.displayColor,i+=';"><td>',i+=e.displayName,i+=':</td><td style="width: 7px;"></td>',i+='<td style="text-align: right; min-width: 65px;">',i+=e.value.toFixed(t),i+="</td></tr>")}),i+="</table>",$(this.indicatorsDiv).html(i)},TJ.prototype.updateDragLimit=function(){var e=this.options,t=$(e.dragParent.el),i=$(this.rootDiv),a=t.offset(),n=a.left,e=a.top+5,t=$(this.options.dragParent.el),a=n+t.width()-(i.width()+9),i=e+t.height()-i.height();this.prevParentOffset=[n,e];try{$(this.rootDiv).draggable("option","containment",[n,e,a,i])}catch(e){}},TJ),SJ;function TJ(e){var t=SJ.call(this,e)||this;return t.prevParentOffset=[0,0],t.initialize2(e),t}var IndicatorsToolbarItem=(sK=Backbone.Model,__extends(tK,sK),tK),sK;function tK(){return null!==sK&&sK.apply(this,arguments)||this}var IndicatorForm=(uK=Backbone.View,__extends(vK,uK),vK.prototype.applyTemplate=function(){var t,i,r=this,a=[],n=[];this.options.Indicator.parameters&&(this.options.Indicator.parameters.number=_.filter(this.options.Indicator.parameters,function(e){return"number"===e.Type}),this.options.Indicator.parameters.list=_.filter(this.options.Indicator.parameters,function(e){return"list"===e.Type}),_.each(this.options.Indicator.parameters.number,function(e){void 0!==e.Min&&(e.MinSet=!0),void 0!==e.Step&&(e.StepSet=!0)})),a.number=[],a.list=[],_.each(this.options.Indicator.parameters,function(e){i={Name:e.Name,Value:e.Value,Type:e.Type,OrderIndex:e.OrderIndex},e.MinSet&&(i.MinSet=e.MinSet,i.Min=e.Min),e.StepSet&&(i.StepSet=e.StepSet,i.Step=e.Step),"list"===e.Type?(a.list.push(i),i.Options=[],_.each(e.Options,function(e){i.Options.push({Name:e.Name,Value:e.Value,Selected:e.Selected})})):"number"===e.Type&&a.number.push(i),a.push(i)}),_.each(this.options.Indicator.discreteIndicators,function(e){n.push({discreteIndicatorID:e.discreteIndicatorID,discreteName:e.discreteName,shortName:e.shortName,displayType:e.displayType,color:e.color,lineThickness:e.lineThickness})}),$(this.el).html(T.IndicatorForm({indicatorID:this.options.Indicator.indicatorID,code:this.options.Indicator.code,name:this.options.Indicator.name,shortName:this.options.Indicator.shortName,parameters:a,display:this.options.Indicator.display,markers:this.options.Indicator.markers,discreteIndicators:n})),_.each(this.$el.find("input[name=color]"),function(e){switch(t=e.getAttribute("data-indicator-discrete-id"),e.getAttribute("data-color-type")){case"profitColor":$(e).colorpicker({displayIndicator:!1,color:_.find(r.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&(t=parseInt(t,10)),e.discreteIndicatorID===t}).profitColor});break;case"lossColor":$(e).colorpicker({displayIndicator:!1,color:_.find(r.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&(t=parseInt(t,10)),e.discreteIndicatorID===t}).lossColor});break;case"lineColor":default:$(e).colorpicker({displayIndicator:!1,color:_.find(r.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&(t=parseInt(t,10)),e.discreteIndicatorID===t}).color})}$(e).on("change.color",function(e,t){r.onColorChanged(e,t)})}),_.each(this.$el.find("input[name=thickness]"),function(e){var t,i=$(e);r.model.get("isMobile")?((t=$(document.createElement("div"))).css("height","26px"),i.parent().append(t),t.button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).on("click",function(){var e=i.val(),t=parseInt(e,10),e=parseInt(i.attr("data-indicator-discrete-id"),10);1<=t-1?t-=1:t=1,i.val(t),r.onThicknessChanged(e,t)}),(t=$(document.createElement("div"))).css("height","26px"),i.parent().append(t),t.button({icons:{primary:"ui-icon-triangle-1-n"},text:!1}).on("click",function(){var e=i.val(),t=parseInt(e,10),e=parseInt(i.attr("data-indicator-discrete-id"),10);i.val(t+=1),r.onThicknessChanged(e,t)})):$(e).spinner({stop:function(e){r.onThicknessChanged(parseInt(e.target.getAttribute("data-indicator-discrete-id"),10),$(e.target).spinner("value"))},min:1})}),_.each(this.$el.find("input[name=number]"),function(e){var i=void 0!==$(e).data("min")?$(e).data("min"):1,t=$(e).data("step")||1,a=$(e),n=a.attr("data-parameter-order-index"),o=parseInt(n,10);r.model.get("isMobile")?((n=$(document.createElement("div"))).css("height","26px"),a.parent().append(n),n.button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).on("click",function(){var e=a.val(),t=parseInt(e,10);i<=t-1?t-=1:t=i,a.val(t),r.delay&&(clearTimeout(r.delay),r.delay=null),r.delay=setTimeout(function(){r.onParamValueChanged(o,t)},1e3)}),(n=$(document.createElement("div"))).css("height","26px"),a.parent().append(n),n.button({icons:{primary:"ui-icon-triangle-1-n"},text:!1}).on("click",function(){var e=a.val(),t=parseInt(e,10);a.val(t+=1),r.delay&&(clearTimeout(r.delay),r.delay=null),r.delay=setTimeout(function(){r.onParamValueChanged(o,t)},1e3)})):$(e).spinner({stop:function(e){r.onParamValueChanged(parseInt(e.target.getAttribute("data-parameter-order-index"),10),$(e.target).spinner("value"))},min:i,step:t})}),this.$el.find("select").on("change",function(e){r.onListChanged(e)}),this.$el.find(".ui-spinner").addClass("text-box")},vK.prototype.initialize2=function(e){var t=this;this.options=e,this.applyTemplate(),this.originalIndicator=$.extend(!0,{},this.options.Indicator),this.$el.on("dialogclose",function(e){e.originalEvent&&$(e.originalEvent.target).closest(".ui-dialog-titlebar-close").length&&t.resetChanges()})},vK.prototype.onColorChanged=function(e,t){var i,a=e.target.getAttribute("data-indicator-discrete-id"),e=e.target.getAttribute("data-color-type"),n=_.find(this.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&"number"!=typeof a&&(a=parseInt(a,10)),e.discreteIndicatorID===a});switch(e){case"profitColor":n.profitColor=t;break;case"lossColor":n.lossColor=t;break;case"lineColor":default:n.color=t}var o=_.find(this.options.Indicator.indicatorSeries.displaySeries,function(e){return"number"==typeof(i=e.get("displayId"))&&"number"!=typeof a&&(a=parseInt(a,10)),i===a});switch(e){case"profitColor":o.set({profitColor:t});break;case"lossColor":o.set({lossColor:t});break;case"lineColor":default:o.set({displayColor:t})}o.get("displayArea").updateDisplay(),this.options.IndicatorsManager.updateSerializedIndicators()},vK.prototype.onParamValueChanged=function(t,e){_.find(this.options.Indicator.parameters,function(e){return e.OrderIndex===t}).Value=e,this.updateItemName(),this.options.IndicatorsManager.updateIndicatorByObjectID(this.options.Indicator.objectID,this.options.Indicator.parameters)},vK.prototype.onListChanged=function(e){var t=parseInt(e.target.getAttribute("data-parameter-order-index"),10),i=$(e.target).val(),e=_.find(this.options.Indicator.parameters,function(e){return e.OrderIndex===t});_.each(e.Options,function(e){e.Value===i?e.Selected=!0:e.Selected=!1}),this.options.IndicatorsManager.updateIndicatorByObjectID(this.options.Indicator.objectID,this.options.Indicator.parameters)},vK.prototype.onThicknessChanged=function(t,e){var i;_.find(this.options.Indicator.discreteIndicators,function(e){return"number"==typeof e.discreteIndicatorID&&"number"!=typeof t?t=parseInt(t,10):"string"==typeof e.discreteIndicatorID&&"string"!=typeof t&&(t=t.toString()),e.discreteIndicatorID===t}).lineThickness=e;var a=_.find(this.options.Indicator.indicatorSeries.displaySeries,function(e){return"number"==typeof(i=e.get("displayId"))&&"number"!=typeof t?t=parseInt(t,10):"string"==typeof i&&"string"!=typeof t&&(t=t.toString()),i===t});a.set({lineThickness:e}),a.get("displayArea").updateDisplay(),this.options.IndicatorsManager.updateSerializedIndicators()},vK.prototype.resetChanges=function(){var e=this.options.Indicator,i=this.originalIndicator;_.each(e.parameters,function(e,t){e.Value=i.parameters[t].Value,e.Options&&(e.Options=i.parameters[t].Options)}),_.each(e.discreteIndicators,function(e,t){e.color=i.discreteIndicators[t].color,e.lineThickness=i.discreteIndicators[t].lineThickness}),_.each(e.indicatorSeries.displaySeries,function(e,t){e.set({displayColor:i.discreteIndicators[t].color,lineThickness:i.discreteIndicators[t].lineThickness})}),e.isStock||(this.options.IndicatorsManager.updateIndicatorByObjectID(e.objectID,e.parameters),this.updateItemName()),e.indicatorSeries.displaySeries[0].get("displayArea").updateDisplay()},vK.prototype.updateItemName=function(){var e=this.options.TheItem.series.displayName,t="";0<this.options.Indicator.parameters.length&&(t+=" (",_.each(this.options.Indicator.parameters,function(e){e.Value&&(t+=e.Value+",")}),t=t.substr(0,t.length-1),t+=")"),e+=t,this.options.TheItem.$editLink.text(e)},vK),uK;function vK(e){var t=uK.call(this,e)||this;return t.initialize2(e),t}var IndicatorsToolbar=(ZL=Backbone.View,__extends($L,ZL),$L.prototype.addSeries=function(e){var t=this,i=new IndicatorsToolbarItem,a=$(document.createElement("li")),n=$(document.createElement("a")),o=$(document.createElement("span")),r="";e.indicatorDetails.parameters&&0<e.indicatorDetails.parameters.length&&(r+=" (",_.each(e.indicatorDetails.parameters,function(e){e.Value&&(r+=e.Value+",")}),r=r.substr(0,r.length-1),r+=")"),i.series=e.series,i.objectID=e.objectID,i.isStackedIndicator=e.isStackedIndicator,n.prop("href","#"+e.objectID),n.html(e.series.displayName+r),o.css("display","none"),o.html(e.series.displayName),a.appendTo(this.rootDiv),n.appendTo(a),o.appendTo(a),a.series=e.series,n.on("click",function(e){e.preventDefault();e=$(e.currentTarget).prop("hash").substr(1);t.onIndicatorSelected(e)}),i.editButton=a,i.$editLink=n,i.$editText=o,i.series.set({displayIndex:this.allItems.length+1}),this.allItems.push(i),$(this).trigger("toolbarresize")},$L.prototype.applyTemplate=function(){var i=this;$(this.el).html(T.IndicatorsToolbar()),this.rootDiv=$(this.el).find(".IndicatorsToolbar"),this.rootDiv.sortable({placeholder:"indicator-placeholder",start:function(e,t){t.placeholder.html($(t.item).html()),_.each(i.allItems,function(e){e.$editLink.removeClass("hover"),e.$editLink.css("display","none"),e.$editText.css("display","block")})},stop:function(){_.each(i.allItems,function(e){e.$editText.css("display","none"),e.$editLink.css("display","block"),e.$editLink.removeClass("hover")}),i.updateItemsOrderAccordingToButtonsOrder(),$(i).trigger("display-indexes-updated")},helper:function(){return $("<div></div>")}}),this.rootDiv.disableSelection()},$L.prototype.clear=function(){$(this.rootDiv).html(""),this.allItems=[],$(this.el).height(0)},$L.prototype.getHeight=function(){return $(this.rootDiv).outerHeight()},$L.prototype.initialize2=function(e){this.options=e,this.allItems=[],this.elementHeight=0,this.applyTemplate()},$L.prototype.onIndicatorSelected=function(e){var t,i,a=this,e=parseInt(e);this.openDialog?(this.openDialog.$el.parent().toggleClass("flash",!1),_.defer(function(){a.openDialog.$el.parent().toggleClass("flash",!0)})):e&&(t=this.options.indicatorsManager.getIndicaotrByObjectID(e))&&(this.openDialog=new IndicatorForm({model:this.model,Indicator:t,IndicatorsManager:this.options.indicatorsManager,TheItem:_.find(this.allItems,{objectID:t.objectID})}),this.openDialog.$el.dialog({dialogClass:"charting editIndicatorDialog "+this.model.get("currentTheme"),title:t.name,modal:this.model.get("isMobile"),buttons:{Remove:function(){a.openDialog.$el.dialog("close"),a.options.indicatorsManager.removeIndicator(t)},OK:function(){a.openDialog.$el.dialog("close")}},open:function(e){var t=$(e.target).parent().find(".ui-dialog-buttonset");t.parent().css({"padding-left":"1em","padding-top":"0","padding-bottom":"0","margin-top":"0"}),t.css("width","100%"),t.find("button:last").css({float:"right","margin-right":"0"}),$(e.target).css("overflow","visible"),i=$(e.target).parent(),a.model.get("isMobile")&&(i.addClass("mobile"),$(e.target).find("input").attr("readonly","readonly")),a.model.changeThemeClassForElementWhenThemeChanges(i)},resizable:!1,width:"auto",close:function(){a.openDialog.$el.dialog("destroy"),a.openDialog=null}}))},$L.prototype.removeIndicator=function(t){var e=_.find(this.allItems,function(e){return e.objectID===t.objectID});this.allItems=_.without(this.allItems,e),e.editButton.detach(),$(this).trigger("toolbarresize"),$(this).trigger("indicator-removed")},$L.prototype.updateItemsOrderAccordingToButtonsOrder=function(){for(var t,e,i=this.rootDiv.find("a").toArray(),a=0;a<i.length;a+=1)e=$(i[a]),t=parseInt(e.prop("hash").substr(1)),(e=_.find(this.allItems,function(e){return e.objectID===t})).series.set({displayIndex:a})},$L),ZL;function $L(e){var t=ZL.call(this,e)||this;return t.initialize2(e),t}var TechInd={sma:function(e,t){this.pcheck("sma",arguments);for(var i=[],a=0,n=0,o=t.length,n=0;n<e-1;n+=1)i.push(null),a+=t[n];for(i.push((a+=t[n])/e),n=e;n<o;n+=1)a+=t[n]-t[n-e],i.push(a/e);return i},ema:function(e,t){this.pcheck("ema",arguments);for(var i=[],a=0,n=2/(e+1),o=1-n,r=0,s=t.length,r=0;r<e-1;r+=1)i.push(null),a+=t[r];for(i.push((a+=t[r])/e),r=e;r<s;r+=1)i.push(t[r]*n+i[r-1]*o);return i},wma:function(e,t){this.pcheck("wma",arguments);for(var i=[],a=0,n=0,o=t.length,r=0;r<e-1;r+=1)i.push(null),n+=t[r]*(e-(e-1-r)),a+=t[r];for(n+=t[r]*e,a+=t[r],i.push(n/(e*(e+1)/2)),r=e;r<o;r+=1)n+=e*t[r]-a,a+=t[r]-t[r-e],i.push(n/(e*(e+1)/2));return i},rsi:function(e,t){this.pcheck("rsi",arguments);var i,a=[],n=0,o=0,r=0,s=t.length;for(a.push(null),r=1;r<s;r+=1)i=t[r]-t[r-1],r<=e-1?(n+=0<i?i:0,o+=Math.abs(i<0?i:0),r===e-1&&(n/=e,o/=e)):(n=(n*(e-1)+(0<i?i:0))/e,o=(o*(e-1)+Math.abs(i<0?i:0))/e),a.push(r<e-1?null:100-100/(n/o+1));return a},typprice:function(e,t,i){this.pcheck("typprice",arguments);for(var a=[],n=0,o=i.length,n=0;n<o;n+=1)a[n]=(e[n]+t[n]+i[n])/3;return a},truerange:function(e,t,i){this.pcheck("truerange",arguments);var a=[],n=0,o=i.length;for(a.push(null),n=1;n<o;n+=1)a.push(Math.max(e[n]-t[n],Math.abs(e[n]-i[n-1]),Math.abs(t[n]-i[n-1])));return a},atr:function(e,t,i,a){this.pcheck("atr",arguments);a=this.truerange(t,i,a);return this.sma(e,a)},cci:function(e,t,i,a){this.pcheck("cci",arguments);for(var n=[],o=0,r=0,s=0,l=0,d=this.typprice(t,i,a),c=this.sma(e,d),o=0,h=d.length;o<h;o+=1){if(e-1<=o){for(s=d[o]-c[o],l=0,r=o;o-e<r;--r)l+=Math.abs(d[r]-c[o]);l/=e}n.push(o<e-1?null:s/(.015*l))}return n},williams:function(e,t,i,a){this.pcheck("williams",arguments);for(var n=[],o=0,r=0,s=0,l=1/0,d=0,c=0,h=0,p=0,u=a.length,o=0;o<u;o+=1){if(o-e<d)s=t[o]>s?t[d=o]:s;else for(s=0,r=o;o-e<r;--r)s=t[r]>s?t[d=r]:s;if(o-e<c)l=i[o]<l?i[c=o]:l;else for(l=1/0,r=o;o-e<r;--r)l=i[r]<l?i[c=r]:l;e-1<=o&&(h=s-a[o],p=s-l),n.push(o<e-1?null:h/p*-100)}return n},macd:function(e,t,i,a){this.pcheck("macd",arguments);for(var n=[],o=[],r=[],s=[],l=0,d=this.ema(t,e),c=this.ema(i,e),h=e.length,l=0;l<h;l+=1)o[l]=l<i-1?null:d[l]-c[l];if(null!==a)for(r=this.ema(a,o),l=0,h=o.length;l<h;l+=1)l<i+a-1?(s.push(null),r[l]=null):s.push(o[l]-r[l]);return n.MACD=o,n.SIGNAL=r,n.HISTOGRAM=s,n},aroon:function(e,t,i){this.pcheck("aroon",arguments);for(var a=[],n=[],o=[],r=[],s=0,l=0,d=0,c=1/0,h=0,p=0,u=t.length,s=0;s<e;s+=1)n.push(null),o.push(null),r.push(null);for(s=e;s<u;s+=1){if(s-e<h)d=i[s]>d?i[h=s]:d;else for(d=0,l=s;s-e<=l;--l)d=i[l]>=d?i[h=l]:d;if(s-e<p)c=t[s]<c?t[p=s]:c;else for(c=1/0,l=s;s-e<=l;--l)c=t[l]<=c?t[p=l]:c;n.push((e-(s-h))/e*100),o.push((e-(s-p))/e*100),r.push(n[s]-o[s])}return a.UP=n,a.DOWN=o,a.OSC=r,a},stochosc:function(e,t,i,a,n,o){this.pcheck("stochosc",arguments);for(var r=[],s=[],l=[],d=[],c=0,h=0,p=0,u=0,m=0,g=0,f=0,y=0,D=o.length,C=e+t-1,v=e+t+i-1,p=0;p<D;p+=1){if(p-e<f)m=a[p]>m?a[f=p]:m;else for(m=0,u=p;p-e<u;--u)m=a[u]>m?a[f=u]:m;if(p-e<y)g=n[p]<g?n[y=p]:g;else for(g=1/0,u=p;p-e<u;--u)g=n[u]<g?n[y=u]:g;m===g?l.push(50):l.push((o[p]-g)/(m-g)*100),c+=p<t?l[p]:l[p]-l[p-t],s.push(p<C?null:c/t),h+=p<i?s[p]:s[p]-s[p-i],d.push(p<v?null:h/i)}return r.K=s,r.D=d,r},stddev:function(e,t){this.pcheck("stddev",arguments);for(var i,a=[],n=0,o=0,r=0,s=t.length,r=0;r<e-1;r+=1)a.push(null),o+=t[r],n+=Math.pow(t[r],2);for(n+=Math.pow(t[r],2),i=(o+=t[r])/e,a.push(Math.sqrt((n-Math.pow(i,2)*e)/e)),r=e;r<s;r+=1)n+=Math.pow(t[r],2)-Math.pow(t[r-e],2),i=(o+=t[r]-t[r-e])/e,a.push(Math.sqrt((n-Math.pow(i,2)*e)/e));return a},bb:function(e,t){this.pcheck("bb",arguments);for(var i,a=[],n=[],o=[],r=0,s=this.sma(e,t),l=this.stddev(e,t),r=0;r<e-1;r+=1)n.push(null),o.push(null);for(r=e-1,i=s.length;r<i;r+=1)n.push(s[r]+2*l[r]),o.push(s[r]-2*l[r]);return a.BBM=s,a.BBU=n,a.BBL=o,a},maenv:function(e,t,i){this.pcheck("maenv",arguments);for(var a=[],n=[],o=[],r=0,s=this.sma(e,t),l=i/100,r=0,d=s.length;r<d;r+=1)n[r]=s[r]+s[r]*l,o[r]=s[r]-s[r]*l;return a.TOP=n,a.BOTTOM=o,a},trix:function(e,t){this.pcheck("trix",arguments);for(var i=[],a=0,t=this.ema(e,t),t=this.ema(e,t),n=this.ema(e,t),o=3*e,a=0,r=n.length;a<r;a+=1)i.push(a<o?null:(n[a]-n[a-1])/n[a-1]*100);return i},proc:function(e,t){this.pcheck("proc",arguments);for(var i=[],a=0,n=t.length,a=0;a<n;a+=1)i.push(a<e?null:(t[a]-t[a-e])/t[a-e]*100);return i},wws:function(e,t){this.pcheck("wws",arguments);for(var i=[],a=0,n=0,o=t.length,a=0;a<o;a+=1)a<e?(i.push(a===e-1?(n+=t[a])/e:null),n+=t[a]):i.push(i[a-1]+1/e*(t[a]-i[a-1]));return i},swingindex:function(e,t,i,a,n){this.pcheck("swingindex",arguments);var o,r,s,l,d,c=[],h=0,p=0,u=n.length;for(c.push(null),h=1;h<u;h+=1)o=Math.max(Math.abs(i[h]-n[h-1]),Math.abs(a[h]-n[h-1])),r=Math.abs(i[h]-n[h-1]),s=Math.abs(a[h]-n[h-1]),l=Math.abs(i[h]-a[h]),p=s<r&&l<r?r-.5*s+.25*Math.abs(n[h-1]-t[h-1]):r<s&&l<s?s-.5*r+.25*Math.abs(n[h-1]-t[h-1]):l+.25*Math.abs(n[h-1]-t[h-1]),d=(n[h]-n[h-1]+.5*(n[h]-t[h])+.25*(n[h-1]-t[h-1]))/p*50*(o/e),c.push(0===p?0:d);return c},asi:function(e,t,i,a,n){this.pcheck("asi",arguments);var o,r=[],s=this.swingindex(e,t,i,a,n),l=0,d=0;for(r.push(0),l=1,o=s.length;l<o;l+=1)r.push(d+=s[l]);return r},psar:function(e,t,i,a){this.pcheck("psar",arguments);var n=[],o=0,r=e,s=0,l=0,d=0,c=i.length;for(n.push(null),l=i[1]-i[0]<a[1]-a[0]?(s=i[1],a[d=0]):(s=a[1],i[0]),o=1;o<c;o+=1)1===d?(s=n[o-1]+r*(l-n[o-1]),i[o]>l&&(l=i[o],r<t&&(r+=e)),a[o]<s&&(d=0,r=e,s=l,l=a[o])):(s=n[o-1]+r*(l-n[o-1]),a[o]<l&&(l=a[o],r<t&&(r+=e)),i[o]>s&&(d=1,r=e,s=l,l=i[o])),r=this.roundX(r,2),n.push(s);return n},uo:function(e,t,i,a,n,o){this.pcheck("uo",arguments);var r=[],s=this.truerange(a,n,o),l=0,d=[],c=0,h=0,p=0,u=s[0],m=s[0],g=s[0],f=Math.max(e,t,i),y=o.length;for(d.push(null),r.push(null),l=1;l<y;l+=1)d.push(o[l]-Math.min(o[l-1],n[l])),c+=l<=e-1?d[l]:d[l]-d[l-e],u+=l<=e-1?s[l]:s[l]-s[l-e],h+=l<=t-1?d[l]:d[l]-d[l-t],m+=l<=t-1?s[l]:s[l]-s[l-t],p+=l<=i-1?d[l]:d[l]-d[l-i],g+=l<=i-1?s[l]:s[l]-s[l-i],r.push(l<f?null:(c/u*4+h/m*2+p/g)/7*100);return r},ao:function(e,t,i,a){this.pcheck("ao",arguments);for(var n,o,r=[],s=[],l=0,d=i.length,l=0;l<d;l+=1)s[l]=(i[l]+a[l])/2;for(n=this.sma(e,s),o=this.sma(t,s),l=0;l<d;l+=1)r[l]=l<t-1?null:n[l]-o[l];return r},ac:function(e,t,i,a){this.pcheck("ac",arguments);for(var n=[],o=0,r=i.length,s=this.ao(e,t,i,a),l=this.sma(e,s),o=0;o<r;o+=1)n[o]=o<t-1?null:s[o]-l[o];return n},zz:function(e,t){this.pcheck("zz",arguments);var i=[],a=0,n=[],o=0,r=t[0].length;n.i=0;if((n.trend=1)===t.length){var s=t[0];for(i[0]=s[n.i],a=1;a<r;a+=1)(o=s[a]-s[n.i]<0?-1:1)===n.trend?(i[a]=s[a],i[n.i]=null,n.i=a):Math.abs((s[a]-s[n.i])/s[n.i])>e/100?(i[a]=s[a],n.i=a,n.trend=o):i[a]=null}else if(4===t.length){var l=t[0],d=t[1],c=t[2],s=t[3],h=[];for(i[0]=s[n.i],a=1;a<r;a+=1)o=s[a]-s[n.i]<0?-1:1,h=s[a]>l[a]?d:c,o===n.trend?(i[a]=h[a],i[n.i]=null,n.i=a):Math.abs((s[a]-s[n.i])/s[n.i])>e/100?(i[a]=h[a],n.i=a,n.trend=o):i[a]=null}return i[r-1]=s[r-1],i},kc:function(e,t,i,a,n,o){this.pcheck("kc",arguments);for(var r,s=[],l=[],d=[],c=0,h=this.sma(e,o),p=this.atr(t,a,n,o),c=0;c<e-1;c+=1)l.push(null),d.push(null);for(c=e-1,r=h.length;c<r;c+=1)l.push(h[c]+i*p[c]),d.push(h[c]-i*p[c]);return s.KCM=h,s.KCU=l,s.KCL=d,s},sr:function(e,t,i,a,n){this.pcheck("sr",arguments);for(var o,r,s=[],l=[],d=[],c=0,h=(100-e)/300,e=(100-e)/100,p=i.length,u=this.zz(h,[i]),m=this.zz(h,[a]),g=this.zz(e,[i]),f=this.zz(e,[a]),c=1;c<p;c+=1)o=this.fractal(i,"upper",c),r=this.fractal(a,"lower",c),0<o&&(o==u[c]||o==g[c])?(d[c]=o,d[c+1]=o,d[c+2]=o):d[c]=d[c-1],0<r&&(r==m[c]||r==f[c])?(l[c]=r,l[c+1]=r,l[c+2]=r):l[c]=l[c-1];return s.R=d,s.S=l,s},mom:function(e,t){this.pcheck("mom",arguments);for(var i=[],a=0,n=t.length,a=0;a<e;a+=1)i[a]=null;for(a=e;a<n;a+=1)i[a]=t[a]-t[a-e];return i},po:function(e,t,i){this.pcheck("po",arguments);for(var a=[],n=0,o=i.length,r=this.sma(e,i),s=this.sma(t,i),n=0;n<t;n+=1)a[n]=null;for(n=t;n<o;n+=1)a[n]=r[n]-s[n];return a},roundX:function(e,t){return Math.round(e*(Math.pow(10,t)+(0<e?1e-10:-1e-10)))/Math.pow(10,t)},fractal:function(e,t,a){var n=[];switch(t){case"upper":for(i=0;i<5;i+=1)n[i]=e[a+i-2];return n[2]>n[0]&&n[2]>n[1]&&n[2]>n[3]&&n[2]>n[4]?n[2]:0;case"lower":for(i=0;i<5;i+=1)n[i]=e[a+i-2];return n[2]<n[0]&&n[2]<n[1]&&n[2]<n[3]&&n[2]<n[4]?n[2]:0;default:throw"Invalid fractal mode"}},pcheck:function(e,t){var i=0,a=0;switch(e){case"sma":case"ema":case"wma":case"rsi":case"stddev":case"trix":case"proc":case"bb":case"wws":case"mom":if(2!==t.length)throw e+": must have 2 params";if(t[0]>t[1].length)throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"maenv":if(3!==t.length)throw e+": must have 3 params";if(t[0]>t[1].length)throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"typprice":case"truerange":if(3!==t.length)throw e+": must have 3 params";if(t[0].length!==t[1].length||t[1].length!==t[2].length)throw e+": High, Low and Close data must be the same length";break;case"aroon":if(3!==t.length)throw e+": must have 3 params";if(t[1].length!==t[2].length)throw e+": High and Low data must be the same length";if(t[0]>t[1].length)throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"cci":case"williams":case"atr":if(4!==t.length)throw e+": must have 4 params";if((i=Math.max(t[1].length,t[2].length,t[3].length))!==(a=Math.min(t[1].length,t[2].length,t[3].length)))throw e+": High, Low and Close data must be the same length";if(t[0]>t[1].length)throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"psar":if(4!==t.length)throw e+": must have 4 params";if((i=Math.max(t[2].length,t[3].length))!==(a=Math.min(t[2].length,t[3].length)))throw e+": High and Low data must be the same length";if(t[0]>=t[1])throw e+": minaf must be less than maxaf";break;case"macd":if(4!==t.length)throw e+": must have 4 params";if(i=Math.max(t[1],t[2],t[3]),t[0]>i)throw e+": not enough data supplied for "+i+" period calculation";if(t[1]>t[2])throw e+": Long periods param must be greater than short periods param";break;case"swingindex":case"asi":if(5!==t.length)throw e+": must have 5 params";if((i=Math.max(t[1].length,t[2].length,t[3].length,t[4].length))!==(a=Math.min(t[1].length,t[2].length,t[3].length,t[4].length)))throw e+": Open, High, Low, and Close data must be the same length";break;case"stochosc":if(6!==t.length)throw e+": must have 6 params";if((i=Math.max(t[3].length,t[4].length,t[5].length))!==(a=Math.min(t[3].length,t[4].length,t[5].length)))throw e+": High, Low, and Close data must be the same length";if(t[0]+t[1]+t[2]>i)throw e+": not enough data supplied for "+t[0]+" period with a "+t[1]+" k smoothing and a"+t[2]+" d smoothing calculation";break;case"kc":case"uo":if(6!==t.length)throw e+": must have 6 params";if((i=Math.max(t[3].length,t[4].length,t[5].length))!==(a=Math.min(t[3].length,t[4].length,t[5].length)))throw e+": High, Low, and Close data must be the same length";if(a<(i=Math.max(t[0],t[1],t[2])))throw e+": not enough data supplied for "+t[0]+" period calculation";break;case"pvo":if(4!==t.length)throw e+": must have 4 params";if(t[0]<=t[1])throw e+": Short periods must be less that Long periods";if(t[0]>t[2].length)throw e+": not enough data supplied for "+t[1]+" period calculation";if("e"!==t[3]&&"s"!==t[3])throw e+": 4th parameter must be either 'e' (Exponential) or 's' (Simple)";break;case"ao":case"ac":if(4!==t.length)throw e+": must have 4 params";if(i=Math.max(t[2],t[3]),t[0].length<i)throw e+": not enough data supplied for "+i+" period calculation";if(t[0].length!==t[1].length)throw e+": High and Low data must be the same length";if(t[0]>t[1])throw e+": Long periods param must be greater than short periods param";break;case"zz":if(2!==t.length)throw e+": must have 2 params";if(3===t[1].length){if((i=Math.max(t[1][0].length,t[1][1].length,t[1][2].length,t[1][3].length))!==(a=Math.min(t[1][0].length,t[1][1].length,t[1][2].length,t[1][3].length)))throw e+": Open, High, Low and Close data must be the same length"}else if(4<t[1].length)throw e+": Data cannot have more than 4 elements";break;case"sr":if(5!==t.length)throw e+": must have 5 params";if((i=Math.max(t[1].length,t[2].length,t[3].length,t[4].length))!==(a=Math.min(t[1].length,t[2].length,t[3].length,t[4].length)))throw e+": High, Low, Close and Volume data must be the same length";break;case"po":if(3!==t.length)throw e+": must have 3 params";if(i=Math.max(t[0],t[1]),t[2].length<i)throw e+": not enough data supplied for "+i+" period calculation";if(t[0]>t[1])throw e+": Long periods param must be greater than short periods param";break;default:throw"Indicator param check not implemented"}},XHighPlusLowDivY:function(e,t,i,a){var n,o=e.length;for(results=[],n=o-1;i-1<n;--n){for(var r,s,l=0,d=1/0,c=n;n-i<c;--c)l<(r=e[c]||0)&&(l=r),(s=t[c]||0)<d&&0<s&&(d=s);results[n]=(l+d)/a}for(c=0;c<i;c+=1)results[c]=null;return results}},IndicatorCalculator=(FS.getDefaultIndicatorParameters=function(e){var t;switch(e){case"sma":t=[{Name:"Periods",Value:20,Type:"number",OrderIndex:0}];break;case"ema":t=[{Name:"Periods",Value:10,Type:"number",OrderIndex:0}];break;case"wma":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"rsi":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0},{Name:"Overbought Level",Options:[{Name:"70/30",Value:70,Selected:!0},{Name:"80/20",Value:80}],Type:"list",OrderIndex:1}];break;case"typprice":case"truerange":t=null;break;case"cci":case"williams":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"macd":t=[{Name:"Short Cycle",Value:12,Type:"number",OrderIndex:0},{Name:"Long Cycle",Value:26,Type:"number",OrderIndex:1},{Name:"Signal Periods",Value:9,Type:"number",OrderIndex:2}];break;case"stddev":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"bb":t=[{Name:"Periods",Value:20,Type:"number",OrderIndex:0}];break;case"maenv":t=[{Name:"Periods",Value:20,Type:"number",OrderIndex:0},{Name:"Shift (%)",Value:2.5,Type:"number",Step:.1,OrderIndex:1}];break;case"trix":t=[{Name:"Periods",Value:8,Type:"number",OrderIndex:0}];break;case"proc":t=[{Name:"Periods",Value:12,Type:"number",OrderIndex:0}];break;case"wws":case"si":case"asi":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"uo":t=[{Name:"Cycle 1",Value:7,Type:"number",OrderIndex:0},{Name:"Cycle 2",Value:14,Type:"number",OrderIndex:1},{Name:"Cycle 3",Value:28,Type:"number",OrderIndex:2}];break;case"stochosc":t=[{Name:"%K Periods",Value:14,Type:"number",OrderIndex:0},{Name:"%K Slowing",Value:3,Type:"number",OrderIndex:1},{Name:"%D Periods",Value:3,Type:"number",OrderIndex:2}];break;case"aroon":case"aroonosc":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;case"psar":t=[{Name:"Min AF (Accumulation Factor)",Value:.02,Type:"number",Min:0,Step:.01,OrderIndex:0},{Name:"Max AF (Accumulation Factor)",Value:.2,Type:"number",Min:0,Step:.01,OrderIndex:1}];break;case"const":t=[{Name:"Value",Value:0,Type:"number",Min:0,OrderIndex:0}];break;case"bp":t=null;break;case"ao":case"ac":t=[{Name:"Short Cycle",Value:5,Type:"number",OrderIndex:0},{Name:"Long Cycle",Value:34,Type:"number",OrderIndex:1}];break;case"zz":t=[{Name:"Threshold",Value:5,Type:"number",Min:0,Step:.1,OrderIndex:0}];break;case"kc":t=[{Name:"EMA Periods",Value:20,Type:"number",OrderIndex:0},{Name:"ATR Periods",Value:10,Type:"number",OrderIndex:1},{Name:"ATR Multiplier",Value:2,Type:"number",OrderIndex:2}];break;case"sr":t=[{Name:"Sensitivity",Value:60,Type:"number",OrderIndex:0}];break;case"mom":t=[{Name:"Periods",Value:10,Type:"number",OrderIndex:0}];break;case"po":t=[{Name:"Short Cycle",Value:9,Type:"number",OrderIndex:0},{Name:"Long Cycle",Value:18,Type:"number",OrderIndex:1}];break;case"vol":t=[];break;case"atr":t=[{Name:"Periods",Value:14,Type:"number",OrderIndex:0}];break;default:console.log("indicator not implemented")}return t},FS.getIndicatorCode=function(e){var t;try{switch(e){case 37:t="sma";break;case 44:t="truerange";break;case 13:t="ema";break;case 52:t="wma";break;case 36:t="rsi";break;case 45:t="typprice";break;case 274:t="truerange";break;case 8:t="cci";break;case 55:t="williams";break;case 254:break;case 19:case 136:case 276:t="macd";break;case 38:t="stddev";break;case 4:case 128:case 252:t="bb";break;case 24:case 133:t="maenv";break;case 43:t="trix";break;case 31:t="proc";break;case 54:t="wws";break;case 41:t="si";break;case 1:t="asi";break;case 46:t="uo";break;case 40:case 135:t="stochosc";break;case 3:case 249:case 250:t="aroon";break;case 251:t="aroonosc";break;case 27:t="psar";break;case 137:t="const";break;case 277:case 278:case 279:case 280:case 281:t="bp";break;case 282:t="ten";break;case 283:t="kij";break;case 284:t="sa";break;case 285:t="sb";break;case 286:t="chi";break;case 1302:t="ao";break;case 1303:t="ac";break;case 1304:t="zz";break;case 1311:case 1312:case 1313:case 1314:t="kc";break;case 1315:case 1316:case 1317:t="sr";break;case 1318:t="mom";break;case 1319:t="po";break;case 1323:case 1324:t="atr";break;default:console.log("indicator not implemented")}}catch(e){console.log(e)}return t},FS.calculateDefaultIndicator=function(e,t,i,a,n,o,r,s){var l,d=this.getDefaultIndicatorParameters(e);return d&&s&&s.length===d.length&&_.each(d,function(e){l=s.splice(0,1)[0],e.Value=l}),this.calculateIndicator(e,t,d,i,a,n,o,r)},FS.calculateDefaultIndicatorDiscrete=function(e,t){var i=this.getDefaultIndicatorParameters(this.getIndicatorCode(e));return this.calculateIndicatorDiscrete(e,t,i,"",null,null)},FS.calculateIndicator=function(t,e,i,a,n,o,r,s){var l,d=null;try{switch(t){case"sma":d={indicatorID:37,code:"sma",name:"Simple Moving Average",shortName:"SMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:37,discreteName:"Simple Moving Average",shortName:"SMA",data:c=TechInd.sma(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"ema":d={indicatorID:13,code:"ema",name:"Exponential Moving Average",shortName:"EMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:13,discreteName:"Exponential Moving Average",shortName:"EMA",data:c=TechInd.ema(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"wma":d={indicatorID:52,code:"wma",name:"Weighted Moving Average",shortName:"WMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:52,discreteName:"Weighted Moving Average",shortName:"WMA",data:c=TechInd.wma(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"rsi":var c,h=_.find(i[1].Options,function(e){return!0===e.Selected}).Value||70,d={indicatorID:36,code:"rsi",name:"Relative Strength Index",shortName:"RSI",parameters:i,display:"own-window",markers:[100-h,50,h],discreteIndicators:[{discreteIndicatorID:36,discreteName:"Relative Strength Index",shortName:"RSI",data:c=TechInd.rsi(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"typprice":d={indicatorID:45,code:"typprice",name:"Typical Price",shortName:"TP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:45,discreteName:"Typical Price",shortName:"TP",data:c=TechInd.typprice(_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"truerange":d={indicatorID:44,code:"truerange",name:"True Range",shortName:"TR",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:274,discreteName:"True Range",shortName:"TR",data:c=TechInd.truerange(_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"atr":d={indicatorID:1323,code:"atr",name:"Average True Range",shortName:"ATR",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1324,discreteName:"Average True Range",shortName:"ATR",data:c=TechInd.atr(i[0].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"cci":d={indicatorID:8,code:"cci",name:"Commodity Channel Index",shortName:"CCI",parameters:i,display:"own-window",markers:[-100,0,100],discreteIndicators:[{discreteIndicatorID:8,discreteName:"Commodity Channel Index",shortName:"CCI",data:c=TechInd.cci(i[0].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"williams":d={indicatorID:55,code:"williams",name:"Williams %R",shortName:"W%R",parameters:i,display:"own-window",markers:[-20,-50,-80],discreteIndicators:[{discreteIndicatorID:55,discreteName:"Williams %R",shortName:"W%R",data:c=TechInd.williams(i[0].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"macd":d={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:276,discreteName:"MACD Histogram",shortName:"MACD H",data:(c=TechInd.macd(_.map(e,function(e){return e.get("close")}),i[0].Value,i[1].Value,i[2].Value)).HISTOGRAM,displayType:"Histogram",color:"absolute",lineThickness:1,nonConfigurable:!0},{discreteIndicatorID:19,discreteName:"MACD",shortName:"MACD",data:c.MACD,displayType:"Line",color:"#FAF23E",lineThickness:1},{discreteIndicatorID:136,discreteName:"MACD Signal",shortName:"MACD S",data:c.SIGNAL,displayType:"Line",color:"#3EE2FA",lineThickness:1}]};break;case"stddev":d={indicatorID:38,code:"stddev",name:"Standard Deviation",shortName:"SD",parameters:i,display:"own-window",markers:null,discreteIndicators:[{discreteIndicatorID:38,discreteName:"Standard Deviation",shortName:"SD",data:c=TechInd.stddev(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"bb":d={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:4,discreteName:"BB Upper Band",shortName:"Upper Band",data:(c=TechInd.bb(i[0].Value,_.map(e,function(e){return e.get("close")}))).BBU,displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:252,discreteName:"BB Median",shortName:"Median",data:c.BBM,displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:128,discreteName:"BB Lower Band",shortName:"Lower Band",data:c.BBL,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"maenv":d={indicatorID:24,code:"maenv",name:"Moving Average Envelope",shortName:"ENV",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:24,discreteName:"ENV Top",shortName:"Top",data:(c=TechInd.maenv(i[0].Value,_.map(e,function(e){return e.get("close")}),i[1].Value)).TOP,displayType:"Line",color:"#CA53F4",lineThickness:1},{discreteIndicatorID:133,discreteName:"ENV Bottom",shortName:"Bottom",data:c.BOTTOM,displayType:"Line",color:"#CA53F4",lineThickness:1}]};break;case"trix":d={indicatorID:43,code:"trix",name:"TRIX",shortName:"TRIX",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:43,discreteName:"TRIX",shortName:"TRIX",data:c=TechInd.trix(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"proc":d={indicatorID:31,code:"proc",name:"Price ROC",shortName:"PROC",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:31,discreteName:"Price ROC",shortName:"PROC",data:c=TechInd.proc(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"wws":d={indicatorID:54,code:"wws",name:"Welles Wilder Smoothing",shortName:"WWS",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:54,discreteName:"Welles Wilder Smoothing",shortName:"WWS",data:c=TechInd.wws(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"si":d={indicatorID:41,code:"si",name:"Swing Index",shortName:"SI",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:41,discreteName:"Swing Index",shortName:"SI",data:c=TechInd.swingindex(i[0].Value,_.map(e,function(e){return e.get("open")}),_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"asi":d={indicatorID:1,code:"asi",name:"Accumulative Swing Index",shortName:"ASI",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1,discreteName:"Accumulative Swing Index",shortName:"ASI",data:c=TechInd.asi(i[0].Value,_.map(e,function(e){return e.get("open")}),_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#48DC4A",lineThickness:1}]};break;case"uo":d={indicatorID:46,code:"uo",name:"Ultimate Oscillator",shortName:"UO",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:46,discreteName:"Ultimate Oscillator",shortName:"UO",data:c=TechInd.uo(i[0].Value,i[1].Value,i[2].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"stochosc":d={indicatorID:40,code:"stochosc",name:"Stochastic Oscillator",shortName:"SO",parameters:i,display:"own-window",markers:[20,50,80],discreteIndicators:[{discreteIndicatorID:40,discreteName:"Stochastic Oscillator %K",shortName:"%K",data:(c=TechInd.stochosc(i[0].Value,i[1].Value,i[2].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")}))).K,displayType:"Line",color:"#E3EA5E",lineThickness:1},{discreteIndicatorID:135,discreteName:"Stochastic Oscillator %D",shortName:"%D",data:c.D,displayType:"Line",color:"#F4D548",lineThickness:1}]};break;case"aroon":d={indicatorID:3,code:"aroon",name:"Aroon",shortName:"AR",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:249,discreteName:"Aroon Up",shortName:"Up",data:(c=TechInd.aroon(i[0].Value,_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("high")}))).UP,displayType:"Line",color:"#77b34b",lineThickness:1},{discreteIndicatorID:250,discreteName:"Aroon Down",shortName:"Down",data:c.DOWN,displayType:"Line",color:"#b84d6a",lineThickness:1}]};break;case"aroonosc":d={indicatorID:251,code:"aroonosc",name:"Aroon Oscillator",shortName:"OSC",parameters:i,display:"own-window",markers:[0],discreteIndicators:[{discreteIndicatorID:251,discreteName:"Aroon Oscillator",shortName:"OSC",data:(c=TechInd.aroon(i[0].Value,_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("high")}))).OSC,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"psar":d={indicatorID:27,code:"psar",name:"Parabolic SAR",shortName:"PSAR",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:27,discreteName:"Parabolic SAR",shortName:"PSAR",data:c=TechInd.psar(i[0].Value,i[1].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")})),displayType:"Dots",lineThickness:1}]};break;case"const":d={indicatorID:128,code:"const",name:"Constant Value",shortName:"Cons. V.",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:137,discreteName:"Constant Value",shortName:"Cons. V.",data:c=this.calculateConstantValue(i[0].Value,e.length),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"bp":d={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:277,discreteName:"Open Bar Price",shortName:"OBP",data:(c=this.calculateBarPrice(e)).OPEN,displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:278,discreteName:"High Bar Price",shortName:"HBP",data:c.HIGH,displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:279,discreteName:"Low Bar Price",shortName:"LBP",data:c.LOW,displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:280,discreteName:"Close Bar Price",shortName:"CBP",data:c.CLOSE,displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:281,discreteName:"Live Price",shortName:"LP",data:c.LIVE,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"ao":d={indicatorID:1302,code:"ao",name:"Awesome Oscillator",shortName:"AO",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1302,discreteName:"Awesome Oscillator Histogram",shortName:"AO H",data:c=TechInd.ao(i[0].Value,i[1].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")})),displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case"ac":d={indicatorID:1303,code:"ac",name:"Accelerator Oscillator",shortName:"AC",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1303,discreteName:"Accelerator Oscillator Histogram",shortName:"AC H",data:c=TechInd.ac(i[0].Value,i[1].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")})),displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case"zz":switch(a){case"CandleStick":case"Bar":case"Kagi":case"HeikinAshi":l=[_.map(e,function(e){return e.get("open")}),_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")})];break;case"Line":default:l=[_.map(e,function(e){return e.get("close")})]}d={indicatorID:1304,code:"zz",name:"ZigZag",shortName:"ZZ",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1304,discreteName:"ZigZag Line",shortName:"ZZL",data:c=TechInd.zz(i[0].Value,l),displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"kc":d={indicatorID:1311,code:"kc",name:"Keltner Channels",shortName:"KC",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1312,discreteName:"KC Upper Channel Line",shortName:"Upper Channel Line",data:(c=TechInd.kc(i[0].Value,i[1].Value,i[2].Value,_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}),_.map(e,function(e){return e.get("close")}))).KCU,displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:1313,discreteName:"KC Middle Line",shortName:"Middle Line",data:c.KCM,displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:1314,discreteName:"KC Lower Channel Line",shortName:"Lower Channel Line",data:c.KCL,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"sr":d={indicatorID:1315,code:"sr",name:"Support/Resistance",shortName:"S/R",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1316,discreteName:"Support",shortName:"Support",data:(c=TechInd.sr(i[0].Value,_.map(e,function(e){return e.get("close")}),_.map(e,function(e){return e.get("open")}),_.map(e,function(e){return e.get("high")}),_.map(e,function(e){return e.get("low")}))).S,displayType:"PivotLine",color:"#77b34b",displayPrices:!0,lineThickness:2},{discreteIndicatorID:1317,discreteName:"Resistance",shortName:"Resistance",data:c.R,displayType:"PivotLine",color:"#b84d6a",displayPrices:!0,lineThickness:2}]};break;case"mom":d={indicatorID:1318,code:"mom",name:"Momentum",shortName:"MOM",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1318,discreteName:"Momentum",shortName:"Momentum",data:c=TechInd.mom(i[0].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"po":d={indicatorID:1319,code:"po",name:"Price Oscillator",shortName:"PO",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Price Oscillator",shortName:"Price Oscillator",data:c=TechInd.po(i[0].Value,i[1].Value,_.map(e,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"vol":d={indicatorID:1329,code:"vol",name:"VOLUME",shortName:"VOL",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!1,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Volume",shortName:"Volume",data:c=_.map(_.sortBy(e,"Date"),function(e){return isNaN(e.get("volume"))?e.get("volume"):parseInt(e.get("volume"),10)}),displayType:"Histogram",color:"#3DA8FF",lineThickness:1}]};break;default:console.log("indicator not implemented")}}catch(e){console.log(e),d=this.getPendingIndicator(t,i)}return r&&r.call(s,d),d},FS.calculateIndicatorDiscrete=function(e,t,i,a,n,o){void 0===a&&(a=""),void 0===o&&(o=null);var r=null;try{switch(e){case 37:r={indicatorID:37,code:"sma",name:"Simple Moving Average",shortName:"SMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:37,discreteName:"Simple Moving Average",shortName:"SMA",data:s=TechInd.sma(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 13:r={indicatorID:13,code:"ema",name:"Exponential Moving Average",shortName:"EMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:13,discreteName:"Exponential Moving Average",shortName:"EMA",data:s=TechInd.ema(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 52:r={indicatorID:52,code:"wma",name:"Weighted Moving Average",shortName:"WMA",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:52,discreteName:"Weighted Moving Average",shortName:"WMA",data:s=TechInd.wma(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 36:var s,l=_.find(i[1].Options,function(e){return!0===e.Selected}).Value||70,r={indicatorID:36,code:"rsi",name:"Relative Strength Index",shortName:"RSI",parameters:i,display:"own-window",markers:[100-l,50,l],discreteIndicators:[{discreteIndicatorID:36,discreteName:"Relative Strength Index",shortName:"RSI",data:s=TechInd.rsi(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 45:r={indicatorID:45,code:"typprice",name:"Typical Price",shortName:"TP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:45,discreteName:"Typical Price",shortName:"TP",data:s=TechInd.typprice(_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 274:r={indicatorID:44,code:"truerange",name:"True Range",shortName:"TR",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:274,discreteName:"True Range",shortName:"TR",data:s=TechInd.truerange(_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 1324:r={indicatorID:1323,code:"atr",name:"Average True Range",shortName:"ATR",parameters:i,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1324,discreteName:"Average True Range",shortName:"ATR",data:s=TechInd.atr(i[0].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 8:r={indicatorID:8,code:"cci",name:"Commodity Channel Index",shortName:"CCI",parameters:i,display:"own-window",markers:[-100,0,100],discreteIndicators:[{discreteIndicatorID:8,discreteName:"Commodity Channel Index",shortName:"CCI",data:s=TechInd.cci(i[0].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 55:r={indicatorID:55,code:"williams",name:"Williams %R",shortName:"W%R",parameters:i,display:"own-window",markers:[-20,-50,-80],discreteIndicators:[{discreteIndicatorID:55,discreteName:"Williams %R",shortName:"W%R",data:s=TechInd.williams(i[0].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 19:r={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:19,discreteName:"MACD",shortName:"MACD",data:(s=TechInd.macd(_.map(t,function(e){return e.get("close")}),i[0].Value,i[1].Value,i[2].Value)).MACD,displayType:"Line",color:"#FAF23E",lineThickness:1}]};break;case 136:r={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:136,discreteName:"MACD Signal",shortName:"MACD S",data:(s=TechInd.macd(_.map(t,function(e){return e.get("close")}),i[0].Value,i[1].Value,i[2].Value)).SIGNAL,displayType:"Line",color:"#3EE2FA",lineThickness:1}]};break;case 276:r={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:276,discreteName:"MACD Histogram",shortName:"MACD H",data:(s=TechInd.macd(_.map(t,function(e){return e.get("close")}),i[0].Value,i[1].Value,i[2].Value)).HISTOGRAM,displayType:"Histogram",color:"absolute",lineThickness:1,nonConfigurable:!0}]};break;case 38:r={indicatorID:38,code:"stddev",name:"Standard Deviation",shortName:"SD",parameters:i,display:"own-window",markers:null,discreteIndicators:[{discreteIndicatorID:38,discreteName:"Standard Deviation",shortName:"SD",data:s=TechInd.stddev(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 4:r={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:4,discreteName:"BB Upper Band",shortName:"Upper Band",data:(s=TechInd.bb(i[0].Value,_.map(t,function(e){return e.get("close")}))).BBU,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case 128:r={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:128,discreteName:"BB Lower Band",shortName:"Lower Band",data:(s=TechInd.bb(i[0].Value,_.map(t,function(e){return e.get("close")}))).BBL,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case 252:r={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:252,discreteName:"BB Median",shortName:"Median",data:(s=TechInd.bb(i[0].Value,_.map(t,function(e){return e.get("close")}))).BBM,displayType:"Line",color:"#C3E2F4",lineThickness:2}]};break;case 24:r={indicatorID:24,code:"maenv",name:"Moving Average Envelope",shortName:"ENV",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:24,discreteName:"ENV Top",shortName:"Top",data:(s=TechInd.maenv(i[0].Value,_.map(t,function(e){return e.get("close")}),i[1].Value)).TOP,displayType:"Line",color:"#CA53F4",lineThickness:1}]};break;case 133:r={indicatorID:24,code:"maenv",name:"Moving Average Envelope",shortName:"ENV",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:133,discreteName:"ENV Bottom",shortName:"Bottom",data:(s=TechInd.maenv(i[0].Value,_.map(t,function(e){return e.get("close")}),i[1].Value)).BOTTOM,displayType:"Line",color:"#CA53F4",lineThickness:1}]};break;case 43:r={indicatorID:43,code:"trix",name:"TRIX",shortName:"TRIX",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:43,discreteName:"TRIX",shortName:"TRIX",data:s=TechInd.trix(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 31:r={indicatorID:31,code:"proc",name:"Price ROC",shortName:"PROC",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:31,discreteName:"Price ROC",shortName:"PROC",data:s=TechInd.proc(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 54:r={indicatorID:54,code:"wws",name:"Welles Wilder Smoothing",shortName:"WWS",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:54,discreteName:"Welles Wilder Smoothing",shortName:"WWS",data:s=TechInd.wws(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 41:r={indicatorID:41,code:"si",name:"Swing Index",shortName:"SI",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:41,discreteName:"Swing Index",shortName:"SI",data:s=TechInd.swingindex(i[0].Value,_.map(t,function(e){return e.get("open")}),_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 1:r={indicatorID:1,code:"asi",name:"Accumulative Swing Index",shortName:"ASI",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1,discreteName:"Accumulative Swing Index",shortName:"ASI",data:s=TechInd.asi(i[0].Value,_.map(t,function(e){return e.get("open")}),_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#48DC4A",lineThickness:1}]};break;case 46:r={indicatorID:46,code:"uo",name:"Ultimate Oscillator",shortName:"UO",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:46,discreteName:"Ultimate Oscillator",shortName:"UO",data:s=TechInd.uo(i[0].Value,i[1].Value,i[2].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 40:r={indicatorID:40,code:"stochosc",name:"Stochastic Oscillator",shortName:"SO",parameters:i,display:"own-window",markers:[20,50,80],discreteIndicators:[{discreteIndicatorID:40,discreteName:"Stochastic Oscillator %K",shortName:"%K",data:(s=TechInd.stochosc(i[0].Value,i[1].Value,i[2].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")}))).K,displayType:"Line",color:"#E3EA5E",lineThickness:1}]};break;case 135:r={indicatorID:40,code:"stochosc",name:"Stochastic Oscillator",shortName:"SO",parameters:i,display:"own-window",markers:[20,50,80],discreteIndicators:[{discreteIndicatorID:135,discreteName:"Stochastic Oscillator %D",shortName:"%D",data:(s=TechInd.stochosc(i[0].Value,i[1].Value,i[2].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")}))).D,displayType:"Line",color:"#F4D548",lineThickness:1}]};break;case 249:r={indicatorID:3,code:"aroon",name:"Aroon",shortName:"AR",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:249,discreteName:"Aroon Up",shortName:"Up",data:(s=TechInd.aroon(i[0].Value,_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("high")}))).UP,displayType:"Line",color:"#77b34b",lineThickness:1}]};break;case 250:r={indicatorID:3,code:"aroon",name:"Aroon",shortName:"AR",parameters:i,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:250,discreteName:"Aroon Down",shortName:"Down",data:(s=TechInd.aroon(i[0].Value,_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("high")}))).DOWN,displayType:"Line",color:"#b84d6a",lineThickness:1}]};break;case 251:r={indicatorID:251,code:"aroonosc",name:"Aroon Oscillator",shortName:"OSC",parameters:i,display:"own-window",markers:[0],discreteIndicators:[{discreteIndicatorID:251,discreteName:"Aroon Oscillator",shortName:"OSC",data:(s=TechInd.aroon(i[0].Value,_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("high")}))).OSC,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 27:r={indicatorID:27,code:"psar",name:"Parabolic SAR",shortName:"PSAR",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:27,discreteName:"Parabolic SAR",shortName:"PSAR",data:s=TechInd.psar(i[0].Value,i[1].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")})),displayType:"Dots",lineThickness:1}]};break;case 137:r={indicatorID:128,code:"const",name:"Constant Value",shortName:"Cons. V.",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:137,discreteName:"Constant Value",shortName:"Cons. V.",data:s=this.calculateConstantValue(i[0].Value,t.length),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 277:r={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:277,discreteName:"Open Bar Price",shortName:"OBP",data:(s=this.calculateBarPrice(t)).OPEN,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 278:r={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:278,discreteName:"High Bar Price",shortName:"HBP",data:(s=this.calculateBarPrice(t)).HIGH,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 279:r={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:279,discreteName:"Low Bar Price",shortName:"LBP",data:(s=this.calculateBarPrice(t)).LOW,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 280:r={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:280,discreteName:"Close Bar Price",shortName:"CBP",data:(s=this.calculateBarPrice(t)).CLOSE,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 281:r={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:281,discreteName:"Live Price",shortName:"LP",data:(s=this.calculateBarPrice(t)).LIVE,displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 1302:r={indicatorID:1302,code:"ao",name:"Awesome Oscillator",shortName:"AO",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1302,discreteName:"Awesome Oscillator Histogram",shortName:"AO H",data:s=TechInd.ao(i[0].Value,i[1].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")})),displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case 1303:r={indicatorID:1303,code:"ac",name:"Accelerator Oscillator",shortName:"AC",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1303,discreteName:"Accelerator Oscillator Histogram",shortName:"AC H",data:s=TechInd.ac(i[0].Value,i[1].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")})),displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case 1304:var d=void 0;switch(a){case"CandleStick":case"Bar":case"Kagi":case"HeikinAshi":d=[_.map(t,function(e){return e.get("open")}),_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")})];break;case"Line-High":d=[_.map(t,function(e){return e.get("high")})];break;case"Line-Low":d=[_.map(t,function(e){return e.get("low")})];break;case"Line-Close":case"Line":default:d=[_.map(t,function(e){return e.get("close")})]}r={indicatorID:1304,code:"zz",name:"ZigZag",shortName:"ZZ",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1304,discreteName:"ZigZag Line",shortName:"ZZL",data:s=TechInd.zz(i[0].Value,d),displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case 1311:r={indicatorID:1311,code:"kc",name:"Keltner Channels",shortName:"KC",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1312,discreteName:"KC Upper Channel Line",shortName:"Upper Channel Line",data:(s=TechInd.kc(i[0].Value,i[1].Value,i[2].Value,_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}),_.map(t,function(e){return e.get("close")}))).KCU,displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:1313,discreteName:"KC Middle Line",shortName:"Middle Line",data:s.KCM,displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:1314,discreteName:"KC Lower Channel Line",shortName:"Lower Channel Line",data:s.KCL,displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case 1315:r={indicatorID:1315,code:"sr",name:"Support/Resistance",shortName:"S/R",parameters:i,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1316,discreteName:"Support",shortName:"Support",data:(s=TechInd.sr(_.map(t,function(e){return e.get("high")}),_.map(t,function(e){return e.get("low")}))).S,displayType:"PivotLine",color:"#77b34b",displayPrices:!0,lineThickness:2},{discreteIndicatorID:1317,discreteName:"Resistance",shortName:"Resistance",data:s.R,displayType:"PivotLine",color:"#b84d6a",displayPrices:!0,lineThickness:2}]};break;case 1318:r={indicatorID:1318,code:"mom",name:"Momentum",shortName:"MOM",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1318,discreteName:"Momentum",shortName:"Momentum",data:s=TechInd.mom(i[0].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case 1319:r={indicatorID:1319,code:"po",name:"Price Oscillator",shortName:"PO",parameters:i,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Price Oscillator",shortName:"Price Oscillator",data:s=TechInd.po(i[0].Value,i[1].Value,_.map(t,function(e){return e.get("close")})),displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;default:console.log("indicator not implemented")}}catch(e){console.log(e)}return n&&n.call(o,r),r},FS.calculateBarPrice=function(e){var t={OPEN:[],HIGH:[],LOW:[],CLOSE:[],LIVE:[]};return _.each(e,function(e){t.OPEN.push(e.get("open")),t.HIGH.push(e.get("high")),t.LOW.push(e.get("low")),t.CLOSE.push(e.get("close")),t.LIVE.push(e.get("close"))}),t},FS.calculateConstantValue=function(e,t){for(var i=[],a=0;a<t;a+=1)i.push(e);return i},FS.getPendingIndicator=function(e,t){try{switch(e){case"sma":a={indicatorID:37,code:"sma",name:"Simple Moving Average",shortName:"SMA",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:37,discreteName:"Simple Moving Average",shortName:"SMA",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"ema":a={indicatorID:13,code:"ema",name:"Exponential Moving Average",shortName:"EMA",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:13,discreteName:"Exponential Moving Average",shortName:"EMA",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"wma":a={indicatorID:52,code:"wma",name:"Weighted Moving Average",shortName:"WMA",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:52,discreteName:"Weighted Moving Average",shortName:"WMA",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"rsi":var i=_.find(t[1].Options,function(e){return!0===e.Selected}).Value||70,a={indicatorID:36,code:"rsi",name:"Relative Strength Index",shortName:"RSI",parameters:t,display:"own-window",markers:[100-i,50,i],discreteIndicators:[{discreteIndicatorID:36,discreteName:"Relative Strength Index",shortName:"RSI",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"typprice":a={indicatorID:45,code:"typprice",name:"Typical Price",shortName:"TP",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:45,discreteName:"Typical Price",shortName:"TP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"truerange":a={indicatorID:44,code:"truerange",name:"True Range",shortName:"TR",parameters:t,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:274,discreteName:"True Range",shortName:"TR",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"atr":a={indicatorID:1323,code:"atr",name:"Average True Range",shortName:"ATR",parameters:t,display:"own-window",markers:null,showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1324,discreteName:"Average True Range",shortName:"ATR",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"cci":a={indicatorID:8,code:"cci",name:"Commodity Channel Index",shortName:"CCI",parameters:t,display:"own-window",markers:[-100,0,100],discreteIndicators:[{discreteIndicatorID:8,discreteName:"Commodity Channel Index",shortName:"CCI",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"williams":a={indicatorID:55,code:"williams",name:"Williams %R",shortName:"W%R",parameters:t,display:"own-window",markers:[-20,-50,-80],discreteIndicators:[{discreteIndicatorID:55,discreteName:"Williams %R",shortName:"W%R",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"macd":a={indicatorID:19,code:"macd",name:"MACD",shortName:"MACD",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:276,discreteName:"MACD Histogram",shortName:"MACD H",data:[],displayType:"Histogram",color:"absolute",lineThickness:1,nonConfigurable:!0},{discreteIndicatorID:19,discreteName:"MACD",shortName:"MACD",data:[],displayType:"Line",color:"#FAF23E",lineThickness:1},{discreteIndicatorID:136,discreteName:"MACD Signal",shortName:"MACD S",data:[],displayType:"Line",color:"#3EE2FA",lineThickness:1}]};break;case"stddev":a={indicatorID:38,code:"stddev",name:"Standard Deviation",shortName:"SD",parameters:t,display:"own-window",markers:null,discreteIndicators:[{discreteIndicatorID:38,discreteName:"Standard Deviation",shortName:"SD",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"bb":a={indicatorID:4,code:"bb",name:"Bollinger Bands",shortName:"BB",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:4,discreteName:"BB Upper Band",shortName:"Upper Band",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:252,discreteName:"BB Median",shortName:"Median",data:[],displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:128,discreteName:"BB Lower Band",shortName:"Lower Band",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"maenv":a={indicatorID:24,code:"maenv",name:"Moving Average Envelope",shortName:"ENV",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:24,discreteName:"ENV Top",shortName:"Top",data:[],displayType:"Line",color:"#CA53F4",lineThickness:1},{discreteIndicatorID:133,discreteName:"ENV Bottom",shortName:"Bottom",data:[],displayType:"Line",color:"#CA53F4",lineThickness:1}]};break;case"trix":a={indicatorID:43,code:"trix",name:"TRIX",shortName:"TRIX",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:43,discreteName:"TRIX",shortName:"TRIX",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"proc":a={indicatorID:31,code:"proc",name:"Price ROC",shortName:"PROC",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:31,discreteName:"Price ROC",shortName:"PROC",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"wws":a={indicatorID:54,code:"wws",name:"Welles Wilder Smoothing",shortName:"WWS",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:54,discreteName:"Welles Wilder Smoothing",shortName:"WWS",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"si":a={indicatorID:41,code:"si",name:"Swing Index",shortName:"SI",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:41,discreteName:"Swing Index",shortName:"SI",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"asi":a={indicatorID:1,code:"asi",name:"Accumulative Swing Index",shortName:"ASI",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1,discreteName:"Accumulative Swing Index",shortName:"ASI",data:[],displayType:"Line",color:"#48DC4A",lineThickness:1}]};break;case"uo":a={indicatorID:46,code:"uo",name:"Ultimate Oscillator",shortName:"UO",parameters:t,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:46,discreteName:"Ultimate Oscillator",shortName:"UO",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"stochosc":a={indicatorID:40,code:"stochosc",name:"Stochastic Oscillator",shortName:"SO",parameters:t,display:"own-window",markers:[20,50,80],discreteIndicators:[{discreteIndicatorID:40,discreteName:"Stochastic Oscillator %K",shortName:"%K",data:[],displayType:"Line",color:"#E3EA5E",lineThickness:1},{discreteIndicatorID:135,discreteName:"Stochastic Oscillator %D",shortName:"%D",data:[],displayType:"Line",color:"#F4D548",lineThickness:1}]};break;case"aroon":a={indicatorID:3,code:"aroon",name:"Aroon",shortName:"AR",parameters:t,display:"own-window",markers:[30,50,70],discreteIndicators:[{discreteIndicatorID:249,discreteName:"Aroon Up",shortName:"Up",data:[],displayType:"Line",color:"#77b34b",lineThickness:1},{discreteIndicatorID:250,discreteName:"Aroon Down",shortName:"Down",data:[],displayType:"Line",color:"#b84d6a",lineThickness:1}]};break;case"aroonosc":a={indicatorID:251,code:"aroonosc",name:"Aroon Oscillator",shortName:"OSC",parameters:t,display:"own-window",markers:[0],discreteIndicators:[{discreteIndicatorID:251,discreteName:"Aroon Oscillator",shortName:"OSC",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"psar":a={indicatorID:27,code:"psar",name:"Parabolic SAR",shortName:"PSAR",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:27,discreteName:"Parabolic SAR",shortName:"PSAR",data:[],displayType:"Dots",lineThickness:1}]};break;case"const":a={indicatorID:128,code:"const",name:"Constant Value",shortName:"Cons. V.",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:137,discreteName:"Constant Value",shortName:"Cons. V.",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"bp":a={indicatorID:254,code:"bp",name:"Bar Price",shortName:"BP",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:277,discreteName:"Open Bar Price",shortName:"OBP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:278,discreteName:"High Bar Price",shortName:"HBP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:279,discreteName:"Low Bar Price",shortName:"LBP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:280,discreteName:"Close Bar Price",shortName:"CBP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1},{discreteIndicatorID:281,discreteName:"Live Price",shortName:"LP",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"ao":a={indicatorID:1302,code:"ao",name:"Awesome Oscillator",shortName:"AO",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1302,discreteName:"Awesome Oscillator Histogram",shortName:"AO H",data:[],displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case"ac":a={indicatorID:1303,code:"ac",name:"Accelerator Oscillator",shortName:"AC",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1303,discreteName:"Accelerator Oscillator Histogram",shortName:"AC H",data:[],displayType:"Histogram",color:"relative",lineThickness:1,nonConfigurable:!0}]};break;case"zz":a={indicatorID:1304,code:"zz",name:"ZigZag",shortName:"ZZ",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1304,discreteName:"ZigZag Line",shortName:"ZZL",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"kc":a={indicatorID:1311,code:"kc",name:"Keltner Channels",shortName:"KC",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1312,discreteName:"KC Upper Channel Line",shortName:"Upper Channel Line",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1},{discreteIndicatorID:1313,discreteName:"KC Middle Line",shortName:"Middle Line",data:[],displayType:"Line",color:"#C3E2F4",lineThickness:2},{discreteIndicatorID:1314,discreteName:"KC Lower Channel Line",shortName:"Lower Channel Line",data:[],displayType:"Line",color:"#61BDF0",lineThickness:1}]};break;case"sr":a={indicatorID:1315,code:"sr",name:"Support/Resistance",shortName:"S/R",parameters:t,display:"on-chart",markers:null,discreteIndicators:[{discreteIndicatorID:1316,discreteName:"Support",shortName:"Support",data:[],displayType:"PivotLine",color:"#77b34b",displayPrices:!0,lineThickness:2},{discreteIndicatorID:1317,discreteName:"Resistance",shortName:"Resistance",data:[],displayType:"PivotLine",color:"#b84d6a",displayPrices:!0,lineThickness:2}]};break;case"mom":a={indicatorID:1318,code:"mom",name:"Momentum",shortName:"MOM",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1318,discreteName:"Momentum",shortName:"Momentum",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"po":a={indicatorID:1319,code:"po",name:"Price Oscillator",shortName:"PO",parameters:t,display:"own-window",markers:[0],showDecimalPlaces:!0,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Price Oscillator",shortName:"Price Oscillator",data:[],displayType:"Line",color:"#3DA8FF",lineThickness:1}]};break;case"vol":a={indicatorID:1329,code:"vol",name:"Volume",shortName:"VOL",parameters:t,display:"own-window",markers:null,showDecimalPlaces:!1,discreteIndicators:[{discreteIndicatorID:1319,discreteName:"Volume",shortName:"Volume",data:[],displayType:"Histogram",color:"#3DA8FF",lineThickness:1}]};break;default:console.log("indicator not implemented")}}catch(e){console.log(e)}return a},FS);function FS(){}var IndicatorsManager=(nW.prototype.addCustomIndicator=function(e,t,i,a,n){for(var o,r=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}),s={indicatorID:-1,code:"custom",name:a,shortName:a,parameters:null,display:i,markers:null,discreteIndicators:[]},l=0;l<e.length;l+=1)o=IndicatorCalculator.calculateIndicatorDiscrete(e[l],r,t[l],this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider),n&&n[l]&&(o.discreteIndicators[0].color=n[l]),s.discreteIndicators.push(o.discreteIndicators[0]);return this.addIndicatorDetails(s)},nW.prototype.addIndicator=function(e,t,a,n){var o,r,s=this,l=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}).length,d=[],c=0;IndicatorCalculator.calculateIndicator(e,this.getDataSource(d),t,this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider,function(i){if(i){if(!i.error){for(var e=0;e<i.discreteIndicators.length;e+=1)!function(t){0<i.discreteIndicators[t].data.length&&_.each(d,function(e){i.discreteIndicators[t].data.splice(e,0,null)}),a[t]&&(i.discreteIndicators[t].color=a[t]),n[t]&&(i.discreteIndicators[t].lineThickness=n[t]),o=l,i.discreteIndicators[t].futureElementsCount&&(o+=i.discreteIndicators[t].futureElementsCount,i.discreteIndicators[t].futureElementsCount&&(c=i.discreteIndicators[t].futureElementsCount>c?i.discreteIndicators[t].futureElementsCount:c)),"ProfitArea"===i.discreteIndicators[t].displayType?(i.discreteIndicators[t].profitData=i.discreteIndicators[t].profitData.slice(i.discreteIndicators[t].profitData.length-o),i.discreteIndicators[t].lossData=i.discreteIndicators[t].lossData.slice(i.discreteIndicators[t].lossData.length-o)):i.discreteIndicators[t].data=i.discreteIndicators[t].data.slice(i.discreteIndicators[t].data.length-o)}(e);return s.chart.moveIntoTheFuture(c),r=s.addIndicatorDetails(i),"vol"===i.code&&s.chart.volumeIndicator&&(s.chart.volumeIndicator=r),r}s.onError(i.error)}},this)},nW.prototype.addDefaultIndicator=function(e,t){var i,a,n=this,o=0,r=[];this.chart.isStockLoaded?(a=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}).length,IndicatorCalculator.calculateDefaultIndicator(e,this.getDataSource(r),this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider,function(e){e.error?n.onError(e.error):(_.each(e.discreteIndicators,function(t){"ProfitArea"===t.displayType?(0<t.profitData.length&&_.each(r,function(e){t.profitData.splice(e,0,null)}),0<t.lossData.length&&_.each(r,function(e){t.lossData.splice(e,0,null)})):0<t.data.length&&_.each(r,function(e){t.data.splice(e,0,null)}),i=a,t.futureElementsCount&&(i+=t.futureElementsCount,o=t.futureElementsCount>o?t.futureElementsCount:o),"ProfitArea"===t.displayType&&(t.profitData=t.profitData.slice(t.profitData.length-i),t.lossData=t.lossData.slice(t.lossData.length-i))}),n.chart.moveIntoTheFuture(o),n.addIndicatorDetails(e,!1))},this,t)):console.log("error - trying to add indicator while no stock loaded!")},nW.prototype.addDefaultIndicator2=function(e,t){var i,a,n=0,o=[];return this.chart.isStockLoaded?(i=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}).length,t=IndicatorCalculator.calculateDefaultIndicator(e,this.getDataSource(o),this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider,null,this,t),_.each(t.discreteIndicators,function(t){0<t.data.length&&_.each(o,function(e){t.data.splice(e,0,null)}),a=i,t.futureElementsCount&&(a+=t.futureElementsCount,n=t.futureElementsCount>n?t.futureElementsCount:n),"ProfitArea"===t.displayType&&(t.profitData=t.profitData.slice(t.profitData.length-a),t.lossData=t.lossData.slice(t.lossData.length-a))}),this.chart.moveIntoTheFuture(n),this.addIndicatorDetails(t,!1)):null},nW.prototype.addElementsInEnd=function(t){_.forEach(this.indicators,function(e){_.forEach(e.indicatorSeries.displaySeries,function(e){e.addSeriesElementsInEnd(_.toArray(t))}),e.chartArea&&e.chartArea.displayArea.refreshDates()})},nW.prototype.addIndicatorDetails=function(i,e){var a,n,o,r,s,l,d,t;void 0===e&&(e=!1);var c=_.map(this.displayArea.allSeries[0].get("elements"),function(e){return e.get("quoteDate")});return this.indicatorsCounter+=1,i.objectID=this.indicatorsCounter,"own-window"===i.display&&this.chart.model.get("lowerIndicatorsLimit")?(t=_.filter(this.indicators,{display:"own-window"})).length+1>this.chart.model.get("lowerIndicatorsLimit")&&this.removeIndicator(_.first(t)):"on-chart"===i.display&&this.chart.model.get("upperIndicatorsLimit")&&(t=_.filter(this.indicators,{display:"on-chart"})).length+1>this.chart.model.get("upperIndicatorsLimit")&&this.removeIndicator(_.first(t)),this.indicators.push(i),this.updateSerializedIndicators(),i.indicatorSeries=new ChartSeries,i.indicatorSeries.symbol=i.code,i.indicatorSeries.displayName=i.name,i.indicatorSeries.showDecimalPlaces=i.showDecimalPlaces,i.indicatorSeries.IndicatorParameters=i.parameters,i.indicatorSeries.seriesMarkers=i.markers,_.each(i.discreteIndicators,function(e){if(a=[],r=new ChartDisplaySeries({elements:[],displayType:e.displayType,displayName:e.discreteName,displayColor:e.color,lineThickness:e.lineThickness,displayId:e.discreteIndicatorID,displayPrices:e.displayPrices,markers:i.markers}),"ProfitArea"===e.displayType){o=e.profitData.length;var t=c.length-o;for(n=0;n<t;n+=1)a.push(new ChartSeriesElement({value:null,quoteDate:new Date(c[n]),isFake:!0}));for(n=0;n<o;n++)s=e.profitData[n]>e.lossData[n],l=(s?e.profitData:e.lossData)[n],d=(s?e.lossData:e.profitData)[n],a.push(new ChartSeriesElement({high:l,low:d,value:l,quoteDate:new Date(c[n+t]),isFake:null===e.profitData[n],isInProfit:s}));r.set({profitColor:e.profitColor,lossColor:e.lossColor})}else{o=e.data.length;t=c.length-o;for(n=0;n<t;n+=1)a.push(new ChartSeriesElement({value:null,quoteDate:new Date(c[n]),isFake:!0}));for(n=0;n<o;n++)a.push(new ChartSeriesElement({value:e.data[n],quoteDate:new Date(c[n+t]),isFake:null===e.data[n]}))}r.addSeriesElements(a),i.indicatorSeries.addDisplaySeries(r)}),"on-chart"===i.display?this.mainChartArea.addSeries(i.indicatorSeries):"own-window"===i.display?(this.addIndicatorChartArea(i),e||this.chart.onResize()):console.log("unsupported indicator display type"),this.chart.model.get("isIndicatorsToolbarVisible")&&this.chart.indicatorsToolbar.addSeries({series:i.indicatorSeries,objectID:i.objectID,isStackedIndicator:"own-window"===i.display,indicatorDetails:i}),e||this.chart.display(!0),this.chart.model.get("isIndicatorsToolbarVisible")||this.chart.onResize(!0),this.indicatorsCounter},nW.prototype.addDefaultIndicatorDiscrete=function(e){e=IndicatorCalculator.calculateDefaultIndicatorDiscrete(e,_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}));return this.addIndicatorDetails(e)},nW.prototype.addIndicatorDiscrete=function(e,t){t=IndicatorCalculator.calculateIndicatorDiscrete(e,_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}),t,this.displayArea.allSeries[0].get("displayType"),this.displayArea.model,this.chart.stockDataProvider);return this.addIndicatorDetails(t)},nW.prototype.addIndicatorChartArea=function(e){var i=this,t=e.name,a=document.createElement("div");$(a).css("position","absolute"),$(a).appendTo(this.$indicatorsChartAreaDiv);a=new ChartArea({el:$(a),model:this.chart.model,prefix:"indicatorChartArea",showLastValue:!1,percentageHeight:.15});this.indicatorsChartAreas.push(a),this.chart.chartAreas.push(a),this.chart.applyChartAreaEvents(a),a.addSeries(e.indicatorSeries),e.parameters&&0<e.parameters.length&&(t+="("+_.map(e.parameters,function(e){switch(e.Type){case"number":return e.Value;case"list":var t=_.find(e.Options,function(e){return e.Selected});return t?t.Name:null;default:return e.Value}}).join(",")+")"),a.setChartName(t,14,"left","top"),e.chartArea=a,$(a).on("datesRangeChanged",function(e,t){t.isIndicator=!0,i.chart.onDatesRangeChanged(t)}),$(a).on("remove-indicator",function(e,t){t=_.find(i.indicators,{chartArea:t.chartArea});t&&i.removeIndicator(t)})},nW.prototype.clear=function(e){var t,i=this;this.indicators.length<=0||(e||(_.each(this.indicators,function(e){e.chartArea||i.mainChartArea.onRemoveSeriesRequest(null,{series:e.indicatorSeries})}),t=0),this.indicators=[],0<this.$indicatorsChartAreaDiv.children().length&&(this.chart.chartAreas=_.difference(this.chart.chartAreas,this.indicatorsChartAreas),t=this.chart.chartAreas.length,this.indicatorsChartAreas=[],this.$indicatorsChartAreaDiv.html("")),this.chart.indicatorsToolbar.clear(),(0<t||!this.chart.model.get("isIndicatorsToolbarVisible"))&&this.chart.onResize(!0),this.updateSerializedIndicators())},nW.prototype.getChartAreasToolbarsHeights=function(){return 0<this.indicatorsChartAreas.length?this.indicatorsChartAreas[0].toolbarHeight():0},nW.prototype.getDataSource=function(i){return _.filter(this.displayArea.allSeries[0].get("elements"),function(e,t){return!!e.get("close")||(i.push(t),!1)})},nW.prototype.getIndicaotrByObjectID=function(t){return _.find(this.indicators,function(e){return e.objectID===t})},nW.prototype.getIndicaotrsDiscrete=function(){var t=[];return _.forEach(this.indicators,function(e){_.forEach(e.discreteIndicators,function(e){t.push({indicatorDiscreteID:e.discreteIndicatorID,data:_.toArray(e.data)})})}),t},nW.prototype.getIndicaotrsInfo=function(t){var i,e=_.sortBy(this.indicators,function(e){return e.indicatorSeries.get("displayIndex")}),a=[];return _.each(e,function(e){_.each(e.indicatorSeries.displaySeries,function(e){(i=e.get("elements")).length>t&&!i[t].get("isFake")&&a.push({displayColor:e.get("displayColor"),displayName:e.get("displayName"),value:e.get("elements")[t].get("value")})})}),a},nW.prototype.onError=function(e){var t=this;this.chart.model.get("componentApi").showErrorMessage({error:e}),this.errorTimeout&&clearTimeout(this.errorTimeout),this.errorTimeout=setTimeout(function(){t.chart.model.get("componentApi").hideErrorMessage()},3e3)},nW.prototype.recalculateIndicators=function(a){var e,n,o,r,s,l,d,c,h,p,u,m,g,f,y=this,t=_.filter(this.indicators,function(e){return!e.isStock});0<t.length&&(c=_.filter(this.displayArea.allSeries[0].get("elements"),function(e){return!e.get("isFake")}).length,n=_.map(this.displayArea.allSeries[0].get("elements"),function(e){return e.get("quoteDate")}),p=0,f=_.last(t),_.forEach(t,function(t){var i=[];e=function(e){e.error?y.onError(e.error):(_.each(e.discreteIndicators,function(t){0<t.data.length&&_.each(i,function(e){t.data.splice(e,0,null)})}),_.forEach(t.indicatorSeries.displaySeries,function(t){if(e){if(d=_.filter(e.discreteIndicators,function(e){return e.discreteName===t.get("displayName")})[0],o=[],h=c,d.futureElementsCount&&(h+=d.futureElementsCount,p=d.futureElementsCount>p?d.futureElementsCount:p),"ProfitArea"===d.displayType){for(s=h,l=n.length-h,d.profitData=d.profitData.slice(d.profitData.length-h),d.lossData=d.lossData.slice(d.lossData.length-h),r=0;r<l;r+=1)o.push(new ChartSeriesElement({value:null,quoteDate:new Date(n[r]),isFake:!0}));for(r=0;r<s;r++)u=d.profitData[r]>d.lossData[r],m=(u?d.profitData:d.lossData)[r],g=(u?d.lossData:d.profitData)[r],o.push(new ChartSeriesElement({high:m,low:g,value:m,quoteDate:new Date(n[r+l]),isFake:null===d.profitData[r],isInProfit:u}))}else for(r=0;r<d.data.length;r++)o.push(new ChartSeriesElement({value:d.data[r],quoteDate:new Date(n[r]),isFake:null===d.data[r]}));t.set({elements:o})}else for(o=[],r=0;r<n.length;r++)o.push(new ChartSeriesElement({quoteDate:new Date(n[r]),isFake:!0})),t.set({elements:o})}),f===t&&(y.chart.display(!0),a&&a()))},IndicatorCalculator.calculateIndicator(t.code,y.getDataSource(i),t.parameters,y.displayArea.allSeries[0].get("displayType"),y.displayArea.model,y.chart.stockDataProvider,e,y),t.chartArea&&t.chartArea.displayArea.refreshDates()}))},nW.prototype.removeIndicator=function(e){this.indicators=_.without(this.indicators,e),e.chartArea?(this.indicatorsChartAreas=_.without(this.indicatorsChartAreas,e.chartArea),e.chartArea.remove(),this.chart.onRemoveChartAreaRequest({chartArea:e.chartArea,targert:e.chartArea}),this.chart.onResize()):this.mainChartArea.onRemoveSeriesRequest(null,{series:e.indicatorSeries}),this.chart.indicatorsToolbar&&(this.chart.model.get("isIndicatorsToolbarVisible")?this.chart.indicatorsToolbar.removeIndicator(e):$(this.chart.indicatorsToolbar).trigger("toolbarresize")),this.updateSerializedIndicators()},nW.prototype.removeIndicatorByObjectID=function(e){e=this.getIndicaotrByObjectID(e);e&&this.removeIndicator(e)},nW.prototype.serializeIndicators=function(e){var t=[];return _.each(e,function(e){t.push({code:e.code,parameters:e.parameters,discreteIndicators:_.map(e.discreteIndicators,function(e){return{color:e.color,lineThickness:e.lineThickness}})})}),JSON.stringify(t)},nW.prototype.updateIndicatorByObjectID=function(e){this.getIndicaotrByObjectID(e)&&this.updateIndicator()},nW.prototype.updateIndicator=function(){this.recalculateIndicators(null),this.savedIndicatorsInitialized&&this.updateSerializedIndicators()},nW.prototype.updateSerializedIndicators=function(){this.chart.model.set("indicators",this.serializeIndicators(this.indicators))},nW);function nW(e,t,i){var a=this;this.mainChartArea=t,this.displayArea=i,this.chart=e,this.$indicatorsChartAreaDiv=this.chart.$el.find(".IndicatorsChartAreaDiv"),this.indicators=[],this.pendingIndicators=[],this.indicatorsCounter=0,this.indicatorsChartAreas=[],this.savedIndicatorsInitialized=!1,$(this.chart.indicatorsToolbar).on("removeSeriesRequest",function(e,t){var i=_.find(a.indicators,function(e){return e.indicatorSeries===t.series});i&&a.removeIndicator(i)})}var DynamicPricesManager=(fZ.prototype.init=function(){this.pricesQ=[],this.livePrices=[],this.bucketSizeMinutes=null,this.bucketSizeDays=null,this.bucketSizeMonths=null,this.bucketSizeSeconds=null,this.isProcessing=!1,this.firstPriceIn=!1,this.lastDate=null,this.nowDate=null,this.limitDate=null,this.updateBucketSize()},fZ.prototype.clear=function(){this.livePrices=[],this.pricesQ=[],this.isProcessing=!1,this.firstPriceIn=!1,this.lastDate=null,this.nowDate=null,this.limitDate=null,this.updateBucketSize()},fZ.prototype.flush=function(){var e,t,i,a,n,o;if(this.livePrices&&0<this.livePrices.length){var r=this.livePrices;if(this.livePrices=[],0<r.length)for(e=r[0],a=_.last(r),i=t=e=e.real||(e.offer+e.bid)/2,a=a.real||(a.offer+a.bid)/2,n=0;n<r.length;n+=1)t<(o=r[n].real||(r[n].offer+r[n].bid)/2)?t=o:o<i&&(i=o);this.onHistoricalPrice({granularity:this.chart.model.get("granularity"),period:this.chart.model.get("period"),stock:{symbol:this.chart.model.get("stockSymbol"),newElements:[{Open:e,High:t,Low:i,Close:a,Date:this.limitDate,Volume:r[r.length-1].volume}]}})}},fZ.prototype.onPrice=function(){var e,t=this;if(!this.isProcessing&&0<this.pricesQ.length)if(this.isProcessing=!0,this.chart&&this.chart.mainChartArea&&this.chart.mainChartArea.allSeries[0]){switch((e=this.pricesQ.shift()).type){case"live":this.onLivePrice(e.price);break;case"historical":this.onHistoricalPrice(e.price)}this.isProcessing=!1,this.onPrice()}else setTimeout(function(){t.isProcessing=!1,t.onPrice()},100)},fZ.prototype.onLivePrice=function(e){var t,i,a,n,o,r,s=this;if(this.firstPriceIn?(t=this.getLastElement(),this.updateLastDate(t.get("quoteDate")),t.get("index")===this.chart.lastToIndex&&this.chart.moveIntoTheFuture(1)):(this.firstPriceIn=!0,this.setLastDate(this.flattenDateAndRemoveOneBucket(e.printedAt)),this.chart.moveIntoTheFuture(1,this.nowDate)),"Tick"===this.chart.model.get("granularity"))i=(e.bid+e.offer)/2,this.onHistoricalPrice({granularity:this.chart.model.get("granularity"),period:this.chart.model.get("period"),stock:{symbol:this.chart.model.get("stockSymbol"),newElements:[{Open:i,High:i,Low:i,Close:i,Date:e.printedAt}]}});else if(this.livePrices.push(e),this.limitDate>e.printedAt){if(this.livePrices=_.filter(this.livePrices,function(e){return e.printedAt>=s.nowDate}),0<this.livePrices.length)for(n=a=i=(t=this.livePrices[0]).real||(t.offer+t.bid)/2,r=0;r<this.livePrices.length;r+=1)a<(o=this.livePrices[r].real||(this.livePrices[r].offer+this.livePrices[r].bid)/2)?a=o:o<n&&(n=o);this.chart.mainChartArea.allSeries[0].displaySeries[0].updateLiveElement(e.bid,e.offer,e.printedAt,i,a,n,this.chart.mainChartArea.displayArea)}else this.flush()},fZ.prototype.onHistoricalPrice=function(e){if(!(e.stock.newElements.length<=0)){for(var t=_.map(e.stock.newElements,function(e){return new ChartSeriesElement({open:e.Open,high:e.High,low:e.Low,close:e.Close,value:e.Close,quoteDate:e.Date,volume:e.Volume,letter:e.Letter,dateTag:e.DateTag})}),i=t[0].get("quoteDate").getTime(),a=this.chart.mainChartArea.displayArea.allDates,n=a.length-1;0<=n&&!(a[n].getTime()<=i);--n);var o,r=this.chart.mainChartArea.displayArea.allSeries[0].get("elements").length,e=t[t.length-1].get("value");e>this.chart.mainChartArea.lastValue?this.chart.mainChartArea.lastBgd=this.chart.model.get("liveGreenColor")||this.chart.model.get("greenColor"):this.chart.mainChartArea.lastBgd=this.chart.model.get("redColor"),this.chart.mainChartArea.lastValue=e,this.chart.mainChartArea.displayArea.allSeries[0].replaceAndAddSeriesElements(n,t),r!==(o=this.chart.mainChartArea.displayArea.allSeries[0].get("elements").length)?(t=o-r,this.chart.mainChartArea.displayArea.refreshDates(),this.chart.recalculateIndicators(),this.chart.lastToIndex===r-1&&this.chart.displayIndexes(!1,this.chart.lastFromIndex+t,this.chart.lastToIndex+t),this.chart.rangeSelector&&this.chart.rangeSelector.resetSlider(this.chart.lastFromIndex,this.chart.lastToIndex,o,this.chart.model.get("showSliderDates")?this.chart.mainChartArea.calculateDisplayDates2(0,this.chart.mainChartArea.displayArea.allDates.length-1,this.chart.rangeSelector.datesWidth()):null),this.chart.mainChartArea.isMouseOn&&this.chart.mainChartArea.onMouseMove({pageX:this.chart.mainChartArea.lastMouseX,pageY:this.chart.mainChartArea.lastMouseY})):(this.chart.recalculateIndicators(),this.chart.displayIndexes(!0,this.chart.lastFromIndex,this.chart.lastToIndex)),0<this.livePrices.length&&this.onLivePrice(this.livePrices[this.livePrices.length-1])}},fZ.prototype.pushLivePrice=function(e,t){e.marketId.toString()===this.chart.model.get("stockSymbol").toString()&&(this.pricesQ.push({type:"live",price:e}),t||this.onPrice())},fZ.prototype.pushHistoricalPrice=function(e){e.hasNewData&&e.stock.symbol===this.chart.model.get("stockSymbol")&&e.granularity===this.chart.model.get("granularity")&&(this.pricesQ.push({type:"historical",price:e}),this.onPrice())},fZ.prototype.getLastElement=function(){for(var e=this.chart.mainChartArea.allSeries[0].displaySeries[0].get("elements"),t=null,i=e.length-1;0<=i;--i)if(!e[i].get("isFake")){t=e[i];break}return t},fZ.prototype.updateBucketSize=function(){var e=this.chart.model.get("granularity");switch(this.bucketSizeDays=null,this.bucketSizeMinutes=null,this.bucketSizeMonths=null,e){case"OneDay":this.bucketSizeDays=1;break;case"OneWeek":this.bucketSizeDays=7;break;case"OneMonth":this.bucketSizeMonths=1;break;case"Tick":this.bucketSizeSeconds=1;break;default:this.bucketSizeMinutes=this.chart.granularityToMinutes(e)}},fZ.prototype.flattenDateAndRemoveOneBucket=function(e){var t;switch(this.chart.model.get("granularity")){case"OneDay":case"OneWeek":(t=new Date(e)).setDate(e.getDate()-this.bucketSizeDays),t.setHours(0,0,0,0);break;case"OneMonth":t=new Date(e),t=new Date(t.setMonth(e.getMonth()-this.bucketSizeMonths));break;case"Tick":t=new Date(e),t=new Date(t.setSeconds(e.getSeconds()-this.bucketSizeSeconds));break;default:(t=new Date(e.getTime()-6e4*this.bucketSizeMinutes)).setSeconds(0,0)}return t},fZ.prototype.setLastDate=function(e){switch(this.chart.model.get("granularity")){case"OneDay":case"OneWeek":this.lastDate=new Date(e),this.lastDate.setHours(0,0,0,0),this.nowDate=new Date(this.lastDate),this.nowDate.setDate(this.lastDate.getDate()+this.bucketSizeDays),this.nowDate.setHours(0,0,0,0),this.limitDate=new Date(this.nowDate),this.limitDate.setDate(this.nowDate.getDate()+this.bucketSizeDays),this.limitDate.setHours(0,0,0,0);break;case"OneMonth":this.lastDate=new Date(e),this.nowDate=new Date(this.lastDate),this.nowDate=new Date(this.lastDate.setMonth(this.lastDate.getMonth()+this.bucketSizeMonths)),this.limitDate=new Date(this.nowDate),this.limitDate=new Date(this.limitDate.setMonth(this.nowDate.getMonth()+this.bucketSizeMonths));break;case"Tick":this.lastDate=new Date(e),this.nowDate=new Date(this.lastDate.getTime()+1e3*this.bucketSizeSeconds),this.limitDate=new Date(this.nowDate.getTime()+1e3*this.bucketSizeSeconds);break;default:this.lastDate=new Date(e),this.lastDate.setSeconds(0,0),this.nowDate=new Date(this.lastDate.getTime()+6e4*this.bucketSizeMinutes),this.nowDate.setSeconds(0,0),this.limitDate=new Date(this.nowDate.getTime()+6e4*this.bucketSizeMinutes),this.limitDate.setSeconds(0,0)}},fZ.prototype.updateLastDate=function(e){var t=new Date(e);switch(this.chart.model.get("granularity")){case"OneDay":case"OneWeek":case"OneMonth":t.setHours(0,0,0,0);break;case"Tick":t.setMilliseconds(0);break;default:t.setSeconds(0,0)}t>this.lastDate&&this.setLastDate(e)},fZ);function fZ(e){this.pricesQ=[],this.livePrices=[],this.chart=e,this.init()}var Chart=($Z=Backbone.View,__extends(_Z,$Z),_Z.prototype.addDefaultIndicator=function(e){return this.indicatorsManager.addDefaultIndicator(e)},_Z.prototype.addDefaultIndicatorDiscrete=function(e){return this.indicatorsManager.addDefaultIndicatorDiscrete(e)},_Z.prototype.addIndicatorDiscrete=function(e,t){return this.indicatorsManager.addIndicatorDiscrete(e,t)},_Z.prototype.addIndicators=function(e){var n=this;_.each(e,function(e){for(var t=[],i=[],a=0;a<e.discreteIndicators.length;a+=1)e.discreteIndicators[a].color&&(t[a]=e.discreteIndicators[a].color),e.discreteIndicators[a].lineThickness&&(i[a]=e.discreteIndicators[a].lineThickness);n.indicatorsManager.addIndicator(e.code,e.parameters,t,i)})},_Z.prototype.addLevel=function(e,t){this.mainChartArea.annotationsManager.addLevel(e,t)},_Z.prototype.addStockSeries=function(t,e,i){void 0===e&&(e=!1),void 0===i&&(i=null);var a,n=[],o=new ChartSeries;o.symbol=t.symbol,o.displayName=t.displaySymbol,o.canUserEdit=e,o.isToolbarVisible=!1,$(t.eodData).each(function(e){a=new ChartSeriesElement({open:t.eodData[e].Open,high:t.eodData[e].High,low:t.eodData[e].Low,close:t.eodData[e].Close,value:t.eodData[e].Close,quoteDate:t.eodData[e].Date,volume:t.eodData[e].Volume,letter:t.eodData[e].Letter,dateTag:t.eodData[e].DateTag}),n.push(a)});i=new ChartDisplaySeries({elements:_.toArray(n),displayType:this.model.get("stockDisplayType"),displayName:t.displaySymbol,displayColor:i});return o.addDisplaySeries(i),this.mainChartArea.addSeries(o),o},_Z.prototype.applyChartAreaEvents=function(e){var i=this,t=$(e);this.$resizeIndicatorInteraction.on("mousemove",function(e){return i.onChartAreaResizeMouseMove(e)}),this.$resizeIndicatorInteraction.on("mouseup",function(){return i.onChartAreaResizeMouseUp()}),t.on("interactionmousemove",function(e,t){return i.onChartAreaMouseMove(e,t)}),t.on("interactionmouseleave",function(e,t){return i.onChartAreaMouseLeave(e,t)}),t.on("toolbarResize",function(){return i.onResize()}),t.on("removeChartAreaRequest",function(e){return i.onRemoveChartAreaRequest(e)}),t.on("startResize",function(e,t){return i.onChartAreaStartResize(e,t)}),t.on("moveChart",function(e,t){return i.onMoveChart(e,t)}),t.on("stopResize",function(){return i.onChartAreaStopResize()}),t.on("stopDrawing",function(){return i.stopDrawing(null,e)})},_Z.prototype.applyLayout=function(e,t){var i,a,n,o=this.model.get("topMarginPx"),r=this.model.get("leftMarginPx"),s=0,l=0,d=0,c=0,h=0,p=0,u=0,m=e-(this.model.get("leftMarginPx")+this.model.get("rightMarginPx")),g=this.indicatorsManager.getChartAreasToolbarsHeights();this.model.get("isIndicatorsToolbarVisible")&&(this.$indicatorsToolbarDiv.css({width:m}),c=0<(d=this.indicatorsToolbar.getHeight()-this.model.get("topMarginPx"))?d+this.model.get("elementsSpacingPx"):0),this.volumeChartArea&&(h=this.volumeChartArea.toolbarHeight()+this.model.get("volumeChartAreaHeightPx")+this.model.get("elementsSpacingPx")),this.model.get("isInfoAreaVisible")&&(p=this.model.get("infoAreaHeightPx")+this.model.get("elementsSpacingPx")),this.model.get("showTimeSlider")&&(u=this.model.get("rangeSelectorHeightPx")),i=t-(c+this.model.get("topMarginPx")+h+p+u+this.model.get("bottomMarginPx")),this.currentChartAreasHeight=i,a=_.reduce(this.indicatorsManager.indicatorsChartAreas,function(e,t){return e+t.options.percentageHeight*i},0),this.$indicatorsToolbarDiv.css({top:o,left:r,width:m,height:d,"margin-top":-1*this.model.get("topMarginPx")}),this.model.get("isChartDimensionsActive")?(s=t-(c+this.model.get("topMarginPx")+h+p+u+this.model.get("bottomMarginPx")),this.$el.css({height:t+a+this.model.get("topMarginPx"),width:e})):(s=t-(c+this.model.get("topMarginPx")+a+h+p+u+this.model.get("bottomMarginPx")),this.$el.css({width:""})),this.$mainChartAreaDiv.css({top:o+c,left:r,width:m,height:s}),this.mainChartArea.onResize(),this.$resizeIndicatorInteraction.css({top:o+c,left:0,bottom:0,right:0}),this.$indicatorsChartAreaDiv.css({top:o+c+s,left:r,width:m,height:a}),l=0,_.each(_.sortBy(this.indicatorsManager.indicatorsChartAreas,function(e){return e.allSeries[0].get("displayIndex")}),function(e){var t=e.options.percentageHeight*i;$(e.el).css({top:l,left:0,width:m,height:t+g}),l+=t+g,e.onResize()}),this.$volumeChartAreaDiv.css({top:o+c+s+a,left:r}),n=this.model.get("showTimeSlider")?(n=this.model.get("mainChartAreaIsLeftAxisVisible")?m-this.model.get("leftAxisWidthPx"):m,this.model.get("mainChartAreaIsRightAxisVisible")?n:n-this.model.get("rightAxisWidthPx")):m-(this.model.get("rightAxisWidthPx")-2),this.$rangeSelectorDiv.css({top:o+c+s+a+h,left:r,width:n,height:u}),this.rangeSelector&&this.rangeSelector.onResize(),this.$infoAreaDiv.css({top:o+c+s+a+h+u+this.model.get("elementsSpacingPx"),left:r,width:m,height:this.model.get("infoAreaHeightPx")})},_Z.prototype.applyTemplate=function(){$(this.el).html(T.Chart()),this.$mainChartAreaDiv=this.$el.find(".MainChartAreaDiv"),this.$indicatorsChartAreaDiv=this.$el.find(".IndicatorsChartAreaDiv"),this.$volumeChartAreaDiv=this.$el.find(".VolumeChartAreaDiv"),this.$rangeSelectorDiv=this.$el.find(".RangeSelectorDiv"),this.$indicatorsToolbarDiv=this.$el.find(".IndicatorsToolbarDiv"),this.$infoAreaDiv=this.$el.find(".InfoAreaDiv"),this.$resizeIndicatorInteraction=this.$el.find(".resize-indicator-interaction"),this.model.get("isInfoAreaVisible")||this.$infoAreaDiv.css("display","none"),this.mainChartArea=new ChartArea({el:this.$mainChartAreaDiv,model:this.model,prefix:"mainChartArea",showLastValue:!0,drawingLocked:!0,isLiveElementEnabled:!0}),this.chartAreas.push(this.mainChartArea),this.indicatorsManager=new IndicatorsManager(this,this.mainChartArea,this.mainChartArea.displayArea),this.dynamicPricesManager=new DynamicPricesManager(this),this.model.get("showTimeSlider")?this.rangeSelector=new TimeSlider({el:this.$rangeSelectorDiv,model:this.model}):this.$rangeSelectorDiv.css({"border-bottom":"1px solid "+this.model.get("chartBorderColor")}),this.infoBorder=new InfoBorder({el:this.$el.find(".InfoBorderDiv"),dragParent:this,model:this.model}),this.indicatorsToolbar=new IndicatorsToolbar({el:this.$indicatorsToolbarDiv,indicatorsManager:this.indicatorsManager,model:this.model})},_Z.prototype.beforeStockLoad=function(e){(this.pendingIndicators&&this.pendingIndicators.length<=0||!this.pendingIndicators)&&(this.pendingIndicators=this.indicatorsManager.indicators),this.isOperationInProgress=!0,this.clear(!e,!1),this.onResize(!0),this.mainChartArea.displayArea.applyLayout()},_Z.prototype.clear=function(e,t){this.firstClear?this.firstClear=!1:($(this.el).hide(),0<this.mainChartArea.allSeries.length&&this.mainChartArea.allSeries[0].displaySeries[0].clearLiveElement(),this.mainChartArea.clearSeries(),this.lastFromIndex=null,this.lastToIndex=null,this.mainChartArea.setChartName(""),e&&(this.model.set({fromDateDisplay:this.model.get("fromDateDisplayVS")||null,toDateDisplay:this.model.get("toDateDisplayVS")||null},{silent:!0}),this.model.set({autoZoomY:!0,maxValueY:null,minValueY:null,zoomYLevel:0})),t?this.clearIndicators():this.clearIndicators(!0),this.livePrices=[],this.model.set({livePricesOn:!1,wasFirst:!1},{silent:!0}),this.dynamicPricesManager&&this.dynamicPricesManager.clear())},_Z.prototype.clearAnnotations=function(){_.each(this.chartAreas,function(e){e.annotationsManager.clearAnnotations()})},_Z.prototype.clearAnnotationsForced=function(){_.each(this.chartAreas,function(e){e.annotationsManager.clearAnnotationsForced()})},_Z.prototype.clearIndicators=function(e){this.indicatorsManager.clear(e=void 0===e?!1:e)},_Z.prototype.display=function(e,t){void 0===t&&(t=!1);var i,a=_.map(this.mainChartArea.allSeries[0].displaySeries[0].get("elements"),function(e){return e.get("quoteDate").getTime()}),n=this.model.get("fromDateDisplay").getTime();-1===(i=_.sortedIndexOf(a,n))&&(_.find(a,function(e,t){return n<=e&&(i=t,!0)}),-1===i&&(i=0));var o,r=this.model.get("toDateDisplay").getTime();if(-1===(o=this.model.get("pinLastDataPoint")?a.length-1:_.sortedIndexOf(a,r))){for(var s=a.length-1;0<=s;--s)if(a[s]>=n){o=s;break}-1===o&&(o=a.length-1)}this.displayIndexes(e,i,o,t)},_Z.prototype.displayIndexes=function(e,i,a,t){var n;void 0===t&&(t=!1),-1!==i&&-1!==a&&(e||t||this.lastFromIndex!==i||this.lastToIndex!==a)&&(this.lastFromIndex=i,this.lastToIndex=a,n=this.mainChartArea.displayArea.allDates[i],e=this.mainChartArea.displayArea.allDates[a],this.model.set({fromDateDisplay:n,toDateDisplay:e},{silent:!0}),this.model.set({fromDateDisplayVS:n,toDateDisplayVS:e}),t||this.mainChartArea.display(i,a),$(this.indicatorsManager.indicatorsChartAreas).each(function(e,t){t.clearCrosshair(),t.display(i,a)})),this.isStockLoaded=!0},_Z.prototype.displayRange=function(e,t,i){for(var a,n,o,r;e<this.mainChartArea.displayArea.allDates[0]&&this.moveIntoPast(null,null););for(r=this.mainChartArea.displayArea.allDates.length,o=0;o<r;o+=1)if(e<=this.mainChartArea.displayArea.allDates[o]){a=o;break}for(o=--r;0<=o;--o)if(t>=this.mainChartArea.displayArea.allDates[o]){n=o;break}this.displayIndexes(i,a,n),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.displayArea.allSeries[0].get("elements").length,null)},_Z.prototype.getFromDate=function(){return this.model.get("fromDate")},_Z.prototype.getNextDate=function(e,t){var i;switch(t){case"Tick":i=new Date(e.getTime()+1e3);break;case"OneMinute":i=new Date(e.getTime()+6e4);break;case"TwoMinute":i=new Date(e.getTime()+12e4);break;case"ThreeMinute":i=new Date(e.getTime()+18e4);break;case"FiveMinute":i=new Date(e.getTime()+3e5);break;case"FifteenMinute":i=new Date(e.getTime()+9e5);break;case"ThirtyMinute":i=new Date(e.getTime()+18e5);break;case"SixtyMinute":i=new Date(e.getTime()+36e5);break;case"FourHour":i=new Date(e.getTime()+144e5);break;case"OneDay":(i=new Date(e)).setDate(e.getDate()+1);break;case"OneWeek":(i=new Date(e)).setDate(e.getDate()+7);break;case"OneMonth":i=new Date(e),i=new Date(i.setMonth(e.getMonth()+1));break;default:throw"granulatiry not suported"}return i},_Z.prototype.getStockSymbol=function(){return this.model.get("stockSymbol")},_Z.prototype.getToDate=function(){return this.model.get("toDate")},_Z.prototype.granularityToMinutes=function(e){var t;switch(e){case"Tick":t=0;break;case"OneMinute":t=1;break;case"TwoMinute":t=2;break;case"ThreeMinute":t=3;break;case"FiveMinute":t=5;break;case"FifteenMinute":t=15;break;case"ThirtyMinute":t=30;break;case"SixtyMinute":t=60;break;case"FourHour":t=240;break;default:t=null}return t},_Z.prototype.initialize2=function(e){this.options=e,this.isStockLoaded=!1,this.isOperationInProgress=!1,this.stockDataProvider=new StockDataProvider({model:this.model}),this.firstClear=!0,this.chartAreas=[],this.livePrices=[],this.isAddingLivePrice=!1,this.lastDrawChartAreas=[],this.undoneChartAreas=[],this.applyTemplate(),this.initializeEvents(),this.onResize(),$(this.el).hide()},_Z.prototype.initializeIndicators=function(){var e=this,t=this.model.get("saved_indicators");t&&t===this.model.get("indicators")||(this.clearIndicators(),t&&_.defer(function(){e.addIndicators(JSON.parse(t))}))},_Z.prototype.initializeEvents=function(){var i=this,e=$(this.stockDataProvider),t=$(this.indicatorsToolbar),a=$(this.mainChartArea);e.on("stockPartDownloaded",function(e,t){return i.onStockPartDownloaded(e,t)}),e.on("firstextradatadownloaded",function(e){return i.moveIntoPast(e,null)}),e.on("perioddownloaded",function(e,t){return i.onPeriodDownloaded(e,t)}),e.on("periodenabled",function(e,t){$(i).trigger(e,t)}),e.on("historicalPricesUpdate",function(e){return i.onHistoricalPricesUpdate(e)}),this.rangeSelector&&((e=$(this.rangeSelector)).on("dateschanged",function(e){return i.onDatesChanged(e)}),e.on("sliderSlide",function(e,t){return i.onSliderSlide(e,t)})),t.on("toolbarresize",function(){i.applyLayout(i.lastWidth,i.lastHeight)}),t.on("display-indexes-updated",function(){return i.onDisplayIndexesUpdated()}),t.on("series-removed",function(e){return i.onSeriesRemoved(e)}),this.applyChartAreaEvents(this.mainChartArea),this.listenTo(this.model,"change:stockDisplayType",function(){return i.onModelChangeStockDisplayType()}),this.listenTo(this.model,"change:displayPeriod",function(){return i.onModelChangeDisplayPeriod()}),this.listenTo(this.model,"change:indicators",function(){return i.onModelChangeIndicators()}),this.listenTo(this.model,"change:customChartName",function(){return i.onModelChangeCustomChartName()}),this.listenTo(this.model,"change:rightAxisWidthPx",function(){i.onResize(!0)}),this.listenTo(this.model,"change:chartBorderColor",function(){return i.onModelChangeChartBorderColor()}),this.listenTo(this.model,"change:showTimeSlider",function(){return i.onModelChangeShowTimeSlider()}),this.listenTo(this.model,"change:isChartDimensionsActive change:chartDimensionsWidthPx change:chartDimensionsHeightPx",function(){return i.onModelChangeChartDimensions()}),a.on("zoom",function(e,t){return i.onZoom(e,t)}),a.on("priceRangeChanged",function(e){$(this).trigger(e)}),a.on("datesRangeChanged",function(e,t){i.onDatesRangeChanged(t)}),a.on("pattern-selected-on-chart",function(e){$(i).trigger(e)}),a.on("chart-rendered",function(){i.chartRendered=!0,$(i).trigger("chart-rendered")}),this.listenTo(this.model,"change:showVolume",function(e,t){return i.onShowVolumeChanged(e,t)}),$(this).one("chart-rendered",function(){this.indicatorObj=this.model.get("saved_indicators"),this.initializeIndicators()}),this.listenTo(this.model,"change:saved_indicators",function(){return i.initializeIndicators()})},_Z.prototype.loadStock=function(e){this.model.set({stockSymbol:e})},_Z.prototype.moveIntoPast=function(e,t){var i,a=this.stockDataProvider.getNextPeriod(),t=!!(a&&0<a.length)&&(i=_.map(a,function(e){return new ChartSeriesElement({open:e.Open,high:e.High,low:e.Low,close:e.Close,value:e.Close,quoteDate:e.Date,volume:e.Volume,letter:e.Letter,dateTag:e.DateTag})}),this.mainChartArea.allSeries[0].displaySeries[0].addSeriesElementsInFront(i),this.lastFromIndex+=i.length,this.lastToIndex+=i.length,this.mainChartArea.displayArea.displayFromIndex=this.lastFromIndex,this.mainChartArea.displayArea.displayToIndex=this.lastToIndex,this.model.set({fromDate:a[0].Date},{silent:!0}),this.mainChartArea.displayArea.refreshDates(),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,this.model.get("showSliderDates")?this.mainChartArea.calculateDisplayDates2(0,this.mainChartArea.displayArea.allDates.length-1,this.rangeSelector.datesWidth()):null),(!t||t.dontMoveIntoPast)&&t||this.recalculateIndicators(),!0);return t},_Z.prototype.moveIntoTheFuture=function(e,t){var i;void 0===t&&(t=null);var a=[];if(!(e<=0)){for(var n=this.mainChartArea.allSeries[0].displaySeries[0].get("elements"),n=n[n.length-1].get("quoteDate"),o=new Date(n),r=0;r<e;r+=1)o=t||this.getNextDate(o,this.model.get("granularity")),a.push(new ChartSeriesElement({isFake:!0,quoteDate:o,dateTag:Helpers.getDateTag(o,i)})),i=o;this.mainChartArea.allSeries[0].displaySeries[0].addSeriesElementsInEnd(_.toArray(a)),this.lastFromIndex+=a.length,this.lastToIndex+=a.length,this.indicatorsManager.addElementsInEnd(a),this.model.set({toDate:o},{silent:!0}),this.mainChartArea.displayArea.refreshDates(),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,this.model.get("showSliderDates")?this.mainChartArea.calculateDisplayDates2(0,this.mainChartArea.displayArea.allDates.length-1,this.rangeSelector.datesWidth()):null),this.displayIndexes(!0,this.lastFromIndex,this.lastToIndex)}},_Z.prototype.onDatesChanged=function(e){this.model.set({fromDateDisplay:this.mainChartArea.allSeries[0].displaySeries[0].get("elements")[e.fromIndex].get("quoteDate"),toDateDisplay:this.mainChartArea.allSeries[0].displaySeries[0].get("elements")[e.toIndex].get("quoteDate")})},_Z.prototype.onChartAreaMouseLeave=function(e,t){for(var i=0,a=this.chartAreas.length,i=0;i<a;i+=1)this.chartAreas[i]!==t.eventSource&&(this.chartAreas[i].handleMouseLeave(t.eventArgs),this.chartAreas[i].clearCrosshair());clearTimeout(this.priceInfoTimer)},_Z.prototype.onChartAreaMouseMove=function(e,t){var i,a,n,o,r=this;for(this.lastMouseIndex=t.mouseIndex,i=0;i<this.chartAreas.length;i+=1)this.chartAreas[i]!==t.sourceChartArea&&(this.chartAreas[i].clearSelectedDates(),this.chartAreas[i].clearSelectedValue(),this.chartAreas[i].clearCrosshair(),this.chartAreas[i].drawCrosshair(t.pageX,t.pageY,t.mouseItem,!0),this.chartAreas[i].refreshSelectedPriceAndDate(t.pageX,t.pageY,t.mouseIndex));a=t.liveItem||this.mainChartArea.displayArea.allSeries[0].get("elements")[t.mouseIndex],this.model.get("showInfoBorder")&&this.updateBottomInfoBar(a),o="dd/mm/yy HH:MM","OneDay"!==this.model.get("granularity")&&"OneWeek"!==this.model.get("granularity")&&"OneMonth"!==this.model.get("granularity")||(o="dd/mm/yy"),this.model.get("showInfoBorder")&&(n=this.model.get("mainChartAreaValuesAxisDecimalPlaces"),this.infoBorder.setValues(a,n,o),this.infoBorder.setIndicatorsValues(this.indicatorsManager.getIndicaotrsInfo(t.mouseIndex),n),this.model.get("isInfoBorderInCursorMode")&&(this.oldPageX===t.pageX&&this.oldPageY===t.pageY||(this.oldPageX=t.pageX,this.oldPageY=t.pageY,this.infoBorder.onPause(!1),clearTimeout(this.priceInfoTimer),this.priceInfoTimer=setTimeout(function(){r.infoBorder.onPause(!0)},1e3))))},_Z.prototype.onChartAreaResizeMouseMove=function(e){var t;this.resizeStart&&(t=this.resizeStart.source.$el.height()+(this.resizeStart.pageY-e.pageY),e.bubbles&&this.resizeStart.pageY-e.pageY!=0&&(this.resizeStart.pageY=e.pageY,this.resizeStart.source.options.percentageHeight=t/this.currentChartAreasHeight,this.onResize(!0)))},_Z.prototype.onChartAreaResizeMouseUp=function(){this.$resizeIndicatorInteraction.hide(),this.resizeStart=null},_Z.prototype.onChartAreaStartResize=function(e,t){this.$resizeIndicatorInteraction.show(),this.resizeStart=t},_Z.prototype.onChartAreaStopResize=function(){this.resizeStart=null},_Z.prototype.onDatesRangeChanged=function(e){e.indictors=this.indicatorsManager.getIndicaotrsDiscrete(),$(this).trigger("datesRangeChanged",e)},_Z.prototype.onDisplayIndexesUpdated=function(){this.lastMouseIndex&&this.model.get("showInfoBorder")&&this.infoBorder.setIndicatorsValues(this.indicatorsManager.getIndicaotrsInfo(this.lastMouseIndex),this.model.get("mainChartAreaValuesAxisDecimalPlaces")),this.onResize()},_Z.prototype.onHistoricalPricesUpdate=function(e){this.dynamicPricesManager&&this.dynamicPricesManager.pushHistoricalPrice(e)},_Z.prototype.onModelChangeChartBorderColor=function(){this.model.get("showTimeSlider")||this.$rangeSelectorDiv.css({"border-bottom":"1px solid "+this.model.get("chartBorderColor")})},_Z.prototype.onModelChangeChartDimensions=function(){$(this).trigger("appresize")},_Z.prototype.onModelChangeCustomChartName=function(){this.mainChartArea.setChartName(this.model.get("customChartName"))},_Z.prototype.onModelChangeDisplayPeriod=function(){var e,t,i=this.model.get("displayPeriod");if(!this.isOperationInProgress){for(;!this.stockDataProvider.isPeriodLoaded(i);)this.moveIntoPast(null,null);t=this.stockDataProvider.getLoadedBaseIndex(),e=this.stockDataProvider.getPeriodInfo(i).firstIndex-t,t=this.mainChartArea.displayArea.allDates.length-1,this.displayIndexes(!1,e,t),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.displayArea.allSeries[0].get("elements").length,null)}},_Z.prototype.onModelChangeIndicators=function(){this.indicatorObj?this.model.get("indicators")===this.indicatorObj&&(this.indicatorObj=null,this.indicatorsManager.savedIndicatorsInitialized=!0):this.model.set("saved_indicators",this.model.get("indicators"))},_Z.prototype.onModelChangeShowTimeSlider=function(){this.model.get("showTimeSlider")?(this.rangeSelector.$el.children().first().show(),this.$rangeSelectorDiv.css({"border-bottom":"1px solid transparent"})):(this.rangeSelector.$el.children().first().hide(),this.$rangeSelectorDiv.css({"border-bottom":"1px solid "+this.model.get("chartBorderColor")}))},_Z.prototype.onModelChangeStockDisplayType=function(){this.model.get("stockSymbol")&&(this.mainChartArea.allSeries[0].displaySeries[0].set({displayType:this.model.get("stockDisplayType")}),this.mainChartArea.displayCurrent())},_Z.prototype.onMoveChart=function(e,t){var i,a,n=t.step;this.moving||("right"===t.direction?(this.lastFromIndex<t.step&&(t.step=this.lastFromIndex),0<t.step?(this.displayIndexes(!1,this.lastFromIndex-t.step,this.lastToIndex-t.step),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,null)):0<n&&this.moveIntoPast(null,null)):"left"===t.direction?(this.lastToIndex+t.step>=this.mainChartArea.displayArea.allSeries[0].get("elements").length&&(t.step=this.mainChartArea.displayArea.allSeries[0].get("elements").length-(this.lastToIndex+1)),0<t.step?(this.displayIndexes(!1,this.lastFromIndex+t.step,this.lastToIndex+t.step),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,null)):0<n&&this.moveIntoTheFuture(n)):"zoom-in"===t.direction?(i=(i=this.lastFromIndex+Math.round(t.step*t.leftRatio))<0?0:i)<=(a=(a=this.lastToIndex-Math.round(t.step*t.rightRatio))>=this.mainChartArea.displayArea.allSeries[0].get("elements").length?this.mainChartArea.displayArea.allSeries[0].get("elements").length-1:a)&&7<a-i&&(this.displayIndexes(!1,i,a),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,null)):"zoom-out"===t.direction&&((i=this.lastFromIndex-Math.round(t.step*t.leftRatio))<0&&(i=0),(a=this.lastToIndex+Math.round(t.step*t.rightRatio))>=this.mainChartArea.displayArea.allSeries[0].get("elements").length&&(a=this.mainChartArea.displayArea.allSeries[0].get("elements").length-1),this.displayIndexes(!1,i,a),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,null)))},_Z.prototype.onPeriodDownloaded=function(e,t){var i=this;t.reloadIndicators&&(t.reloadIndicators&&0<this.pendingIndicators.length?(_.each(this.pendingIndicators,function(e){i.indicatorsManager.addIndicator(e.code,e.parameters,_.map(e.discreteIndicators,function(e){return e.color}),_.map(e.discreteIndicators,function(e){return e.lineThickness}))}),this.pendingIndicators=[],this.pendingLivePriceRefresh&&(this.mainChartArea.displayArea.drawingLocked=!1,this.dynamicPricesManager.onPrice(),this.pendingLivePriceRefresh=!1)):this.pendingLivePriceRefresh?(this.mainChartArea.displayArea.drawingLocked=!1,this.dynamicPricesManager.onPrice(),this.pendingLivePriceRefresh=!1):_.defer(function(){i.mainChartArea.displayArea.drawingLocked=!1,i.mainChartArea.onResize(),i.mainChartArea.display(i.lastFromIndex,i.lastToIndex)}),$(this).trigger(t))},_Z.prototype.onReloadChart=function(){var e=_.groupBy(this.indicatorsManager.indicators,function(e){return e.isStock?"stock":"indicators"});this.indicatorsManager.clear(),this.addIndicators(e.indicators)},_Z.prototype.onRemoveChartAreaRequest=function(e){this.chartAreas=_.without(this.chartAreas,e.chartArea),this.onResize()},_Z.prototype.onResetChart=function(){this.model.set({autoZoomY:!0,zoomYLevel:0},{silent:!0}),this.removeFutureElements(),this.onModelChangeDisplayPeriod()},_Z.prototype.onResize=function(e){void 0===e&&(e=!1);var t=$(this.el).width(),i=$(this.el).height();this.model.get("isChartDimensionsActive")?(t=this.model.get("chartDimensionsWidthPx")||$(this.el).width(),i=this.model.get("chartDimensionsHeightPx")||this.model.get("chartDimensionsWidthPx")*this.model.get("chartDimensionsHeightPercent")||$(this.el).height()):(this.model.set("chartDimensionsWidthPx",$(this.el).width()),this.model.set("chartDimensionsHeightPx",$(this.el).height())),!e&&this.lastHeight===i&&this.lastWidth===t||(this.lastWidth=t,this.lastHeight=i,this.applyLayout(t,i),$(this).trigger("resized"))},_Z.prototype.onSeriesRemoved=function(e){e=e.series.series;this.mainChartArea.removeSeries(e)},_Z.prototype.onShowVolumeChanged=function(e,t){var i=this;t?this.chartRendered?this.volumeIndicator=this.indicatorsManager.addDefaultIndicator2("vol"):$(this).one("chart-rendered",function(){_.defer(function(){i.volumeIndicator=i.indicatorsManager.addDefaultIndicator2("vol")})}):this.volumeIndicator&&(this.indicatorsManager.removeIndicatorByObjectID(this.volumeIndicator),this.volumeIndicator=null)},_Z.prototype.onSliderSlide=function(e,t){this.displayIndexes(!1,t.fromIndex,t.toIndex)},_Z.prototype.onStartZoom=function(){this.mainChartArea.isZoomingEnabled=!0},_Z.prototype.onStopZoom=function(){this.mainChartArea.isZoomingEnabled=!1},_Z.prototype.onStockPartDownloaded=function(e,t){var i;_.some(this.mainChartArea.allSeries,function(e){return e.symbol===t.stock.symbol})||($(this.el).show(),this.dynamicPricesManager.updateBucketSize(),this.setChartName(),this.model.set({fromDate:t.stock.eodData[0].Date,toDate:t.stock.eodData[t.stock.eodData.length-1].Date},{silent:!0}),this.addStockSeries(t.stock),(!this.model.get("fromDateDisplay")||this.model.get("fromDateDisplay")<this.model.get("fromDate"))&&this.model.set({fromDateDisplay:this.model.get("fromDate")},{silent:!0}),(!this.model.get("toDateDisplay")||this.model.get("toDateDisplay")>this.model.get("toDate"))&&this.model.set({toDateDisplay:this.model.get("toDate")},{silent:!0}),this.display(!1,!0),this.onResize(),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,this.model.get("showSliderDates")?this.mainChartArea.calculateDisplayDates2(0,this.mainChartArea.displayArea.allDates.length-1,this.rangeSelector.datesWidth()):null),this.isOperationInProgress=!1,t.isLastDataPointOpen?this.dynamicPricesManager&&("Tick"===this.model.get("granularity")?this.dynamicPricesManager.pushLivePrice({bid:i.Close,offer:i.Close,printedAt:i.Date,isFast:!0,real:i.Close,marketId:this.model.get("stockSymbol")}):(this.dynamicPricesManager.pushLivePrice({bid:i.Open,offer:i.Open,printedAt:i.Date,isFast:!0,real:i.Open,marketId:this.model.get("stockSymbol")},!0),this.dynamicPricesManager.pushLivePrice({bid:i.High,offer:i.High,printedAt:i.Date,isFast:!0,real:i.High,marketId:this.model.get("stockSymbol")},!0),this.dynamicPricesManager.pushLivePrice({bid:i.Low,offer:i.Low,printedAt:i.Date,isFast:!0,real:i.Low,marketId:this.model.get("stockSymbol")},!0),this.dynamicPricesManager.pushLivePrice({bid:i.Close,offer:i.Close,printedAt:i.Date,isFast:!0,real:i.Close,marketId:this.model.get("stockSymbol")},!this.firstClear),this.pendingLivePriceRefresh=!0)):this.pendingLivePriceRefresh=!1,this.isLivePriceInit=!1,this.model.set("init-data-loaded",!0),$(this).trigger("initial-data-loaded"))},_Z.prototype.onZoom=function(e,t){this.initialDisplayToIndex||(this.initialDisplayFromIndex=this.lastFromIndex,this.initialDisplayToIndex=this.lastToIndex),this.displayIndexes(!1,t.fromIndex,t.toIndex),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.displayArea.allSeries[0].get("elements").length,null),this.mainChartArea.isZoomingEnabled=!1,$(this).trigger("zoomstop")},_Z.prototype.recalculateIndicators=function(e){this.indicatorsManager.recalculateIndicators(e=void 0===e?null:e)},_Z.prototype.redoAnnotations=function(){var e=this.undoneChartAreas.pop();e&&(this.lastDrawChartAreas.push(e),e.redoAnnotations())},_Z.prototype.removeFutureElements=function(){var e,t=this,i=this.mainChartArea.allSeries[0].displaySeries[0].removeFakeElements(this.isLivePriceInit);for(this.lastFromIndex-=i,this.lastToIndex-=i,this.mainChartArea.displayArea.displayFromIndex=this.lastFromIndex,this.mainChartArea.displayArea.displayToIndex=this.lastToIndex,this.mainChartArea.displayArea.refreshDates(),e=1;e<this.mainChartArea.allSeries.length;e++)_.forEach(this.mainChartArea.allSeries[e].displaySeries,function(e){e.removeFakeElements(t.isLivePriceInit)});_.forEach(this.indicatorsManager.indicatorsChartAreas,function(e){_.forEach(e.allSeries,function(e){_.forEach(e.displaySeries,function(e){e.removeFakeElements(t.isLivePriceInit)})}),e.displayArea.displayFromIndex=t.lastFromIndex,e.displayArea.displayToIndex=t.lastToIndex,e.displayArea.refreshDates()}),this.rangeSelector&&this.rangeSelector.resetSlider(this.lastFromIndex,this.lastToIndex,this.mainChartArea.allSeries[0].displaySeries[0].get("elements").length,this.model.get("showSliderDates")?this.mainChartArea.calculateDisplayDates2(0,this.mainChartArea.displayArea.allDates.length-1,this.rangeSelector.datesWidth()):null),this.displayIndexes(!0,this.lastFromIndex,this.lastToIndex)},_Z.prototype.removeIndicator=function(e){this.indicatorsManager.removeIndicator(e)},_Z.prototype.removeIndicatorByObjectID=function(e){this.indicatorsManager.removeIndicatorByObjectID(e)},_Z.prototype.setChartName=function(){var e;this.model.get("showMainChartName")?this.model.get("customChartName")&&this.model.get("customChartName")?this.mainChartArea.setChartName(this.model.get("customChartName")):this.model.get("showGranularityAsChartName")?(e=_.find(this.model.get("viewOptions"),{value:this.model.get("granularity")}),this.mainChartArea.setChartName(e.displayName)):this.model.get("stockPickerSymbol")&&this.mainChartArea.setChartName(this.model.get("stockPickerSymbol").name):this.mainChartArea.setChartName("")},_Z.prototype.setLivePrice=function(e){this.dynamicPricesManager&&(this.model.set({lastBid:e.bid,lastOffer:e.offer,lastAvgPrice:(e.bid+e.offer)/2}),this.dynamicPricesManager.pushLivePrice(e))},_Z.prototype.setPricesRange=function(e,t){e&&t?(this.model.set({autoZoomY:!1},{silent:!0}),this.mainChartArea.displayArea.staticRealMaxPts=null,this.mainChartArea.displayArea.staticRealMinPts=null,this.mainChartArea.displayArea.staticPtsPrice=null,this.mainChartArea.displayArea.staticRealMax=t,this.mainChartArea.displayArea.staticRealMin=e):(this.model.set({autoZoomY:!0},{silent:!0}),this.mainChartArea.displayArea.staticRealMax=null,this.mainChartArea.displayArea.staticRealMin=null),this.display(!0)},_Z.prototype.setPricesRangePts=function(e,t,i,a){null===e||null===t?(this.model.set({autoZoomY:!0},{silent:!0}),this.mainChartArea.displayArea.staticRealMaxPts=null,this.mainChartArea.displayArea.staticRealMinPts=null,this.mainChartArea.displayArea.staticPtsPrice=null):(this.model.set({autoZoomY:!1},{silent:!0}),this.mainChartArea.displayArea.staticRealMax=null,this.mainChartArea.displayArea.staticRealMin=null,this.mainChartArea.displayArea.staticRealMaxPts=e,this.mainChartArea.displayArea.staticRealMinPts=t,this.mainChartArea.displayArea.staticPtsPrice=i),a&&this.display(!0)},_Z.prototype.startDrawing=function(t){_.each(this.chartAreas,function(e){e.annotationsManager.startDrawing(t)}),this.chartToolbar.addActiveMenuItem(this.chartToolbar.drawButton)},_Z.prototype.stopDrawing=function(e,t){_.each(this.chartAreas,function(e){e.annotationsManager.stopDrawing()}),this.lastDrawChartAreas.push(t),this.chartToolbar.removeActiveMenuItem(this.chartToolbar.drawButton)},_Z.prototype.toggleSaveLayout=function(){this.$el.removeClass("save-mode"),this.onResize(!0)},_Z.prototype.undoAnnotations=function(){var e=this.lastDrawChartAreas.pop();e&&(this.undoneChartAreas.push(e),e.undoAnnotations())},_Z.prototype.updateBottomInfoBar=function(e){var t,i=this.model.get("mainChartAreaValuesAxisDecimalPlaces");e&&(this.$infoAreaDiv.find("#dateInfo").html(e.get("quoteDate").format("dd/mm/yy HH:MM")),e.get("isFake")||((t=e.get("open"))&&this.$infoAreaDiv.find("#openInfo").html(t.toFixed(i)),(t=e.get("high"))&&this.$infoAreaDiv.find("#highInfo").html(t.toFixed(i)),(t=e.get("low"))&&this.$infoAreaDiv.find("#lowInfo").html(t.toFixed(i)),(t=e.get("close"))&&this.$infoAreaDiv.find("#closeInfo").html(t.toFixed(i))))},_Z.prototype.updateIndicatorByObjectID=function(e,t){this.indicatorsManager.updateIndicatorByObjectID(e,t)},_Z),$Z,fba,iba,jba,hba,kba,lba,mba,nba,oba,N1a,O1a,P1a;function _Z(e){var t=$Z.call(this,e)||this;return t.extendedAnnotations=[],t.isAddingLivePrice=!1,t.isLivePriceInit=!1,t.isOperationInProgress=!1,t.lastHeight=-1,t.lastWidth=-1,t.resetLivePrice=!1,t.pendingIndicators=[],t.initialize2(e),t}function pba(e){return e=1==(e=e.toString(16)).length?"0"+e:e}function qba(e){return pba(Number(e))}function rba(e){return(e=pba(e))+e+e}function sba(e){if(10<e.length){var t=1+e.indexOf("("),i=e.indexOf(")"),i=e.substring(t,i).split(",");return["#",qba(i[0]),qba(i[1]),qba(i[2])].join("")}return e}fba=jQuery,hba=0,kba=[],lba=["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],mba=["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada","d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5","bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f","a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09","7f7f7f","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"],nba=["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"],oba=[["003366","336699","3366cc","003399","000099","0000cc","000066"],["006666","006699","0099cc","0066cc","0033cc","0000ff","3333ff","333399"],["669999","009999","33cccc","00ccff","0099ff","0066ff","3366ff","3333cc","666699"],["339966","00cc99","00ffcc","00ffff","33ccff","3399ff","6699ff","6666ff","6600ff","6600cc"],["339933","00cc66","00ff99","66ffcc","66ffff","66ccff","99ccff","9999ff","9966ff","9933ff","9900ff"],["006600","00cc00","00ff00","66ff99","99ffcc","ccffff","ccccff","cc99ff","cc66ff","cc33ff","cc00ff","9900cc"],["003300","009933","33cc33","66ff66","99ff99","ccffcc","ffffff","ffccff","ff99ff","ff66ff","ff00ff","cc00cc","660066"],["333300","009900","66ff33","99ff66","ccff99","ffffcc","ffcccc","ff99cc","ff66cc","ff33cc","cc0099","993399"],["336600","669900","99ff33","ccff66","ffff99","ffcc99","ff9999","ff6699","ff3399","cc3399","990099"],["666633","99cc00","ccff33","ffff66","ffcc66","ff9966","ff6666","ff0066","d60094","993366"],["a58800","cccc00","ffff00","ffcc00","ff9933","ff6600","ff0033","cc0066","660033"],["996633","cc9900","ff9900","cc6600","ff3300","ff0000","cc0000","990033"],["663300","996600","cc3300","993300","990000","800000","993333"]],fba.widget("evol.colorpicker",{version:"2.0",options:{color:null,showOn:"both",displayIndicator:!0,history:!0,strings:"Theme Colors,Standard Colors,More Colors,Less Colors,Back to Palette,History,No history yet."},_create:function(){iba=fba.browser.msie&&!jQuery.support.boxModel,jba=iba?"-ie":"",this._paletteIdx=1,this._id="evo-cp"+hba++,this._enabled=!0;var e,t,i,a=this;"INPUT"===this.element.get(0).tagName?(e=this.options.color,t=this.element,this._isPopup=!0,(this._palette=null)!=e?t.val(e):""!=(i=t.val())&&(e=this.options.color=i),t.addClass("colorPicker "+this._id).wrap('<div style="width:'+(this.element.width()+32)+"px;"+(iba?"margin-bottom:-21px;":"")+(fba.browser.mozilla?"padding:1px 0;":"")+'"></div>').after('<div class="evo-colorind'+(fba.browser.mozilla?"-ff":jba)+'" '+(null!=e?'style="background-color:'+e+'"':"")+"></div>").on("keyup onpaste",function(e){var t=fba(this).val();t!=a.options.color&&a._setValue(t,!0)}),"both"!=(i=this.options.showOn)&&"focus"!=i||t.on("focus",function(){a.showPalette()}),"both"!=i&&"button"!=i||t.next().on("click",function(e){e.stopPropagation(),a.showPalette()})):(this._isPopup=!1,this._palette=this.element.html(this._paletteHTML()).attr("aria-haspopup","true"),this._bindColors()),null!=e&&this.options.history&&this._add2History(e)},_paletteHTML:function(){var e=[],t=this._paletteIdx=Math.abs(this._paletteIdx),i=this.options,a=i.strings.split(",");return e.push('<div class="evo-pop',jba,' ui-widget ui-widget-content ui-corner-all"',this._isPopup?' style="position:absolute"':"",">"),e.push("<span>",this["_paletteHTML"+t](),"</span>"),e.push('<div class="evo-more"><a href="javascript:void(0)">',a[1+t],"</a>"),i.history&&e.push('<a href="javascript:void(0)" class="evo-hist">',a[5],"</a>"),e.push("</div>"),i.displayIndicator&&e.push(this._colorIndHTML(this.options.color,"left"),this._colorIndHTML("","right")),e.push("</div>"),e.join("")},_colorIndHTML:function(e,t){var i=[];return i.push('<div class="evo-color" style="float:left"><div style="'),i.push(e?"background-color:"+e:"display:none"),iba?i.push('" class="evo-colorbox-ie"></div><span class=".evo-colortxt-ie" '):i.push('"></div><span '),i.push(e?">"+e+"</span>":"/>"),i.push("</div>"),i.join("")},_paletteHTML1:function(){var e=[],t=this.options.strings.split(","),i='<td style="background-color:#',a=iba?'"><div style="width:2px;"></div></td>':'"><span/></td>',n='<tr><th colspan="10" class="ui-widget-content">';e.push('<table class="evo-palette',jba,'">',n,t[0],"</th></tr><tr>");for(var o=0;o<10;o++)e.push(i,lba[o],a);e.push("</tr>"),iba||e.push('<tr><th colspan="10"></th></tr>'),e.push('<tr class="top">');for(o=0;o<10;o++)e.push(i,mba[o],a);for(var r=1;r<4;r++){e.push('</tr><tr class="in">');for(o=0;o<10;o++)e.push(i,mba[10*r+o],a)}e.push('</tr><tr class="bottom">');for(o=40;o<50;o++)e.push(i,mba[o],a);e.push("</tr>",n,t[1],"</th></tr><tr>");for(o=0;o<10;o++)e.push(i,nba[o],a);return e.push("</tr></table>"),e.join("")},_paletteHTML2:function(){var e=[],t='<td style="background-color:#',i=iba?'"><div style="width:5px;"></div></td>':'"><span/></td>',a='<table class="evo-palette2'+jba+'"><tr>',n="</tr></table>";e.push('<div class="evo-palcenter">');for(var o=0,r=oba.length;o<r;o++){e.push(a);for(var s=oba[o],l=0,d=s.length;l<d;l++)e.push(t,s[l],i);e.push(n)}e.push('<div class="evo-sep"/>');var c=[];e.push(a);for(l=255;10<l;l-=10)e.push(t,rba(l),i),c.push(t,rba(l-=10),i);return e.push(n,a,c.join(""),n),e.push("</div>"),e.join("")},_switchPalette:function(e){if(this._enabled){var t=this.options.strings.split(",");if(fba(e).hasClass("evo-hist")){var i=['<table class="evo-palette"><tr><th class="ui-widget-content">',t[5],"</th></tr></tr></table>",'<div class="evo-cHist">'];if(0==kba.length)i.push("<p>",t[6],"</p>");else for(var a=kba.length-1;-1<a;a--)i.push('<div style="background-color:',kba[a],'"></div>');i.push("</div>");var n=-this._paletteIdx,o=i.join(""),r=t[4]}else{this._paletteIdx<0?(n=-this._paletteIdx,this._palette.find(".evo-hist").show()):n=2==this._paletteIdx?1:2;o=this["_paletteHTML"+n](),r=t[n+1];this._paletteIdx=n}this._paletteIdx=n;r=this._palette.find(".evo-more").prev().html(o).end().children().eq(0).html(r);n<0&&r.next().hide()}},showPalette:function(){var t,e;return this._enabled&&((e=fba(".colorPicker").not("."+this._id).colorpicker).hidePalette&&e("hidePalette"),null==this._palette&&(this._palette=this.element.next().after(this._paletteHTML()).next().on("click",function(e){e.stopPropagation()}),this._bindColors(),t=this,fba(document.body).on("click."+this._id,function(e){e.target!=t.element.get(0)&&t.hidePalette()}))),this},hidePalette:function(){var e;return this._isPopup&&this._palette&&(fba(document.body).off("click."+this._id),(e=this)._palette.off("mouseover click","td").fadeOut(function(){e._palette.remove(),e._palette=e._cTxt=null}).find(".evo-more a").off("click")),this},_bindColors:function(){var e=this._palette.find("div.evo-color"),t=this.options.history?"td,.evo-cHist div":"td";this._cTxt1=e.eq(0).children().eq(0),this._cTxt2=e.eq(1).children().eq(0);var i=this;this._palette.on("click",t,function(e){var t;i._enabled&&(t=sba(fba(this).attr("style").substring(17)),i._setValue(t))}).on("mouseover",t,function(e){var t;i._enabled&&(t=sba(fba(this).attr("style").substring(17)),i.options.displayIndicator&&i._setColorInd(t,2),i.element.trigger("mouseover.color",t))}).find(".evo-more a").on("click",function(){i._switchPalette(this)})},val:function(e){return void 0===e?this.options.color:(this._setValue(e),this)},_setValue:function(e,t){this.options.color=e,this._isPopup?(t||this.hidePalette(),this.element.val(e).next().attr("style","background-color:"+e)):this._setColorInd(e,1),this.options.history&&0<this._paletteIdx&&this._add2History(e),this.element.trigger("change.color",e)},_setColorInd:function(e,t){this["_cTxt"+t].attr("style","background-color:"+e).next().html(e)},_setOption:function(e,t){"color"==e?this._setValue(t,!0):this.options[e]=t},_add2History:function(e){for(var t=kba.length,i=0;i<t;i++)if(e==kba[i])return;27<t&&kba.shift(),kba.push(e)},enable:function(){var e=this.element;return this._isPopup?e.removeAttr("disabled"):e.css({opacity:"1","pointer-events":"auto"}),e.removeAttr("aria-disabled"),this._enabled=!0,this},disable:function(){var e=this.element;return this._isPopup?e.attr("disabled","disabled"):(this.hidePalette(),e.css({opacity:"0.3","pointer-events":"none"})),e.attr("aria-disabled","true"),this._enabled=!1,this},isDisabled:function(){return!this._enabled},destroy:function(){fba(document.body).off("click."+this._id),this._palette&&(this._palette.off("mouseover click","td").find(".evo-more a").off("click"),this._isPopup&&this._palette.remove(),this._palette=this._cTxt=null),this._isPopup&&this.element.next().off("click").remove().end().off("focus").unwrap(),this.element.removeClass("colorPicker "+this.id).empty(),fba.Widget.prototype.destroy.call(this)}}),N1a=jQuery,O1a=this,N1a.fn.jScrollPane=function(i){function a(C,e){var v,x,w,P,b,A,I,T,B,k,S,M,F,$,L,N,O,V,R,t,_,E,z,H,Y,W,U,K,j,Z,G,q,X,Q,J=this,o=!0,r=!0,s=!1,l=!1,i=C.clone(!1,!1).empty(),ee=N1a.fn.mwheelIntent?"mwheelIntent.jsp":"mousewheel.jsp";function te(e){var t,i,a,n,o,r,s,l,d,c,h,p,u,m,g,f=!1,y=!1;if(v=e,x===P1a)a=C.scrollTop(),n=C.scrollLeft(),C.css({overflow:"hidden",padding:0}),w=C.innerWidth()+X,P=C.innerHeight(),C.width(w),x=N1a('<div class="jspPane" />').css("padding",q).append(C.children()),b=N1a('<div class="jspContainer" />').css({width:w+"px",height:P+"px"}).append(x).appendTo(C);else{if(C.css("width",""),f=v.stickToBottom&&(20<(r=I-P)&&r-fe()<10),y=v.stickToRight&&(20<(o=A-w)&&o-ge()<10),(o=C.innerWidth()+X!=w||C.outerHeight()!=P)&&(w=C.innerWidth()+X,P=C.innerHeight(),b.css({width:w+"px",height:P+"px"})),!o&&Q==A&&x.outerHeight()==I)return void C.width(w);Q=A,x.css("width",""),C.width(w),b.find(">.jspVerticalBar,>.jspHorizontalBar").remove().end()}function D(){var e=O,t=$;switch(s){case 40:J.scrollByY(v.keyboardSpeed,!1);break;case 38:J.scrollByY(-v.keyboardSpeed,!1);break;case 34:case 32:J.scrollByY(P*v.scrollPagePercent,!1);break;case 33:J.scrollByY(-P*v.scrollPagePercent,!1);break;case 39:J.scrollByX(v.keyboardSpeed,!1);break;case 37:J.scrollByX(-v.keyboardSpeed,!1)}return l=e!=O||t!=$}x.css("overflow","auto"),A=e.contentWidth||x[0].scrollWidth,I=x[0].scrollHeight,x.css("overflow",""),k=1<(B=I/P),(S=1<(T=A/w))||k?(C.addClass("jspScrollable"),(e=v.maintainPosition&&($||O))&&(t=ge(),i=fe()),k&&(b.append(N1a('<div class="jspVerticalBar" />').append(N1a('<div class="jspCap jspCapTop" />'),N1a('<div class="jspTrack" />').append(N1a('<div class="jspDrag" />').append(N1a('<div class="jspDragTop" />'),N1a('<div class="jspDragBottom" />'))),N1a('<div class="jspCap jspCapBottom" />'))),V=b.find(">.jspVerticalBar"),R=V.find(">.jspTrack"),M=R.find(">.jspDrag"),v.showArrows&&(z=N1a('<a class="jspArrow jspArrowUp" />').bind("mousedown.jsp",oe(0,-1)).bind("click.jsp",ye),H=N1a('<a class="jspArrow jspArrowDown" />').bind("mousedown.jsp",oe(0,1)).bind("click.jsp",ye),v.arrowScrollOnHover&&(z.bind("mouseover.jsp",oe(0,-1,z)),H.bind("mouseover.jsp",oe(0,1,H))),ne(R,v.verticalArrowPositions,z,H)),_=P,b.find(">.jspVerticalBar>.jspCap:visible,>.jspVerticalBar>.jspArrow").each(function(){_-=N1a(this).outerHeight()}),M.hover(function(){M.addClass("jspHover")},function(){M.removeClass("jspHover")}).bind("mousedown.jsp",function(e){N1a("html").bind("dragstart.jsp selectstart.jsp",ye),M.addClass("jspActive");var t=e.pageY-M.position().top;return N1a("html").bind("mousemove.jsp",function(e){le(e.pageY-t,!1)}).bind("mouseup.jsp mouseleave.jsp",se),!1}),ie()),S&&(b.append(N1a('<div class="jspHorizontalBar" />').append(N1a('<div class="jspCap jspCapLeft" />'),N1a('<div class="jspTrack" />').append(N1a('<div class="jspDrag" />').append(N1a('<div class="jspDragLeft" />'),N1a('<div class="jspDragRight" />'))),N1a('<div class="jspCap jspCapRight" />'))),Y=b.find(">.jspHorizontalBar"),W=Y.find(">.jspTrack"),L=W.find(">.jspDrag"),v.showArrows&&(j=N1a('<a class="jspArrow jspArrowLeft" />').bind("mousedown.jsp",oe(-1,0)).bind("click.jsp",ye),Z=N1a('<a class="jspArrow jspArrowRight" />').bind("mousedown.jsp",oe(1,0)).bind("click.jsp",ye),v.arrowScrollOnHover&&(j.bind("mouseover.jsp",oe(-1,0,j)),Z.bind("mouseover.jsp",oe(1,0,Z))),ne(W,v.horizontalArrowPositions,j,Z)),L.hover(function(){L.addClass("jspHover")},function(){L.removeClass("jspHover")}).bind("mousedown.jsp",function(e){N1a("html").bind("dragstart.jsp selectstart.jsp",ye),L.addClass("jspActive");var t=e.pageX-L.position().left;return N1a("html").bind("mousemove.jsp",function(e){ce(e.pageX-t,!1)}).bind("mouseup.jsp mouseleave.jsp",se),!1}),U=b.innerWidth(),ae()),function(){{var e,t;S&&k&&(e=W.outerHeight(),t=R.outerWidth(),_-=e,N1a(Y).find(">.jspCap:visible,>.jspArrow").each(function(){U+=N1a(this).outerWidth()}),U-=t,P-=t,w-=e,W.parent().append(N1a('<div class="jspCorner" />').css("width",e+"px")),ie(),ae())}S&&x.width(b.outerWidth()-X+"px");I=x.outerHeight(),B=I/P,S&&((K=Math.ceil(1/T*U))>v.horizontalDragMaxWidth?K=v.horizontalDragMaxWidth:K<v.horizontalDragMinWidth&&(K=v.horizontalDragMinWidth),L.width(K+"px"),N=U-K,he(O));k&&((E=Math.ceil(1/B*_))>v.verticalDragMaxHeight?E=v.verticalDragMaxHeight:E<v.verticalDragMinHeight&&(E=v.verticalDragMinHeight),M.height(E+"px"),F=_-E,de($))}(),e&&(ue(y?A-w:t,!1),pe(f?I-P:i,!1)),x.find(":input,a").unbind("focus.jsp").bind("focus.jsp",function(e){me(e.target,!1)}),b.unbind(ee).bind(ee,function(e,t,i,a){var n=O,o=$;return J.scrollBy(i*v.mouseWheelSpeed,-a*v.mouseWheelSpeed,!1),n==O&&o==$}),g=!1,b.unbind("touchstart.jsp touchmove.jsp touchend.jsp click.jsp-touchclick").bind("touchstart.jsp",function(e){e=e.originalEvent.touches[0];c=ge(),h=fe(),p=e.pageX,u=e.pageY,g=!(m=!1)}).bind("touchmove.jsp",function(e){if(g){var t=e.originalEvent.touches[0],i=O,e=$;return J.scrollTo(c+p-t.pageX,h+u-t.pageY),m=m||5<Math.abs(p-t.pageX)||5<Math.abs(u-t.pageY),i==O&&e==$}}).bind("touchend.jsp",function(e){g=!1}).bind("click.jsp-touchclick",function(e){if(m)return m=!1}),v.enableKeyboardNavigation&&(d=[],S&&d.push(Y[0]),k&&d.push(V[0]),x.focus(function(){C.focus()}),C.attr("tabindex",0).unbind("keydown.jsp keypress.jsp").bind("keydown.jsp",function(e){if(e.target===this||d.length&&N1a(e.target).closest(d).length){var t=O,i=$;switch(e.keyCode){case 40:case 38:case 34:case 32:case 33:case 39:case 37:s=e.keyCode,D();break;case 35:pe(I-P),s=null;break;case 36:pe(0),s=null}return!(l=e.keyCode==s&&t!=O||i!=$)}}).bind("keypress.jsp",function(e){return e.keyCode==s&&D(),!l}),v.hideFocus?(C.css("outline","none"),"hideFocus"in b[0]&&C.attr("hideFocus",!0)):(C.css("outline",""),"hideFocus"in b[0]&&C.attr("hideFocus",!1))),v.clickOnTrack&&function(){re(),k&&R.bind("mousedown.jsp",function(a){if(a.originalTarget===P1a||a.originalTarget==a.currentTarget){var n,o=N1a(this),e=o.offset(),r=a.pageY-e.top-$,s=!0,l=function(){var e=o.offset(),t=a.pageY-e.top-E/2,i=P*v.scrollPagePercent,e=F*i/(I-P);if(r<0)t<$-e?J.scrollByY(-i):le(t);else{if(!(0<r))return void d();$+e<t?J.scrollByY(i):le(t)}n=setTimeout(l,s?v.initialDelay:v.trackClickRepeatFreq),s=!1},d=function(){n&&clearTimeout(n),n=null,N1a(document).unbind("mouseup.jsp",d)};return l(),N1a(document).bind("mouseup.jsp",d),!1}});S&&W.bind("mousedown.jsp",function(a){if(a.originalTarget===P1a||a.originalTarget==a.currentTarget){var n,o=N1a(this),e=o.offset(),r=a.pageX-e.left-O,s=!0,l=function(){var e=o.offset(),t=a.pageX-e.left-K/2,i=w*v.scrollPagePercent,e=N*i/(A-w);if(r<0)t<O-e?J.scrollByX(-i):ce(t);else{if(!(0<r))return void d();O+e<t?J.scrollByX(i):ce(t)}n=setTimeout(l,s?v.initialDelay:v.trackClickRepeatFreq),s=!1},d=function(){n&&clearTimeout(n),n=null,N1a(document).unbind("mouseup.jsp",d)};return l(),N1a(document).bind("mouseup.jsp",d),!1}})}(),function(){if(location.hash&&1<location.hash.length){var e,t,i=escape(location.hash.substr(1));try{e=N1a("#"+i+', a[name="'+i+'"]')}catch(e){return}e.length&&x.find(i)&&(0===b.scrollTop()?t=setInterval(function(){0<b.scrollTop()&&(me(e,!0),N1a(document).scrollTop(b.position().top),clearInterval(t))},50):(me(e,!0),N1a(document).scrollTop(b.position().top)))}}(),v.hijackInternalLinks&&(N1a(document.body).data("jspHijack")||(N1a(document.body).data("jspHijack",!0),N1a(document.body).delegate("a[href*=#]","click",function(e){var t,i=this.href.substr(0,this.href.indexOf("#")),a=location.href;if(i===(a=-1!==location.href.indexOf("#")?location.href.substr(0,location.href.indexOf("#")):a)){i=escape(this.href.substr(this.href.indexOf("#")+1));try{t=N1a("#"+i+', a[name="'+i+'"]')}catch(e){return}t.length&&((a=t.closest(".jspScrollable")).data("jsp").scrollToElement(t,!0),a[0].scrollIntoView&&(i=N1a(O1a).scrollTop(),((t=t.offset().top)<i||t>i+N1a(O1a).height())&&a[0].scrollIntoView()),e.preventDefault())}})))):(C.removeClass("jspScrollable"),x.css({top:0,width:b.width()-X}),b.unbind(ee),x.find(":input,a").unbind("focus.jsp"),C.attr("tabindex","-1").removeAttr("tabindex").unbind("keydown.jsp keypress.jsp"),re()),v.autoReinitialise&&!G?G=setInterval(function(){te(v)},v.autoReinitialiseDelay):!v.autoReinitialise&&G&&clearInterval(G),a&&C.scrollTop(0)&&pe(a,!1),n&&C.scrollLeft(0)&&ue(n,!1),C.trigger("jsp-initialised",[S||k])}function ie(){R.height(_+"px"),$=0,t=v.verticalGutter+R.outerWidth(),x.width(w-t-X);try{0===V.position().left&&x.css("margin-left",t+"px")}catch(e){}}function ae(){b.find(">.jspHorizontalBar>.jspCap:visible,>.jspHorizontalBar>.jspArrow").each(function(){U-=N1a(this).outerWidth()}),W.width(U+"px"),O=0}function ne(e,t,i,a){var n="before",o="after";(t="os"==t?/Mac/.test(navigator.platform)?"after":"split":t)==n?o=t:t==o&&(n=t,t=i,i=a,a=t),e[n](i)[o](a)}function oe(e,t,i){return function(){return function(e,t,i,a){i=N1a(i).addClass("jspActive");var n,o,r=!0,s=function(){0!==e&&J.scrollByX(e*v.arrowButtonSpeed),0!==t&&J.scrollByY(t*v.arrowButtonSpeed),o=setTimeout(s,r?v.initialDelay:v.arrowRepeatFreq),r=!1};s(),n=a?"mouseout.jsp":"mouseup.jsp",(a=a||N1a("html")).bind(n,function(){i.removeClass("jspActive"),o&&clearTimeout(o),o=null,a.unbind(n)})}(e,t,this,i),this.blur(),!1}}function re(){W&&W.unbind("mousedown.jsp"),R&&R.unbind("mousedown.jsp")}function se(){N1a("html").unbind("dragstart.jsp selectstart.jsp mousemove.jsp mouseup.jsp mouseleave.jsp"),M&&M.removeClass("jspActive"),L&&L.removeClass("jspActive")}function le(e,t){k&&(e<0?e=0:F<e&&(e=F),(t=t===P1a?v.animateScroll:t)?J.animate(M,"top",e,de):(M.css("top",e),de(e)))}function de(e){e===P1a&&(e=M.position().top),b.scrollTop(0);var t,i=0===($=e),a=$==F,n=-(e/F)*(I-P);o==i&&s==a||(o=i,s=a,C.trigger("jsp-arrow-change",[o,s,r,l])),t=i,e=a,v.showArrows&&(z[t?"addClass":"removeClass"]("jspDisabled"),H[e?"addClass":"removeClass"]("jspDisabled")),x.css("top",n),C.trigger("jsp-scroll-y",[-n,i,a]).trigger("scroll")}function ce(e,t){S&&(e<0?e=0:N<e&&(e=N),(t=t===P1a?v.animateScroll:t)?J.animate(L,"left",e,he):(L.css("left",e),he(e)))}function he(e){e===P1a&&(e=L.position().left),b.scrollTop(0);var t,i=0===(O=e),a=O==N,n=-(e/N)*(A-w);r==i&&l==a||(r=i,l=a,C.trigger("jsp-arrow-change",[o,s,r,l])),t=i,e=a,v.showArrows&&(j[t?"addClass":"removeClass"]("jspDisabled"),Z[e?"addClass":"removeClass"]("jspDisabled")),x.css("left",n),C.trigger("jsp-scroll-x",[-n,i,a]).trigger("scroll")}function pe(e,t){le(e/(I-P)*F,t)}function ue(e,t){ce(e/(A-w)*N,t)}function me(e,t,i){var a,n,o,r,s,l,d=0,c=0;try{a=N1a(e)}catch(e){return}for(r=a.outerHeight(),n=a.outerWidth(),b.scrollTop(0),b.scrollLeft(0);!a.is(".jspPane");)if(d+=a.position().top,c+=a.position().left,a=a.offsetParent(),/^body|html$/i.test(a[0].nodeName))return;e=(o=fe())+P,d<o||t?s=d-v.verticalGutter:e<d+r&&(s=d-P+r+v.verticalGutter),s&&pe(s,i),s=(r=ge())+w,c<r||t?l=c-v.horizontalGutter:s<c+n&&(l=c-w+n+v.horizontalGutter),l&&ue(l,i)}function ge(){return-x.position().left}function fe(){return-x.position().top}function ye(){return!1}q=C.css("paddingTop")+" "+C.css("paddingRight")+" "+C.css("paddingBottom")+" "+C.css("paddingLeft"),X=(parseInt(C.css("paddingLeft"),10)||0)+(parseInt(C.css("paddingRight"),10)||0),N1a.extend(J,{reinitialise:function(e){te(e=N1a.extend({},v,e))},scrollToElement:function(e,t,i){me(e,t,i)},scrollTo:function(e,t,i){ue(e,i),pe(t,i)},scrollToX:function(e,t){ue(e,t)},scrollToY:function(e,t){pe(e,t)},scrollToPercentX:function(e,t){ue(e*(A-w),t)},scrollToPercentY:function(e,t){pe(e*(I-P),t)},scrollBy:function(e,t,i){J.scrollByX(e,i),J.scrollByY(t,i)},scrollByX:function(e,t){ce((ge()+Math[e<0?"floor":"ceil"](e))/(A-w)*N,t)},scrollByY:function(e,t){le((fe()+Math[e<0?"floor":"ceil"](e))/(I-P)*F,t)},positionDragX:function(e,t){ce(e,t)},positionDragY:function(e,t){le(e,t)},animate:function(e,t,i,a){var n={};n[t]=i,e.animate(n,{duration:v.animateDuration,easing:v.animateEase,queue:!1,step:a})},getContentPositionX:ge,getContentPositionY:fe,getContentWidth:function(){return A},getContentHeight:function(){return I},getPercentScrolledX:function(){return ge()/(A-w)},getPercentScrolledY:function(){return fe()/(I-P)},getIsScrollableH:function(){return S},getIsScrollableV:function(){return k},getContentPane:function(){return x},scrollToBottom:function(e){le(F,e)},hijackInternalLinks:N1a.noop,destroy:function(){var e,t;e=fe(),t=ge(),C.removeClass("jspScrollable").unbind(".jsp"),C.replaceWith(i.append(x.children())),i.scrollTop(e),i.scrollLeft(t),G&&clearInterval(G)}}),te(e)}return i=N1a.extend({},N1a.fn.jScrollPane.defaults,i),N1a.each(["arrowButtonSpeed","trackClickSpeed","keyboardSpeed"],function(){i[this]=i[this]||i.speed}),this.each(function(){var e=N1a(this),t=e.data("jsp");t?t.reinitialise(i):(N1a("script",e).filter('[type="text/javascript"],:not([type])').remove(),t=new a(e,i),e.data("jsp",t))})},N1a.fn.jScrollPane.defaults={showArrows:!1,maintainPosition:!0,stickToBottom:!1,stickToRight:!1,clickOnTrack:!0,autoReinitialise:!1,autoReinitialiseDelay:500,verticalDragMinHeight:0,verticalDragMaxHeight:99999,horizontalDragMinWidth:0,horizontalDragMaxWidth:99999,contentWidth:P1a,animateScroll:!1,animateDuration:300,animateEase:"linear",hijackInternalLinks:!1,verticalGutter:4,horizontalGutter:4,mouseWheelSpeed:3,arrowButtonSpeed:0,arrowRepeatFreq:50,arrowScrollOnHover:!1,trackClickSpeed:0,trackClickRepeatFreq:70,verticalArrowPositions:"split",horizontalArrowPositions:"split",enableKeyboardNavigation:!0,hideFocus:!1,keyboardSpeed:0,initialDelay:300,speed:30,scrollPagePercent:.8},eval(decodeURIComponent("%2F*%0A%20%20html2canvas%200.4.1%20%3Chttp%3A%2F%2Fhtml2canvas.hertzen.com%3E%0A%20%20Copyright%20(c)%202013%20Niklas%20von%20Hertzen%0A%0A%20%20Released%20under%20MIT%20License%0A*%2F%0A(function(t%2Ce%2Cn)%7B%22use%20strict%22%3Bfunction%20r(t%2Ce%2Cn)%7Bvar%20r%2Ca%3Dt.runtimeStyle%26%26t.runtimeStyle%5Be%5D%2Co%3Dt.style%3Breturn!%2F%5E-%3F%5B0-9%5D%2B%5C.%3F%5B0-9%5D*(%3F%3Apx)%3F%24%2Fi.test(n)%26%26%2F%5E-%3F%5Cd%2F.test(n)%26%26(r%3Do.left%2Ca%26%26(t.runtimeStyle.left%3Dt.currentStyle.left)%2Co.left%3D%22fontSize%22%3D%3D%3De%3F%221em%22%3An%7C%7C0%2Cn%3Do.pixelLeft%2B%22px%22%2Co.left%3Dr%2Ca%26%26(t.runtimeStyle.left%3Da))%2C%2F%5E(thin%7Cmedium%7Cthick)%24%2Fi.test(n)%3Fn%3AMath.round(parseFloat(n))%2B%22px%22%7Dfunction%20a(t)%7Breturn%20parseInt(t%2C10)%7Dfunction%20o(t)%7Breturn-1!%3D%3D(%22%22%2Bt).indexOf(%22%25%22)%7Dfunction%20i(t%2Ce%2Ca%2Co)%7Bif(t%3D(t%7C%7C%22%22).split(%22%2C%22)%2Ct%3Dt%5Bo%7C%7C0%5D%7C%7Ct%5B0%5D%7C%7C%22auto%22%2Ct%3Dd.Util.trimText(t).split(%22%20%22)%2C%22backgroundSize%22%3D%3D%3Da%26%26t%5B0%5D%26%26t%5B0%5D.match(%2F%5E(cover%7Ccontain%7Cauto)%24%2F))return%20t%3Bif(t%5B0%5D%3D-1%3D%3D%3Dt%5B0%5D.indexOf(%22%25%22)%3Fr(e%2Ca%2B%22X%22%2Ct%5B0%5D)%3At%5B0%5D%2Ct%5B1%5D%3D%3D%3Dn)%7Bif(%22backgroundSize%22%3D%3D%3Da)return%20t%5B1%5D%3D%22auto%22%2Ct%3Bt%5B1%5D%3Dt%5B0%5D%7Dreturn%20t%5B1%5D%3D-1%3D%3D%3Dt%5B1%5D.indexOf(%22%25%22)%3Fr(e%2Ca%2B%22Y%22%2Ct%5B1%5D)%3At%5B1%5D%2Ct%7Dfunction%20l(t%2Ce)%7Bvar%20n%3D%5B%5D%3Breturn%7Bstorage%3An%2Cwidth%3At%2Cheight%3Ae%2Cclip%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22clip%22%2Carguments%3Aarguments%7D)%7D%2Ctranslate%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22translate%22%2Carguments%3Aarguments%7D)%7D%2Cfill%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22fill%22%2Carguments%3Aarguments%7D)%7D%2Csave%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22save%22%2Carguments%3Aarguments%7D)%7D%2Crestore%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22restore%22%2Carguments%3Aarguments%7D)%7D%2CfillRect%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22fillRect%22%2Carguments%3Aarguments%7D)%7D%2CcreatePattern%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22createPattern%22%2Carguments%3Aarguments%7D)%7D%2CdrawShape%3Afunction()%7Bvar%20t%3D%5B%5D%3Breturn%20n.push(%7Btype%3A%22function%22%2Cname%3A%22drawShape%22%2Carguments%3At%7D)%2C%7BmoveTo%3Afunction()%7Bt.push(%7Bname%3A%22moveTo%22%2Carguments%3Aarguments%7D)%7D%2ClineTo%3Afunction()%7Bt.push(%7Bname%3A%22lineTo%22%2Carguments%3Aarguments%7D)%7D%2CarcTo%3Afunction()%7Bt.push(%7Bname%3A%22arcTo%22%2Carguments%3Aarguments%7D)%7D%2CbezierCurveTo%3Afunction()%7Bt.push(%7Bname%3A%22bezierCurveTo%22%2Carguments%3Aarguments%7D)%7D%2CquadraticCurveTo%3Afunction()%7Bt.push(%7Bname%3A%22quadraticCurveTo%22%2Carguments%3Aarguments%7D)%7D%7D%7D%2CdrawImage%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22drawImage%22%2Carguments%3Aarguments%7D)%7D%2CfillText%3Afunction()%7Bn.push(%7Btype%3A%22function%22%2Cname%3A%22fillText%22%2Carguments%3Aarguments%7D)%7D%2CsetVariable%3Afunction(t%2Ce)%7Breturn%20n.push(%7Btype%3A%22variable%22%2Cname%3At%2Carguments%3Ae%7D)%2Ce%7D%7D%7Dvar%20s%2Cc%2Cd%3D%7B%7D%3Bd.Util%3D%7B%7D%2Cd.Util.log%3Dfunction(e)%7Bd.logging%26%26t.console%26%26t.console.log%26%26t.console.log(e)%7D%2Cd.Util.trimText%3Dfunction(t)%7Breturn%20function(e)%7Breturn%20t%3Ft.apply(e)%3A((e%7C%7C%22%22)%2B%22%22).replace(%2F%5E%5Cs%2B%7C%5Cs%2B%24%2Fg%2C%22%22)%7D%7D(String.prototype.trim)%2Cd.Util.asFloat%3Dfunction(t)%7Breturn%20parseFloat(t)%7D%2Cfunction()%7Bvar%20t%3D%2F((rgba%7Crgb)%5C(%5B%5E%5C)%5D%2B%5C)(%5Cs-%3F%5Cd%2Bpx)%7B0%2C%7D)%2Fg%2Ce%3D%2F(-%3F%5Cd%2Bpx)%7C(%23.%2B)%7C(rgb%5C(.%2B%5C))%7C(rgba%5C(.%2B%5C))%2Fg%3Bd.Util.parseTextShadows%3Dfunction(n)%7Bif(!n%7C%7C%22none%22%3D%3D%3Dn)return%5B%5D%3Bfor(var%20r%3Dn.match(t)%2Ca%3D%5B%5D%2Co%3D0%3Br%26%26r.length%3Eo%3Bo%2B%2B)%7Bvar%20i%3Dr%5Bo%5D.match(e)%3Ba.push(%7Bcolor%3Ai%5B0%5D%2CoffsetX%3Ai%5B1%5D%3Fi%5B1%5D.replace(%22px%22%2C%22%22)%3A0%2CoffsetY%3Ai%5B2%5D%3Fi%5B2%5D.replace(%22px%22%2C%22%22)%3A0%2Cblur%3Ai%5B3%5D%3Fi%5B3%5D.replace(%22px%22%2C%22%22)%3A0%7D)%7Dreturn%20a%7D%7D()%2Cd.Util.parseBackgroundImage%3Dfunction(t)%7Bvar%20e%2Cn%2Cr%2Ca%2Co%2Ci%2Cl%2Cs%2Cc%3D%22%20%5Cr%5Cn%09%22%2Cd%3D%5B%5D%2Ch%3D0%2Cu%3D0%2Cf%3Dfunction()%7Be%26%26(%27%22%27%3D%3D%3Dn.substr(0%2C1)%26%26(n%3Dn.substr(1%2Cn.length-2))%2Cn%26%26s.push(n)%2C%22-%22%3D%3D%3De.substr(0%2C1)%26%26(a%3De.indexOf(%22-%22%2C1)%2B1)%3E0%26%26(r%3De.substr(0%2Ca)%2Ce%3De.substr(a))%2Cd.push(%7Bprefix%3Ar%2Cmethod%3Ae.toLowerCase()%2Cvalue%3Ao%2Cargs%3As%7D))%2Cs%3D%5B%5D%2Ce%3Dr%3Dn%3Do%3D%22%22%7D%3Bf()%3Bfor(var%20p%3D0%2Cg%3Dt.length%3Bg%3Ep%3Bp%2B%2B)if(i%3Dt%5Bp%5D%2C!(0%3D%3D%3Dh%26%26c.indexOf(i)%3E-1))%7Bswitch(i)%7Bcase%27%22%27%3Al%3Fl%3D%3D%3Di%26%26(l%3Dnull)%3Al%3Di%3Bbreak%3Bcase%22(%22%3Aif(l)break%3Bif(0%3D%3D%3Dh)%7Bh%3D1%2Co%2B%3Di%3Bcontinue%7Du%2B%2B%3Bbreak%3Bcase%22)%22%3Aif(l)break%3Bif(1%3D%3D%3Dh)%7Bif(0%3D%3D%3Du)%7Bh%3D0%2Co%2B%3Di%2Cf()%3Bcontinue%7Du--%7Dbreak%3Bcase%22%2C%22%3Aif(l)break%3Bif(0%3D%3D%3Dh)%7Bf()%3Bcontinue%7Dif(1%3D%3D%3Dh%26%260%3D%3D%3Du%26%26!e.match(%2F%5Eurl%24%2Fi))%7Bs.push(n)%2Cn%3D%22%22%2Co%2B%3Di%3Bcontinue%7D%7Do%2B%3Di%2C0%3D%3D%3Dh%3Fe%2B%3Di%3An%2B%3Di%7Dreturn%20f()%2Cd%7D%2Cd.Util.Bounds%3Dfunction(t)%7Bvar%20e%2Cn%3D%7B%7D%3Breturn%20t.getBoundingClientRect%26%26(e%3Dt.getBoundingClientRect()%2Cn.top%3De.top%2Cn.bottom%3De.bottom%7C%7Ce.top%2Be.height%2Cn.left%3De.left%2Cn.width%3Dt.offsetWidth%2Cn.height%3Dt.offsetHeight)%2Cn%7D%2Cd.Util.OffsetBounds%3Dfunction(t)%7Bvar%20e%3Dt.offsetParent%3Fd.Util.OffsetBounds(t.offsetParent)%3A%7Btop%3A0%2Cleft%3A0%7D%3Breturn%7Btop%3At.offsetTop%2Be.top%2Cbottom%3At.offsetTop%2Bt.offsetHeight%2Be.top%2Cleft%3At.offsetLeft%2Be.left%2Cwidth%3At.offsetWidth%2Cheight%3At.offsetHeight%7D%7D%2Cd.Util.getCSS%3Dfunction(t%2Cn%2Cr)%7Bs!%3D%3Dt%26%26(c%3De.defaultView.getComputedStyle(t%2Cnull))%3Bvar%20o%3Dc%5Bn%5D%3Bif(%2F%5Ebackground(Size%7CPosition)%24%2F.test(n))return%20i(o%2Ct%2Cn%2Cr)%3Bif(%2Fborder(Top%7CBottom)(Left%7CRight)Radius%2F.test(n))%7Bvar%20l%3Do.split(%22%20%22)%3Breturn%201%3E%3Dl.length%26%26(l%5B1%5D%3Dl%5B0%5D)%2Cl.map(a)%7Dreturn%20o%7D%2Cd.Util.resizeBounds%3Dfunction(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%2Ci%2Cl%3Dn%2Fr%2Cs%3Dt%2Fe%3Breturn%20a%26%26%22auto%22!%3D%3Da%3Fs%3El%5E%22contain%22%3D%3D%3Da%3F(i%3Dr%2Co%3Dr*s)%3A(o%3Dn%2Ci%3Dn%2Fs)%3A(o%3Dn%2Ci%3Dr)%2C%7Bwidth%3Ao%2Cheight%3Ai%7D%7D%2Cd.Util.BackgroundPosition%3Dfunction(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20i%2Cl%2Cs%3Dd.Util.getCSS(t%2C%22backgroundPosition%22%2Cr)%3Breturn%201%3D%3D%3Ds.length%26%26(s%3D%5Bs%5B0%5D%2Cs%5B0%5D%5D)%2Ci%3Do(s%5B0%5D)%3F(e.width-(a%7C%7Cn).width)*(parseFloat(s%5B0%5D)%2F100)%3AparseInt(s%5B0%5D%2C10)%2Cl%3D%22auto%22%3D%3D%3Ds%5B1%5D%3Fi%2Fn.width*n.height%3Ao(s%5B1%5D)%3F(e.height-(a%7C%7Cn).height)*parseFloat(s%5B1%5D)%2F100%3AparseInt(s%5B1%5D%2C10)%2C%22auto%22%3D%3D%3Ds%5B0%5D%26%26(i%3Dl%2Fn.height*n.width)%2C%7Bleft%3Ai%2Ctop%3Al%7D%7D%2Cd.Util.BackgroundSize%3Dfunction(t%2Ce%2Cn%2Cr)%7Bvar%20a%2Ci%2Cl%3Dd.Util.getCSS(t%2C%22backgroundSize%22%2Cr)%3Bif(1%3D%3D%3Dl.length%26%26(l%3D%5Bl%5B0%5D%2Cl%5B0%5D%5D)%2Co(l%5B0%5D))a%3De.width*parseFloat(l%5B0%5D)%2F100%3Belse%7Bif(%2Fcontain%7Ccover%2F.test(l%5B0%5D))return%20d.Util.resizeBounds(n.width%2Cn.height%2Ce.width%2Ce.height%2Cl%5B0%5D)%3Ba%3DparseInt(l%5B0%5D%2C10)%7Dreturn%20i%3D%22auto%22%3D%3D%3Dl%5B0%5D%26%26%22auto%22%3D%3D%3Dl%5B1%5D%3Fn.height%3A%22auto%22%3D%3D%3Dl%5B1%5D%3Fa%2Fn.width*n.height%3Ao(l%5B1%5D)%3Fe.height*parseFloat(l%5B1%5D)%2F100%3AparseInt(l%5B1%5D%2C10)%2C%22auto%22%3D%3D%3Dl%5B0%5D%26%26(a%3Di%2Fn.height*n.width)%2C%7Bwidth%3Aa%2Cheight%3Ai%7D%7D%2Cd.Util.BackgroundRepeat%3Dfunction(t%2Ce)%7Bvar%20n%3Dd.Util.getCSS(t%2C%22backgroundRepeat%22).split(%22%2C%22).map(d.Util.trimText)%3Breturn%20n%5Be%5D%7C%7Cn%5B0%5D%7D%2Cd.Util.Extend%3Dfunction(t%2Ce)%7Bfor(var%20n%20in%20t)t.hasOwnProperty(n)%26%26(e%5Bn%5D%3Dt%5Bn%5D)%3Breturn%20e%7D%2Cd.Util.Children%3Dfunction(t)%7Bvar%20e%3Btry%7Be%3Dt.nodeName%26%26%22IFRAME%22%3D%3D%3Dt.nodeName.toUpperCase()%3Ft.contentDocument%7C%7Ct.contentWindow.document%3Afunction(t)%7Bvar%20e%3D%5B%5D%3Breturn%20null!%3D%3Dt%26%26function(t%2Ce)%7Bvar%20r%3Dt.length%2Ca%3D0%3Bif(%22number%22%3D%3Dtypeof%20e.length)for(var%20o%3De.length%3Bo%3Ea%3Ba%2B%2B)t%5Br%2B%2B%5D%3De%5Ba%5D%3Belse%20for(%3Be%5Ba%5D!%3D%3Dn%3B)t%5Br%2B%2B%5D%3De%5Ba%2B%2B%5D%3Breturn%20t.length%3Dr%2Ct%7D(e%2Ct)%2Ce%7D(t.childNodes)%7Dcatch(r)%7Bd.Util.log(%22html2canvas.Util.Children%20failed%20with%20exception%3A%20%22%2Br.message)%2Ce%3D%5B%5D%7Dreturn%20e%7D%2Cd.Util.isTransparent%3Dfunction(t)%7Breturn!t%7C%7C%22transparent%22%3D%3D%3Dt%7C%7C%22rgba(0%2C%200%2C%200%2C%200)%22%3D%3D%3Dt%7D%2Cd.Util.Font%3Dfunction()%7Bvar%20t%3D%7B%7D%3Breturn%20function(e%2Cr%2Ca)%7Bif(t%5Be%2B%22-%22%2Br%5D!%3D%3Dn)return%20t%5Be%2B%22-%22%2Br%5D%3Bvar%20o%2Ci%2Cl%2Cs%3Da.createElement(%22div%22)%2Cc%3Da.createElement(%22img%22)%2Cd%3Da.createElement(%22span%22)%2Ch%3D%22Hidden%20Text%22%3Breturn%20s.style.visibility%3D%22hidden%22%2Cs.style.fontFamily%3De%2Cs.style.fontSize%3Dr%2Cs.style.margin%3D0%2Cs.style.padding%3D0%2Ca.body.appendChild(s)%2Cc.src%3D%22data%3Aimage%2Fgif%3Bbase64%2CR0lGODlhAQABAIABAP%2F%2F%2FwAAACwAAAAAAQABAAACAkQBADs%3D%22%2Cc.width%3D1%2Cc.height%3D1%2Cc.style.margin%3D0%2Cc.style.padding%3D0%2Cc.style.verticalAlign%3D%22baseline%22%2Cd.style.fontFamily%3De%2Cd.style.fontSize%3Dr%2Cd.style.margin%3D0%2Cd.style.padding%3D0%2Cd.appendChild(a.createTextNode(h))%2Cs.appendChild(d)%2Cs.appendChild(c)%2Co%3Dc.offsetTop-d.offsetTop%2B1%2Cs.removeChild(d)%2Cs.appendChild(a.createTextNode(h))%2Cs.style.lineHeight%3D%22normal%22%2Cc.style.verticalAlign%3D%22super%22%2Ci%3Dc.offsetTop-s.offsetTop%2B1%2Cl%3D%7Bbaseline%3Ao%2ClineWidth%3A1%2Cmiddle%3Ai%7D%2Ct%5Be%2B%22-%22%2Br%5D%3Dl%2Ca.body.removeChild(s)%2Cl%7D%7D()%2Cfunction()%7Bfunction%20t(t)%7Breturn%20function(e)%7Btry%7Bt.addColorStop(e.stop%2Ce.color)%7Dcatch(r)%7Bn.log(%5B%22failed%20to%20add%20color%20stop%3A%20%22%2Cr%2C%22%3B%20tried%20to%20add%3A%20%22%2Ce%5D)%7D%7D%7Dvar%20n%3Dd.Util%2Cr%3D%7B%7D%3Bd.Generate%3Dr%3Bvar%20a%3D%5B%2F%5E(-webkit-linear-gradient)%5C((%5Ba-z%5Cs%5D%2B)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-o-linear-gradient)%5C((%5Ba-z%5Cs%5D%2B)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-webkit-gradient)%5C((linear%7Cradial)%2C%5Cs((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F)%2C%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5C-%5D%2B)%5C)%24%2F%2C%2F%5E(-moz-linear-gradient)%5C(((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-webkit-radial-gradient)%5C(((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))%2C%5Cs(%5Cw%2B)%5Cs(%5Ba-z%5C-%5D%2B)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-moz-radial-gradient)%5C(((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))%2C%5Cs(%5Cw%2B)%5Cs%3F(%5Ba-z%5C-%5D*)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%2C%2F%5E(-o-radial-gradient)%5C(((%3F%3A%5Cd%7B1%2C3%7D%25%3F)%5Cs(%3F%3A%5Cd%7B1%2C3%7D%25%3F))%2C%5Cs(%5Cw%2B)%5Cs(%5Ba-z%5C-%5D%2B)(%5B%5Cw%5Cd%5C.%5Cs%2C%25%5C(%5C)%5D%2B)%5C)%24%2F%5D%3Br.parseGradient%3Dfunction(t%2Ce)%7Bvar%20n%2Cr%2Co%2Ci%2Cl%2Cs%2Cc%2Cd%2Ch%2Cu%2Cf%2Cp%2Cg%3Da.length%3Bfor(r%3D0%3Bg%3Er%26%26!(o%3Dt.match(a%5Br%5D))%3Br%2B%3D1)%3Bif(o)switch(o%5B1%5D)%7Bcase%22-webkit-linear-gradient%22%3Acase%22-o-linear-gradient%22%3Aif(n%3D%7Btype%3A%22linear%22%2Cx0%3Anull%2Cy0%3Anull%2Cx1%3Anull%2Cy1%3Anull%2CcolorStops%3A%5B%5D%7D%2Cl%3Do%5B2%5D.match(%2F%5Cw%2B%2Fg))for(s%3Dl.length%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)switch(l%5Br%5D)%7Bcase%22top%22%3An.y0%3D0%2Cn.y1%3De.height%3Bbreak%3Bcase%22right%22%3An.x0%3De.width%2Cn.x1%3D0%3Bbreak%3Bcase%22bottom%22%3An.y0%3De.height%2Cn.y1%3D0%3Bbreak%3Bcase%22left%22%3An.x0%3D0%2Cn.x1%3De.width%7Dif(null%3D%3D%3Dn.x0%26%26null%3D%3D%3Dn.x1%26%26(n.x0%3Dn.x1%3De.width%2F2)%2Cnull%3D%3D%3Dn.y0%26%26null%3D%3D%3Dn.y1%26%26(n.y0%3Dn.y1%3De.height%2F2)%2Cl%3Do%5B3%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C)(%3F%3A%5Cs%5Cd%7B1%2C3%7D(%3F%3A%25%7Cpx))%3F)%2B%2Fg))for(s%3Dl.length%2Cc%3D1%2FMath.max(s-1%2C1)%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)d%3Dl%5Br%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C))%5Cs*(%5Cd%7B1%2C3%7D)%3F(%25%7Cpx)%3F%2F)%2Cd%5B2%5D%3F(i%3DparseFloat(d%5B2%5D)%2Ci%2F%3D%22%25%22%3D%3D%3Dd%5B3%5D%3F100%3Ae.width)%3Ai%3Dr*c%2Cn.colorStops.push(%7Bcolor%3Ad%5B1%5D%2Cstop%3Ai%7D)%3Bbreak%3Bcase%22-webkit-gradient%22%3Aif(n%3D%7Btype%3A%22radial%22%3D%3D%3Do%5B2%5D%3F%22circle%22%3Ao%5B2%5D%2Cx0%3A0%2Cy0%3A0%2Cx1%3A0%2Cy1%3A0%2CcolorStops%3A%5B%5D%7D%2Cl%3Do%5B3%5D.match(%2F(%5Cd%7B1%2C3%7D)%25%3F%5Cs(%5Cd%7B1%2C3%7D)%25%3F%2C%5Cs(%5Cd%7B1%2C3%7D)%25%3F%5Cs(%5Cd%7B1%2C3%7D)%25%3F%2F)%2Cl%26%26(n.x0%3Dl%5B1%5D*e.width%2F100%2Cn.y0%3Dl%5B2%5D*e.height%2F100%2Cn.x1%3Dl%5B3%5D*e.width%2F100%2Cn.y1%3Dl%5B4%5D*e.height%2F100)%2Cl%3Do%5B4%5D.match(%2F((%3F%3Afrom%7Cto%7Ccolor-stop)%5C((%3F%3A%5B0-9%5C.%5D%2B%2C%5Cs)%3F(%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C)%5C))%2B%2Fg))for(s%3Dl.length%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)d%3Dl%5Br%5D.match(%2F(from%7Cto%7Ccolor-stop)%5C((%5B0-9%5C.%5D%2B)%3F(%3F%3A%2C%5Cs)%3F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C))%5C)%2F)%2Ci%3DparseFloat(d%5B2%5D)%2C%22from%22%3D%3D%3Dd%5B1%5D%26%26(i%3D0)%2C%22to%22%3D%3D%3Dd%5B1%5D%26%26(i%3D1)%2Cn.colorStops.push(%7Bcolor%3Ad%5B3%5D%2Cstop%3Ai%7D)%3Bbreak%3Bcase%22-moz-linear-gradient%22%3Aif(n%3D%7Btype%3A%22linear%22%2Cx0%3A0%2Cy0%3A0%2Cx1%3A0%2Cy1%3A0%2CcolorStops%3A%5B%5D%7D%2Cl%3Do%5B2%5D.match(%2F(%5Cd%7B1%2C3%7D)%25%3F%5Cs(%5Cd%7B1%2C3%7D)%25%3F%2F)%2Cl%26%26(n.x0%3Dl%5B1%5D*e.width%2F100%2Cn.y0%3Dl%5B2%5D*e.height%2F100%2Cn.x1%3De.width-n.x0%2Cn.y1%3De.height-n.y0)%2Cl%3Do%5B3%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C)(%3F%3A%5Cs%5Cd%7B1%2C3%7D%25)%3F)%2B%2Fg))for(s%3Dl.length%2Cc%3D1%2FMath.max(s-1%2C1)%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)d%3Dl%5Br%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C))%5Cs*(%5Cd%7B1%2C3%7D)%3F(%25)%3F%2F)%2Cd%5B2%5D%3F(i%3DparseFloat(d%5B2%5D)%2Cd%5B3%5D%26%26(i%2F%3D100))%3Ai%3Dr*c%2Cn.colorStops.push(%7Bcolor%3Ad%5B1%5D%2Cstop%3Ai%7D)%3Bbreak%3Bcase%22-webkit-radial-gradient%22%3Acase%22-moz-radial-gradient%22%3Acase%22-o-radial-gradient%22%3Aif(n%3D%7Btype%3A%22circle%22%2Cx0%3A0%2Cy0%3A0%2Cx1%3Ae.width%2Cy1%3Ae.height%2Ccx%3A0%2Ccy%3A0%2Crx%3A0%2Cry%3A0%2CcolorStops%3A%5B%5D%7D%2Cl%3Do%5B2%5D.match(%2F(%5Cd%7B1%2C3%7D)%25%3F%5Cs(%5Cd%7B1%2C3%7D)%25%3F%2F)%2Cl%26%26(n.cx%3Dl%5B1%5D*e.width%2F100%2Cn.cy%3Dl%5B2%5D*e.height%2F100)%2Cl%3Do%5B3%5D.match(%2F%5Cw%2B%2F)%2Cd%3Do%5B4%5D.match(%2F%5Ba-z%5C-%5D*%2F)%2Cl%26%26d)switch(d%5B0%5D)%7Bcase%22farthest-corner%22%3Acase%22cover%22%3Acase%22%22%3Ah%3DMath.sqrt(Math.pow(n.cx%2C2)%2BMath.pow(n.cy%2C2))%2Cu%3DMath.sqrt(Math.pow(n.cx%2C2)%2BMath.pow(n.y1-n.cy%2C2))%2Cf%3DMath.sqrt(Math.pow(n.x1-n.cx%2C2)%2BMath.pow(n.y1-n.cy%2C2))%2Cp%3DMath.sqrt(Math.pow(n.x1-n.cx%2C2)%2BMath.pow(n.cy%2C2))%2Cn.rx%3Dn.ry%3DMath.max(h%2Cu%2Cf%2Cp)%3Bbreak%3Bcase%22closest-corner%22%3Ah%3DMath.sqrt(Math.pow(n.cx%2C2)%2BMath.pow(n.cy%2C2))%2Cu%3DMath.sqrt(Math.pow(n.cx%2C2)%2BMath.pow(n.y1-n.cy%2C2))%2Cf%3DMath.sqrt(Math.pow(n.x1-n.cx%2C2)%2BMath.pow(n.y1-n.cy%2C2))%2Cp%3DMath.sqrt(Math.pow(n.x1-n.cx%2C2)%2BMath.pow(n.cy%2C2))%2Cn.rx%3Dn.ry%3DMath.min(h%2Cu%2Cf%2Cp)%3Bbreak%3Bcase%22farthest-side%22%3A%22circle%22%3D%3D%3Dl%5B0%5D%3Fn.rx%3Dn.ry%3DMath.max(n.cx%2Cn.cy%2Cn.x1-n.cx%2Cn.y1-n.cy)%3A(n.type%3Dl%5B0%5D%2Cn.rx%3DMath.max(n.cx%2Cn.x1-n.cx)%2Cn.ry%3DMath.max(n.cy%2Cn.y1-n.cy))%3Bbreak%3Bcase%22closest-side%22%3Acase%22contain%22%3A%22circle%22%3D%3D%3Dl%5B0%5D%3Fn.rx%3Dn.ry%3DMath.min(n.cx%2Cn.cy%2Cn.x1-n.cx%2Cn.y1-n.cy)%3A(n.type%3Dl%5B0%5D%2Cn.rx%3DMath.min(n.cx%2Cn.x1-n.cx)%2Cn.ry%3DMath.min(n.cy%2Cn.y1-n.cy))%7Dif(l%3Do%5B5%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C)(%3F%3A%5Cs%5Cd%7B1%2C3%7D(%3F%3A%25%7Cpx))%3F)%2B%2Fg))for(s%3Dl.length%2Cc%3D1%2FMath.max(s-1%2C1)%2Cr%3D0%3Bs%3Er%3Br%2B%3D1)d%3Dl%5Br%5D.match(%2F((%3F%3Argb%7Crgba)%5C(%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D%2C%5Cs%5Cd%7B1%2C3%7D(%3F%3A%2C%5Cs%5B0-9%5C.%5D%2B)%3F%5C))%5Cs*(%5Cd%7B1%2C3%7D)%3F(%25%7Cpx)%3F%2F)%2Cd%5B2%5D%3F(i%3DparseFloat(d%5B2%5D)%2Ci%2F%3D%22%25%22%3D%3D%3Dd%5B3%5D%3F100%3Ae.width)%3Ai%3Dr*c%2Cn.colorStops.push(%7Bcolor%3Ad%5B1%5D%2Cstop%3Ai%7D)%7Dreturn%20n%7D%2Cr.Gradient%3Dfunction(n%2Cr)%7Bif(0!%3D%3Dr.width%26%260!%3D%3Dr.height)%7Bvar%20a%2Co%2Ci%3De.createElement(%22canvas%22)%2Cl%3Di.getContext(%222d%22)%3Bif(i.width%3Dr.width%2Ci.height%3Dr.height%2Ca%3Dd.Generate.parseGradient(n%2Cr))switch(a.type)%7Bcase%22linear%22%3Ao%3Dl.createLinearGradient(a.x0%2Ca.y0%2Ca.x1%2Ca.y1)%2Ca.colorStops.forEach(t(o))%2Cl.fillStyle%3Do%2Cl.fillRect(0%2C0%2Cr.width%2Cr.height)%3Bbreak%3Bcase%22circle%22%3Ao%3Dl.createRadialGradient(a.cx%2Ca.cy%2C0%2Ca.cx%2Ca.cy%2Ca.rx)%2Ca.colorStops.forEach(t(o))%2Cl.fillStyle%3Do%2Cl.fillRect(0%2C0%2Cr.width%2Cr.height)%3Bbreak%3Bcase%22ellipse%22%3Avar%20s%3De.createElement(%22canvas%22)%2Cc%3Ds.getContext(%222d%22)%2Ch%3DMath.max(a.rx%2Ca.ry)%2Cu%3D2*h%3Bs.width%3Ds.height%3Du%2Co%3Dc.createRadialGradient(a.rx%2Ca.ry%2C0%2Ca.rx%2Ca.ry%2Ch)%2Ca.colorStops.forEach(t(o))%2Cc.fillStyle%3Do%2Cc.fillRect(0%2C0%2Cu%2Cu)%2Cl.fillStyle%3Da.colorStops%5Ba.colorStops.length-1%5D.color%2Cl.fillRect(0%2C0%2Ci.width%2Ci.height)%2Cl.drawImage(s%2Ca.cx-a.rx%2Ca.cy-a.ry%2C2*a.rx%2C2*a.ry)%7Dreturn%20i%7D%7D%2Cr.ListAlpha%3Dfunction(t)%7Bvar%20e%2Cn%3D%22%22%3Bdo%20e%3Dt%2526%2Cn%3DString.fromCharCode(e%2B64)%2Bn%2Ct%2F%3D26%3Bwhile(26*t%3E26)%3Breturn%20n%7D%2Cr.ListRoman%3Dfunction(t)%7Bvar%20e%2Cn%3D%5B%22M%22%2C%22CM%22%2C%22D%22%2C%22CD%22%2C%22C%22%2C%22XC%22%2C%22L%22%2C%22XL%22%2C%22X%22%2C%22IX%22%2C%22V%22%2C%22IV%22%2C%22I%22%5D%2Cr%3D%5B1e3%2C900%2C500%2C400%2C100%2C90%2C50%2C40%2C10%2C9%2C5%2C4%2C1%5D%2Ca%3D%22%22%2Co%3Dn.length%3Bif(0%3E%3Dt%7C%7Ct%3E%3D4e3)return%20t%3Bfor(e%3D0%3Bo%3Ee%3Be%2B%3D1)for(%3Bt%3E%3Dr%5Be%5D%3B)t-%3Dr%5Be%5D%2Ca%2B%3Dn%5Be%5D%3Breturn%20a%7D%7D()%2Cd.Parse%3Dfunction(r%2Ca%2Co)%7Bfunction%20i()%7Bvar%20t%3Dbe(e.documentElement%2C%22backgroundColor%22)%2Cn%3Dme.isTransparent(t)%26%26fe%3D%3D%3De.body%2Cr%3Dce(fe%2Cnull%2C!1%2Cn)%3Bs(fe)%2Cue(fe%2Cr%2Cfunction()%7Bn%26%26(t%3Dr.backgroundColor)%2Cc()%2Cme.log(%22Done%20parsing%2C%20moving%20to%20Render.%22)%2Co(%7BbackgroundColor%3At%2Cstack%3Ar%7D)%7D)%7Dfunction%20s(t)%7Bfunction%20n()%7Bfor(var%20t%3D%2F%3Abefore%7C%3Aafter%2F%2Cn%3De.styleSheets%2Cr%3D0%2Ca%3Dn.length%3Ba%3Er%3Br%2B%2B)try%7Bfor(var%20o%3Dn%5Br%5D.cssRules%2Ci%3D0%2Cs%3Do.length%3Bs%3Ei%3Bi%2B%2B)t.test(o%5Bi%5D.selectorText)%26%26l.push(o%5Bi%5D.selectorText)%7Dcatch(c)%7B%7Dfor(r%3D0%2Ca%3Dl.length%3Ba%3Er%3Br%2B%2B)l%5Br%5D%3Dl%5Br%5D.match(%2F(%5E%5B%5E%3A%5D*)%2F)%5B1%5D%7Dfunction%20r()%7Bfor(var%20t%3De.querySelectorAll(l.join(%22%2C%22))%2Cn%3D0%2Cr%3Dt.length%3Br%3En%3Bn%2B%2B)a(t%5Bn%5D)%7Dfunction%20a(t)%7Bvar%20e%3DY(t%2C%22%3Abefore%22)%2Cn%3DY(t%2C%22%3Aafter%22)%3Be%26%26i.push(%7Btype%3A%22before%22%2Cpseudo%3Ae%2Cel%3At%7D)%2Cn%26%26i.push(%7Btype%3A%22after%22%2Cpseudo%3An%2Cel%3At%7D)%7Dfunction%20o()%7Bi.forEach(function(t)%7Bh(t.el%2Cve%2B%22-parent%22)%7D)%2Ci.forEach(function(t)%7B%22before%22%3D%3D%3Dt.type%3Ft.el.insertBefore(t.pseudo%2Ct.el.firstChild)%3At.el.appendChild(t.pseudo)%7D)%7Dvar%20i%3D%5B%5D%2Cl%3D%5B%5D%3Bn()%2Cr(t)%2Co()%7Dfunction%20c()%7Bxe.removeChild(Ce)%3Bfor(var%20t%3De.getElementsByClassName(ve%2B%22-element%22)%3Bt.length%3B)t%5B0%5D.parentNode.removeChild(t%5B0%5D)%3Bfor(var%20n%3De.getElementsByClassName(ve%2B%22-parent%22)%3Bn.length%3B)u(n%5B0%5D%2Cve%2B%22-parent%22)%7Dfunction%20h(t%2Ce)%7Bt.classList%3Ft.classList.add(e)%3At.className%3Dt.className%2B%22%20%22%2Be%7Dfunction%20u(t%2Ce)%7Bt.classList%3Ft.classList.remove(e)%3At.className%3Dt.className.replace(e%2C%22%22).trim()%7Dfunction%20f()%7Breturn%20Math.max(Math.max(ge.body.scrollWidth%2Cge.documentElement.scrollWidth)%2CMath.max(ge.body.offsetWidth%2Cge.documentElement.offsetWidth)%2CMath.max(ge.body.clientWidth%2Cge.documentElement.clientWidth))%7Dfunction%20p()%7Breturn%20Math.max(Math.max(ge.body.scrollHeight%2Cge.documentElement.scrollHeight)%2CMath.max(ge.body.offsetHeight%2Cge.documentElement.offsetHeight)%2CMath.max(ge.body.clientHeight%2Cge.documentElement.clientHeight))%7Dfunction%20g(t%2Ce)%7Bvar%20n%3DparseInt(be(t%2Ce)%2C10)%3Breturn%20isNaN(n)%3F0%3An%7Dfunction%20m(t%2Ce%2Cn%2Cr%2Ca%2Co)%7B%22transparent%22!%3D%3Do%26%26(t.setVariable(%22fillStyle%22%2Co)%2Ct.fillRect(e%2Cn%2Cr%2Ca)%2Cpe%2B%3D1)%7Dfunction%20y(t%2Ce%2Cr)%7Breturn%20t.length%3E0%3Fe%2Br.toUpperCase()%3An%7Dfunction%20w(t%2Ce)%7Bswitch(e)%7Bcase%22lowercase%22%3Areturn%20t.toLowerCase()%3Bcase%22capitalize%22%3Areturn%20t.replace(%2F(%5E%7C%5Cs%7C%3A%7C-%7C%5C(%7C%5C))(%5Ba-z%5D)%2Fg%2Cy)%3Bcase%22uppercase%22%3Areturn%20t.toUpperCase()%3Bdefault%3Areturn%20t%7D%7Dfunction%20x(t)%7Breturn%2F%5E(normal%7Cnone%7C0px)%24%2F.test(t)%7Dfunction%20b(t%2Ce%2Cn%2Cr)%7Bnull!%3D%3Dt%26%26me.trimText(t).length%3E0%26%26(r.fillText(t%2Ce%2Cn)%2Cpe%2B%3D1)%7Dfunction%20v(t%2Ce%2Cr%2Ca)%7Bvar%20o%3D!1%2Ci%3Dbe(e%2C%22fontWeight%22)%2Cl%3Dbe(e%2C%22fontFamily%22)%2Cs%3Dbe(e%2C%22fontSize%22)%2Cc%3Dme.parseTextShadows(be(e%2C%22textShadow%22))%3Bswitch(parseInt(i%2C10))%7Bcase%20401%3Ai%3D%22bold%22%3Bbreak%3Bcase%20400%3Ai%3D%22normal%22%7Dreturn%20t.setVariable(%22fillStyle%22%2Ca)%2Ct.setVariable(%22font%22%2C%5Bbe(e%2C%22fontStyle%22)%2Cbe(e%2C%22fontVariant%22)%2Ci%2Cs%2Cl%5D.join(%22%20%22))%2Ct.setVariable(%22textAlign%22%2Co%3F%22right%22%3A%22left%22)%2Cc.length%26%26(t.setVariable(%22shadowColor%22%2Cc%5B0%5D.color)%2Ct.setVariable(%22shadowOffsetX%22%2Cc%5B0%5D.offsetX)%2Ct.setVariable(%22shadowOffsetY%22%2Cc%5B0%5D.offsetY)%2Ct.setVariable(%22shadowBlur%22%2Cc%5B0%5D.blur))%2C%22none%22!%3D%3Dr%3Fme.Font(l%2Cs%2Cge)%3An%7Dfunction%20C(t%2Ce%2Cn%2Cr%2Ca)%7Bswitch(e)%7Bcase%22underline%22%3Am(t%2Cn.left%2CMath.round(n.top%2Br.baseline%2Br.lineWidth)%2Cn.width%2C1%2Ca)%3Bbreak%3Bcase%22overline%22%3Am(t%2Cn.left%2CMath.round(n.top)%2Cn.width%2C1%2Ca)%3Bbreak%3Bcase%22line-through%22%3Am(t%2Cn.left%2CMath.ceil(n.top%2Br.middle%2Br.lineWidth)%2Cn.width%2C1%2Ca)%7D%7Dfunction%20k(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%3Bif(ye.rangeBounds%26%26!a)(%22none%22!%3D%3Dn%7C%7C0!%3D%3Dme.trimText(e).length)%26%26(o%3DT(e%2Ct.node%2Ct.textOffset))%2Ct.textOffset%2B%3De.length%3Belse%20if(t.node%26%26%22string%22%3D%3Dtypeof%20t.node.nodeValue)%7Bvar%20i%3Dr%3Ft.node.splitText(e.length)%3Anull%3Bo%3DS(t.node%2Ca)%2Ct.node%3Di%7Dreturn%20o%7Dfunction%20T(t%2Ce%2Cn)%7Bvar%20r%3Dge.createRange()%3Breturn%20r.setStart(e%2Cn)%2Cr.setEnd(e%2Cn%2Bt.length)%2Cr.getBoundingClientRect()%7Dfunction%20S(t%2Ce)%7Bvar%20n%3Dt.parentNode%2Cr%3Dge.createElement(%22wrapper%22)%2Ca%3Dt.cloneNode(!0)%3Br.appendChild(t.cloneNode(!0))%2Cn.replaceChild(r%2Ct)%3Bvar%20o%3De%3Fme.OffsetBounds(r)%3Ame.Bounds(r)%3Breturn%20n.replaceChild(a%2Cr)%2Co%7Dfunction%20E(t%2Ce%2Cn)%7Bvar%20r%2Co%2Ci%3Dn.ctx%2Cl%3Dbe(t%2C%22color%22)%2Cs%3Dbe(t%2C%22textDecoration%22)%2Cc%3Dbe(t%2C%22textAlign%22)%2Cd%3D%7Bnode%3Ae%2CtextOffset%3A0%7D%3Bme.trimText(e.nodeValue).length%3E0%26%26(e.nodeValue%3Dw(e.nodeValue%2Cbe(t%2C%22textTransform%22))%2Cc%3Dc.replace(%5B%22-webkit-auto%22%5D%2C%5B%22auto%22%5D)%2Co%3D!a.letterRendering%26%26%2F%5E(left%7Cright%7Cjustify%7Cauto)%24%2F.test(c)%26%26x(be(t%2C%22letterSpacing%22))%3Fe.nodeValue.split(%2F(%5Cb%7C%20)%2F)%3Ae.nodeValue.split(%22%22)%2Cr%3Dv(i%2Ct%2Cs%2Cl)%2Ca.chinese%26%26o.forEach(function(t%2Ce)%7B%2F.*%5B%5Cu4E00-%5Cu9FA5%5D.*%24%2F.test(t)%26%26(t%3Dt.split(%22%22)%2Ct.unshift(e%2C1)%2Co.splice.apply(o%2Ct))%7D)%2Co.forEach(function(t%2Ce)%7Bvar%20a%3Dk(d%2Ct%2Cs%2Co.length-1%3Ee%2Cn.transform.matrix)%3Ba%26%26(b(t%2Ca.left%2Ca.bottom%2Ci)%2CC(i%2Cs%2Ca%2Cr%2Cl))%7D))%7Dfunction%20R(t%2Ce)%7Bvar%20n%2Cr%2Ca%3Dge.createElement(%22boundelement%22)%3Breturn%20a.style.display%3D%22inline%22%2Cn%3Dt.style.listStyleType%2Ct.style.listStyleType%3D%22none%22%2Ca.appendChild(ge.createTextNode(e))%2Ct.insertBefore(a%2Ct.firstChild)%2Cr%3Dme.Bounds(a)%2Ct.removeChild(a)%2Ct.style.listStyleType%3Dn%2Cr%7Dfunction%20M(t)%7Bvar%20e%3D-1%2Cn%3D1%2Cr%3Dt.parentNode.childNodes%3Bif(t.parentNode)%7Bfor(%3Br%5B%2B%2Be%5D!%3D%3Dt%3B)1%3D%3D%3Dr%5Be%5D.nodeType%26%26n%2B%2B%3Breturn%20n%7Dreturn-1%7Dfunction%20I(t%2Ce)%7Bvar%20n%2Cr%3DM(t)%3Bswitch(e)%7Bcase%22decimal%22%3An%3Dr%3Bbreak%3Bcase%22decimal-leading-zero%22%3An%3D1%3D%3D%3D(%22%22%2Br).length%3Fr%3D%220%22%2B(%22%22%2Br)%3A%22%22%2Br%3Bbreak%3Bcase%22upper-roman%22%3An%3Dd.Generate.ListRoman(r)%3Bbreak%3Bcase%22lower-roman%22%3An%3Dd.Generate.ListRoman(r).toLowerCase()%3Bbreak%3Bcase%22lower-alpha%22%3An%3Dd.Generate.ListAlpha(r).toLowerCase()%3Bbreak%3Bcase%22upper-alpha%22%3An%3Dd.Generate.ListAlpha(r)%7Dreturn%20n%2B%22.%20%22%7Dfunction%20L(t%2Ce%2Cn)%7Bvar%20r%2Ca%2Co%2Ci%3De.ctx%2Cl%3Dbe(t%2C%22listStyleType%22)%3Bif(%2F%5E(decimal%7Cdecimal-leading-zero%7Cupper-alpha%7Cupper-latin%7Cupper-roman%7Clower-alpha%7Clower-greek%7Clower-latin%7Clower-roman)%24%2Fi.test(l))%7Bif(a%3DI(t%2Cl)%2Co%3DR(t%2Ca)%2Cv(i%2Ct%2C%22none%22%2Cbe(t%2C%22color%22))%2C%22inside%22!%3D%3Dbe(t%2C%22listStylePosition%22))return%3Bi.setVariable(%22textAlign%22%2C%22left%22)%2Cr%3Dn.left%2Cb(a%2Cr%2Co.bottom%2Ci)%7D%7Dfunction%20O(t)%7Bvar%20e%3Dr%5Bt%5D%3Breturn%20e%26%26e.succeeded%3D%3D%3D!0%3Fe.img%3A!1%7Dfunction%20z(t%2Ce)%7Bvar%20n%3DMath.max(t.left%2Ce.left)%2Cr%3DMath.max(t.top%2Ce.top)%2Ca%3DMath.min(t.left%2Bt.width%2Ce.left%2Be.width)%2Co%3DMath.min(t.top%2Bt.height%2Ce.top%2Be.height)%3Breturn%7Bleft%3An%2Ctop%3Ar%2Cwidth%3Aa-n%2Cheight%3Ao-r%7D%7Dfunction%20B(t%2Ce%2Cn)%7Bvar%20r%2Ca%3D%22static%22!%3D%3De.cssPosition%2Co%3Da%3Fbe(t%2C%22zIndex%22)%3A%22auto%22%2Ci%3Dbe(t%2C%22opacity%22)%2Cl%3D%22none%22!%3D%3Dbe(t%2C%22cssFloat%22)%3Be.zIndex%3Dr%3DU(o)%2Cr.isPositioned%3Da%2Cr.isFloated%3Dl%2Cr.opacity%3Di%2Cr.ownStacking%3D%22auto%22!%3D%3Do%7C%7C1%3Ei%2Cr.depth%3Dn%3Fn.zIndex.depth%2B1%3A0%2Cn%26%26n.zIndex.children.push(e)%7Dfunction%20U(t)%7Breturn%7Bdepth%3A0%2Czindex%3At%2Cchildren%3A%5B%5D%7D%7Dfunction%20A(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%3Dg(e%2C%22paddingLeft%22)%2Ci%3Dg(e%2C%22paddingTop%22)%2Cl%3Dg(e%2C%22paddingRight%22)%2Cs%3Dg(e%2C%22paddingBottom%22)%3B_(t%2Cn%2C0%2C0%2Cn.width%2Cn.height%2Cr.left%2Bo%2Ba%5B3%5D.width%2Cr.top%2Bi%2Ba%5B0%5D.width%2Cr.width-(a%5B1%5D.width%2Ba%5B3%5D.width%2Bo%2Bl)%2Cr.height-(a%5B0%5D.width%2Ba%5B2%5D.width%2Bi%2Bs))%7Dfunction%20N(t)%7Breturn%5B%22Top%22%2C%22Right%22%2C%22Bottom%22%2C%22Left%22%5D.map(function(e)%7Breturn%7Bwidth%3Ag(t%2C%22border%22%2Be%2B%22Width%22)%2Ccolor%3Abe(t%2C%22border%22%2Be%2B%22Color%22)%7D%7D)%7Dfunction%20P(t)%7Breturn%5B%22TopLeft%22%2C%22TopRight%22%2C%22BottomRight%22%2C%22BottomLeft%22%5D.map(function(e)%7Breturn%20be(t%2C%22border%22%2Be%2B%22Radius%22)%7D)%7Dfunction%20F(t%2Ce%2Cn%2Cr)%7Bvar%20a%3D4*((Math.sqrt(2)-1)%2F3)%2Co%3Dn*a%2Ci%3Dr*a%2Cl%3Dt%2Bn%2Cs%3De%2Br%3Breturn%7BtopLeft%3AV(%7Bx%3At%2Cy%3As%7D%2C%7Bx%3At%2Cy%3As-i%7D%2C%7Bx%3Al-o%2Cy%3Ae%7D%2C%7Bx%3Al%2Cy%3Ae%7D)%2CtopRight%3AV(%7Bx%3At%2Cy%3Ae%7D%2C%7Bx%3At%2Bo%2Cy%3Ae%7D%2C%7Bx%3Al%2Cy%3As-i%7D%2C%7Bx%3Al%2Cy%3As%7D)%2CbottomRight%3AV(%7Bx%3Al%2Cy%3Ae%7D%2C%7Bx%3Al%2Cy%3Ae%2Bi%7D%2C%7Bx%3At%2Bo%2Cy%3As%7D%2C%7Bx%3At%2Cy%3As%7D)%2CbottomLeft%3AV(%7Bx%3Al%2Cy%3As%7D%2C%7Bx%3Al-o%2Cy%3As%7D%2C%7Bx%3At%2Cy%3Ae%2Bi%7D%2C%7Bx%3At%2Cy%3Ae%7D)%7D%7Dfunction%20V(t%2Ce%2Cn%2Cr)%7Bvar%20a%3Dfunction(t%2Ce%2Cn)%7Breturn%7Bx%3At.x%2B(e.x-t.x)*n%2Cy%3At.y%2B(e.y-t.y)*n%7D%7D%3Breturn%7Bstart%3At%2CstartControl%3Ae%2CendControl%3An%2Cend%3Ar%2Csubdivide%3Afunction(o)%7Bvar%20i%3Da(t%2Ce%2Co)%2Cl%3Da(e%2Cn%2Co)%2Cs%3Da(n%2Cr%2Co)%2Cc%3Da(i%2Cl%2Co)%2Cd%3Da(l%2Cs%2Co)%2Ch%3Da(c%2Cd%2Co)%3Breturn%5BV(t%2Ci%2Cc%2Ch)%2CV(h%2Cd%2Cs%2Cr)%5D%7D%2CcurveTo%3Afunction(t)%7Bt.push(%5B%22bezierCurve%22%2Ce.x%2Ce.y%2Cn.x%2Cn.y%2Cr.x%2Cr.y%5D)%7D%2CcurveToReversed%3Afunction(r)%7Br.push(%5B%22bezierCurve%22%2Cn.x%2Cn.y%2Ce.x%2Ce.y%2Ct.x%2Ct.y%5D)%7D%7D%7Dfunction%20D(t%2Ce%2Cn%2Cr%2Ca%2Co%2Ci)%7Be%5B0%5D%3E0%7C%7Ce%5B1%5D%3E0%3F(t.push(%5B%22line%22%2Cr%5B0%5D.start.x%2Cr%5B0%5D.start.y%5D)%2Cr%5B0%5D.curveTo(t)%2Cr%5B1%5D.curveTo(t))%3At.push(%5B%22line%22%2Co%2Ci%5D)%2C(n%5B0%5D%3E0%7C%7Cn%5B1%5D%3E0)%26%26t.push(%5B%22line%22%2Ca%5B0%5D.start.x%2Ca%5B0%5D.start.y%5D)%7Dfunction%20%24(t%2Ce%2Cn%2Cr%2Ca%2Co%2Ci)%7Bvar%20l%3D%5B%5D%3Breturn%20e%5B0%5D%3E0%7C%7Ce%5B1%5D%3E0%3F(l.push(%5B%22line%22%2Cr%5B1%5D.start.x%2Cr%5B1%5D.start.y%5D)%2Cr%5B1%5D.curveTo(l))%3Al.push(%5B%22line%22%2Ct.c1%5B0%5D%2Ct.c1%5B1%5D%5D)%2Cn%5B0%5D%3E0%7C%7Cn%5B1%5D%3E0%3F(l.push(%5B%22line%22%2Co%5B0%5D.start.x%2Co%5B0%5D.start.y%5D)%2Co%5B0%5D.curveTo(l)%2Cl.push(%5B%22line%22%2Ci%5B0%5D.end.x%2Ci%5B0%5D.end.y%5D)%2Ci%5B0%5D.curveToReversed(l))%3A(l.push(%5B%22line%22%2Ct.c2%5B0%5D%2Ct.c2%5B1%5D%5D)%2Cl.push(%5B%22line%22%2Ct.c3%5B0%5D%2Ct.c3%5B1%5D%5D))%2Ce%5B0%5D%3E0%7C%7Ce%5B1%5D%3E0%3F(l.push(%5B%22line%22%2Ca%5B1%5D.end.x%2Ca%5B1%5D.end.y%5D)%2Ca%5B1%5D.curveToReversed(l))%3Al.push(%5B%22line%22%2Ct.c4%5B0%5D%2Ct.c4%5B1%5D%5D)%2Cl%7Dfunction%20G(t%2Ce%2Cn)%7Bvar%20r%3Dt.left%2Ca%3Dt.top%2Co%3Dt.width%2Ci%3Dt.height%2Cl%3De%5B0%5D%5B0%5D%2Cs%3De%5B0%5D%5B1%5D%2Cc%3De%5B1%5D%5B0%5D%2Cd%3De%5B1%5D%5B1%5D%2Ch%3De%5B2%5D%5B0%5D%2Cu%3De%5B2%5D%5B1%5D%2Cf%3De%5B3%5D%5B0%5D%2Cp%3De%5B3%5D%5B1%5D%2Cg%3Do-c%2Cm%3Di-u%2Cy%3Do-h%2Cw%3Di-p%3Breturn%7BtopLeftOuter%3AF(r%2Ca%2Cl%2Cs).topLeft.subdivide(.5)%2CtopLeftInner%3AF(r%2Bn%5B3%5D.width%2Ca%2Bn%5B0%5D.width%2CMath.max(0%2Cl-n%5B3%5D.width)%2CMath.max(0%2Cs-n%5B0%5D.width)).topLeft.subdivide(.5)%2CtopRightOuter%3AF(r%2Bg%2Ca%2Cc%2Cd).topRight.subdivide(.5)%2CtopRightInner%3AF(r%2BMath.min(g%2Co%2Bn%5B3%5D.width)%2Ca%2Bn%5B0%5D.width%2Cg%3Eo%2Bn%5B3%5D.width%3F0%3Ac-n%5B3%5D.width%2Cd-n%5B0%5D.width).topRight.subdivide(.5)%2CbottomRightOuter%3AF(r%2By%2Ca%2Bm%2Ch%2Cu).bottomRight.subdivide(.5)%2CbottomRightInner%3AF(r%2BMath.min(y%2Co%2Bn%5B3%5D.width)%2Ca%2BMath.min(m%2Ci%2Bn%5B0%5D.width)%2CMath.max(0%2Ch-n%5B1%5D.width)%2CMath.max(0%2Cu-n%5B2%5D.width)).bottomRight.subdivide(.5)%2CbottomLeftOuter%3AF(r%2Ca%2Bw%2Cf%2Cp).bottomLeft.subdivide(.5)%2CbottomLeftInner%3AF(r%2Bn%5B3%5D.width%2Ca%2Bw%2CMath.max(0%2Cf-n%5B3%5D.width)%2CMath.max(0%2Cp-n%5B2%5D.width)).bottomLeft.subdivide(.5)%7D%7Dfunction%20W(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%3Dbe(t%2C%22backgroundClip%22)%2Ci%3D%5B%5D%3Bswitch(o)%7Bcase%22content-box%22%3Acase%22padding-box%22%3AD(i%2Cr%5B0%5D%2Cr%5B1%5D%2Ce.topLeftInner%2Ce.topRightInner%2Ca.left%2Bn%5B3%5D.width%2Ca.top%2Bn%5B0%5D.width)%2CD(i%2Cr%5B1%5D%2Cr%5B2%5D%2Ce.topRightInner%2Ce.bottomRightInner%2Ca.left%2Ba.width-n%5B1%5D.width%2Ca.top%2Bn%5B0%5D.width)%2CD(i%2Cr%5B2%5D%2Cr%5B3%5D%2Ce.bottomRightInner%2Ce.bottomLeftInner%2Ca.left%2Ba.width-n%5B1%5D.width%2Ca.top%2Ba.height-n%5B2%5D.width)%2CD(i%2Cr%5B3%5D%2Cr%5B0%5D%2Ce.bottomLeftInner%2Ce.topLeftInner%2Ca.left%2Bn%5B3%5D.width%2Ca.top%2Ba.height-n%5B2%5D.width)%3Bbreak%3Bdefault%3AD(i%2Cr%5B0%5D%2Cr%5B1%5D%2Ce.topLeftOuter%2Ce.topRightOuter%2Ca.left%2Ca.top)%2CD(i%2Cr%5B1%5D%2Cr%5B2%5D%2Ce.topRightOuter%2Ce.bottomRightOuter%2Ca.left%2Ba.width%2Ca.top)%2CD(i%2Cr%5B2%5D%2Cr%5B3%5D%2Ce.bottomRightOuter%2Ce.bottomLeftOuter%2Ca.left%2Ba.width%2Ca.top%2Ba.height)%2CD(i%2Cr%5B3%5D%2Cr%5B0%5D%2Ce.bottomLeftOuter%2Ce.topLeftOuter%2Ca.left%2Ca.top%2Ba.height)%7Dreturn%20i%7Dfunction%20H(t%2Ce%2Cn)%7Bvar%20r%2Ca%2Co%2Ci%2Cl%2Cs%2Cc%3De.left%2Cd%3De.top%2Ch%3De.width%2Cu%3De.height%2Cf%3DP(t)%2Cp%3DG(e%2Cf%2Cn)%2Cg%3D%7Bclip%3AW(t%2Cp%2Cn%2Cf%2Ce)%2Cborders%3A%5B%5D%7D%3Bfor(r%3D0%3B4%3Er%3Br%2B%2B)if(n%5Br%5D.width%3E0)%7Bswitch(a%3Dc%2Co%3Dd%2Ci%3Dh%2Cl%3Du-n%5B2%5D.width%2Cr)%7Bcase%200%3Al%3Dn%5B0%5D.width%2Cs%3D%24(%7Bc1%3A%5Ba%2Co%5D%2Cc2%3A%5Ba%2Bi%2Co%5D%2Cc3%3A%5Ba%2Bi-n%5B1%5D.width%2Co%2Bl%5D%2Cc4%3A%5Ba%2Bn%5B3%5D.width%2Co%2Bl%5D%7D%2Cf%5B0%5D%2Cf%5B1%5D%2Cp.topLeftOuter%2Cp.topLeftInner%2Cp.topRightOuter%2Cp.topRightInner)%3Bbreak%3Bcase%201%3Aa%3Dc%2Bh-n%5B1%5D.width%2Ci%3Dn%5B1%5D.width%2Cs%3D%24(%7Bc1%3A%5Ba%2Bi%2Co%5D%2Cc2%3A%5Ba%2Bi%2Co%2Bl%2Bn%5B2%5D.width%5D%2Cc3%3A%5Ba%2Co%2Bl%5D%2Cc4%3A%5Ba%2Co%2Bn%5B0%5D.width%5D%7D%2Cf%5B1%5D%2Cf%5B2%5D%2Cp.topRightOuter%2Cp.topRightInner%2Cp.bottomRightOuter%2Cp.bottomRightInner)%3Bbreak%3Bcase%202%3Ao%3Do%2Bu-n%5B2%5D.width%2Cl%3Dn%5B2%5D.width%2Cs%3D%24(%7Bc1%3A%5Ba%2Bi%2Co%2Bl%5D%2Cc2%3A%5Ba%2Co%2Bl%5D%2Cc3%3A%5Ba%2Bn%5B3%5D.width%2Co%5D%2Cc4%3A%5Ba%2Bi-n%5B3%5D.width%2Co%5D%7D%2Cf%5B2%5D%2Cf%5B3%5D%2Cp.bottomRightOuter%2Cp.bottomRightInner%2Cp.bottomLeftOuter%2Cp.bottomLeftInner)%3Bbreak%3Bcase%203%3Ai%3Dn%5B3%5D.width%2Cs%3D%24(%7Bc1%3A%5Ba%2Co%2Bl%2Bn%5B2%5D.width%5D%2Cc2%3A%5Ba%2Co%5D%2Cc3%3A%5Ba%2Bi%2Co%2Bn%5B0%5D.width%5D%2Cc4%3A%5Ba%2Bi%2Co%2Bl%5D%7D%2Cf%5B3%5D%2Cf%5B0%5D%2Cp.bottomLeftOuter%2Cp.bottomLeftInner%2Cp.topLeftOuter%2Cp.topLeftInner)%7Dg.borders.push(%7Bargs%3As%2Ccolor%3An%5Br%5D.color%7D)%7Dreturn%20g%7Dfunction%20j(t%2Ce)%7Bvar%20n%3Dt.drawShape()%3Breturn%20e.forEach(function(t%2Ce)%7Bn%5B0%3D%3D%3De%3F%22moveTo%22%3At%5B0%5D%2B%22To%22%5D.apply(null%2Ct.slice(1))%7D)%2Cn%7Dfunction%20q(t%2Ce%2Cn)%7B%22transparent%22!%3D%3Dn%26%26(t.setVariable(%22fillStyle%22%2Cn)%2Cj(t%2Ce)%2Ct.fill()%2Cpe%2B%3D1)%7Dfunction%20X(t%2Ce%2Cn)%7Bvar%20r%2Ca%2Co%3Dge.createElement(%22valuewrap%22)%2Ci%3D%5B%22lineHeight%22%2C%22textAlign%22%2C%22fontFamily%22%2C%22color%22%2C%22fontSize%22%2C%22paddingLeft%22%2C%22paddingTop%22%2C%22width%22%2C%22height%22%2C%22border%22%2C%22borderLeftWidth%22%2C%22borderTopWidth%22%5D%3Bi.forEach(function(e)%7Btry%7Bo.style%5Be%5D%3Dbe(t%2Ce)%7Dcatch(n)%7Bme.log(%22html2canvas%3A%20Parse%3A%20Exception%20caught%20in%20renderFormValue%3A%20%22%2Bn.message)%7D%7D)%2Co.style.borderColor%3D%22black%22%2Co.style.borderStyle%3D%22solid%22%2Co.style.display%3D%22block%22%2Co.style.position%3D%22absolute%22%2C(%2F%5E(submit%7Creset%7Cbutton%7Ctext%7Cpassword)%24%2F.test(t.type)%7C%7C%22SELECT%22%3D%3D%3Dt.nodeName)%26%26(o.style.lineHeight%3Dbe(t%2C%22height%22))%2Co.style.top%3De.top%2B%22px%22%2Co.style.left%3De.left%2B%22px%22%2Cr%3D%22SELECT%22%3D%3D%3Dt.nodeName%3F(t.options%5Bt.selectedIndex%5D%7C%7C0).text%3At.value%2Cr%7C%7C(r%3Dt.placeholder)%2Ca%3Dge.createTextNode(r)%2Co.appendChild(a)%2Cxe.appendChild(o)%2CE(t%2Ca%2Cn)%2Cxe.removeChild(o)%7Dfunction%20_(t)%7Bt.drawImage.apply(t%2CArray.prototype.slice.call(arguments%2C1))%2Cpe%2B%3D1%7Dfunction%20Y(n%2Cr)%7Bvar%20a%3Dt.getComputedStyle(n%2Cr)%2Co%3Dt.getComputedStyle(n)%3Bif(a%26%26a.content%26%26%22none%22!%3D%3Da.content%26%26%22-moz-alt-content%22!%3D%3Da.content%26%26%22none%22!%3D%3Da.display%26%26o.content!%3D%3Da.content)%7Bvar%20i%3Da.content%2B%22%22%3B(%22%27%22%3D%3D%3Di%5B0%5D%7C%7C%27%22%27%3D%3D%3Di%5B0%5D)%26%26(i%3Di.replace(%2F(%5E%5B%27%22%5D)%7C(%5B%27%22%5D%24)%2Fg%2C%22%22))%3Bvar%20l%3D%22url%22%3D%3D%3Di.substr(0%2C3)%2Cs%3De.createElement(l%3F%22img%22%3A%22span%22)%3Breturn%20s.className%3Dve%2B%22-element%20%22%2CObject.keys(a).filter(Q).forEach(function(t)%7Btry%7Bs.style%5Bt%5D%3Da%5Bt%5D%7Dcatch(e)%7Bme.log(%5B%22Tried%20to%20assign%20readonly%20property%20%22%2Ct%2C%22Error%3A%22%2Ce%5D)%7D%7D)%2Cl%3Fs.src%3Dme.parseBackgroundImage(i)%5B0%5D.args%5B0%5D%3As.innerHTML%3Di%2Cs%7D%7Dfunction%20Q(e)%7Breturn%20isNaN(t.parseInt(e%2C10))%7Dfunction%20J(t%2Ce%2Cn%2Cr)%7Bvar%20a%3DMath.round(r.left%2Bn.left)%2Co%3DMath.round(r.top%2Bn.top)%3Bt.createPattern(e)%2Ct.translate(a%2Co)%2Ct.fill()%2Ct.translate(-a%2C-o)%7Dfunction%20K(t%2Ce%2Cn%2Cr%2Ca%2Co%2Ci%2Cl)%7Bvar%20s%3D%5B%5D%3Bs.push(%5B%22line%22%2CMath.round(a)%2CMath.round(o)%5D)%2Cs.push(%5B%22line%22%2CMath.round(a%2Bi)%2CMath.round(o)%5D)%2Cs.push(%5B%22line%22%2CMath.round(a%2Bi)%2CMath.round(l%2Bo)%5D)%2Cs.push(%5B%22line%22%2CMath.round(a)%2CMath.round(l%2Bo)%5D)%2Cj(t%2Cs)%2Ct.save()%2Ct.clip()%2CJ(t%2Ce%2Cn%2Cr)%2Ct.restore()%7Dfunction%20Z(t%2Ce%2Cn)%7Bm(t%2Ce.left%2Ce.top%2Ce.width%2Ce.height%2Cn)%7Dfunction%20te(t%2Ce%2Cn%2Cr%2Ca)%7Bvar%20o%3Dme.BackgroundSize(t%2Ce%2Cr%2Ca)%2Ci%3Dme.BackgroundPosition(t%2Ce%2Cr%2Ca%2Co)%2Cl%3Dme.BackgroundRepeat(t%2Ca)%3Bswitch(r%3Dne(r%2Co)%2Cl)%7Bcase%22repeat-x%22%3Acase%22repeat%20no-repeat%22%3AK(n%2Cr%2Ci%2Ce%2Ce.left%2Ce.top%2Bi.top%2C99999%2Cr.height)%3Bbreak%3Bcase%22repeat-y%22%3Acase%22no-repeat%20repeat%22%3AK(n%2Cr%2Ci%2Ce%2Ce.left%2Bi.left%2Ce.top%2Cr.width%2C99999)%3Bbreak%3Bcase%22no-repeat%22%3AK(n%2Cr%2Ci%2Ce%2Ce.left%2Bi.left%2Ce.top%2Bi.top%2Cr.width%2Cr.height)%3Bbreak%3Bdefault%3AJ(n%2Cr%2Ci%2C%7Btop%3Ae.top%2Cleft%3Ae.left%2Cwidth%3Ar.width%2Cheight%3Ar.height%7D)%7D%7Dfunction%20ee(t%2Ce%2Cn)%7Bfor(var%20r%2Ca%3Dbe(t%2C%22backgroundImage%22)%2Co%3Dme.parseBackgroundImage(a)%2Ci%3Do.length%3Bi--%3B)if(a%3Do%5Bi%5D%2Ca.args%26%260!%3D%3Da.args.length)%7Bvar%20l%3D%22url%22%3D%3D%3Da.method%3Fa.args%5B0%5D%3Aa.value%3Br%3DO(l)%2Cr%3Fte(t%2Ce%2Cn%2Cr%2Ci)%3Ame.log(%22html2canvas%3A%20Error%20loading%20background%3A%22%2Ca)%7D%7Dfunction%20ne(t%2Ce)%7Bif(t.width%3D%3D%3De.width%26%26t.height%3D%3D%3De.height)return%20t%3Bvar%20n%2Cr%3Dge.createElement(%22canvas%22)%3Breturn%20r.width%3De.width%2Cr.height%3De.height%2Cn%3Dr.getContext(%222d%22)%2C_(n%2Ct%2C0%2C0%2Ct.width%2Ct.height%2C0%2C0%2Ce.width%2Ce.height)%2Cr%7Dfunction%20re(t%2Ce%2Cn)%7Breturn%20t.setVariable(%22globalAlpha%22%2Cbe(e%2C%22opacity%22)*(n%3Fn.opacity%3A1))%7Dfunction%20ae(t)%7Breturn%20t.replace(%22px%22%2C%22%22)%7Dfunction%20oe(t)%7Bvar%20e%3D%2F(matrix)%5C((.%2B)%5C)%2F%2Cn%3Dbe(t%2C%22transform%22)%7C%7Cbe(t%2C%22-webkit-transform%22)%7C%7Cbe(t%2C%22-moz-transform%22)%7C%7Cbe(t%2C%22-ms-transform%22)%7C%7Cbe(t%2C%22-o-transform%22)%2Cr%3Dbe(t%2C%22transform-origin%22)%7C%7Cbe(t%2C%22-webkit-transform-origin%22)%7C%7Cbe(t%2C%22-moz-transform-origin%22)%7C%7Cbe(t%2C%22-ms-transform-origin%22)%7C%7Cbe(t%2C%22-o-transform-origin%22)%7C%7C%220px%200px%22%3Br%3Dr.split(%22%20%22).map(ae).map(me.asFloat)%3Bvar%20a%3Bif(n%26%26%22none%22!%3D%3Dn)%7Bvar%20o%3Dn.match(e)%3Bif(o)switch(o%5B1%5D)%7Bcase%22matrix%22%3Aa%3Do%5B2%5D.split(%22%2C%22).map(me.trimText).map(me.asFloat)%7D%7Dreturn%7Borigin%3Ar%2Cmatrix%3Aa%7D%7Dfunction%20ie(t%2Ce%2Cn%2Cr)%7Bvar%20o%3Dl(e%3Fn.width%3Af()%2Ce%3Fn.height%3Ap())%2Ci%3D%7Bctx%3Ao%2Copacity%3Are(o%2Ct%2Ce)%2CcssPosition%3Abe(t%2C%22position%22)%2Cborders%3AN(t)%2Ctransform%3Ar%2Cclip%3Ae%26%26e.clip%3Fme.Extend(%7B%7D%2Ce.clip)%3Anull%7D%3Breturn%20B(t%2Ci%2Ce)%2Ca.useOverflow%3D%3D%3D!0%26%26%2F(hidden%7Cscroll%7Cauto)%2F.test(be(t%2C%22overflow%22))%3D%3D%3D!0%26%26%2F(BODY)%2Fi.test(t.nodeName)%3D%3D%3D!1%26%26(i.clip%3Di.clip%3Fz(i.clip%2Cn)%3An)%2Ci%7Dfunction%20le(t%2Ce%2Cn)%7Bvar%20r%3D%7Bleft%3Ae.left%2Bt%5B3%5D.width%2Ctop%3Ae.top%2Bt%5B0%5D.width%2Cwidth%3Ae.width-(t%5B1%5D.width%2Bt%5B3%5D.width)%2Cheight%3Ae.height-(t%5B0%5D.width%2Bt%5B2%5D.width)%7D%3Breturn%20n%26%26(r%3Dz(r%2Cn))%2Cr%7Dfunction%20se(t%2Ce)%7Bvar%20n%3De.matrix%3Fme.OffsetBounds(t)%3Ame.Bounds(t)%3Breturn%20e.origin%5B0%5D%2B%3Dn.left%2Ce.origin%5B1%5D%2B%3Dn.top%2Cn%7Dfunction%20ce(t%2Ce%2Cn)%7Bvar%20r%2Ca%3Doe(t%2Ce)%2Co%3Dse(t%2Ca)%2Ci%3Die(t%2Ce%2Co%2Ca)%2Cl%3Di.borders%2Cs%3Di.ctx%2Cc%3Dle(l%2Co%2Ci.clip)%2Cd%3DH(t%2Co%2Cl)%2Ch%3Dwe.test(t.nodeName)%3F%22%23efefef%22%3Abe(t%2C%22backgroundColor%22)%3Bswitch(j(s%2Cd.clip)%2Cs.save()%2Cs.clip()%2Cc.height%3E0%26%26c.width%3E0%26%26!n%3F(Z(s%2Co%2Ch)%2Cee(t%2Cc%2Cs))%3An%26%26(i.backgroundColor%3Dh)%2Cs.restore()%2Cd.borders.forEach(function(t)%7Bq(s%2Ct.args%2Ct.color)%7D)%2Ct.nodeName)%7Bcase%22IMG%22%3A(r%3DO(t.getAttribute(%22src%22)))%3FA(s%2Ct%2Cr%2Co%2Cl)%3Ame.log(%22html2canvas%3A%20Error%20loading%20%3Cimg%3E%3A%22%2Bt.getAttribute(%22src%22))%3Bbreak%3Bcase%22INPUT%22%3A%2F%5E(text%7Curl%7Cemail%7Csubmit%7Cbutton%7Creset)%24%2F.test(t.type)%26%26(t.value%7C%7Ct.placeholder%7C%7C%22%22).length%3E0%26%26X(t%2Co%2Ci)%3Bbreak%3Bcase%22TEXTAREA%22%3A(t.value%7C%7Ct.placeholder%7C%7C%22%22).length%3E0%26%26X(t%2Co%2Ci)%3Bbreak%3Bcase%22SELECT%22%3A(t.options%7C%7Ct.placeholder%7C%7C%22%22).length%3E0%26%26X(t%2Co%2Ci)%3Bbreak%3Bcase%22LI%22%3AL(t%2Ci%2Cc)%3Bbreak%3Bcase%22CANVAS%22%3AA(s%2Ct%2Ct%2Co%2Cl)%7Dreturn%20i%7Dfunction%20de(t)%7Breturn%22none%22!%3D%3Dbe(t%2C%22display%22)%26%26%22hidden%22!%3D%3Dbe(t%2C%22visibility%22)%26%26!t.hasAttribute(%22data-html2canvas-ignore%22)%7Dfunction%20he(t%2Ce%2Cr)%7Breturn%20r%7C%7C(r%3Dfunction()%7B%7D)%2Cde(t)%26%26(e%3Dce(t%2Ce%2C!1)%7C%7Ce%2C!we.test(t.nodeName))%3Fue(t%2Ce%2Cr)%3A(r()%2Cn)%7Dfunction%20ue(t%2Ce%2Cn)%7Bfunction%20r(n)%7Bn.nodeType%3D%3D%3Dn.ELEMENT_NODE%3Fhe(n%2Ce%2Co)%3An.nodeType%3D%3D%3Dn.TEXT_NODE%3F(E(t%2Cn%2Ce)%2Co())%3Ao()%7Dfunction%20o()%7B0%3E%3D--l%26%26(me.log(%22finished%20rendering%20%22%2Bi.length%2B%22%20children.%22)%2Cn())%7Dvar%20i%3Dme.Children(t)%2Cl%3Di.length%2B1%3Bo()%2Ca.async%3Fi.forEach(function(t)%7BsetTimeout(function()%7Br(t)%7D%2C0)%7D)%3Ai.forEach(r)%7Dt.scroll(0%2C0)%3Bvar%20fe%3Da.elements%3D%3D%3Dn%3Fe.body%3Aa.elements%5B0%5D%2Cpe%3D0%2Cge%3Dfe.ownerDocument%2Cme%3Dd.Util%2Cye%3Dme.Support(a%2Cge)%2Cwe%3DRegExp(%22(%22%2Ba.ignoreElements%2B%22)%22)%2Cxe%3Dge.body%2Cbe%3Dme.getCSS%2Cve%3D%22___html2canvas___pseudoelement%22%2CCe%3Dge.createElement(%22style%22)%3BCe.innerHTML%3D%22.%22%2Bve%2B%27-parent%3Abefore%20%7B%20content%3A%20%22%22%20!important%3B%20display%3A%20none%20!important%3B%20%7D%27%2B%22.%22%2Bve%2B%27-parent%3Aafter%20%7B%20content%3A%20%22%22%20!important%3B%20display%3A%20none%20!important%3B%20%7D%27%2Cxe.appendChild(Ce)%2Cr%3Dr%7C%7C%7B%7D%2Ci()%7D%2Cd.Preload%3Dfunction(r)%7Bfunction%20a(t)%7BE.href%3Dt%2CE.href%3DE.href%3Bvar%20e%3DE.protocol%2BE.host%3Breturn%20e%3D%3D%3Dg%7Dfunction%20o()%7Bb.log(%22html2canvas%3A%20start%3A%20images%3A%20%22%2Bx.numLoaded%2B%22%20%2F%20%22%2Bx.numTotal%2B%22%20(failed%3A%20%22%2Bx.numFailed%2B%22)%22)%2C!x.firstRun%26%26x.numLoaded%3E%3Dx.numTotal%26%26(b.log(%22Finished%20loading%20images%3A%20%23%20%22%2Bx.numTotal%2B%22%20(failed%3A%20%22%2Bx.numFailed%2B%22)%22)%2C%22function%22%3D%3Dtypeof%20r.complete%26%26r.complete(x))%7Dfunction%20i(e%2Ca%2Ci)%7Bvar%20l%2Cs%2Cc%3Dr.proxy%3BE.href%3De%2Ce%3DE.href%2Cl%3D%22html2canvas_%22%2Bv%2B%2B%2Ci.callbackname%3Dl%2Cc%2B%3Dc.indexOf(%22%3F%22)%3E-1%3F%22%26%22%3A%22%3F%22%2Cc%2B%3D%22url%3D%22%2BencodeURIComponent(e)%2B%22%26callback%3D%22%2Bl%2Cs%3Dk.createElement(%22script%22)%2Ct%5Bl%5D%3Dfunction(e)%7B%22error%3A%22%3D%3D%3De.substring(0%2C6)%3F(i.succeeded%3D!1%2Cx.numLoaded%2B%2B%2Cx.numFailed%2B%2B%2Co())%3A(p(a%2Ci)%2Ca.src%3De)%2Ct%5Bl%5D%3Dn%3Btry%7Bdelete%20t%5Bl%5D%7Dcatch(r)%7B%7Ds.parentNode.removeChild(s)%2Cs%3Dnull%2Cdelete%20i.script%2Cdelete%20i.callbackname%7D%2Cs.setAttribute(%22type%22%2C%22text%2Fjavascript%22)%2Cs.setAttribute(%22src%22%2Cc)%2Ci.script%3Ds%2Ct.document.body.appendChild(s)%7Dfunction%20l(e%2Cn)%7Bvar%20r%3Dt.getComputedStyle(e%2Cn)%2Ca%3Dr.content%3B%22url%22%3D%3D%3Da.substr(0%2C3)%26%26m.loadImage(d.Util.parseBackgroundImage(a)%5B0%5D.args%5B0%5D)%2Cu(r.backgroundImage%2Ce)%7Dfunction%20s(t)%7Bl(t%2C%22%3Abefore%22)%2Cl(t%2C%22%3Aafter%22)%7Dfunction%20c(t%2Ce)%7Bvar%20r%3Dd.Generate.Gradient(t%2Ce)%3Br!%3D%3Dn%26%26(x%5Bt%5D%3D%7Bimg%3Ar%2Csucceeded%3A!0%7D%2Cx.numTotal%2B%2B%2Cx.numLoaded%2B%2B%2Co())%7Dfunction%20h(t)%7Breturn%20t%26%26t.method%26%26t.args%26%26t.args.length%3E0%7Dfunction%20u(t%2Ce)%7Bvar%20r%3Bd.Util.parseBackgroundImage(t).filter(h).forEach(function(t)%7B%22url%22%3D%3D%3Dt.method%3Fm.loadImage(t.args%5B0%5D)%3At.method.match(%2F%5C-%3Fgradient%24%2F)%26%26(r%3D%3D%3Dn%26%26(r%3Dd.Util.Bounds(e))%2Cc(t.value%2Cr))%7D)%7Dfunction%20f(t)%7Bvar%20e%3D!1%3Btry%7Bb.Children(t).forEach(f)%7Dcatch(r)%7B%7Dtry%7Be%3Dt.nodeType%7Dcatch(a)%7Be%3D!1%2Cb.log(%22html2canvas%3A%20failed%20to%20access%20some%20element%27s%20nodeType%20-%20Exception%3A%20%22%2Ba.message)%7Dif(1%3D%3D%3De%7C%7Ce%3D%3D%3Dn)%7Bs(t)%3Btry%7Bu(b.getCSS(t%2C%22backgroundImage%22)%2Ct)%7Dcatch(r)%7Bb.log(%22html2canvas%3A%20failed%20to%20get%20background-image%20-%20Exception%3A%20%22%2Br.message)%7Du(t)%7D%7Dfunction%20p(e%2Ca)%7Be.onload%3Dfunction()%7Ba.timer!%3D%3Dn%26%26t.clearTimeout(a.timer)%2Cx.numLoaded%2B%2B%2Ca.succeeded%3D!0%2Ce.onerror%3De.onload%3Dnull%2Co()%7D%2Ce.onerror%3Dfunction()%7Bif(%22anonymous%22%3D%3D%3De.crossOrigin%26%26(t.clearTimeout(a.timer)%2Cr.proxy))%7Bvar%20l%3De.src%3Breturn%20e%3Dnew%20Image%2Ca.img%3De%2Ce.src%3Dl%2Ci(e.src%2Ce%2Ca)%2Cn%7Dx.numLoaded%2B%2B%2Cx.numFailed%2B%2B%2Ca.succeeded%3D!1%2Ce.onerror%3De.onload%3Dnull%2Co()%7D%7Dvar%20g%2Cm%2Cy%2Cw%2Cx%3D%7BnumLoaded%3A0%2CnumFailed%3A0%2CnumTotal%3A0%2CcleanupDone%3A!1%7D%2Cb%3Dd.Util%2Cv%3D0%2CC%3Dr.elements%5B0%5D%7C%7Ce.body%2Ck%3DC.ownerDocument%2CT%3DC.getElementsByTagName(%22img%22)%2CS%3DT.length%2CE%3Dk.createElement(%22a%22)%2CR%3Dfunction(t)%7Breturn%20t.crossOrigin!%3D%3Dn%7D(new%20Image)%3Bfor(E.href%3Dt.location.href%2Cg%3DE.protocol%2BE.host%2Cm%3D%7BloadImage%3Afunction(t)%7Bvar%20e%2Co%3Bt%26%26x%5Bt%5D%3D%3D%3Dn%26%26(e%3Dnew%20Image%2Ct.match(%2Fdata%3Aimage%5C%2F.*%3Bbase64%2C%2Fi)%3F(e.src%3Dt.replace(%2Furl%5C(%5B%27%22%5D%7B0%2C%7D%7C%5B%27%22%5D%7B0%2C%7D%5C)%24%2Fgi%2C%22%22)%2Co%3Dx%5Bt%5D%3D%7Bimg%3Ae%7D%2Cx.numTotal%2B%2B%2Cp(e%2Co))%3Aa(t)%7C%7Cr.allowTaint%3D%3D%3D!0%3F(o%3Dx%5Bt%5D%3D%7Bimg%3Ae%7D%2Cx.numTotal%2B%2B%2Cp(e%2Co)%2Ce.src%3Dt)%3AR%26%26!r.allowTaint%26%26r.useCORS%3F(e.crossOrigin%3D%22anonymous%22%2Co%3Dx%5Bt%5D%3D%7Bimg%3Ae%7D%2Cx.numTotal%2B%2B%2Cp(e%2Co)%2Ce.src%3Dt)%3Ar.proxy%26%26(o%3Dx%5Bt%5D%3D%7Bimg%3Ae%7D%2Cx.numTotal%2B%2B%2Ci(t%2Ce%2Co)))%7D%2CcleanupDOM%3Afunction(a)%7Bvar%20i%2Cl%3B%0Aif(!x.cleanupDone)%7Ba%26%26%22string%22%3D%3Dtypeof%20a%3Fb.log(%22html2canvas%3A%20Cleanup%20because%3A%20%22%2Ba)%3Ab.log(%22html2canvas%3A%20Cleanup%20after%20timeout%3A%20%22%2Br.timeout%2B%22%20ms.%22)%3Bfor(l%20in%20x)if(x.hasOwnProperty(l)%26%26(i%3Dx%5Bl%5D%2C%22object%22%3D%3Dtypeof%20i%26%26i.callbackname%26%26i.succeeded%3D%3D%3Dn))%7Bt%5Bi.callbackname%5D%3Dn%3Btry%7Bdelete%20t%5Bi.callbackname%5D%7Dcatch(s)%7B%7Di.script%26%26i.script.parentNode%26%26(i.script.setAttribute(%22src%22%2C%22about%3Ablank%22)%2Ci.script.parentNode.removeChild(i.script))%2Cx.numLoaded%2B%2B%2Cx.numFailed%2B%2B%2Cb.log(%22html2canvas%3A%20Cleaned%20up%20failed%20img%3A%20%27%22%2Bl%2B%22%27%20Steps%3A%20%22%2Bx.numLoaded%2B%22%20%2F%20%22%2Bx.numTotal)%7Dt.stop!%3D%3Dn%3Ft.stop()%3Ae.execCommand!%3D%3Dn%26%26e.execCommand(%22Stop%22%2C!1)%2Ce.close!%3D%3Dn%26%26e.close()%2Cx.cleanupDone%3D!0%2Ca%26%26%22string%22%3D%3Dtypeof%20a%7C%7Co()%7D%7D%2CrenderingDone%3Afunction()%7Bw%26%26t.clearTimeout(w)%7D%7D%2Cr.timeout%3E0%26%26(w%3Dt.setTimeout(m.cleanupDOM%2Cr.timeout))%2Cb.log(%22html2canvas%3A%20Preload%20starts%3A%20finding%20background-images%22)%2Cx.firstRun%3D!0%2Cf(C)%2Cb.log(%22html2canvas%3A%20Preload%3A%20Finding%20images%22)%2Cy%3D0%3BS%3Ey%3By%2B%3D1)m.loadImage(T%5By%5D.getAttribute(%22src%22))%3Breturn%20x.firstRun%3D!1%2Cb.log(%22html2canvas%3A%20Preload%3A%20Done.%22)%2Cx.numTotal%3D%3D%3Dx.numLoaded%26%26o()%2Cm%7D%2Cd.Renderer%3Dfunction(t%2Cr)%7Bfunction%20a(t%2Ce)%7Breturn%22children%22%3D%3D%3Dt%3F-1%3A%22children%22%3D%3D%3De%3F1%3At-e%7Dfunction%20o(t)%7Bfunction%20e(t)%7BObject.keys(t).sort(a).forEach(function(n)%7Bvar%20r%3D%5B%5D%2Ca%3D%5B%5D%2Ci%3D%5B%5D%2Cl%3D%5B%5D%3Bt%5Bn%5D.forEach(function(t)%7Bt.node.zIndex.isPositioned%7C%7C1%3Et.node.zIndex.opacity%3Fi.push(t)%3At.node.zIndex.isFloated%3Fa.push(t)%3Ar.push(t)%7D)%2Cfunction%20s(t)%7Bt.forEach(function(t)%7Bl.push(t)%2Ct.children%26%26s(t.children)%7D)%7D(r.concat(a%2Ci))%2Cl.forEach(function(t)%7Bt.context%3Fe(t.context)%3Ao.push(t.node)%7D)%7D)%7Dvar%20r%2Co%3D%5B%5D%3Breturn%20r%3Dfunction(t)%7Bfunction%20e(t%2Cr%2Ca)%7Bvar%20o%3D%22auto%22%3D%3D%3Dr.zIndex.zindex%3F0%3ANumber(r.zIndex.zindex)%2Ci%3Dt%2Cl%3Dr.zIndex.isPositioned%2Cs%3Dr.zIndex.isFloated%2Cc%3D%7Bnode%3Ar%7D%2Cd%3Da%3Br.zIndex.ownStacking%3F(i%3Dc.context%3D%7Bchildren%3A%5B%7Bnode%3Ar%2Cchildren%3A%5B%5D%7D%5D%7D%2Cd%3Dn)%3A(l%7C%7Cs)%26%26(d%3Dc.children%3D%5B%5D)%2C0%3D%3D%3Do%26%26a%3Fa.push(c)%3A(t%5Bo%5D%7C%7C(t%5Bo%5D%3D%5B%5D)%2Ct%5Bo%5D.push(c))%2Cr.zIndex.children.forEach(function(t)%7Be(i%2Ct%2Cd)%7D)%7Dvar%20r%3D%7B%7D%3Breturn%20e(r%2Ct)%2Cr%7D(t)%2Ce(r)%2Co%7Dfunction%20i(t)%7Bvar%20e%3Bif(%22string%22%3D%3Dtypeof%20r.renderer%26%26d.Renderer%5Bt%5D!%3D%3Dn)e%3Dd.Renderer%5Bt%5D(r)%3Belse%7Bif(%22function%22!%3Dtypeof%20t)throw%20Error(%22Unknown%20renderer%22)%3Be%3Dt(r)%7Dif(%22function%22!%3Dtypeof%20e)throw%20Error(%22Invalid%20renderer%20defined%22)%3Breturn%20e%7Dreturn%20i(r.renderer)(t%2Cr%2Ce%2Co(t.stack)%2Cd)%7D%2Cd.Util.Support%3Dfunction(t%2Ce)%7Bfunction%20r()%7Bvar%20t%3Dnew%20Image%2Cr%3De.createElement(%22canvas%22)%2Ca%3Dr.getContext%3D%3D%3Dn%3F!1%3Ar.getContext(%222d%22)%3Bif(a%3D%3D%3D!1)return!1%3Br.width%3Dr.height%3D10%2Ct.src%3D%5B%22data%3Aimage%2Fsvg%2Bxml%2C%22%2C%22%3Csvg%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%27%20width%3D%2710%27%20height%3D%2710%27%3E%22%2C%22%3CforeignObject%20width%3D%2710%27%20height%3D%2710%27%3E%22%2C%22%3Cdiv%20xmlns%3D%27http%3A%2F%2Fwww.w3.org%2F1999%2Fxhtml%27%20style%3D%27width%3A10%3Bheight%3A10%3B%27%3E%22%2C%22sup%22%2C%22%3C%2Fdiv%3E%22%2C%22%3C%2FforeignObject%3E%22%2C%22%3C%2Fsvg%3E%22%5D.join(%22%22)%3Btry%7Ba.drawImage(t%2C0%2C0)%2Cr.toDataURL()%7Dcatch(o)%7Breturn!1%7Dreturn%20d.Util.log(%22html2canvas%3A%20Parse%3A%20SVG%20powered%20rendering%20available%22)%2C!0%7Dfunction%20a()%7Bvar%20t%2Cn%2Cr%2Ca%2Co%3D!1%3Breturn%20e.createRange%26%26(t%3De.createRange()%2Ct.getBoundingClientRect%26%26(n%3De.createElement(%22boundtest%22)%2Cn.style.height%3D%22123px%22%2Cn.style.display%3D%22block%22%2Ce.body.appendChild(n)%2Ct.selectNode(n)%2Cr%3Dt.getBoundingClientRect()%2Ca%3Dr.height%2C123%3D%3D%3Da%26%26(o%3D!0)%2Ce.body.removeChild(n)))%2Co%7Dreturn%7BrangeBounds%3Aa()%2CsvgRendering%3At.svgRendering%26%26r()%7D%7D%2Ct.html2canvas4%3Dfunction(e%2Cn)%7Be%3De.length%3Fe%3A%5Be%5D%3Bvar%20r%2Ca%3D%7Blogging%3A!1%2Celements%3Ae%2Cbackground%3A%22%23fff%22%2Cproxy%3Anull%2Ctimeout%3A0%2CuseCORS%3A!1%2CallowTaint%3A!1%2CsvgRendering%3A!1%2CignoreElements%3A%22IFRAME%7COBJECT%7CPARAM%22%2CuseOverflow%3A!0%2CletterRendering%3A!1%2Cchinese%3A!1%2Casync%3A!1%2Cwidth%3Anull%2Cheight%3Anull%2CtaintTest%3A!0%2Crenderer%3A%22Canvas%22%7D%3Breturn%20a%3Dd.Util.Extend(n%2Ca)%2Cd.logging%3Da.logging%2Ca.complete%3Dfunction(t)%7B(%22function%22!%3Dtypeof%20a.onpreloaded%7C%7Ca.onpreloaded(t)!%3D%3D!1)%26%26d.Parse(t%2Ca%2Cfunction(t)%7B(%22function%22!%3Dtypeof%20a.onparsed%7C%7Ca.onparsed(t)!%3D%3D!1)%26%26(r%3Dd.Renderer(t%2Ca)%2C%22function%22%3D%3Dtypeof%20a.onrendered%26%26a.onrendered(r))%7D)%7D%2Ct.setTimeout(function()%7Bd.Preload(a)%7D%2C0)%2C%7Brender%3Afunction(t%2Ce)%7Breturn%20d.Renderer(t%2Cd.Util.Extend(e%2Ca))%7D%2Cparse%3Afunction(t%2Ce)%7Breturn%20d.Parse(t%2Cd.Util.Extend(e%2Ca))%7D%2Cpreload%3Afunction(t)%7Breturn%20d.Preload(d.Util.Extend(t%2Ca))%7D%2Clog%3Ad.Util.log%7D%7D%2Ct.html2canvas4.log%3Dd.Util.log%2Ct.html2canvas4.Renderer%3D%7BCanvas%3An%7D%2Cd.Renderer.Canvas%3Dfunction(t)%7Bfunction%20r(t%2Ce)%7Bt.beginPath()%2Ce.forEach(function(e)%7Bt%5Be.name%5D.apply(t%2Ce.arguments)%7D)%2Ct.closePath()%7Dfunction%20a(t)%7Bif(-1%3D%3D%3Dl.indexOf(t.arguments%5B0%5D.src))%7Bc.drawImage(t.arguments%5B0%5D%2C0%2C0)%3Btry%7Bc.getImageData(0%2C0%2C1%2C1)%7Dcatch(e)%7Breturn%20s%3Di.createElement(%22canvas%22)%2Cc%3Ds.getContext(%222d%22)%2C!1%7Dl.push(t.arguments%5B0%5D.src)%7Dreturn!0%7Dfunction%20o(e%2Cn)%7Bswitch(n.type)%7Bcase%22variable%22%3Ae%5Bn.name%5D%3Dn.arguments%3Bbreak%3Bcase%22function%22%3Aswitch(n.name)%7Bcase%22createPattern%22%3Aif(n.arguments%5B0%5D.width%3E0%26%26n.arguments%5B0%5D.height%3E0)try%7Be.fillStyle%3De.createPattern(n.arguments%5B0%5D%2C%22repeat%22)%7Dcatch(o)%7Bh.log(%22html2canvas%3A%20Renderer%3A%20Error%20creating%20pattern%22%2Co.message)%7Dbreak%3Bcase%22drawShape%22%3Ar(e%2Cn.arguments)%3Bbreak%3Bcase%22drawImage%22%3An.arguments%5B8%5D%3E0%26%26n.arguments%5B7%5D%3E0%26%26(!t.taintTest%7C%7Ct.taintTest%26%26a(n))%26%26e.drawImage.apply(e%2Cn.arguments)%3Bbreak%3Bdefault%3Ae%5Bn.name%5D.apply(e%2Cn.arguments)%7D%7D%7Dt%3Dt%7C%7C%7B%7D%3Bvar%20i%3De%2Cl%3D%5B%5D%2Cs%3De.createElement(%22canvas%22)%2Cc%3Ds.getContext(%222d%22)%2Ch%3Dd.Util%2Cu%3Dt.canvas%7C%7Ci.createElement(%22canvas%22)%3Breturn%20function(t%2Ce%2Cr%2Ca%2Ci)%7Bvar%20l%2Cs%2Cc%2Cd%3Du.getContext(%222d%22)%2Cf%3Dt.stack%3Breturn%20u.width%3Du.style.width%3De.width%7C%7Cf.ctx.width%2Cu.height%3Du.style.height%3De.height%7C%7Cf.ctx.height%2Cc%3Dd.fillStyle%2Cd.fillStyle%3Dh.isTransparent(t.backgroundColor)%26%26e.background!%3D%3Dn%3Fe.background%3At.backgroundColor%2Cd.fillRect(0%2C0%2Cu.width%2Cu.height)%2Cd.fillStyle%3Dc%2Ca.forEach(function(t)%7Bd.textBaseline%3D%22bottom%22%2Cd.save()%2Ct.transform.matrix%26%26(d.translate(t.transform.origin%5B0%5D%2Ct.transform.origin%5B1%5D)%2Cd.transform.apply(d%2Ct.transform.matrix)%2Cd.translate(-t.transform.origin%5B0%5D%2C-t.transform.origin%5B1%5D))%2Ct.clip%26%26(d.beginPath()%2Cd.rect(t.clip.left%2Ct.clip.top%2Ct.clip.width%2Ct.clip.height)%2Cd.clip())%2Ct.ctx.storage%26%26t.ctx.storage.forEach(function(t)%7Bo(d%2Ct)%7D)%2Cd.restore()%7D)%2Ch.log(%22html2canvas%3A%20Renderer%3A%20Canvas%20renderer%20done%20-%20returning%20canvas%20obj%22)%2C1%3D%3D%3De.elements.length%26%26%22object%22%3D%3Dtypeof%20e.elements%5B0%5D%26%26%22BODY%22!%3D%3De.elements%5B0%5D.nodeName%3F(s%3Di.Util.Bounds(e.elements%5B0%5D)%2Cl%3Dr.createElement(%22canvas%22)%2Cl.width%3DMath.ceil(s.width)%2Cl.height%3DMath.ceil(s.height)%2Cd%3Dl.getContext(%222d%22)%2Cd.drawImage(u%2Cs.left%2Cs.top%2Cs.width%2Cs.height%2C0%2C0%2Cs.width%2Cs.height)%2Cu%3Dnull%2Cl)%3Au%7D%7D%7D)(window%2Cdocument)%3B"));var SaveDialog=(Nea=Backbone.View,__extends(Oea,Nea),Oea.prototype.applyTemplate=function(){var i,e,a,n=this;$(this.el).html(T.SaveDialog()),this.previousOverflow=this.model.get("$appRoot").css("overflow"),this.previousSettings={isChartDimensionsActive:this.model.get("isChartDimensionsActive"),chartDimensionsWidthPx:this.model.get("chartDimensionsWidthPx"),chartDimensionsHeightPx:this.model.get("chartDimensionsHeightPx"),currentTheme:this.model.get("currentTheme")},this.dialog=this.$el.dialog({dialogClass:"charting "+this.model.get("currentTheme"),title:"Save Chart",resizable:!1,modal:!0,draggable:!1,open:function(e){$(e.target).addClass("save-dialog-content")},close:function(){n.model.set(n.previousSettings),n.model.get("$appRoot").css({overflow:n.previousOverflow}),n.$el.dialog("destroy")},height:.95*this.model.get("$appRoot").height(),width:.95*this.model.get("$appRoot").width()}),this.$chartImage=this.$el.find(".chart-image"),this.$downloadButton=this.$el.find(".download-button"),this.$downloadInstructions=this.$el.find(".download-instructions"),this.$imgFrame=this.$el.find(".img-frame"),this.$imgLoading=this.$el.find(".img-loading"),this.$imgWrapper=this.$el.find(".img-wrapper"),this.$saveHeader=this.$el.find(".save-header"),this.$chartDimensionsThemeSection=this.$el.find(".chart-theme-section"),this.$chartDimensionsThemeSelect=this.$el.find(".chart-theme-select"),this.$chartDimensionsWidthSelect=this.$el.find(".chart-width-select"),$(this.$chartDimensionsThemeSelect).on("change",function(){return n.onOptionsChange()}),$(this.$chartDimensionsWidthSelect).on("change",function(){return n.onOptionsChange()}),this.downloadAttrSupported?(this.$downloadButton.button({icons:{primary:"ui-icon-arrowstop-1-s"}}).show(),this.$downloadInstructions.hide()):(this.$downloadButton.hide(),this.$downloadInstructions.show()),this.model.get("showThemesOptions")?(i="",e=this.model.get("supportedThemes"),a=this.model.get("supportedThemesUItext"),1<e.length?(_.each(e,function(e,t){i+='<option value="'+e+'"',n.model.get("currentTheme")===e&&(i+=' selected="selected"'),i+=">"+a[t]+"</option>"}),this.$chartDimensionsThemeSelect.append(i)):this.$chartDimensionsThemeSection.hide()):this.$chartDimensionsThemeSection.hide()},Oea.prototype.onOptionsChange=function(){var e=this.$chartDimensionsThemeSelect.prop("value")||this.model.get("currentTheme");this.model.set({isChartDimensionsActive:!0,chartDimensionsWidthPx:parseInt(this.$chartDimensionsWidthSelect.prop("value"),10),chartDimensionsHeightPx:null,currentTheme:e}),this.renderChart()},Oea.prototype.renderChart=function(){var i=this,a=.95*this.model.get("$appRoot").height(),n=.95*this.model.get("$appRoot").width();this.chart.toggleSaveLayout(!0),this.model.get("$appRoot").css({overflow:"auto"}),this.$imgLoading.show(),this.$imgWrapper.hide(),this.$downloadButton.attr("disabled",!0);var e=this.chart.$el.offset();return window.html2canvas4(this.chart.$el,{height:this.chart.$el.height()+e.top,width:this.chart.$el.width()+e.left,background:this.model.get("chartRenderBackground"),onrendered:function(e){var t="";i.model.get("stockPickerSymbol")&&i.model.get("stockPickerSymbol").name&&(t+=i.model.get("stockPickerSymbol").name.replace(/\W+/g,""),t+="-"),t+=moment().format("YYYYMMDD-hhmmss"),t+=".png",i.imageData=e.toDataURL("image/png"),i.$chartImage.attr("src",i.imageData),i.$downloadButton.attr("href",i.imageData),i.$downloadButton.attr("download",t),i.$chartImage.load(function(){i.chart.toggleSaveLayout(!1),i.model.get("$appRoot").css({overflow:"hidden"}),i.$imgLoading.hide(),i.$imgWrapper.show(),i.$downloadButton.attr("disabled",!1),i.model.set(i.previousSettings),a=Math.min(a,i.$chartImage.get(0).naturalHeight+60+i.$saveHeader.height()),n=Math.min(n,i.$chartImage.get(0).naturalWidth+50),i.dialog.dialog("option",{height:a,width:n}),i.$imgWrapper.css("top",i.$saveHeader.outerHeight())})}}),this},Oea),Nea;function Oea(e){var t=Nea.call(this,e)||this;return t.options=e,t.chart=e.chart,t.downloadAttrSupported="download"in document.createElement("a"),t.themeButtons=[],t.applyTemplate(),t.onOptionsChange(),t}var ChartIndicator=(d4a=Backbone.Model,__extends(e4a,d4a),e4a.prototype.initialize=function(){this.set(e4a.defaults)},e4a.defaults={IndicatorCode:null,IndicatorName:null,IndicatorType:null,ChartDisplayType:null,ShortName:null,MarkersValues:null,RangeValues:null,IndicatorParameters:[],IndicatorsDiscrete:[],Color:null,Order:null},e4a),d4a;function e4a(e){var t=d4a.call(this)||this;return t.set(e),t}var ChartIndicatorsCollection=(h4a=Backbone.Collection,__extends(i4a,h4a),i4a),h4a;function i4a(){var e=null!==h4a&&h4a.apply(this,arguments)||this;return e.model=ChartIndicator,e}var LevelDialog=(k4a=Backbone.View,__extends(l4a,k4a),l4a.prototype.initialize=function(e){this.options=e,this.removeLevelFn=e.removeLevelFn,this.render()},l4a.prototype.onClose=function(){$(this.dialogView).dialog("close"),this.okCallback&&this.okCallback({level:parseFloat(this.$inputBox.val()),type:this.$el.find(".level-radios input:checked").val()})},l4a.prototype.onRemoveLevel=function(e){var t,i,a=$(e.currentTarget),n=a.data("levelid"),e=a.data("type"),o=this.model.get("levels"),r=!1;if(a.parent().remove(),o){switch(e){case"entry":t=o.entry,o.entry=null,this.$levelRadios.find('input[value="entry"]').attr("disabled",!1);break;case"profit":for(r=!1,t=null,i=0;i<o.profits.length;i+=1)if(o.profits[i].id===n){t=o.profits[i],r=!0;break}r&&o.profits.splice(i,1),this.$levelRadios.find('input[value="profit"]').attr("disabled",!1);break;case"stop":for(r=!1,t=null,i=0;i<o.stops.length;i+=1)if(o.stops[i].id===n){t=o.profits[i],r=!0;break}r&&o.stops.splice(i,1),this.$levelRadios.find('input[value="stop"]').attr("disabled",!1)}this.$levelRadios.buttonset("refresh"),t.annotation.removeVisual(t.annotation,!0)}},l4a.prototype.render=function(){var e,t=this,i=this.model.get("levels"),a=this.model.get("stockPickerSymbol").decimalPlaces,n={r1:Helpers.getGUID(),r2:Helpers.getGUID(),r3:Helpers.getGUID()};if(i){if(i.entry&&(n.currentEntry=i.entry.value.toFixed(a),n.currentEntryId=i.entry.id),i.profits)for(e=0;e<i.profits.length;e+=1)n["profit"+e]=i.profits[0].value.toFixed(a),n["profit"+e+"id"]=i.profits[0].id;if(i.stops)for(e=0;e<i.stops.length;e+=1)n["stop"+e]=i.stops[0].value.toFixed(a),n["stop"+e+"id"]=i.stops[0].id}return this.$el.html(T.LevelDialog(n)),this.$inputBox=this.$el.find(".level-input"),this.$inputBox.val(this.model.get("lastAvgPrice").toFixed(this.model.get("stockPickerSymbol").decimalPlaces)),this.$inputBox.focus(function(){t.$inputBox.select()}),this.$inputBox.keypress(function(e){13===e.which&&(e.preventDefault(),t.onClose())}),this.$inputBox.spinner({step:1/Math.pow(10,a)}),this.$el.find(".ui-spinner").addClass("text-box"),this.$levelRadios=this.$el.find(".level-radios"),this.$levelRadios.buttonset(),i&&(i.entry&&this.$levelRadios.find('input[value="entry"]').attr("disabled","disabled"),i.profits&&3<=i.profits.length&&this.$levelRadios.find('input[value="profit"]').attr("disabled","disabled"),i.stops&&3<=i.stops.length&&this.$levelRadios.find('input[value="stop"]').attr("disabled","disabled"),this.$levelRadios.buttonset("refresh")),this.$el.find(".remove-list-entry").on("click",function(e){return t.onRemoveLevel(e)}),this.$levelRadios.find("input").change(function(){t.$addButton.button("option","disabled",!1)}),this},l4a.prototype.show=function(e){var t=this;this.okCallback=e,this.dialogView=this.$el.dialog({dialogClass:"charting "+this.model.get("currentTheme"),title:"Add Target",resizable:!1,modal:!0,draggable:!1,open:function(){t.$addButton=$("#ac-level-add-button")},close:function(){t.$el.dialog("destroy"),t.dialogView=null},buttons:[{id:"ac-level-add-button",text:"add",disabled:!0,click:function(){return t.onClose()}}]})},l4a),k4a;function l4a(){return null!==k4a&&k4a.apply(this,arguments)||this}var ChartToolbar=(K4a=Backbone.View,__extends(L4a,K4a),L4a.prototype.applyTemplate=function(){var i="",e=this.model.get("supportedThemes"),a=this.model.get("supportedThemesUItext");this.$el.html(T.ChartToolbar($.extend({},this.radiosIds,{viewOptions:this.model.get("viewOptions")}))),1<e.length&&(_.each(e,function(e,t){i+='<a href="#'+e+'">'+a[t]+"</a>"}),this.$(".themes-list").append(i)),this.rootDiv=this.$el.find(".RootDiv"),this.$buttonsDiv=this.$el.find(".buttons-div"),this.$toolbarLeft=this.$buttonsDiv.find(".toolbar-left"),this.$toolbarRight=this.$buttonsDiv.find(".toolbar-right"),this.setZoom(),this.setDraw(),this.setIndicators(),this.setOptions(),this.setSave(),this.setOverflow()},L4a.prototype.closeCurrentMenu=function(){this.currentMenu&&(this.model.get("isMobile")&&this.currentMenu!==this.$overflowMenu?$(this.currentMenu).dialog("close"):$(this.currentMenu).hide(),this.currentMenu=null),this.removeActiveMenuItem(this.currentMenuButton),this.currentMenuButton=null},L4a.prototype.addActiveMenuItem=function(e){this.model.set({activeMenuButtons:_.union(this.model.get("activeMenuButtons"),[e])})},L4a.prototype.removeActiveMenuItem=function(e){this.model.set({activeMenuButtons:_.without(this.model.get("activeMenuButtons"),e)})},L4a.prototype.changeTheme=function(e){this.model.set({currentTheme:e}),this.updateThemeButtons(this.model.get("currentTheme"))},L4a.prototype.createIdsForRadioBoxes=function(){return{line1:Helpers.getGUID(),line2:Helpers.getGUID(),line3:Helpers.getGUID(),trendLine:Helpers.getGUID(),horizontalLine:Helpers.getGUID(),verticalLine:Helpers.getGUID(),ellipse:Helpers.getGUID(),rectangle:Helpers.getGUID(),rotationRectangle:Helpers.getGUID(),textNote:Helpers.getGUID(),fibonacciRetracements:Helpers.getGUID(),fibonacciTimeZones:Helpers.getGUID(),fibonacciFan:Helpers.getGUID(),gannFan:Helpers.getGUID(),andrewsPitchfork:Helpers.getGUID()}},L4a.prototype.initialize2=function(e){var t=this;this.options=e,this.radiosIds=this.createIdsForRadioBoxes(),this.timeframeButtons=[],this.chartMenuItems=[],this.chartTypeButtons=[],this.crosshairTypeButtons=[],this.priceInfoButtons=[],this.lineThickness=2,this.lineColor="pink",this.loadedPeriods=[],this.chart=e.chart,this.pendingSymbol=e.pendingSymbol,this.buttons=[],this.applyTemplate(),$(document).on("click",function(){return t.onDocumentClick()}),this.listenTo(this.model,"change:activeMenuButtons",function(){return t.onModelChangeActiveMenuButtons()}),this.listenTo(this.model,"change:showDrawMenu",function(){t.model.get("showDrawMenu")?t.drawButton.show():t.drawButton.hide()}),this.listenTo(this.model,"change:showIndicators",function(){t.model.get("showIndicators")?t.$indicators.show():(t.$indicators.hide(),t.indicatorsMenu.hide())}),this.listenTo(this.model,"change:init-data-loaded",function(){t.model.get("init-data-loaded")?_.each(t.buttons,function(e){e.button("enable")}):_.each(t.buttons,function(e){e.button("disable")})})},L4a.prototype.onModelChangeActiveMenuButtons=function(){var e=this.model.get("activeMenuButtons");0<e.length?($(this.$buttonsDiv).find(".menu-button-active").removeClass("menu-button-active"),_.each(e,function(e){$(e).addClass("menu-button-active")})):$(this.$buttonsDiv).find(".menu-button-active").removeClass("menu-button-active")},L4a.prototype.setDraw=function(){var i=this;this.drawMenu=this.$el.find(".draw-menu"),$(this.drawMenu).hide(),this.drawButton=this.$el.find(".draw"),this.drawButton.button({disabled:!0}).on("click",function(e){e.preventDefault(),i.currentMenu!==i.drawMenu&&(i.openMenu(i.drawMenu,i.drawButton,"Draw"),i.updateDrawMenu())}),this.buttons.push(this.drawButton),this.$el.find(".clear-button").button().on("click",function(){$(i).trigger("remove-all-annotations")}),this.model.get("showUndoRedoButtons")?(this.$el.find(".undo-button").button({icons:{primary:"ui-icon-undo"},text:!1}).on("click",function(){$(i).trigger("undo")}),this.$el.find(".redo-button").button({icons:{primary:"ui-icon-redo"},text:!1}).on("click",function(){$(i).trigger("redo")})):($(this.el).find(".undo-button").hide(),$(this.el).find(".redo-button").hide()),this.$btnLineThickness1=this.$el.find(".lt1"),this.$btnLineThickness2=this.$el.find(".lt2"),this.$btnLineThickness3=this.$el.find(".lt3"),this.$btnLineThickness1.on("click",function(e){e.stopPropagation(),i.onLineThicknessClick(1)}),this.$btnLineThickness2.on("click",function(e){e.stopPropagation(),i.onLineThicknessClick(2)}),this.$btnLineThickness3.on("click",function(e){e.stopPropagation(),i.onLineThicknessClick(3)}),this.colorPicker=$(this.drawMenu).find(".strokeColor"),$(this.colorPicker).colorpicker({displayIndicator:!1,color:this.model.get("annotationStrokeColor")}),this.fillColorPicker=$(this.drawMenu).find(".fillColor"),$(this.fillColorPicker).colorpicker({displayIndicator:!1,color:this.model.get("annotationFillColor")}),this.fillOpacitySlider=100,this.strokeOpacitySlider=100,$($(this.drawMenu).find(".annotations a")).each(function(e,t){$(t).button().on("click",function(e){var t=$(e.currentTarget).prop("hash").substring(1);e.preventDefault(),"level"===t?new LevelDialog({model:i.model}).show(function(e){$(i).trigger("levelcreated",{type:"levelcreated",level:e.level,levelType:e.type})}):(i.closeCurrentMenu(),$(i).trigger("startdrawing",{type:"startdrawing",tool:t,lineColor:$(i.colorPicker).colorpicker("val"),lineThickness:i.lineThickness,fillColor:$(i.fillColorPicker).colorpicker("val"),strokeOpacity:100,fillOpacity:20}))})}),this.model.get("showDrawMenu")||this.drawButton.hide()},L4a.prototype.setIndicators=function(){var t=this;this.$indicators=this.$el.find(".indicators"),this.indicatorsMenu=this.$el.find(".indicators-menu"),this.indicatorsList=this.indicatorsMenu.find(".chartTypeMenu"),this.indicatorsScrollPane=this.$el.find(".scroll-pane"),this.indicatorSearchField=$(this.el).find(".ctSearch"),this.indicatorsScrollPaneApi=this.indicatorsScrollPane.jScrollPane({mouseWheelSpeed:20}).data("jsp"),this.indicatorsScrollPane.on("jsp-scroll-y",function(){t.justOpened=!0}),this.$indicators.button({disabled:!0}).on("click",function(e){t.currentMenu!==t.indicatorsMenu&&(t.indicatorsScrollPane.css("height",.7*t.appHeight),t.openMenu(t.indicatorsMenu,t.$indicators,"Indicators"),t.clearIndicatorSearch(),t.highlightedIndicator=null,t.model.get("isMobile")?t.indicatorsMenu.find(".indicator-search-container").hide():t.indicatorSearchField.focus()),t.indicatorsScrollPaneApi&&t.indicatorsScrollPaneApi.reinitialise(),e.preventDefault()}),this.buttons.push($(this.$indicators)),this.indicatorsMenu.hide(),this.indicators=new ChartIndicatorsCollection([],{comparator:"IndicatorName"}),this.indicatorsSearchResults=new ChartIndicatorsCollection([],{comparator:"IndicatorName"});var e=this.model.get("indicatorsData");this.indicators.add(e),this.listIndicators(),this.model.get("isMobile")?this.indicatorsMenu.find(".indicator-search-container").hide():(this.indicatorSearchField.keydown(function(e){return t.onIndicatorSearchKeyDown(e)}),this.indicatorSearchField.keyup(function(e){return t.onIndicatorSearchKeyUp(e)}),this.indicatorSearchField.focus(function(){return t.onIndicatorSearchFieldFocus()}),this.indicatorSearchField.blur(function(){return t.onIndicatorSearchFieldBlur()})),this.model.get("showIndicators")||(this.$indicators.hide(),this.indicatorsMenu.hide())},L4a.prototype.setOptions=function(){var t,a=this;this.options=this.$el.find(".options"),this.options.button({disabled:!0}).on("click",function(e){var t;a.currentMenu!==a.optionsMenu&&(a.openMenu(a.optionsMenu,a.options,"Options"),a.updateChartTypeMenuButtons(a.model.get("stockDisplayType")),t="none",a.model.get("showCrosshair")&&(t=a.model.get("snapToDataPoint")?"price":"cursor"),a.updateCrosshairTypeMenuButtons(t),t="off",a.model.get("showInfoBorder")&&(t="on",a.model.get("isInfoBorderInCursorMode")&&(t="cursor")),a.updatePriceInfoMenuButtons(t),a.updateThemeButtons(a.model.get("currentTheme"))),e.preventDefault()}),this.buttons.push($(this.options)),this.optionsMenu=this.$el.find(".options-menu"),this.optionsMenu.hide(),this.model.get("isMobile")&&this.optionsMenu.find(".notMobile").hide(),$(this.$el.find(".chartTypeMenu a")).each(function(e,t){var i=$(t);i.button().on("click",function(e){a.onChartTypeMenuSelect(e,i[0])}),a.chartTypeButtons.push(i[0])}),this.chartTypeMenu=this.$el.find(".chartTypeMenu"),$(this.$el.find(".crosshair-types a")).each(function(e,t){var i=$(t);i.button().on("click",function(e){a.onCrosshairTypeMenuSelect(e,i[0])}),a.crosshairTypeButtons.push(i[0])}),$(this.$el.find(".border-types a")).each(function(e,t){var i=$(t);i.button().on("click",function(e){a.onPriceInfoBorderChange(e,i[0])}),a.priceInfoButtons.push(i[0])}),this.model.get("showThemesOptions")?$(this.$el.find(".themes a")).each(function(e,t){var i=$(t);i.button().on("click",function(e){a.onThemeMenuSelect(e,i[0])}),a.themeButtons.push(i[0])}):$(this.$el.find(".themes")).hide();var e=this.optionsMenu.find("input[name=crosshair]");$(e).each(function(e,t){$(t).on("click",function(){"on"===t.value?a.model.set({showCrosshair:!0,highlightSelectedValue:!0,highlightSelectedDate:!0}):a.model.set({showCrosshair:!1,highlightSelectedValue:!1,highlightSelectedDate:!1})})}),$(this.$el.find(".settings-link")).button().on("click",function(e){e.preventDefault(),(t=new SettingsContextMenu({model:a.model})).showSettings(),$(t).on("redraw",function(){$(a).trigger("redraw")}),a.closeCurrentMenu()})},L4a.prototype.setOverflow=function(){this.$overflowButton=this.$el.find(".overflow-btn"),this.$overflowMenu=this.$el.find(".overflow-menu"),this.$overflowButton.hide(),this.$overflowMenu.hide()},L4a.prototype.setSave=function(){var t=this;this.save=$(this.el).find(".save"),this.model.get("showSaveButton")?($(this.save).button({icons:{primary:"ui-icon-save-chart"},text:!1,disabled:!0}).on("click",function(){new SaveDialog({chart:t.chart,model:t.model}).on("save-image",function(e){t.trigger("save-image",e)})}),this.buttons.push($(this.save))):this.save.hide()},L4a.prototype.setZoom=function(){var t=this;this.zoom=$(this.el).find(".zoom"),this.model.get("isZoomSelectionVisible")?($(this.zoom).button({icons:{primary:"ui-icon-chart-zoom"},text:!1,disabled:!0}).on("click",function(e){t.zooming=!t.zooming,t.updateZooming(),e.preventDefault()}),this.buttons.push($(this.zoom))):this.zoom.hide()},L4a.prototype.selectSymbol=function(e){this.model.set({stockSymbol:e})},L4a.prototype.onChartTypeMenuSelect=function(e,t){t=t.hash.substring(1);this.updateChartTypeMenuButtons(t),e.preventDefault(),this.model.set({stockDisplayType:t})},L4a.prototype.onCrosshairTypeMenuSelect=function(e,t){t=t.hash.substring(1);switch(this.updateCrosshairTypeMenuButtons(t),e.preventDefault(),t){case"none":this.chart.mainChartArea.clearCrosshair(),this.model.set("snapToDataPoint",!1),this.model.set("showCrosshair",!1),this.model.set("highlightSelectedValue",!1),this.model.set("highlightSelectedDate",!1);break;case"price":this.model.set("snapToDataPoint",!0),this.model.set("showCrosshair",!0),this.model.set("highlightSelectedValue",!0),this.model.set("highlightSelectedDate",!0);break;case"cursor":this.model.set("snapToDataPoint",!1),this.model.set("showCrosshair",!0),this.model.set("highlightSelectedValue",!0),this.model.set("highlightSelectedDate",!0);break;default:this.model.set("snapToDataPoint",!1),this.model.set("showCrosshair",!1),this.model.set("highlightSelectedValue",!1),this.model.set("highlightSelectedDate",!1)}},L4a.prototype.onDocumentClick=function(){this.currentMenu&&(this.justOpened?this.justOpened=!1:this.closeCurrentMenu())},L4a.prototype.onIndicatorMenuSelect=function(e,t){t=$(t).prop("hash").substring(1);$(this).trigger("addindicator",{type:"addindicator",indicatorCode:t}),e.preventDefault()},L4a.prototype.onLineThicknessClick=function(e){this.lineThickness=e,this.updateDrawMenu()},L4a.prototype.onPeriodDownloaded=function(t){var i,a=this;this.loadedPeriods.push(t.period);var e=_.filter(this.timeframeButtons,function(e){return(i=e.hash.substring(1))===t.period&&i!==a.model.get("dataPeriod")});_.each(e,function(e){$(e).button("option","disabled",!1)})},L4a.prototype.onPriceInfoBorderChange=function(e,t){t=t.hash.substring(1);switch(this.updatePriceInfoMenuButtons(t),e.preventDefault(),t){case"off":this.model.set({showInfoBorder:!1}),this.model.set({isInfoBorderInCursorMode:!1}),this.model.get("originalModel").showInfoBorder=!1;break;case"on":this.model.set({showInfoBorder:!0}),this.model.set({isInfoBorderInCursorMode:!1}),this.model.get("originalModel").showInfoBorder=!0;break;case"cursor":this.model.set({showInfoBorder:!0}),this.model.set({isInfoBorderInCursorMode:!0}),this.model.get("originalModel").showInfoBorder=!0;break;default:this.model.set({showInfoBorder:!0}),this.model.set({isInfoBorderInCursorMode:!1}),this.model.get("originalModel").showInfoBorder=!0}},L4a.prototype.onResize=function(e){this.appHeight=e,this.closeCurrentMenu()},L4a.prototype.openMenu=function(e,t,i){var a=this,n=$(t);this.closeCurrentMenu(),$(this).trigger("minimisecustomtoolbar");var o=_.find(this.chartMenuItems,function(e){return e.button[0]===t});if(this.model.get("isMobile")&&e!==this.$overflowMenu||o&&o.inOverflow)return $(e).dialog({title:i||"",width:"auto",height:"auto",resizable:!1,modal:!0,draggable:!1,dialogClass:"charting mobile "+this.model.get("currentTheme"),close:function(){a.currentMenu=null,$(e).dialog("destroy")}}),this.currentMenu=e,void(this.justOpened=!0);$(e).addClass("ui-widget-content").show();o=$(e).outerWidth(),i=n.position().left+n.outerWidth()/2-o/2,n=this.$el.outerWidth();(i=n<i+o+13?n-(o+13):i)<7&&(i=7);o=parseInt($(e).css("padding-top"),10)+parseInt($(e).css("padding-bottom"),10);$(e).css({"margin-top":0,"margin-left":i,"max-height":this.$el.parent().outerHeight()-($(e).position().top+o)}),this.currentMenu=e,this.currentMenuButton=t,this.addActiveMenuItem(t),this.zooming&&(this.zooming=!1,this.updateZooming()),this.justOpened=!0},L4a.prototype.onThemeMenuSelect=function(e,t){t=t.hash.substring(1);e.preventDefault(),this.changeTheme(t)},L4a.prototype.onZoomStop=function(){this.zooming=!1,this.updateZooming()},L4a.prototype.updateDrawMenu=function(){var e;switch(this.lineThickness){case 1:e=this.$btnLineThickness1;break;case 2:e=this.$btnLineThickness2;break;default:e=this.$btnLineThickness3}e.addClass("selected").siblings().removeClass("selected")},L4a.prototype.updateChartTypeMenuButtons=function(e){$(this.chartTypeButtons).each(function(){$(this).button({disabled:!1})});e=_.filter(this.chartTypeButtons,{hash:"#"+e})[0];$(e).button({disabled:!0})},L4a.prototype.updateCrosshairTypeMenuButtons=function(e){$(this.crosshairTypeButtons).each(function(){$(this).button({disabled:!1})});e=_.filter(this.crosshairTypeButtons,{hash:"#"+e})[0];$(e).button({disabled:!0})},L4a.prototype.updatePriceInfoMenuButtons=function(e){$(this.priceInfoButtons).each(function(){$(this).button({disabled:!1})});e=_.filter(this.priceInfoButtons,{hash:"#"+e})[0];$(e).button({disabled:!0})},L4a.prototype.updateThemeButtons=function(e){$(this.themeButtons).each(function(){$(this).button({disabled:!1})});e=_.filter(this.themeButtons,{hash:"#"+e})[0];$(e).button({disabled:!0})},L4a.prototype.updateZooming=function(){var e=$(this.zoom).children("span:first");this.zooming?($(e).removeClass("ui-icon-chart-zoom"),$(e).addClass("ui-icon-chart-zoom-selected"),$(this).trigger("startzoom"),this.addActiveMenuItem(this.zoom)):($(e).removeClass("ui-icon-chart-zoom-selected"),$(e).addClass("ui-icon-chart-zoom"),$(this).trigger("stopzoom"),this.removeActiveMenuItem(this.zoom))},L4a.prototype.onIndicatorSearchKeyDown=function(e){var t,i=this.indicatorsList.find("li");switch(e.which){case 13:var a=this.highlightedIndicator.find("a")[0].hash.substring(1);$(this).trigger("addindicator",{type:"addindicator",indicatorCode:a}),e.preventDefault();break;case 27:this.clearIndicatorSearch(),e.preventDefault();break;case 38:this.highlightedIndicator?(this.highlightedIndicator.removeClass("highlighted"),0<(t=this.highlightedIndicator.prev("li")).length?this.highlightedIndicator=t.addClass("highlighted"):this.highlightedIndicator=i.last().addClass("highlighted")):this.highlightedIndicator=i.last().addClass("highlighted"),this.indicatorsScrollPaneApi&&this.indicatorsScrollPaneApi.scrollToElement(this.highlightedIndicator),e.preventDefault();break;case 40:this.highlightedIndicator?(this.highlightedIndicator.removeClass("highlighted"),0<(t=this.highlightedIndicator.next("li")).length?this.highlightedIndicator=t.addClass("highlighted"):this.highlightedIndicator=i.eq(0).addClass("highlighted")):this.highlightedIndicator=i.eq(0).addClass("highlighted"),this.indicatorsScrollPaneApi&&this.indicatorsScrollPaneApi.scrollToElement(this.highlightedIndicator),e.preventDefault();break;default:this.listIndicators()}},L4a.prototype.onIndicatorSearchKeyUp=function(e){13===e.which||27===e.which||38===e.which||40===e.which?e.preventDefault():this.listIndicators()},L4a.prototype.onIndicatorSearchFieldFocus=function(){this.indicatorSearchField.addClass("active")},L4a.prototype.onIndicatorSearchFieldBlur=function(){this.indicatorSearchField.removeClass("active"),this.highlightedIndicator&&this.highlightedIndicator.removeClass("highlighted")},L4a.prototype.clearIndicatorSearch=function(){this.indicatorSearchField.val(""),this.highlightedIndicator=null,this.listIndicators()},L4a.prototype.listIndicators=function(t){var e,i,a=this;void 0===t&&(t=""),e=(t=this.indicatorSearchField.val())?(e=this.indicators.filter(function(e){return-1!==e.get("IndicatorName").toLowerCase().indexOf(t.toLowerCase())}),this.indicatorsSearchResults.reset(e)):this.indicators,this.indicatorsList.empty(),0<e.length?e.forEach(function(e){(i=$(document.createElement("li"))).text(e.get("IndicatorName")),i.wrapInner('<a href="#'+e.get("IndicatorCode")+'">'),a.indicatorsList.append(i)}):this.indicatorsList.append($("<p>",{text:"No matches found"})),_.defer(function(){a.indicatorsScrollPaneApi&&a.indicatorsScrollPaneApi.reinitialise()}),this.indicatorsList.find("a").each(function(e,t){var i=$(t);i.button().on("click",function(e){e.preventDefault(),a.onIndicatorMenuSelect(e,i)}),i.mouseup(function(){a.justOpened=!1})})},L4a),K4a,aga,ega,dga;function L4a(e){var t=K4a.call(this,e)||this;return t.themeButtons=[],t.initialize2(e),t}aga=jQuery,window,aga.uaMatch=function(e){e=e.toLowerCase();e=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:e[1]||"",version:e[2]||"0"}},aga.browser||(dga={},(ega=aga.uaMatch(navigator.userAgent)).browser&&(dga[ega.browser]=!0,dga.version=ega.version),dga.chrome?dga.webkit=!0:dga.webkit&&(dga.safari=!0),aga.browser=dga);var App=(hga=Backbone.View,__extends(iga,hga),iga.prototype.addIndicators=function(e){var t,i=this,a=function(){i.chart.isStockLoaded?_.each(e,function(e){t=e.indicatorCode||IndicatorCalculator.getIndicatorCode(e.indicatorId),i.chart.indicatorsManager.addDefaultIndicator(t,e.parametersValues)}):setTimeout(a,100)};this.chart&&this.chart.indicatorsManager&&a()},iga.prototype.clearIndicators=function(){this.chart&&this.chart.indicatorsManager&&this.chart.indicatorsManager.clear()},iga.prototype.disableSelect=function(e){$($(e).children()[0]).attr("unselectable","on").css("user-select","none").on("selectstart",!1)},iga.prototype.changeAppThemeClassname=function(){var t=this,e=this.chartModel.get("currentTheme"),i=this.chartModel.get("supportedThemes");_.each(i,function(e){t.rootDiv.removeClass(e)}),this.rootDiv.addClass(e)},iga.prototype.displayChart=function(e){this.displayChart2(e)},iga.prototype.displayChart2=function(e){e&&this.chartToolbar?this.chartToolbar.selectSymbol(e):this.pendingSymbol=e},iga.prototype.getDefaultChartModel=function(e){var t={};return this.isTouchDevice()&&(t.isMobile=!0,t.isTouch=!0),e.hasOwnProperty("api")&&(t.api=e.api),new ChartModel(t)},iga.prototype.initialize=function(e){var a=Backbone.sync;if(this.api=e.api,this.options=e,Backbone.sync=function(e,t,i){return(i=i||{}).crossDomain||(i.crossDomain=!0),i.xhrFields||(i.xhrFields={withCredentials:!0}),a(e,t,i)},this.chartModel=this.getDefaultChartModel(e),e.settingsModel&&this.processComponentArgs(e),e.pendingPortalEvents&&0<e.pendingPortalEvents.length)for(var t=e.pendingPortalEvents.length-1;0<=t;t++)if("show-stock"===e.pendingPortalEvents[t].name){e.marketId=e.pendingPortalEvents[t].params.marketId;break}$(this.el).html(T.app()),this.rootDiv=this.$el.find(".ChartRoot"),this.chartDiv=this.$el.find(".ChartDiv"),this.chartToolbarDiv=this.$el.find(".ChartToolbar"),this.disclaimer=this.$el.find(".disclaimer"),this.$noData=this.$el.find(".no-data"),this.$noData.hide(),e.hasOwnProperty("renderedCallback")&&(this.renderedCallback=e.renderedCallback),this.disableSelect(document),this.initChart(),this.displayChart2(this.chartModel.get("marketId"))},iga.prototype.initChart=function(){var e,i=this;if(this.changeAppThemeClassname(),this.chartModel.setColorsForCurrentTheme(!1),this.componetStyles){for(e in this.componetStyles)this.componetStyles.hasOwnProperty(e)&&null===this.componetStyles[e]&&(this.componetStyles[e]=this.chartModel.get(e));this.chartModel.set(this.componetStyles,{silent:!0}),this.componetStyles=null}this.currentTheme=this.chartModel.get("currentTheme"),this.listenTo(this.chartModel,"change:currentTheme",function(){return i.onCurrentThemeChanged()}),this.listenTo(this.chartModel,"change:fromDateDisplayVS",function(){var e=moment(i.chartModel.get("fromDateDisplayVS")).toISOString();i.api.getPropertyMeta("Basics.viewFrom")&&"viewstate"===i.api.getPropertyMeta("Basics.viewFrom").type&&i.api.setProperty("Basics.viewFrom",e)}),this.listenTo(this.chartModel,"change:toDateDisplayVS",function(){var e=moment(i.chartModel.get("toDateDisplayVS")).toISOString();i.api.getPropertyMeta("Basics.viewTo")&&"viewstate"===i.api.getPropertyMeta("Basics.viewTo").type&&i.api.setProperty("Basics.viewTo",e)}),this.chartModel.get("isMobile")&&this.$el.find(".ChartRoot").addClass("mobile"),this.chartModel.set("componentApi",this.api),this.chart=new Chart({el:this.chartDiv,model:this.chartModel});var t=$(this.chart);t.on("elementselected",function(e){return i.onChartElementSelected(e)}),t.on("priceRangeChanged",function(e){return $(i).trigger(e)}),t.on("pattern-selected-on-chart",function(e){$(i).trigger(e)}),t.on("chart-rendered",function(){$(i).trigger("chart-rendered",{type:"chart-rendered",symbol:i.chartModel.get("stockSymbol")}),i.renderedCallback&&i.renderedCallback()}),t.on("change-stock",function(e){i.displayChart(e.marketId)}),this.chartModel.on("change:granularity",function(){$(i).trigger("granularity-changed",{type:"granularity-changed",granularity:i.chartModel.get("granularity")})}),this.customToolbar&&$(this.customToolbar).on("addindicator",function(e,t){$.proxy(i.chart.addDefaultIndicator(t.indicatorCode),i.chart)}),this.initChartToolbar(),this.onResize()},iga.prototype.initChartToolbar=function(){var i=this;this.showChartToolbar||this.chartToolbarDiv.css({height:"0",overflow:"hidden"}),this.chartToolbar=new ChartToolbar({el:this.chartToolbarDiv,model:this.chartModel,chart:this.chart,pendingSymbol:this.pendingSymbol}),this.chart.chartToolbar=this.chartToolbar;var e=$(this.chart);e.on("datesRangeChanged",function(e,t){$(i).trigger(t)}),e.on("zoomstop",function(e){i.chartToolbar.onZoomStop(e.startDate,e.endDate)}),e.on("periodenabled",function(e,t){i.chartToolbar.onPeriodDownloaded(e,t)}),e.on("appresize",function(){i.onResize()});e=$(this.chartToolbar);e.on("remove-all-annotations",$.proxy(this.chart.clearAnnotationsForced,this.chart)),e.on("undo",$.proxy(this.chart.undoAnnotations,this.chart)),e.on("redo",$.proxy(this.chart.redoAnnotations,this.chart)),e.on("startzoom",$.proxy(this.chart.onStartZoom,this.chart)),e.on("stopzoom",$.proxy(this.chart.onStopZoom,this.chart)),e.on("startdrawing",function(e,t){$.proxy(i.chart.startDrawing(t),i.chart)}),e.on("levelcreated",function(e,t){$.proxy(i.chart.addLevel(t.level,t.levelType),i.chart)}),e.on("addindicator",function(e,t){$.proxy(i.chart.addDefaultIndicator(t.indicatorCode),i.chart)}),e.on("no-data",function(){i.$noData.show()}),e.on("data-ok",function(){i.$noData.hide()}),this.customToolbar&&e.on("minimisecustomtoolbar",$.proxy(this.customToolbar.minimiseCustomToolbar,this.customToolbar)),e.on("redraw",function(){i.chart.mainChartArea.onResize()}),this.chartToolbar.on("save-image",function(e){i.trigger("portal-event",{name:"save-chart-image",params:e.params})}),e.on("granularity-changed",function(e,t){$(this).trigger(e,t)})},iga.prototype.initializeErrorHandler=function(e){var t=this;this.updateErrorMessage(e),this.listenTo(e,"change:error",function(){t.updateErrorMessage(e)})},iga.prototype.isTouchDevice=function(){if("ontouchstart"in window)return!0;var e=["","-webkit-","-moz-","-o-","-ms-"].map(function(e){return"("+e+"touch-enabled)"});return window.matchMedia(e.join(",")).matches},iga.prototype.onChartElementSelected=function(e){this.chartToolbar&&this.chartToolbar.showElementInfo(e.selectedItem)},iga.prototype.onDashboardThemeChanged=function(e){var t,i;if(this.chartModel.set("currentTheme",e.theme||"dark"),!e.dontOverrideColors)for(t in i=this.settingsModel.get("Style"))i.hasOwnProperty(t)&&(i[t]=this.chartModel.get(t))},iga.prototype.onDataSourceChange=function(i,e,t){var a,n=this;t?this.updateErrorMessageText(t):this.chart&&((e=_.clone(e)).change&&1<e.change.length&&(e.reset=e.items(),delete e.change,delete e.remove,delete e.add),e.reset&&(this.dataClone=null,this.dataClone=new Backbone.Collection,e.collection.each(function(e){n.dataClone.add(new Backbone.Model(e.toJSON()))})),t=_.remove(_.keys(e),function(e){return!_.includes(["collection","remove"],e)})[0],_.includes(["add","reset","change"],t)&&(e[t]=e[t].map(function(e){var t=Object.create(null);return Object.assign(t,e),!t.Time&&e.Date&&(t.Time=e.Date),t}),_.includes(["add","change"],t)&&_.each(e[t],function(t){var e=n.dataClone.find(function(e){return void 0!==e.get(i.primaryKey)&&e.get(i.primaryKey).toString()===t[i.primaryKey].toString()});e&&(t.Time&&"Time"!==i.primaryKey&&e.set({Time:t.Time}),t.Date&&"Date"!==i.primaryKey&&e.set({Date:t.Date}),e.get("Time")||e.set({Time:e.get("Date")}))})),e.reset?(e.reset=_.sortBy(e.reset,function(e){return e.Time.i}),1<e.reset.length&&(a=e.reset.pop()),this.dataSourceDataReset=e,this.onDataSourceReload(),a&&this.onDataSourceLivePrice(a)):!e.add&&!e.remove&&e.change&&1===e.change.length&&this.liveCandle&&(e.change[0].Date&&e.change[0].Date.i===this.liveCandle.Time.i||e.change[0].Time&&e.change[0].Time.i===this.liveCandle.Time.i)?(e.change[0].Time=e.change[0].Date||e.change[0].Time,this.onDataSourceLivePrice(e.change[0])):(e.add||e.remove)&&(this.liveCandle&&(this.liveCandle=null),this.chart.dynamicPricesManager.flush(),this.chart.mainChartArea.allSeries[0].displaySeries[0].clearLiveElement(),e.remove&&_.each(e.remove,function(t){var e=n.dataClone.find(function(e){return void 0!==e.get(i.primaryKey)&&e.get(i.primaryKey).toString()===t[i.primaryKey].toString()});n.dataClone.remove(e)}),e.add&&_.each(e.add,function(e){n.dataClone.add(new Backbone.Model(e))}),this.dataSourceDataReset={reset:_.map(this.dataClone.models,function(e){return e.attributes})},a=this.dataSourceDataReset.reset.pop(),this.onDataSourceReload(),this.onDataSourceLivePrice(a)))},iga.prototype.onDataSourceLivePrice=function(e){var t;e&&(this.liveCandle=_.extend(this.liveCandle||{},e),t=QuickBase.Tools.convertKDBTemporalToMoment(e.Time),t=new Date(t.year(),t.month(),t.day()-1,t.hours(),t.minutes(),t.seconds()),this.chart.setLivePrice({marketId:this.chart.model.get("stockSymbol"),printedAt:t,bid:e.Open,offer:e.Open,volume:e.Volume}),this.chart.setLivePrice({marketId:this.chart.model.get("stockSymbol"),printedAt:t,bid:e.High,offer:e.High,volume:e.Volume}),this.chart.setLivePrice({marketId:this.chart.model.get("stockSymbol"),printedAt:t,bid:e.Low,offer:e.Low,volume:e.Volume}),this.chart.setLivePrice({marketId:this.chart.model.get("stockSymbol"),printedAt:t,bid:e.Close,offer:e.Close,volume:e.Volume}))},iga.prototype.calcGranularity=function(){var e,t,i,a="OneMinute",n=0,o=this.dataSourceDataReset.reset;if(o&&o.length&&1<o.length&&(o[0].Date||o[0].Time)){for(var r=o.length,s=1;s<(o.length<10?o.length:10);s+=1){var l=o[r-s].Date||o[r-s].Time,d=o[r-(s+1)].Date||o[r-(s+1)].Time,l=QuickBase.Tools.convertKDBTemporalToMoment(l),d=QuickBase.Tools.convertKDBTemporalToMoment(d),d=l.diff(d).valueOf(),d=Math.abs(d);(!n||d<n)&&(n=d)}e=moment.duration(n).asMinutes(),t=moment.duration(n).asHours(),i=moment.duration(n).asDays(),e<=1?a="OneMinute":2<=e&&e<3?a="TwoMinute":3<=e&&e<5?a="ThreeMinute":5<=e&&e<15?a="FiveMinute":15<=e&&e<30?a="FifteenMinute":30<=e&&e<60?a="ThirtyMinute":4<=t&&t<24?a="FourHour":1<=i&&i<7?a="OneDay":7<=i&&i<30?a="OneWeek":30<=i&&(a="OneMonth")}return a},iga.prototype.onDataSourceReload=function(e){var t,i=this;void 0===e&&(e=!1),this.dataSourceDataReset&&(t=this.calcGranularity(),this.chart.model.set({pinLastDataPoint:e},{silent:!0}),e||this.chartModel.set({fromDateDisplay:null,toDateDisplay:null},{silent:!0}),this.chart.beforeStockLoad(e),this.chartModel.get("stockSymbol")&&this.chartModel.get("granularity")===t||(this.chartModel.set("granularity",t),this.chart.stockDataProvider.getStock("XXX",t,this.chart.stockDataProvider.getDeltaGranularity(t),!0,null,null)),this.chart.stockDataProvider.onDataSourceData(this.dataSourceDataReset,function(e){e?i.$noData.show():i.$noData.hide(),i.chart.stockDataProvider.loadingData=!1,i.chart.indicatorsManager.updateIndicator()}),this.chart.infoBorder.clear())},iga.prototype.onResize=function(){var e,t=0,i=this.$el.height();this.showChartToolbar&&(t=this.chartToolbarDiv.height(),this.chartToolbar.onResize(i));var a=i||0,n=this.showDisclaimer?this.disclaimer.outerHeight():0,i={};this.oldToolbarHeight!==t&&(i.top=t,this.oldToolbarHeight=t,e=!0),n=this.chartModel.get("isChartDimensionsActive")?this.chart.$el.height():a-(t+n),this.oldChartHeight!==n&&(i.height=n,this.oldChartHeight=n,e=!0),e&&this.chartDiv.css(i),this.chartModel.set({$appRoot:this.$el}),this.chart.onResize(),$("html").find(".charting.ui-dialog").each(function(e,t){t=$(t).find(".ui-dialog-content");t.dialog("isOpen")&&t.dialog("option","position",{my:"center",at:"center"})})},iga.prototype.onSettingsChange=function(e){var t,i,a,n=this,o={};if(!_.isUndefined(e["Basics.crosshair"]))switch(e["Basics.crosshair"]){case"none":this.chartModel.set({showCrosshair:!1,snapToDataPoint:!1});break;case"price":this.chartModel.set({showCrosshair:!0,snapToDataPoint:!0});break;case"freeflow":this.chartModel.set({showCrosshair:!0,snapToDataPoint:!1})}_.isUndefined(e["Basics.showDisclaimer"])||(e["Basics.showDisclaimer"]?(this.showDisclaimer=!0,this.disclaimer&&this.disclaimer.css("display","block")):(this.showDisclaimer=!1,this.disclaimer&&this.disclaimer.css("display","none")),this.chart&&this.onResize()),_.isUndefined(e["Basics.stockDisplayType"])||this.chartModel.set("stockDisplayType",e["Basics.stockDisplayType"]),_.isUndefined(e["Basics.showVolume"])||this.chartModel.set("showVolume",e["Basics.showVolume"]),_.isUndefined(e["Basics.showInfoBorder"])||this.chartModel.set("showInfoBorder",e["Basics.showInfoBorder"]),_.isUndefined(e["Toolbar.showDrawMenu"])||this.chartModel.set("showDrawMenu",e["Toolbar.showDrawMenu"]),_.isUndefined(e["Toolbar.showIndicators"])||this.chartModel.set("showIndicators",e["Toolbar.showIndicators"]),_.isUndefined(e["Toolbar.showChartToolbar"])||(this.showChartToolbar=e["Toolbar.showChartToolbar"],this.showChartToolbar?this.chartToolbarDiv&&this.chartToolbarDiv.css({height:"",overflow:""}):this.chartToolbarDiv&&this.chartToolbarDiv.css({height:"0",overflow:"hidden"}),this.chart&&this.onResize()),_.each(e,function(e,t){0===t.indexOf("Style")&&(o[t.split(".")[1]]=e)}),_.isEmpty(o)||this.chartModel.set(o),!_.isUndefined(e["ViewState.Focus"])&&e["ViewState.Focus"]&&(this.chartToolbar?this.chartToolbar.selectSymbol(e["ViewState.Focus"]):this.chartModel.set("marketId",e["ViewState.Focus"])),_.isUndefined(e["Basics.data"])||(t=e["Basics.data"])!==this.dataSource&&(this.dataSource&&this.api.unsubscribe(this.dataSource),this.chartModel.set("init-data-loaded",!1),t?(this.chartModel.set("dataSource",t),this.initializeErrorHandler(t),this.dataSource=t,this.api.subscribe(t,function(e,t,i){n.onDataSourceChange(e,t,i)})):this.dataSource&&(this.dataSource=null,this.chartModel.set("dataSource",null),a=this.chartModel.get("marketId"),this.chartToolbar.selectSymbol(null),this.chartModel.set("stockSymbol",null),this.chart.clear(!0,!0,!0),this.chartToolbar.selectSymbol(a))),!_.isUndefined(e["Basics.viewFrom"])&&this.api.getProperty("Basics.viewFrom")&&(i=moment(e["Basics.viewFrom"]).toDate(),this.chart&&(this.chart.model.get("fromDateDisplay")?this.chart.displayRange(i,this.chart.model.get("toDateDisplayVS"),!0):this.chart.model.set({fromDateDisplayVS:i},{silent:!0}))),!_.isUndefined(e["Basics.viewTo"])&&this.api.getProperty("Basics.viewTo")&&(i=moment(e["Basics.viewTo"]).toDate(),this.chart&&(this.chart.model.get("toDateDisplay")?this.chart.displayRange(this.chart.model.get("fromDateDisplayVS"),i,!0):this.chart.model.set({toDateDisplayVS:i},{silent:!0}))),_.isUndefined(e["Basics.decimalPlaces"])||(a=this.chartModel.get("originalDecimalPlaces"),this.chartModel.set("originalDecimalPlaces",e["Basics.decimalPlaces"]),this.chartModel.set("mainChartAreaValuesAxisDecimalPlaces",e["Basics.decimalPlaces"]),a!==e["Basics.decimalPlaces"]&&this.onDataSourceReload()),_.isUndefined(e["Basics.annotations"])||this.chartModel.set("savedAnnotations",e["Basics.annotations"]),_.isUndefined(e["Basics.indicators"])||this.chartModel.set("saved_indicators",e["Basics.indicators"])},iga.prototype.setOldOptions=function(){this.chartModel.set({marketId:null,customChartName:!1,showMainChartName:!1,showGranularityAsChartName:!1,showThemesOptions:!1,themeSettingsConfig:{currentTheme:"dark",supportedThemes:["light","dark"],supportedThemesUItext:["Light","Dark"]},viewOptions:[{displayName:"1 Minute",value:"OneMinute",defaultframe:1,isDefault:!0,momentKey:"minutes",momentValue:1,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"2 Minutes",value:"TwoMinute",defaultframe:1,momentKey:"minutes",momentValue:2,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"3 Minutes",value:"ThreeMinute",defaultframe:1,momentKey:"minutes",momentValue:3,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"5 Minutes",value:"FiveMinute",defaultframe:2,momentKey:"minutes",momentValue:5,timeframes:[{displayName:"2 Hours",value:"TwoHours",momentKey:"hours",momentValue:2},{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3}]},{displayName:"15 Minutes",value:"FifteenMinute",defaultframe:2,momentKey:"minutes",momentValue:15,timeframes:[{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10}]},{displayName:"30 Minutes",value:"ThirtyMinute",defaultframe:3,momentKey:"minutes",momentValue:30,timeframes:[{displayName:"4 Hours",value:"FourHours",momentKey:"hours",momentValue:4},{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10}]},{displayName:"1 Hour",value:"SixtyMinute",defaultframe:3,momentKey:"minutes",momentValue:60,timeframes:[{displayName:"1 Day",value:"OneDay",momentKey:"days",momentValue:1},{displayName:"3 Days",value:"ThreeDays",momentKey:"days",momentValue:3},{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10},{displayName:"1 Month",value:"OneMonth",momentKey:"months",momentValue:1},{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3}]},{displayName:"4 Hours",value:"FourHour",defaultframe:2,momentKey:"hours",momentValue:4,timeframes:[{displayName:"5 Days",value:"FiveDays",momentKey:"days",momentValue:5},{displayName:"10 Days",value:"TenDays",momentKey:"days",momentValue:10},{displayName:"1 Month",value:"OneMonth",momentKey:"months",momentValue:1},{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3},{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6}]},{displayName:"Daily",value:"OneDay",defaultframe:2,momentKey:"days",momentValue:1,timeframes:[{displayName:"3 Months",value:"ThreeMonths",momentKey:"months",momentValue:3},{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6},{displayName:"1 Year",value:"OneYear",momentKey:"years",momentValue:1},{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]},{displayName:"Weekly",value:"OneWeek",defaultframe:2,momentKey:"weeks",momentValue:1,timeframes:[{displayName:"6 Months",value:"SixMonths",momentKey:"months",momentValue:6},{displayName:"1 Year",value:"OneYear",momentKey:"years",momentValue:1},{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]},{displayName:"Monthly",value:"OneMonth",defaultframe:2,momentKey:"months",momentValue:1,timeframes:[{displayName:"2 Years",value:"TwoYears",momentKey:"years",momentValue:2},{displayName:"3 Years",value:"ThreeYears",momentKey:"years",momentValue:3},{displayName:"5 Years",value:"FiveYears",momentKey:"years",momentValue:5},{displayName:"10 Years",value:"TenYears",momentKey:"years",momentValue:10}]}]})},iga.prototype.processComponentArgs=function(e){var i=this;e.settingsModel&&(this.settingsModel=e.settingsModel,this.viewModel=e.viewModel,this.dataModel=e.dataModel,this.api=e.api,this.dashboardAppModel=e.dashboardAppModel,this.dashboardViewModel=e.dashboardViewModel,this.componetStyles=e.settingsModel.get("Style"),this.setOldOptions(),this.loadValuesFromViewState(),this.onDashboardThemeChanged({dontOverrideColors:!0,theme:this.dashboardViewModel.get("DashboardTheme").toLowerCase()}),this.listenTo(this.chartModel,"change:stockDisplayType",function(e,t){i.onStockDisplayTypeChanged(e,t)}),this.listenTo(this.chartModel,"change:showInfoBorder",function(e,t){i.onShowInfoBorderChanged(e,t)}),this.listenTo(this.chartModel,"change:granularity",function(e,t){i.onGranularityChanged(e,t)}),this.listenTo(this.chartModel,"change:displayPeriod",function(e,t){i.onDisplayPeriodChanged(e,t)}),this.listenTo(this.chartModel,"change:stockSymbol",function(e,t){i.onStockSymbolChanged(e,t)}),this.listenTo(this.chartModel,"change:showCrosshair change:snapToDataPoint",function(){return i.onCrosshairChanged()}))},iga.prototype.loadValuesFromViewState=function(){var e=this.settingsModel.get("Basics"),t=this.api.loadSetting("basics_crosshair");t&&(e.crosshair=t),t=null,(t=this.api.loadSetting("stockDisplayType"))&&(e.stockDisplayType=t),t=null,(t=this.api.loadSetting("showInfoBorder"))&&(e.showInfoBorder=t),t=null,(t=this.api.loadSetting("granularity"))&&this.chartModel.set({granularity:t},{silent:!0}),t=null,(t=this.api.loadSetting("displayPeriod"))&&this.chartModel.set({displayPeriod:t},{silent:!0}),t=null,(t=this.api.loadSetting("stockSymbol"))&&this.chartModel.set({marketId:t},{silent:!0})},iga.prototype.onCrosshairChanged=function(){var e,t=this.chartModel.get("showCrosshair"),i=this.chartModel.get("snapToDataPoint");t||i?t&&i?e="price":t&&!i&&(e="freeflow"):e="none",e&&(this.api.saveSetting("basics_crosshair",e),e=$.extend({},this.settingsModel.get("Basics"),{crosshair:e}),this.settingsModel.set("Basics",e))},iga.prototype.onStockDisplayTypeChanged=function(e,t){this.api.saveSetting("stockDisplayType",t);t=$.extend({},this.settingsModel.get("Basics"),{stockDisplayType:t});this.settingsModel.set("Basics",t)},iga.prototype.onShowInfoBorderChanged=function(e,t){this.api.saveSetting("showInfoBorder",t);t=$.extend({},this.settingsModel.get("Basics"),{showInfoBorder:t});this.settingsModel.set("Basics",t)},iga.prototype.onGranularityChanged=function(e,t){this.api.saveSetting("granularity",t)},iga.prototype.onDisplayPeriodChanged=function(e,t){this.api.saveSetting("displayPeriod",t)},iga.prototype.onStockSymbolChanged=function(e,t){this.api.saveSetting("stockSymbol",t),this.api.setProperty("ViewState.Focus",t)},iga.prototype.remove=function(){return this.chart&&this.chart.remove(),Backbone.View.prototype.remove.apply(this)},iga.prototype.setLivePrice=function(e){this.chart.setLivePrice({bid:e.bid,offer:e.offer,printedAt:e.printedAt,isFast:e.isFast,real:e.real,marketId:e.marketId,volume:e.volume})},iga.prototype.setPricesRange=function(e,t,i,a){this.chart.setPricesRangePts(e,t,i,a)},iga.prototype.setTheme=function(e){this.onDashboardThemeChanged({theme:e.toLowerCase()})},iga.prototype.updateIndicator=function(e,t){this.chart&&this.chart.updateIndicatorByObjectID(e,t)},iga.prototype.onCurrentThemeChanged=function(){this.changeAppThemeClassname(),this.chartModel.setColorsForCurrentTheme(!0),this.chart.mainChartArea.onResize(),this.currentTheme=this.chartModel.get("currentTheme")},iga.prototype.updateErrorMessage=function(e){e.get("error")?this.updateErrorMessageText(e.get("error")):this.updateErrorMessageText()},iga.prototype.updateErrorMessageText=function(e){(e=void 0===e?null:e)?this.api.showErrorMessage(e):this.api.hideErrorMessage()},iga.getComponentDefinition=ComponentDefinition.getComponentDefinition,iga),hga;function iga(){return null!==hga&&hga.apply(this,arguments)||this}return App});