define(["backbone","Handlebars","moment","QuickBase","Forms","Pager","select2","BasicComponents","DataFilter","QuickBase","xlsx","css!./css/app.css"],function(C,o,e,c,p,n,a,u,l,c,s){var r,d=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),h=(g.ColumnConfigDialog=o.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,o,n){var a=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="pnlSource">\r\n    <span>'+e((i.t||t&&t.t||s).call(a,"Available Columns",{name:"t",hash:{},data:n}))+'</span>\r\n    <div class="pnlGrid"></div>\r\n</div>\r\n\r\n<div class="pnlTarget">\r\n    <span>'+e((i.t||t&&t.t||s).call(a,"Visible Columns",{name:"t",hash:{},data:n}))+'</span>\r\n    <div class="pnlGrid"></div>\r\n</div>\r\n\r\n<div class="pnlActionButtons">\r\n    <button class="btnMoveToSource">move to source</button><br /><br />\r\n    <button class="btnMoveToTarget">move to target</button><br /><br /><br />\r\n    <button class="btnMoveUp">move up</button><br /><br />\r\n    <button class="btnMoveDown">move down</button><br />\r\n</div>\r\n\r\n<label class="lblRetainColumnWidths">\r\n    <input type="checkbox" class="chkRetainColumnWidths" checked="checked"/>\r\n    Retain relative column widths on reload\r\n</label>'},useData:!0}),g.DateFilter=o.template({1:function(e,t,i,o,n){var a,s=e.escapeExpression;return'        <option value="'+s("function"==typeof(a=null!=(a=i.key||n&&n.key)?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"key",hash:{},data:n}):a)+'">'+s(e.lambda(t,t))+"</option>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,o,n){return'<div class="dp1"></div>\r\n<div class="dp2"></div>\r\n\r\n<select class="cmbOperator">\r\n'+(null!=(n=i.each.call(null!=t?t:e.nullContext||{},null!=t?t.operators:t,{name:"each",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?n:"")+"</select>\r\n\r\n\r\n"},useData:!0}),g.app=o.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,o,n){var a=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="Datagrid">\r\n\t<div class="title">\r\n    </div>\r\n\r\n    <div class="datagridFrame">\r\n\r\n        \r\n        <div class="pnlGroupedColumns">\r\n        </div>\r\n        <span class="lblDragDropHint" style="display:none">'+e((i.t||t&&t.t||s).call(a,"Drag a column header and drop it here for grouping",{name:"t",hash:{},data:n}))+'</span>\r\n\r\n        <div class="pnlGrid"></div>\r\n\r\n\r\n        <div class="pnlPager"></div>\r\n        <input class="txtGlobalFilter" type="text"></input>\r\n\r\n        <div class="pnlButtons" style="position:absolute; top:0; right: 0; z-index: 8;">\r\n\t\t\t<a class="lnkSubmitChanges" style="display: none;"><i class="fa fa-fw fa-upload"></i>'+e((i.t||t&&t.t||s).call(a,"Submit Changes",{name:"t",hash:{},data:n}))+'</a>\r\n\t\t\t<a class="lnkToggleEditable" style="display:none;"><i class="fa fa-fw fa-edit"></i>'+e((i.t||t&&t.t||s).call(a,"Edit",{name:"t",hash:{},data:n}))+'</a>\r\n            <a class="lnkToggleFilters"><i class="fa fa-fw fa-filter"></i><span>'+e((i.t||t&&t.t||s).call(a,"Hide Filters",{name:"t",hash:{},data:n}))+'</span></a>\r\n            <a class="lnkResetFilters"><i class="fa fa-fw fa-times"></i>'+e((i.t||t&&t.t||s).call(a,"Reset Filters",{name:"t",hash:{},data:n}))+'</a>\r\n            <span class="lnksExport link-disabled">\r\n                <i class="fa fa-fw fa-download" title="'+e((i.t||t&&t.t||s).call(a,"Download",{name:"t",hash:{},data:n}))+'"></i>\r\n                <a class="lnkExcelExport" title="'+e((i.t||t&&t.t||s).call(a,"Download the current dataset in Excel format",{name:"t",hash:{},data:n}))+'">'+e((i.t||t&&t.t||s).call(a,"Excel",{name:"t",hash:{},data:n}))+'</a>\r\n                <a class="lnkCsvExport" title="'+e((i.t||t&&t.t||s).call(a,"Download the current dataset in CSV format",{name:"t",hash:{},data:n}))+'">'+e((i.t||t&&t.t||s).call(a,"CSV",{name:"t",hash:{},data:n}))+'</a>\r\n                <a class="lnkFullExport" title="'+e((i.t||t&&t.t||s).call(a,"Download the full dataset from the server",{name:"t",hash:{},data:n}))+'">'+e((i.t||t&&t.t||s).call(a,"Full",{name:"t",hash:{},data:n}))+'</a>\r\n            </span>\r\n            <a class="lnkConfiguration" style="display:none"><i class="fa fa-fw fa-wrench"></i>'+e((i.t||t&&t.t||s).call(a,"Configuration",{name:"t",hash:{},data:n}))+'</a>\r\n            <button class="btnShowHugeData">&infin;</button>\r\n        </div>\r\n\r\n        <div class="pnlProgressBar">\r\n            <div class="divProgressBar"></div>\r\n            <div class="lblProgressBar">'+e((i.t||t&&t.t||s).call(a,"Please wait, generating huge dataset",{name:"t",hash:{},data:n}))+'</div>\r\n        </div>\r\n\r\n        <div style="position:absolute; bottom:60px; left: 0; z-index: 8; display: none; ">\r\n            <button class="btnTest1">'+e((i.t||t&&t.t||s).call(a,"group by",{name:"t",hash:{},data:n}))+'</button>\r\n            <button class="btnTest2">'+e((i.t||t&&t.t||s).call(a,"remove grouping",{name:"t",hash:{},data:n}))+'</button>\r\n            <button class="btnTest3">'+e((i.t||t&&t.t||s).call(a,"expand groups",{name:"t",hash:{},data:n}))+'</button>\r\n            <button class="btnTest4">'+e((i.t||t&&t.t||s).call(a,"collapse groups",{name:"t",hash:{},data:n}))+'</button>\r\n            <button class="btnTest5">'+e((i.t||t&&t.t||s).call(a,"b1",{name:"t",hash:{},data:n}))+'</button>\r\n            <button class="btnTest6">'+e((i.t||t&&t.t||s).call(a,"b2",{name:"t",hash:{},data:n}))+'</button>\r\n        </div>\r\n\r\n    </div>\r\n\t\r\n\t<div class="updateStatusFeedback">\r\n\t\t<i class="successIcon fa fa-fw fa-check"></i>\r\n\t\t<i class="errorIcon fa fa-fw fa-exclamation-circle"></i>\r\n\t\t<span class="feedbackText"></span>\r\n\t</div>\r\n</div>'},useData:!0}),g);function g(){}var f,m=(f=C.DeepModel,d(v,f),v.prototype.isLazyDataLoadingOn=function(){return _.includes(["cached","uncached"],this.get(v.KEY_LAZY_DATA_LOADING))},v.prototype.getDeltaPagingType=function(){return{cached:"OFFSET",uncached:"OFFSET_NOCACHE"}[this.get(v.KEY_LAZY_DATA_LOADING)]},v.KEY_LAZY_DATA_LOADING="Basics.LazyDataLoading",v);function v(e){return f.call(this,e)||this}var w,b={JSON_STRING:'{\n    "type": "line"\n}',JSON_SCHEMA:function(){var e,t,i,o,n,a,s,r;return w||(r={BOOLEAN:{type:"boolean"},INTEGER:{type:"integer"},NUMBER:{type:"number",minimum:0},NUMBER_NULL:{oneOf:[{type:"number"},{type:"null"}]},NUMBER_AUTO:{oneOf:[{type:"number"},{type:"string",enum:["auto"]}]},CSS_NUMBER_AUTO:{oneOf:[{type:"number"},{type:"string",pattern:"^(auto|\\d+px|\\d+%)$"}]},STRING:{type:"string"},COLOR:{pattern:"^#([\\da-fA-F]{3}){1,2}$",type:"string"},COLOR_NULL:{oneOf:[{pattern:"^#([\\da-fA-F]{3}){1,2}$",type:"string"},{type:"null"}]}},e={lineColor:_.defaults({default:"#00f"},r.COLOR),fillColor:_.defaults({default:"#cdf"},r.COLOR),defaultPixelsPerValue:_.defaults({default:3},r.NUMBER),width:_.defaults({default:"auto"},r.CSS_NUMBER_AUTO),height:_.defaults({default:"auto"},r.CSS_NUMBER_AUTO),composite:_.defaults({default:!1},r.BOOLEAN),tagValuesAttribute:_.defaults({default:"values"},r.STRING),tagOptionsPrefix:_.defaults({default:"spark"},r.STRING),enableTagOptions:_.defaults({default:!1},r.BOOLEAN),disableHighlight:_.defaults({default:!1},r.BOOLEAN),highlightLighten:_.defaults({default:1.4},r.NUMBER),tooltipClassname:_.defaults({default:"jqstooltip"},r.STRING),tooltipOffsetX:_.defaults({default:10},r.NUMBER),tooltipOffsetY:_.defaults({default:12},r.NUMBER),tooltipChartTitle:_.defaults({default:""},r.STRING),tooltipSkipNull:_.defaults({default:!0},r.BOOLEAN),tooltipPrefix:_.defaults({default:""},r.STRING),tooltipSuffix:_.defaults({default:""},r.STRING),disableHiddenCheck:_.defaults({default:!1},r.BOOLEAN),numberFormatter:_.defaults({default:!1},r.BOOLEAN),numberDigitGroupCount:_.defaults({default:3},r.INTEGER),numberDigitGroupSep:_.defaults({default:","},r.STRING),numberDecimalMark:_.defaults({default:"."},r.STRING),disableTooltips:_.defaults({default:!1},r.BOOLEAN),disableInteraction:_.defaults({default:!1},r.BOOLEAN),className:_.defaults({default:""},r.STRING)},t={type:_.defaults({default:"line",enum:["line"]},r.STRING),spotColor:_.defaults({default:"#f80"},r.COLOR),highlightSpotColor:_.defaults({default:"#5f5"},r.COLOR),highlightLineColor:_.defaults({default:"#f22"},r.COLOR),spotRadius:_.defaults({default:1.5},r.NUMBER),minSpotColor:_.defaults({default:"#f80"},r.COLOR),maxSpotColor:_.defaults({default:"#f80"},r.COLOR),lineWidth:_.defaults({default:1},r.NUMBER),normalRangeMin:_.defaults({default:null},r.NUMBER_NULL),normalRangeMax:_.defaults({default:null},r.NUMBER_NULL),normalRangeColor:_.defaults({default:"#ccc"},r.COLOR),drawNormalOnTop:_.defaults({default:!1},r.BOOLEAN),chartRangeMin:_.defaults({default:null},r.NUMBER_NULL),chartRangeMax:_.defaults({default:null},r.NUMBER_NULL),chartRangeMinX:_.defaults({default:null},r.NUMBER_NULL),chartRangeMaxX:_.defaults({default:null},r.NUMBER_NULL),tooltipFormat:_.defaults({default:"<span style='color: {{color}}'>&#9679;</span> {{prefix}}{{y}}{{suffix}}"},r.STRING),valueSpots:{oneOf:[{type:"array",default:[],items:r.COLOR},{type:"object",default:{}}]}},i={type:_.defaults({default:"bar",enum:["bar"]},r.STRING),barColor:_.defaults({default:"#3366cc"},r.COLOR),negBarColor:_.defaults({default:"#f44"},r.COLOR),stackedBarColor:{type:"array",default:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],items:r.COLOR},zeroColor:_.defaults({default:null},r.COLOR_NULL),nullColor:_.defaults({default:null},r.COLOR_NULL),zeroAxis:_.defaults({default:!0},r.BOOLEAN),barWidth:_.defaults({default:4},r.NUMBER),barSpacing:_.defaults({default:1},r.NUMBER),chartRangeMax:_.defaults({default:null},r.NUMBER_NULL),chartRangeMin:_.defaults({default:null},r.NUMBER_NULL),chartRangeClip:_.defaults({default:!1},r.BOOLEAN),colorMap:{oneOf:[{type:"array",default:[],items:r.COLOR},{type:"object",default:{}}]},tooltipFormat:_.defaults({default:"<span style='color: {{color}}'>&#9679;</span> {{prefix}}{{value}}{{suffix}}"},r.STRING)},o={type:_.defaults({default:"pie",enum:["pie"]},r.STRING),offset:_.defaults({default:0},r.NUMBER),sliceColors:{type:"array",default:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],items:r.COLOR},borderWidth:_.defaults({default:0},r.NUMBER),borderColor:_.defaults({default:"#000"},r.COLOR),tooltipFormat:_.defaults({default:"<span style='color: {{color}}'>&#9679;</span> {{value}} ({{percent.1}}%)"},r.STRING)},n={type:_.defaults({default:"tristate",enum:["tristate"]},r.STRING),barWidth:_.defaults({default:4},r.NUMBER),barSpacing:_.defaults({default:1},r.NUMBER),posBarColor:_.defaults({default:"#6f6"},r.COLOR),negBarColor:_.defaults({default:"#f44"},r.COLOR),zeroBarColor:_.defaults({default:"#999"},r.COLOR),colorMap:{oneOf:[{type:"array",default:[],items:r.COLOR},{type:"object",default:{}}]},tooltipFormat:_.defaults({default:"<span style='color: {{color}}'>&#9679;</span> {{value:map}}"},r.STRING),tooltipValueLookups:{type:"object",default:{map:{"-1":"Loss",0:"Draw",1:"Win"}}}},a={type:_.defaults({default:"discrete",enum:["discrete"]},r.STRING),lineHeight:_.defaults({default:"auto"},r.NUMBER_AUTO),thresholdColor:_.defaults({default:null},r.COLOR_NULL),thresholdValue:_.defaults({default:0},r.NUMBER),chartRangeMax:_.defaults({default:null},r.NUMBER_NULL),chartRangeMin:_.defaults({default:null},r.NUMBER_NULL),chartRangeClip:_.defaults({default:!1},r.BOOLEAN),tooltipFormat:_.defaults({default:"{{prefix}}{{value}}{{suffix}}"},r.STRING)},s={type:_.defaults({default:"bullet",enum:["bullet"]},r.STRING),targetColor:_.defaults({default:"#f33"},r.COLOR),targetWidth:_.defaults({default:3},r.NUMBER),performanceColor:_.defaults({default:"#f33"},r.COLOR),rangeColors:{type:"array",default:["#d3dafe","#a8b6ff","#7f94ff"],items:r.COLOR},base:_.defaults({default:null},r.NUMBER_NULL),tooltipFormat:_.defaults({default:"{{fieldkey:fields}} - {{value}}"},r.STRING),tooltipValueLookups:{type:"object",default:{fields:{r:"Range",p:"Performance",t:"Target"}}}},r={type:_.defaults({default:"box",enum:["box"]},r.STRING),raw:_.defaults({default:!1},r.BOOLEAN),boxLineColor:_.defaults({default:"#000"},r.COLOR),boxFillColor:_.defaults({default:"#cdf"},r.COLOR),whiskerColor:_.defaults({default:"#000"},r.COLOR),outlierLineColor:_.defaults({default:"#333"},r.COLOR),outlierFillColor:_.defaults({default:"#fff"},r.COLOR),medianColor:_.defaults({default:"#f00"},r.COLOR),showOutliers:_.defaults({default:!0},r.BOOLEAN),outlierIQR:_.defaults({default:1.5},r.NUMBER),spotRadius:_.defaults({default:1.5},r.NUMBER),target:_.defaults({default:null},r.NUMBER_NULL),targetColor:_.defaults({default:"#4a2"},r.COLOR),chartRangeMin:_.defaults({default:null},r.NUMBER_NULL),chartRangeMax:_.defaults({default:null},r.NUMBER_NULL),tooltipFormat:_.defaults({default:"{{field:fields}}: {{value}}"},r.STRING),tooltipFormatFieldlistKey:_.defaults({default:"field"},r.STRING),tooltipValueLookups:{type:"object",default:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}},w={type:"object",required:["type"],oneOf:[{type:"object",additionalProperties:!1,properties:_.extend({},e,t)},{type:"object",additionalProperties:!1,properties:_.extend({},e,i)},{type:"object",additionalProperties:!1,properties:_.extend({},e,o)},{type:"object",additionalProperties:!1,properties:_.extend({},e,n)},{type:"object",additionalProperties:!1,properties:_.extend({},e,a)},{type:"object",additionalProperties:!1,properties:_.extend({},e,s)},{type:"object",additionalProperties:!1,properties:_.extend({},e,r)}]}),w}},y=c.Tools,S={UserDefined:{type:"boolean",title:"User Defined",format:"checkbox",default:!1},Field:{title:"Data Field Name",type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"root.datagridPossibleColumns"}},DisplayName:{title:"Display Name",type:"string",default:""},Tooltip:{title:"Header Tooltip",type:"string",default:""},Sortable:{type:"boolean",format:"checkbox",default:!0},Format:{type:"string",enum:["General","Number","Formatted Number","Smart Number","Date","Time","DateTime","Percentage","Boolean","Sparkline"],default:"General"},Precision:{type:"number",title:"Precision",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},Currency:{title:"Currency Symbol",type:"string",enum:["none","USD","GBP","EUR"],default:"none"},DateFormat:{title:"Date Format",type:"string",enum:y.Formats.Date,default:"YYYY-MM-DD"},TimeFormat:{title:"Time Format",type:"string",enum:y.Formats.Time,default:"HH:mm:ss"},HighlightNegativeColor:{options:{noColor:!0},type:"gradient",title:"Negative Color",default:""},HighlightChanges:{type:"boolean",title:"Highlight Changes",format:"checkbox",default:!1},HighlightChangeDuration:{title:"Highlight Change Duration",minimum:50,maximum:1e3,type:"number",step:10,format:"range",default:200},ShowArrowsOnChange:{type:"boolean",title:"Show arrows on Change",format:"checkbox",default:!1},HighlightMinValueColor:{options:{noColor:!0},type:"gradient",title:"Min Value Color",default:""},HighlightMaxValueColor:{options:{noColor:!0},type:"gradient",title:"Max Value Color",default:""},RangeHighlightColor:{options:{noColor:!0},type:"gradient",title:"Range Color",default:""},IsRangeHighlightColorInverted:{type:"boolean",title:"Invert Range Color",format:"checkbox",default:!1},WidthWeight:{title:"Width (relative)",minimum:0,type:"number",default:1},MinWidthAbsolute:{title:"Min Width (px)",minimum:0,type:"number",default:1},PercentageColorOverride:{options:{noColor:!0},type:"gradient",default:"",title:"Percentage Color"},IsReadonly:{type:"boolean",title:"Read Only",format:"checkbox",default:!1},IsSelectable:{type:"boolean",title:"Selectable",format:"checkbox",default:!0},TextAlign:{title:"Text Align",type:"string",enum:["left","center","right"],default:"center"},Template:{type:"handlebar",data:[],default:"",columnsFieldName:"datagridPossibleColumns",templateItems:{values:{type:"object",items:_.keyBy(["thisField","thisValue","thisRawValue"])}}},SparklineOptions:{type:"json",title:"Sparkline Options",options:{jsonSchema:b.JSON_SCHEMA},default:b.JSON_STRING},Hidden:{type:"boolean",format:"checkbox",default:!1}},R={};_.each(["UserDefined","Field","DisplayName","Tooltip","WidthWeight","MinWidthAbsolute","TextAlign","Sortable","Format","Precision","HideTrailingZeroes","Currency","DateFormat","TimeFormat","HighlightNegativeColor","HighlightChanges","HighlightChangeDuration","ShowArrowsOnChange","HighlightMinValueColor","HighlightMaxValueColor","RangeHighlightColor","IsRangeHighlightColorInverted","PercentageColorOverride","IsReadonly","IsSelectable","Template","SparklineOptions","Hidden"],function(e,t){S[e].propertyOrder=1010+t,R[e]=S[e].default});var M={Name:{title:"Name",type:"string",default:""},Enabled:{type:"boolean",format:"checkbox",default:!0,options:{hidden:!0}},Target:{type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.highlightTargetPossibleValues"},default:"*"},ConditionSource:{title:"Condition Source",type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.datagridPossibleColumnsWithItself"},default:"<this>"},ConditionOperator:{title:"Condition Operator",type:"string",enum:["","search","contains","starts with","ends with","==","<",">","<=",">=","!=","Fill Left-to-Right","Fill Right-to-Left"],default:""},ConditionValue:{title:"Condition Value",type:"string",default:"previous value"},Color:{type:"gradient",options:{noColor:!0},default:""},BackgroundColor:{title:"Background Color",type:"gradient",options:{noColor:!0,gradient:!0},default:""},BorderColor:{title:"Border Color",type:"gradient",options:{noColor:!0},default:""},Icon:{type:"icon",title:"Icon",default:""},IconColor:{title:"Icon Color",type:"gradient",options:{noColor:!0},default:""},RuleType:{type:"string",title:"Rule Type",enum:["gradient","discrete"],default:"discrete",options:{hidden:!0}},RuleMin:{type:"number",title:"Rule Min",format:"number",default:0},RuleMax:{type:"number",title:"Rule Max",format:"number",default:1},RuleLimitEnabled:{type:"boolean",title:"Rule Limit",format:"checkbox",default:!1},TargetElement:{type:"string",title:"Apply Palette To",enum:["background","text","border","icon"],default:"background"},Palette:{type:"array",format:"table",title:"Color Palette",options:{collapsed:!1},uniqueItems:!1,items:{type:"object",title:"Palette Color",properties:{color:{type:"gradient",options:{gradient:!1},title:"color",default:"#ffa500"}}},default:[{color:"#b71c1c"},{color:"#F57F17"},{color:"#33691E"}]}},k={};_.each(["RuleType","Name","Enabled","Target","ConditionSource","ConditionOperator","ConditionValue","Color","BackgroundColor","BorderColor","RuleMin","RuleMax","RuleLimitEnabled","TargetElement","Icon","IconColor","Palette"],function(e,t){M[e].propertyOrder=1010+t,k[e]=M[e].default});var I={type:"object",title:"Highlight Rule",headerTemplate:"Rule {{ i1 }} {{self.Name}}",oneOf:[{title:"Discrete",options:{linked_oneof_property:{property:"RuleType",value:"discrete"}},properties:_.mapValues(M,function(e,t){e=_.cloneDeep(e);return _.set(e,"options.hidden",["Name","Target","ConditionSource","ConditionOperator","ConditionValue","Color","BackgroundColor","BorderColor","Icon","IconColor"].indexOf(t)<0),e})},{title:"Gradient",options:{additionalProperties:!1,linked_oneof_property:{property:"RuleType",value:"gradient"}},properties:_.mapValues(M,function(e,t){e=_.cloneDeep(e);return _.set(e,"options.hidden",["Name","Target","ConditionSource","Icon","RuleMin","RuleMax","RuleLimitEnabled","TargetElement","Palette"].indexOf(t)<0),e})}]},T={type:"array",title:"Custom Filters",options:{collapsed:!0},items:{type:"object",title:"Filter",uniqueItems:!0,properties:{Name:{type:"customDropdown",default:"",data:"possible_columns",watch:{possible_columns:"root.datagridPossibleColumns"}},Type:{type:"string",default:"Disabled",enum:["Selection","Server Selection","Number","DateTime","Disabled"]},Data:{type:"data",title:"Data Source",default:""}},_transform:function(e,t,i,o){"Type"===i?(_.set(t,"properties.Data.options.hidden","Server Selection"!==e.Type),o(e,t)):o()}}},D={SAMPLE_DATA:"Samples/Sample Grid Data Query",getComponentDefinition:function(e){var t,i,o,n;if(e=e||{websiteUrl:"",settingsModel:new C.Model,dataModel:{getByPath:$.noop}},i={id:21,componentName:"data grid",componentDescription:"See results from your data queries.",appKey:"Datagrid",listViewThumb:e.websiteUrl+"Images/data-table.png",ghostViewThumb:null,buildViewThumb:null,appArgs:{quickStart:[{path:"Basics.Data",message:"populate Data Source"}],json:{version:"4.5.0a",notificationEvent:null,datagridPossibleColumns:[],datagridPossibleColumnsWithItself:["<this>"],selectedColumnPossibleValues:[""],highlightTargetPossibleValues:[],sortingPossibleValues:[""],Basics:{Data:"",Filtering:"Quick Search",IsFilterVisible:!0,ShowPagingControl:!0,EnableGrouping:!0,GroupingAutoCollapse:!(t={TriggerColumn:{title:"Trigger Column",type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.highlightTargetPossibleValues"},default:"",propertyOrder:1},Trigger:{type:"string",enum:["Click","Double Click","Mouse In","Mouse Out"],default:"Click",title:"Trigger Action",propertyOrder:2}}),ShowSampleGridData:!1,KeepNonExistentColumns:!1,EnableCustomLayoutConfiguration:!1,IsEditable:!1,IsInsertable:!1,SortColumn:"",SortOrder:"ascending",KdbFilterString:"",FilterOnEnterHit:!1,ScrollValueV:0,ExperimentalMode:!1,LazyDataLoading:"disabled"},ColumnsConfiguration:[],Selection:{Mode:"Area",RowSelectionColumn:"",SelectedValue:"",SelectedCellValue:"",SelectedField:"",FollowSelectedValue:!1,DefaultFallbackOnDeselect:!0,CheckboxAlignment:"none",Actions:[]},FileExport:{ShowExportCsvButton:!0,ShowExportExcelButton:!0,ShowFullExportButton:!1,FileName:[],CsvExportDelimiter:""},Tooltip:{Position:"none",Template:F},GroupingConfiguration:[],SummaryRow_Groupings:[],HighlightRules:[],CustomFilters:[],Style:{Theme:"Dark",EvenRowBackgroundColorOverride:"#282828",OddRowBackgroundColorOverride:"#303030",SelectedRowBackgroundColor:"",RowHeight:30,HeaderRowHeight:30,HeaderTextTransformation:"none",HeaderFontWeight:"",FontFamily:"",FontSize:"",advanced:""}},schema:{type:"object",title:"Properties",_transform:function(t,e,i,o){var n,a;"Basics.Data"===i?(n=t.Basics.Data)?"disabled"!==t.Basics.LazyDataLoading?(a=_.uniqueId("getMeta_"),n.subscribe(a,{onData:function(e){t.datagridPossibleColumnsWithItself=_.concat("<this>",t.datagridPossibleColumns=e.columns.collection.map("id")),n.unsubscribe(a),o(t)}})):n.getMeta(function(e){t.datagridPossibleColumnsWithItself=_.concat("<this>",t.datagridPossibleColumns=e.columns.collection.map("id")),o(t)}):(t.datagridPossibleColumns=[],t.datagridPossibleColumnsWithItself=["<this>"],o(t)):o()},properties:{notificationEvent:{type:"array",items:{type:"string"},default:null,options:{collapsed:!0,hidden:!0}},datagridPossibleColumns:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},datagridPossibleColumnsWithItself:{type:"readOnlyArray",items:{type:"string"},default:["<this>"],options:{collapsed:!0,hidden:!0}},selectedColumnPossibleValues:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},highlightTargetPossibleValues:{type:"readOnlyArray",items:{type:"string"},default:[],options:{collapsed:!0,hidden:!0}},sortingPossibleValues:{type:"readOnlyArray",items:{type:"string"},default:[""],options:{collapsed:!0,hidden:!0}},Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{Data:{propertyOrder:1010,type:"data",title:"Data Source",default:"",format:"data"},Filtering:{propertyOrder:1020,type:"string",title:"Filtering",default:"Quick Search",enum:["Quick Search","Column Filters","Advanced Column Filters","disabled"]},IsFilterVisible:{propertyOrder:1021,type:"boolean",title:"Filter Visible",default:!0,format:"checkbox"},ShowPagingControl:{propertyOrder:1030,type:"boolean",title:"Show Paging Control",default:!0,format:"checkbox"},EnableGrouping:{propertyOrder:1040,type:"boolean",title:"Enable Grouping",default:!0,format:"checkbox"},GroupingAutoCollapse:{propertyOrder:1050,type:"boolean",title:"Auto Collapse Grouping",default:!1,format:"checkbox"},ShowSampleGridData:{propertyOrder:1070,type:"boolean",title:"Show Sample Grid Data",default:!1,format:"checkbox",options:{hidden:!0}},KeepNonExistentColumns:{propertyOrder:1071,type:"boolean",title:"Keep NonExistent Columns",default:!1,format:"checkbox"},EnableCustomLayoutConfiguration:{propertyOrder:1075,type:"boolean",title:"Custom Layout",default:!1,format:"checkbox"},IsEditable:{propertyOrder:1095,type:"boolean",title:"Enable Edit Mode",default:!1,format:"checkbox"},IsInsertable:{propertyOrder:1096,type:"boolean",title:"Enable Insert/Delete",default:!1,format:"checkbox"},SortColumn:{propertyOrder:1099,type:"string",title:"Sort Column",default:"",enumSource:"sorting_possible_values",watch:{sorting_possible_values:"root.sortingPossibleValues"}},SortOrder:{propertyOrder:1100,type:"string",title:"Sort Order",default:"ascending",enum:["ascending","descending"]},KdbFilterString:{propertyOrder:1110,type:"string",title:"KDB Filter String",default:""},FilterOnEnterHit:{propertyOrder:1120,type:"boolean",title:"Filter On Enter",default:!1,format:"checkbox"},ScrollValueV:{propertyOrder:1140,type:"number",title:"Scroll Row",default:0},ExperimentalMode:{propertyOrder:1200,type:"boolean",title:"Experimental Mode",default:!1,format:"checkbox"},LazyDataLoading:{propertyOrder:1210,type:"string",title:"Virtual Scroll",default:"disabled",enum:["cached","uncached","disabled"]}}},ColumnsConfiguration:{type:"array",format:"object",title:"Columns",options:{collapsed:!0,bulkEditor:!0},items:{type:"object",title:"Column",headerTemplate:"Column {{ i1 }}   {{#if self.DisplayName}}{{ self.DisplayName }}{{else}}{{ self.Field }}{{/if}}",options:{collapsed:!0},properties:S,watch:{DisplayName:"DisplayName",Field:"Field"},_transform:function(e,t,i,o){"Field"===i?(i=e.Field,e.DisplayName=_.isString(i)&&0!==i.indexOf("/")?i:"",o(e)):o()}}},Selection:{type:"object",title:"Selection & Routing",options:{collapsed:!0},properties:{Mode:{type:"string",title:"Selection Mode",default:"Area",enum:["Single Row","Multi Row","Area","Cell","None"]},RowSelectionColumn:{title:"Row ID Column",type:"string",enumSource:"possible_selected_columns",watch:{possible_selected_columns:"root.selectedColumnPossibleValues"},default:""},SelectedValue:{type:"viewstate",title:"Selected Row",default:""},SelectedField:{type:"viewstate",title:"Selected Column",default:""},SelectedCellValue:{type:"viewstate",title:"Selected Cell Value",default:""},FollowSelectedValue:{type:"boolean",title:"Follow Selected Row",format:"checkbox",default:!1},DefaultFallbackOnDeselect:{type:"boolean",title:"Default Fallback on Deselect",default:!0,format:"checkbox"},CheckboxAlignment:{type:"string",title:"Checkbox Alignment",default:"none",enum:["none","left","right"]},Actions:{type:"actions",fields:{map:_.extend({Current:{title:"Source Column",type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.highlightTargetPossibleValues"},default:"",propertyOrder:10}},t),nav:t,query:t,url:t}}}},FileExport:{type:"object",title:"File Export",options:{collapsed:!0},properties:{ShowExportCsvButton:{type:"boolean",title:"Show Export Csv Button",default:!0,format:"checkbox"},ShowExportExcelButton:{type:"boolean",title:"Show Export Excel Button",default:!0,format:"checkbox"},ShowFullExportButton:{type:"boolean",title:"Show Full Export Button",default:!1,format:"checkbox"},CsvExportDelimiter:{title:"CSV Export Delimiter",type:"string",format:"delimiter",default:""},FileName:{type:"array",format:"table",title:"FileName",options:{hidden:!1,collapsed:!0},items:{type:"object",title:"Filename Part",options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}}}}}},Tooltip:{type:"object",title:"Tooltip",options:{collapsed:!0},properties:{Position:{propertyOrder:1,type:"string",title:"Position",default:"none",enum:["none","right","left","cursor"]},Template:{propertyOrder:12,type:"handlebar",title:"Template",data:[],default:"",columnsFieldName:"datagridPossibleColumns",templateItems:{values:{type:"object",items:_.keyBy(["thisField","thisValue","thisRawValue"])}}}}},GroupingConfiguration:{type:"array",format:"table",title:"Grouping Columns",options:{hidden:!1,collapsed:!0},items:{type:"object",title:"Grouping Column",properties:{ColumnProperty:{title:"Column",type:"string",enumSource:"possible_selected_columns",watch:{possible_selected_columns:"root.selectedColumnPossibleValues"}}}}},SummaryRow_Groupings:{type:"array",format:"object",title:"Summary Row for Groupings",options:{hidden:!1,collapsed:!0},items:{type:"object",title:"Summary",options:{collapsed:!0},properties:{Function:{title:"Aggregate Function",type:"string",propertyOrder:1,enum:["SUM","AVG","MIN","MAX","WAVG"],default:""},Column:{type:"string",propertyOrder:2,enumSource:"possible_columns",watch:{possible_columns:"root.selectedColumnPossibleValues"}},Column2:{title:"Column 2",propertyOrder:3,type:"string",enumSource:"possible_columns",watch:{possible_columns:"root.sortingPossibleValues"},default:void 0},Label:{type:"string",propertyOrder:4,default:""},Color:{type:"gradient",propertyOrder:5,options:{noColor:!0},default:""}}}},HighlightRules:{type:"array",format:"object",title:"Highlight Rules",options:{hidden:!1,collapsed:!0},items:I},CustomFilters:T,Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{Theme:{type:"string",title:"Theme",default:"Dark",options:{hidden:!0},enum:["Light","Dark"]},DashboardTheme:{options:{hidden:!0}},EvenRowBackgroundColorOverride:{propertyOrder:100,type:"gradient",options:{noColor:!1,gradient:!1},default:"#282828",title:"Even Row Background"},OddRowBackgroundColorOverride:{propertyOrder:102,type:"gradient",options:{noColor:!1,gradient:!1},default:"#303030",title:"Odd Row Background"},SelectedRowBackgroundColor:{propertyOrder:104,type:"gradient",options:{noColor:!0,gradient:!1},default:"",title:"Selected Row Background"},RowHeight:{propertyOrder:110,type:"number",format:"number",title:"Row Height",default:30},HeaderRowHeight:{propertyOrder:115,type:"number",format:"number",title:"Header Row Height",default:30},HeaderTextTransformation:{propertyOrder:120,title:"Header Text Transformation",type:"string",enum:["uppercase","lowercase","capitalize","none"]},HeaderFontWeight:{propertyOrder:125,title:"Header Font Weight",type:"string",enum:["","normal","bold"],default:""},FontFamily:{propertyOrder:140,title:"Font Family",type:"string",enum:["","monospace","fantasy"],default:""},FontSize:{propertyOrder:145,title:"Font Size",type:"string",default:""},advanced:{propertyOrder:160,type:"css",title:"Advanced CSS",default:""}}}}}}},0<_.keys(e.settingsModel.attributes).length)for(o=D.upgrades.indexOf(_.find(D.upgrades,{version:e.settingsModel.get("version")}))+1;o<D.upgrades.length;o+=1)(n=D.upgrades[o]).fn(e.settingsModel),e.settingsModel.set("version",n.version);return e.dataModel.getByPath(D.SAMPLE_DATA)&&(i.appArgs.json.Basics.Data=D.SAMPLE_DATA),_.each(["Basics","ColumnsConfiguration","Selection","FileExport","Tooltip","GroupingConfiguration","SummaryRow_Groupings","HighlightRules","CustomFilters","Style"],function(e,t){i.appArgs.schema.properties[e].propertyOrder=990+t}),i},getColumnSettingsModel:function(e){return _.extend({},R,e)},getSettingsModel:function(e){var t=D.getComponentDefinition().appArgs.json;return $.extend(!0,t,{Basics:{ExperimentalMode:!1}},e),new C.DeepModel(t)},upgrades:[{version:"4.0.0_d14a",fn:function(e){_.each(e.get("Selection.SelectedObjectRouting"),function(e){e.IsSetOnDoubleClick=!1}),e.set({"Basics.SortColumn":"","Basics.SortOrder":"ascending",sortingPossibleValues:[""]}),e.set("FileExport.ShowExportExcelButton",!1)}},{version:"4.0.0p1",fn:function(e){e.set("FileExport.ShowFullExportButton",!1)}},{version:"4.0.0p2",fn:function(e){_.each(e.get("ColumnsConfiguration"),function(e){"#606060"===e.PercentageColorOverride&&(e.PercentageColorOverride="")})}},{version:"4.0.1s1",fn:function(e){_.each(e.get("ColumnsConfiguration"),function(e){e.Tooltip=""})}},{version:"4.0.1s1a",fn:function(e){e.set("FileExport.ShowFullExportButton",!1)}},{version:"4.1.0s3",fn:function(e){e.set("CustomFilters",[])}},{version:"4.1.1s1",fn:function(e){var t=e.get("Selection");e.set("Selection.Mode",t.RowSelectionMode?"Multi Row":"Area"),delete t.RowSelectionMode}},{version:"4.1.1s2",fn:function(e){e.set("Selection.SelectedCellValue",""),e.set("Selection.SelectedField",""),_.each(e.get("ColumnsConfiguration"),function(e){e.IsSelectable=!0})}},{version:"4.1.1s2a",fn:function(e){e.set("Style.HeaderRowHeight",30)}},{version:"4.1.1s2b",fn:function(e){e.set("Tooltip.Position","none"),e.set("Tooltip.Template",F)}},{version:"4.1.1s2c",fn:function(e){void 0===e.get("FileExport").CsvExportDelimiter&&e.set("FileExport.CsvExportDelimiter",""),e.set("Selection.CheckboxAlignment","none")}},{version:"4.3.0s1",fn:function(e){e.set("Basics.KdbFilterString","")}},{version:"4.3.0s2",fn:function(e){e.set("Basics.FilterOnEnterHit",!1)}},{version:"4.3.0s3",fn:function(e){var t=e.get("Selection.SelectedObjectRouting"),t=_.map(t,function(e){var t={_Type:"map",TriggerColumn:"*"};return t.Trigger=e.IsSetOnDoubleClick?"Double Click":"Click",t.Current=e.ColumnProperty,t.Target=e.ViewstateProperty,t});e.set("Selection.Actions",t),e.unset("Selection.SelectedObjectRouting")}},{version:"4.3.0s4",fn:function(e){e.set("Basics.ScrollValueV",0),_.each(e.get("ColumnsConfiguration"),function(e){e.IsRangeHighlightColorInverted=!1}),e.set("Basics.ExperimentalMode",!1)}},{version:"4.3.0s5",fn:function(e){e.set("Basics.IsFilterVisible",!0)}},{version:"4.3.1",fn:function(e){_.each(e.get("ColumnsConfiguration"),function(e){e.SparklineOptions=b.JSON_STRING})}},{version:"4.4.1",fn:function(e){e.set("Basics.LazyDataLoading","disabled")}},{version:"4.5.0",fn:function(e){_.each(e.get("Selection.Actions"),function(e){"Hover"===e.Trigger&&(e.Trigger="Mouse In")}),_.each(e.get("HighlightRules"),function(e){_.defaultsDeep(e,k)}),e.set("datagridPossibleColumnsWithItself",_.concat("<this>",e.get("datagridPossibleColumns")||[]))}},{version:"4.5.0a",fn:function(o){var n=c.Tools.getDefaultThemeColors("Light"),a=["Style.EvenRowBackgroundColorOverride","Style.OddRowBackgroundColorOverride"];_.forEach(["#f0f0f0","#e0e0e0"],function(e,t){var i=a[t];o.get(i)===e&&o.set(i,n[t])})}}],upgradeColumnsConfig:function(e){return _.map(e,function(e){return _.extend({},R,e)})}},F='<div style="padding:10px; background: #f0f0f0; color: #101010; font-size:11px; border:1px solid #c0c0c0; border-radius: 2px;">\r\n  {{#each this}}{{#isnt @key "thisValue"}}{{#isnt @key "thisRawValue"}}{{#isnt @key "thisField"}}<b>{{@key}}</b> : {{this}}<br>{{/isnt}}{{/isnt}}{{/isnt}}{{/each}}\r\n</div>';_.extend(D,{getDefaultJSONTemplates:function(){return{Defaults:D.getComponentDefinition().appArgs.json,ColumnsConfiguration:{ColumnsConfiguration:_.cloneDeep(R)}}},mergeWithDefault:function(e){return e&&e.attributes&&(_.defaultsDeep(e.attributes,D.getComponentDefinition().appArgs.json),_.each(e.attributes.ColumnsConfiguration,function(e){_.defaultsDeep(e,R)})),e}});var x=(E.getRegex=function(e){var t,i=/\/[gimsuy]*$/,o=e.Field,n=!1;if(0===o.indexOf("/")){var n=!0,e=o.substring(1).replace(i,""),i=o.match(i),a=i?i[0].substring(1):"";try{t=new RegExp(e,a)}catch(e){c.Log.Error("Datagrid: invalid regex.",e),t=new RegExp("^$")}}else t=new RegExp("^"+o.replace(/\*/g,"(.*)")+"$","i");return{isExact:n,regex:t}},E.isDynamic=function(e){e=e.Field||"";return 0===e.indexOf("/")||0<=e.indexOf("*")},E.isFieldMatched=function(e,t){var i="*"===e||e===t;return i=!i&&E.isDynamic({Field:e})?E.getRegex({Field:e}).regex.test(t):i},E);function E(){}function O(){var e=!1,t=!1;this.stopPropagation=function(){e=!0},this.isPropagationStopped=function(){return e},this.stopImmediatePropagation=function(){t=!0},this.isImmediatePropagationStopped=function(){return t}}function V(){this.__nonDataRow=!0}function N(){this.__group=!0,this.level=0,this.count=0,this.value=null,this.title=null,this.collapsed=!1,this.totals=null,this.rows=[],this.groups=null,this.groupingKey=null}function L(){this.__groupTotals=!0,this.group=null,this.initialized=!1}function A(){var t=null;this.isActive=function(e){return e?t===e:null!==t},this.activate=function(e){if(e!==t){if(null!==t)throw"SlickGrid.EditorLock.activate: an editController is still active, can't activate another editController";if(!e.commitCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .commitCurrentEdit()";if(!e.cancelCurrentEdit)throw"SlickGrid.EditorLock.activate: editController must implement .cancelCurrentEdit()";t=e}},this.deactivate=function(e){if(t!==e)throw"SlickGrid.EditorLock.deactivate: specified editController is not the currently active one";t=null},this.commitCurrentEdit=function(){return!t||t.commitCurrentEdit()},this.cancelCurrentEdit=function(){return!t||t.cancelCurrentEdit()}}jQuery.extend(!0,window,{Slick:{Event:function(){var s=[];this.subscribe=function(e){s.push(e)},this.unsubscribe=function(e){for(var t=s.length-1;0<=t;t--)s[t]===e&&s.splice(t,1)},this.notify=function(e,t,i,o){var n;t=t||new O,i=i||this,o=!!o;for(var a=0;a<s.length&&(o||!t.isPropagationStopped()&&!t.isImmediatePropagationStopped());a++)n=s[a].call(i,t,e);return n}},EventData:O,EventHandler:function(){var o=[];this.subscribe=function(e,t){return o.push({event:e,handler:t}),e.subscribe(t),this},this.unsubscribe=function(e,t){for(var i=o.length;i--;)if(o[i].event===e&&o[i].handler===t)return o.splice(i,1),void e.unsubscribe(t);return this},this.unsubscribeAll=function(){for(var e=o.length;e--;)o[e].event.unsubscribe(o[e].handler);return o=[],this}},Range:function(e,t,i,o){void 0===i&&void 0===o&&(i=e,o=t);this.fromRow=Math.min(e,i),this.fromCell=Math.min(t,o),this.toRow=Math.max(e,i),this.toCell=Math.max(t,o),this.isSingleRow=function(){return this.fromRow==this.toRow},this.isSingleCell=function(){return this.fromRow==this.toRow&&this.fromCell==this.toCell},this.contains=function(e,t){return e>=this.fromRow&&e<=this.toRow&&t>=this.fromCell&&t<=this.toCell},this.toString=function(){return this.isSingleCell()?"("+this.fromRow+":"+this.fromCell+")":"("+this.fromRow+":"+this.fromCell+" - "+this.toRow+":"+this.toCell+")"}},NonDataRow:V,Group:N,GroupTotals:L,EditorLock:A,GlobalEditorLock:new A}}),(N.prototype=new V).equals=function(e){return this.value===e.value&&this.count===e.count&&this.collapsed===e.collapsed&&this.title===e.title},L.prototype=new V;var Di,Fi,xi,q,P,B,G,H,U,W,K=(z.prototype.addItem=function(e){var t=e[this.app.SLICKGRID_ROW_UNIQUE_ID];this.data[t]=e,this.addedPKS.push(t)},z.prototype.clear=function(){for(var e in this.data)delete this.data[e];this.data.length=0},z.prototype.deleteItem=function(e){this.selectionSyncHelper&&this.selectionSyncHelper.isIdSelected(e)||delete this.data[e]},z.prototype.destroy=function(){this.stopListening()},z.prototype.endUpdate=function(){this.grid.invalidateRows(this.addedPKS),this.grid.render(),this.addedPKS=[]},z.prototype.getFilteredItems=function(){for(var e,t=[],i=0;i<this.data.length;i++)(e=this.data[i])&&t.push(e);return t},z.prototype.getInternalMap_idxById=function(){var e=_.mapValues(this.data,function(e,t){return t});return delete e.length,e},z.prototype.getItem=function(e){e=this.data[e]||void 0;return e=e&&this.config.populateItem?this.config.populateItem(e):e},z.prototype.getItemById=function(e){return this.getItem(e)},z.prototype.getItemByIdx=function(e){return this.getItem(e)},z.prototype.getItems=function(){return{length:0}},z.prototype.getLength=function(){return this.data.length},z.prototype.initEvents=function(){var e=this;this.grid=this.app.grid,this.grid.onViewportChanged.subscribe(this.onViewportChanged.bind(this)),this.listenTo(this.app,"data-loaded",function(){e.isLoadingMissingData=!1})},z.prototype.mapIdsToRows=function(e){return _.map(e,function(e){return Number(e)})},z.prototype.mapRowsToIds=function(e){var i=this,o=this.app.SLICKGRID_ROW_UNIQUE_ID;return _.map(e,function(e){var t;return(i.data[e]||((t={})[o]=e,t))[o]})},z.prototype.onViewportChanged=function(){var e,t=this.grid.getViewport(),i=0;if(!this.isLoadingMissingData&&((t=_.pick(t,"top","bottom")).bottom=Math.min(this.data.length-1,t.bottom),this.lastVisibleTop!==t.top||this.lastVisibleBottom!==t.bottom)){t.top>this.lastVisibleTop&&t.bottom>this.lastVisibleBottom?i=1:t.top<this.lastVisibleTop&&t.bottom<this.lastVisibleBottom&&(i=-1);for(var o=t.top;o<=t.bottom;o++)if(!this.data[o]&&void 0===e){e=o;break}if(void 0!==e){var n,a=this.viewModel.get("Style"),s=Math.max(1,Math.ceil((this.app.$pnlGrid.height()-a.HeaderRowHeight)/a.RowHeight)),r=Math.ceil(3*s);switch(i){case-1:n=Math.max(0,t.bottom-r);break;case 1:n=Math.min(this.data.length-r,t.top);break;default:n=Math.max(0,t.top-Math.ceil(2*s))}this.isLoadingMissingData=!0,this.api.page(this.model,{_pagingNum:n,_pageSize:r})}this.lastVisibleTop=t.top,this.lastVisibleBottom=t.bottom}},z.prototype.refresh=function(){},z.prototype.reSort=function(){},z.prototype.setItems=function(e,t){this.updateLength(),this.updateScrollbar();for(var i=this.app.SLICKGRID_ROW_UNIQUE_ID,o=0;o<e.length;o++){var n=e[o];this.data[n[i]]=n}this.grid=this.app.grid;var a=this.app.viewModel.get("Basics.ScrollValueV")||0;this.app.grid.scrollRowToTop(a);a=this.grid.getViewport();this.lastVisibleTop=a.top,this.lastVisibleBottom=a.bottom,this.initEvents_once()},z.prototype.syncGridSelection=function(i){var o,t=new Slick.Event,n=[],a={},s=this;function r(e){n.join(",")!=e.join(",")&&(n=e,a=_.reduce(n,function(e,t){return e[t]=!0,e},{}),t.notify({grid:i,ids:n},new Slick.EventData,s))}function l(){o=!0;var e=s.mapIdsToRows(n);i.setSelectedRows(e),o=!1}return i.onSelectedRowsChanged.subscribe(function(e,t){o||r(s.mapRowsToIds(i.getSelectedRows()))}),this.onRowsChanged.subscribe(l),this.onRowCountChanged.subscribe(l),this.selectionSyncHelper={getSelectedIds:function(){return n},isIdSelected:function(e){return!!a[e]},onSelectedRowIdsChanged:t,setSelectedIds:function(e){r(e),l()}},t},z.prototype.updateItem_unchecked_noRefresh=function(e,t){this.addItem(t)},z.prototype.updateLength=function(){this.app.currentPagingInfo&&(this.data.length=Number(this.app.currentPagingInfo.totalNumRows))},z.prototype.updateScrollbar=function(){this.app.currentPagingInfo&&this.app.grid.updateRowCount()},z);function z(e,t){this.data={},this.isLoadingMissingData=!1,this.lastVisibleTop=0,this.lastVisibleBottom=0,this.onPagingInfoChanged=new Slick.Event,this.onRowCountChanged=new Slick.Event,this.onRowsChanged=new Slick.Event,this.addedPKS=[],this.data={},this.app=e,this.model=e.model,this.viewModel=e.viewModel,this.api=e.api,this.config=t,_.each(["beginUpdate","collapseAllGroups","expandAllGroups","reactivateIndexing","setFilter","setFilterArgs","setGrouping","suspendIndexing"],function(e){this[e]=function(){}}.bind(this)),_.extend(this,C.Events),this.initEvents_once=_.once(this.initEvents)}if(!function(p){p.fn.drag=function(e,t,i){var o="string"==typeof e?e:"",n=p.isFunction(e)?e:p.isFunction(t)?t:null;return 0!==o.indexOf("drag")&&(o="drag"+o),i=(e==n?t:i)||{},n?this.on(o,i,n):this.trigger(o)};var h=p.event,o=h.special,g=o.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(e){var i=p.data(this,g.datakey),o=e.data||{};i.related+=1,p.each(g.defaults,function(e,t){void 0!==o[e]&&(i[e]=o[e])})},remove:function(){--p.data(this,g.datakey).related},setup:function(){var e;p.data(this,g.datakey)||(e=p.extend({related:0},g.defaults),p.data(this,g.datakey,e),h.add(this,"touchstart mousedown",g.init,e),this.attachEvent&&this.attachEvent("ondragstart",g.dontstart))},teardown:function(){(p.data(this,g.datakey)||{}).related||(p.removeData(this,g.datakey),h.remove(this,"touchstart mousedown",g.init),g.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",g.dontstart))},init:function(e){if(!g.touched){var t,i=e.data;if(!(0!=e.which&&0<i.which&&e.which!=i.which)&&!p(e.target).is(i.not)&&(!i.handle||p(e.target).closest(i.handle,e.currentTarget).length)&&(g.touched="touchstart"==e.type?this:null,i.propagates=1,i.mousedown=this,i.interactions=[g.interaction(this,i)],i.target=e.target,i.pageX=e.pageX,i.pageY=e.pageY,i.dragging=null,t=g.hijack(e,"draginit",i),i.propagates))return(t=g.flatten(t))&&t.length&&(i.interactions=[],p.each(t,function(){i.interactions.push(g.interaction(this,i))})),i.propagates=i.interactions.length,!1!==i.drop&&o.drop&&o.drop.handler(e,i),g.textselect(!1),g.touched?h.add(g.touched,"touchmove touchend",g.handler,i):h.add(document,"mousemove mouseup",g.handler,i),!(!g.touched||i.live)&&void 0}},interaction:function(e,t){t=p(e)[t.relative?"position":"offset"]()||{top:0,left:0};return{drag:e,callback:new g.callback,droppable:[],offset:t}},handler:function(e){var t=e.data;switch(e.type){case!t.dragging&&"touchmove":e.preventDefault();case!t.dragging&&"mousemove":if(Math.pow(e.pageX-t.pageX,2)+Math.pow(e.pageY-t.pageY,2)<Math.pow(t.distance,2))break;e.target=t.target,g.hijack(e,"dragstart",t),t.propagates&&(t.dragging=!0);case"touchmove":e.preventDefault();case"mousemove":if(t.dragging){if(g.hijack(e,"drag",t),t.propagates){!1!==t.drop&&o.drop&&o.drop.handler(e,t);break}e.type="mouseup"}case"touchend":case"mouseup":default:g.touched?h.remove(g.touched,"touchmove touchend",g.handler):h.remove(document,"mousemove mouseup",g.handler),t.dragging&&(!1!==t.drop&&o.drop&&o.drop.handler(e,t),g.hijack(e,"dragend",t)),g.textselect(!0),!1===t.click&&t.dragging&&p.data(t.mousedown,"suppress.click",(new Date).getTime()+5),t.dragging=g.touched=!1}},hijack:function(i,o,n,e,t){if(n){var a,s,r,l={event:i.originalEvent,type:i.type},u=o.indexOf("drop")?"drag":"drop",d=e||0,c=isNaN(e)?n.interactions.length:e;i.type=o;e=function(){};i.originalEvent=new jQuery.Event(l.event,{preventDefault:e,stopPropagation:e,stopImmediatePropagation:e}),n.results=[];do{if(s=n.interactions[d]){if("dragend"!==o&&s.cancelled)continue;r=g.properties(i,n,s),s.results=[],p(t||s[u]||n.droppable).each(function(e,t){if(r.target=t,!(i.isPropagationStopped=function(){return!1})===(a=t?h.dispatch.call(t,i,r):null)?("drag"==u&&(s.cancelled=!0,--n.propagates),"drop"==o&&(s[u][e]=null)):"dropinit"==o&&s.droppable.push(g.element(a)||t),"dragstart"==o&&(s.proxy=p(g.element(a)||s.drag)[0]),s.results.push(a),delete i.result,"dropinit"!==o)return a}),n.results[d]=g.flatten(s.results),"dropinit"==o&&(s.droppable=g.flatten(s.droppable)),"dragstart"!=o||s.cancelled||r.update()}}while(++d<c);return i.type=l.type,i.originalEvent=l.event,g.flatten(n.results)}},properties:function(e,t,i){var o=i.callback;return o.drag=i.drag,o.proxy=i.proxy||i.drag,o.startX=t.pageX,o.startY=t.pageY,o.deltaX=e.pageX-t.pageX,o.deltaY=e.pageY-t.pageY,o.originalX=i.offset.left,o.originalY=i.offset.top,o.offsetX=o.originalX+o.deltaX,o.offsetY=o.originalY+o.deltaY,o.drop=g.flatten((i.drop||[]).slice()),o.available=g.flatten((i.droppable||[]).slice()),o},element:function(e){if(e&&(e.jquery||1==e.nodeType))return e},flatten:function(e){return p.map(e,function(e){return e&&e.jquery?p.makeArray(e):e&&e.length?g.flatten(e):e})},textselect:function(e){p(document)[e?"off":"on"]("selectstart",g.dontstart).css("MozUserSelect",e?"":"none"),document.unselectable=e?"off":"on"},dontstart:function(){return!1},callback:function(){}};g.callback.prototype={update:function(){o.drop&&this.available.length&&p.each(this.available,function(e){o.drop.locate(this,e)})}};var t=h.dispatch;h.dispatch=function(e){if(!(0<p.data(this,"suppress."+e.type)-(new Date).getTime()))return t.apply(this,arguments);p.removeData(this,"suppress."+e.type)}}(jQuery),"undefined"==typeof jQuery)throw"SlickGrid requires jquery module to be loaded";if("undefined"==typeof Slick)throw"slick.core.js not loaded";(Di=jQuery).extend(!0,window,{Slick:{GridModifiedByIK:function(n,v,C,h){var a,s,r,l,u,d,c,p,g,f,m,w,b,y,S,R,M,k,i,I,T,D,F,x,E,O,V,N,L,A,P,B,G,H,o,$,U,W={explicitInitialization:!1,rowHeight:25,defaultColumnWidth:80,enableAddRow:!1,leaveSpaceForNewRows:!1,editable:!1,autoEdit:!0,enableCellNavigation:!0,enableColumnReorder:!0,asyncEditorLoading:!1,asyncEditorLoadDelay:100,forceFitColumns:!1,autoExpandColumns:!1,enableAsyncPostRender:!1,asyncPostRenderDelay:50,autoHeight:!1,editorLock:Slick.GlobalEditorLock,showHeaderRow:!1,isHeaderRowVisible:!0,headerRowHeight:25,showTopPanel:!1,topPanelHeight:25,formatterFactory:null,editorFactory:null,cellFlashingCssClass:"flashing",selectedCellCssClass:"selected",multiSelect:!0,enableTextSelectionOnCells:!1,dataItemColumnValueExtractor:null,fullWidthRows:!1,multiColumnSort:!1,defaultFormatter:function(e,t,i,o,n){return document.createTextNode(null==i?"":i)},forceSyncScrolling:!1,addNewRowCssClass:"new-row"},K={name:"",resizable:!0,sortable:!1,minWidth:30,rerenderOnResize:!1,headerCssClass:null,defaultSortAsc:!0,focusable:!0,selectable:!0},z=0,j=0,Q=!1,q="slickgrid_"+_.uniqueId(),Y=this,X=0,J=0,Z=0,t=1,ee=null,te=null,ie={},oe=0,ne=0,ae=0,se=0,re=0,le=0,ue=[],de=[],ce={},pe={},he=[],ge=[],fe=[],me=[],ve=null,Ce=null,we={},be=null,ye=null,_e=!1,Se=[];function Re(){var e;Q||(Q=!0,x=parseFloat(Di.css(d[0],"width",!0)),function(){var i,e=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],t=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"];i=Di("<div class='ui-state-default slick-header-column' style='visibility:hidden'>-</div>").appendTo(f),X=0,"border-box"!=i.css("box-sizing")&&"border-box"!=i.css("-moz-box-sizing")&&"border-box"!=i.css("-webkit-box-sizing")&&(Di.each(e,function(e,t){X+=parseFloat(i.css(t))||0}),Di.each(t,function(e,t){parseFloat(i.css(t))}));i.remove();var o=Di("<div class='slick-row' />").appendTo(M);i=Di("<div class='slick-cell' id='' style='visibility:hidden'>-</div>").appendTo(o),J=Z=0,"border-box"!=i.css("box-sizing")&&"border-box"!=i.css("-moz-box-sizing")&&"border-box"!=i.css("-webkit-box-sizing")&&(Di.each(e,function(e,t){J+=parseFloat(i.css(t))||0}),Di.each(t,function(e,t){Z+=parseFloat(i.css(t))||0}));o.remove(),N=Math.max(X,J)}(),(e=f)&&e.jquery&&e.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return!1}),h.enableTextSelectionOnCells||R.bind("selectstart.ui",function(e){return Di(e.target).is("input,textarea")}),$e(),De(),f.click(function(e){if(e.metaKey=e.metaKey||e.ctrlKey,!Di(e.target).hasClass("slick-resizable-handle")){var t=Di(e.target).closest(".slick-header-column");if(t.length){var i=t.data("column");if(i.sortable&&Ne().commitCurrentEdit()){for(var o=null,n=0;n<he.length;n++)if(he[n].columnId==i.id){(o=he[n]).sortAsc=!o.sortAsc;break}e.metaKey&&h.multiColumnSort?o&&he.splice(n,1):((e.shiftKey||e.metaKey)&&h.multiColumnSort||(he=[]),o?0==he.length&&he.push(o):(o={columnId:i.id,sortAsc:i.defaultSortAsc},he.push(o))),_.isEqual(he,ge)||(Ge(he),t=h.multiColumnSort?{multiColumnSort:!0,sortCols:Di.map(he,function(e){return{sortCol:C[Le(e.columnId)],sortAsc:e.sortAsc}})}:{multiColumnSort:!1,sortCol:i,sortAsc:o.sortAsc},Ve(Y.onSort,t,e))}}}}),xe(),ut(),_.isNumber(h.scrollLeft)&&(R[0].scrollLeft=h.scrollLeft,bt()),function(){var e=M[0];for(;(e=e.parentNode)!=document.body&&null!=e;){var t;e!=R[0]&&e.scrollWidth==e.clientWidth&&e.scrollHeight==e.clientHeight||(t=Di(e),i=i?i.add(t):t,t.bind("scroll."+q,ti))}}(),d.bind("resize.slickgrid",ut),R.bind("scroll",bt),g.bind("contextmenu",Lt).bind("click",At).delegate(".slick-header-column","mouseenter",Vt).delegate(".slick-header-column","mouseleave",Nt),w.bind("scroll",wt),c.add(p).bind("keydown",Tt),M.bind("keydown",Tt).bind("mousedown",Dt).bind("mouseup",Ft).bind("dblclick",Ot).bind("contextmenu",Et).bind("draginit",Rt).bind("dragstart",{distance:3},Mt).bind("drag",kt).bind("dragend",It).delegate(".slick-cell","mouseenter",Pt).delegate(".slick-cell","mouseleave",Bt),navigator.userAgent.toLowerCase().match(/webkit/)&&navigator.userAgent.toLowerCase().match(/macintosh/)&&M.bind("mousewheel",St))}function Me(e){for(var t=de.length;0<=t;t--)if(de[t]===e){de[t].destroy&&de[t].destroy(),de.splice(t,1);break}}function ke(){for(var e=0,t=0,i=C.length;t<i;t++)e+=C[t].width;return e+=Fi.width,Math.max(e,x)+1e3}function Ie(){for(var e=V?x-Fi.width:x,t=0,i=C.length;i--;)t+=C[i].width;return h.fullWidthRows?Math.max(t,e):t}function Te(e){var t=E;(E=Ie())!=t&&(M.width(E),m.width(E),f.width(ke()),O=E>x-Fi.width),b.width(E+(V?Fi.width:0)),E==t&&!e||Be()}function De(){function e(){Di(this).addClass("ui-state-hover")}function t(){Di(this).removeClass("ui-state-hover")}f.find(".slick-header-column").each(function(){var e=Di(this).data("column");e&&Ve(Y.onBeforeHeaderCellDestroy,{node:this,column:e})}),f.empty(),f.width(ke()),m.find(".slick-headerrow-column").each(function(){var e=Di(this).data("column");e&&Ve(Y.onBeforeHeaderRowCellDestroy,{node:this,column:e})}),m.empty();for(var i="",o="<div class='ui-state-default slick-header-column' style='"+(i=h.headerFontWeight?"font-weight:"+h.headerFontWeight+";":i)+"'/>",n=0;n<C.length;n++){var a=C[n],s=a.field?a.field+" ":"";(a.headerCssClass||s)&&(s+=a.headerCssClass||"");s=Di(o).html("<span class='slick-column-name'>"+a.name+"</span>").width(a.width-X).attr("id",""+q+a.id).attr("title",a.toolTip||"").data("column",a).addClass(s).appendTo(f);(h.enableColumnReorder||a.sortable)&&s.on("mouseenter",e).on("mouseleave",t),a.sortable&&(s.addClass("slick-header-sortable"),s.append("<span class='slick-sort-indicator' />")),Ve(Y.onHeaderCellRendered,{node:s[0],column:a}),h.showHeaderRow&&(s=Di("<div class='ui-state-default slick-headerrow-column l"+n+" r"+n+"'></div>").data("column",a).appendTo(m),Ve(Y.onHeaderRowCellRendered,{node:s[0],column:a}))}Ge(he),Fe(),h.enableColumnReorder&&(f.filter(":ui-sortable").sortable("destroy"),f.sortable({distance:3,cursor:"default",tolerance:"intersection",helper:"clone",placeholder:"slick-sortable-placeholder ui-state-default slick-header-column",appendTo:d,start:function(e,t){t.placeholder.width(t.helper.outerWidth()-X),Di(t.helper).addClass("slick-header-column-active"),Ve(Y.onColumnsReorderStart,t)},beforeStop:function(e,t){Di(t.helper).removeClass("slick-header-column-active"),Ve(Y.onBeforeColumnsReordered,t)},stop:function(e){if(Ne().commitCurrentEdit()&&!e.originalEvent.isPropagationStopped()){if(f.is(":ui-sortable")){var t=f.sortable("toArray"),i=[];reorderedWidthWeights=[],_e=!0,Se=_.map(Se,function(e,t){return 0!=e?C[t].width:C[t].minWidth});for(var o=0;o<t.length;o++){var n=Le(t[o].replace(q,""));i.push(C[n]),reorderedWidthWeights.push(Se[n])}Se=reorderedWidthWeights,Ue(i),Ve(Y.onColumnsReordered,{}),e.stopPropagation(),Fe()}}else Di(this).is(":ui-sortable")&&Di(this).sortable("cancel")}}))}function Fe(){var r,l,u,d,c,i,o,p=f.children();p.find(".slick-resizable-handle").remove(),p.each(function(e,t){C[e].resizable&&(void 0===i&&(i=e),o=e)}),void 0!==i&&p.each(function(s,e){s<i||h.forceFitColumns&&o<=s||(Di(e),Di("<div class='slick-resizable-handle' />").appendTo(e).bind("dragstart",function(e,t){if(!Ne().commitCurrentEdit())return!1;u=e.pageX,Di(this).parent().addClass("slick-header-column-active");var i=null,o=null;if(p.each(function(e,t){C[e].previousWidth=Di(t).outerWidth()}),h.forceFitColumns)for(o=i=0,r=s+1;r<p.length;r++)(l=C[r]).resizable&&(null!==o&&(l.maxWidth?o+=l.maxWidth-l.previousWidth:o=null),i+=l.previousWidth-Math.max(l.minWidth||0,N));var n=0,a=0;for(r=0;r<=s;r++)(l=C[r]).resizable&&(null!==a&&(l.maxWidth?a+=l.maxWidth-l.previousWidth:a=null),n+=l.previousWidth-Math.max(l.minWidth||0,N));null===i&&(i=1e5),null===n&&(n=1e5),null===o&&(o=1e5),null===a&&(a=1e5),c=u+Math.min(i,a),d=u-Math.min(n,o)}).bind("drag",function(e,t){var i,o,e=Math.min(c,Math.max(d,e.pageX))-u;if(e<0){for(o=e,r=s;0<=r;r--)(l=C[r]).resizable&&(i=Math.max(l.minWidth||0,N),o&&l.previousWidth+o<i?(o+=l.previousWidth-i,l.width=i):(l.width=l.previousWidth+o,o=0));if(h.forceFitColumns)for(o=-e,r=s+1;r<p.length;r++)(l=C[r]).resizable&&(o&&l.maxWidth&&l.maxWidth-l.previousWidth<o?(o-=l.maxWidth-l.previousWidth,l.width=l.maxWidth):(l.width=l.previousWidth+o,o=0))}else{for(o=e,r=s;0<=r;r--)(l=C[r]).resizable&&(o&&l.maxWidth&&l.maxWidth-l.previousWidth<o?(o-=l.maxWidth-l.previousWidth,l.width=l.maxWidth):(l.width=l.previousWidth+o,o=0));if(h.forceFitColumns)for(o=-e,r=s+1;r<p.length;r++)(l=C[r]).resizable&&(i=Math.max(l.minWidth||0,N),o&&l.previousWidth+o<i?(o+=l.previousWidth-i,l.width=i):(l.width=l.previousWidth+o,o=0))}Pe(),h.syncColumnCellResize&&Be()}).bind("dragend",function(e,t){var i;for(Di(this).parent().removeClass("slick-header-column-active"),_e=!0,r=0;r<p.length;r++)l=C[r],i=Di(p[r]).outerWidth(),l.previousWidth!==i&&l.rerenderOnResize&&nt();Te(!0),Ct(),Ve(Y.onColumnsResized,{})}))})}function e(i){var o=0;return Di.each(["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],function(e,t){o+=parseFloat(i.css(t))||0}),o}function xe(){k=Di("<style type='text/css' rel='stylesheet' />").appendTo(Di("head"));var e=h.rowHeight-Z;k[0].styleSheet?k[0].styleSheet.cssText="":k[0].appendChild(document.createTextNode(""));var t=k[0].sheet,i=0;Ee(t,"."+q+" .slick-header-column","left: 1000px;",i++),Ee(t,"."+q+" .slick-top-panel","height:"+h.topPanelHeight+"px;",i++),Ee(t,"."+q+" .slick-header-column","height:"+h.headerRowHeight+"px;",i++),Ee(t,"."+q+" .slick-headerrow-columns","height:"+h.headerRowHeight+"px;",i++),Ee(t,"."+q+" .slick-cell","height:"+e+"px;",i++),Ee(t,"."+q+" .slick-row","height:"+h.rowHeight+"px;",i++),Ee(t,"."+q+" .slick-cell","line-height:"+e+"px;",i++),Ee(t,"."+q+" .slick-row","line-height:"+h.rowHeight+"px;",i++),Ee(t,"."+q+" .slick-header-column","line-height:"+h.headerRowHeight+"px;",i++);for(var o=0;o<C.length;o++)Ee(t,"."+q+" .l"+o,"",i++),Ee(t,"."+q+" .r"+o,"",i++)}function Ee(e,t,i,o){e.insertRule?e.insertRule(t+"{"+i+"}",o):e.addRule(t,i,o)}function Oe(){k.remove(),I=null}function Ve(e,t,i,o){return i=i||new Slick.EventData,(t=t||{}).grid=Y,e.notify(t,i,Y,o)}function Ne(){return h.editorLock}function Le(e){return pe[e]}function Ae(){var e,t,i,o,n={},a=!1,s=_.every(C,function(e){return _.get(e,"_dashboardConfig._RetainWidth",!1)}),r=V?x-Fi.width:x,l=_.reduce(Se,function(e,t){return e+t},0);if(s){if(a=!0,l<r)for(e=0;e<C.length;e++)C[e].width=r*Se[e]/l}else{for(e=0;e<C.length;e++)t=C[e],o=l?r*Se[e]/l:0,!_e&&t.minWidth>o&&!n[e]&&(o=t.minWidth,r=Math.max(0,r-o),l=Math.max(0,l-Se[e]),n[e]=!0,e=-1);for(e=0;e<C.length;e++)i=n[e]?C[e].minWidth:_e?C[e].width:r*Se[e]/l,C[e].rerenderOnResize&&C[e].width!=i&&(a=!0),C[e].width=i}Pe(),Te(!0),a&&(nt(),Ct())}function Pe(){if(Q){for(var e,t=0,i=f.children(":not(.slick-sortable-placeholder):not(.ui-sortable-helper)"),o=i.length;t<o;t++)(e=Di(i[t])).width()!==C[t].width-X&&e.width(C[t].width-X);$e()}}function Be(){for(var e,t,i=0,o=0;o<C.length;o++)e=C[o].width,(t=function(e){if(!I){for(var t=document.styleSheets,i=0;i<t.length;i++)if((t[i].ownerNode||t[i].owningElement)==k[0]){I=t[i];break}if(I){T=[],D=[];for(var o,n,a=I.cssRules||I.rules,i=0;i<a.length;i++){var s=a[i].selectorText;(o=/\.l\d+/.exec(s))?(n=parseInt(o[0].substr(2,o[0].length-2),10),T[n]=a[i]):(o=/\.r\d+/.exec(s))&&(n=parseInt(o[0].substr(2,o[0].length-2),10),D[n]=a[i])}}else console.log("ERROR: Slickgrid -  Cannot find stylesheet."),D=[],(T=[])[e]={style:{left:0}},D[e]={style:{right:0}}}return{left:T[e],right:D[e]}}(o)).left.style.left=i+"px",t.right.style.right=E-i-e+"px",i+=C[o].width}function Ge(e){he=e,ge=_.cloneDeep(he);var o=f.children();o.removeClass("slick-header-column-sorted").find(".slick-sort-indicator").removeClass("slick-sort-indicator-asc slick-sort-indicator-desc"),Di.each(he,function(e,t){null==t.sortAsc&&(t.sortAsc=!0);var i=Le(t.columnId);null!=i&&o.eq(i).addClass("slick-header-column-sorted").find(".slick-sort-indicator").addClass(t.sortAsc?"slick-sort-indicator-asc":"slick-sort-indicator-desc")})}function He(e,t){ue=[];for(var i={},o=0;o<t.length;o++)for(var n=t[o].fromRow;n<=t[o].toRow;n++){i[n]||(ue.push(n),i[n]={});for(var a=t[o].fromCell;a<=t[o].toCell;a++)Ri(n,a)&&(i[n][C[a].id]=h.selectedCellCssClass)}_t(h.selectedCellCssClass,i),Ve(Y.onSelectedRowsChanged,{rows:Ti()},e)}function $e(){fe=[],me=[];for(var e=0,t=0,i=C.length;t<i;t++)fe[t]=e,me[t]=e+C[t].width,e+=C[t].width}function Ue(e){C=e,pe={};for(var t=0;t<C.length;t++){var i=C[t]=Di.extend({},K,C[t]);pe[i.id]=t,i.minWidth&&i.width<i.minWidth&&(i.width=i.minWidth),i.maxWidth&&i.width>i.maxWidth&&(i.width=i.maxWidth)}$e(),Q&&(nt(),De(),Oe(),xe(),ut(),Be(),bt())}function We(){h.autoHeight&&(h.leaveSpaceForNewRows=!1)}function Ke(){return v.getLength?v.getLength():v.length}function ze(){return Ke()+(h.enableAddRow?1:0)}function je(e){return v.getItem?v.getItem(e):v[e]}function Qe(e){return h.rowHeight*e-j}function qe(e){return Math.floor((e+j)/h.rowHeight)}function Ye(e){e=Math.max(e,0),e=Math.min(e,a-F+(O?Fi.height:0));var t=j;z=Math.min(l-1,Math.floor(e/r));e-=j=Math.round(z*u);j!=t&&(ot(ct(e)),function(){for(var e in ie)ie[e].rowNode.style.top=Qe(e)+"px"}()),oe!=e&&(R[0].scrollTop=ae=ne=oe=e,Ve(Y.onViewportChanged,{}))}function Xe(e,t){var i=v.getItemMetadata&&v.getItemMetadata(e),e=i&&i.columns&&(i.columns[t.id]||i.columns[Le(t.id)]);return e&&e.formatter||i&&i.formatter||t.formatter||h.formatterFactory&&h.formatterFactory.getFormatter(t)||h.defaultFormatter}function Je(e,t){var i=C[t],e=v.getItemMetadata&&v.getItemMetadata(e),e=e&&e.columns;return e&&e[i.id]&&void 0!==e[i.id].editor?e[i.id].editor:e&&e[t]&&void 0!==e[t].editor?e[t].editor:i.editor||h.editorFactory&&h.editorFactory.getEditor(i)}function Ze(e,t){return h.dataItemColumnValueExtractor?h.dataItemColumnValueExtractor(e,t):e[t.field]}function et(e,t){var i=document.createDocumentFragment();t.forEach(function(e){i.appendChild(e)}),e.appendChild(i)}function tt(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function it(e,t,i,o,n){var a,s=C[i],r="slick-cell l"+i+" r"+Math.min(C.length-1,i+o-1)+(s.cssClass?" "+s.cssClass:"");for(a in t===A&&i===P&&(r+=" active"),ce)ce[a][t]&&ce[a][t][s.id]&&(r+=" "+ce[a][t][s.id]);var l,u=document.createElement("div");u.className=r,e.push(u),n&&(l=void 0,(e=n instanceof Slick.NonDataRow)||(l=Ze(n,s)),n=Xe(t,s)(t,i,l,s,n),e?u.innerHTML=n:u.appendChild(n)),ie[t].cellRenderQueue.push(i),ie[t].cellColSpans[i]=o}function ot(e){for(var t in ie)(t=parseInt(t,10))!==A&&(t<e.top||t>e.bottom)&&at(t)}function nt(){for(var e in te&&qt(),ie)at(e)}function at(e){var t=ie[e];t&&($==t.rowNode?(t.rowNode.style.display="none",U=$):M[0].removeChild(t.rowNode),delete ie[e],delete we[e],0)}function st(e){var t,i;if(e&&e.length)for(t=0,i=e.length;t<i;t++)te&&A===e[t]&&qt(),ie[e[t]]&&at(e[t])}function rt(e){st([e])}function lt(e){var t=ie[e];if(t){ht(e);var i,o,n,a=je(e);for(i in t.cellNodesByColumnIdx)t.cellNodesByColumnIdx.hasOwnProperty(i)&&(o=C[i|=0],n=t.cellNodesByColumnIdx[i],e===A&&i===P&&te?te.loadValue(a):(tt(n),a&&n.appendChild(Xe(e,o)(e,i,Ze(a,o),o,a))));vt(e)}}function ut(){Q&&(F=h.autoHeight?h.rowHeight*ze():parseFloat(Di.css(d[0],"height",!0))-parseFloat(Di.css(d[0],"paddingTop",!0))-parseFloat(Di.css(d[0],"paddingBottom",!0))-parseFloat(Di.css(g[0],"height"))-e(g)-(h.showTopPanel?h.topPanelHeight+e(y):0)-(h.showHeaderRow&&h.isHeaderRowVisible?h.headerRowHeight+e(w):0),H=Math.ceil(F/h.rowHeight),x=parseFloat(Di.css(d[0],"width",!0)),h.autoHeight||R.height(F),(h.forceFitColumns||h.autoExpandColumns)&&Ae(),dt(),bt(),se=-1,Ct())}function dt(){if(Q){var e=ze()+(h.leaveSpaceForNewRows?H-1:0),t=V;V=!h.autoHeight&&e*h.rowHeight>F,qt();var i,o=Ke();for(i in ie)o<=i&&at(i);ee&&o<A&&Wt();var n=s;a=Math.max(h.rowHeight*e,F-Fi.height),u=a<xi?(s=r=a,l=1,0):(r=(s=xi)/100,l=Math.floor(a/r),(a-s)/(l-1)),s!==n&&(M.css("height",s),ne=R[0].scrollTop);e=ne+j<=a-F;0==a||0==ne?z=j=0:Ye(e?ne+j:a-F),s!=n&&h.autoHeight&&ut(),(h.forceFitColumns||h.autoExpandColumns)&&t!=V&&Ae(),Te(!1)}}function ct(e,t){return null==t&&(t=le),{top:qe(e=null==e?ne:e),bottom:qe(e+F)+1,leftPx:t,rightPx:t+x}}function pt(e,t){t=ct(e,t);return--t.top,t.bottom+=1,t.top=Math.max(0,t.top),t.bottom=Math.min(ze()-1,t.bottom),t.leftPx=Math.max(0,t.leftPx),t.rightPx=Math.min(E,t.rightPx),t}function ht(e){var t=ie[e];if(t&&t.cellRenderQueue.length)for(var i=t.rowNode.lastChild;t.cellRenderQueue.length;)var o=t.cellRenderQueue.pop(),i=(t.cellNodesByColumnIdx[o]=i).previousSibling}function gt(e){for(var t=[],i=[],o=e.top,n=e.bottom;o<=n;o++)if(m=ie[o]){ht(o),function(e,t){var i,o,n,a=ie[t],s=[];for(i in a.cellNodesByColumnIdx)a.cellNodesByColumnIdx.hasOwnProperty(i)&&(i|=0,o=a.cellColSpans[i],(fe[i]>e.rightPx||me[Math.min(C.length-1,i+o-1)]<e.leftPx)&&(t==A&&i==P||s.push(i)));for(;null!=(n=s.pop());)a.rowNode.removeChild(a.cellNodesByColumnIdx[n]),delete a.cellColSpans[n],delete a.cellNodesByColumnIdx[n],we[t]&&delete we[t][n],0}(e,o);for(var a,s,r=0,l=(l=v.getItemMetadata&&v.getItemMetadata(o))&&l.columns,u=je(o),d=0,c=C.length;d<c&&!(fe[d]>e.rightPx);d++)null==(s=m.cellColSpans[d])&&(s=1,!l||"*"===(s=(a=l[C[d].id]||l[d])&&a.colspan||1)&&(s=c-d),me[Math.min(c-1,d+s-1)]>e.leftPx&&(it(t,o,d,s,u),r++)),d+=1<s?s-1:0;r&&i.push(o)}if(t.length){var p,h,g=document.createElement("div");for(et(g,t);null!=(p=i.pop());)for(var f,m=ie[p];null!=(f=m.cellRenderQueue.pop());)h=g.lastChild,m.rowNode.appendChild(h),m.cellNodesByColumnIdx[f]=h}}function ft(e){for(var t=M[0],i=[],o=[],n=!1,a=Ke(),s=e.top,r=e.bottom;s<=r;s++)ie[s]||(o.push(s),ie[s]={rowNode:null,cellColSpans:[],cellNodesByColumnIdx:[],cellRenderQueue:[]},function(e,t,i,o){var n=je(t),a="slick-row"+(t<o&&!n?" loading":"")+(t===A?" active":"")+(t%2==1?" odd":" even");n||(a+=" "+h.addNewRowCssClass);var s=v.getItemMetadata&&v.getItemMetadata(t);s&&s.cssClasses&&(a+=" "+s.cssClasses),(o=document.createElement("div")).className=a,o.style.position="absolute",o.style.border=0,o.style.width="100%",o.style.top=Qe(t)+"px",t%2==1?h.oddRowBackgroundColorOverride&&(o.style.backgroundColor=h.oddRowBackgroundColorOverride):h.evenRowBackgroundColorOverride&&(o.style.backgroundColor=h.evenRowBackgroundColorOverride),e.push(o);for(var r=[],l=0,u=C.length;l<u;l++){var d,c=C[l];if(d=1,s&&s.columns&&("*"===(d=(c=s.columns[c.id]||s.columns[l])&&c.colspan||1)&&(d=u-l)),me[Math.min(u-1,l+d-1)]>i.leftPx){if(fe[l]>i.rightPx)break;it(r,t,l,d,n)}1<d&&(l+=d-1)}et(o,r)}(i,s,e,a),ee&&A===s&&(n=!0),0);if(o.length){var l=document.createElement("div");et(l,i);for(s=0,r=o.length;s<r;s++)ie[o[s]].rowNode=t.appendChild(l.firstChild);n&&(ee=_i(A,P))}}function mt(){h.enableAsyncPostRender}function vt(e){delete we[e],ye=Math.min(ye,e),be=Math.max(be,e),mt()}function Ct(){var e,t;Q&&(e=ct(),ot(t=pt()),se!=le&&gt(t),ft(t),ye=e.top,be=Math.min(ze()-1,e.bottom),mt(),ae=ne,se=le,Ce=null)}function wt(){var e=w[0].scrollLeft;e!=R[0].scrollLeft&&(R[0].scrollLeft=e)}function bt(){ne=R[0].scrollTop,le=R[0].scrollLeft;var e,t=Math.abs(ne-oe),i=Math.abs(le-re);i&&(re=le,g[0].scrollLeft=le,y[0].scrollLeft=le,w[0].scrollLeft=le),t&&(oe=ne,t<F?Ye(ne+j):(e=j,z=s==F?0:Math.min(l-1,Math.floor(ne*((a-F)/(s-F))*(1/r))),e!=(j=Math.round(z*u))&&nt())),(i||t)&&(Ce&&clearTimeout(Ce),(20<Math.abs(ae-ne)||20<Math.abs(se-le))&&(h.forceSyncScrolling||Math.abs(ae-ne)<F&&Math.abs(se-le)<x?Ct():Ce=setTimeout(Ct,50),Ve(Y.onViewportChanged,{}))),Ve(Y.onScroll,{scrollLeft:le,scrollTop:ne})}function yt(e,t){var i,o,n,a,s;for(s in ie){if(a=t&&t[s],n=e&&e[s],a)for(o in a)n&&a[o]==n[o]||(i=_i(s,Le(o)))&&Di(i).removeClass(a[o]);if(n)for(o in n)a&&a[o]==n[o]||(i=_i(s,Le(o)))&&Di(i).addClass(n[o])}}function _t(e,t){var i=ce[e];yt(ce[e]=t,i),Ve(Y.onCellCssStylesChanged,{key:e,hash:t})}function St(e){e=Di(e.target).closest(".slick-row")[0];e!=$&&(U&&U!=e&&(M[0].removeChild(U),U=null),$=e)}function Rt(e,t){var i=Ut(e);if(!i||!Gt(i.row,i.cell))return!1;t=Ve(Y.onDragInit,t,e);return!!e.isImmediatePropagationStopped()&&t}function Mt(e,t){var i=Ut(e);if(!i||!Gt(i.row,i.cell))return!1;t=Ve(Y.onDragStart,t,e);return!!e.isImmediatePropagationStopped()&&t}function kt(e,t){return Ve(Y.onDrag,t,e)}function It(e,t){Ve(Y.onDragEnd,t,e)}function Tt(e){Ve(Y.onKeyDown,{row:A,cell:P},e);var t=e.isImmediatePropagationStopped();if(!t)if(e.shiftKey||e.altKey||e.ctrlKey)9!=e.which||!e.shiftKey||e.ctrlKey||e.altKey||(t=bi());else if(27==e.which){if(!Ne().isActive())return;Jt()}else 34==e.which?(ai(),t=!0):33==e.which?(si(),t=!0):37==e.which?t=mi():39==e.which?t=fi():38==e.which?t=Ci():40==e.which?t=vi():9==e.which?t=wi():13==e.which&&(h.editable&&(te?(A===Ke()?vi:Xt)():Ne().commitCurrentEdit()&&Yt()),t=!0);if(Ve(Y.onKeyDownDone,{row:A,cell:P},e,!0),t){e.stopPropagation(),e.preventDefault();try{e.originalEvent.keyCode=0}catch(e){}}}function Dt(e){xt(e);var t=Ut(e);if(!t||null!==te&&A==t.row&&P==t.cell)0;else{if(Ve(Y.onClick,{row:t.row,cell:t.cell},e),e.isImmediatePropagationStopped())return Ve(Y.onClickDone,{row:t.row,cell:t.cell},e,!0),void 0;Si(t.row,t.cell)&&(Ne().isActive()&&!Ne().commitCurrentEdit()||(oi(t.row,!1),jt(_i(t.row,t.cell)))),Ve(Y.onClickDone,{row:t.row,cell:t.cell},e,!0),0}}function Ft(e){xt(e)}function xt(e){te||e.target==document.activeElement&&!Di(e.target).hasClass("slick-cell")||Kt()}function Et(e){var t=Di(e.target).closest(".slick-cell",M);0!==t.length&&(ee===t[0]&&null!==te||Ve(Y.onContextMenu,{},e))}function Ot(e){var t=Ut(e);!t||null!==te&&A==t.row&&P==t.cell||(Ve(Y.onDblClick,{row:t.row,cell:t.cell},e),e.isImmediatePropagationStopped()||h.editable&&Mi(t.row,t.cell,!0))}function Vt(e){Ve(Y.onHeaderMouseEnter,{column:Di(this).data("column")},e)}function Nt(e){Ve(Y.onHeaderMouseLeave,{column:Di(this).data("column")},e)}function Lt(e){var t=Di(e.target).closest(".slick-header-column",".slick-header-columns"),t=t&&t.data("column");Ve(Y.onHeaderContextMenu,{column:t},e)}function At(e){var t=Di(e.target).closest(".slick-header-column",".slick-header-columns"),t=t&&t.data("column");t&&Ve(Y.onHeaderClick,{column:t},e)}function Pt(e){Ve(Y.onMouseEnter,{},e)}function Bt(e){Ve(Y.onMouseLeave,{},e)}function Gt(e,t){return!(e<0||e>=Ke()||t<0||t>=C.length)}function Ht(e){var t=/l\d+/.exec(e.className);if(!t)throw"getCellFromNode: cannot get cell - "+e.className;return parseInt(t[0].substr(1,t[0].length-1),10)}function $t(e){for(var t in ie)if(ie[t].rowNode===e)return 0|t;return null}function Ut(e){var t=Di(e.target).closest(".slick-cell",M);if(!t.length)return null;e=$t(t[0].parentNode),t=Ht(t[0]);return null==e||null==t?null:{row:e,cell:t}}function Wt(){jt(null,!1)}function Kt(){(-1==t?c:p)[0].focus()}function zt(e,t,i){oi(e,i);i=ri(e,t),e=fe[t],t=me[t+(1<i?i-1:0)],i=le+x;e<le?(R.scrollLeft(e),bt(),Ct()):i<t&&(R.scrollLeft(Math.min(e,t-R[0].clientWidth)),bt(),Ct())}function jt(e,t){null!==ee&&(qt(),Di(ee).removeClass("active"),ie[A]&&Di(ie[A].rowNode).removeClass("active"));var i=ee!==e;null!=(ee=e)?(A=$t(ee.parentNode),P=L=Ht(ee),null==t&&(t=A==Ke()||h.autoEdit),Di(ee).addClass("active"),Di(ie[A].rowNode).addClass("active"),h.editable&&t&&Qt(A,P)&&(clearTimeout(ve),h.asyncEditorLoading?ve=setTimeout(function(){Yt()},h.asyncEditorLoadDelay):Yt())):A=P=null,i&&Ve(Y.onActiveCellChanged,ii())}function Qt(e,t){var i=Ke();return(!(e<i)||je(e))&&(!(C[t].cannotTriggerInsert&&i<=e)&&!!Je(e,t))}function qt(){var e,t,i;te&&(Ve(Y.onBeforeCellEditorDestroy,{editor:te}),te.destroy(),te=null,ee&&(e=je(A),Di(ee).removeClass("editable invalid"),e&&(t=C[P],i=Xe(A,t),tt(ee),ee.appendChild(i(A,P,Ze(e,t),t,e)),vt(A))),navigator.userAgent.toLowerCase().match(/msie/)&&function(){var e;if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(e){}else!window.getSelection||(e=window.getSelection())&&e.removeAllRanges&&e.removeAllRanges()}(),Ne().deactivate(G))}function Yt(e){if(ee){if(!h.editable)throw"Grid : makeActiveCellEditable : should never get called when options.editable is false";var t,i;clearTimeout(ve),Qt(A,P)&&(t=C[P],i=je(A),!1!==Ve(Y.onBeforeEditCell,{row:A,cell:P,item:i,column:t})?(Ne().activate(G),Di(ee).addClass("editable"),e||tt(ee),te=new(e||Je(A,P))({grid:Y,gridPosition:Zt(d[0]),position:Zt(ee),container:ee,column:t,item:i||{},commitChanges:Xt,cancelChanges:Jt}),i&&te.loadValue(i),B=te.serializeValue(),te.position&&ti()):Kt())}}function Xt(){Ne().commitCurrentEdit()&&(Kt(),h.autoEdit&&fi())}function Jt(){Ne().cancelCurrentEdit()&&Kt()}function Zt(e){var t={top:e.offsetTop,left:e.offsetLeft,bottom:0,right:0,width:Di(e).outerWidth(),height:Di(e).outerHeight(),visible:!0};t.bottom=t.top+t.height,t.right=t.left+t.width;for(var i=e.offsetParent;(e=e.parentNode)!=document.body;)t.visible&&e.scrollHeight!=e.offsetHeight&&"visible"!=Di(e).css("overflowY")&&(t.visible=t.bottom>e.scrollTop&&t.top<e.scrollTop+e.clientHeight),t.visible&&e.scrollWidth!=e.offsetWidth&&"visible"!=Di(e).css("overflowX")&&(t.visible=t.right>e.scrollLeft&&t.left<e.scrollLeft+e.clientWidth),t.left-=e.scrollLeft,t.top-=e.scrollTop,e===i&&(t.left+=e.offsetLeft,t.top+=e.offsetTop,i=e.offsetParent),t.bottom=t.top+t.height,t.right=t.left+t.width;return t}function ei(){return Zt(ee)}function ti(){var e;ee&&(Ve(Y.onActiveCellPositionChanged,{}),te&&(e=ei(),te.show&&te.hide&&(e.visible?te.show():te.hide()),te.position&&te.position(e)))}function ii(){return ee?{row:A,cell:P}:null}function oi(e,t){var i=e*h.rowHeight,o=(e+1)*h.rowHeight-F+(O?Fi.height:0);(e+1)*h.rowHeight>ne+F+j?(Ye(t?i:o),Ct()):e*h.rowHeight<ne+j&&(Ye(t?o:i),Ct())}function ni(e){e*=H;if(Ye((qe(ne)+e)*h.rowHeight),Ct(),h.enableCellNavigation&&null!=A){var t=A+e,e=ze();(t=e<=t?e-1:t)<0&&(t=0);for(var i=0,o=null,e=L;i<=L;)Si(t,i)&&(o=i),i+=ri(t,i);null!==o?(jt(_i(t,o)),L=e):Wt()}}function ai(){ni(1)}function si(){ni(-1)}function ri(e,t){e=v.getItemMetadata&&v.getItemMetadata(e);if(!e||!e.columns)return 1;e=e.columns[C[t].id]||e.columns[t],e=e&&e.colspan;return e="*"===e?C.length-t:e||1}function li(e){for(var t=0;t<C.length;){if(Si(e,t))return t;t+=ri(e,t)}return null}function ui(e,t,i){if(t>=C.length)return null;for(;(t+=ri(e,t))<C.length&&!Si(e,t););return t<C.length?{row:e,cell:t,posX:t}:null}function di(e,t,i){if(t<=0)return null;var o=li(e);if(null===o||t<=o)return null;for(var n,a={row:e,cell:o,posX:o};;){if(!(n=ui(a.row,a.cell,a.posX)))return null;if(n.cell>=t)return a;a=n}}function ci(e,t,i){for(var o,n=ze();;){if(++e>=n)return null;for(o=t=0;t<=i;)t+=ri(e,o=t);if(Si(e,o))return{row:e,cell:o,posX:i}}}function pi(e,t,i){for(var o;;){if(--e<0)return null;for(o=t=0;t<=i;)t+=ri(e,o=t);if(Si(e,o))return{row:e,cell:o,posX:i}}}function hi(e,t,i){if(null==e&&null==t&&Si(e=t=0,t))return{row:e,cell:t,posX:t};t=ui(e,t);if(t)return t;for(var o,n=ze();++e<n;)if(null!==(o=li(e)))return{row:e,cell:o,posX:o};return null}function gi(e,t,i){if(null==e&&null==t&&Si(e=ze()-1,t=C.length-1))return{row:e,cell:t,posX:t};for(var o,n;!o&&!(o=di(e,t));){if(--e<0)return null;t=0,null!==(n=function(e){for(var t=0,i=null;t<C.length;)Si(e,t)&&(i=t),t+=ri(e,t);return i}(e))&&(o={row:e,cell:n,posX:n})}return o}function fi(){return yi("right")}function mi(){return yi("left")}function vi(){return yi("down")}function Ci(){return yi("up")}function wi(){return yi("next")}function bi(){return yi("prev")}function yi(e){if(!h.enableCellNavigation)return!1;if(!ee&&"prev"!=e&&"next"!=e)return!1;if(!Ne().commitCurrentEdit())return!0;if(null===A||null===P)return!1;Kt();t={up:-1,down:1,left:-1,right:1,prev:-1,next:1}[e];e=(0,{up:pi,down:ci,left:di,right:ui,prev:gi,next:hi}[e])(A,P,L);return e?(zt(e.row,e.cell,!1),jt(_i(e.row,e.cell)),L=e.posX,!0):(jt(_i(A,P)),!1)}function _i(e,t){return ie[e]?(ht(e),ie[e].cellNodesByColumnIdx[t]):null}function Si(e,t){if(!h.enableCellNavigation||e>=ze()||e<0||t>=C.length||t<0)return!1;e=v.getItemMetadata&&v.getItemMetadata(e);if(e&&"boolean"==typeof e.focusable)return e.focusable;e=e&&e.columns;return(e&&e[C[t].id]&&"boolean"==typeof e[C[t].id].focusable?e[C[t].id]:(e&&e[t]&&"boolean"==typeof e[t].focusable?e:C)[t]).focusable}function Ri(e,t){if(e>=Ke()||e<0||t>=C.length||t<0)return!1;e=v.getItemMetadata&&v.getItemMetadata(e);if(e&&"boolean"==typeof e.selectable)return e.selectable;e=e&&e.columns&&(e.columns[C[t].id]||e.columns[t]);return(e&&"boolean"==typeof e.selectable?e:C[t]).selectable}function Mi(e,t,i){Q&&Si(e,t)&&Ne().commitCurrentEdit()&&(zt(e,t,!1),jt(_i(e,t),i||e===Ke()||h.autoEdit),te||Kt())}function ki(){var e=je(A),t=C[P];if(te){if(te.isValueChanged()){var i,o=te.validate();return o.valid?(A<Ke()?(i={row:A,cell:P,editor:te,serializedValue:te.serializeValue(),prevSerializedValue:B,execute:function(){this.editor.applyValue(e,this.serializedValue),lt(this.row),Ve(Y.onCellChange,{row:A,cell:P,item:e})},undo:function(){this.editor.applyValue(e,this.prevSerializedValue),lt(this.row),Ve(Y.onCellChange,{row:A,cell:P,item:e})}},h.editCommandHandler?(qt(),h.editCommandHandler(e,t,i)):(i.execute(),qt())):(te.applyValue(i={},te.serializeValue()),qt(),Ve(Y.onAddNewRow,{item:i,column:t})),!Ne().isActive()):(Di(ee).removeClass("invalid"),Di(ee).width(),Di(ee).addClass("invalid"),Ve(Y.onValidationError,{editor:te,cellNode:ee,validationResults:o,row:A,cell:P,column:t}),te.focus(),!1)}qt()}return!0}function Ii(){return qt(),!0}function Ti(){if(!o)throw"Selection model is not set";return ue}Di.extend(this,{slickGridVersion:"2.1",onScroll:new Slick.Event,onSort:new Slick.Event,onHeaderMouseEnter:new Slick.Event,onHeaderMouseLeave:new Slick.Event,onHeaderContextMenu:new Slick.Event,onHeaderClick:new Slick.Event,onHeaderCellRendered:new Slick.Event,onBeforeHeaderCellDestroy:new Slick.Event,onHeaderRowCellRendered:new Slick.Event,onBeforeHeaderRowCellDestroy:new Slick.Event,onMouseEnter:new Slick.Event,onMouseLeave:new Slick.Event,onClick:new Slick.Event,onClickDone:new Slick.Event,onDblClick:new Slick.Event,onContextMenu:new Slick.Event,onKeyDown:new Slick.Event,onKeyDownDone:new Slick.Event,onAddNewRow:new Slick.Event,onValidationError:new Slick.Event,onViewportChanged:new Slick.Event,onColumnsReorderStart:new Slick.Event,onBeforeColumnsReordered:new Slick.Event,onColumnsReordered:new Slick.Event,onColumnsResized:new Slick.Event,onCellChange:new Slick.Event,onBeforeEditCell:new Slick.Event,onBeforeCellEditorDestroy:new Slick.Event,onBeforeDestroy:new Slick.Event,onActiveCellChanged:new Slick.Event,onActiveCellPositionChanged:new Slick.Event,onDragInit:new Slick.Event,onDragStart:new Slick.Event,onDrag:new Slick.Event,onDragEnd:new Slick.Event,onSelectedRowsChanged:new Slick.Event,onCellCssStylesChanged:new Slick.Event,registerPlugin:function(e){de.unshift(e),e.init(Y)},unregisterPlugin:Me,getColumns:function(){return C},setColumns:Ue,getColumnIndex:Le,updateColumnHeader:function(e,t,i){var o,n;!Q||null!=(o=Le(e))&&(n=C[o],(e=f.children(":not(.slick-sortable-placeholder):not(.ui-sortable-helper)").eq(o))&&(void 0!==t&&(C[o].name=t),void 0!==i&&(C[o].toolTip=i),Ve(Y.onBeforeHeaderCellDestroy,{node:e[0],column:n}),e.attr("title",i||"").children().eq(0).html(t),Ve(Y.onHeaderCellRendered,{node:e[0],column:n})))},setSortColumn:function(e,t){Ge([{columnId:e,sortAsc:t}])},setSortColumns:Ge,getSortColumns:function(){return he},autosizeColumns:Ae,getOptions:function(){return h},setOptions:function(e){Ne().commitCurrentEdit()&&(qt(),h.enableAddRow!==e.enableAddRow&&rt(Ke()),h=Di.extend(h,e),We(),R.css("overflow-y",h.autoHeight?"hidden":"auto"),Ct())},getData:function(){return v},getDataLength:Ke,getDataItem:je,setData:function(e,t){v=e,nt(),dt(),t&&Ye(0)},getSelectionModel:function(){return o},setSelectionModel:function(e){o&&(o.onSelectedRangesChanged.unsubscribe(He),o.destroy&&o.destroy()),(o=e)&&(o.init(Y),o.onSelectedRangesChanged.subscribe(He))},getSelectedRows:Ti,setSelectedRows:function(e,t,i){if(!o)throw"Selection model is not set";o.setSelectedRanges(function(e,t){for(var i=[],o=0,n=C.length-1,a=0;a<e.length;a++)t&&t.length&&(o=n=t[a]),i.push(new Slick.Range(e[a],o,e[a],n));return i}(e,t),i)},getContainerNode:function(){return d.get(0)},reset_prevScrollLeft:function(){re=-1},render:Ct,invalidate:function(){dt(),nt(),Ct()},invalidateRow:rt,invalidateRows:st,invalidateAllRows:nt,updateCell:function(e,t){var i,o,n=_i(e,t);n&&(i=C[t],o=je(e),te&&A===e&&P===t?te.loadValue(o):o instanceof Slick.NonDataRow||(tt(n),o&&n.appendChild(Xe(e,i)(e,t,Ze(o,i),i,o)),vt(e)))},updateRow:lt,getViewport:ct,getRenderedRange:pt,resizeCanvas:ut,updateRowCount:dt,scrollRowIntoView:oi,scrollRowToTop:function(e){Ye(e*h.rowHeight),Ct()},scrollCellIntoView:zt,getCanvasNode:function(){return M[0]},focus:Kt,getCellFromPoint:function(e,t){for(var t=qe(t),i=0,o=0,n=0;n<C.length&&o<e;n++)o+=C[n].width,i++;return{row:t,cell:(i=i<0?0:i)-1}},getCellFromEvent:Ut,getActiveCell:ii,setActiveCell:function(e,t){Q&&(e>Ke()||e<0||t>=C.length||t<0||h.enableCellNavigation&&(zt(e,t,!1),jt(_i(e,t),!1)))},getActiveCellNode:function(){return ee},getActiveCellPosition:ei,resetActiveCell:Wt,editActiveCell:Yt,getCellEditor:function(){return te},getCellNode:_i,getCellNodeBox:function(e,t){if(!Gt(e,t))return null;for(var i=Qe(e),e=i+h.rowHeight-1,o=0,n=0;n<t;n++)o+=C[n].width;return{top:i,left:o,bottom:e,right:o+C[t].width}},canCellBeSelected:Ri,canCellBeActive:Si,navigatePrev:bi,navigateNext:wi,navigateUp:Ci,navigateDown:vi,navigateLeft:mi,navigateRight:fi,navigatePageUp:si,navigatePageDown:ai,gotoCell:Mi,getTopPanel:function(){return S[0]},getHeaderRow:function(){return m[0]},getHeaderRowColumn:function(e){return e=Le(e),(e=m.children().eq(e))&&e[0]},getGridPosition:function(){return Zt(d[0])},addCellCssStyles:function(e,t){if(ce[e])throw"addCellCssStyles: cell CSS hash with key '"+e+"' already exists.";yt(ce[e]=t,null),Ve(Y.onCellCssStylesChanged,{key:e,hash:t})},setCellCssStyles:_t,removeCellCssStyles:function(e){ce[e]&&(yt(null,ce[e]),delete ce[e],Ve(Y.onCellCssStylesChanged,{key:e,hash:null}))},getCellCssStyles:function(e){return ce[e]},init:Re,destroy:function(){Ne().cancelCurrentEdit(),Ve(Y.onBeforeDestroy,{});for(var e=de.length;e--;)Me(de[e]);h.enableColumnReorder&&f.filter(":ui-sortable").sortable("destroy"),i&&(i.unbind("scroll."+q),i=null),d.unbind(".slickgrid"),Oe(),M.unbind("draginit dragstart dragend drag"),d.empty().removeClass(q)},getEditorLock:Ne,getEditController:function(){return G}}),function(){if((d=Di(n)).length<1)throw new Error("SlickGrid requires a valid container, "+n+" does not exist in the DOM.");var e,t;xi=xi||function(){var e=1e6,t=navigator.userAgent.toLowerCase().match(/firefox/)?6e6:1e9,i=Di("<div style='display:none' />").appendTo(document.body);for(;;){var o=2*e;if(i.css("height",o),t<o||i.height()!==o)break;e=o}return i.remove(),e}(),Fi=Fi||(e=Di("<div style='position:absolute; top:-10000px; left:-10000px; width:100px; height:100px; overflow:scroll;'></div>").appendTo(d),t={width:e.width()-e[0].clientWidth,height:e.height()-e[0].clientHeight},e.remove(),t),h=Di.extend({},W,h),We(),K.width=h.defaultColumnWidth,pe={};for(var i=0;i<C.length;i++){var o=C[i]=Di.extend({},K,C[i]);pe[o.id]=i,Se.push(o.width),o.maxWidth&&o.width>o.maxWidth&&(o.width=o.maxWidth)}if(h.enableColumnReorder&&!Di.fn.sortable)throw new Error("SlickGrid's 'enableColumnReorder = true' option requires jquery-ui.sortable module to be loaded");G={commitCurrentEdit:ki,cancelCurrentEdit:Ii},d.empty().css("overflow","hidden").css("outline",0).addClass(q).addClass("ui-widget"),h.fontFamily?d.css("font-family",h.fontFamily):d.css("font-family",""),h.fontSize?d.css("font-size",h.fontSize):d.css("font-size",""),/relative|absolute|fixed/.test(d.css("position"))||d.css("position","relative"),c=Di("<div tabIndex='0' hideFocus style='position:fixed;width:0;height:0;top:0;left:0;outline:0;'></div>").appendTo(d),g=Di("<div class='slick-header ui-state-default' style='overflow:hidden;position:relative;' />").appendTo(d),(f=Di("<div class='slick-header-columns' style='left:-1000px' />").appendTo(g)).width(ke()),w=Di("<div class='slick-headerrow ui-state-default' style='overflow:hidden;position:relative;' />").appendTo(d),m=Di("<div class='slick-headerrow-columns' />").appendTo(w),b=Di("<div style='display:block;height:1px;position:absolute;top:0;left:0;'></div>").css("width",Ie()+Fi.width+"px").appendTo(w),y=Di("<div class='slick-top-panel-scroller ui-state-default' style='overflow:hidden;position:relative;' />").appendTo(d),S=Di("<div class='slick-top-panel' style='width:10000px' />").appendTo(y),h.showTopPanel||y.hide(),h.showHeaderRow&&(!h.showHeaderRow||h.isHeaderRowVisible)||w.hide(),(R=Di("<div class='slick-viewport' style='width:100%;overflow:auto;outline:0;position:relative;;'>").appendTo(d)).css("overflow-y",h.autoHeight?"hidden":"auto"),M=Di("<div class='grid-canvas' />").appendTo(R),p=c.clone().appendTo(d),h.explicitInitialization||Re()}()}}}),(q=jQuery).extend(!0,window,{Slick:{Data:{DataView:function(n){var o,a,s,r,l,u=this,d="id",c=[],p=[],h={},g=null,f=null,m=null,v=!1,C=!1,w=!0,b={},y={},S=[],R=[],i=null,M={getter:null,formatter:null,comparer:function(e,t){return e.value-t.value},predefinedValues:[],aggregators:[],aggregateEmpty:!1,aggregateCollapsed:!1,aggregateChildGroups:!1,collapsed:!1,displayTotalsRow:!0,lazyTotalsCalculation:!1},k=[],I=[],T=[],D=":|:",F=0,x=0,E=0,O=new Slick.Event,V=new Slick.Event,N=new Slick.Event,L=(n=q.extend(!0,{},{groupItemMetadataProvider:null,inlineFilters:!1},n)).atomizeTemporal||_.identity;function A(e){if(!C)for(var t,i=e=e||0,o=c.length;i<o;i++){if(void 0===(t=c[i][d]))throw"Each data element must implement a unique 'id' property";h[L(t)]=i}}function P(){var e=F?Math.max(1,Math.ceil(E/F)):1;return{pageSize:F,pageNum:x,totalRows:E,totalPages:e}}function e(e,t,i){w=t,a=e,o=null,i||(!1===t&&c.reverse(),c.sort(e),!1===t&&c.reverse(),h={},A(),Q())}function t(e,t){w=t,o=e,a=null;var i=Object.prototype.toString;Object.prototype.toString="function"==typeof e?e:function(){return this[e]},!1===t&&c.reverse(),c.sort(),Object.prototype.toString=i,!1===t&&c.reverse(),h={},A(),Q()}function B(){if(!g){g={};for(var e=0,t=p.length;e<t;e++)g[p[e][d]]=e}}function G(e,t){if(null==e)for(var i=0;i<k.length;i++)T[i]={},k[i].collapsed=t;else T[e]={},k[e].collapsed=t;Q()}function H(e,t,i){T[e][t]=k[e].collapsed^i,Q()}function $(e){var t,i=e.group,o=k[i.level],n=i.level==k.length,a=o.aggregators.length;if(!n&&o.aggregateChildGroups)for(var s=i.groups.length;s--;)i.groups[s].initialized||$(i.groups[s]);for(;a--;)(t=o.aggregators[a]).init(),!n&&o.aggregateChildGroups?o.compiledAccumulators[a].call(t,i.groups):o.compiledAccumulators[a].call(t,i.rows),t.storeResult(e);e.initialized=!0}function U(e,t){for(var i,o,n,a,s=k[t=t||0],r=s.collapsed,l=T[t],u=e.length;u--;)(i=e[u]).collapsed&&!s.aggregateCollapsed||(i.groups&&U(i.groups,t+1),s.aggregators.length&&(s.aggregateEmpty||i.rows.length||i.groups&&i.groups.length)&&(a=n=void 0,n=k[(o=i).level],((a=new Slick.GroupTotals).group=o).totals=a,n.lazyTotalsCalculation||$(a)),i.collapsed=r^l[i.groupingKey],i.title=s.formatter?s.formatter(i):i.value)}function W(e,t){for(var i=[],o=0,n=0,a=e.length;n<a;n++)f(e[n],t)&&(i[o++]=e[n]);return i}function K(e,t,i){for(var o,n=[],a=0,s=0,r=e.length;s<r;s++)o=e[s],i[s]?n[a++]=o:f(o,t)&&(n[a++]=o,i[s]=!0);return n}function z(e,t){var i,o;return f?(i=n.inlineFilters?r:W,o=n.inlineFilters?l:K,b.isFilterNarrowing?S=i(S,s):b.isFilterExpanding?S=o(e,s,R):b.isFilterUnchanged||(S=i(e,s))):S=F?e:e.concat(),t=!t&&F?(S.length<x*F&&(x=Math.floor(S.length/F)),S.slice(F*x,F*x+F)):S,{totalRows:S.length,rows:t}}function j(e){g=null,b.isFilterNarrowing==y.isFilterNarrowing&&b.isFilterExpanding==y.isFilterExpanding||(R=[]);var t=z(e);E=t.totalRows;e=t.rows;I=[],k.length&&(I=function e(t,i){for(var o,n,a,s=[],r={},l=i?i.level+1:0,u=k[l],d=0,c=u.predefinedValues.length;d<c;d++)(o=r[n=u.predefinedValues[d]])||((o=new Slick.Group).value=n,o.level=l,o.groupingKey=(i?i.groupingKey+D:"")+n,s[s.length]=o,r[n]=o);for(d=0,c=t.length;d<c;d++)a=t[d],(o=r[n=u.getterIsAFn?u.getter(a):a[u.getter]])||((o=new Slick.Group).value=n,o.level=l,o.groupingKey=(i?i.groupingKey+D:"")+n,s[s.length]=o,r[n]=o),o.rows[o.count++]=a;if(l<k.length-1)for(d=0;d<s.length;d++)(o=s[d]).groups=e(o.rows,o);return s.sort(k[l].comparer),s}(e)).length&&(U(I),e=function e(t,i){for(var o,n=k[i=i||0],a=[],s=0,r=0,l=t.length;r<l;r++){if(o=t[r],!(a[s++]=o).collapsed)for(var u,d=0,c=(u=o.groups?e(o.groups,i+1):o.rows).length;d<c;d++)a[s++]=u[d];o.totals&&n.displayTotalsRow&&(!o.collapsed||n.aggregateCollapsed)&&(a[s++]=o.totals)}return a}(I));t=function(e,t){var i,o,n,a=[],s=0,r=t.length;q.grep(t,function(e){return!e.__group}).length,b&&b.ignoreDiffsBefore&&(s=Math.max(0,Math.min(t.length,b.ignoreDiffsBefore))),b&&b.ignoreDiffsAfter&&(r=Math.min(t.length,Math.max(0,b.ignoreDiffsAfter)));for(var l=s,u=e.length;l<r;l++)u<=l?a[a.length]=l:(i=t[l],o=e[l],(k.length&&(n=i.__nonDataRow||o.__nonDataRow)&&i.__group!==o.__group||i.__group&&!i.equals(o)||n&&(i.__groupTotals||o.__groupTotals)||i[d]!=o[d]||m&&m[i[d]])&&(a[a.length]=l));return a}(p,e);return p=e,t}function Q(){var e,t,i;v||(e=p.length,t=E,i=j(c),F&&E<x*F&&(x=Math.max(0,Math.ceil(E/F)-1),i=j(c)),m=null,y=b,b={},t!=E&&N.notify(P(),null,u),e!=p.length&&O.notify({previous:e,current:p.length},null,u),(0<i.length||t!=E||e!=p.length)&&V.notify({rows:i},null,u))}q.extend(this,{beginUpdate:function(){v=!0},endUpdate:function(){v=!1,Q()},suspendIndexing:function(){C=!0,i={}},reactivateIndexing:function(e){C=!1,_.isEmpty(i)||(c=_.reject(c,function(e,t){return i[t]}),i=null),e||A()},setPagingOptions:function(e){null!=e.pageSize&&(F=e.pageSize,x=F?Math.min(x,Math.max(0,Math.ceil(E/F)-1)):0),null!=e.pageNum&&(x=Math.min(e.pageNum,Math.max(0,Math.ceil(E/F)-1))),N.notify(P(),null,u),Q()},getPagingInfo:P,getItems:function(){return c},setItems:function(e,t){void 0!==t&&(d=t),c=S=e,h={},A(),function(){for(var e,t=0,i=c.length;t<i;t++)if(e=c[t][d],void 0===(e=L(e))||h[e]!==t)throw"Each data element must implement a unique 'id' property"}(),Q()},setFilter:function(e){f=e,Q()},sort:e,fastSort:t,reSort:function(){a?e(a,w):o&&t(o,w)},setGrouping:function(e){n.groupItemMetadataProvider||(n.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider),I=[],T=[],k=(e=e||[])instanceof Array?e:[e];for(var t=0;t<k.length;t++){var i=k[t]=q.extend(!0,{},M,k[t]);i.getterIsAFn="function"==typeof i.getter,i.compiledAccumulators=[];for(var o=i.aggregators.length;o--;)i.compiledAccumulators[o]=function(e){e=function(e){e=e.toString().match(/^function[^(]*\(([^)]*)\)\s*{([\s\S]*)}$/);return{params:e[1].split(","),body:e[2]}}(e.accumulate),e=new Function("_items","for (var "+e.params[0]+", _i=0, _il=_items.length; _i<_il; _i++) {"+e.params[0]+" = _items[_i]; "+e.body+"}");return e.displayName=e.name="compiledAccumulatorLoop",e}(i.aggregators[o]);T[t]={}}Q()},getGrouping:function(){return k},collapseAllGroups:function(e){G(e,!0)},expandAllGroups:function(e){G(e,!1)},collapseGroup:function(e){var t=Array.prototype.slice.call(arguments),i=t[0];1==t.length&&-1!=i.indexOf(D)?H(i.split(D).length-1,i,!0):H(t.length-1,t.join(D),!0)},expandGroup:function(e){var t=Array.prototype.slice.call(arguments),i=t[0];1==t.length&&-1!=i.indexOf(D)?H(i.split(D).length-1,i,!1):H(t.length-1,t.join(D),!1)},filterRows:function(e){return z(e,!0).rows},getFilteredItems:function(){return S},getGroups:function(){return I},getIdxById:function(e){return h[L(e)]},getInternalMap_idxById:function(){return h},getRowById:function(e){return B(),g[e]},getItemById:function(e){return c[h[L(e)]]},getItemByIdx:function(e){return c[e]},extractIds:function(e){for(var t=[],i=0,o=e.length;i<o;i++)t[t.length]=e[i][d];return t},getOptions:function(){return n},mapRowsToIds:function(e){for(var t=[],i=0,o=e.length;i<o;i++)e[i]<p.length&&(t[t.length]=p[e[i]][d]);return t},mapIdsToRows:function(e){var t=[];B();for(var i=0,o=e.length;i<o;i++){var n=g[e[i]];null!=n&&(t[t.length]=n)}return t},setRefreshHints:function(e){b=e},setFilterArgs:function(e){s=e},refresh:Q,updateItem:function(e,t){var i=L(e);if(void 0===h[i]||i!==L(t[d]))throw"Invalid or non-matching id";c[h[i]]=t,(m=m||{})[e]=!0,Q()},updateItem_unchecked_noRefresh:function(e,t){var i;t&&(i=L(e),c[h[i]]=t),(m=m||{})[e]=!0},insertItem:function(e,t){c.splice(e,0,t),A(e),Q()},addItem:function(e){c.push(e),A(c.length-1),Q()},deleteItem:function(e){e=L(e);var t=h[e];void 0!==t?(delete h[e],C?i[t]=!0:c.splice(t,1),A(t),Q()):console.log("slickgrid.deleteItem: Invalid id, item does not exist",e)},syncGridSelection:function(o,t,n){var a,s=this,r=[],i=new Slick.Event;function l(e){r.join(",")!=e.join(",")&&(r=e,i.notify({grid:o,ids:r},new Slick.EventData,s))}function u(){a=!0;var e=s.mapIdsToRows(r);t||l(s.mapRowsToIds(e)),o.setSelectedRows(e),a=!1}return o.onSelectedRowsChanged.subscribe(function(e,t){var i;a||(i=s.mapRowsToIds(o.getSelectedRows()),_.pull(i,void 0),n&&o.getOptions().multiSelect&&e.rememberHidden?l(q.grep(r,function(e){return void 0===s.getRowById(e)}).concat(i)):l(i))}),this.onRowsChanged.subscribe(u),this.onRowCountChanged.subscribe(u),this.selectionSyncHelper={addSelectedIds:function(e){l(_.union(r,e)),u()},getSelectedIds:function(){return r},onSelectedRowIdsChanged:i,removeSelectedIds:function(e){l(_.difference(r,e)),u()},setSelectedIds:function(e){l(e),u()}},i},getLength:function(){return p.length},getItem:function(e){var t=p[e];return t&&t.__group&&t.totals&&!t.totals.initialized?(e=k[t.level]).displayTotalsRow||($(t.totals),t.title=e.formatter?e.formatter(t):t.value):t&&t.__groupTotals&&!t.initialized?$(t):!n.populateItem||t instanceof Slick.NonDataRow||(t=n.populateItem(t)),t},getItemMetadata:function(e){return void 0===(e=p[e])?null:e.__group?n.groupItemMetadataProvider.getGroupRowMetadata(e):e.__groupTotals?n.groupItemMetadataProvider.getTotalsRowMetadata(e):null},onRowCountChanged:O,onRowsChanged:V,onPagingInfoChanged:N})},Aggregators:{}}}}),(P=jQuery).extend(!0,window,{Slick:{CellRangeDecorator:function(i,o){var n;o=P.extend(!0,{},{selectionCssClass:"slick-range-decorator",selectionCss:{zIndex:"9999",border:"2px dashed red"}},o),P.extend(this,{show:function(e){n=n||P("<div></div>",{css:o.selectionCss}).addClass(o.selectionCssClass).css("position","absolute").appendTo(i.getCanvasNode());var t=i.getCellNodeBox(e.fromRow,e.fromCell),e=i.getCellNodeBox(e.toRow,e.toCell);return n.css({top:t.top,left:t.left,height:e.bottom-t.top+1,width:e.right-t.left}),n},hide:function(){n&&(n.remove(),n=null)}})}}}),(B=jQuery).extend(!0,window,{Slick:{CellRangeSelector:function(t){var o,n,a,s,r=this,i=new Slick.EventHandler,l={selectionCss:{border:"2px dashed blue"}};function u(e,t){e.stopImmediatePropagation()}function d(e,t){var i=o.getCellFromEvent(e);if(!1!==r.onBeforeCellRangeSelected.notify(i)&&o.canCellBeSelected(i.row,i.cell)&&(a=!0,e.stopImmediatePropagation()),a){o.focus();e=o.getCellFromPoint(t.startX-B(n).offset().left,t.startY-B(n).offset().top);return t.range={start:e,end:{}},s.show(new Slick.Range(e.row,e.cell))}}function c(e,t){a&&(e.stopImmediatePropagation(),e=o.getCellFromPoint(e.pageX-B(n).offset().left,e.pageY-B(n).offset().top),o.canCellBeSelected(e.row,e.cell)&&(t.range.end=e,s.show(new Slick.Range(t.range.start.row,t.range.start.cell,e.row,e.cell))))}function p(e,t){a&&(a=!1,e.stopImmediatePropagation(),s.hide(),r.onCellRangeSelected.notify({range:new Slick.Range(t.range.start.row,t.range.start.cell,t.range.end.row,t.range.end.cell)}))}B.extend(this,{init:function(e){t=B.extend(!0,{},l,t),s=new Slick.CellRangeDecorator(e,t),n=(o=e).getCanvasNode(),i.subscribe(o.onDragInit,u).subscribe(o.onDragStart,d).subscribe(o.onDrag,c).subscribe(o.onDragEnd,p)},destroy:function(){i.unsubscribeAll()},onBeforeCellRangeSelected:new Slick.Event,onCellRangeSelected:new Slick.Event})}}}),(G=jQuery).extend(!0,window,{Slick:{RowSelectionModel:function(t){var l,i,o,u=[],n=this,a=new Slick.EventHandler,s={selectActiveRow:!0};function r(e){return function(){i||(i=!0,e.apply(this,arguments),i=!1)}}function d(e){for(var t=[],i=0;i<e.length;i++)for(var o=e[i].fromRow;o<=e[i].toRow;o++)t.push(o);return t}function c(e){for(var t=[],i=l.getColumns().length-1,o=0;o<e.length;o++)t.push(new Slick.Range(e[o],0,e[o],i));return t}function p(){return d(u)}function h(e,t){u=e,t&&void 0===t.rememberHidden&&(t.rememberHidden=!!(t.ctrlKey||t.shiftKey||t.metaKey)),n.onSelectedRangesChanged.notify(u,t)}function g(e,t){o.selectActiveRow&&null!=t.row&&t.grid.canCellBeSelected(t.row,t.cell)&&h([new Slick.Range(t.row,0,t.row,l.getColumns().length-1)])}function f(e){var t,i,o=l.getActiveCell();!l.getOptions().multiSelect&&e.shiftKey||!o||!e.shiftKey||e.ctrlKey||e.altKey||e.metaKey||38!=e.which&&40!=e.which||((i=p()).sort(function(e,t){return e-t}),t=(i=!i.length?[o.row]:i)[0],i=i[i.length-1],0<=(o=40==e.which?o.row<i||t==i?++i:++t:o.row<i?--i:--t)&&o<l.getDataLength()&&(l.scrollRowIntoView(o),h(u=c(function(e,t){for(var i=[],o=e;o<=t;o++)i.push(o);for(o=t;o<e;o++)i.push(o);return i}(t,i)))),e.preventDefault(),e.stopPropagation())}function m(e){var i=l.getCellFromEvent(e),t=l.getOptions().multiSelect;if(!i||!l.canCellBeActive(i.row,i.cell))return!1;if(!e.ctrlKey&&!e.shiftKey&&!e.metaKey)return!1;var o=d(u),n=G.inArray(i.row,o);if(-1===n&&(e.ctrlKey||e.metaKey))(o=!t?[]:o).push(i.row),l.setActiveCell(i.row,i.cell);else if(-1!==n&&(e.ctrlKey||e.metaKey)){n=o.length;(o=G.grep(o,function(e,t){return e!==i.row})).length<n?l.resetActiveCell():l.setActiveCell(i.row,i.cell)}else if(o.length&&e.shiftKey){if(!t)return;var t=o[0],a=i.row,s=_.reduce(o,function(e,t){return e[t]=!0,e},{});if(t<=a)for(var r=t;r<=a;r++)s[r]||o.push(r);else for(r=t;a<=r;r--)s[r]||o.push(r);l.setActiveCell(i.row,i.cell)}return h(u=c(o),e),e.stopImmediatePropagation(),!0}G.extend(this,{getSelectedRows:p,setSelectedRows:function(e){h(c(e))},getSelectedRanges:function(){return u},setSelectedRanges:h,init:function(e){o=G.extend(!0,{},s,t),l=e,a.subscribe(l.onActiveCellChanged,r(g)),a.subscribe(l.onKeyDown,r(f)),a.subscribe(l.onClick,r(m))},destroy:function(){a.unsubscribeAll()},onSelectedRangesChanged:new Slick.Event})}}}),(H=jQuery).extend(!0,window,{Slick:{CellExternalCopyManager:function(e){var C,w,b=this,y=e||{},s=y.copiedCellStyleLayerKey||"copy-manager",r=y.copiedCellStyle||"copied",l=0,S=y.bodyElement||document.body,R=y.onCopyInit||null,M=y.onCopySuccess||null,k={C:67,V:86,ESC:27,INSERT:45};function t(e,t){var i;if(!C.getEditorLock().isActive()||C.getOptions().autoEdit){if(e.which==k.ESC&&w&&(e.preventDefault(),T(),b.onCopyCancelled.notify({ranges:w}),w=null),(e.which===k.C||e.which===k.INSERT)&&(e.ctrlKey||e.metaKey)&&!e.shiftKey&&(R&&R.call(),0!=(s=C.getSelectionModel().getSelectedRanges()).length)){I(w=s),b.onCopyCells.notify({ranges:s});for(var o=C.getColumns(),n="",a=!1,s=_.sortBy(s,["fromRow","toRow"]),r=0;r<s.length;r++){for(var l=s[r],u=[],d=l.fromRow;d<l.toRow+1;d++){var c=[],p=C.getDataItem(d);if(""==u&&y.includeHeaderWhenCopying&&!a&&e.altKey){for(var a=!0,h=[],g=l.fromCell;g<l.toCell+1;g++)0<o[g].name.length&&"_checkbox_selector"!==o[g].id&&h.push(o[g].name);u.push(h.join("\t"))}for(g=l.fromCell;g<l.toCell+1;g++)"_checkbox_selector"!==o[g].id&&c.push(function(e,t){if(y.dataItemColumnValueExtractor){var i=y.dataItemColumnValueExtractor(e,t);if(i)return i}return i=e[t.field],H(t.formatter(null,null,i,t,e)).text()}(p,o[g]));u.push(c.join("\t"))}n+=u.join("\r\n")+"\r\n"}if(window.clipboardData)return window.clipboardData.setData("Text",n),!0;var f,m=H(C.getActiveCellNode()),v=(i=n,(f=document.createElement("textarea")).style.position="absolute",f.style.left="-10000px",f.style.top=document.body.scrollTop+"px",f.value=i,0<(i=H(".ui-dialog.ui-widget-content:visible")).length?H(f).appendTo(i.last()):S.appendChild(f),f.select(),f);if(v.focus(),a&&document.queryCommandSupported&&document.queryCommandSupported("copy"))try{document.execCommand("copy")}catch(e){return console.warn("Copy to clipboard failed.",e),!1}return setTimeout(function(){H(v).remove(),m&&0<m.length&&(m.attr("tabIndex","-1"),m.focus(),m.removeAttr("tabIndex"))},100),M&&(f=0,f=1===s.length?s[0].toRow+1-s[0].fromRow:s.length,M.call(this,f)),!1}e.which===k.V&&(e.ctrlKey||e.metaKey)&&!e.shiftKey||e.which===k.INSERT&&e.shiftKey&&e.ctrlKey}}function I(e){T();for(var t=C.getColumns(),i={},o=0;o<e.length;o++)for(var n=e[o].fromRow;n<=e[o].toRow;n++){i[n]={};for(var a=e[o].fromCell;a<=e[o].toCell&&a<t.length;a++)i[n][t[a].id]=r}C.setCellCssStyles(s,i),clearTimeout(l),l=setTimeout(function(){b.clearCopySelection()},2e3)}function T(){C.removeCellCssStyles(s)}H.extend(this,{init:function(e){if((C=e).onKeyDown.subscribe(t),!(e=e.getSelectionModel()))throw new Error("Selection model is mandatory for this plugin. Please set a selection model on the grid before adding this plugin: grid.setSelectionModel(new Slick.CellSelectionModel())");e.onSelectedRangesChanged.subscribe(function(e,t){})},destroy:function(){C.onKeyDown.unsubscribe(t)},clearCopySelection:T,handleKeyDown:t,onCopyCells:new Slick.Event,onCopyCancelled:new Slick.Event,onPasteCells:new Slick.Event})}}}),(U=jQuery).extend(!0,window,{Slick:{CellSelectionModel:function(t){var l,i,o,u=[],n=this,a={selectActiveCell:!0,singleCellMode:!1};function d(e){for(var t=[],i=0;i<e.length;i++){var o=e[i];l.canCellBeSelected(o.fromRow,o.fromCell)&&l.canCellBeSelected(o.toRow,o.toCell)&&t.push(o)}return t}function c(e){u=d(e),n.onSelectedRangesChanged.notify(u)}function e(){return u}function s(e,t){e=l.getCellFromEvent(e);e&&l.canCellBeSelected(e.row,e.cell)?(u=[new Slick.Range(e.row,e.cell,e.row,e.cell)],n.onSelectedRangesChanged.notify(u)):u=[]}function r(e,t){if(l.getEditorLock().isActive())return e.stopPropagation(),!1}function p(e,t){c([t.range])}function h(e,t){o.selectActiveCell&&null!=t.row&&null!=t.cell&&c([new Slick.Range(t.row,t.cell)])}function g(e){var t,i,o,n,a,s,r=l.getActiveCell();!r||!e.shiftKey||e.ctrlKey||e.altKey||37!=e.which&&39!=e.which&&38!=e.which&&40!=e.which||((t=u).length||t.push(new Slick.Range(r.row,r.cell)),o=(i=!(i=t.pop()).contains(r.row,r.cell)?new Slick.Range(r.row,r.cell):i).toRow-i.fromRow,s=i.toCell-i.fromCell,a=r.row==i.fromRow?1:-1,n=r.cell==i.fromCell?1:-1,37==e.which?s-=n:39==e.which?s+=n:38==e.which?o-=a:40==e.which&&(o+=a),d([s=new Slick.Range(r.row,r.cell,r.row+a*o,r.cell+n*s)]).length?(t.push(s),a=0<a?s.toRow:s.fromRow,s=0<n?s.toCell:s.fromCell,l.scrollRowIntoView(a),l.scrollCellIntoView(a,s)):t.push(i),c(t),e.preventDefault(),e.stopPropagation())}U.extend(this,{getSelectedRanges:e,setSelectedRanges:c,init:function(e){o=U.extend(!0,{},a,t),(l=e).onActiveCellChanged.subscribe(h),o.singleCellMode?l.onClick.subscribe(s):(i=new Slick.CellRangeSelector({selectionCss:{border:"2px solid black"}}),l.onKeyDown.subscribe(g),l.registerPlugin(i),i.onCellRangeSelected.subscribe(p),i.onBeforeCellRangeSelected.subscribe(r))},destroy:function(){l.onActiveCellChanged.unsubscribe(h),o.singleCellMode?l.onClick.unsubscribe(s):(l.onKeyDown.unsubscribe(g),i.onCellRangeSelected.unsubscribe(p),i.onBeforeCellRangeSelected.unsubscribe(r),l.unregisterPlugin(i))},onSelectedRangesChanged:new Slick.Event})}}}),(W=jQuery).extend(!0,window,{Slick:{AutoTooltips:function(i){var o,t={enableForCells:!0,enableForHeaderCells:!1,maxToolTipLength:null};function n(e){var t,e=o.getCellFromEvent(e);e&&((e=W(o.getCellNode(e.row,e.cell))).innerWidth()<e[0].scrollWidth?(t=W.trim(e.text()),i.maxToolTipLength&&t.length>i.maxToolTipLength&&(t=t.substr(0,i.maxToolTipLength-3)+"...")):t="",e.attr("title",t))}function a(e,t){t=t.column,e=W(e.target).closest(".slick-header-column");void 0===t||t.toolTip||e.attr("title",e.innerWidth()<e[0].scrollWidth?t.name:"")}W.extend(this,{init:function(e){i=W.extend(!0,{},t,i),o=e,i.enableForCells&&o.onMouseEnter.subscribe(n),i.enableForHeaderCells&&o.onHeaderMouseEnter.subscribe(a)},destroy:function(){i.enableForCells&&o.onMouseEnter.unsubscribe(n),i.enableForHeaderCells&&o.onHeaderMouseEnter.unsubscribe(a)}})}}});var j={contains:function(e,t){return 0<=t.indexOf(e)},escapeRegexCharacters:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\+\?\.\\\^\$\|]/g,"\\$&")},isMatch:function(e,t){var i,o,n=!1,a=e.split(/ +and +| +/);for(_.includes(a,"or")&&(a=_.without(a,"or"),n=!0),i=0;i<a.length;i++)0!==a[i].indexOf("-")&&a[i].indexOf("*")<0&&(a[i]="*"+a[i]+"*");return o=n||_.every(a,function(e){return 0===e.indexOf("-")}),_[n?"some":"every"](a,function(e){return j.isSimpleMatch(e,t,o)})},isSimpleMatch:function(e,t,i){var o=!1;if(i||0!==e.indexOf("-")||(e=e.replace("-",""),o=!0),""===t){if("null"===e||"*null*"===e)return!o}else if("-null"===e)return!0;return t=0<=e.indexOf("**")?j.contains(e,t):new RegExp("^"+j.escapeRegexCharacters(e).replace(/\*/g,".*")+"$","m").test(t),o?!t:t}},Q={CURRENCY_SYMBOL_MAP:{GBP:"&pound;",EUR:"&euro;",USD:"$"},_convertKdbValueforComparison:function(e){var t=y.convertKDBToViewstateValue(e);return t="1216"===e.class?t.replace(/(.*T)(\d+)(.*)/,function(e,t,i,o){return t+(i=99<parseInt(i,10)?":"+i:i)+o}):t},_OPERATORS_FOR_CONVERTION:_.reduce(["contains","starts with","ends with","search"],function(e,t){return e[t]=!0,e},{}),_getConditionResult:function(e,t,i){var o,n,a=!1;if(Q._OPERATORS_FOR_CONVERTION[i]&&(o=(""+e).toLowerCase(),n=(""+t).toLowerCase()),""!==n)switch(i){case"contains":a=0<=o.indexOf(n);break;case"starts with":a=0===o.indexOf(n);break;case"ends with":a=-1!==o.indexOf(n,o.length-n.length);break;case"==":a=e==t;break;case"<":a=e<t;break;case">":a=t<e;break;case"<=":a=e<=t;break;case">=":a=t<=e;break;case"!=":a=e!=t;break;case"search":a=j.isMatch(n,o);break;default:console.log("GRID: highlight rule with unknown operator: ",i)}return a},getStyledCell:function(e,b,y,S,R){var t,M,k,I,T,D,F,x=document.createElement("div"),E=[],i=S.highlightingModule.getHighlightRuleChain(R);return b&&(D=b[S.SLICKGRID_ROW_UNIQUE_ID],D=S.atomizeTemporal(D),S.previousValuesMap&&(F=S.previousValuesMap[D]),_.each(i,function(e){var t,i=e.BorderColor,o=e.BackgroundColor,n=e.Color,a=e.Icon,s=e.IconColor,r=e.ConditionSource,l=e.ConditionOperator,u=e.ConditionValue,d=!1,c=_.includes(["Fill Left-to-Right","Fill Right-to-Left"],l),p="gradient"===e.RuleType,h=b[r="<this>"===r?R:r];if((t=(C=S.columnInfo.get(r))&&7===C.get("kdbType"))&&_.isString(h)&&(h=parseInt(h,10)),p){if(d=!0,o=s=n=i=null,_.isFinite(h)){var g=e.Palette||[],f=e.RuleMin,m=e.RuleMax,v=e.RuleLimitEnabled,C=!1,w=null;if(m<f&&(p=f,f=m,m=p,C=!0),!v||v&&f<=h&&h<=m)switch(w=1===(g=0===g.length?[{color:"#888888"}]:g).length?(v=m===f?1:(h-f)/(m-f),v=_.clamp(Math.round(9*v),0,9),Be.getColor(g[0].color,v=C?9-v:v)):(C&&(g=_.clone(g)).reverse(),Be.interpolateColor(g,f,m,h)),e.TargetElement){case"text":n=w;break;case"border":i=w;break;case"icon":s=w;break;default:o=w}}}else c?_.isNumber(h)&&(M=l,I=o,k=i,T=Math.max(0,Math.min(100,h))):"previous value"===u?F&&(c=F[r],t&&_.isString(c)&&(c=parseInt(c,10)),"=="!==l&&_.isEqual(h,c)&&S.diffValuesMap&&S.diffValuesMap[D]&&void 0!==S.diffValuesMap[D][r]&&(c=S.diffValuesMap[D][r],t&&_.isString(c)&&(c=parseInt(c,10))),h&&h.class&&(h=Q._convertKdbValueforComparison(h)),c&&c.class&&(c=Q._convertKdbValueforComparison(c)),d=Q._getConditionResult(h,c,l)):d=h&&h.class?Q._getConditionResult(Q._convertKdbValueforComparison(h),u,l):Q._getConditionResult(h,u,l);!y&&d&&(i&&(x.style.border="1px solid "+i),o&&(x.style.backgroundColor=o),n&&(x.style.color=n),a&&s&&(d=0===a.indexOf("mi-")?"mi":"fa",E.push('<i class="'+d+" "+a+'" style="color: '+s+'" ></i>')))}),M&&(I||k)&&((t=document.createElement("div")).className=M.replace(" ","_"),t.style.width=T+"%",I&&(t.style.backgroundColor=I),k&&(t.style.border="1px solid "+k),x.appendChild(t)),E.length&&(E.reverse(),(t=document.createElement("div")).className="cellIcons",t.innerHTML=E.join(""),x.appendChild(t))),x},getFormatter:function(h,g){var s,r,f=this,m=h.Field,c=!1,e=g.columnInfo.get(m);if(e&&(c=7===e.get("kdbType")),$.trim(h.Template))var v=o.compile(h.Template),t=function(i,o,e,n,t,a){var s,r,l,u,d,c,p=e;if(t){try{c=_.includes(["General","Percentage","Boolean"],h.Format)?t:(r=Q.getFormatter($.extend({},h,{Template:"",HighlightNegativeColor:""}),{SLICKGRID_ROW_UNIQUE_ID:g.SLICKGRID_ROW_UNIQUE_ID,highlightingModule:{changedObjectCacheDictionary:{},getHighlightRuleChain:_.noop},viewModel:new C.Model({HighlightRules:[]}),columnInfo:g.columnInfo,atomizeTemporal:g.atomizeTemporal}),l=_.extend({thisValue:t[m]},t),u=h.Template.match(/\{\{(.*?)\}\}/g).join(" "),(d=_.union(Object.keys(l).filter(function(e){return u.match(new RegExp(e))}),["thisValue"])).unshift(l),c=_.pick.apply(_,d),_.mapValues(c,function(e,t){return r(i,o,e,n,l,a).innerHTML})),c=_.extend({},t,{thisField:m,thisValue:c[m],thisRawValue:e},c,g.api.getTemplateViewStates(h.Template)),s=v(c)}catch(e){s=""}(t=f.getStyledCell(e,t,a,g,m)).innerHTML+=s,p=t}return p};else if(_.includes(["Number","Formatted Number","Smart Number","Currency","SmartCurrency"],h.Format))t=function(e,t,i,o,n,a){var s=i,r=!1,s=null==i||null==i?"":"Smart Number"===h.Format?y.smartFormatNumber(i,h.Precision,!0):"Formatted Number"===h.Format?y.formatNumber(i,h.Precision):y.toFixedNumber(i,h.Precision);return s=_.escape(s),s=f.hideTralingZeroes(s,h.HideTrailingZeroes),h.Currency&&"none"!==h.Currency&&""!==s&&(s=Q.CURRENCY_SYMBOL_MAP[h.Currency]+" "+s,r=!0),n&&(a=f.getStyledCell(i,n,a,g,m),h.HighlightNegativeColor&&_.isNumber(i)&&i<0&&(a.style.color=h.HighlightNegativeColor),r?a.innerHTML+=s:a.appendChild(document.createTextNode(s)),s=a),s};else if(_.includes(["Date","Time","DateTime"],h.Format))t=function(e,t,i,o,n,a){var s="Time"===h.Format,r="DateTime"===h.Format,l=y.convertKDBTemporalToMoment(i),l=_.isNull(i)||_.isUndefined(i)||_.isFunction(l.isValid)&&!l.isValid()?_.escape(i):s?l.formatNano(h.TimeFormat,{trim:!1,trimNano:!1}):r?l.formatNano(h.DateFormat+" "+h.TimeFormat,{trim:!1,trimNano:!1}):l.formatNano(h.DateFormat);return n&&((a=f.getStyledCell(i,n,a,g,m)).appendChild(document.createTextNode(l)),l=a),l};else if("Percentage"===h.Format)t=function(e,t,i,o,n,a){var s,r,l;if(c&&_.isString(i)&&(i=parseInt(i,10)),!_.isNumber(i)){var u=null==i?"":i;return n?((r=f.getStyledCell(u,n,a,g,m)).innerHTML=u,r):document.createTextNode(u)}l=i,i*=100,s="",d=Math.max(0,i);var d=Math.min(100,d),u=h.PercentageColorOverride;return u&&(s="background-color:"+u+";"),i=i.toFixed(h.Precision),i='<div class="percentageFormatter"><p style="'+s+"width:"+d+'%"></p><span>'+(i=f.hideTralingZeroes(i,h.HideTrailingZeroes))+"%</span></div>",n?((r=f.getStyledCell(l,n,a,g,m)).innerHTML+=i,r):i};else if("CustomFormatter"===h.Format)t=function(e,t,i,o,n,a){var s,i=n?(s=f.getStyledCell(i,n,a,g,m),null!=i&&(s.innerHTML+=h.CustomFormatter(e,t,i,o,n,a)),s):document.createTextNode(i);return i};else if(_.includes(["General","Boolean"],h.Format))t=function(e,t,i,o,n,a){if(n){a=f.getStyledCell(i,n,a,g,m);return null!=i&&a.appendChild(document.createTextNode(i.toString())),a}return document.createTextNode(i)};else if("Sparkline"===h.Format){try{s=JSON.parse(h.SparklineOptions)}catch(e){console.warn("Datagrid > SparklineOptions parsing error",e),s={}}r=_.compact(["sparklinesRoot",s.className]).join(" "),t=function(e,t,i,o,n,a){a=f.getStyledCell(i,n,a,g,m);return a.className=r,g.sparklinesManager.storeInitObjects(a,i,s),a}}return t},hideTralingZeroes:function(e,t){var i=e.toString();if(t&&0<=i.indexOf(".")){for(e="",(t=i[i.length-1]).match(/[kmbtpe]/i)&&(e=t,i=i.slice(0,-1));"0"===i[i.length-1];)i=i.slice(0,-1);"."===i[i.length-1]&&(i=i.slice(0,-1)),i+=e}return i},getSummaryRowHtml:function(m,e,v,C){var w="";return e&&e.length&&_.each(e,function(e){var t,i,o,n,a="",s="";function r(e){return _.isNumber(e)&&!_.isNaN(e)}function l(e,t){e=_.map(e,t),t=C.columnInfo.get(t);return e=t&&7===t.get("kdbType")?_.map(e,function(e){return _.isString(e)?parseInt(e,10):e}):e}if(!_.isEmpty(e)){if(n=e.Label,"WAVG"===e.Function){for(var u,d,c=l(m.rows,e.Column),p=l(m.rows,e.Column2),h=0,g=0,f=0;f<c.length;f++)u=c[f],d=p[f],r(u)&&r(d)&&(h+=u*d,g+=u);0!==g&&(a=h/g,(o=_.find(v,{field:e.Column2})).formatter&&(a=o.formatter(void 0,void 0,a)))}else if(t=l(m.rows,e.Column),(i=_.filter(t,function(e){return!_.isNull(e)&&!_.isUndefined(e)&&(_.isNumber(e)||_.has(e,"i"))})).length){if(_.has(i[0],"i"))switch(i.sort(function(e,t){return e.i===t.i?e.n-t.n:e.i-t.i}),e.Function){case"MIN":a=i[0];break;case"MAX":a=_.last(i)}else{switch(e.Function){case"MIN":a=_.min(i);break;case"MAX":a=_.max(i);break;case"AVG":case"SUM":a=_.reduce(i,function(e,t){return e+t},0)}"AVG"===e.Function&&(a/=i.length)}(o=_.find(v,{field:e.Column})).formatter&&(a=o.formatter(void 0,void 0,a))}n=n||e.Function+("WAVG"===e.Function?"":" "+e.Column),e.Color&&(s=" style='color:"+e.Color+"' "),w+="<span class='lblGroupSummary' "+s+"><i>"+n+":</i><b>"+a+"</b></span>"}}),w},isFormattersValueDifferentToRawValue:function(e){var t=!1;switch(e.Format){case"General":case"Boolean":t=!!e.Template;break;default:t=!0}return t}},Y=C.View.extend({initialize:function(e){this.app=e.app,this.kdbClass=e.kdbClass,this.$elActivator=e.$elActivator,this.dashboardType=y.Types.kdbToDashboard[this.kdbClass],this.$el.html(h.DateFilter({operators:Y.COMBO_2_OPERATOR_MAP})),this.$cmbOperator=this.$(".cmbOperator"),this.$dp1=this.$(".dp1"),this.$dp2=this.$(".dp2"),this.initEvents(),this.renderDialog(),this.expressionsToVisualize=Y._parseExpressions(e.filterValue),this.renderOperators(),this.renderDatepickers()},initEvents:function(){this.$cmbOperator.on("select2:select",this.onOperatorChanged.bind(this))},onApplyButtonClick:function(){var e,t,i=this.$cmbOperator.val(),o=this.dpSelection1.get("value"),n=Y.COMBO_2_OPERATOR_MAP[i]+o;_.includes(["b","o"],i)&&(t=this.dpSelection2.get("value"),dt1=Y.convertToKdbLikeObject(o,this.kdbClass),dt2=Y.convertToKdbLikeObject(t,this.kdbClass),0<Y._getComparisonResult(dt1,dt2)&&(e=o,o=t,t=e),n="b"===i?">="+o+" <="+t:"<"+o+" >"+t),this.trigger("filterApplied",n)},onClose:function(){this.$el.dialog("close")},onOperatorChanged:function(){var e=this.$cmbOperator.val();_.includes(["b","o"],e)?this.$dp2.show():this.$dp2.hide()},remove:function(){this.$cmbOperator.select2("destroy"),this.dpApp1&&this.dpApp1.remove(),this.dpApp2&&this.dpApp2.remove(),C.View.prototype.remove.apply(this,arguments),this.trigger("removed",this)},renderDialog:function(){var e=this;this.$dialog=this.$el.dialog(_.extend({dialogClass:"Datagrid date-filter-dialog",title:t("Configure Filter"),resizable:!1,width:"350",height:"170",modal:!1,position:{of:this.$elActivator,my:"left top",at:"left top"},autoOpen:!0,draggable:!0,buttons:[{text:t("Apply"),click:$.proxy(e.onApplyButtonClick,e),icons:{primary:"fa fa-check"}},{text:t("Close"),click:$.proxy(e.onClose,e),icons:{primary:"fa fa-times"}}],resizeStop:function(){},close:function(){e.$dialog.dialog("destroy"),e.remove()}},this.options))},renderOperators:function(){var e=this.expressionsToVisualize;this.$cmbOperator.select2({minimumResultsForSearch:10,theme:"dashboards"}),e.length&&(e=1===e.length?Y.OPERATOR_2_COMBO_MAP[e[0].operator]:0===e[0].operator.indexOf(">")?"b":"o",this.$cmbOperator.val(e).trigger("change")),this.onOperatorChanged()},renderDatepicker:function(t,e,i){var o,n=this,a=u.getComponentDefinition({componentId:15,settingsModel:new C.DeepModel});i=i||c.Helpers.convertRollingToDate("NOW",this.dashboardType),o=new c.DocumentViewModel({_default:i,_viewType:!0,_type:this.dashboardType}),(a=new C.DeepModel(a.appArgs.json)).set("Basics.Data",{}),a.set("Basics.Label",""),a.set("Basics.labelWidth",0),a.set("Basics.width",200),a.set("Basics.SelectedDate",o),this.app.api.loadApp("BasicComponents",e,a,{},function(e){n["dpApp"+t]=e,n["dpSelection"+t]=o})},renderDatepickers:function(){var e,t,i=this.expressionsToVisualize;i.length&&(e=i[0].date,1<i.length&&(t=i[1].date)),this.renderDatepicker(1,this.$dp1,e),this.renderDatepicker(2,this.$dp2,t)}},{COMBO_2_OPERATOR_MAP:{lt:"<",lte:"<=",gt:">",gte:">=",e:"==",ne:"!=",b:"between",o:"outside of"},generateFilterFunction:function(e,t){var i,o,n,e=Y._parseExpressions(e),a=Y.convertToKdbLikeObject(e[0].date,t),e=1<e.length?(o=Y.convertToKdbLikeObject(e[1].date,t),0==e[0].operator.indexOf(">")?function(e){return null!==e&&(0<=Y._getComparisonResult(e,a)&&Y._getComparisonResult(e,o)<=0)}:function(e){return null===e||(Y._getComparisonResult(e,a)<0||0<Y._getComparisonResult(e,o))}):(i=Y._getOperatorFn(e[0].operator),n="!="===e[0].operator,function(e){if(null===e)return n;e=Y._getComparisonResult(e,a);return i(e)});return e},_convertToKdb_FORMAT_MAP:{1214:"YYYY-MM-DD"},convertToKdbLikeObject:function(e,t){return(_.includes(["1214"],t)?y.convertUserInputToMoment(e,Y._convertToKdb_FORMAT_MAP[t]):y.convertValueToMoment(e,t)).toKdbObject()},_getComparisonResult:function(e,t){var i=e.i-t.i;return i=0===i&&void 0!==e.n&&void 0!==t.n?e.n-t.n:i},_getOperatorFn:function(e){switch(e){case"<":return function(e){return e<0};case"<=":return function(e){return e<=0};case">":return function(e){return 0<e};case">=":return function(e){return 0<=e};case"==":return function(e){return 0===e};case"!=":return function(e){return 0!==e}}},_parseExpressions:function(e){for(var t,i=/(==|!=|<=|>=|>|<)(\S+)/g,o=[];t=i.exec(e);)o.push({operator:t[1],date:t[2]});return o}});Y.OPERATOR_2_COMBO_MAP=_.invert(Y.COMBO_2_OPERATOR_MAP);var X,J=(X={is_null:"is_blank",is_not_null:"is_not_blank",">":"greater","<":"less","==":"equal","!=":"not_equal",">=":"greater_or_equal","<=":"less_or_equal"},{generateColumnGroupRule:function(e,t,i,o){var n=ae;switch(i){case 0:n=ie;break;case 1:n=ee;break;case 2:n=te;break;case 10:case 11:n=ie;break;case 4:case 5:case 6:case 7:case 8:case 9:n=oe;break;case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:n=ne}return n(e,t,i,o)}});function Z(e,t){return e.length?{active:!0,operator:t,children:e}:void 0}function ee(t,e,i){var o=[],e=e.split(/ +or +| +/);return e=_.without(e,""),_.each(e,function(e){e="true"===e||"false"!==e&&void 0;void 0!==e&&o.push({active:!0,propertyName:t,propertyType:i,operator:"equal",value:e})}),Z(o,"OR")}function te(o,e,n){var a=[],e=e.split(/ +or +| +/);return e=_.without(e,""),_.each(e,function(e){var t=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)?e:void 0,i="equal";if(void 0===t){if(/[^a-f\d-]/gi.test(e))return;t="*"+e+"*",i="like"}void 0!==t&&a.push({active:!0,propertyName:o,propertyType:n,operator:i,value:t})}),Z(a,"OR")}function ie(a,e,s,t){var i,r=[],o="AND",l=!1;return t?(o="OR",l=!0,i=e.split("|")):(i=e.split(/ +and +| +/),_.includes(i,"or")&&(i=_.without(i,"or"),o="OR")),i=_.without(i,""),_.each(i,function(e){var t,i,o="like",n=!1;0!==(e=e.replace(/\[/g,"")).length&&(0===e.indexOf("-")&&1!==e.length&&(o="not_like",e=e.substr(1),n=!0),e.toLowerCase()===de.NULL_EMPTY_VALUE.toLowerCase()?o=n?"is_not_blank":"is_blank":l?o="equal":e=e.indexOf("*")<0?"*"+e+"*":(n=((t=e).match(/\*/g)||[]).length,i=!1,toReturn=t,(2<n||2===n&&(2===t.length||"*"!==_.first(t)||"*"!==_.last(t)))&&(toReturn=t.replace(/\*/g,function(){return i?"":(i=!0,"*")})),toReturn),10===s&&(e=e.replace(/\*/g,""),o="equal"),r.push({active:!0,propertyName:a,propertyType:s,operator:o,value:e}))}),Z(r,o)}function oe(t,e,i){e=de._getNumberFilterParts(e);return Z(_.map(e.expressions,function(e){return{active:!0,propertyName:t,propertyType:i,operator:X[e.operator],value:e.number}}),e.isAndCondition?"AND":"OR")}function ne(t,e,i){e=Y._parseExpressions(e);return Z(_.map(e,function(e){return{active:!0,propertyName:t,propertyType:i,operator:X[e.operator],value:e.date}}),1<e.length&&0==e[1].operator.indexOf(">")?"OR":"AND")}function ae(){}var se,re,le,ue,de=function(e){this.app=e,this.api=e.api,this.cachedDropdownItems=null,this.FILTER_SETTINGS_KEY="Grid.Basics.Filtering",this.BASICS_FILTERING="Basics.Filtering",this.BASICS_IS_FILTER_VISIBLE="Basics.IsFilterVisible",this.BASICS_KDB_FILTER_STRING="Basics.KdbFilterString",this.BASICS_FILTER_ON_ENTER_HIT="Basics.FilterOnEnterHit",this.CUSTOM_FILTERS_KEY="CustomFilters",this.initialize()};function ce(e){var t=parseFloat(e);return t*=re[e[e.length-1]]||1}function pe(e){var t,i,o,n,a,s=[],r=!1,l=!1,u=!1;for(e=e.toLowerCase().replace(/ /g,"");t=se.exec(e);)i=t[1],i=le[i]||i||"==",0<=t[2].indexOf("null")?"=="===i&&"null"===t[2]?l=!0:u=!0:s.push({operator:i,number:ce(t[2])});return s=_.sortBy(s,"number"),1<(a=_.map(s,"operator")).length&&(r=_.some(a,function(e){return"!="===e})||(o=a,n=!1,a=_.findIndex(o,function(e){return 0===e.indexOf(">")}),n=0<=a?a<_.findLastIndex(o,function(e){return 0===e.indexOf("<")}):n)),l&&s.push({operator:"is_null",number:null}),u&&s.push({operator:"is_not_null",number:null}),{expressions:s,isAndCondition:r}}function he(i){var t,o;this.init=function(){(t=ue("<INPUT type=text class='editor-text' />")).bind("keydown.nav",function(e){e.keyCode!==ue.ui.keyCode.LEFT&&e.keyCode!==ue.ui.keyCode.RIGHT||e.stopImmediatePropagation()}),t.appendTo(i.container),t.focus().select()},this.destroy=function(){t.remove()},this.focus=function(){t.focus()},this.loadValue=function(e){o=e[i.column.field],t.val(o),t[0].defaultValue=o,t.select()},this.serializeValue=function(){return 0<t.val().length?parseFloat(t.val(),10)||0:null},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){var e=t.val().toLowerCase(),e=de.convertSmartNumberToNumber(e);return isNaN(e)?{valid:!1,msg:"Please enter a valid float"}:(t.val(e),{valid:!0,msg:null})},this.init()}_.extend(de.prototype,C.Events,{initialize:function(){this.$txtGlobalFilter=this.app.$(".txtGlobalFilter"),this.$lnkResetFilters=this.app.$(".lnkResetFilters").hide(),this.$lnkToggleFilters=this.app.$(".lnkToggleFilters"),this.onHeaderRowCellRenderedScoped=_.bind(this.onHeaderRowCellRendered,this),this.debounced_searchboxChanged=_.debounce(this.searchboxChanged,500),this.debounced_refreshDataView=_.debounce(this.refreshDataView,500),this.listenTo(this.app.viewModel,"change:"+this.BASICS_IS_FILTER_VISIBLE,this.onChange_isFilterVisible),this.listenTo(this.app.viewModel,"change:"+this.BASICS_FILTERING,this.onChange_Filtering),this.listenTo(this.app.viewModel,"change:CustomFilters",this.onChange_CustomFilters),this.$txtGlobalFilter.on("change keyup",_.bind(this.debounced_searchboxChanged,this)),this.$lnkResetFilters.click(_.bind(this.resetFilters,this)),this.listenToOnce(this.app.viewModel,"change:"+this.BASICS_FILTERING,this.loadFilterSettings),this.listenTo(this.app.viewModel,"change:"+this.BASICS_KDB_FILTER_STRING,this.onChange_KdbFilterString),this.listenTo(this.app.viewModel,"change:"+this.BASICS_FILTER_ON_ENTER_HIT,this.onChange_FilterOnEnterHit),this.$lnkToggleFilters.on(y.clickEvent(),this.onClick_lnkToggleFilters.bind(this)),this.showingFilters=!0,this.isProcessedServerSide=!1,this.filterOnEnterHit=!1,this.wasEnterHit=!1,this.dateFilterViewInstances=[],this.listenTo(_.get(this.app,"dashboardAppModel.attributes.router"),"route",this.removeDateFilters)},applyFilterSettingsIfReady:function(){var e,i=this.filterSettingsToApply,t=!1,o=this;i&&(i.type===this.getValueOfViewState(this.app.viewModel.get(this.BASICS_FILTERING))?"Quick Search"===i.type?(this.$txtGlobalFilter.val(i.value),this.$txtGlobalFilter.trigger("change"),this.filterSettingsToApply=null):_.includes(["Column Filters","Advanced Column Filters"],i.type)&&this.app.grid&&((e=_.keys(i.value||{})).length&&_.every(e,function(e){return o.app.grid.getHeaderRowColumn(e)})?_.each(e,function(e){var t=$(o.app.grid.getHeaderRowColumn(e)).find("input");t.val(i.value[e]),t.trigger("change")}):t=!0,this.filterSettingsToApply=null):t=!0,t&&this.app.api.saveSetting(this.FILTER_SETTINGS_KEY,null))},checkResetFiltersState:function(){var e=_.some(this.columnFilters);this.app.grid&&this.app.grid.resetActiveCell(),this.$lnkResetFilters[e?"show":"hide"]()},encodeInputFromArray:function(e){return 0===e.length?"":1===e.length?e[0]:e.length+" selected"},encodeInputValue:function(e){return e&&this.encodeInputFromArray(e.split("|"))},generateKdbFilterString:function(e){var t="";if("Advanced Column Filters"===e){var i,o,n,a,s=[],r=this.app.grid;for(i in this.columnFilters)void 0!==i&&""!==this.columnFilters[i]&&(columnIndex=r.getColumnIndex(i),colCfg=r.getColumns()[columnIndex],colCfg&&(o=colCfg.field,a=!!_.find(this.app.viewModel.get("CustomFilters"),{Name:o,Type:"Server Selection"}),n=this.app.columnInfo.get(o).get("kdbType"),columnGroupRule=J.generateColumnGroupRule(o,this.columnFilters[i],n,a),columnGroupRule&&s.push(columnGroupRule)));e=1===s.length?s[0]:{active:!0,children:s,operator:"AND"},console.log("server side filter ipc message:",JSON.stringify(e)),t=l.generateIpcHexMessage(e)}return t},getDropdownItems:function(e,i){var t=this.app.grid.getColumnIndex(e),o=this.app.grid.getColumns()[t],e=o._dashboardConfig,n=!1,a=_.includes(["Number","Formatted Number","Smart Number","Percentage"],e.Format),s={},r=[],l={},t=this.cachedDropdownItems||this.app.dataView.getItems(),u=Q.isFormattersValueDifferentToRawValue(e),e=this.app.columnInfo.get(i),e=e&&e.get("kdbType")||11;return t.forEach(function(e){var t=e[i],e=a?null===t?de.NULL_EMPTY_VALUE:t:(null===t?"":""+t)||de.NULL_EMPTY_VALUE;void 0!==t&&(e===de.NULL_EMPTY_VALUE&&(n=!0),void 0===l[e]&&(l[e]=t,e!==de.NULL_EMPTY_VALUE&&r.push(e)))}),e=r.sort(y.isKDBTemporal({class:"12"+_.padStart(e,2,"0")})?void 0:y.getComparator(e,_.identity)),n&&e.unshift(de.NULL_EMPTY_VALUE),e=_.map(e,function(e){var t;return u&&(t=l[e],s[i]=t,t=$(o.formatter(null,null,t,o,s)).text()),{Value:a?""+e:e,Text:t||e}})},getValueOfViewState:function(e){return e instanceof C.Model?e.get("value"):e},hideActiveDropdownPopup:function(){this.$selectionInputs&&this.$selectionInputs.each(function(){$(this).siblings("div").css("position","relative")})},loadFilterSettings:function(){this.filterSettingsToApply=this.app.api.loadSetting(this.FILTER_SETTINGS_KEY)},modifyGridConfig:function(e){(this.showColumnFilters||this.showAdvancedColumnFilters)&&(e.showHeaderRow=!0,e.isHeaderRowVisible=this.isFilterVisible,e.explicitInitialization=!0)},onChange_CustomFilters:function(){var e,i=this;this.app.skipGridGeneration||(e=this.app.viewModel.get(this.CUSTOM_FILTERS_KEY),_.each(e,function(e,t){t=i.CUSTOM_FILTERS_KEY+"."+t+".Data";_.isEqual(e.Data,i.app.model)&&(c.ErrorDialog.ShowError("You must select a data source that is different from the one being used by the data grid."),e.Data=i.app.viewModel.previous(t),i.api.setProperty(t,i.app.viewModel.previous(t)))}),this.resetFilters(),this.app.generateDataGridFromReceivedData())},onChange_FilterOnEnterHit:function(){this.filterOnEnterHit=this.app.api.getProperty(this.BASICS_FILTER_ON_ENTER_HIT)},onChange_Filtering:function(e,t){this.filteringMode=this.getValueOfViewState(t),this.showColumnFilters="Column Filters"===this.filteringMode,this.showAdvancedColumnFilters="Advanced Column Filters"===this.filteringMode,this.showQuickSearch="Quick Search"===this.filteringMode,this.showColumnFilters&&this.checkResetFiltersState(),this.showingFilters&&(this.showColumnFilters||this.showAdvancedColumnFilters||this.showQuickSearch)?this.$lnkToggleFilters.show():this.$lnkToggleFilters.hide(),this.app.sortingModule.storeSortingSpec(),this.app.generateDataGridFromReceivedData()},onChange_isFilterVisible:function(){var e=this.app.viewModel.get(this.BASICS_FILTERING);switch(this.isFilterVisible=this.app.viewModel.get(this.BASICS_IS_FILTER_VISIBLE),this.$lnkToggleFilters.find("span").text((this.isFilterVisible?"Hide":"Show")+" Filters"),e){case"Column Filters":case"Advanced Column Filters":if(this.skipGridGeneration||!this.app.grid)return;this.app.grid.getOptions().isHeaderRowVisible=this.isFilterVisible,this.app.$(".slick-headerrow")[this.isFilterVisible?"show":"hide"](),this.app.grid.reset_prevScrollLeft(),this.app.grid.resizeCanvas()}},onChange_KdbFilterString:function(){var e,t=!1;this.app.api.getPropertyMeta&&(t=!(!(e=this.app.api.getPropertyMeta(this.BASICS_KDB_FILTER_STRING))||"viewstate"!==e.type)),this.isProcessedServerSide=t},onClick_lnkToggleFilters:function(){var e,t=!this.app.viewModel.get(this.BASICS_IS_FILTER_VISIBLE);this.app.api.getPropertyMeta&&!(!(e=this.app.api.getPropertyMeta(this.BASICS_IS_FILTER_VISIBLE))||"viewstate"!==e.type)?this.app.api.setProperty(this.BASICS_IS_FILTER_VISIBLE,t):this.app.viewModel.set(this.BASICS_IS_FILTER_VISIBLE,t)},onHeaderRowCellRendered:function(e,t){var i,o,n,a=$(t.node),s=this.app.viewModel.get("CustomFilters");if(a.empty(),o=t.column.field,!(n=_.find(s,function(e){return x.isFieldMatched(e.Name,o)}))||"Disabled"!==n.Type){if(s=this.encodeInputValue(this.columnFilters[t.column.id]),i=$("<input type='text'></input>").data("columnId",t.column.id).data("field",o).val(s).appendTo(a),n)switch(this.customFilter$ElementsMap[t.column.id]=a,n.Type){case"DateTime":i.addClass("customFilterDateTime").prop("readonly",!0);break;case"Number":i.addClass("customFilterNumber");break;case"Selection":case"Server Selection":i.addClass("customFilterSelection"),this.$selectionInputs=this.$selectionInputs.add(i)}s&&i.after('<i class="fa fa-times" />')}},reapplyColumnFilters:function(){_.some(this.columnFilters)&&(this.app.dataView.setFilter(this.dataViewFilterFn),this.app.grid.invalidate())},refreshDataView:function(){if(this.filterOnEnterHit){if(!this.wasEnterHit)return;this.wasEnterHit=!1}this.app.viewModel.isLazyDataLoadingOn()&&this.app.model&&this.app.model.get("_lazyLoading")&&this.app.grid&&this.app.grid.scrollRowToTop(0),this.saveFilterSettings(),this.isProcessedServerSide&&this.showAdvancedColumnFilters?this.app.api.setProperty(this.BASICS_KDB_FILTER_STRING,this.generateKdbFilterString(this.filteringMode)):(this.app.RAW_MODE&&this.app.rawModeModule.populateFilterFields(),this.app.refreshDataView())},refreshDataviewIfFilterNotEmpty:function(){this.lastSearchValue&&this.refreshDataView()},registerColumnFilters:function(){var s=this;this.unsubscribeFromEvents(),this.$headerRow=$(s.app.grid.getHeaderRow()),this.customFilter$ElementsMap={},this.customFilterFunctions_Number=this.customFilterFunctions_Number||{},this.customFilterFunctions_Selection=this.customFilterFunctions_Selection||{},this.customFilterFunctions_DateTime=this.customFilterFunctions_DateTime||{},s.columnFilters||(s.columnFilters={}),this.$headerRow.on("blur",":input",function(){s.filterOnEnterHit&&(s.wasEnterHit=!0,$(this).trigger("change"))}),this.$headerRow.on("change keyup",":input",function(e){var t,i,o=$(this),n=o.val();!s.filterOnEnterHit||13!==e.which&&9!==e.which||(s.wasEnterHit=!0),null!=(i=o.data("columnId"))&&(n!==s.encodeInputValue(s.columnFilters[i])&&(s.columnFilters[i]=n,o.hasClass("customFilterDateTime")?n&&(t=o.data("field"),i="12"+s.app.columnInfo.get(t).get("kdbType"),s.customFilterFunctions_DateTime[t]=Y.generateFilterFunction(n,i)):o.hasClass("customFilterNumber")?(t=o.data("field"),s.customFilterFunctions_Number[t]=de._generateNumberFilterFunction(n)):o.hasClass("customFilterSelection")&&(n&&"change"===e.type?(t=o.data("field"),o.val(s.encodeInputValue(n)),s.customFilterFunctions_Selection[t]=de._generateSelectionFilterFunction(n.split("|"))):n&&"keyup"===e.type&&(t=o.data("field"),o.val(n),s.customFilterFunctions_Selection[t]=de._generateSelectionFilterFunction(n.split("|"))))),s.refreshClearButton(o,n),s.checkResetFiltersState(),s.debounced_refreshDataView())}),this.$headerRow.on("click",".fa-times",function(e){var t=$(this),i=t.prev();t.remove(),s.filterOnEnterHit&&(s.wasEnterHit=!0),i.val("").trigger("change"),s.removeCustomFilterDropdowns()}),this.$headerRow.on("select2:close",function(e){s.hideActiveDropdownPopup()}),this.$headerRow.on("click",".customFilterSelection",function(e){var i,e=$(e.currentTarget),o=e.data("columnId"),n=e.data("field"),a=s.customFilter$ElementsMap[o];return s.removeCustomFilterDropdowns(),(i=_.find(s.app.viewModel.get("CustomFilters"),function(e){return"Server Selection"===e.Type&&x.isFieldMatched(e.Name,n)}))&&i.Data?s.api.subscribe(i.Data,function(e,t){s.cachedDropdownItems=t.collection.models.map(function(e){return e.attributes}),a.serverSelectionDataSource||s.renderDropdown(a,o,n),s.cachedDropdownItems=null,a.serverSelectionDataSource?s.removeCustomFilterDropdowns():a.serverSelectionDataSource=i.Data}):(s.cachedDropdownItems=null,s.app.RAW_MODE&&s.app.rawModeModule.populateFilterFields([n]),s.renderDropdown(a,o,n)),!1}),this.$headerRow.on("click",".customFilterDateTime",function(e){var t=$(e.currentTarget),i=t.data("columnId"),e=t.data("field");s.customFilter$ElementsMap[i];s.showDateFilter(t,i,e)}),this.app.grid.onHeaderRowCellRendered.subscribe(this.onHeaderRowCellRenderedScoped),this.$selectionInputs=$()},registerDataViewFilter:function(){var r=this;r.columnId2field={},r.columnId2formatter={},_.each(this.app.grid.getColumns(),function(i){var e=i.id,t=i._dashboardConfig;t&&(r.columnId2field[e]=i.field,r.columnId2formatter[e]=t.Template||!_.includes(["Boolean","General"],t.Format)?function(e,t){return $(i.formatter(null,null,e,i,t)).text()}:function(e){return(null==e?"":e).toString()})}),r.dataViewFilterFn=r.dataViewFilterFn||function(i,e){var o,t,n,a,s;if(r.isProcessedServerSide)return!0;if(_.isFunction(r.app.dataViewFilter))return r.app.dataViewFilter.apply(r,[i,e]);if(r.showAdvancedColumnFilters||r.showColumnFilters){for(t in s=r.showAdvancedColumnFilters?j.isMatch:j.contains,r.columnFilters)if(void 0!==t&&""!==r.columnFilters[t]){if(a=r.columnId2field[t],n=i[a],r.app.RAW_MODE&&void 0===n)return!0;if(r.customFilterFunctions_DateTime[a]){if(!r.customFilterFunctions_DateTime[a](n))return!1}else if(r.customFilterFunctions_Number[a]){if(!r.customFilterFunctions_Number[a](n))return!1}else if(r.customFilterFunctions_Selection[a]){if(!r.customFilterFunctions_Selection[a](n))return!1}else if(n=(a=r.columnId2formatter[t])?a(n,i).toLowerCase():"",!s(r.columnFilters[t].toLowerCase(),n))return!1}return!0}return!r.showQuickSearch||(""===(o=(e._globalSearchString||"").toLowerCase())||_.some(r.app.grid.getColumns(),function(e){var t=i[e.field];return null!=t&&0<=$(e.formatter(null,null,i[e.field],e,i)).text().toLowerCase().indexOf(o)}))},r.app.dataView.setFilterArgs({}),r.app.dataView.setFilter(r.dataViewFilterFn),r.applyFilterSettingsIfReady(),r.app.RAW_MODE&&r.app.rawModeModule.populateFilterFields()},remove:function(){this.removeDateFilters(),this.unsubscribeFromEvents(),this.$txtGlobalFilter.off(),this.$lnkResetFilters.off(),this.stopListening()},removeCustomFilterDropdowns:function(){_.each(this.instantiatedCustomFilterDropdowns,function(e){e.remove()}),this.instantiatedCustomFilterDropdowns=[],_.each(this.customFilterSelectionModels,function(e){e.destroy({wait:!1})}),this.customFilterSelectionModels=[],_.forOwn(this.customFilter$ElementsMap,_.bind(function(e){this.unsubscribeFromFilterSource(e)},this)),this.dropdownId&&($("#"+this.dropdownId).closest(".select2-container").remove(),this.dropdownId=null)},removeDateFilters:function(){_.eachRight(this.dateFilterViewInstances,function(e){e.onClose()})},renderDropdown:function(n,a,s){for(var t,r=this,e=u.getComponentDefinition({componentId:16,settingsModel:new C.DeepModel}),i=new C.DeepModel(e.appArgs.json),o=(r.columnFilters[a]||"").split("|"),l=0;l<o.length;l++)if(""===o[l]){o.splice(l,1);break}e=new c.DocumentViewModel({_default:o,_viewType:!0,_type:"list"}),this.customFilterSelectionModels.push(e),this.listenTo(e,"change:value",function(e,t){var i=r.encodeInputFromArray(t),o=n.find("input");o.val(i),r.columnFilters[a]=0===t.length?"":t.join("|"),r.checkResetFiltersState(),r.debounced_refreshDataView(),this.customFilterFunctions_Selection[s]=de._generateSelectionFilterFunction(t),r.refreshClearButton(o,t)}),i.set({"Basics.AcceptEmptyValues":!0,"Basics.ShowSearch":!0,"Basics.MultiSelect":!0,"Basics.SelectedValue":e,"Basics.Items":this.getDropdownItems(a,s),"Basics.FieldSummaryThreshold":0}),(t=$("<div>")).appendTo(n),this.app.api.loadApp("BasicComponents",t,i,{onReadyCallback:function(e){t.find(".select2-selection").click(),r.dropdownId=e}},function(e){r.instantiatedCustomFilterDropdowns.push(e)})},resetColumnFiltersMap:function(){this.columnFilters={}},resetCustomFilters:function(){this.customFilterFunctions_Number={},this.customFilterFunctions_Selection={},this.customFilterFunctions_DateTime={}},resetFilters:function(){var e=this,t=$(e.app.grid.getHeaderRow());t.find("input").val(""),t.find(".slick-headerrow-column>i").remove(),_.each(this.customFilterSelectionModels,function(e){e.set("value",[])}),e.resetColumnFiltersMap(),e.resetCustomFilters(),e.checkResetFiltersState(),e.filterOnEnterHit&&(e.wasEnterHit=!0),e.refreshDataView()},resetGlobalFilter:function(){this.lastSearchValue="",this.searchboxChanged(this.filterOnEnterHit?{which:13}:null)},saveFilterSettings:function(){var e,t=this.getValueOfViewState(this.app.viewModel.get(this.BASICS_FILTERING));switch(t){case"Column Filters":case"Advanced Column Filters":e=$.extend(!0,{},this.columnFilters);break;case"Quick Search":e=this.lastSearchValue;break;default:e=null}this.app.api.saveSetting(this.FILTER_SETTINGS_KEY,{version:1,type:t,value:e})},searchboxChanged:function(e){if(this.filterOnEnterHit&&e){if(13!==e.which&&9!==e.which)return;this.wasEnterHit=!0}this.app.dataView&&(e=$.trim(this.$txtGlobalFilter.val()),this.lastSearchValue!==e&&(this.lastSearchValue=e,this.$txtGlobalFilter.addClass("busy"),this.app.dataView.setFilterArgs({_globalSearchString:e}),this.refreshDataView(),this.$txtGlobalFilter.removeClass("busy")))},setupKdbFilterIfServerside:function(){this.isProcessedServerSide&&this.showAdvancedColumnFilters&&this.filterSettingsToApply&&this.app.setProperty(this.BASICS_KDB_FILTER_STRING,this.generateKdbFilterString(this.filteringMode))},showDateFilter:function(i,e,t){var o=this,t="12"+this.app.columnInfo.get(t).get("kdbType");this.removeDateFilters(),t=new Y({filterValue:i.val(),app:this.app,$elActivator:i,kdbClass:t}),this.dateFilterViewInstances.push(t),this.listenTo(t,"removed",function(e){_.pull(this.dateFilterViewInstances,e)}),this.listenTo(t,"filterApplied",function(e,t){o.filterOnEnterHit&&(o.wasEnterHit=!0),i.val(e).trigger("change")})},unsubscribeFromEvents:function(){this.removeCustomFilterDropdowns(),this.app.grid&&this.onHeaderRowCellRenderedScoped&&this.app.grid.onHeaderRowCellRendered.unsubscribe(this.onHeaderRowCellRenderedScoped),this.$headerRow&&this.$headerRow.off()},unsubscribeFromFilterSource:function(e){e.serverSelectionDataSource&&(this.api.unsubscribe(e.serverSelectionDataSource),e.serverSelectionDataSource=null)},refreshClearButton:function(e,t){0<t.length?0===e.next("i").length&&e.after('<i class="fa fa-times" style="z-index: 1"/>'):e.next("i").remove()}}),_.extend(de,(se=/(==|=>|=<|!=|<>|<=|>=|=|>|<|)((-?\d+(\.\d+)?[kmbtpe]?)|(-?null))/g,re={e:1e18,p:1e15,t:1e12,b:1e9,m:1e6,k:1e3},le={"=":"==","<>":"!=","=>":">=","=<":"<="},{NULL_EMPTY_VALUE:"NULL",convertSmartNumberToNumber:ce,_getNumberFilterParts:pe,_generateNumberFilterFunction:function(e){var e=(t=pe(e)).expressions,t=t.isAndCondition,i=_.map(e,function(t){switch(t.operator){case"is_null":return function(e){return null===e};case"is_not_null":return function(e){return null!==e};case"==":return function(e){return null!==e&&e==t.number};case"<":return function(e){return null!==e&&e<t.number};case">":return function(e){return null!==e&&e>t.number};case"<=":return function(e){return null!==e&&e<=t.number};case">=":return function(e){return null!==e&&e>=t.number};case"!=":return function(e){return null!==e&&e!=t.number}}});return 0===i.length?function(){return!0}:t?function(t){return!_.some(i,function(e){return!e(t)})}:function(t){return _.some(i,function(e){return e(t)})}},_generateSelectionFilterFunction:function(t){t=t.slice();for(var e=0;e<t.length;e++)if(t[e]===de.NULL_EMPTY_VALUE){t[e]="";break}return 0===t.length?function(){return!0}:function(e){return e=null===e?"":""+e,_.includes(t,e)}}})),(ue=jQuery).extend(!0,window,{Slick:{Editors:{Text:function(i){var t,o;this.init=function(){t=ue("<INPUT type=text class='editor-text' />").appendTo(i.container).bind("keydown.nav",function(e){e.keyCode!==ue.ui.keyCode.LEFT&&e.keyCode!==ue.ui.keyCode.RIGHT||e.stopImmediatePropagation()}).focus().select()},this.destroy=function(){t.remove()},this.focus=function(){t.focus()},this.getValue=function(){return t.val()},this.setValue=function(e){t.val(e)},this.loadValue=function(e){o=e[i.column.field]||"",t.val(o),t[0].defaultValue=o,t.select()},this.serializeValue=function(){return t.val()},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){if(i.column.validator){var e=i.column.validator(t.val());if(!e.valid)return e}return{valid:!0,msg:null}},this.init()},Integer:function(i){var t,o;this.init=function(){(t=ue("<INPUT type=text class='editor-text' />")).bind("keydown.nav",function(e){e.keyCode!==ue.ui.keyCode.LEFT&&e.keyCode!==ue.ui.keyCode.RIGHT||e.stopImmediatePropagation()}),t.appendTo(i.container),t.focus().select()},this.destroy=function(){t.remove()},this.focus=function(){t.focus()},this.loadValue=function(e){o=e[i.column.field],t.val(o),t[0].defaultValue=o,t.select()},this.serializeValue=function(){return 0<t.val().length?parseInt(t.val(),10)||0:null},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){return isNaN(t.val())?{valid:!1,msg:"Please enter a valid integer"}:{valid:!0,msg:null}},this.init()},Number:he,Float:he,Date:function(i){var t,o,n=!1;this.init=function(){(t=ue("<INPUT type=text class='editor-text' />")).appendTo(i.container),t.focus().select(),t.datepicker({showOn:"button",buttonText:"",buttonImageOnly:!0,dateFormat:"yy.mm.dd",beforeShow:function(){n=!0},onClose:function(){n=!1}}),t.width(t.width()-18)},this.destroy=function(){ue.datepicker.dpDiv.stop(!0,!0),t.datepicker("hide"),t.datepicker("destroy"),t.remove()},this.show=function(){n&&ue.datepicker.dpDiv.stop(!0,!0).show()},this.hide=function(){n&&ue.datepicker.dpDiv.stop(!0,!0).hide()},this.position=function(e){n&&ue.datepicker.dpDiv.css("top",e.top+30).css("left",e.left)},this.focus=function(){t.focus()},this.loadValue=function(e){null!==(o=e[i.column.field])&&(t.val(o),t[0].defaultValue=o,t.select())},this.serializeValue=function(){return t.val()},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){return{valid:!0,msg:null}},this.init()},DateTime:function(i){var t,o,n=!1;this.init=function(){(t=ue("<INPUT type=text class='editor-text' />")).appendTo(i.container),t.focus().select(),t.datetimepicker({showOn:"button",buttonImageOnly:!0,dateFormat:"yy-mm-dd",beforeShow:function(){n=!0},onClose:function(){n=!1}}),t.width(t.width()-18)},this.destroy=function(){ue.datepicker.dpDiv.stop(!0,!0),t.datepicker("hide"),t.datepicker("destroy"),t.remove()},this.show=function(){n&&ue.datepicker.dpDiv.stop(!0,!0).show()},this.hide=function(){n&&ue.datepicker.dpDiv.stop(!0,!0).hide()},this.position=function(e){n&&ue.datepicker.dpDiv.css("top",e.top+30).css("left",e.left)},this.focus=function(){t.focus()},this.loadValue=function(e){null!==o&&(o=e[i.column.field],t.val(o),t[0].defaultValue=o,t.select())},this.serializeValue=function(){return t.val()},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){return{valid:!0,msg:null}},this.init()},Checkbox:function(i){var t,o;this.init=function(){(t=ue("<INPUT type=checkbox value='true' class='editor-checkbox' hideFocus>")).appendTo(i.container),t.focus()},this.destroy=function(){t.remove()},this.focus=function(){t.focus()},this.loadValue=function(e){(o="string"==typeof e[i.column.field]?"true"===e[i.column.field]:!!e[i.column.field])?t.prop("checked",!0):t.prop("checked",!1)},this.serializeValue=function(){return t.prop("checked")},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return this.serializeValue()!==o},this.validate=function(){return{valid:!0,msg:null}},this.init()},Time:function(i){var t,o,n=!1;this.init=function(){(t=ue("<INPUT type=text class='editor-text' />")).appendTo(i.container),t.focus().select(),t.timepicker({showOn:"button",buttonImageOnly:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.000",beforeShow:function(){n=!0},onClose:function(){n=!1}}),t.width(t.width()-18)},this.destroy=function(){ue.datepicker.dpDiv.stop(!0,!0),t.datepicker("hide"),t.datepicker("destroy"),t.remove()},this.show=function(){n&&ue.datepicker.dpDiv.stop(!0,!0).show()},this.hide=function(){n&&ue.datepicker.dpDiv.stop(!0,!0).hide()},this.position=function(e){n&&ue.datepicker.dpDiv.css("top",e.top+30).css("left",e.left)},this.focus=function(){t.focus()},this.loadValue=function(e){null!==(o=e[i.column.field])&&(t.val(o),t[0].defaultValue=o,t.select())},this.serializeValue=function(){return t.val()},this.applyValue=function(e,t){e[i.column.field]=t},this.isValueChanged=function(){return!(""==t.val()&&null==o)&&t.val()!=o},this.validate=function(){return{valid:!0,msg:null}},this.init()}}}}),function(u){u.extend(!0,window,{Slick:{Editors:{Date:e,Time:e,DateTime:e}}});var d={1212:"timestamp",1213:"month",1214:"date",1215:"datetime",1216:"timespan",1217:"minute",1218:"second",1219:"time"};function e(i){var e,t,o,n,a,s={val:{title:""}},r=function(e){var t,i,o,n=e,a=void 0;if(t=n.column.field,i=n.item[t],_.isObject(i)&&i.class)a=i.class;else{for(o=0;o<n.grid.getDataLength();o++)if(i=n.grid.getDataItem(o)[t],_.isObject(i)&&i.class){a=i.class;break}void 0===a&&(a=""+(1200+n.grid.getOptions().kdbTypesColumnInfo.get(t).get("kdbType")))}return a}(i),l=d[r],l=p.RTTI.getByName(l).editor;_.extend(s.val,u.extend(!0,{},l)),(n=new C.Model({})).schema=s,this.init=function(){o=n.schema.val.isReplacementForCheckbox,a=new p({model:n}).render(),e=a.$el.appendTo(i.container).bind("keydown.nav",function(e){e.keyCode!==u.ui.keyCode.LEFT&&e.keyCode!==u.ui.keyCode.RIGHT||e.stopImmediatePropagation()}).dblclick(function(e){e.stopPropagation()}),_.defer(function(){e&&e.is(":visible")&&e.find("input[type='text']").focus().select()}),"Select"===n.schema.val.type&&e.bind("keydown",function(e){13==e.which&&a.fields.val.editor.$el.select2("close")})},this.destroy=function(){e&&(e.off(),e.remove()),a&&a.remove()},this.loadValue=function(e){e=e[i.column.field];t=function(e,t){var i=y.convertKDBTemporalToMoment(e),o=e;switch(t){case"1212":case"1213":case"1214":case"1215":case"1216":case"1217":case"1218":case"1219":o=i.toDashString();break;default:console.log("unknown type in CustomSlickEditor.js > convertToEditor()")}return o}(e,r),n.set("val",t)},this.serializeValue=function(){return n.get("val")},this.applyValue=function(e,t){e[i.column.field]=function(e,t){var i,o=e;switch(t){case"1212":o=y.convertValueToMoment(e).toKdbObject(),(i=new kdb.JTimeStamp).i=o.i,i.n=o.n,o=i;break;case"1213":o=y.convertValueToMoment(e).toKdbObject(),(i=new kdb.JMonth).i=o.i,o=i;break;case"1214":o=y.convertDateStringValueToMoment(e).toKdbObject(),(i=new kdb.JDate).i=o.i,o=i;break;case"1215":o=y.convertValueToMoment(e).toKdbObject(),(i=new kdb.JDateTime).i=o.i,o=i;break;case"1216":var n=e.substring(e.indexOf(".")+1,e.length-1);3===n.length&&(e=e.substring(0,e.indexOf(".")+1)+n+"000000Z"),o=y.convertValueToDuration(e).toKdbObject(),(i=new kdb.JTimeSpan).i=o.i,o=i;break;case"1217":(o=new kdb.JMinute).i=60*parseInt(e.substring(11,13),10)+parseInt(e.substring(14,16),10);break;case"1218":(o=new kdb.JSecond).i=60*parseInt(e.substring(11,13),10)*60+60*parseInt(e.substring(14,16),10)+parseInt(e.substring(17,19),10);break;case"1219":o=y.convertValueToMoment(e).toKdbObject(),(i=new kdb.JTime).i=o.i,o=i}return o}(t,r)},this.isValueChanged=function(){var e;return a&&a.commit(),e=this.serializeValue(),o&&(e="true"===e),!_.isEqual(e,t)},this.validate=function(){var e;return i.column.validator&&(e=this.serializeValue(),!(e=i.column.validator(e)).valid)?e:{valid:!0,msg:null}},this.init()}}(jQuery);function ge(e){this.app=e,this.initialize()}var fe={generate:function(e,t,i){var o="General",n="center",a=100,s=fe.generateDefaultColumnObject();switch(t){case 1:o="Boolean",a=40;break;case 2:a=280;break;case 4:o="Number",s.Precision=0,a=35,n="right";break;case 5:o="Number",s.Precision=0,a=50,n="right";break;case 6:o="Number",s.Precision=0,a=85,n="right";break;case 7:o="Formatted Number",s.Precision=0,a=165,n="right";break;case 8:o="Formatted Number",s.Precision=4,a=80,n="right";break;case 9:o="Formatted Number",s.Precision=4,a=140,n="right";break;case 12:o="DateTime",s.TimeFormat="HH:mm:ss.SSSSSSSSS",a=200,n="right";break;case 13:o="Date",a=60,s.DateFormat="YYYY-MM",n="right";break;case 14:o="Date",a=80,n="right";break;case 15:o="DateTime",a=130,n="right";break;case 16:o="Time",s.TimeFormat="HH:mm:ss.SSSSSSSSS",a=120,n="right";break;case 17:o="Time",s.TimeFormat="HH:mm",a=40,n="right";break;case 18:o="Time",a=60,n="right";break;case 19:o="Time",s.TimeFormat="HH:mm:ss.SSS",a=80,n="right";break;case 11:case 1001:n="left"}return i&&"percentage"===e&&(o="Percentage",a=100),s.Field=e,s.DisplayName=e,s.Format=o,s.MinWidthAbsolute=a,s.TextAlign=n,s.WidthWeight=s.MinWidthAbsolute,s},generateDefaultColumnObject:function(){return this.DEFAULT_COLUMN_OBJECT||(this.DEFAULT_COLUMN_OBJECT=_.chain(_.keys(S)).map(function(e){return[e,S[e].default]}).fromPairs().value()),_.clone(this.DEFAULT_COLUMN_OBJECT)}};_.extend(ge,{KDB_2_SLICKGRID_EDITOR_MAP:{Boolean:"Checkbox",Date:"Date",DateTime:"DateTime","Formatted Number":"Float",General:"Text",Number:"Float",Percentage:"Integer","Smart Number":"Float",Time:"Time"}}),_.extend(ge.prototype,C.Events,{initialize:function(){this.$feedbackPanel=this.app.$(".updateStatusFeedback"),this.$lnkToggleEdit=this.app.$(".lnkToggleEditable"),this.$lnkSubmitChanges=this.app.$(".lnkSubmitChanges"),this.$lnkToggleEdit.click(function(){this.toggleEditMode(!1)}.bind(this)),this.$lnkSubmitChanges.click(this.submitTableChanges.bind(this)),this.app.$pnlGrid.on("click",".deleteIcon",_.bind(this.deleteGridRow,this)),this.listenTo(this.app.viewModel,"change:Basics.IsEditable",this.checkIfEditable)},addDeleteColumnIfNecessary:function(e){this.isEditable&&this.app.viewModel.get("Basics.IsEditable")&&this.app.viewModel.get("Basics.IsInsertable")&&e.push({DisplayName:"Delete",Field:"DeleteIcon",Format:"DeleteIcon",Hidden:!1,WidthWeight:0,MinWidthAbsolute:60})},checkUpdateQueryExists:function(){var e=this.app.viewModel.get("Basics.Data");return e&&_.isFunction(e.get)&&e.get("_hasUpdateQuery")&&e.get("_updateQueryString")&&0<e.get("_updateQueryString").length},checkIfEditable:function(){this.resetUnmodifiedData(),this.app.viewModel.get("Basics.IsEditable")&&this.checkUpdateQueryExists()?this.$lnkToggleEdit.show():(this.$lnkToggleEdit.hide(),this.$lnkSubmitChanges&&this.$lnkSubmitChanges.hide()),this.app.layoutModule&&this.app.positionPanelWithDatagrid()},convertRowsToColumns:function(e){var i={};return _.each(e,function(e){_.each(e,function(e,t){_.has(i,t)||(i[t]=[]),e&&"string"==typeof(e=_.isObject(e)&&e.class&&"1216"===e.class?e.i:e)&&0===e.length&&(e=null),i[t].push(e)})}),i},deleteGridRow:function(e){var t=this,i=$(e.currentTarget).data("rownumber"),e=t.app.dataView.getItem(i);e&&(i=e[t.app.SLICKGRID_ROW_UNIQUE_ID],t.app.dataView.deleteItem(i),0<=(i=_.indexOf(t.addedRows,e))?t.addedRows.splice(i,1):t.deletedRows.push(e),t.$lnkSubmitChanges&&t.$lnkSubmitChanges.show())},hasUnmodifiedData:function(){return!!this.unmodifiedData},initializeGridListeners:function(){var n=this;n.app.grid.onCellChange.subscribe(function(e,t){var i,o={};n.app.customEditors?((i=n.app.model.dataSet.collection.get(t.item[n.app.SLICKGRID_ROW_UNIQUE_ID])).set(_.omit(t.item,"_rowIndex","idProperty")),n.app.model.trigger("rowObjectChanged",i,t)):(o[n.app.SLICKGRID_ROW_UNIQUE_ID]=t.item[n.app.SLICKGRID_ROW_UNIQUE_ID],n.editedRows.items=_.without(n.editedRows.items,_.find(n.editedRows.items,o)),(o=_.find(n.addedRows,o))?(n.addedRows=_.without(n.addedRows,o),n.addedRows.push(t.item)):n.editedRows.items.push(t.item),n.$lnkSubmitChanges&&n.$lnkSubmitChanges.show())}),n.app.grid.onAddNewRow.subscribe(function(e,t){var i=t.item;_.each(n.app.columnInfo.pluck("id"),function(e){_.has(i,e)||(i[e]=null)}),null!==i[n.app.SLICKGRID_ROW_UNIQUE_ID]&&void 0!==i[n.app.SLICKGRID_ROW_UNIQUE_ID]||(i[n.app.SLICKGRID_ROW_UNIQUE_ID]=c.Helpers.getGUID()),t.grid.getData().addItem(i),n.addedRows.push(i),n.$lnkSubmitChanges&&n.$lnkSubmitChanges.show()})},isDataviewsLengthAffectedByDeletedRows:function(){var e=!1;return this.rowsDeleted&&(this.rowsDeleted=!(e=!0)),e},remove:function(){this.$lnkToggleEdit.off(),this.$lnkSubmitChanges.off(),this.app.$pnlGrid.off("click",".deleteIcon"),this.stopListening()},resetLists:function(){this.editedRows={typeConfig:{},items:[]},this.addedRows=[],this.deletedRows=[]},resetUnmodifiedData:function(){this.unmodifiedData=null},setUpdateTypeConfig:function(e){this.updateTypeConfig={},e.each(_.bind(function(e){this.updateTypeConfig[e.get("id")]=e.get("kdbType")},this))},showMessageSubmitError:function(e){var t=this.$feedbackPanel;t.removeClass("success"),t.find(".feedbackText").text("An error occurred executing the update query. Error text: "+e),t.addClass("show error"),_.delay(function(){t.removeClass("show")},5e3)},showMessageSubmitSuccess:function(){var e=this.$feedbackPanel;e.removeClass("error"),e.find(".feedbackText").text(t("Update query executed successfully")),e.addClass("show success"),_.delay(function(){e.removeClass("show")},3e3)},startListeningToCurrentDataModel:function(){this.listenTo(this.app.model,"change:_updateQueryString change:_hasUpdateQuery",this.checkIfEditable)},stopListeningToCurrentDataModel:function(){this.app.model&&this.stopListening(this.app.model)},submitTableChanges:function(){var e=this.app.viewModel.get("Basics.Data"),t=function(){this.addedRows&&this.addedRows.length&&(this.app.dataView.suspendIndexing(),this.app.removeItemsFromDataview(this.addedRows),this.app.dataView.reactivateIndexing()),this.deletedRows&&this.deletedRows.length&&(this.rowsDeleted=!0),this.resetLists(),this.resetUnmodifiedData(),this.toggleEditMode(!0),this.showMessageSubmitSuccess()}.bind(this),i=function(e){this.showMessageSubmitError(e[0])}.bind(this),o=function(e){return _.map(e,function(e){return _.omit(e,"_rowIndex","idProperty")})};Slick.GlobalEditorLock.commitCurrentEdit(),o={typeConfig:this.updateTypeConfig,addedDict:{items:this.convertRowsToColumns(o(this.addedRows))},updatedDict:{items:this.convertRowsToColumns(o(this.editedRows.items))},deletedDict:{items:this.convertRowsToColumns(o(this.deletedRows))}},this.app.api.updateTable(e,o,t,i)},toggleEditMode:function(e){var t=this.app.viewModel.get("Basics.IsEditable")&&this.app.viewModel.get("Basics.IsInsertable");this.isEditable=!this.isEditable,t?this.app.viewModel.trigger("change:ColumnsConfiguration"):(this.app.grid.setOptions({editable:this.isEditable}),this.app.grid.invalidate()),this.isEditable?(this.$lnkToggleEdit.html('<i class="fa fa-fw fa-ban"></i>Cancel Editing'),this.unmodifiedData=$.extend(!0,[],this.app.dataView.getItems()),this.app.RAW_MODE&&(this.app.rawModeModule.populateFields(_.keys(this.app.dataColsMap),"editMode"),this.app.rawModeModule.removePopulateItemFn())):(this.resetLists(),this.$lnkToggleEdit.html('<i class="fa fa-fw fa-edit"></i>Edit'),this.$lnkSubmitChanges&&this.$lnkSubmitChanges.hide(),e||!this.hasUnmodifiedData()||t||(t=this.useUnmodifiedData(),this.app.dataView.beginUpdate(),this.app.dataView.setItems(t),this.app.dataView.endUpdate(),this.app.grid.invalidate()),this.app.RAW_MODE&&this.app.rawModeModule.restorePopulateItemFn())},useUnmodifiedData:function(){var e=this.unmodifiedData;return this.resetUnmodifiedData(),e}});function me(){this.isActive=!1,this.instances=[],this.pendingInitObjects=[],this._refreshInternalDebounced=_.debounce(this._refreshInternal,50,{leading:!0})}var ve=function(e,t,i){var o,n,a,s=1;return _.isNumber(e.WidthWeight)&&0<=e.WidthWeight&&(s=e.WidthWeight),o=Q.getFormatter(e,i),a=Slick.Editors[ge.KDB_2_SLICKGRID_EDITOR_MAP[e.Format]],i.customEditors&&_.has(i.customEditors,e.Field)&&(a=i.customEditors[e.Field],e.IsReadonly=!1),"DeleteIcon"===e.Field&&(a=null,o=function(e,t,i,o,n){var a=document.createElement("i");return a.className="fa fa-remove deleteIcon",a.setAttribute("data-rownumber",e),a}),n=e.DisplayName||e.Field,i=((i=e.Tooltip||n)||"").replace(/(?:\\r\\n|\\r|\\n)/g,"\r\n"),a={id:e.Field+t,name:n,toolTip:i,field:e.Field,formatter:o,width:s,sortable:e.Sortable,selectable:e.IsSelectable,focusable:e.IsSelectable,editor:e.IsReadonly?null:a,cssClass:e.TextAlign,headerCssClass:e.TextAlign,_dashboardConfig:e},1<=e.MinWidthAbsolute&&(a.minWidth=e.MinWidthAbsolute),a};_.extend(me.prototype,{_addInstance:function(e){this.instances.push(e)},storeInitObjects:function(){me.loadSparklinesLib(this),me.prototype.storeInitObjects=me.prototype._storeInitObjects_AfterLibraryStartedToLoad,this.storeInitObjects.apply(this,arguments)},_storeInitObjects_AfterLibraryStartedToLoad:function(e,t,i){this.pendingInitObjects.push({el:e,values:t,cfg:i}),this.isActive=!0},remove:function(){this._removeAllInstances(),this.pendingInitObjects=[]},_removeAllInstances:function(){_.each(this.instances,function(e){e.remove()}),this.instances=[]},_removeHiddenInstances:function(){this.instances=_.filter(this.instances,function(e){return!!e.is(":visible")||void e.remove()})},_renderPendingInstances:function(){for(var e,t;e=this.pendingInitObjects.shift();)(t=$(e.el))&&t.is(":visible")&&this._addInstance(t.sparkline(e.values,e.cfg))},refresh:function(){this.isActive&&(me.isLibReady?this._refreshInternalDebounced():me.isLoadingLib&&me.addPendingManager(this))},_refreshInternal:function(){this._removeHiddenInstances(),this._renderPendingInstances()}}),_.extend(me,{isLoadingLib:!1,isLibReady:!1,_pendingManagers:[],addPendingManager:function(e){me._pendingManagers.indexOf(e)<0&&me._pendingManagers.push(e)},loadSparklinesLib:function(e){e&&me.addPendingManager(e),$.fn.sparkline?me._ready():me.isLoadingLib||(me.isLoadingLib=!0,require(["sparkline"],function(){me.isLoadingLib=!1,me._ready()}))},_ready:function(){me.isLibReady=!0,me._refreshPendingManagers()},_refreshPendingManagers:function(){_.each(me._pendingManagers,function(e){e.refresh()}),me._pendingManagers=[]}});function Ce(e){this.app=e,this.initialize(),this.setTheme()}_.extend(Ce.prototype,C.Events,{initialize:function(){this.$root=this.app.$(">.Datagrid"),this.$pnlGrid=this.app.$(".pnlGrid"),this.listenTo(this.app.viewModel,"change:Style.EvenRowBackgroundColorOverride change:Style.OddRowBackgroundColorOverride change:Style.HeaderFontWeight change:Style.FontFamily",_.bind(this.app.generateDataGridFromReceivedData,this.app)),this.listenTo(this.app.viewModel,"change:Style.FontSize",_.bind(this.app.generateDataGridFromReceivedData,this.app)),this.listenTo(this.app.viewModel,"change:Style.RowHeight change:Style.HeaderRowHeight",_.bind(this.app.generateDataGridFromReceivedData,this.app)),this.listenTo(this.app.viewModel,"change:Style.Theme",this.onChange_Theme),this.listenTo(this.app.viewModel,"change:Style.SelectedRowBackgroundColor",this.onChange_SelectedRowBackgroundColor),this.listenTo(this.app.viewModel,"change:Style.HeaderTextTransformation",this.onChange_HeaderTextTransformation)},getFontSize:function(){var e=this.app.viewModel.get("Style.FontSize");return parseFloat(e).toString()==e&&(e+="px"),e},onChange_HeaderTextTransformation:function(e,t){this.$pnlGrid.removeClass("header-uppercase header-lowercase header-capitalize"),"none"===t?this.app.generateDataGridFromReceivedData():this.$pnlGrid.addClass("header-"+t)},onChange_SelectedRowBackgroundColor:function(e,t){var t=t;t?(this.$SelectedRowBackgroundColorCss=this.$SelectedRowBackgroundColorCss||$("<style />",{type:"text/css"}).appendTo(document.head),t='[data-widgetid="'+this.app.widgetId+'"]  div.Datagrid .slick-row > .slick-cell.selected { background-color: '+t+"; }",this.$SelectedRowBackgroundColorCss.html(t)):this.remove_SelectedRowBackgroundColorCss()},onChange_Theme:function(){var e,o=this,n=this.app.viewModel.get("Style.Theme");this.currentTheme&&this.$root.removeClass(this.currentTheme),this.currentTheme=n,this.$root.addClass(this.currentTheme),this.app.api&&(e=this.app.api.getProperty("Style.EvenRowBackgroundColorOverride"),t=this.app.api.getProperty("Style.OddRowBackgroundColorOverride"));var t=[e,t],a=["Style.EvenRowBackgroundColorOverride","Style.OddRowBackgroundColorOverride"],s=c.Tools.getDefaultThemeColors("Light"),r=c.Tools.getDefaultThemeColors("Dark");_.forEach(t,function(e,t){var i;"Light"!==n||e&&e!==r[t]?"Dark"!==n||e&&e!==s[t]||(i=r[t]):i=s[t],i&&o.app.api.setProperty(a[t],i)})},remove:function(){this.stopListening(),this.remove_SelectedRowBackgroundColorCss()},remove_SelectedRowBackgroundColorCss:function(){this.$SelectedRowBackgroundColorCss&&(this.$SelectedRowBackgroundColorCss.remove(),this.$SelectedRowBackgroundColorCss=null)},setTheme:function(){var e=this.app.dashboardViewModel.get("DashboardTheme")||"Dark";this.app.viewModel.set("Style.Theme",e)}});function we(e){this.app=e,this.initialize()}var be,ye,_e,Se,Re={getExportMetaData:function(d){var c=this,p=[],h={GBP:" ",USD:"$ ",EUR:" ",none:""},g=c.getConfigs_datagridConfig_layoutConfig(d);return _.each(g.datagridConfig,function(e,t){var i=g.layoutConfig[t],o={},n=i.Format,a=i.DateFormat,s=i.TimeFormat,r="Percentage"===n?"%":"",l=void 0!==h[i.Currency]?h[i.Currency]:i.Currency,u=d.columnInfo.findWhere({id:e.field}),t=u?u.get("kdbType"):"",s=c.resolveColumnFormat(n,t,a,s,i.Precision);u||console.log("Datagrid column kdbType reverted to empty, col model not foud in columnInfo"),o.colId=e.field,o.colName=e.name,o.dataType=s.dataType,o.dataKdbType=s.dataKdbType,o.dataFormat=s.dataFormat,o.hideTrailingZeroes=i.HideTrailingZeroes,o.prefix=l,o.suffix=r,p.push(o)}),p},resolveColumnFormat:function(e,t,i,o,n){var a="",i=c.ExportTools.DATE_FORMAT_MAP[i],o=c.ExportTools.TIME_FORMAT_MAP[o],s=11<t&&t<20,r=2<t&&t<12,l=_.includes(["Number","Formatted Number","Smart Number","Percentage"],e),u=_.includes(["Date","Time","DateTime"],e),d=(n=this.getValidPrecission(Number(n)))?"."+Array(n+1).join("0"):"";switch((t<1||19<t)&&(t=11,a="TO_STRING",e="String"),(!r&&l||!s&&u)&&(e="String",console.log("!!exportConverterTools value kdbType, col type, format mismatch: "+t+", "+e+", "+a)),e){case"Number":r&&(a="#0"+d);break;case"Formatted Number":e="Number",a="#,##0"+d;break;case"Smart Number":e="String",a="SmartNumber"+d;break;case"Date":a=i||(console.log("Invalid date format: "+i+". Reverting to defaut format"),"");break;case"Time":a=o||(console.log("Invalid date format: "+o+". Reverting to defaut format"),"");break;case"DateTime":a=o&&i?o:(console.log("Invalid date or time formats: "+i+", "+o+". Reverting to defaut format"),""),a=i+" "+o;break;case"Percentage":e="Number",a="#0";break;case"Boolean":e=1===t?"Boolean":"String";break;default:e="String",a="TO_STRING"}return{dataType:e=1===t?"Boolean":e,dataFormat:a,dataKdbType:t}},getValidPrecission:function(e){var t=void 0!==e?e:0;return t<0?(t=0,console.info("Invalid precission, should be between in range of 0 and 10, got: ",e)):10<t&&(t=10,console.info("Invalid precission, should be between in range of 0 and 10, got: ",e)),t},getConfigs_datagridConfig_layoutConfig:function(e){var o=[],n=[],a=_.clone(e.columnsConfig),s=_.clone(e.unpackedColumnsConfiguration);for(i=s.length-1;0<=i;i--)s[i].Hidden&&(a.splice(i,1),s.splice(i,1));return _.each(e.gridColumns,function(t){var e=_.findIndex(a,function(e){return t.id===e.id});0<=e&&(o.push(a[e]),n.push(s[e]))}),{datagridConfig:o,layoutConfig:n}},getConfig:function(e){var t={},i={".csv":"Csv",".xlsx":"Excel"}[e.fileFormat];try{if(_.some(_.values(e),function(e){return void 0===e}))throw"Missing config generator options.";t.dataSet=e.dataSet,t.metaData=this.getExportMetaData(e.columnsConfig),t.fileName=c.ExportTools.getExportFileName(e.fileName,e.altFileName,i),t.fileFormat=e.fileFormat,t.workSheetTitle=e.workSheetTitle,t.csvExportDelimiter=e.csvExportDelimiter}catch(e){console.error("Datagrid config generator error: ",e)}return t},getFullExportConfig:function(e){var n={},a=this.getExportMetaData(e);return a.length&&(n.columnLabel="",n.dateFormat="",_.each(a,function(e,t){var i=t<a.length-1?" && ":"",o=e.dataKdbType,t=e.colId+"#"+e.colName+i;n.columnLabel+=t,12<=o&&o<=19&&"TO_STRING"!==e.dataFormat&&(o=e.dataFormat,"DateTime"===e.dataType&&(o=o.replace(/\s([^\s]+)$/,"_$1")),i=e.colId+"#"+o+i,n.dateFormat+=i)}),new RegExp("&& $").test(n.dateFormat)&&(n.dateFormat=n.dateFormat.slice(0,-4))),n}},Me=C.View.extend({initialize:function(e){var i=this;this.options=e,this.options.theme=this.options.app.viewModel.get("Style.Theme"),this.app=this.options.app,this.$el.html(h.ColumnConfigDialog()),this.$chkRetainColumnWidths=this.$(".chkRetainColumnWidths"),this.initLayout(),this.$dialog=this.$el.dialog(_.extend({dialogClass:"Datagrid column-config-dialog",title:t("Configure Column Layout"),resizable:!1,width:"850",height:"600",modal:!0,autoOpen:!0,draggable:!0,buttons:[{text:t("Reset"),click:function(){i.wasResetHit=!0,i.initDataRows()},icons:{primary:"fa fa-refresh"}},{text:t("Ok"),click:$.proxy(i.onOkButtonClick,i),icons:{primary:"fa fa-check"}},{text:t("Cancel"),click:$.proxy(i.onClose,i),icons:{primary:"fa fa-times"}}],resizeStop:function(){i.dgSource.onResize(),i.dgTarget.onResize()},close:function(){i.trigger("closing"),i.$dialog.dialog("destroy"),i.remove()}},this.options))},initDataRows:function(){var t,o,n=[],e=this.wasResetHit?(t=_.cloneDeep(this.options.resetColumnsConfiguration),n=_.filter(t,{Hidden:!1}),_.filter(t,{Hidden:!0})):(t=_.clone(this.options.columnsConfiguration),_.each(this.options.resetColumnsConfiguration,function(e){_.find(t,{Field:e.Field,Format:e.Format,DisplayName:e.DisplayName})||t.push(_.cloneDeep(e))}),o=_.clone(t),visibleFields=_.map(this.options.currentColumnlayout,"field"),_.each(visibleFields,function(t){var e,i=_.filter(o,{Field:t});0===i.length?(e=_.find(o,function(e){return"*"===e.Field||0<=t.indexOf(e.Field.replace("*",""))}))&&(n.push(e),o=_.without(o,e)):(e=i[0],n.push(e),o=_.without(o,e))}),_.difference(t,n));this.populateDatagrid(this.dgSourceModel,e),this.populateDatagrid(this.dgTargetModel,n)},initLayout:function(){var e=Me.generateDatagridConfig();e.set("theme",this.options.theme),this.dgSourceModel=e.get("data"),this.dgSource=new $e.Master({el:this.$(".pnlSource > .pnlGrid"),model:e}),this.dgSource.$el.on("dblclick",".slick-row",$.proxy(this.onClick_moveToTarget,this)),(e=Me.generateDatagridConfig()).set("theme",this.options.theme),this.selectedColumns=new c.DocumentViewModel({_default:[],_viewType:!0,_type:"list",value:[]}),e.get("datagridConfig").Selection.SelectedValue=this.selectedColumns,this.dgTargetModel=e.get("data"),this.dgTarget=new $e.Master({el:this.$(".pnlTarget > .pnlGrid"),model:e}),this.dgTarget.$el.on("dblclick",".slick-row",$.proxy(this.onClick_moveToSource,this)),this.listenTo(this.dgSource,"selectedRowsChanged",this.updateButtonStates),this.listenTo(this.dgTarget,"selectedRowsChanged",this.updateButtonStates),this.initDataRows(),this.dgSource.isDialogueGrid=!0,this.dgTarget.isDialogueGrid=!0,this.$btnMoveToSource=this.$(".btnMoveToSource"),this.$btnMoveToTarget=this.$(".btnMoveToTarget"),this.$btnMoveUp=this.$(".btnMoveUp"),this.$btnMoveDown=this.$(".btnMoveDown"),this.$btnMoveToSource.button({icons:{primary:"fa fa-arrow-left"},disabled:!0,text:!1}).click($.proxy(this.onClick_moveToSource,this)),this.$btnMoveToTarget.button({icons:{primary:"fa fa-arrow-right"},disabled:!0,text:!1}).click($.proxy(this.onClick_moveToTarget,this)),this.$btnMoveUp.button({icons:{primary:"fa fa-arrow-up"},disabled:!0,text:!1}).click($.proxy(this.onClick_moveUp,this)),this.$btnMoveDown.button({icons:{primary:"fa fa-arrow-down"},disabled:!0,text:!1}).click($.proxy(this.onClick_moveDown,this))},moveSelectedColumns:function(e){var i,o,t=this.selectedColumns.get("value"),n=[];0!==t.length&&(i=this.dgTargetModel.dataSet.collection.toJSON(),o=i.length-1,!e&&_.max(t)===o||e&&0===_.min(t)||(e&&(i=i.reverse(),t=_.map(t,function(e){return i.length-e-1})),t=_.sortBy(t).reverse(),_.each(t,function(e){var t;e+1<=o?(t=i[e+1],i[e+1]=i[e],i[e]=t,o=e,n.push(e+1)):(o=e-1,n.push(e))}),e&&(i=i.reverse(),n=_.map(n,function(e){return i.length-e-1})),this.populateDatagrid(this.dgTargetModel,_.map(i,"columnConfig")),this.selectedColumns.set("value",n),this.dgTarget.onSettingsChange({"Selection.SelectedValue":n}),this.dgTarget.grid.scrollRowIntoView(_.first(n))))},onClick_moveDown:function(){this.wasResetHit=!1,this.moveSelectedColumns(!1)},onClick_moveToTarget:function(){var e,t,i=this.dgSource.selectionModule.getSelectedRowObjects()||[],o=_.map(i,"pk");i.length&&(this.wasResetHit=!1,e=this.dgSourceModel.dataSet.collection.toJSON(),i=_.filter(e,function(e){return _.includes(o,e.pk)}),t=_.difference(e,i),i=_.map(i,"columnConfig"),t=_.map(t,"columnConfig"),this.populateDatagrid(this.dgSourceModel,t),this.populateDatagrid(this.dgTargetModel,this.dgTargetModel.dataSet.collection.pluck("columnConfig").concat(i)),this.dgSource.grid&&(e=_.extend({},this.dgSource.grid.getActiveCell()),this.dgSource.grid.setSelectedRows([]),t=this.dgSource.grid.getDataLength()-1,i=this.dgTarget.grid.getDataLength()-1,this.dgSource.grid.resetActiveCell(),t>=e.row?this.dgSource.grid.setActiveCell(e.row,0):null==e.row&&0<=t&&this.dgSource.grid.setActiveCell(t,0),this.dgTarget.grid.setActiveCell(i,0)))},onClick_moveToSource:function(){var e,t,i=this.dgTarget.selectionModule.getSelectedRowObjects()||[];selectedObjectPKs=_.map(i,"pk"),i.length&&(this.wasResetHit=!1,t=(t=this.dgSourceModel.dataSet.collection.toJSON()).concat(i),e=this.dgTargetModel.dataSet.collection.toJSON(),i=_.filter(e,function(e){return!_.includes(selectedObjectPKs,e.pk)}),i=_.map(i,"columnConfig"),t=_.map(t,"columnConfig"),this.populateDatagrid(this.dgSourceModel,t),this.populateDatagrid(this.dgTargetModel,i),this.dgTarget.grid&&(e=_.extend({},this.dgTarget.grid.getActiveCell()),this.dgTarget.grid.setSelectedRows([]),t=this.dgSource.grid.getDataLength()-1,i=this.dgTarget.grid.getDataLength()-1,this.dgTarget.grid.resetActiveCell(),i>=e.row?this.dgTarget.grid.setActiveCell(e.row,0):null==e.row&&0<=i&&this.dgTarget.grid.setActiveCell(i,0),this.dgSource.grid.setActiveCell(t,0)))},onClick_moveUp:function(){this.wasResetHit=!1,this.moveSelectedColumns(!0)},onClose:function(){this.$el.dialog("close")},onOkButtonClick:function(){var t,i,o,n,e,a=null,s=this;this.wasResetHit?(e=this.app.cloneDeep_processViewStates(this.app.api.getProperty("ColumnsConfiguration")),this.app.viewModel.set("ColumnsConfiguration",e,{silent:!0})):(a=[],n=this.dgTargetModel.dataSet.collection.toJSON(),e=this.dgSourceModel.dataSet.collection.toJSON(),n=_.map(n,"columnConfig"),e=_.map(e,"columnConfig"),_.each(n,function(e){e.Hidden=!1}),_.each(e,function(e){e.Hidden=!0}),this.$chkRetainColumnWidths.is(":checked")?(i=this.options.currentColumnlayout,o=1,0<i.length&&(o=_.minBy(i,"width").width),_.each(n,function(e,t){e=_.find(i,{field:e.Field})||{width:o};n[t].WidthWeight=e.width,n[t]._RetainWidth=!0})):_.each(n,function(e){t=_.find(s.options.resetColumnsConfiguration,{Field:e.Field}),e.WidthWeight=t.WidthWeight,e.MinWidthAbsolute=t.MinWidthAbsolute}),a=a.concat(n).concat(e)),this.trigger("okClick",a),this.onClose()},populateDatagrid:function(e,t){dataRows=_.map(t,function(e,t){return{pk:t,name:e.DisplayName,columnConfig:e}}),e.onExecuteBegin(),(t=Me.dummyKdbResponse()).rows=dataRows,e.onExecuteSuccess(t,!0)},remove:function(){_.each([this.dgSource,this.dgTarget],function(e){e.$el.off(),e.remove()}),_.each([this.$btnMoveToSource,this.$btnMoveToTarget,this.$btnMoveUp,this.$btnMoveDown],function(e){e.off(),e.button("destroy")}),C.View.prototype.remove.apply(this,arguments)},updateButtonStates:function(){var e=0===(this.dgSource.selectionModule.getSelectedRowObjects()||[]).length,t=0===(this.dgTarget.selectionModule.getSelectedRowObjects()||[]).length;this.$btnMoveToSource.button("option","disabled",t),this.$btnMoveToTarget.button("option","disabled",e),this.$btnMoveUp.button("option","disabled",t),this.$btnMoveDown.button("option","disabled",t)}},(be=["pk","name","columnConfig"],ye=[6,11,0],_e=["pk","Name","columnConfig"],Se=["pk","columnConfig"],{generateDatagridConfig:function(){var e=new c.DocumentDataModel({_subscriptionKey:"pk",_dataType:"copy",_maxRows:1e6});return e.apply(),e.onExecuteSuccess(Me.dummyKdbResponse(),!0),new C.Model({data:e,columnsConfig:Me.getColumnsConfiguration(),datagridConfig:Me.datagridConfiguration(),sortColumns:Me.sortColumns,theme:"Dark"})},datagridConfiguration:function(){return{Selection:{Mode:"Multi Row"}}},columnsConfiguration:function(){return _.map(be,function(e,t){return{Field:e,DisplayName:_e[t],Sortable:!1,Hidden:_.includes(Se,be[t])}})},dummyKdbResponse:function(){return{rows:[],columns:be,meta:_.zipObject(be,ye)}},getColumnsConfiguration:function(){var e=Me.columnsConfiguration();return e=_.map(e,function(e){return _.extend({},$e.getColumnSettingsModel(),{DisplayName:e.Field,TextAlign:"left",IsReadonly:!0},e)})},sortColumns:[{sortCol:"pk",sortAsc:!0}]}));_.extend(we.prototype,C.Events,{initialize:function(){var i=this;_.extend(this.app,Te),this.$lnkCsvExport=this.app.$("a.lnkCsvExport"),this.$lnkExcelExport=this.app.$("a.lnkExcelExport"),this.$lnkFullExport=this.app.$("a.lnkFullExport"),this.$lnksExport=this.app.$(".lnksExport"),this.$lnkResetFilters=this.app.$(".lnkResetFilters").hide(),this.$pnlGroupedColumns=this.app.$(".pnlGroupedColumns"),this.$lblDragDropHint=this.app.$(".lblDragDropHint"),this.$pnlPager=this.app.$(".pnlPager"),this.$txtGlobalFilter=this.app.$(".txtGlobalFilter"),this.$lnkConfiguration=this.app.$(".lnkConfiguration"),this.$lnkCsvExport.click(_.bind(this.showDialog,this,".csv")),this.$lnkExcelExport.click(_.bind(this.showDialog,this,".xlsx")),this.$lnkFullExport.click(_.bind(this.apiExport,this)),this.displayChoiceLinkButtons(),this.$lnkConfiguration.click(_.bind(this.showCustomLayoutConfig,this)),this.listenTo(this.app.viewModel,"change:FileExport.ShowExportCsvButton change:FileExport.ShowExportExcelButton change:FileExport.ShowFullExportButton",_.bind(this.displayChoiceLinkButtons,this)),this.listenTo(this.app.viewModel,"change:Basics.EnableGrouping",this.onChange_EnableGrouping),this.listenTo(this.app.viewModel,"change:Basics.Filtering change:Basics.IsEditable",_.bind(this.app.positionPanelWithDatagrid,this.app)),this.listenTo(this.app.viewModel,"change:Basics.ShowPagingControl change:Basics.Filtering change:Basics.IsFilterVisible",this.onChange_ShowPagingControl_Filtering_IsFilterVisible),this.listenTo(this.app.viewModel,"change:Basics.EnableCustomLayoutConfiguration",this.onChange_EnableCustomLayoutConfiguration),this.listenTo(this.app.viewModel,"change:Basics.Data",function(e,t){c.ExportTools.onQueryChange(t,i.$lnkFullExport)})},showDialog:function(e){var t=c.ExportTools,e=Re.getConfig({dataSet:this.app.getAllFilteredItems(),columnsConfig:{columnInfo:this.app.columnInfo,columnsConfig:this.app.columnsConfig,unpackedColumnsConfiguration:this.app.unpackedColumnsConfiguration,gridColumns:this.app.grid.getColumns()},csvExportDelimiter:this.getCsvDelimiter(),fileName:this.getFileName(),altFileName:this.getAltFileName(),fileFormat:e,workSheetTitle:"Datagrid"});t.openFileExportDialog(e)},getFileName:function(){return this.app.viewModel.get("FileExport.FileName")},getCsvDelimiter:function(){return this.app.viewModel.get("FileExport.CsvExportDelimiter")},getAltFileName:function(){return this.app.viewModel.get("format.widgetTitle")||""},onChange_EnableCustomLayoutConfiguration:function(e,t){this.$lnkConfiguration[t?"show":"hide"](),this.positionPanelWithDatagrid()},onChange_EnableGrouping:function(e,t){this.$pnlGroupedColumns[t?"show":"hide"](),this.$lblDragDropHint[t?"show":"hide"](),this.positionPanelWithDatagrid()},apiExport:function(){var e,i,o,n;this.$lnkFullExport.hasClass("events-disabled")||(o={columnInfo:(e=this).app.columnInfo,columnsConfig:this.app.columnsConfig,unpackedColumnsConfiguration:this.app.unpackedColumnsConfiguration,gridColumns:this.app.grid.getColumns()},i=Re.getFullExportConfig(o),o=c.ExportTools.getExportFileName(this.getFileName(),this.getAltFileName(),"DatagridExport"),n=$("<span />").addClass("export-spinner fa fa-spinner fa-pulse").attr("title",t("Download in progress")).appendTo(this.$lnkFullExport),this.$lnkFullExport.addClass("export-in-progress"),this.app.api.exportData(this.app.viewModel.get("Basics.Data"),function(){n.remove(),e.$lnkFullExport.removeClass("export-in-progress")},{exportName:o,exportParams:i}))},displayChoiceLinkButtons:function(){var e=this.app.viewModel.get("FileExport");e&&(e.ShowExportCsvButton||e.ShowExportExcelButton||e.ShowFullExportButton?(this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!e.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!e.ShowExportExcelButton),this.$lnkFullExport.toggleClass("link-disabled",!e.ShowFullExportButton)):this.$lnksExport.addClass("link-disabled"),this.positionPanelWithDatagrid())},onChange_ShowPagingControl_Filtering_IsFilterVisible:function(){var e=this.app.viewModel.get("Basics.ShowPagingControl"),t="Quick Search"===this.app.viewModel.get("Basics.Filtering")&&this.app.viewModel.get("Basics.IsFilterVisible");this.$pnlPager.css("display",e?"block":"none").css("right",t?"220px":"0px"),this.$txtGlobalFilter.css("display",t?"block":"none"),this.positionPanelWithDatagrid()},positionPanelWithDatagrid:function(){this.app.positionPanelWithDatagrid()},remove:function(){this.$lnkCsvExport.off(),this.$lnkExcelExport.off(),this.$lnkFullExport.off(),this.$lnkConfiguration.off(),this.stopListening()},saveCurrentColumnLayout:function(){var o,n,e=this.app.grid.getColumns();this.app.viewModel.get("Basics.EnableCustomLayoutConfiguration")&&e.length&&(o=$.extend(!0,[],this.app.unpackedColumnsConfiguration),n=[],_.each(e,function(e){var t=e.field,i=_.findIndex(o,function(e){return e.Field===t});0<=i&&((i=o.splice(i,1)[0]).WidthWeight=e.width,i._RetainWidth=!0,n.push(i))}),n.length&&this.app.api.saveSetting("UsersColumnsConfiguration",n))},showCustomLayoutConfig:function(){var t=this,e=this.app.unpackColumnConfiguration(this.app.cloneDeep_processViewStates(this.app.api.getProperty("ColumnsConfiguration")),this.app.columnInfo),i=new Me({app:this.app,currentColumnlayout:t.app.grid.getColumns(),columnsConfiguration:t.app.unpackedColumnsConfiguration,resetColumnsConfiguration:e});t.listenTo(i,"closing",function(){t.stopListening(i)}),t.listenTo(i,"okClick",function(e){t.app.api.saveSetting("UsersColumnsConfiguration",e),t.app.sortingModule.storeSortColumns(),t.app.filteringModule.resetFilters(),t.app.generateDataGridFromReceivedData()})},subscribeToColumnsResizeEvent:function(){this.app.grid.onColumnsResized.subscribe(this.saveCurrentColumnLayout.bind(this))}});function ke(e){this.app=e,this.initialize()}var Ie,Te={onResize:function(){var e=this;this.onResizeDebounced||(this.onResizeDebounced=_.debounce(function(){e.resizeConditional()},400)),this.ignoreResize||this.onResizeDebounced()},onResizeStart:function(){this.ignoreResize=!0},onResizeStop:function(){this.ignoreResize=!1,this.resizeConditional(),this.onResize()},positionPanelWithDatagrid:function(){var e=this.viewModel.get("Basics.Filtering"),t=this.viewModel.get("Basics.EnableGrouping"),i=this.viewModel.get("FileExport.ShowExportCsvButton"),o=this.viewModel.get("FileExport.ShowExportExcelButton"),n=this.viewModel.get("FileExport.ShowFullExportButton"),a=this.viewModel.get("Basics.EnableCustomLayoutConfiguration"),s=this.viewModel.get("Basics.IsEditable"),r=this.isDialogueGrid,l=!(!this.$(".lnkToggleEditable")||"none"===this.$(".lnkToggleEditable").css("display")),u="Quick Search"===e&&this.viewModel.get("Basics.IsFilterVisible"),d=this.viewModel.get("Basics.ShowPagingControl");this.$pnlGrid.css("bottom",d||u?"30px":"0px"),this.$pnlGrid.css("top",(t||i||o||n||"disabled"!==e||a||s&&l)&&!r?"36px":"0px"),this.resizeConditional()},resizeConditional:function(){this.grid&&this.$el.is(":visible")&&(this.grid.resizeCanvas(),this.viewModel.isLazyDataLoadingOn()&&this.grid.onViewportChanged.notify(),this.sparklinesManager.refresh())},setTheme:function(){this.themeModule&&this.themeModule.setTheme()}};_.extend(ke.prototype,C.Events,{initialize:function(){this.hideQueryStatus=this.app.api.hideQueryStatus,this.showQueryStatus=this.app.api.showQueryStatus},initializeQueryStatusHandler:function(e){this.stopListening(),e&&(this.updateQueryStatus(e,e.get("queryStatus")),this.listenTo(e,"change:queryStatus",this.updateQueryStatus))},remove:function(){this.stopListening()},updateQueryStatus:function(e,t){t?this.showQueryStatus(t):this.hideQueryStatus()}}),(Ie=jQuery).extend(!0,window,{Slick:{Data:{GroupItemMetadataProvider:function(s){var n,e={groupCssClass:"slick-group",groupTitleCssClass:"slick-group-title",totalsCssClass:"slick-group-totals",groupFocusable:!0,totalsFocusable:!1,toggleCssClass:"slick-group-toggle",toggleExpandedCssClass:"expanded",toggleCollapsedCssClass:"collapsed",enableExpandCollapse:!0,groupFormatter:function(e,t,i,o,n){if(!s.enableExpandCollapse)return n.title;var a=15*n.level+"px";return"<span class='"+s.toggleCssClass+" "+(n.collapsed?s.toggleCollapsedCssClass:s.toggleExpandedCssClass)+"' style='margin-left:"+a+"'></span><span class='"+s.groupTitleCssClass+"' level='"+n.level+"'>"+n.title+"</span>"},totalsFormatter:function(e,t,i,o,n){return o.groupTotalsFormatter&&o.groupTotalsFormatter(n,o)||""}};function t(e,t){var i=this.getDataItem(t.row);i&&i instanceof Slick.Group&&Ie(e.target).hasClass(s.toggleCssClass)&&(t=n.getRenderedRange(),this.getData().setRefreshHints({ignoreDiffsBefore:t.top,ignoreDiffsAfter:t.bottom+1}),i.collapsed?this.getData().expandGroup(i.groupingKey):this.getData().collapseGroup(i.groupingKey),e.stopImmediatePropagation(),e.preventDefault())}function i(e,t){var i,o;s.enableExpandCollapse&&e.which==Ie.ui.keyCode.SPACE&&(!(o=this.getActiveCell())||(i=this.getDataItem(o.row))&&i instanceof Slick.Group&&(o=n.getRenderedRange(),this.getData().setRefreshHints({ignoreDiffsBefore:o.top,ignoreDiffsAfter:o.bottom+1}),i.collapsed?this.getData().expandGroup(i.groupingKey):this.getData().collapseGroup(i.groupingKey),e.stopImmediatePropagation(),e.preventDefault()))}return s=Ie.extend(!0,{},e,s),{init:function(e){(n=e).onClick.subscribe(t),n.onKeyDown.subscribe(i)},destroy:function(){n&&(n.onClick.unsubscribe(t),n.onKeyDown.unsubscribe(i))},getGroupRowMetadata:function(e){return{selectable:!1,focusable:s.groupFocusable,cssClasses:s.groupCssClass,columns:{0:{colspan:"*",formatter:s.groupFormatter,editor:null}}}},getTotalsRowMetadata:function(e){return{selectable:!1,focusable:s.totalsFocusable,cssClasses:s.totalsCssClass,formatter:s.totalsFormatter,editor:null}}}}}}});function De(e){this.app=e,this.initialize()}var Fe,xe;_.extend(De.prototype,C.Events,{initialize:function(){this.$pnlGroupedColumns=this.app.$(".pnlGroupedColumns"),this.$lblDragDropHint=this.app.$(".lblDragDropHint"),this.$pnlGrid=this.app.$(".pnlGrid"),this.$frame=this.app.$(".datagridFrame"),this.groupedColumns=[],this.initGrouping(),this.listenTo(this.app.viewModel,"change:Basics.GroupingAutoCollapse",this.applyGroupingAutoCollapse),this.listenTo(this.app.viewModel,"change:Basics.EnableGrouping",this.onChange_EnableGrouping),this.listenTo(this.app.viewModel,"change:GroupingConfiguration",this.onChange_GroupingConfiguration),this.listenTo(this.app.viewModel,"change:SummaryRow_Groupings",this.onChange_SummaryRow_Groupings)},appendGroupingItem:function(e){var t,i=this;i.groupedColumns.push(e.id),t=$('<div class="groupedItem">'+e.name+"</div>").data("column",e),(e=$('<i class="btnClose fa fa-close"></i>')).click(function(){var e=$(this).parent(),t=e.data("column").id;i.groupedColumns=_.without(i.groupedColumns,t),e.fadeOut(function(){e.remove(),i.groupingChanged()})}),t.append(e).hide().appendTo(i.$pnlGroupedColumns).fadeIn(),i.groupingChanged()},applyGrouping:function(e){e=_.find(this.app.columnsConfig,{field:e});e&&(this.$lblDragDropHint.hide(),this.appendGroupingItem(e),this.applyGroupingAutoCollapse())},applyGroupingAutoCollapse:function(){this.app.dataView&&(this.app.viewModel.get("Basics.GroupingAutoCollapse")?this.app.dataView.collapseAllGroups():this.app.dataView.expandAllGroups())},clearGrouping:function(){this.$pnlGroupedColumns.find(".btnClose").off(),this.$pnlGroupedColumns.find(">.groupedItem").remove()},fixColumnReorderingLayoutIssue:function(){var i=this;this.app.grid.onBeforeColumnsReordered.subscribe(function(e,t){i.$pnlGrid.removeClass("tempGroupingFix")}),this.app.grid.onColumnsReordered.subscribe(function(e,t){i.app.resizeConditional(),i.app.layoutModule&&i.app.layoutModule.saveCurrentColumnLayout()}),this.app.grid.onColumnsReorderStart.subscribe(function(e,t){i.$pnlGrid.addClass("tempGroupingFix")})},groupingChanged:function(){var e,t,n=this,a=[],s=n.app.viewModel.get("SummaryRow_Groupings"),r=[];n.app.dataView&&!n.avoidLoopback&&(0===n.groupedColumns.length&&n.app.viewModel.get("Basics.EnableGrouping")&&n.$lblDragDropHint.show(),_.each(n.$pnlGroupedColumns.children(".groupedItem"),function(e,t){var o=$(e).data("column"),i=o.field,e={};e.getter=i,a.push(i),n.app.groupingsOrder&&t<=n.app.groupingsOrder.length&&(_.isFunction(n.app.groupingsOrder[t])?e.comparer=n.app.groupingsOrder[t]:"asc"===n.app.groupingsOrder[t]?e.comparer=function(e,t){return e.value-t.value}:e.comparer=function(e,t){return t.value-e.value}),e.formatter=function(e){var t=void 0,i=e.value;return _.isArray(e.rows)&&(t=e.rows[0]),o.formatter&&(i=(i=o.formatter(void 0,void 0,i,void 0,t,!0)).outerHTML),t=Q.getSummaryRowHtml(e,s,n.app.columnsConfig,n.app),i+' <span class="lblGropRowCount">('+e.count+" items)</span>"+t},r.push(e)}),n.app.RAW_MODE&&(n.app.rawModeModule.populateFields(a,"group"),t=[],a.length&&(_.each(s,function(e){t.push(e.Column),t.push(e.Column2)}),t=_.uniq(_.compact(t))),n.app.rawModeModule.populateFields(t,"groupSummary")),n.app.dataView.setGrouping(r),n.applyGroupingAutoCollapse(),n.defaultGroupingLoaded&&(_.some(n.app.api.getProperty("GroupingConfiguration"),{ColumnProperty:""})||(e=_.map(r,function(e){return{ColumnProperty:e.getter}}),n.avoidLoopback=!0,n.app.api.saveSetting("GroupingConfiguration",e),n.app.api.setProperty("GroupingConfiguration",e),n.avoidLoopback=!1)))},initGrouping:function(){var o=this;o.groupedColumns=[],o.$pnlGroupedColumns.droppable({accept:function(e){return $(e).parents(".datagridFrame").get(0)===o.$frame.get(0)},hoverClass:"ui-state-hover",drop:function(e,t){var i=$(t.draggable).data("column");i&&(o.$lblDragDropHint.hide(),_.includes(o.groupedColumns,i.id)?(0<=$(e.toElement||e.originalEvent.target).attr("class").indexOf("slick")&&((e=_.find(o.$pnlGroupedColumns.children(".groupedItem"),function(e){return $(e).data("column").id===i.id}))&&$(e).appendTo(o.$pnlGroupedColumns)),_.defer(_.bind(o.groupingChanged,o))):o.appendGroupingItem(i))}}),o.$pnlGroupedColumns.sortable({cancel:""}).disableSelection()},loadAndApplyGroupingSettings:function(){var t=this;this.groupedColumns=[],this.clearGrouping();var e=t.app.api.loadSetting("GroupingConfiguration")||t.app.viewModel.get("GroupingConfiguration");_.each(e,function(e){t.applyGrouping(e.ColumnProperty)}),t.defaultGroupingLoaded=!0},modifyDataViewConfig:function(e){this.groupItemMetadataProvider=new Slick.Data.GroupItemMetadataProvider,_.extend(e,{groupItemMetadataProvider:this.groupItemMetadataProvider})},onChange_EnableGrouping:function(e,t){var i=this;!t&&i.app.dataView&&_.defer(function(){i.groupedColumns=[],i.resetGrouping(),i.app.api.setProperty("GroupingConfiguration",[])})},onChange_GroupingConfiguration:function(){var t,e;this.app.skipGridGeneration||this.avoidLoopback||(e=(t=this).app.viewModel.get("GroupingConfiguration"),this.groupedColumns=[],this.clearGrouping(),e&&e.length&&_.each(e,function(e){t.applyGrouping(e.ColumnProperty)}),this.groupingChanged())},onChange_SummaryRow_Groupings:function(){_.each(_.compact(this.app.viewModel.get("SummaryRow_Groupings")),function(e,t){t="SummaryRow_Groupings."+t+".Column2";"WAVG"===e.Function?void 0===e.Column2&&(this.app.viewModel.set(t,"",{silent:!0}),this.app.api.setProperty(t,"")):void 0!==e.Column2&&(this.app.viewModel.set(t,void 0,{silent:!0}),this.app.api.setProperty(t,void 0))}.bind(this)),this.app.generateDataGridFromReceivedData()},remove:function(){this.$pnlGroupedColumns.data("uiDroppable")&&this.$pnlGroupedColumns.droppable("destroy"),this.$pnlGroupedColumns.data("uiSortable")&&this.$pnlGroupedColumns.sortable("destroy"),this.clearGrouping(),this.stopListening()},resetGrouping:function(){var e=this.app.viewModel.get("Basics.EnableGrouping"),t=this.app.dataView;t&&t.setGrouping([]),this.groupedColumns=[],this.clearGrouping(),e&&this.$lblDragDropHint.show()},saveGroupingState:function(){var i=this;i.dataRefresh?i.setSavedGroupingState():(i.collapsedGroups=[],i.expandedGroups=[],_.each(i.$pnlGrid.find(".slick-group-toggle"),function(e,t){($(e).hasClass("collapsed")?i.collapsedGroups:i.expandedGroups).push({groupTitle:$(e).siblings(".slick-group-title")[0].childNodes[0].textContent,groupIndex:t})}))},setDataRefresh:function(e){this.dataRefresh=e},setSavedGroupingState:function(){var i=this.$pnlGrid.find(".slick-group-toggle");this.app.viewModel.get("Basics.GroupingAutoCollapse")?_.each(this.expandedGroups,function(t){var e=_.filter(i,function(e){return $(e).siblings(".slick-group-title")[0].childNodes[0].textContent===t.groupTitle});e[0]&&$(e[0]).hasClass("collapsed")&&$(e[0]).mousedown()}):_.each(this.collapsedGroups,function(t){var e=_.filter(i,function(e){return $(e).siblings(".slick-group-title")[0].childNodes[0].textContent===t.groupTitle});e[0]&&$(e[0]).hasClass("expanded")&&$(e[0]).mousedown()})}}),(Fe=jQuery).extend(!0,window,{Slick:{Controls:{Pager:function(o,n,a){var s;function r(){var e=!Slick.GlobalEditorLock.commitCurrentEdit(),t=o.getPagingInfo(),i=t.totalPages-1;return{canGotoFirst:!e&&0!=t.pageSize&&0<t.pageNum,canGotoLast:!e&&0!=t.pageSize&&t.pageNum!=i,canGotoPrev:!e&&0!=t.pageSize&&0<t.pageNum,canGotoNext:!e&&0!=t.pageSize&&t.pageNum<i,pagingInfo:t}}function l(e){o.setRefreshHints({isFilterUnchanged:!0}),o.setPagingOptions({pageSize:e})}function u(){r().canGotoFirst&&o.setPagingOptions({pageNum:0})}function d(){var e=r();e.canGotoLast&&o.setPagingOptions({pageNum:e.pagingInfo.totalPages-1})}function c(){var e=r();e.canGotoPrev&&o.setPagingOptions({pageNum:e.pagingInfo.pageNum-1})}function p(){var e=r();e.canGotoNext&&o.setPagingOptions({pageNum:e.pagingInfo.pageNum+1})}function i(e){var t,i=r();a.find(".slick-pager-nav span").removeClass("ui-state-disabled"),i.canGotoFirst||a.find(".ui-icon-seek-first").addClass("ui-state-disabled"),i.canGotoLast||a.find(".ui-icon-seek-end").addClass("ui-state-disabled"),i.canGotoNext||a.find(".ui-icon-seek-next").addClass("ui-state-disabled"),i.canGotoPrev||a.find(".ui-icon-seek-prev").addClass("ui-state-disabled"),0==e.pageSize?(t=o.getItems().length,(i=e.totalRows)<t?s.text("Showing "+i+" of "+t+" rows"):s.text("Showing all "+t+" rows"),s.text("Showing all "+e.totalRows+" rows")):s.text("Showing page "+(e.pageNum+1)+" of "+e.totalPages)}o.onPagingInfoChanged.subscribe(function(e,t){i(t)}),function(){a.empty();var e=Fe("<span class='slick-pager-nav' />").appendTo(a),t=Fe("<span class='slick-pager-settings' />").appendTo(a);s=Fe("<span class='slick-pager-status' />").appendTo(a),t.append("<span class='slick-pager-settings-expanded' style='display:none'>Show: <a data=0>All</a><a data='-1'>Auto</a><a data=25>25</a><a data=50>50</a><a data=100>100</a></span>"),t.find("a[data]").click(function(e){var t=Fe(e.target).attr("data");null!=t&&l(-1==t?(e=n.getViewport()).bottom-e.top:parseInt(t))});var i="<span class='ui-state-default ui-corner-all ui-icon-container'><span class='ui-icon ",o="' /></span>";Fe(i+"ui-icon-lightbulb"+o).click(function(){t.find(".slick-pager-settings-expanded").toggle()}).appendTo(t),Fe(i+"ui-icon-seek-first"+o).click(u).appendTo(e),Fe(i+"ui-icon-seek-prev"+o).click(c).appendTo(e),Fe(i+"ui-icon-seek-next"+o).click(p).appendTo(e),Fe(i+"ui-icon-seek-end"+o).click(d).appendTo(e),a.find(".ui-icon-container").hover(function(){Fe(this).toggleClass("ui-state-hover")}),a.children().wrapAll("<div class='slick-pager' />")}(),i(o.getPagingInfo())}}}}),xe=function(e){this.app=e,this.$moduleEl=this.app.$(".pnlPager")},_.extend(xe.prototype,{afterInitialize:function(e){this.restoreCurrentState(),_.isFunction(e)&&e()},initPager:function(e,t){this.removePager(),this.app.viewModel.isLazyDataLoadingOn()||(this.$pager=$("<div />").addClass("pager").appendTo(this.$moduleEl),e?(this.pager=new n({api:this.app.api,el:this.$pager[0],skipDataSourceSubscription:!0}),_.extend(this,this.pager),this.listenTo(this.app.viewModel,"change:Basics.Data",this.onChange_Data),this.onChange_Data(),this.pendingOnData&&(this.onData.apply(this,this.pendingOnData),delete this.pendingOnData),this.listenTo(this.pager,"paged",function(){this.trigger("paged")})):(this.pager=new Slick.Controls.Pager(this.app.dataView,this.app.grid,this.$pager),_.extend(xe.prototype,C.Events))),this.afterInitialize(t)},onChange_Data:function(){this.onSettingsChange({"Basics.Data":this.app.viewModel.get("Basics.Data")})},onData:function(){this.pendingOnData=arguments},onSettingsChange:$.noop,remove:function(){this.removePager(),this.stopListening()},removePager:function(){this.pager&&_.isFunction(this.pager.remove)&&this.pager.remove(),this.$pager&&this.$pager.remove(),this.pager=null},restoreCurrentState:function(){this.pagerState&&this.$pager&&this.$pager.find(".slick-pager-settings-expanded").css("display",this.pagerState)},setSortConfig:$.noop,storeCurrentState:function(){this.$pager&&(this.pagerState=this.$pager.find(".slick-pager-settings-expanded").css("display"))},listenTo:$.noop,listenToOnce:$.noop,off:$.noop,on:$.noop,once:$.noop,stopListening:$.noop,trigger:$.noop});function Ee(e){this.app=e,this.depopulateDelay=1e4,this.initialize()}_.extend(Ee.prototype,C.Events,{initialize:function(){this._debouncedDepopulateFields=_.debounce(this.depopulateFields,this.depopulateDelay,{trailing:!0})},cacheScrollValues:function(e,t,i){this.lastdisplayedDataTop=e,this.lastdisplayedDataIdTop=t,this.scrollLeft=i},createRowFromColumns:function(i,e,o){return _.each(e,function(e,t){i[t]=e.toLegacy(o)}),i},depopulateFields:function(){var i=this,o=i.app.dataView.getItems();_.each(i.getFieldsToDepopulate(i.app.populatedFields),function(e,t){delete i.app.populatedFields[t],_.each(o,function(e){delete e[t]})})},getAllFilteredItems:function(){for(var e=[],t=this.app.dataView.getItems(),i=this.app.SLICKGRID_ROW_UNIQUE_ID,o=0;o<this.app.pks.length;o++){var n=this.app.pkOffsetMap[t[o][i]],n=this.createRowFromColumns({},this.app.dataColsMap,n);n[this.app.primaryKey]||(n[this.app.primaryKey]=o),e.push(n)}return this.app.dataView.filterRows(e)},getFieldsToDepopulate:function(e){return _.pickBy(e,function(t){return _.every(_.keys(t),function(e){return!t[e]})})},getRowData:function(i,t){var o=this.app.columnInfo.get(this.app.SLICKGRID_ROW_UNIQUE_ID)?i.cols[this.app.SLICKGRID_ROW_UNIQUE_ID]:{length:this.app.columnInfo.at(0)?i.cols[this.app.columnInfo.at(0).id].length:0,toLegacy:_.identity},e=o.length,n=[];i.reset=[];for(var a={},s=_.isFinite(t)?function(e){return t+Number(o.toLegacy(e))}:function(e){return o.toLegacy(e)},r=0;r<e;r++){var l={},u=s(r);n.push(u),l[this.app.SLICKGRID_ROW_UNIQUE_ID]=u,i.reset.push(l),a[u]=r}return dataColsMap=_.reduce(this.app.columnInfo.map("id"),function(e,t){return e[t]=i.cols[t],e},{}),{pks:n,pkOffsetMap:a,dataColsMap:dataColsMap}},modifyDataViewConfig:function(e){_.extend(e,{populateItem:_.bind(this.populateItem,this)})},populateFields:function(o,i,e){var n=this,a={};this.app.populatedFields=this.app.populatedFields||{},o=_.without(_.uniq(_.compact(o)),n.app.SLICKGRID_ROW_UNIQUE_ID);var s=_.reduce(o,function(e,t){return e[t]=!0,e},{});_.each(this.app.populatedFields,function(e,t){s[t]?(o=_.without(o,t),this.app.populatedFields[t][i]=!0):this.app.populatedFields[t][i]&&(this.app.populatedFields[t][i]=!1,a[t]=this.app.populatedFields[t])}.bind(this)),o=_.filter(o,function(e){return n.app.dataColsMap[e]}),_.each(o,function(e,t){n.app.populatedFields[e]=n.app.populatedFields[e]||{},n.app.populatedFields[e][i]=!0}),o.length&&(e=e?_.map(n.app.dataView.mapRowsToIds(e),function(e){return n.app.dataView.getItemById(e)}):n.app.dataView.getItems(),_.each(e,function(t){var i=n.app.pkOffsetMap[t[n.app.SLICKGRID_ROW_UNIQUE_ID]];_.each(o,function(e){t[e]=n.app.dataColsMap[e].toLegacy(i)})})),_.isEmpty(this.getFieldsToDepopulate(a))||this._debouncedDepopulateFields()},populateFilterFields:function(e){var i,o;this.app.grid&&(this.app.filteringModule.showAdvancedColumnFilters||this.app.filteringModule.showColumnFilters?(i=[],o=this,_.each(this.app.filteringModule.columnFilters,function(e,t){e&&(t=o.app.grid.getColumnIndex(t),(t=o.app.grid.getColumns()[t])&&i.push(t.field))}),_.isArray(e)&&(i=_.union(i,e)),this.populateFields(i,"filter")):this.app.filteringModule.showQuickSearch&&!_.isEmpty(this.app.filteringModule.lastSearchValue)&&this.populateFields(_.keys(this.app.dataColsMap),"search"))},populateItem:function(e){var t=this;if(e){var i=t.app.pkOffsetMap[e[t.app.SLICKGRID_ROW_UNIQUE_ID]];return t.createRowFromColumns(_.extend({},_.pick(e,t.app.SLICKGRID_ROW_UNIQUE_ID)),t.app.dataColsMap,i)}},remove:function(){this.reset()},removePopulateItemFn:function(){this.replacePopulateItemFn(_.identity)},replacePopulateItemFn:function(e){this.app.dataView&&(this.app.dataView.getOptions().populateItem=e)},reset:function(){this._debouncedDepopulateFields.flush(),this._debouncedDepopulateFields.cancel(),this.app.populatedFields=null},resetVerticalScrollValues:function(){this.lastdisplayedDataTop&&(this.app.scrollingModule.lastdisplayedDataTop=this.lastdisplayedDataTop),this.lastdisplayedDataIdTop&&(this.app.scrollingModule.lastdisplayedDataIdTop=this.lastdisplayedDataIdTop)},restorePopulateItemFn:function(){this.replacePopulateItemFn(_.bind(this.populateItem,this))},switchDataviewGetters:function(){var e=this.app.dataView;e&&e instanceof Slick.Data.DataView&&(e.getItemById_orig=e.getItemById_orig||e.getItemById,this.app.RAW_MODE?e.getItemById=function(e){e=this.dataView.getItemById_orig(e);return this.rawModeModule.populateItem.call(this.rawModeModule,e)}.bind(this.app):e.getItemById=e.getItemById_orig)}});function Oe(e){this.app=e,this.initialize()}_.extend(Oe.prototype,C.Events,{hasNaturalOrder:!0,initialize:function(){this.listenTo(this.app.viewModel,"change:Basics.SortColumn change:Basics.SortOrder change:ColumnsConfiguration",_.after(3,this.onSortingConfigChanged))},generateSortFunctions:function(d){var c=this.app.columnInfo,p=this.app.sortFunctions,h=this.app.sortColumnsForCaseInsensitiveSort||[],g=this;return _.map(d,function(e,t){var n,i,o,a=d.length,s=e.sortAsc?1:-1,r=e.sortCol.field,a=t===a-1,l=_.includes(h,r)?function(e){return(e[r]||"").toLowerCase()}:function(e){return e[r]},u=p&&_.isFunction(p[t])?_.wrap(p[t],function(e,t,i){return e(l(t),l(i),s)}):(u=c.get(r))?(i=y.getComparator(u.get("kdbType"),l),function(e,t){return i(l(e),t)*s}):function(){return 0};return a&&(o=g.app.SLICKGRID_ROW_UNIQUE_ID,n=function(e){return e[o]},u=_.wrap(u,function(e,t,i){var o=e(t,i);return 0===o&&(e=g.app.dataView,t=n(t),i=n(i),null!=t&&null!=i&&(o=e.getIdxById(t)>e.getIdxById(i)?1:-1)),o})),u})},initDefaultSortings:function(){var o=this,e=this.app.sortColumns;e&&(this.app.sortColumns=null,this.sortingSpec=_.compact(_.map(e,function(t){var e=null,i=_.find(o.app.columnsConfig,function(e){return e.field===t.sortCol});return e=i&&_.find(o.app.viewModel.get("ColumnsConfiguration"),{Field:t.sortCol})?{columnId:i.id,sortAsc:t.sortAsc}:e})))},isInNaturalOrder:function(){return this.hasNaturalOrder},isSortingSpecEmpty:function(){return!(this.sortingSpec&&this.sortingSpec.length)},modifyViewStates:function(e){var t=this.app.api.getPropertyMeta("Basics.SortColumn"),i=this.app.api.getPropertyMeta("Basics.SortOrder"),o="";t&&"viewstate"===t.type&&i&&"viewstate"===i.type&&(e&&e[0]&&(o=e[0].sortCol.field,e=e[0].sortAsc?"ascending":"descending",this.app.viewModel.set("Basics.SortOrder",e,{silent:!0}),this.app.api.setProperty("Basics.SortOrder",e)),this.app.viewModel.set("Basics.SortColumn",o,{silent:!0}),this.app.api.setProperty("Basics.SortColumn",o))},onSortingConfigChanged:function(){this.app.sortColumns||(this.app.viewModel.get("Basics.SortColumn")?(this.app.sortColumns=[{sortCol:this.app.viewModel.get("Basics.SortColumn"),sortAsc:"ascending"===this.app.viewModel.get("Basics.SortOrder").toLocaleLowerCase()}],this.app.grid&&(this.initDefaultSortings(),this.triggerSorting())):this.app.grid&&(this.sortingSpec=[{columnId:"nonexistentColumn123"}],this.triggerSorting()))},onData:function(){this.pendingSortConfig&&(this.sortSlickgrid(this.pendingSortConfig),this.pendingSortConfig=null)},remove:function(){this.stopListening(),this.dataChangeSet=null},resetSortingSpec:function(){this.sortingSpec=null},setDataChangeSet:function(e){this.dataChangeSet=e,this.positionMap=null},sortSlickgrid:function(a,e){var o=this;if(a&&0===(a=_.filter(a,"sortCol")).length&&o.dataChangeSet)return o.positionMap=o.positionMap||_.reduce(o.dataChangeSet.items(),function(e,t,i){return e[t[o.app.SLICKGRID_ROW_UNIQUE_ID]]=i,e},{}),void(_.isEmpty(o.positionMap)||(o.app.dataView.sort(function(e,t){return o.positionMap[e[o.app.SLICKGRID_ROW_UNIQUE_ID]]-o.positionMap[t[o.app.SLICKGRID_ROW_UNIQUE_ID]]}),o.hasNaturalOrder=!0));var s=this.generateSortFunctions(a);o.hasNaturalOrder=!1,o.app.dataView.sort(function(e,t){for(var i,o=0,n=a.length;o<n;o++)if(0!==(i=s[o](e,t)))return i;return 0},void 0,e)},storeSortColumns:function(){var i,o=this.app.grid;o&&(i=o.getColumns(),this.app.sortColumns=_.compact(_.map(o.getSortColumns(),function(e){var t=o.getColumnIndex(e.columnId);return void 0===t?null:{sortCol:i[t].field,sortAsc:e.sortAsc}})))},storeSortingSpec:function(){this.app.grid&&this.app.api.getPropertyMeta&&(this.sortingSpec=this.app.grid.getSortColumns())},subscribeToSortEvent:function(e,t){var n=this;n.app.grid.onSort.subscribe(function(e,t){var i,o=t.multiColumnSort?t.sortCols:[{sortAsc:t.sortAsc,sortCol:t.sortCol}];n.app.pagerModule&&_.isFunction(n.app.pagerModule.setSortConfig)&&n.app.model&&n.app.model.get("_serverPaging")?(i={},_.each(t.sortCols,function(e){i[e.sortCol.field]=e.sortAsc}),n.app.viewModel.isLazyDataLoadingOn()?n.app.api.page(n.app.model,{_pageSort:i}):(n.pendingSortConfig=o,n.app.pagerModule.setSortConfig(i),n.app.highlightingModule.processMinMaxHighlighting())):n.app.filteringModule.isProcessedServerSide&&!n.forceResort?n.sortSlickgrid(o,!0):(n.app.RAW_MODE&&n.app.rawModeModule.populateFields(_.map(o,function(e){return e.sortCol.field}),"sort"),n.sortSlickgrid(o),n.app.highlightingModule.processMinMaxHighlighting()),n.app.api.getPropertyMeta&&n.modifyViewStates(o)})},triggerSorting:function(){var i=this,o=!1;i.sortingSpec&&i.sortingSpec.length&&(i.app.grid.setSortColumns(i.sortingSpec),i.sortingSpec=_.map(i.sortingSpec,function(t){var e=_.find(i.app.columnsConfig,function(e){return e.id===t.columnId});return void 0===e?o=!0:t.sortCol={field:e.field},t}),o&&(i.sortingSpec=[]),i.app.grid.onSort.notify({multiColumnSort:!0,sortCols:i.sortingSpec},null,i.grid),i.sortingSpec=null)}});function Ve(e){this.app=e,this.initialize()}var Ne;_.extend(Ve.prototype,C.Events,{initialize:function(){this.listenTo(this.app.viewModel,"change:Basics.ScrollValueV",this.onScrollValueChanged),this.listenTo(this.app,"model-unset",this.onModelUnset),this.listenToOnce(this.app,"data-processed",this.onDataProcessed)},handleScrollInfo:function(e){var t,i,o=0,n=this;n.lastRowDisplayed=!1,0===e.scrollTop?(n.lastdisplayedDataTop=void 0,n.lastdisplayedDataIdTop=void 0):(i=n.app.grid.getViewport(),t=n.app.grid.getData(),n.lastdisplayedDataTop=void 0,_.find(_.range(i.top,i.bottom+1),function(e){e=t.getItem(e);if(!(e instanceof Slick.NonDataRow))return n.lastdisplayedDataTop=e,!0}),n.lastdisplayedDataTop&&(n.lastdisplayedDataIdTop=n.lastdisplayedDataTop[n.app.SLICKGRID_ROW_UNIQUE_ID]),i.bottom>t.getLength()&&(n.lastRowDisplayed=!0),o=i.top),this.isViewState_ScrollValueV()&&(this.manualSet=!0,this.app.api.setProperty("Basics.ScrollValueV",o),this.manualSet=!1),n.app.RAW_MODE&&n.app.rawModeModule.cacheScrollValues(n.lastdisplayedDataTop,n.lastdisplayedDataIdTop,e.scrollLeft)},isViewState_ScrollValueV:function(){var e,t=!1;return t=this.app.api.getPropertyMeta?!(!(e=this.app.api.getPropertyMeta("Basics.ScrollValueV"))||"viewstate"!==e.type):t},onDataProcessed:function(e){e?this.listenToOnce(this.app,"data-processed",this.onDataProcessed):void 0!==this.pendingScrollValueV&&(this.pendingScrollValueV=void 0,this.onScrollValueChanged())},onModelUnset:function(){this.pendingScrollValueV=void 0},onScrollValueChanged:function(){var e;this.isViewState_ScrollValueV()&&!this.app.api.getProperty("Selection.FollowSelectedValue")&&(this.app.grid?this.manualSet||void 0!==(e=this.parseInt_ScrollValueV())&&this.scrollTo(e):void 0!==(e=this.parseInt_ScrollValueV())&&(this.pendingScrollValueV=e))},parseInt_ScrollValueV:function(){var e=parseInt(this.app.api.getProperty("Basics.ScrollValueV"),10);return e=_.isNaN(e)?void 0:e},remove:function(){this.stopListening()},scrollTo:function(e,t){t&&(t=this.app.grid.getViewport(),e=Math.max(0,e-Math.floor((t.bottom-t.top)/2))),this.app.grid.scrollRowToTop(e)},subscribeToScrollEvent:function(){var i=this;i.app.grid.onScroll.subscribe(function(e,t){i.app.sparklinesManager.refresh(),i.app.highlightingModule.processMinMaxHighlighting_debouncedMore(),i.handleScrollInfo(t)})},updateScrollPosition:function(){var i,o=this;this.app.model.get("_forceReset")&&(o.lastRowDisplayed?o.app.grid.scrollRowIntoView(999999999999,!1):o.lastdisplayedDataTop&&o.app.sortingModule.isSortingSpecEmpty()&&_.find(o.app.grid.getData().getItems(),function(e,t){return i=t,e[o.app.SLICKGRID_ROW_UNIQUE_ID]===o.lastdisplayedDataIdTop})&&o.app.grid.scrollRowToTop(i))}}),(Ne=jQuery).extend(!0,window,{Slick:{CheckboxSelectColumn:function(e){var d,c,t=new Slick.EventHandler,p={},h=Ne.extend(!0,{},{columnId:"_checkbox_selector",cssClass:null,toolTip:"Select/Deselect All",width:30},e);function i(e,t){for(var i,o=d.getSelectedRows(),n={},a=[],s=0;s<o.length;s++)n[i=o[s]]=!0,n[i]!==p[i]&&(a.push(i),delete p[i]);for(s in p)a.push(s);p=n;var r,l,u=d.getColumnIndex(h.columnId);_.each(a,function(e){d.updateCell(e,u)}),c&&(r=(l=d.getData()).extractIds(g()),l=l.selectionSyncHelper.getSelectedIds(),r.length===_.intersection(r,l).length?d.updateColumnHeader(h.columnId,"<input type='checkbox' checked='checked'>",h.toolTip):d.updateColumnHeader(h.columnId,"<input type='checkbox'>",h.toolTip))}function o(e,t){32==e.which&&d.getColumns()[t.cell].id===h.columnId&&(d.getEditorLock().isActive()&&!d.getEditorLock().commitCurrentEdit()||a(t.row),e.preventDefault(),e.stopImmediatePropagation())}function n(e,t){if(d.getColumns()[t.cell].id===h.columnId&&(Ne(e.target).is(":checkbox")||Ne(e.target).find(":checkbox").length)){if(d.getEditorLock().isActive()&&!d.getEditorLock().commitCurrentEdit())return e.preventDefault(),void e.stopImmediatePropagation();a(t.row),e.stopPropagation(),e.stopImmediatePropagation()}}function a(t){var e=new Slick.EventData;e.rememberHidden=!0,p[t]?d.setSelectedRows(Ne.grep(d.getSelectedRows(),function(e){return e!=t}),void 0,e):d.setSelectedRows(c?d.getSelectedRows().concat(t):[t],void 0,e)}function s(e,t){if(t.column.id==h.columnId&&Ne(e.target).is(":checkbox")){if(d.getEditorLock().isActive()&&!d.getEditorLock().commitCurrentEdit())return e.preventDefault(),void e.stopImmediatePropagation();var i=d.getData(),t=i.extractIds(g());Ne(e.target).is(":checked")?i.selectionSyncHelper.addSelectedIds(t):i.selectionSyncHelper.removeSelectedIds(t),d.focus(),e.stopPropagation(),e.stopImmediatePropagation()}}function g(){for(var e,t=[],i=0,o=d.getDataLength();i<o;i++)if((e=d.getDataItem(i))instanceof Slick.NonDataRow){if(e instanceof Slick.Group&&e.collapsed)for(var n=0,a=e.rows.length;n<a;n++)t.push(e.rows[n])}else t.push(e);return t}function r(e,t,i,o,n){return n?((n=document.createElement("input")).setAttribute("type","checkbox"),p[e]&&n.setAttribute("checked","checked"),n):null}Ne.extend(this,{init:function(e){(c=(d=e).getOptions().multiSelect)||d.updateColumnHeader(h.columnId,"",""),t.subscribe(d.onSelectedRowsChanged,i).subscribe(d.onClick,n).subscribe(d.onHeaderClick,s).subscribe(d.onKeyDown,o)},destroy:function(){t.unsubscribeAll()},getColumnDefinition:function(){return{id:h.columnId,name:"<input type='checkbox'>",toolTip:h.toolTip,field:"sel",width:h.width,resizable:!1,sortable:!1,cssClass:h.cssClass,formatter:r}}})}}});function Le(e){this.app=e,this.hasActions=!1,this.initialize()}_.extend(Le.prototype,C.Events,{PROP_SELECTION_COLUMN:"Selection.RowSelectionColumn",initialize:function(){this.listenTo(this.app.viewModel,"change:"+this.PROP_SELECTION_COLUMN,this.onChange_SelectionColumn),this.listenTo(this.app.viewModel,"change:Selection.SelectedValue",this.onChange_SelectedValue),this.listenTo(this.app.viewModel,"change:Selection.Mode",this.onChange_SelectionMode),this.listenTo(this.app.viewModel,"change:Selection.CheckboxAlignment",this.onChange_CheckboxAlignment)},convertValueIfNecessary:function(e){return y.isKDBTemporal(e)?y.convertKDBTemporalToMoment(e).toDashString():e},doActions:function(r,l,u,d){var c,p,h=this,e=h.app.viewModel.get("Selection.Actions"),g=h.app.viewModel.get("Selection.DefaultFallbackOnDeselect"),f=this.app.dataView.selectionSyncHelper,m=[];function v(e){return h.app.api.getPropertyMeta("Selection.Actions."+e+".Target")}0===(c=f?f.getSelectedIds():h.app.grid.getSelectedRows()).length&&0!==u.indexOf("Mouse")&&(r={}),_.each(e,function(e,t){var i,o,n=!1,a=e.Current,s=e.TriggerColumn||"";e.Trigger===u&&("*"===s?n=!0:"<div></div>"!==d&&-1===d.indexOf("disable-action")&&(n=s===l)),n&&(s=!1,n={_PropertyIndex:t},"map"===e._Type&&("Click"===u&&(o=v(t))&&"viewstate"===o.type&&"list"===o.viewstateType&&(p=p||(f?_.map(c,h.app.dataView.getItemById.bind(h.app.dataView)):h.getDataRowsWithoutGroups(c)),s=!0),g&&0===c.length&&0!==u.indexOf("Mouse")?(o=o||v(t))&&"viewstate"===o.type&&(i=o.defaultValue):("*"===a&&(a=l),i=s?_.chain(p).map(a).map(h.convertValueIfNecessary).value():_.has(r,a)?h.convertValueIfNecessary(r[a]):a),n.Current=i),m.push(_.extend({},e,n)))}),h.app.api.doActions(m,"Selection.Actions")},getCurrentSelectedRanges:function(){var e=this.app.grid.getSelectionModel().getSelectedRanges();return _.map(e,function(e){return[e.fromRow,e.toRow,e.fromCell,e.toCell].join(" ")})},getDataRowsWithoutGroups:function(e){var i=this.app.dataView.getItem.bind(this.app.dataView);return _.reduce(e,function(e,t){t=i(t);return!t||t instanceof Slick.NonDataRow||e.push(t),e},[])},getSelectedRowObject:function(){return this.selectedRowObject},getSelectedRowObjects:function(){return this.selectedRowObjects},initCheckBoxColumn:function(e){var t=this.app.viewModel.get("Selection.CheckboxAlignment");"none"!==t&&(this.checkboxSelector=new Slick.CheckboxSelectColumn({cssClass:"slick-cell-checkboxsel",width:0,minWidth:30}),e["right"===t?"push":"unshift"](this.checkboxSelector.getColumnDefinition()))},onAction:function(e,t,i){var o,n=this.app.grid;!this.hasActions&&"Double Click"!==e||this.app.editorModule&&this.app.editorModule.isEditable||(null===(o=n.getCellFromEvent(t))&&_.has(i,"row")&&_.has(i,"cell")&&(o=i),(t=this.app.dataView.getItem(o.row))instanceof Slick.NonDataRow||(i=n.getColumns()[o.cell]).selectable&&(i=i.field,o=n.getCellNode(o.row,o.cell).innerHTML,this.app.api.doActions&&this.doActions(t,i,e,o),"Double Click"===e&&t&&this.app.trigger("dataGridRowDoubleClicked",t)))},onChange_CheckboxAlignment:function(){this.onChange_SelectionMode()},onChange_SelectedValue:function(){this.app.skipGridGeneration||this.setSelectedRows_ignoreCallback_onSelectedRowsChanged()},onChange_SelectionColumn:function(){var e;this.app.skipGridGeneration||this.app.RAW_MODE&&(e=this.app.viewModel.get(this.PROP_SELECTION_COLUMN),this.app.rawModeModule.populateFields([e],"selection"))},onChange_SelectionActions:function(){var e=this.app.viewModel.get("Selection.Actions");this.hasActions=!(!e||!e.length)},onChange_SelectionMode:function(){this.app.skipGridGeneration||this.app.generateDataGridFromReceivedData()},onKeyDown:function(e,t){this.hasActions&&(this.lastSelectedRanges=this.getCurrentSelectedRanges())},onKeyDownDone:function(e,t){this.hasActions&&_.includes([40,38,34,33,39,37,9],e.which)&&!_.isEqual(this.getCurrentSelectedRanges(),this.lastSelectedRanges)&&(e.target=this.app.grid.getActiveCellNode(),this.onAction("Click",e))},registerGridSelectionModel:function(){var e,r=this,t=r.app.viewModel.get("Selection.Mode"),l="Selection.SelectedValue",i=r.app.grid;_.includes(["Single Row","Multi Row"],t)?(e=new Slick.RowSelectionModel,i.onSelectedRowsChanged.subscribe(function(e,t){r.ignoreCallback_onSelectedRowsChanged||r.userClickSelection||0===i.getSelectedRows().length&&0===r.app.dataView.selectionSyncHelper.getSelectedIds().length&&null!=r.selectedRowObject&&(r.selectedRowObject=null,r.trigger_selectedRowChanged(),r.trigger_selectedRowsChanged([]))}),this.app.dataView.syncGridSelection(i,!0,!0).subscribe(function(e,t){var i,o,n;r.ignoreCallback_onSelectedRowsChanged||r.userClickSelection||(i=t.ids,o=r.app.api.getPropertyMeta(l),t=r.app.viewModel.get("Selection.RowSelectionColumn"),r.selectedRowObject=0===i.length?null:r.app.dataView.getItemById(_.last(i)),r.trigger_selectedRowChanged(),r.trigger_selectedRowsChanged(i),n=0<i.length?o&&"list"===o.viewstateType?_.chain(i).map(r.app.dataView.getItemById.bind(r.app.dataView)).map(t).map(r.convertValueIfNecessary).value():(n=r.selectedRowObject[t],r.convertValueIfNecessary(n)):(n="",o&&(r.app.viewModel.get("Selection.DefaultFallbackOnDeselect")?n=o.defaultValue:"list"===o.viewstateType&&(n=[])),r.convertValueIfNecessary(n)),r.userClickSelection=!0,r.ignoreCallback_setSelectedRows=!0,r.app.api.setProperty(l,n),r.ignoreCallback_setSelectedRows=!1,r.userClickSelection=!1)}.bind(this))):_.includes(["Cell","Area"],t)?(e=new Slick.CellSelectionModel({singleCellMode:"Cell"===t})).onSelectedRangesChanged.subscribe(function(e,t){var i,o,n=r.app.viewModel.get("Selection.RowSelectionColumn"),a=[],s=[];t&&t[0]&&r.app.dataView&&(t=t[0],i=_.range(t.fromRow,t.toRow+1),t=_.range(t.fromCell,t.toCell+1),i=r.getDataRowsWithoutGroups(i),o=_.map(t,function(e){return r.app.grid.getColumns()[e].field}),_.each(i,function(t){_.each(o,function(e){a.push(t[e])}),s.push(t[n])}),r.setViewstateProperty("Selection.SelectedField",o),r.setViewstateProperty("Selection.SelectedCellValue",a),r.ignoreCallback_setSelectedRows=!0,r.setViewstateProperty(l,s),r.ignoreCallback_setSelectedRows=!1)}):"None"===t&&(e=new function(e){var t=[];$.extend(this,{init:_.noop,destroy:_.noop,getSelectedRanges:function(){return t},setSelectedRanges:_.noop,onSelectedRangesChanged:new Slick.Event})}),"none"!==r.app.viewModel.get("Selection.CheckboxAlignment")&&i.registerPlugin(this.checkboxSelector),i.onClickDone.subscribe(_.bind(this.onAction,this,"Click")),i.onDblClick.subscribe(_.bind(this.onAction,this,"Double Click")),i.onMouseEnter.subscribe(_.bind(this.onAction,this,"Mouse In")),i.onMouseLeave.subscribe(_.bind(this.onAction,this,"Mouse Out")),i.onKeyDown.subscribe(this.onKeyDown.bind(this)),i.onKeyDownDone.subscribe(this.onKeyDownDone.bind(this)),i.setSelectionModel(e)},remove:function(){this.stopListening()},setSelectedRows_ignoreCallback_onSelectedRowsChanged:function(){this.ignoreCallback_onSelectedRowsChanged=!0,this.setSelectedRows(),this.ignoreCallback_onSelectedRowsChanged=!1},setSelectedRows:function(){var s,r,l,t,e,i,u;!this.ignoreCallback_setSelectedRows&&this.app.grid&&this.app.api.getPropertyMeta&&(s=this.app.dataView,r=[],i=(l=this).app.viewModel.get("Selection.Mode"),u=this.app.viewModel.get("Selection.RowSelectionColumn"),_.includes(["Single Row","Multi Row"],i)&&(e=this.app.dataView.selectionSyncHelper,void 0===(i=(l.app.api.getPropertyMeta("Selection.SelectedValue")||{value:void 0}).value)||_.isArray(i)||(i=[i]),_.each(i,function(e){var t,i;if(void 0!==e)for(t=0,i=s.getItems().length;t<i;t++){var o,n,a=(n=s.getItemByIdx(t))[u];o=!1,y.isKDBTemporal(a)?o=y.convertKDBTemporalToMoment(a).toDashString()==e:(a==e||_.isArray(e)&&_.includes(e,a))&&(o=!0),o&&r.push(n[l.app.SLICKGRID_ROW_UNIQUE_ID])}}),0!==r.length&&_.isEqual(e.getSelectedIds(),r)||this.app.grid.resetActiveCell(),e.setSelectedIds(r),0<r.length&&this.app.viewModel.get("Selection.FollowSelectedValue")&&!this.userClickSelection&&this.app.scrollingModule&&(t=void 0,_.find(r,function(e){return void 0!==(t=s.getRowById(e))}),void 0!==t&&this.app.scrollingModule.scrollTo(t,!0))))},setViewstateProperty:function(e,t){var i=this.app.api.getPropertyMeta?this.app.api.getPropertyMeta(e):null;i&&"viewstate"===i.type&&(t="list"===i.viewstateType?_.map(_.isArray(t)?t:[t],this.convertValueIfNecessary):this.convertValueIfNecessary(_.isArray(t)&&t.length?t[0]:""),this.app.api.setProperty(e,t))},trigger_selectedRowChanged:function(){this.app.trigger("selectedRowChanged",this.selectedRowObject)},trigger_selectedRowsChanged:function(e){e=_.compact(_.map(e,this.app.dataView.getItemById.bind(this.app.dataView)));this.selectedRowObjects=e,this.app.trigger("selectedRowsChanged",e)}});function Ae(e){this.app=e,this.initialize()}_.extend(Ae.prototype,C.Events,{initialize:function(){this.onMouseMove=this.onMouseMove.bind(this),this.onMouseEnter=this.onMouseEnter.bind(this),this.onMouseLeave=this.onMouseLeave.bind(this)},initRowTooltip:function(){var e=this.app.grid;this.remove_onMouseMoveHandler(),e.onMouseEnter.subscribe(this.onMouseEnter),e.onMouseLeave.subscribe(this.onMouseLeave)},onMouseEnter:function(e){var t,i,o=this.app.grid;"none"!==this.app.viewModel.get("Tooltip.Position")&&(i=o.getCellFromEvent(e))&&(t=this.app.dataView.getItem(i.row))&&!t.__group&&(t=_.omit(t,"_rowIndex","idProperty"),i=this.app.grid.getColumns()[i.cell].field,t.thisField=i,t.thisRawValue=t.thisValue=t[i],this.app.viewModel.get("Tooltip.Template"),this.tooltip=this.app.api.setTooltip({data:t,text:this.app.viewModel.get("Tooltip.Template")}),this.remove_onMouseMoveHandler(),$(document).mousemove(this.onMouseMove))},onMouseLeave:function(e){this.tooltip&&(this.app.api.removeTooltip(),delete this.tooltip),this.remove_onMouseMoveHandler()},onMouseMove:function(e){var t,i,o,n,a,s=this.app.grid,r=this.app.viewModel.get("Tooltip.Position"),l=s.getCellFromEvent(e);if(l){switch(r){case"cursor":t=e.clientY+10,i=e.clientX+20;break;case"right":case"left":n=s.getCellNode(l.row,l.cell),t=$(n).offset().top,i=(n=(a=$(s.getContainerNode())).offset()).left+a.width(),o=$("body").width()-n.left}this.tooltip.updatePosition(_.extend({top:t},"left"===r?{right:o}:{left:i}))}else this.onMouseLeave()},remove:function(){this.$tooltipDiv&&this.$tooltipDiv.remove(),this.remove_onMouseMoveHandler(),this.stopListening()},remove_onMouseMoveHandler:function(){$(document).off("mousemove",this.onMouseMove)}});function Pe(e){this.app=e,this.initialize()}var Be={COLOR_SCHEMAS:{},_clamp:function(e,t,i){return i<e?i:e<t?t:e},_generateColorSchema:function(e){for(var t=[],i=Be._hexToRgb(e),o=i[0],n=i[1],a=i[2],s=0;s<10;s++)t[s]="rgb("+(o-10*s)+","+(n-10*s)+","+(a-10*s)+")";return t.reverse(),Be.COLOR_SCHEMAS[e]=t},getColor:function(e,t){return e=e.replace("#",""),(Be.COLOR_SCHEMAS[e]||Be._generateColorSchema(e))[t]},_hexToRgb:function(e){return[parseInt(e.substr(0,2),16),parseInt(e.substr(2,2),16),parseInt(e.substr(4,2),16)]},interpolateColor:function(e,t,i,o){for(var i=(i-t)/(e.length-1),t=this._clamp((o-t)/i,0,e.length-1),i=e[Math.floor(t)].color.replace("#",""),e=e[Math.ceil(t)].color.replace("#",""),n=this._hexToRgb(i),a=this._hexToRgb(e),s=t-Math.floor(t),r=n.slice(),l=0;l<3;l++)r[l]=Math.round(r[l]+s*(a[l]-n[l]));return"#"+this._rgbToHex(r)},_rgbToHex:function(e){return((1<<24)+(e[0]<<16)+(e[1]<<8)+e[2]).toString(16).slice(1)}};Pe.PREVIOUS_VALUE="previous value",_.extend(Pe.prototype,C.Events,{isPreviousValueUsedInAnyRule:!1,displayArrowsOrHighlightOnChange:!1,initialize:function(){this.clearHighlightRuleChains(),this.listenTo(this.app.viewModel,"change:HighlightRules",this.onChange_HighlightRules),this.listenTo(this.app.viewModel,"change:ColumnsConfiguration",this.onChange_ColumnsConfiguration)},clearHighlightRuleChains:function(){this.highlightRuleChains={}},evalHighlight_Equality:function(e,t,i,o){e&&null!==i&&i===o&&(t["border-color"]=e,t["box-shadow"]="inset 0px 0px 1px 1px rgba(0,0,0, 0.8)")},evalHighlight_Range:function(e,t,i,o,n,a){e&&null!==i&&(o=n===o?1:(i-o)/(n-o),o=Math.round(9*o),o=Be.getColor(e,o=a?9-o:o),t["background-color"]=o)},getFieldsUsedInRulesWithPreviousValue:function(){if(_.includes(this.fieldsUsedInRulesWithPreviousValue,"<this>")){var i=_.without(this.fieldsUsedInRulesWithPreviousValue,"<this>"),e=_.compact(_.map(_.filter(this.app.grid.getColumns(),function(e){return e._dashboardConfig}),"field"));return _.each(_.filter(this.app.viewModel.get("HighlightRules"),{ConditionSource:"<this>",ConditionValue:Pe.PREVIOUS_VALUE,RuleType:"discrete",Enabled:!0}),function(t){_.each(e,function(e){x.isFieldMatched(t.Target,e)&&i.push(e)})}),_.uniq(i)}return this.fieldsUsedInRulesWithPreviousValue},getHighlightBox:function(e){var t=e.find(">.highlightBox");return t.length?t.removeAttr("style"):(t=$('<div class="highlightBox"></div>')).prependTo(e),t},getHighlightingFields:function(){var e=_.uniq(_.map(this.getTrackedColumns(function(e){return e.ShowArrowsOnChange||e.HighlightChanges}),"field"));return e=_.uniq(e.concat(this.getFieldsUsedInRulesWithPreviousValue()))},getHighlightRuleChain:function(t){var e=this.highlightRuleChains[t];return e||(e=this.app.viewModel.get("HighlightRules"),(e=_.filter(e,function(e){return e.Enabled&&!!e.ConditionSource&&x.isFieldMatched(e.Target,t)})).reverse(),this.highlightRuleChains[t]=e),e},getTrackedColumns:function(o,n){var a=this.app.columnInfo;return _.filter(this.app.grid.getColumns(),function(e){var t=e._dashboardConfig,i=!1;return t&&(i=o(t),n&&i&&(t=e.field,(e=a.get(t))&&(n[t]=7===e.get("kdbType")))),i})},highlightCachedChanges:function(){console.log("IK REMOVE THIS CODE highlightCachedChanges")},hasPreviousValueInAnyRule:function(){return this.isPreviousValueUsedInAnyRule},isValidHighlightRulesConfig:function(){var e=this.app.viewModel.get("HighlightRules");return e&&(0===e.length||_.every(e,function(e){var t=e.Target&&e.ConditionSource,i=e.ConditionOperator&&void 0!==e.ConditionValue||_.includes(["Fill Left-to-Right","Fill Right-to-Left"],e.ConditionOperator);return!e.Enabled||t&&i}))},getAffectedIndicies:function(e,l){var u=[],d=this.app.previousValuesMap,c=this.app.atomizeTemporal,p=this.app.columnInfo,h=this.app.SLICKGRID_ROW_UNIQUE_ID;return _.each(e,function(e){if(l&&l.length)for(var t=0;t<l.length;t++){var i,o,n,a=!1,s=l[t],r=s.ConditionSource;if("gradient"===s.RuleType||"<this>"===r?a=!0:(i=s.ConditionValue,o=s.ConditionOperator,n=e[r],(s=p.get(r))&&7===s.get("kdbType")&&_.isString(n)&&(n=parseInt(n,10)),i===Pe.PREVIOUS_VALUE?(s=d[c(e[h])])&&(r=s[r],n&&n.class&&(n=Q._convertKdbValueforComparison(n)),r&&r.class&&(r=Q._convertKdbValueforComparison(r)),a=Q._getConditionResult(n,r,o)):a=n&&n.class?Q._getConditionResult(Q._convertKdbValueforComparison(n),i,o):Q._getConditionResult(n,i,o)),a)return void u.push(e[h])}}),this.app.dataView.mapIdsToRows(u)},onChange_ColumnsConfiguration:function(){this.displayArrowsOrHighlightOnChange=_.some(this.app.viewModel.get("ColumnsConfiguration"),function(e){return e.ShowArrowsOnChange||e.HighlightChanges})},onChange_HighlightRules:function(e){var t,i;this.setupStateForRulesWithPreviousValue(e.get("HighlightRules")),!this.app.skipGridGeneration&&this.app.grid&&(i=(t=e.changedAttributes())?_.keys(t.HighlightRules):[],t=_.pick(e.previousAttributes(),_.map(i,function(e){return"HighlightRules."+e})),e=_.pick(e.attributes,_.map(i,function(e){return"HighlightRules."+e})),i=this.app.grid.getRenderedRange(),i=this.app.dataView.mapRowsToIds(_.range(i.top,i.bottom+1)),_.remove(i,_.isUndefined),i=_.map(i,this.app.dataView.getItemById.bind(this.app.dataView)),e=this.getAffectedIndicies(i,(t.HighlightRules||[]).concat(e.HighlightRules||[])),this.clearHighlightRuleChains(),this.app.grid.invalidateRows(e),this.app.grid.render(),this.app.sparklinesManager.refresh(),this.processMinMaxHighlighting())},prepareValue:function(e,t){return e=void 0!==(e=t&&_.isString(e)?parseInt(e,10):e).i?e.i:e},processMinMaxHighlighting:function(){var e,h,g,f,t,m=this.app.grid,i=this.app.dataView,v={};m&&(this.app.filteringModule.refreshDataviewIfFilterNotEmpty(),0!==(e=this.getTrackedColumns(function(e){var t=this.app.columnInfo.get(e.Field);return t&&11!==t.get("kdbType")&&(e.HighlightMinValueColor||e.HighlightMaxValueColor||e.RangeHighlightColor)}.bind(this),v)).length&&(this.app.RAW_MODE&&this.app.rawModeModule.populateFields(_.map(e,function(e){return e.name}),"minmax"),0!==(h=i.getItems()).length&&(t=m.getViewport(),g=_.range(t.top,t.bottom+1),f=_.map(i.mapRowsToIds(g),function(e){return i.getItemById(e)}),_.each(e,function(e){for(var t,o=m.getColumnIndex(e.id),n=e.field,e=e._dashboardConfig,a=e.HighlightMinValueColor,s=e.HighlightMaxValueColor,r=e.RangeHighlightColor,l=e.IsRangeHighlightColorInverted||!1,u=Number.MAX_VALUE,d=Number.MIN_VALUE,c=v[n],i=0,p=h.length;i<p;i++)null!=(t=h[i][n])&&((t=this.prepareValue(t,c))<u&&(u=t),d<t&&(d=t));_.each(f,function(e,t){var i;e&&null!=(i=e[n])&&(i=this.prepareValue(i,c),this.evalHighlight_Equality(a,e={},i,u),this.evalHighlight_Equality(s,e,i,d),this.evalHighlight_Range(r,e,i,u,d,l),_.isEmpty(e)||(t=g[t],(t=m.getCellNode(t,o))&&this.getHighlightBox($(t)).css(e)))}.bind(this))}.bind(this)))))},processMinMaxHighlighting_debounced:function(){(this.processMinMaxHighlighting_debounced=_.debounce(this.processMinMaxHighlighting.bind(this),10))()},processMinMaxHighlighting_debouncedMore:function(){(this.processMinMaxHighlighting_debouncedMore=_.debounce(this.processMinMaxHighlighting.bind(this),100))()},processNumberDiffHighlighting:function(){var t,i,g=this.app.grid,o=this.app.dataView,n=this.app.previousValuesMap,f=this.app.diffValuesMap,a=this.app.atomizeTemporal,m={};g&&this.displayArrowsOrHighlightOnChange&&0!==(t=this.getTrackedColumns(function(e){return e.ShowArrowsOnChange||e.HighlightChanges},m)).length&&(i=this.app.getRowIxRange(),_.each(o.mapRowsToIds(i),function(d,e){var c,p,h;void 0!==d&&(h=i[e],d=a(d),c=o.getItemById(d),(p=n[d])&&_.each(t,function(e){var t,i,o=g.getColumnIndex(e.id),n=e.field,a=e._dashboardConfig,s=a.Precision,r=a.HighlightChangeDuration,l=c[n],u=p[n];m[n]&&_.isString(u)&&_.isString(l)&&(u=parseInt(u,10),l=parseInt(l,10)),_.isNumber(u)&&_.isNumber(l)&&(u=this.roundToPrecision(u,s),e=(l=this.roundToPrecision(l,s))===u?void 0:u<l,a.ShowArrowsOnChange&&void 0===e&&f&&f[d]&&(u=f[d][n],m[n]&&_.isString(u)&&(u=parseInt(u,10)),_.isNumber(u)&&(i=l===(u=this.roundToPrecision(u,s))?void 0:u<l)),(l=_.some([e,i],_.negate(_.isUndefined)))&&(t=g.getCellNode(h,o))&&(a.HighlightChanges&&void 0!==e&&this.setBackgroundColorInCell(t,r,e),a.ShowArrowsOnChange&&l&&this.showArrowInCell(t,void 0===e?i:e)))}.bind(this)))}.bind(this)))},remove:function(){this.stopListening()},roundToPrecision:function(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)},setBackgroundColorInCell:function(e,t,i){e.dataset.tid&&clearTimeout(e.dataset.tid),e.style.backgroundColor=i?"green":" red",e.dataset.tid=setTimeout(function(){e.style.backgroundColor=""},t)},setupStateForRulesWithPreviousValue:function(e){var t=[];_.each(e,function(e){e.Enabled&&"discrete"===e.RuleType&&e.ConditionValue===Pe.PREVIOUS_VALUE&&t.push(e.ConditionSource)}.bind(this)),this.fieldsUsedInRulesWithPreviousValue=_.uniq(t),this.isPreviousValueUsedInAnyRule=0<this.fieldsUsedInRulesWithPreviousValue.length},showArrowInCell:function(e,t){var i=document.createElement("i");i.className="fa fa-caret-"+(t?"up":"down"),e.appendChild(i)},showArrowsOrHighlightOnChange:function(){return this.displayArrowsOrHighlightOnChange}});function Ge(e){this.app=e,this.api=e.api,this.initialize()}_.extend(Ge.prototype,{initialize:function(){_.defaults(this.api,{getTemplateViewStates:function(){return{}},subscribeTemplateViewStates:function(e,t){t&&t({})},unsubscribeTemplateViewStates:_.noop})},remove:function(){this.unsubscribeViewstateSubscribers()},subscribeViewstateSubscribers:function(e){_.each(e,function(o){var e=_.get(o,"_dashboardConfig.Template","");$.trim(e)&&this.viewstateSubscriberIDs.push(this.api.subscribeTemplateViewStates(e,function(){var t,e,i=this.app.grid;!i||void 0!==(t=i.getColumnIndex(o.id))&&(e=i.getViewport(),_.each(_.range(e.top,e.bottom+1),function(e){i.updateCell(e,t)}))}.bind(this)))}.bind(this))},unsubscribeViewstateSubscribers:function(){_.isEmpty(this.viewstateSubscriberIDs)||_.each(this.viewstateSubscriberIDs,function(e){this.api.unsubscribeTemplateViewStates(e)}.bind(this)),this.viewstateSubscriberIDs=[]}});var He={initialize:function(e){var t,i,o,n=this;this.subscriptionKey=_.uniqueId("datagridMaster_"),t=(i=e.model).get("data"),columnsConfig=i.get("columnsConfig")||[],datagridConfig=i.get("datagridConfig")||{},e=i.get("theme")||"Dark",o=i.get("gridMasterModelEventSubscribers"),this.customEditors=i.get("customEditors"),this.ignoreMetaChanges=i.get("ignoreMetaChanges")||!1,this.settingsModel=$e.getSettingsModel($.extend(!0,{Basics:{Data:t,Filtering:"Column Filters",ShowPagingControl:!1,EnableGrouping:!1},ColumnsConfiguration:columnsConfig,FileExport:{ShowExportCsvButton:!1,ShowExportExcelButton:!1},Selection:{RowSelectionColumn:t.get("_subscriptionKey"),SelectedValue:new c.DocumentViewModel({_default:[],_viewType:!0,_type:"list",value:[]})}},datagridConfig)),e={sortColumns:i.get("sortColumns"),sortColumnsForCaseInsensitiveSort:i.get("sortColumnsForCaseInsensitiveSort"),gridEventSubscribers:i.get("gridEventSubscribers"),dataViewFilter:i.get("dataViewFilter"),dashboardViewModel:i.get("dashboardViewModel")||new C.Model({DashboardTheme:e}),serverSidePaging:!1,settingsModel:this.settingsModel,api:{showQueryStatus:$.noop,hideQueryStatus:$.noop,subscribe:function(e,t){t={key:n.subscriptionKey,source:e,onData:t};e.subscribe(t.key,t)},unsubscribe:function(e){e.unsubscribe&&e.unsubscribe(n.subscriptionKey)},doActions:$.noop,getProperty:$.proxy(this.getProperty,this),getPropertyMeta:$.proxy(this.getPropertyMeta,this),setProperty:$.proxy(this.setProperty,this),loadSetting:$.noop,saveSetting:$.noop}},$e.prototype.initialize.apply(this,[e]),_.defer(function(){n.listenTo(n.settingsModel,"change",function(){n.onSettingsChange(n.settingsModel.toFlat())}),n.onSettingsChange(n.settingsModel.toFlat()),_.isArray(o)&&_.each(o,function(e){_.isFunction(e)&&e.call(n,i)})})},determineType:function(e){return _.isObject(e)&&_.isFunction(e.get)?e.get("_viewType")?"viewstate":e.get("_dataType")?"datasource":void 0:"none"},getProperty:function(e){var t;if(!e)return null;if(property=this.settingsModel.get(e),!property)return null;switch(type=this.determineType(property),type){case"data":t=null;break;case"viewstate":t=this.getPropertyValue(property);break;default:t=property}return t},getPropertyMeta:function(e){var t,i,o,n;if(!e)return null;if(!(t=this.settingsModel.get(e)))return null;switch(e=this.determineType(t)){case"data":n=null;break;case"viewstate":n=this.getPropertyValue(t),i=t.get("_default"),o=t.get("_type");break;default:n=t}return{path:t.path||null,type:e,value:n,viewstateType:o||null,defaultValue:i||null}},getPropertyValue:function(e){return"viewstate"===this.determineType(e)?e.get("value"):e},setProperty:function(e,t){var i=this.settingsModel.get(e);"viewstate"===this.determineType(i)?i.set("value",t):this.settingsModel.set(e,t)}},$e=C.View.extend({SLICKGRID_ROW_UNIQUE_ID:"slickGridId",RAW_MODE:!1,initialize:function(e){var o=this;this.api=e.api,this.settingsModel=e.settingsModel,this.dashboardAppModel=e.dashboardAppModel,this.dashboardViewModel=e.dashboardViewModel,this.dataConfigDialogMode=e.dataConfigDialogMode||!1,this.orderBookMode=e.orderBookMode,this.widgetId=e.widgetId,this.groupingsOrder=e.groupingsOrder,this.sortColumns=e.sortColumns,this.sortFunctions=e.sortFunctions,this.sortColumnsForCaseInsensitiveSort=e.sortColumnsForCaseInsensitiveSort,this.sortFunctionsMap=_.reduce(this.sortColumns,function(e,t,i){return o.sortFunctions&&_.isFunction(o.sortFunctions[i])&&(e[t.sortCol]=o.sortFunctions[i]),e},{}),this.gridEventSubscribers=e.gridEventSubscribers,this.dataViewFilter=e.dataViewFilter,this.removedColumnInfoCache=new C.Collection([]),this.$el.html(h.app()),this.viewModel=new m,this.columnInfo=new C.Collection([],{comparator:"index"}),this.$pnlGrid=this.$(".pnlGrid"),this.editorModule=new ge(this),this.filteringModule=new de(this),this.highlightingModule=new Pe(this),this.groupingModule=new De(this),this.layoutModule=new we(this),this.pagerModule=new xe(this),this.queryStatusModule=new ke(this),this.rawModeModule=new Ee(this),this.scrollingModule=new Ve(this),this.selectionModule=new Le(this),this.sortingModule=new Oe(this),this.themeModule=new Ce(this),this.tooltipModule=new Ae(this),this.sparklinesManager=new me,this.viewstateTrackingModule=new Ge(this),this.resetPreviousValuesMap(),this.initEvents()},manageDiffMaps:function(e){e&&e.reset&&this.resetPreviousValuesMap(),this.previousValuesMapPending&&(this.previousValuesMap=this.previousValuesMapPending,this.previousValuesMapPending=null),e.remove&&(this.highlightingModule.hasPreviousValueInAnyRule()||this.highlightingModule.showArrowsOrHighlightOnChange())&&_.each(e.remove,function(e){e=e[this.SLICKGRID_ROW_UNIQUE_ID],e=this.atomizeTemporal(e);delete this.previousValuesMap[e],delete this.diffValuesMap[e]}.bind(this))},atomizeTemporal:function(e){return null!==e&&"object"==typeof e&&void 0!==e.i?void 0===e.n?""+e.i:e.i+"_"+e.n:e},cloneDeep_processViewStates:function(e){return _.cloneDeepWith(e,function(e){if(e instanceof C.Model)return e.get("value")})},correctWidthWeights:function(e,t){var i,o,n=!1,t=t||!1,a={},s=_.filter(e,{Hidden:!1}),r=_.filter(_.map(s,"WidthWeight")),s=_.partition(r,function(e){return e<30}),r=s[0],s=s[1];function l(e,t,i){a["ColumnsConfiguration."+t+".WidthWeight"]=e.WidthWeight=i}return 0<r.length&&0<s.length&&(n=!0,r.length>s.length?(i=_.max(r),_.each(e,function(e,t){e.WidthWeight&&30<=e.WidthWeight&&l(e,t,i)})):(o=_.min(s),_.each(e,function(e,t){e.WidthWeight&&e.WidthWeight<30&&l(e,t,o)}))),t?(this.viewModel.set({ColumnsConfiguration:null},{silent:!0}),this.api.setProperty("ColumnsConfiguration",e)):n&&(this.viewModel.set({ColumnsConfiguration:null},{silent:!0}),_.each(a,function(e,t){this.api.setProperty(t,e,{silent:!0})}.bind(this)),this.onSettingsChange({ColumnsConfiguration:e})),t||n},destroyGrid:function(){this.grid&&(this.filteringModule.unsubscribeFromEvents(),this.pagerModule.removePager(),this.grid.destroy(),this.grid=null,this.columnFields=null,this.RAW_MODE&&this.rawModeModule.reset(),this.dataView&&this.dataView.destroy&&this.dataView.destroy(),this.dataView=null)},initEvents:function(){this.listenTo(this.viewModel,"change:Basics.Data",this.onChange_Data),this.listenTo(this.viewModel,"change:Basics.ExperimentalMode",this.onChange_ExperimentalMode),this.listenTo(this.viewModel,"change:Basics.LazyDataLoading",this.onChange_DataRelated),this.listenTo(this.viewModel,"change:ColumnsConfiguration",this.generateDataGridFromReceivedData),this.listenTo(this.viewModel,"change:Tooltip.Position",this.generateDataGridFromReceivedData),this.listenTo(this.pagerModule,"paged",this.onPage)},injectViewstateValuesToUnpackedConfiguration:function(){var e=["Hidden"],n=this,t=n.viewModel.get("ColumnsConfiguration");_.each(n.unpackedColumnsConfiguration,function(i){var o=_.findIndex(t,{Field:i.Field,Format:i.Format,DisplayName:i.DisplayName});0<=o&&_.each(e,function(e){var t=n.api.getPropertyMeta("ColumnsConfiguration."+o+"."+e);t&&"viewstate"===t.type&&(i[e]=t.value)})})},insertIntoDataView:function(e){var i,o,n,a,s,r=this,t=this.grid.getSortColumns();t&&t[0]&&(i=t[0].sortAsc,o=(t[0].columnId?_.find(this.columnsConfig,{id:t[0].columnId}):t[0].sortCol).field),o&&(a=this.sortFunctionsMap[o]?(n=this.sortFunctionsMap[o],this.orderBookMode&&!i?function(e,t){return-n(e,t[o],-1)}:function(e,t){return n(e,t[o],1)}):(t=this.getKdbTypeFromColumn(o),y.getComparator(t,function(e){return e[o]})),s=this.dataView.getItems(),i||(s=s.slice().reverse()),_.each(e,function(e){_.each(e,function(e){var t=y.binarySearch2(e[o],s,a);t<0&&(t=Math.abs(t)-1),i||(s.splice(t,0,e),t=s.length-t-1),r.dataView.insertItem(t,e)})}))},isValidUsersColumnsConfiguration:function(e){var i=this,o=i.viewModel.get("ColumnsConfiguration"),n=_.filter(o,x.isDynamic);return _.every(e,function(t){return _.find(o,{Field:t.Field,Format:t.Format,DisplayName:t.DisplayName})||_.some(n,function(e){return x.getRegex(e).regex.test(t.Field)&&e.Format===t.Format&&(0===i.columnInfo.length||i.columnInfo.get(t.Field))})})},onChange_Data:function(){if(this.editorModule.stopListeningToCurrentDataModel(),this.unsubscribeModel(),this.queryStatusModule.remove(),this.model=this.viewModel.get("Basics.Data")||null,this.sortingModule.resetSortingSpec(),this.filteringModule.resetColumnFiltersMap(),this.columnInfo.reset(),this.removedColumnInfoCache.reset(),this.queryStatusModule.initializeQueryStatusHandler(this.model),!this.model)return this.resetLayout(),void this.trigger("model-unset");var e,t,i,o,n;this.editorModule.checkIfEditable(),this.viewModel.isLazyDataLoadingOn()&&(e=(n=this.viewModel.get("Basics")).SortColumn,t=n.SortOrder,o=n.ScrollValueV||0,i=this.viewModel.get("Style"),n=Math.max(1,Math.ceil((this.$pnlGrid.height()-i.HeaderRowHeight)/i.RowHeight)),i=null,o=Math.max(0,o-Math.ceil(+n)),n=3*n,e&&((i={})[e]="descending"!==t),o={_lazyLoading:!0,_forceReset:!1,_pageSize:n,_pageSort:i,_pagingNum:o,_pagingType:this.viewModel.getDeltaPagingType(),_serverPaging:!0}),this.api.subscribe(this.model,_.bind(this.onData,this),this.RAW_MODE,o)},onChange_DataRelated:function(){this.viewModel.get("Basics.Data")&&this.onChange_Data()},onChange_ExperimentalMode:function(){this.RAW_MODE=this.viewModel.get("Basics.ExperimentalMode"),this.onChange_DataRelated()},onData:function(e,i,t){var o,n,a,s,r,l=this,u=!1,d=!1,c=!1,p=!1;if(this.viewModel.isLazyDataLoadingOn()&&this.model&&!this.model.get("_lazyLoading"))this.onChange_Data();else{if(this.RAW_MODE=_.has(i,"cols"),this.rawModeModule.switchDataviewGetters(),this.skipGridGeneration=!1,this.trigger("data-loaded"),i=_.clone(i),this.manageDiffMaps(i),this.sortingModule.setDataChangeSet(i),this.currentPagingInfo=e.paging,o=e.columns,n=this.dataView?this.dataView.getItems().length:0,this.filteringModule.isProcessedServerSide&&this.isChangeSetEmpty(o)&&i.reset&&0===n){if(0===i.reset.length)return;i.add=i.reset,delete i.reset}if(o.reset&&o.reset.length&&this.isChangeSetEmpty(i)&&(i.reset=[]),t&&(this.columnsToRemoveOnNextRun=o.remove||this.columnsToRemoveOnNextRun,o={},p=this.previousOnDataWasError=!0),!p&&this.previousOnDataWasError&&o&&(o.remove=this.columnsToRemoveOnNextRun,o.add=o.reset,delete o.reset,this.previousOnDataWasError=!1,this.columnsToRemoveOnNextRun=null),this.orderBookMode&&this.columnInfo.length&&e.columns&&delete e.columns.reset,(_.isUndefined(this.viewModel.get("ColumnsConfiguration"))||this.viewModel.get("ColumnsConfiguration")&&0===this.viewModel.get("ColumnsConfiguration").length)&&(this.regenerateColumnsConfiguration=!0),this.resortRequired=!1,this.groupingModule.setDataRefresh(!0),this.onDataFirstPassCheck){if(e.columns&&e.columns.reset&&0===e.columns.reset.length&&i.reset&&0===i.reset.length)return}else if(this.onDataFirstPassCheck=c=!0,e.columns&&e.columns.reset&&0===e.columns.reset.length&&i.reset&&0===i.reset.length)return;e.primaryKey!==this.primaryKey&&(this.primaryKey=e.primaryKey,this.SLICKGRID_ROW_UNIQUE_ID=this.primaryKey,u=!0),a=i.reset&&o.change&&void 0===i.change&&void 0===i.add&&void 0===i.remove&&void 0===o.reset&&void 0===o.add&&void 0===o.remove,o.reset?(this.editorModule.isEditable&&this.editorModule.toggleEditMode(!1),this.columnInfo.reset(e.columns.reset),c||this.ignoreMetaChanges||(this.regenerateColumnsConfiguration=!0),this.removedColumnInfoCache.reset()):(this.viewModel.get("Basics.KeepNonExistentColumns")?(this.removedColumnInfoCache.add(o.remove),this.removedColumnInfoCache.remove(_.map(o.add,function(e){return e.id}))):(this.columnInfo.remove(_.map(o.remove,function(e){return e.id})),o.remove&&o.remove.length&&(d=!0)),this.columnInfo.add(o.add),o.add&&o.add.length&&(d=!0),a||this.columnInfo.add(o.change,{merge:!0}),o.change&&this.columnInfo.set(o.change,{add:!1,remove:!1})),_.some(["add","remove","reset"],function(e){return void 0!==o[e]})&&((s=(a=this.columnInfo.pluck("id")).slice(0)).push("*"),(r=a.slice(0)).unshift(""),this.api.setProperty("datagridPossibleColumns",a),this.api.setProperty("datagridPossibleColumnsWithItself",_.concat("<this>",a)),this.api.setProperty("selectedColumnPossibleValues",a),this.api.setProperty("highlightTargetPossibleValues",s),this.api.setProperty("sortingPossibleValues",r)),this.columnInfo.sort(),this.onDataTriggered&&(u?this.sortingModule.resetSortingSpec():this.sortingModule.storeSortingSpec()),this.onDataTriggered=!0,this.RAW_MODE?(s=this.viewModel.isLazyDataLoadingOn()&&this.dataView instanceof K&&!_.isEmpty(this.currentPagingInfo),r=this.rawModeModule.getRowData(i,s?this.currentPagingInfo.startRows:null),this.pks=r.pks,this.pkOffsetMap=r.pkOffsetMap,this.dataColsMap=r.dataColsMap,s&&(i.add=i.reset,delete i.reset,this.dataView.clear(),this.dataView.updateLength())):(this.pks=void 0,this.pkOffsetMap=void 0,this.dataColsMap=void 0),!this.editorModule.isDataviewsLengthAffectedByDeletedRows()&&(n&&i.remove&&i.remove.length===n)&&!this.filteringModule.isProcessedServerSide&&(i.reset=i.add||[],delete i.add,delete i.remove),(_.reduce(["add","change"],function(e,t){return i[t]?e+i[t].length:e},0)>n/10||this.grid&&(0===this.grid.getSortColumns().length||1<this.grid.getSortColumns().length)||this.viewModel.isLazyDataLoadingOn())&&(this.resortRequired=!0),p?i.reset&&this.dataView&&this.dataView.setItems(i.reset,l.SLICKGRID_ROW_UNIQUE_ID):i.reset?(this.dataToRender_usedOnlyOnce=i.reset.slice(0),this.generateDataGridFromReceivedData(),this.scrollingModule.updateScrollPosition(),this.filteringModule.resetGlobalFilter()):this.dataView&&(this.resortRequired?(this.dataView.beginUpdate(),i.remove&&i.remove.length&&(this.dataView.suspendIndexing(),this.removeItemsFromDataview(i.remove),this.dataView.reactivateIndexing()),i.change&&i.change.length&&i.change.forEach(function(e){e=e[this.primaryKey];this.dataView.updateItem_unchecked_noRefresh(e,i.collection.get(e).attributes)},this),i.add&&i.add.length&&i.add.forEach(function(e){this.dataView.addItem(e)},this)):(this.dataView.beginUpdate(),(i.remove&&i.remove.length||i.change&&i.change.length)&&(this.dataView.suspendIndexing(),i.remove&&i.remove.length&&this.removeItemsFromDataview(i.remove),i.change&&i.change.length&&(this.grid.invalidateRows(this.dataView.mapIdsToRows(_.map(i.change,this.SLICKGRID_ROW_UNIQUE_ID))),this.removeItemsFromDataview(i.change)),this.dataView.reactivateIndexing(!(!i.change||!i.change.length))),(i.add&&i.add.length||i.change&&i.change.length)&&(this.dataView.suspendIndexing(),p=_.map(i.change,function(e){return i.collection.get(e[l.primaryKey]).attributes}),this.insertIntoDataView([i.add,p]),this.dataView.reactivateIndexing(),_.each(p,function(e){this.dataView.updateItem_unchecked_noRefresh(e[l.primaryKey])}.bind(this)))),this.dataView.endUpdate(),(l.regenerateColumnsConfiguration&&(i.add||i.reset||i.change)||!i.add&&!i.reset&&!i.change&&u||d)&&l.generateDataGridFromReceivedData()),this.filteringModule.reapplyColumnFilters(),this.resortRequired&&(this.model.get("_serverPaging")||this.sortingModule.isInNaturalOrder()||this.dataView.reSort(),this.resortRequired=!1),this.filteringModule.isProcessedServerSide&&this.dataView&&(this.sortingModule.forceResort=!0,this.dataView.reSort(),this.sortingModule.forceResort=!1),this.viewModel.isLazyDataLoadingOn()?this.dataView&&(this.dataView.updateLength(),this.dataView.updateScrollbar(),this.dataView.onViewportChanged(),this.grid.render()):this.selectionModule.setSelectedRows(),this.pagerModule.onData(e,i,t),this.sortingModule.onData(e,i,t),this.groupingModule.setDataRefresh(!1),this.highlightingModule.processNumberDiffHighlighting(),this.highlightingModule.processMinMaxHighlighting(),(this.highlightingModule.hasPreviousValueInAnyRule()||this.highlightingModule.showArrowsOrHighlightOnChange())&&this.storeAllCurrentDataRows(),this.trigger("data-processed",t)}},generateDatagridColumnsConfiguration:function(){var e,i=this;i.unpackedColumnsConfiguration=null,(e=i.api.loadSetting("UsersColumnsConfiguration"))&&e.length&&(i.isValidUsersColumnsConfiguration(e)?(e=D.upgradeColumnsConfig(e),i.unpackedColumnsConfiguration=e,i.injectViewstateValuesToUnpackedConfiguration()):i.api.saveSetting("UsersColumnsConfiguration",null)),i.unpackedColumnsConfiguration=i.unpackedColumnsConfiguration||_.clone(i.viewModel.get("ColumnsConfiguration")),_.some(i.unpackedColumnsConfiguration,x.isDynamic)&&(!i.viewModel.get("Basics.KeepNonExistentColumns")&&i.removedColumnInfoCache.length&&(i.columnInfo.remove(i.removedColumnInfoCache.pluck("id")),i.removedColumnInfoCache.reset()),i.unpackedColumnsConfiguration=i.unpackColumnConfiguration(i.unpackedColumnsConfiguration,i.columnInfo)),this.editorModule.addDeleteColumnIfNecessary(i.unpackedColumnsConfiguration),i.columnsConfig=_.map(i.unpackedColumnsConfiguration,function(e,t){return ve(e,t,i)}),i.groupingModule.loadAndApplyGroupingSettings()},generateDataGridFromReceivedData:function(){var n,a,e,i,t=this,s=!1,o=!1;this.skipGridGeneration||(t.regenerateColumnsConfiguration&&(t.regenerateColumnsConfiguration=!1,e=t.viewModel.get("Basics.Data"),i=e&&e.path===D.SAMPLE_DATA,e=t.viewModel.get("ColumnsConfiguration"),n=_.map(t.columnInfo.models,function(e){var t=e.get("id"),e=e.get("kdbType");return fe.generate(t,e,i)}),a=[],_.each(e,function(t){var i,e,o=x.isDynamic(t);o&&(i=x.getRegex(t).regex),e=_.filter(n,function(e){return o?i.test(e.Field):t.Field===e.Field}),n=_.difference(n,e),0<e.length||o||t.UserDefined?a.push(t):s=!0}),this.dataConfigDialogMode||s?a=_.concat(a,n):n.length&&0===a.length&&(a=n),o=!_.isEqual(e,a)),this.correctWidthWeights(o?a:this.viewModel.get("ColumnsConfiguration"),o)||(t.generateDatagridColumnsConfiguration(),t.renderDatagrid()))},getAllFilteredItems:function(){return this.RAW_MODE?this.rawModeModule.getAllFilteredItems():this.dataView.getFilteredItems()},getKdbTypeFromColumn:function(e){e=this.columnInfo.get(e);return e?e.get("kdbType"):null},getRowIxRange:function(){return e=this.grid.getRenderedRange(),_.range(e.top,e.bottom+1);var e},isChangeSetEmpty:function(e){return _.isEmpty(_.pick(e,["reset","add","change","remove"]))},onPage:function(){this.grid&&this.grid.scrollRowToTop(0)},onSettingsChange:function(e){var t=_.has(e,"Basics.Data");void 0===this.skipGridGeneration&&(this.skipGridGeneration=!0),_.each(_.omit(e,"Style.Theme","Basics.Data"),_.bind(function(e,t){this.viewModel.set(t,"ColumnsConfiguration"===t?_.cloneDeep(e):e),t===this.filteringModule.BASICS_KDB_FILTER_STRING?this.viewModel.trigger("change:"+this.filteringModule.BASICS_KDB_FILTER_STRING):"Selection.Actions"===t&&this.selectionModule.onChange_SelectionActions()},this)),t&&this.viewModel.set("Basics.Data",_.get(e,"Basics.Data")),this.skipGridGeneration&&(this.skipGridGeneration=!1,this.generateDataGridFromReceivedData())},refreshDataView:function(){this.dataView&&this.dataView.refresh()},registerCellExternalCopyManager:function(){var e={includeHeaderWhenCopying:!0};_.isEmpty(this.customEditors)&&this.grid.registerPlugin(new Slick.CellExternalCopyManager(e))},remove:function(){this.destroyGrid(),this.viewstateTrackingModule.remove(),this.editorModule.remove(),this.filteringModule.remove(),this.groupingModule.remove(),this.highlightingModule.remove(),this.layoutModule.remove(),this.pagerModule.remove(),this.queryStatusModule.remove(),this.scrollingModule.remove(),this.selectionModule.remove(),this.sortingModule.remove(),this.themeModule.remove(),this.tooltipModule.remove(),this.sparklinesManager.remove(),this.rawModeModule.remove(),this.unsubscribeModel(),C.View.prototype.remove.apply(this,arguments)},removeItemsFromDataview:function(e){e&&e.length&&e.forEach(function(e){this.dataView.deleteItem(e[this.primaryKey])},this)},renderDatagrid:function(){var i=this,e={},t=i.viewModel.get("Basics.IsEditable")&&i.viewModel.get("Basics.IsInsertable");if(this.dataView||this.dataToRender_usedOnlyOnce){if(this.RAW_MODE&&this.rawModeModule.modifyDataViewConfig(e),i.editorModule.hasUnmodifiedData()&&(this.dataToRender_usedOnlyOnce=i.editorModule.useUnmodifiedData()),this.dataView&&null===this.dataToRender_usedOnlyOnce)if(this.viewModel.isLazyDataLoadingOn()&&this.currentPagingInfo){if(0!==this.currentPagingInfo.startRows)return void this.onChange_DataRelated();this.dataToRender_usedOnlyOnce=[];for(var o=Number(this.currentPagingInfo.numRows),n=0;n<o;n++)this.dataToRender_usedOnlyOnce.push(this.dataView.getItem(n))}else this.dataToRender_usedOnlyOnce=this.dataView.getItems();this.pagerModule.storeCurrentState(),this.destroyGrid();t={enableCellNavigation:!0,editable:i.customEditors||i.editorModule.isEditable,enableAddRow:i.editorModule.isEditable&&t,enableCellNavigation:!0,asyncEditorLoading:!1,rowHeight:i.viewModel.get("Style.RowHeight"),headerRowHeight:i.viewModel.get("Style.HeaderRowHeight"),multiColumnSort:!0,multiSelect:"Multi Row"===i.viewModel.get("Selection.Mode"),forceFitColumns:!1,autoExpandColumns:!0,forceSyncScrolling:!0,autoEdit:!0,kdbTypesColumnInfo:this.columnInfo};this.filteringModule.modifyGridConfig(t),_.extend(t,{evenRowBackgroundColorOverride:i.viewModel.get("Style.EvenRowBackgroundColorOverride"),oddRowBackgroundColorOverride:i.viewModel.get("Style.OddRowBackgroundColorOverride"),headerFontWeight:i.viewModel.get("Style.HeaderFontWeight"),fontFamily:i.viewModel.get("Style.FontFamily"),fontSize:this.themeModule.getFontSize(),cellHighlightCssClass:"highlighted",scrollLeft:this.RAW_MODE?this.rawModeModule.scrollLeft:null}),this.groupingModule.modifyDataViewConfig(e),e.atomizeTemporal=this.atomizeTemporal,i.dataView=this.viewModel.isLazyDataLoadingOn()?new K(this,e):new Slick.Data.DataView(e),this.rawModeModule.switchDataviewGetters(),i.columnFields=_.map(i.columnsConfig,"field");e=_.map(i.unpackedColumnsConfiguration,function(e,t){return e.Hidden?null:i.columnsConfig[t]}),e=_.compact(e);this.selectionModule.initCheckBoxColumn(e),this.viewstateTrackingModule.unsubscribeViewstateSubscribers(),this.viewstateTrackingModule.subscribeViewstateSubscribers(e),i.grid=new Slick.GridModifiedByIK(i.$pnlGrid,i.dataView,e||[],t),this.editorModule.resetLists(),this.editorModule.setUpdateTypeConfig(i.columnInfo),this.editorModule.initializeGridListeners(),i.grid.registerPlugin(this.groupingModule.groupItemMetadataProvider),i.grid.registerPlugin(new Slick.AutoTooltips({enableForHeaderCells:!0,enableForCells:"none"===this.viewModel.get("Tooltip.Position")})),this.tooltipModule.initRowTooltip(),this.selectionModule.registerGridSelectionModel(),i.registerCellExternalCopyManager(),i.subscribeToDataViewEvents(),i.subscribeToGridEvents(),t.explicitInitialization&&(this.filteringModule.registerColumnFilters(),i.grid.init()),i.dataView.beginUpdate(),i.dataView.setItems(this.dataToRender_usedOnlyOnce,i.SLICKGRID_ROW_UNIQUE_ID),this.dataToRender_usedOnlyOnce=null,this.filteringModule.registerDataViewFilter(),i.dataView.endUpdate(),this.RAW_MODE&&(this.selectionModule.onChange_SelectionColumn(),this.rawModeModule.populateFields(this.highlightingModule.getHighlightingFields(),"highlighting")),this.pagerModule.initPager(this.model&&this.model.get("_serverPaging"),function(){i.sortingModule.initDefaultSortings(),i.sortingModule.triggerSorting()}),i.groupingModule.groupingChanged(),this.RAW_MODE&&this.rawModeModule.resetVerticalScrollValues(),this.trigger("datagrid-rendered")}},resetLayout:function(){this.dataToRender_usedOnlyOnce=[],this.renderDatagrid()},resetPreviousValuesMap:function(){this.previousValuesMapPending=null,this.previousValuesMap={},this.diffValuesMap={}},storeAllCurrentDataRows:function(){var n,a,s=this.dataView;s&&(a=this.highlightingModule.getHighlightingFields()).length&&(n=s.getOptions&&s.getOptions().populateItem,this.previousValuesMapPending=_.mapValues(s.getInternalMap_idxById(),function(e,t){var i=s.getItemByIdx(e),o={};return n&&(i=n(i)),_.forEach(a,function(e){o[e]=_.cloneDeep(i[e]),this.previousValuesMap&&this.previousValuesMap[t]&&void 0!==this.previousValuesMap[t][e]&&(this.diffValuesMap[t]=this.diffValuesMap[t]||{},_.isEqual(o[e],this.previousValuesMap[t][e])||(this.diffValuesMap[t][e]=this.previousValuesMap[t][e]))}.bind(this)),o}.bind(this)))},subscribeToDataViewEvents:function(){var i=this;i.dataView.onPagingInfoChanged.subscribe(function(e,t){i.highlightingModule.processMinMaxHighlighting_debounced()}),i.dataView.onRowCountChanged.subscribe(function(e,t){i.grid.updateRowCount()}),i.dataView.onRowsChanged.subscribe(function(e,t){i.grid.invalidateRows(t.rows),i.grid.render(),i.sparklinesManager.refresh(),i.highlightingModule.processMinMaxHighlighting_debounced(),i.groupingModule.saveGroupingState()})},subscribeToGridEvents:function(){this.scrollingModule.subscribeToScrollEvent(),this.sortingModule.subscribeToSortEvent(),this.groupingModule.fixColumnReorderingLayoutIssue(),this.layoutModule.subscribeToColumnsResizeEvent(),_.each(this.gridEventSubscribers,_.bind(function(e){e.apply(this)},this))},unpackColumnConfiguration:function(e,t){var s=[],i=_.map(_.reject(e,x.isDynamic),"Field"),r=_.difference(t.pluck("id"),i);return _.each(e,function(i){var o,t,n,a;x.isDynamic(i)?(a=x.getRegex(i),n=a.regex,t=0,o=a.isExact?i.DisplayName:_.map(i.DisplayName,function(e){return"*"===e?"$"+(t+=1):e}).join(""),_.each(r,function(e,t){n.test(e)&&(e=_.extend({},i,{DisplayName:a.isExact&&!i.DisplayName?e:e.replace(n,o),Field:e}),s.push(e),r[t]=null)}),r=_.compact(r)):s.push(i)}),s},unsubscribeModel:function(){this.model&&(this.stopListening(this.model),this.api.unsubscribe(this.model))}},{getComponentDefinition:D.getComponentDefinition,getSettingsModel:D.getSettingsModel,getColumnSettingsModel:D.getColumnSettingsModel,getDefaultJSONTemplates:D.getDefaultJSONTemplates,mergeWithDefault:D.mergeWithDefault});return $e.Master=$e.extend(He),$e});