define(["backbone","Handlebars","QuickBase","css!./css/main.css"],function(e,t,d){var i=(n.app=t.template({compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){return'<div class="configure-widgets">\r\n    <a class="show-configure-menu ui-widget ui-state-active">\r\n        <i class="fa fa-cog"></i> <i class="fa fa-caret-down"></i>\r\n    </a>\r\n    <ul class="configure-widgets-menu ui-widget ui-widget-content"></ul>\r\n</div>\r\n<div class="worksheet">\r\n    <div class="grid-stack"><div class="grid-stack-overlay"></div></div>\r\n    <div class="worksheet-highlight-item"></div>\r\n    <div class="row-highlight-item"></div>\r\n    <div class="highlight-viewport">\r\n        <div class="highlight-layer">\r\n            <div class="highlight-item">\r\n\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div class="no-widgets-info">\r\n        <div class="loading">'+t.escapeExpression((i.t||e&&e.t||i.helperMissing).call(null!=e?e:t.nullContext||{},"start dragging widgets from the panel on your left",{name:"t",hash:{},data:o}))+'</div>\r\n\r\n        <div class="dragComponentsHelp">\r\n            <i class="fa fa-chevron-right"></i>\r\n            <i class="fa fa-chevron-right"></i>\r\n            <i class="fa fa-chevron-right"></i>\r\n        </div>\r\n    </div>\r\n</div>'},useData:!0}),n.configureWidgetsMenu=t.template({1:function(t,e,i,n,o){var s=null!=e?e:t.nullContext||{},a=i.helperMissing,r="function",d=t.escapeExpression;return'    <li data-widgetid="'+d(typeof(t=null!=(t=i.id||(null!=e?e.id:e))?t:a)==r?t.call(s,{name:"id",hash:{},data:o}):t)+'"><i class="fa fa-plus-circle"></i> '+d(typeof(t=null!=(t=i.name||(null!=e?e.name:e))?t:a)==r?t.call(s,{name:"name",hash:{},data:o}):t)+"</li>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){return'<li class="ui-widget-header">Available Widgets</li>\r\n'+(null!=(o=i.each.call(null!=e?e:t.nullContext||{},null!=e?e.widgets:e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?o:"")+'<li>-</li>\r\n<li data-actionid="reset">Reset Layout</li>'},useData:!0}),n);function n(){}function o(){this.styleMap={},this.styleMapUsage={}}var s={getComponentDefinition:function(t){var e,i,n={id:50,componentName:"panel",componentDescription:"group multiple components together with a panel",appKey:"Panel",disable_array_reorder:!0,appArgs:{json:{version:"4.4.0",Basics:{ComponentName:"panel",RelativeHeight:!0,Advanced:!1,UserLayout:!1,Floatable:!0,ColCount:36,RowHeight:25,RowCount:24},Style:{advanced:""}},schema:{type:"object",title:"Properties",_transform:function(t,e,i,n){_.set(e,"properties.Basics.properties.RowCount.options.hidden",!_.get(t,"Basics.RelativeHeight")),_.set(e,"properties.Basics.properties.RowHeight.options.hidden",!!_.get(t,"Basics.RelativeHeight")),n(void 0,e)},properties:{Basics:{type:"object",title:"Basics",options:{disable_array_reorder:!0},properties:{ComponentName:{type:"string",title:"hide me",options:{hidden:!0}},RelativeHeight:{type:"boolean",title:"Fill Height",default:!0,format:"checkbox"},Advanced:{type:"boolean",title:"Advanced Layout",default:!1,format:"checkbox"},UserLayout:{type:"boolean",title:"User Layout",default:!1,format:"checkbox"},Floatable:{type:"boolean",title:"Floatable",default:!0,format:"checkbox"},ColCount:{title:"Column Count",type:"number",minimum:1,default:36},RowHeight:{title:"Row Height",type:"number",default:25,options:{hidden:!0}},RowCount:{title:"Row Count",type:"number",minimum:1,default:24}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(i=s.upgrades.indexOf(_.find(s.upgrades,{version:t.settingsModel.get("version")}))+1;i<s.upgrades.length;i+=1)(e=s.upgrades[i]).fn(t.settingsModel,t),t.settingsModel.set("version",e.version);return n},upgrades:[{version:"4.0.0d15",fn:function(t,e){t.set("Basics.RelativeHeight",!1),t.set("Basics.Advanced",!1),t.set("Style.advanced","")}},{version:"4.0.1",fn:function(t,e){t.set("Basics.UserLayout",!1)}},{version:"4.4.0",fn:function(t,e){t.set("Basics.ColCount",12),t.set("Basics.Floatable",!1),t.set("Basics.RowHeight",t.get("Basics.RelativeHeight")?void 0:25),t.set("Basics.RowCount",void 0)}}]};Object.assign(o.prototype,{add:function(t){this.styleMapUsage[t]=this.styleMapUsage[t]||0,0===this.styleMapUsage[t]&&(this.styleMap[t]=this._createStyle(t)),this.styleMapUsage[t]++},_createStyle:function(t){var e,i,n,o=[],s=100/t,a=".grid-stack.grid-stack-"+t+">.grid-stack-item";for(o.push(a+"{min-width:"+ +s.toFixed(5)+"%}"),i=1;i<=t;i++)e=+(s*i).toFixed(5),o.push(a+"[data-gs-width='"+i+"']{width:"+e+"%}"),o.push(a+"[data-gs-x='"+i+"']{left:"+e+"%}");return(n=document.createElement("style")).setAttribute("type","text/css"),n.innerHTML=o.join(""),document.head.appendChild(n),n},remove:function(t){var e;this.styleMapUsage[t]--,0!==this.styleMapUsage[t]||(e=this.styleMap[t])&&(e.parentNode.removeChild(e),this.styleMap[t]=null)}});var a,r,h,l=(a=document.createElement("canvas"),r={canvas:!!(t=a.getContext("2d")),imageData:!!t.getImageData,dataURL:!!a.toDataURL,btoa:!!window.btoa},h="image/octet-stream",{saveAsImage:b,saveAsPNG:function(t,e,i){return b(t,e,i,"png")},saveAsJPEG:function(t,e,i){return b(t,e,i,"jpeg")},saveAsGIF:function(t,e,i){return b(t,e,i,"gif")},saveAsBMP:function(t,e,i){return b(t,e,i,"bmp")},convertToImage:C,convertToPNG:function(t,e,i){return C(t,e,i,"png")},convertToJPEG:function(t,e,i){return C(t,e,i,"jpeg")},convertToGIF:function(t,e,i){return C(t,e,i,"gif")},convertToBMP:function(t,e,i){return C(t,e,i,"bmp")}});function g(t,e,i){var n=t.width,o=t.height;null==e&&(e=n),null==i&&(i=o);var s=document.createElement("canvas"),a=s.getContext("2d");return s.width=e,s.height=i,a.drawImage(t,0,0,n,o,0,0,e,i),s}function c(t,e,i,n){return(t=g(t,i,n)).toDataURL(e)}function u(t){document.location.href=t}function p(t){var e=document.createElement("img");return e.src=t,e}function f(t){return"image/"+(t=t.toLowerCase().replace(/jpg/i,"jpeg")).match(/png|jpeg|bmp|gif/)[0]}function m(t){if(!window.btoa)throw"btoa undefined";var e="";if("string"==typeof t)e=t;else for(var i=0;i<t.length;i++)e+=String.fromCharCode(t[i]);return btoa(e)}function y(t){var e=t.width,i=t.height;return t.getContext("2d").getImageData(0,0,e,i)}function v(t,e){return"data:"+e+";base64,"+t}function w(t){var e=t.width,i=t.height,n=[66,77,255&(n=54+(o=e*i*3)),n>>8&255,n>>16&255,n>>24&255,0,0,0,0,54,0,0,0],o=[40,0,0,0,255&e,e>>8&255,e>>16&255,e>>24&255,255&i,i>>8&255,i>>16&255,i>>24&255,1,0,24,0,0,0,0,0,255&o,o>>8&255,o>>16&255,o>>24&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],s=(4-3*e%4)%4,a=t.data,r="",d=e<<2,h=i,l=String.fromCharCode;do{for(var g=d*(h-1),c="",u=0;u<e;u++){var p=u<<2;c+=l(a[g+p+2])+l(a[g+p+1])+l(a[g+p])}for(var f=0;f<s;f++)c+=String.fromCharCode(0)}while(r+=c,--h);return m(n.concat(o))+m(r)}function b(t,e,i,n){var o;r.canvas&&r.dataURL&&("string"==typeof t&&(t=document.getElementById(t)),n=f(n=null==n?"png":n),/bmp/.test(n)?(o=y(g(t,e,i)),u(v(w(o),h))):u(c(t,n,e,i).replace(n,h)))}function C(t,e,i,n){if(r.canvas&&r.dataURL){if("string"==typeof t&&(t=document.getElementById(t)),n=f(n=null==n?"png":n),/bmp/.test(n)){var o=y(g(t,e,i));return p(v(w(o),"image/bmp"))}return p(c(t,n,e,i))}}!function(Y,K,j){"use strict";var o,e,s,a,d,X={};function r(t,e,i){var n,o=t.runtimeStyle&&t.runtimeStyle[e],s=t.style;return!/^-?[0-9]+\.?[0-9]*(?:px)?$/i.test(i)&&/^-?\d/.test(i)&&(n=s.left,o&&(t.runtimeStyle.left=t.currentStyle.left),s.left="fontSize"===e?"1em":i||0,i=s.pixelLeft+"px",s.left=n,o&&(t.runtimeStyle.left=o)),/^(thin|medium|thick)$/i.test(i)?i:Math.round(parseFloat(i))+"px"}function h(t){return parseInt(t,10)}function l(t,e,i,n,o,s){var a,r,d,e=X.Util.getCSS(e,t,o);return 1===e.length&&(o=e[0],(e=[])[0]=o,e[1]=o),-1!==e[0].toString().indexOf("%")?(a=parseFloat(e[0])/100,r=i.width*a,"backgroundSize"!==t&&(r-=(s||n).width*a)):"backgroundSize"===t?"auto"===e[0]?r=n.width:/contain|cover/.test(e[0])?(r=(d=X.Util.resizeBounds(n.width,n.height,i.width,i.height,e[0])).width,d=d.height):r=parseInt(e[0],10):r=parseInt(e[0],10),"auto"===e[1]?d=r/n.width*n.height:-1!==e[1].toString().indexOf("%")?(a=parseFloat(e[1])/100,d=i.height*a,"backgroundSize"!==t&&(d-=(s||n).height*a)):d=parseInt(e[1],10),[r,d]}X.Util={},X.Util.log=function(t){X.logging&&Y.console&&Y.console.log&&Y.console.log(t)},X.Util.trimText=(e=String.prototype.trim,function(t){return e?e.apply(t):((t||"")+"").replace(/^\s+|\s+$/g,"")}),X.Util.asFloat=function(t){return parseFloat(t)},s=/((rgba|rgb)\([^\)]+\)(\s-?\d+px){0,})/g,a=/(-?\d+px)|(#.+)|(rgb\(.+\))|(rgba\(.+\))/g,X.Util.parseTextShadows=function(t){if(!t||"none"===t)return[];for(var e=t.match(s),i=[],n=0;e&&n<e.length;n++){var o=e[n].match(a);i.push({color:o[0],offsetX:o[1]?o[1].replace("px",""):0,offsetY:o[2]?o[2].replace("px",""):0,blur:o[3]?o[3].replace("px",""):0})}return i},X.Util.parseBackgroundImage=function(t){function e(){i&&((n='"'===n.substr(0,1)?n.substr(1,n.length-2):n)&&h.push(n),"-"===i.substr(0,1)&&0<(s=i.indexOf("-",1)+1)&&(o=i.substr(0,s),i=i.substr(s)),l.push({prefix:o,method:i.toLowerCase(),value:a,args:h})),h=[],i=o=n=a=""}var i,n,o,s,a,r,d,h,l=[],g=0,c=0;e();for(var u=0,p=t.length;u<p;u++)if(r=t[u],!(0===g&&-1<" \r\n\t".indexOf(r))){switch(r){case'"':d?d===r&&(d=null):d=r;break;case"(":if(d)break;if(0===g){g=1,a+=r;continue}c++;break;case")":if(d)break;if(1===g){if(0===c){g=0,a+=r,e();continue}c--}break;case",":if(d)break;if(0===g){e();continue}if(1!==g||0!==c||i.match(/^url$/i))break;h.push(n),n="",a+=r;continue}a+=r,0===g?i+=r:n+=r}return e(),l},X.Util.Bounds=function(t){var e,i={};return t.getBoundingClientRect&&(e=t.getBoundingClientRect(),i.top=e.top,i.bottom=e.bottom||e.top+e.height,i.left=e.left,i.width=t.offsetWidth,i.height=t.offsetHeight),i},X.Util.OffsetBounds=function(t){var e=t.offsetParent?X.Util.OffsetBounds(t.offsetParent):{top:0,left:0};return{top:t.offsetTop+e.top,bottom:t.offsetTop+t.offsetHeight+e.top,left:t.offsetLeft+e.left,width:t.offsetWidth,height:t.offsetHeight}},X.Util.getCSS=function(t,e,i){var n=(o=void 0!==t?K.defaultView.getComputedStyle(t,null):o)[e];if(/^background(Size|Position)$/.test(e))return function(t,e,i,n){if(t=(t=(t||"").split(","))[n||0]||t[0]||"auto",t=X.Util.trimText(t).split(" "),"backgroundSize"!==i||t[0]&&!t[0].match(/cover|contain|auto/)){if(t[0]=-1===t[0].indexOf("%")?r(e,i+"X",t[0]):t[0],t[1]===j){if("backgroundSize"===i)return t[1]="auto",t;t[1]=t[0]}t[1]=-1===t[1].indexOf("%")?r(e,i+"Y",t[1]):t[1]}else;return t}(n,t,e,i);if(/border(Top|Bottom)(Left|Right)Radius/.test(e)){e=n.split(" ");return e.length<=1&&(e[1]=e[0]),e.map(h)}return n},X.Util.resizeBounds=function(t,e,i,n,o){var s,a,e=t/e;return o&&"auto"!==o?i/n<e^"contain"===o?s=(a=n)*e:a=(s=i)/e:(s=i,a=n),{width:s,height:a}},X.Util.BackgroundPosition=function(t,e,i,n,o){o=l("backgroundPosition",t,e,i,n,o);return{left:o[0],top:o[1]}},X.Util.BackgroundSize=function(t,e,i,n){n=l("backgroundSize",t,e,i,n);return{width:n[0],height:n[1]}},X.Util.Extend=function(t,e){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},X.Util.Children=function(t){var e,i,n;try{e=t.nodeName&&"IFRAME"===t.nodeName.toUpperCase()?t.contentDocument||t.contentWindow.document:(i=t.childNodes,n=[],null!==i&&function(t,e){var i=t.length,n=0;if("number"==typeof e.length)for(var o=e.length;n<o;n++)t[i++]=e[n];else for(;e[n]!==j;)t[i++]=e[n++];t.length=i}(n,i),n)}catch(t){X.Util.log("html2canvas.Util.Children failed with exception: "+t.message),e=[]}return e},X.Util.isTransparent=function(t){return"transparent"===t||"rgba(0, 0, 0, 0)"===t},X.Util.Font=(d={},function(t,e,i){if(d[t+"-"+e]!==j)return d[t+"-"+e];var n,o=i.createElement("div"),s=i.createElement("img"),a=i.createElement("span"),r="Hidden Text";return o.style.visibility="hidden",o.style.fontFamily=t,o.style.fontSize=e,o.style.margin=0,o.style.padding=0,i.body.appendChild(o),s.src="data:image/gif;base64,R0lGODlhAQABAIABAP///wAAACwAAAAAAQABAAACAkQBADs=",s.width=1,s.height=1,s.style.margin=0,s.style.padding=0,s.style.verticalAlign="baseline",a.style.fontFamily=t,a.style.fontSize=e,a.style.margin=0,a.style.padding=0,a.appendChild(i.createTextNode(r)),o.appendChild(a),o.appendChild(s),n=s.offsetTop-a.offsetTop+1,o.removeChild(a),o.appendChild(i.createTextNode(r)),o.style.lineHeight="normal",s.style.verticalAlign="super",s=s.offsetTop-o.offsetTop+1,d[t+"-"+e]=s={baseline:n,lineWidth:1,middle:s},i.body.removeChild(o),s}),function(){var i=X.Util,t={};X.Generate=t;var f=[/^(-webkit-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-linear-gradient)\(([a-z\s]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-gradient)\((linear|radial),\s((?:\d{1,3}%?)\s(?:\d{1,3}%?),\s(?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)\-]+)\)$/,/^(-moz-linear-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?))([\w\d\.\s,%\(\)]+)\)$/,/^(-webkit-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/,/^(-moz-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s?([a-z\-]*)([\w\d\.\s,%\(\)]+)\)$/,/^(-o-radial-gradient)\(((?:\d{1,3}%?)\s(?:\d{1,3}%?)),\s(\w+)\s([a-z\-]+)([\w\d\.\s,%\(\)]+)\)$/];function l(t){return function(e){try{t.addColorStop(e.stop,e.color)}catch(t){i.log(["failed to add color stop: ",t,"; tried to add: ",e])}}}t.parseGradient=function(t,e){for(var i,n,o,s,a,r,d,h,l,g,c,u=f.length,p=0;p<u&&!(n=t.match(f[p]));p+=1);if(n)switch(n[1]){case"-webkit-linear-gradient":case"-o-linear-gradient":if(i={type:"linear",x0:null,y0:null,x1:null,y1:null,colorStops:[]},s=n[2].match(/\w+/g))for(a=s.length,p=0;p<a;p+=1)switch(s[p]){case"top":i.y0=0,i.y1=e.height;break;case"right":i.x0=e.width,i.x1=0;break;case"bottom":i.y0=e.height,i.y1=0;break;case"left":i.x0=0,i.x1=e.width}if(null===i.x0&&null===i.x1&&(i.x0=i.x1=e.width/2),null===i.y0&&null===i.y1&&(i.y0=i.y1=e.height/2),s=n[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(a=s.length,r=1/Math.max(a-1,1),p=0;p<a;p+=1)(d=s[p].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/))[2]?(o=parseFloat(d[2]),"%"===d[3]?o/=100:o/=e.width):o=p*r,i.colorStops.push({color:d[1],stop:o});break;case"-webkit-gradient":if(i={type:"radial"===n[2]?"circle":n[2],x0:0,y0:0,x1:0,y1:0,colorStops:[]},(s=n[3].match(/(\d{1,3})%?\s(\d{1,3})%?,\s(\d{1,3})%?\s(\d{1,3})%?/))&&(i.x0=s[1]*e.width/100,i.y0=s[2]*e.height/100,i.x1=s[3]*e.width/100,i.y1=s[4]*e.height/100),s=n[4].match(/((?:from|to|color-stop)\((?:[0-9\.]+,\s)?(?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)\))+/g))for(a=s.length,p=0;p<a;p+=1)d=s[p].match(/(from|to|color-stop)\(([0-9\.]+)?(?:,\s)?((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\)/),o=parseFloat(d[2]),"from"===d[1]&&(o=0),"to"===d[1]&&(o=1),i.colorStops.push({color:d[3],stop:o});break;case"-moz-linear-gradient":if(i={type:"linear",x0:0,y0:0,x1:0,y1:0,colorStops:[]},(s=n[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))&&(i.x0=s[1]*e.width/100,i.y0=s[2]*e.height/100,i.x1=e.width-i.x0,i.y1=e.height-i.y0),s=n[3].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}%)?)+/g))for(a=s.length,r=1/Math.max(a-1,1),p=0;p<a;p+=1)(d=s[p].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%)?/))[2]?(o=parseFloat(d[2]),d[3]&&(o/=100)):o=p*r,i.colorStops.push({color:d[1],stop:o});break;case"-webkit-radial-gradient":case"-moz-radial-gradient":case"-o-radial-gradient":if(i={type:"circle",x0:0,y0:0,x1:e.width,y1:e.height,cx:0,cy:0,rx:0,ry:0,colorStops:[]},(s=n[2].match(/(\d{1,3})%?\s(\d{1,3})%?/))&&(i.cx=s[1]*e.width/100,i.cy=s[2]*e.height/100),s=n[3].match(/\w+/),d=n[4].match(/[a-z\-]*/),s&&d)switch(d[0]){case"farthest-corner":case"cover":case"":h=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2)),l=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2)),g=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2)),c=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2)),i.rx=i.ry=Math.max(h,l,g,c);break;case"closest-corner":h=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.cy,2)),l=Math.sqrt(Math.pow(i.cx,2)+Math.pow(i.y1-i.cy,2)),g=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.y1-i.cy,2)),c=Math.sqrt(Math.pow(i.x1-i.cx,2)+Math.pow(i.cy,2)),i.rx=i.ry=Math.min(h,l,g,c);break;case"farthest-side":"circle"===s[0]?i.rx=i.ry=Math.max(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy):(i.type=s[0],i.rx=Math.max(i.cx,i.x1-i.cx),i.ry=Math.max(i.cy,i.y1-i.cy));break;case"closest-side":case"contain":"circle"===s[0]?i.rx=i.ry=Math.min(i.cx,i.cy,i.x1-i.cx,i.y1-i.cy):(i.type=s[0],i.rx=Math.min(i.cx,i.x1-i.cx),i.ry=Math.min(i.cy,i.y1-i.cy))}if(s=n[5].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\)(?:\s\d{1,3}(?:%|px))?)+/g))for(a=s.length,r=1/Math.max(a-1,1),p=0;p<a;p+=1)(d=s[p].match(/((?:rgb|rgba)\(\d{1,3},\s\d{1,3},\s\d{1,3}(?:,\s[0-9\.]+)?\))\s*(\d{1,3})?(%|px)?/))[2]?(o=parseFloat(d[2]),"%"===d[3]?o/=100:o/=e.width):o=p*r,i.colorStops.push({color:d[1],stop:o})}return i},t.Gradient=function(t,e){if(0!==e.width&&0!==e.height){var i,n,o=K.createElement("canvas"),s=o.getContext("2d");if(o.width=e.width,o.height=e.height,i=X.Generate.parseGradient(t,e))switch(i.type){case"linear":n=s.createLinearGradient(i.x0,i.y0,i.x1,i.y1),i.colorStops.forEach(l(n)),s.fillStyle=n,s.fillRect(0,0,e.width,e.height);break;case"circle":n=s.createRadialGradient(i.cx,i.cy,0,i.cx,i.cy,i.rx),i.colorStops.forEach(l(n)),s.fillStyle=n,s.fillRect(0,0,e.width,e.height);break;case"ellipse":var a=K.createElement("canvas"),r=a.getContext("2d"),d=Math.max(i.rx,i.ry),h=2*d;a.width=a.height=h,n=r.createRadialGradient(i.rx,i.ry,0,i.rx,i.ry,d),i.colorStops.forEach(l(n)),r.fillStyle=n,r.fillRect(0,0,h,h),s.fillStyle=i.colorStops[i.colorStops.length-1].color,s.fillRect(0,0,o.width,o.height),s.drawImage(a,i.cx-i.rx,i.cy-i.ry,2*i.rx,2*i.ry)}return o}},t.ListAlpha=function(t){for(var e="";e=String.fromCharCode(64+t%26)+e,26<26*(t/=26););return e},t.ListRoman=function(t){var e,i=["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"],n=[1e3,900,500,400,100,90,50,40,10,9,5,4,1],o="",s=i.length;if(t<=0||4e3<=t)return t;for(e=0;e<s;e+=1)for(;n[e]<=t;)t-=n[e],o+=i[e];return o}}(),X.Parse=function(e,c){Y.scroll(0,0);var t=c.elements===j?K.body:c.elements[0],u=t.ownerDocument,p=X.Util,d=p.Support(c,u),f=new RegExp("("+c.ignoreElements+")"),o=u.body,N=p.getCSS,m="___html2canvas___pseudoelement",i=u.createElement("style");function y(t,e){e=parseInt(N(t,e),10);return isNaN(e)?0:e}function v(t,e,i,n,o,s){"transparent"!==s&&(t.setVariable("fillStyle",s),t.fillRect(e,i,n,o),0)}function l(t,e,i){if(0<t.length)return e+i.toUpperCase()}function g(t,e,i,n){null!==t&&0<p.trimText(t).length&&(n.fillText(t,e,i),0)}function w(t,e,i,n){var o=N(e,"fontWeight"),s=N(e,"fontFamily"),a=N(e,"fontSize"),r=p.parseTextShadows(N(e,"textShadow"));switch(parseInt(o,10)){case 401:o="bold";break;case 400:o="normal"}if(t.setVariable("fillStyle",n),t.setVariable("font",[N(e,"fontStyle"),N(e,"fontVariant"),o,a,s].join(" ")),t.setVariable("textAlign","left"),r.length&&(t.setVariable("shadowColor",r[0].color),t.setVariable("shadowOffsetX",r[0].offsetX),t.setVariable("shadowOffsetY",r[0].offsetY),t.setVariable("shadowBlur",r[0].blur)),"none"!==i)return p.Font(s,a,u)}function _(t,e,i,n,o){var s,a,r;return d.rangeBounds&&!o?("none"===i&&0===p.trimText(e).length||(s=e,a=t.node,i=t.textOffset,(r=u.createRange()).setStart(a,i),r.setEnd(a,i+s.length),r=r.getBoundingClientRect()),t.textOffset+=e.length):t.node&&"string"==typeof t.node.nodeValue&&(e=n?t.node.splitText(e.length):null,r=function(t,e){var i=t.parentNode,n=u.createElement("wrapper"),o=t.cloneNode(!0);n.appendChild(t.cloneNode(!0)),i.replaceChild(n,t);e=e?p.OffsetBounds(n):p.Bounds(n);return i.replaceChild(o,n),e}(t.node,o),t.node=e),r}function s(t,e,i){var n,o,s=i.ctx,a=N(t,"color"),r=N(t,"textDecoration"),d=N(t,"textAlign"),h={node:e,textOffset:0};0<p.trimText(e.nodeValue).length&&(e.nodeValue=function(t,e){switch(e){case"lowercase":return t.toLowerCase();case"capitalize":return t.replace(/(^|\s|:|-|\(|\))([a-z])/g,l);case"uppercase":return t.toUpperCase();default:return t}}(e.nodeValue,N(t,"textTransform")),d=d.replace(["-webkit-auto"],["auto"]),o=!c.letterRendering&&/^(left|right|justify|auto)$/.test(d)&&/^(normal|none|0px)$/.test(N(t,"letterSpacing"))?e.nodeValue.split(/(\b| )/):e.nodeValue.split(""),n=w(s,t,r,a),c.chinese&&o.forEach(function(t,e){/.*[\u4E00-\u9FA5].*$/.test(t)&&((t=t.split("")).unshift(e,1),o.splice.apply(o,t))}),o.forEach(function(t,e){e=_(h,t,r,e<o.length-1,i.transform.matrix);e&&(g(t,e.left,e.bottom,s),function(t,e,i,n,o){switch(e){case"underline":v(t,i.left,Math.round(i.top+n.baseline+n.lineWidth),i.width,1,o);break;case"overline":v(t,i.left,Math.round(i.top),i.width,1,o);break;case"line-through":v(t,i.left,Math.ceil(i.top+n.middle+n.lineWidth),i.width,1,o)}}(s,r,e,n,a))}))}function h(t,e){var i,n=function(t){var e=-1,i=1,n=t.parentNode.childNodes;if(t.parentNode){for(;n[++e]!==t;)1===n[e].nodeType&&i++;return i}return-1}(t);switch(e){case"decimal":i=n;break;case"decimal-leading-zero":i=1===n.toString().length?n="0"+n.toString():n.toString();break;case"upper-roman":i=X.Generate.ListRoman(n);break;case"lower-roman":i=X.Generate.ListRoman(n).toLowerCase();break;case"lower-alpha":i=X.Generate.ListAlpha(n).toLowerCase();break;case"upper-alpha":i=X.Generate.ListAlpha(n)}return i+". "}function b(t,e,i){var n,o,s,a=e.ctx,r=N(t,"listStyleType");/^(decimal|decimal-leading-zero|upper-alpha|upper-latin|upper-roman|lower-alpha|lower-greek|lower-latin|lower-roman)$/i.test(r)&&(n=h(t,r),o=t,s=n,(e=u.createElement("boundelement")).style.display="inline",r=o.style.listStyleType,o.style.listStyleType="none",e.appendChild(u.createTextNode(s)),o.insertBefore(e,o.firstChild),s=p.Bounds(e),o.removeChild(e),o.style.listStyleType=r,s=s,w(a,t,"none",N(t,"color")),"inside"===N(t,"listStylePosition")&&(a.setVariable("textAlign","left"),g(n,i.left,s.bottom,a)))}function C(t){t=e[t];return!(!t||!0!==t.succeeded)&&t.img}function k(t,e){var i=Math.max(t.left,e.left),n=Math.max(t.top,e.top);return{left:i,top:n,width:Math.min(t.left+t.width,e.left+e.width)-i,height:Math.min(t.top+t.height,e.top+e.height)-n}}function M(t,e,i,n,o){var s=y(e,"paddingLeft"),a=y(e,"paddingTop"),r=y(e,"paddingRight"),e=y(e,"paddingBottom");W(t,i,0,0,i.width,i.height,n.left+s+o[3].width,n.top+a+o[0].width,n.width-(o[1].width+o[3].width+s+r),n.height-(o[0].width+o[2].width+a+e))}i.innerHTML="."+m+'-before:before { content: "" !important; display: none !important; }.'+m+'-after:after { content: "" !important; display: none !important; }',o.appendChild(i),e=e||{};var a,$=(a=(Math.sqrt(2)-1)/3*4,function(t,e,i,n){var o=i*a,s=n*a,i=t+i,n=e+n;return{topLeft:x({x:t,y:n},{x:t,y:n-s},{x:i-o,y:e},{x:i,y:e}),topRight:x({x:t,y:e},{x:t+o,y:e},{x:i,y:n-s},{x:i,y:n}),bottomRight:x({x:i,y:e},{x:i,y:e+s},{x:t+o,y:n},{x:t,y:n}),bottomLeft:x({x:i,y:n},{x:i-o,y:n},{x:t,y:e+s},{x:t,y:e})}});function x(s,a,r,d){function h(t,e,i){return{x:t.x+(e.x-t.x)*i,y:t.y+(e.y-t.y)*i}}return{start:s,startControl:a,endControl:r,end:d,subdivide:function(t){var e=h(s,a,t),i=h(a,r,t),n=h(r,d,t),o=h(e,i,t),i=h(i,n,t),t=h(o,i,t);return[x(s,e,o,t),x(t,i,n,d)]},curveTo:function(t){t.push(["bezierCurve",a.x,a.y,r.x,r.y,d.x,d.y])},curveToReversed:function(t){t.push(["bezierCurve",r.x,r.y,a.x,a.y,s.x,s.y])}}}function A(t,e,i,n,o,s,a){0<e[0]||0<e[1]?(t.push(["line",n[0].start.x,n[0].start.y]),n[0].curveTo(t),n[1].curveTo(t)):t.push(["line",s,a]),(0<i[0]||0<i[1])&&t.push(["line",o[0].start.x,o[0].start.y])}function O(t,e,i,n,o,s,a){var r=[];return 0<e[0]||0<e[1]?(r.push(["line",n[1].start.x,n[1].start.y]),n[1].curveTo(r)):r.push(["line",t.c1[0],t.c1[1]]),0<i[0]||0<i[1]?(r.push(["line",s[0].start.x,s[0].start.y]),s[0].curveTo(r),r.push(["line",a[0].end.x,a[0].end.y]),a[0].curveToReversed(r)):(r.push(["line",t.c2[0],t.c2[1]]),r.push(["line",t.c3[0],t.c3[1]])),0<e[0]||0<e[1]?(r.push(["line",o[1].end.x,o[1].end.y]),o[1].curveToReversed(r)):r.push(["line",t.c4[0],t.c4[1]]),r}function E(t,e,i){for(var n,o,s,a,r,d,h,l,g,c,u,p,f,m,y,v,w,_,b,C,k,M,x,E=e.left,S=e.top,H=e.width,W=e.height,R=(x=t,["TopLeft","TopRight","BottomRight","BottomLeft"].map(function(t){return N(x,"border"+t+"Radius")})),T=(h=R,l=i,g=(d=e).left,c=d.top,u=d.width,p=d.height,f=h[0][0],m=h[0][1],y=h[1][0],v=h[1][1],w=h[2][0],_=h[2][1],b=h[3][0],C=h[3][1],k=u-y,M=p-_,d=u-w,h=p-C,{topLeftOuter:$(g,c,f,m).topLeft.subdivide(.5),topLeftInner:$(g+l[3].width,c+l[0].width,Math.max(0,f-l[3].width),Math.max(0,m-l[0].width)).topLeft.subdivide(.5),topRightOuter:$(g+k,c,y,v).topRight.subdivide(.5),topRightInner:$(g+Math.min(k,u+l[3].width),c+l[0].width,k>u+l[3].width?0:y-l[3].width,v-l[0].width).topRight.subdivide(.5),bottomRightOuter:$(g+d,c+M,w,_).bottomRight.subdivide(.5),bottomRightInner:$(g+Math.min(d,u+l[3].width),c+Math.min(M,p+l[0].width),Math.max(0,w-l[1].width),Math.max(0,_-l[2].width)).bottomRight.subdivide(.5),bottomLeftOuter:$(g,c+h,b,C).bottomLeft.subdivide(.5),bottomLeftInner:$(g+l[3].width,c+h,Math.max(0,b-l[3].width),Math.max(0,C-l[2].width)).bottomLeft.subdivide(.5)}),I={clip:function(t,e,i,n,o){var s=[];switch(N(t,"backgroundClip")){case"content-box":case"padding-box":A(s,n[0],n[1],e.topLeftInner,e.topRightInner,o.left+i[3].width,o.top+i[0].width),A(s,n[1],n[2],e.topRightInner,e.bottomRightInner,o.left+o.width-i[1].width,o.top+i[0].width),A(s,n[2],n[3],e.bottomRightInner,e.bottomLeftInner,o.left+o.width-i[1].width,o.top+o.height-i[2].width),A(s,n[3],n[0],e.bottomLeftInner,e.topLeftInner,o.left+i[3].width,o.top+o.height-i[2].width);break;default:A(s,n[0],n[1],e.topLeftOuter,e.topRightOuter,o.left,o.top),A(s,n[1],n[2],e.topRightOuter,e.bottomRightOuter,o.left+o.width,o.top),A(s,n[2],n[3],e.bottomRightOuter,e.bottomLeftOuter,o.left+o.width,o.top+o.height),A(s,n[3],n[0],e.bottomLeftOuter,e.topLeftOuter,o.left,o.top+o.height)}return s}(t,T,i,R,e),borders:[]},D=0;D<4;D++)if(0<i[D].width){switch(n=E,o=S,s=H,a=W-i[2].width,D){case 0:a=i[0].width,r=O({c1:[n,o],c2:[n+s,o],c3:[n+s-i[1].width,o+a],c4:[n+i[3].width,o+a]},R[0],R[1],T.topLeftOuter,T.topLeftInner,T.topRightOuter,T.topRightInner);break;case 1:r=O({c1:[(n=E+H-i[1].width)+(s=i[1].width),o],c2:[n+s,o+a+i[2].width],c3:[n,o+a],c4:[n,o+i[0].width]},R[1],R[2],T.topRightOuter,T.topRightInner,T.bottomRightOuter,T.bottomRightInner);break;case 2:r=O({c1:[n+s,(o=o+W-i[2].width)+(a=i[2].width)],c2:[n,o+a],c3:[n+i[3].width,o],c4:[n+s-i[3].width,o]},R[2],R[3],T.bottomRightOuter,T.bottomRightInner,T.bottomLeftOuter,T.bottomLeftInner);break;case 3:s=i[3].width,r=O({c1:[n,o+a+i[2].width],c2:[n,o],c3:[n+s,o+i[0].width],c4:[n+s,o+a]},R[3],R[0],T.bottomLeftOuter,T.bottomLeftInner,T.topLeftOuter,T.topLeftInner)}I.borders.push({args:r,color:i[D].color})}return I}function S(t,e){var i=t.drawShape();return e.forEach(function(t,e){i[0===e?"moveTo":t[0]+"To"].apply(null,t.slice(1))}),i}function H(e,t,i){var n=u.createElement("valuewrap");["lineHeight","textAlign","fontFamily","color","fontSize","paddingLeft","paddingTop","width","height","border","borderLeftWidth","borderTopWidth"].forEach(function(t){try{n.style[t]=N(e,t)}catch(t){p.log("html2canvas: Parse: Exception caught in renderFormValue: "+t.message)}}),n.style.borderColor="black",n.style.borderStyle="solid",n.style.display="block",n.style.position="absolute",!/^(submit|reset|button|text|password)$/.test(e.type)&&"SELECT"!==e.nodeName||(n.style.lineHeight=N(e,"height")),n.style.top=t.top+"px",n.style.left=t.left+"px",t=(t="SELECT"===e.nodeName?(e.options[e.selectedIndex]||0).text:e.value)||e.placeholder,t=u.createTextNode(t),n.appendChild(t),o.appendChild(n),s(e,t,i),o.removeChild(n)}function W(t){t.drawImage.apply(t,Array.prototype.slice.call(arguments,1)),0}function R(t,e){var i=Y.getComputedStyle(t,e);if(i&&i.content&&"none"!==i.content&&"-moz-alt-content"!==i.content&&"none"!==i.display){var t=i.content+"",e=t.substr(0,1),e="url"===(t=e===t.substr(t.length-1)&&e.match(/'|"/)?t.substr(1,t.length-2):t).substr(0,3),n=K.createElement(e?"img":"span");return n.className=m+"-before "+m+"-after",Object.keys(i).filter(r).forEach(function(e){try{n.style[e]=i[e]}catch(t){p.log(["Tried to assign readonly property ",e,"Error:",t])}}),e?n.src=p.parseBackgroundImage(t)[0].args[0]:n.innerHTML=t,n}}function r(t){return isNaN(Y.parseInt(t,10))}function T(t,e,i,n){var o=Math.round(n.left+i.left),i=Math.round(n.top+i.top);t.createPattern(e),t.translate(o,i),t.fill(),t.translate(-o,-i)}function I(t,e,i,n,o,s,a,r){var d=[];d.push(["line",Math.round(o),Math.round(s)]),d.push(["line",Math.round(o+a),Math.round(s)]),d.push(["line",Math.round(o+a),Math.round(r+s)]),d.push(["line",Math.round(o),Math.round(r+s)]),S(t,d),t.save(),t.clip(),T(t,e,i,n),t.restore()}function D(t,e,i,n,o){var s=p.BackgroundSize(t,e,n,o),a=p.BackgroundPosition(t,e,n,o,s),t=N(t,"backgroundRepeat").split(",").map(p.trimText);switch(n=function(t,e){if(t.width===e.width&&t.height===e.height)return t;var i=u.createElement("canvas");return i.width=e.width,i.height=e.height,W(i.getContext("2d"),t,0,0,t.width,t.height,0,0,e.width,e.height),i}(n,s),t=t[o]||t[0]){case"repeat-x":I(i,n,a,e,e.left,e.top+a.top,99999,n.height);break;case"repeat-y":I(i,n,a,e,e.left+a.left,e.top,n.width,99999);break;case"no-repeat":I(i,n,a,e,e.left+a.left,e.top+a.top,n.width,n.height);break;default:T(i,n,a,{top:e.top,left:e.left,width:n.width,height:n.height})}}function U(t){return t.replace("px","")}var n,z,P,L=/(matrix)\((.+)\)/;function G(t,e,i,n){var o,s,a,r,d,h,l=(d=e?i.width:Math.max(Math.max(u.body.scrollWidth,u.documentElement.scrollWidth),Math.max(u.body.offsetWidth,u.documentElement.offsetWidth),Math.max(u.body.clientWidth,u.documentElement.clientWidth)),r=e?i.height:Math.max(Math.max(u.body.scrollHeight,u.documentElement.scrollHeight),Math.max(u.body.offsetHeight,u.documentElement.offsetHeight),Math.max(u.body.clientHeight,u.documentElement.clientHeight)),{storage:s=[],width:d,height:r,clip:function(){s.push({type:"function",name:"clip",arguments:arguments})},translate:function(){s.push({type:"function",name:"translate",arguments:arguments})},fill:function(){s.push({type:"function",name:"fill",arguments:arguments})},save:function(){s.push({type:"function",name:"save",arguments:arguments})},restore:function(){s.push({type:"function",name:"restore",arguments:arguments})},fillRect:function(){s.push({type:"function",name:"fillRect",arguments:arguments})},createPattern:function(){s.push({type:"function",name:"createPattern",arguments:arguments})},drawShape:function(){var t=[];return s.push({type:"function",name:"drawShape",arguments:t}),{moveTo:function(){t.push({name:"moveTo",arguments:arguments})},lineTo:function(){t.push({name:"lineTo",arguments:arguments})},arcTo:function(){t.push({name:"arcTo",arguments:arguments})},bezierCurveTo:function(){t.push({name:"bezierCurveTo",arguments:arguments})},quadraticCurveTo:function(){t.push({name:"quadraticCurveTo",arguments:arguments})}}},drawImage:function(){s.push({type:"function",name:"drawImage",arguments:arguments})},fillText:function(){s.push({type:"function",name:"fillText",arguments:arguments})},setVariable:function(t,e){return s.push({type:"variable",name:t,arguments:e}),e}}),g={ctx:l,opacity:(h=e,l.setVariable("globalAlpha",N(t,"opacity")*(h?h.opacity:1))),cssPosition:N(t,"position"),borders:(o=t,["Top","Right","Bottom","Left"].map(function(t){return{width:y(o,"border"+t+"Width"),color:N(o,"border"+t+"Color")}})),transform:n,clip:e&&e.clip?p.Extend({},e.clip):null};return a=t,d=e,l="static"!==(r=g).cssPosition,h=l?N(a,"zIndex"):"auto",n=N(a,"opacity"),e="none"!==N(a,"cssFloat"),r.zIndex=a={zindex:h,children:[]},a.isPositioned=l,a.isFloated=e,a.opacity=n,a.ownStacking="auto"!==h||n<1,d&&d.zIndex.children.push(r),!0===c.useOverflow&&!0===/(hidden|scroll|auto)/.test(N(t,"overflow"))&&!1===/(BODY)/i.test(t.nodeName)&&(g.clip=g.clip?k(g.clip,i):i),g}function B(t,e,i,n){var o,s,a,r,r=(r=N(s=t,"transform")||N(s,"-webkit-transform")||N(s,"-moz-transform")||N(s,"-ms-transform")||N(s,"-o-transform"),s=(s=N(s,"transform-origin")||N(s,"-webkit-transform-origin")||N(s,"-moz-transform-origin")||N(s,"-ms-transform-origin")||N(s,"-o-transform-origin")||"0px 0px").split(" ").map(U).map(p.asFloat),!r||"none"===r||(r=r.match(L))&&"matrix"===r[1]&&(a=r[2].split(",").map(p.trimText).map(p.asFloat)),{origin:s,matrix:a}),d=(s=t,s=(a=r).matrix?p.OffsetBounds(s):p.Bounds(s),a.origin[0]+=s.left,a.origin[1]+=s.top,s),h=G(t,e,d,r),l=h.borders,g=h.ctx,c=(e=l,r=h.clip,e={left:d.left+e[3].width,top:d.top+e[0].width,width:d.width-(e[1].width+e[3].width),height:d.height-(e[0].width+e[2].width)},e=r?k(e,r):e),r=E(t,d,l),e=f.test(t.nodeName)?"#efefef":N(t,"backgroundColor");switch(S(g,r.clip),g.save(),g.clip(),0<c.height&&0<c.width&&!n?(v(g,d.left,d.top,d.width,d.height,e),function(t,e,i){for(var n,o=N(t,"backgroundImage"),s=p.parseBackgroundImage(o),a=s.length;a--;)(o=s[a]).args&&0!==o.args.length&&((n=C("url"===o.method?o.args[0]:o.value))?D(t,e,i,n,a):p.log("html2canvas: Error loading background:",o))}(t,c,g)):n&&(h.backgroundColor=e),g.restore(),r.borders.forEach(function(t){var e,i;e=g,i=t.args,"transparent"!==(t=t.color)&&(e.setVariable("fillStyle",t),S(e,i),e.fill(),0)}),i||(n=h,r=R(e=t,":before"),i=R(e,":after"),(r||i)&&(r&&(e.className+=" "+m+"-before",e.parentNode.insertBefore(r,e),V(r,n,!0),e.parentNode.removeChild(r),e.className=e.className.replace(m+"-before","").trim()),i&&(e.className+=" "+m+"-after",e.appendChild(i),V(i,n,!0),e.removeChild(i),e.className=e.className.replace(m+"-after","").trim()))),t.nodeName){case"IMG":(o=C(t.getAttribute("src")))?M(g,t,o,d,l):p.log("html2canvas: Error loading <img>:"+t.getAttribute("src"));break;case"INPUT":/^(text|url|email|submit|button|reset)$/.test(t.type)&&0<(t.value||t.placeholder||"").length&&H(t,d,h);break;case"TEXTAREA":0<(t.value||t.placeholder||"").length&&H(t,d,h);break;case"SELECT":0<(t.options||t.placeholder||"").length&&H(t,d,h);break;case"LI":b(t,h,c);break;case"CANVAS":M(g,t,t,d,l)}return h}function V(t,e,i){var n;"none"===N(n=t,"display")||"hidden"===N(n,"visibility")||n.hasAttribute("data-html2canvas-ignore")||(e=B(t,e,i,!1)||e,f.test(t.nodeName)||F(t,e,i))}function F(e,i,n){p.Children(e).forEach(function(t){t.nodeType===t.ELEMENT_NODE?V(t,i,n):t.nodeType===t.TEXT_NODE&&s(e,t,i)})}return n=N(K.documentElement,"backgroundColor"),z=p.isTransparent(n)&&t===K.body,P=B(t,null,!1,z),F(t,P),z&&(n=P.backgroundColor),o.removeChild(i),{backgroundColor:n,stack:P}},X.Preload=function(a){var n,o,t,e,r={numLoaded:0,numFailed:0,numTotal:0,cleanupDone:!1},s=X.Util,d=0,i=a.elements[0]||K.body,h=i.ownerDocument,l=i.getElementsByTagName("img"),g=l.length,c=h.createElement("a"),u=(new Image).crossOrigin!==j;function p(){s.log("html2canvas: start: images: "+r.numLoaded+" / "+r.numTotal+" (failed: "+r.numFailed+")"),!r.firstRun&&r.numLoaded>=r.numTotal&&(s.log("Finished loading images: # "+r.numTotal+" (failed: "+r.numFailed+")"),"function"==typeof a.complete&&a.complete(r))}function f(t,e,i){var n,o,s=a.proxy;c.href=t,t=c.href,n="html2canvas_"+d++,i.callbackname=n,-1<s.indexOf("?")?s+="&":s+="?",s+="url="+encodeURIComponent(t)+"&callback="+n,o=h.createElement("script"),Y[n]=function(t){"error:"===t.substring(0,6)?(i.succeeded=!1,r.numLoaded++,r.numFailed++,p()):(w(e,i),e.src=t),Y[n]=j;try{delete Y[n]}catch(t){}o.parentNode.removeChild(o),o=null,delete i.script,delete i.callbackname},o.setAttribute("type","text/javascript"),o.setAttribute("src",s),i.script=o,Y.document.body.appendChild(o)}function m(t,e){var i=Y.getComputedStyle(t,e),e=i.content;"url"===e.substr(0,3)&&o.loadImage(X.Util.parseBackgroundImage(e)[0].args[0]),v(i.backgroundImage,t)}function y(t){return t&&t.method&&t.args&&0<t.args.length}function v(t,i){var n;X.Util.parseBackgroundImage(t).filter(y).forEach(function(t){var e;"url"===t.method?o.loadImage(t.args[0]):t.method.match(/\-?gradient$/)&&(n===j&&(n=X.Util.Bounds(i)),e=t.value,t=n,(t=X.Generate.Gradient(e,t))!==j&&(r[e]={img:t,succeeded:!0},r.numTotal++,r.numLoaded++,p()))})}function w(e,i){e.onload=function(){i.timer!==j&&Y.clearTimeout(i.timer),r.numLoaded++,i.succeeded=!0,e.onerror=e.onload=null,p()},e.onerror=function(){if("anonymous"===e.crossOrigin&&(Y.clearTimeout(i.timer),a.proxy)){var t=e.src;return e=new Image,(i.img=e).src=t,void f(e.src,e,i)}r.numLoaded++,r.numFailed++,i.succeeded=!1,e.onerror=e.onload=null,p()}}for(c.href=Y.location.href,n=c.protocol+c.host,o={loadImage:function(t){var e,i;t&&r[t]===j&&(e=new Image,t.match(/data:image\/.*;base64,/i)?(e.src=t.replace(/url\(['"]{0,}|['"]{0,}\)$/gi,""),i=r[t]={img:e},r.numTotal++,w(e,i)):(c.href=t,c.href=c.href,c.protocol+c.host===n||!0===a.allowTaint?(i=r[t]={img:e},r.numTotal++,w(e,i),e.src=t):u&&!a.allowTaint&&a.useCORS?(e.crossOrigin="anonymous",i=r[t]={img:e},r.numTotal++,w(e,i),e.src=t):a.proxy&&(i=r[t]={img:e},r.numTotal++,f(t,e,i))))},cleanupDOM:function(t){var e,i;if(!r.cleanupDone){for(i in t&&"string"==typeof t?s.log("html2canvas: Cleanup because: "+t):s.log("html2canvas: Cleanup after timeout: "+a.timeout+" ms."),r)if(r.hasOwnProperty(i)&&"object"==typeof(e=r[i])&&e.callbackname&&e.succeeded===j){Y[e.callbackname]=j;try{delete Y[e.callbackname]}catch(t){}e.script&&e.script.parentNode&&(e.script.setAttribute("src","about:blank"),e.script.parentNode.removeChild(e.script)),r.numLoaded++,r.numFailed++,s.log("html2canvas: Cleaned up failed img: '"+i+"' Steps: "+r.numLoaded+" / "+r.numTotal)}Y.stop!==j?Y.stop():K.execCommand!==j&&K.execCommand("Stop",!1),K.close!==j&&K.close(),r.cleanupDone=!0,t&&"string"==typeof t||p()}},renderingDone:function(){e&&Y.clearTimeout(e)}},0<a.timeout&&(e=Y.setTimeout(o.cleanupDOM,a.timeout)),s.log("html2canvas: Preload starts: finding background-images"),r.firstRun=!0,function t(e){var i=!1;try{s.Children(e).forEach(t)}catch(t){}try{i=e.nodeType}catch(t){i=!1,s.log("html2canvas: failed to access some element's nodeType - Exception: "+t.message)}if(1===i||i===j){m(i=e,":before"),m(i,":after");try{v(s.getCSS(e,"backgroundImage"),e)}catch(t){s.log("html2canvas: failed to get background-image - Exception: "+t.message)}v(e)}}(i),s.log("html2canvas: Preload: Finding images"),t=0;t<g;t+=1)o.loadImage(l[t].getAttribute("src"));return r.firstRun=!1,s.log("html2canvas: Preload: Done."),r.numTotal===r.numLoaded&&p(),o},X.Renderer=function(t,i){return function(t){var e;if("string"==typeof i.renderer&&X.Renderer[t]!==j)e=X.Renderer[t](i);else{if("function"!=typeof t)throw new Error("Unknown renderer");e=t(i)}if("function"!=typeof e)throw new Error("Invalid renderer defined");return e}(i.renderer)(t,i,K,function(t){var e,r=[];return function e(t,i,n){var o="auto"===i.zIndex.zindex?0:Number(i.zIndex.zindex),s=t,a=i.zIndex.isPositioned,r=i.zIndex.isFloated,d={node:i},h=n;i.zIndex.ownStacking?(s=d.context={"!":[{node:i,children:[]}]},h=j):(a||r)&&(h=d.children=[]),0===o&&n?n.push(d):(t[o]||(t[o]=[]),t[o].push(d)),i.zIndex.children.forEach(function(t){e(s,t,h)})}(e={},t),function s(a){Object.keys(a).sort().forEach(function(t){var e=[],i=[],n=[],o=[];a[t].forEach(function(t){(t.node.zIndex.isPositioned||t.node.zIndex.opacity<1?n:t.node.zIndex.isFloated?i:e).push(t)}),function e(t){t.forEach(function(t){o.push(t),t.children&&e(t.children)})}(e.concat(i,n)),o.forEach(function(t){t.context?s(t.context):r.push(t.node)})})}(e),r}(t.stack),X)},X.Util.Support=function(t,n){return{rangeBounds:(o=!1,n.createRange&&(e=n.createRange()).getBoundingClientRect&&((i=n.createElement("boundtest")).style.height="123px",i.style.display="block",n.body.appendChild(i),e.selectNode(i),123===e.getBoundingClientRect().height&&(o=!0),n.body.removeChild(i)),o),svgRendering:t.svgRendering&&function(){var t=new Image,e=n.createElement("canvas"),i=e.getContext!==j&&e.getContext("2d");if(!1===i)return!1;e.width=e.height=10,t.src=["data:image/svg+xml,","<svg xmlns='http://www.w3.org/2000/svg' width='10' height='10'>","<foreignObject width='10' height='10'>","<div xmlns='http://www.w3.org/1999/xhtml' style='width:10;height:10;'>","sup","</div>","</foreignObject>","</svg>"].join("");try{i.drawImage(t,0,0),e.toDataURL()}catch(t){return!1}return X.Util.log("html2canvas: Parse: SVG powered rendering available"),!0}()};var e,i,o},Y.html2canvas=function(t,e){var i,n={logging:!1,elements:t=t.length?t:[t],background:"#fff",proxy:null,timeout:0,useCORS:!1,allowTaint:!1,svgRendering:!1,ignoreElements:"IFRAME|OBJECT|PARAM",useOverflow:!0,letterRendering:!1,chinese:!1,width:null,height:null,taintTest:!0,renderer:"Canvas"},n=X.Util.Extend(e,n);return X.logging=n.logging,n.complete=function(t){"function"==typeof n.onpreloaded&&!1===n.onpreloaded(t)||(i=X.Parse(t,n),"function"==typeof n.onparsed&&!1===n.onparsed(i)||(i=X.Renderer(i,n),"function"==typeof n.onrendered&&n.onrendered(i)))},Y.setTimeout(function(){X.Preload(n)},0),{render:function(t,e){return X.Renderer(t,X.Util.Extend(e,n))},parse:function(t,e){return X.Parse(t,X.Util.Extend(e,n))},preload:function(t){return X.Preload(X.Util.Extend(t,n))},log:X.Util.log}},Y.html2canvas.log=X.Util.log,Y.html2canvas.Renderer={Canvas:j},X.Renderer.Canvas=function(o){o=o||{};var s=K,a=[],r=K.createElement("canvas"),d=r.getContext("2d"),h=X.Util,l=o.canvas||s.createElement("canvas");function g(t,e){switch(e.type){case"variable":t[e.name]=e.arguments;break;case"function":switch(e.name){case"createPattern":if(0<e.arguments[0].width&&0<e.arguments[0].height)try{t.fillStyle=t.createPattern(e.arguments[0],"repeat")}catch(t){h.log("html2canvas: Renderer: Error creating pattern",t.message)}break;case"drawShape":i=t,n=e.arguments,i.beginPath(),n.forEach(function(t){i[t.name].apply(i,t.arguments)}),i.closePath();break;case"drawImage":0<e.arguments[8]&&0<e.arguments[7]&&(!o.taintTest||o.taintTest&&function(t){if(-1===a.indexOf(t.arguments[0].src)){d.drawImage(t.arguments[0],0,0);try{d.getImageData(0,0,1,1)}catch(t){return r=s.createElement("canvas"),void(d=r.getContext("2d"))}a.push(t.arguments[0].src)}return 1}(e))&&t.drawImage.apply(t,e.arguments);break;default:t[e.name].apply(t,e.arguments)}}var i,n}return function(t,e,i,n,o){var s,a=l.getContext("2d"),r=t.stack;return l.width=l.style.width=e.width||r.ctx.width,l.height=l.style.height=e.height||r.ctx.height,s=a.fillStyle,a.fillStyle=h.isTransparent(r.backgroundColor)&&e.background!==j?e.background:t.backgroundColor,a.fillRect(0,0,l.width,l.height),a.fillStyle=s,n.forEach(function(t){a.textBaseline="bottom",a.save(),t.transform.matrix&&(a.translate(t.transform.origin[0],t.transform.origin[1]),a.transform.apply(a,t.transform.matrix),a.translate(-t.transform.origin[0],-t.transform.origin[1])),t.clip&&(a.beginPath(),a.rect(t.clip.left,t.clip.top,t.clip.width,t.clip.height),a.clip()),t.ctx.storage&&t.ctx.storage.forEach(function(t){g(a,t)}),a.restore()}),h.log("html2canvas: Renderer: Canvas renderer done - returning canvas obj"),1===e.elements.length&&"object"==typeof e.elements[0]&&"BODY"!==e.elements[0].nodeName?(e=o.Util.Bounds(e.elements[0]),(i=i.createElement("canvas")).width=Math.ceil(e.width),i.height=Math.ceil(e.height),(a=i.getContext("2d")).drawImage(l,e.left,e.top,e.width,e.height,0,0,e.width,e.height),l=null,i):l}}}(window,document);var k,M,x,E={initializeBasePanel:function(){this.MAP_MODEL_2_DOCUMENT_MODEL_KEY=_.zipObject([this.KEY_ROW_COUNT,this.KEY_ROW_HEIGHT],["rowCount","rowHeight"]),this.api={setProperty:function(t,e){this.documentModel.set(this.MAP_MODEL_2_DOCUMENT_MODEL_KEY[t],e)}.bind(this)};var t={};this.listenTo(this.documentModel,"change:colCount",this.onChange_BasePanel_colCount),this.listenTo(this.documentModel,"change:floatable",this.onChange_BasePanel_floatable),this.listenTo(this.documentModel,"change:relativeHeight",this.onChange_BasePanel_relativeHeight),this.listenTo(this.documentModel,"change:rowHeight",this.onChange_BasePanel_rowHeight),this.listenTo(this.documentModel,"change:rowCount",this.onChange_BasePanel_rowCount),this.listenTo(this.documentModel,"change:worksheetPadding",this.onChange_BasePanel_worksheetPadding),this.setupChangeSet_colCount(t),this.setupChangeSet_floatable(t),this.setupChangeSet_relativeHeight(t),this.setupChangeSet_rowCount(t),this.setupChangeSet_rowHeight(t),this.onSettingsChange(t)},onChange_BasePanel_colCount:function(){this.model.set("colCount",this.documentModel.get("colCount")),this.onSettingsChange(this.setupChangeSet_colCount())},onChange_BasePanel_floatable:function(){this.model.set("floatable",this.documentModel.get("floatable")),this.onSettingsChange(this.setupChangeSet_floatable())},onChange_BasePanel_relativeHeight:function(){this.model.set("relativeHeight",this.documentModel.get("relativeHeight")),this.onSettingsChange(this.setupChangeSet_relativeHeight())},onChange_BasePanel_rowCount:function(){this.model.set("rowCount",this.documentModel.get("rowCount")),this.onSettingsChange(this.setupChangeSet_rowCount())},onChange_BasePanel_rowHeight:function(){this.model.set("rowHeight",this.documentModel.get("rowHeight")),this.onSettingsChange(this.setupChangeSet_rowHeight())},onChange_BasePanel_worksheetPadding:function(){this.set_gridstackMargin(),this.applyGridStackMargin(),this.onResize(!0)},regenerateThumb:function(){var o=this;this.widgets.length<=0?o.model.set("thumb",null):html2canvas(this.$gridstack,{onrendered:function(t){var e=$(t).attr("height"),i=$(t).attr("width"),n=e/i;200<=i&&n<=1?e=(i=200)*n:100<=e&&(i=(e=100)/n),o.model.set("thumb",l.convertToPNG(t,i,e).src)}})},set_gridstackMargin:function(){this.gridstackMargin=this.documentModel.get("worksheetPadding"),_.isNumber(this.gridstackMargin)||(this.gridstackMargin=10)},setChangeSetKey:function(t,e,i){return t[e]=this.documentModel.get(i),t},setDocumentModelProperty:function(t,e){this.documentModel.set(t,e),this.updatePropertyInspectorForBasePanel()},setupChangeSet_colCount:function(t){return this.setChangeSetKey(t||{},this.KEY_COLUMN_COUNT,"colCount")},setupChangeSet_floatable:function(t){return this.setChangeSetKey(t||{},this.KEY_FLOATABLE,"floatable")},setupChangeSet_relativeHeight:function(t){return this.setChangeSetKey(t||{},this.KEY_RELATIVE_HEIGHT,"relativeHeight")},setupChangeSet_rowCount:function(t){return this.setChangeSetKey(t||{},this.KEY_ROW_COUNT,"rowCount")},setupChangeSet_rowHeight:function(t){return this.setChangeSetKey(t||{},this.KEY_ROW_HEIGHT,"rowHeight")},updatePropertyInspectorForBasePanel:function(){this.documentModel.trigger("basePanelLayoutChanged")}};function S(t){x.GridStackDragDropPlugin.call(this,t)}!function(p,h){var t=window,e=function(t,e,i){var n=function(){console.warn("gridstack.js: Function `"+e+"` is deprecated as of v0.2.5 and has been replaced "+"with `"+i+"`. It will be **completely** removed in v1.0.");return t.apply(this,arguments)};n.prototype=t.prototype;return n},d=function(t,e){console.warn("gridstack.js: Option `"+t+"` is deprecated as of v0.2.5 and has been replaced with `"+e+"`. It will be **completely** removed in v1.0.")},f={isIntercepted:function(t,e){return!(t.x+t.width<=e.x||e.x+e.width<=t.x||t.y+t.height<=e.y||e.y+e.height<=t.y)},sort:function(t,e,i){i=i||h.chain(t).map(function(t){return t.x+t.width}).max().value();e=e!=-1?1:-1;return h.sortBy(t,[function(t){return e*(t.x+t.y*i)}])},createStylesheet:function(t){var e=document.createElement("style");e.setAttribute("type","text/css");e.setAttribute("data-gs-style-id",t);if(e.styleSheet)e.styleSheet.cssText="";else e.appendChild(document.createTextNode(""));document.getElementsByTagName("head")[0].appendChild(e);return e.sheet},removeStylesheet:function(t){p("STYLE[data-gs-style-id="+t+"]").remove()},insertCSSRule:function(t,e,i,n){if(typeof t.insertRule==="function")t.insertRule(e+"{"+i+"}",n);else if(typeof t.addRule==="function")t.addRule(e,i,n)},toBool:function(t){if(typeof t=="boolean")return t;if(typeof t=="string"){t=t.toLowerCase();return!(t===""||t=="no"||t=="false"||t=="0")}return Boolean(t)},_collisionNodeCheck:function(t){return t!=this.node&&f.isIntercepted(t,this.nn)},_didCollide:function(t){return f.isIntercepted({x:this.n.x,y:this.newY,width:this.n.width,height:this.n.height},t)},_isAddNodeIntercepted:function(t){return f.isIntercepted({x:this.x,y:this.y,width:this.node.width,height:this.node.height},t)},parseHeight:function(t){var e=t;var i="px";if(e&&h.isString(e)){var n=e.match(/^(-[0-9]+\.[0-9]+|[0-9]*\.[0-9]+|-[0-9]+|[0-9]+)(px|em|rem|vh|vw)?$/);if(!n)throw new Error("Invalid height");i=n[2]||"px";e=parseFloat(n[1])}return{height:e,unit:i}},removePositioningStyles:function(t){var e=t[0].style;if(e.position)e.removeProperty("position");if(e.left)e.removeProperty("left");if(e.top)e.removeProperty("top");if(e.width)e.removeProperty("width");if(e.height)e.removeProperty("height")},getScrollParent:function(t){var e;if(t==null)e=null;else if(t.scrollHeight>t.clientHeight)e=t;else e=f.getScrollParent(t.parentNode);return e},updateScrollPosition:function(t,e,i){var n=t.getBoundingClientRect();var o=window.innerHeight||document.documentElement.clientHeight;if(n.top<0||n.bottom>o){var s=n.bottom-o;var a=n.top;var r=f.getScrollParent(t);if(r!=null){var d=r.scrollTop;if(n.top<0&&i<0)if(t.offsetHeight>o)r.scrollTop+=i;else r.scrollTop+=Math.abs(a)>Math.abs(i)?i:a;else if(i>0)if(t.offsetHeight>o)r.scrollTop+=i;else r.scrollTop+=s>i?i:s;e.position.top+=r.scrollTop-d}}}};function u(t){this.grid=t}f.is_intercepted=e(f.isIntercepted,"is_intercepted","isIntercepted"),f.create_stylesheet=e(f.createStylesheet,"create_stylesheet","createStylesheet"),f.remove_stylesheet=e(f.removeStylesheet,"remove_stylesheet","removeStylesheet"),f.insert_css_rule=e(f.insertCSSRule,"insert_css_rule","insertCSSRule"),u.registeredPlugins=[],u.registerPlugin=function(t){u.registeredPlugins.push(t)},u.prototype.resizable=function(t,e){return this},u.prototype.draggable=function(t,e){return this},u.prototype.droppable=function(t,e){return this},u.prototype.isDroppable=function(t){return false},u.prototype.on=function(t,e,i){return this};var s=0,m=function(t,e,i,n,o){this.width=t;this.float=i||false;this.height=n||0;this.nodes=o||[];this.onchange=e||function(){};this._updateCounter=0;this._float=this.float;this._addedNodes=[];this._removedNodes=[]};m.prototype.batchUpdate=function(){this._updateCounter=1;this.float=true},m.prototype.commit=function(){if(this._updateCounter!==0){this._updateCounter=0;this.float=this._float;this._packNodes();this._notify()}},m.prototype.getNodeDataByDOMEl=function(e){return h.find(this.nodes,function(t){return e.get(0)===t.el.get(0)})},m.prototype._fixCollisions=function(t){var e=this;this._sortNodes(-1);var i=t;var n=Boolean(h.find(this.nodes,function(t){return t.locked}));if(!this.float&&!n)i={x:0,y:t.y,width:this.width,height:t.height};while(true){var o=h.find(this.nodes,h.bind(f._collisionNodeCheck,{node:t,nn:i}));if(typeof o=="undefined")return;this.moveNode(o,o.x,t.y+t.height,o.width,o.height,true)}},m.prototype.isAreaEmpty=function(t,e,i,n){var o={x:t||0,y:e||0,width:i||1,height:n||1};var s=h.find(this.nodes,h.bind(function(t){return f.isIntercepted(t,o)},this));return s===null||typeof s==="undefined"},m.prototype._sortNodes=function(t){this.nodes=f.sort(this.nodes,t,this.width)},m.prototype._packNodes=function(){this._sortNodes();if(this.float)h.each(this.nodes,h.bind(function(t,e){if(t._updating||typeof t._origY=="undefined"||t.y==t._origY)return;var i=t.y;while(i>=t._origY){var n=h.chain(this.nodes).take(e).find(h.bind(f._didCollide,{n:t,newY:i})).value();if(!n){t._dirty=true;t.y=i}--i}},this));else h.each(this.nodes,h.bind(function(t,e){if(t.locked)return;while(t.y>0){var i=t.y-1;var n=e===0;if(e>0){var o=h.chain(this.nodes).take(e).find(h.bind(f._didCollide,{n:t,newY:i})).value();n=typeof o=="undefined"}if(!n)break;t._dirty=t.y!=i;t.y=i}},this))},m.prototype._prepareNode=function(t,e){t=h.defaults(t||{},{width:1,height:1,x:0,y:0});t.x=parseInt(""+t.x);t.y=parseInt(""+t.y);t.width=parseInt(""+t.width);t.height=parseInt(""+t.height);t.autoPosition=t.autoPosition||false;t.noResize=t.noResize||false;t.noMove=t.noMove||false;if(t.width>this.width)t.width=this.width;else if(t.width<1)t.width=1;if(t.height<1)t.height=1;if(t.x<0)t.x=0;if(t.x+t.width>this.width)if(e)t.width=this.width-t.x;else t.x=this.width-t.width;if(t.y<0)t.y=0;return t},m.prototype._notify=function(){var t=Array.prototype.slice.call(arguments,0);t[0]=typeof t[0]==="undefined"?[]:[t[0]];t[1]=typeof t[1]==="undefined"?true:t[1];if(this._updateCounter)return;var e=t[0].concat(this.getDirtyNodes());this.onchange(e,t[1])},m.prototype.cleanNodes=function(){if(this._updateCounter)return;h.each(this.nodes,function(t){t._dirty=false})},m.prototype.getDirtyNodes=function(){return h.filter(this.nodes,function(t){return t._dirty})},m.prototype.addNode=function(t,e){t=this._prepareNode(t);if(typeof t.maxWidth!="undefined")t.width=Math.min(t.width,t.maxWidth);if(typeof t.maxHeight!="undefined")t.height=Math.min(t.height,t.maxHeight);if(typeof t.minWidth!="undefined")t.width=Math.max(t.width,t.minWidth);if(typeof t.minHeight!="undefined")t.height=Math.max(t.height,t.minHeight);t._id=++s;t._dirty=true;if(t.autoPosition){this._sortNodes();for(var i=0;;++i){var n=i%this.width;var o=Math.floor(i/this.width);if(n+t.width>this.width)continue;if(!h.find(this.nodes,h.bind(f._isAddNodeIntercepted,{x:n,y:o,node:t}))){t.x=n;t.y=o;break}}}this.nodes.push(t);if(typeof e!="undefined"&&e)this._addedNodes.push(h.clone(t));this._fixCollisions(t);this._packNodes();this._notify();return t},m.prototype.removeNode=function(t,e){e=typeof e==="undefined"?true:e;this._removedNodes.push(h.clone(t));t._id=null;this.nodes=h.without(this.nodes,t);this._packNodes();this._notify(t,e)},m.prototype.canMoveNode=function(e,t,i,n,o){if(!this.isNodeChangedPosition(e,t,i,n,o))return false;var s=Boolean(h.find(this.nodes,function(t){return t.locked}));if(!this.height&&!s)return true;var a;var r=new m(this.width,null,this.float,0,h.map(this.nodes,function(t){if(t==e){a=p.extend({},t);return a}return p.extend({},t)}));if(typeof a==="undefined")return true;r.moveNode(a,t,i,n,o);var d=true;if(s)d&=!Boolean(h.find(r.nodes,function(t){return t!=a&&Boolean(t.locked)&&Boolean(t._dirty)}));if(this.height)d&=r.getGridHeight()<=this.height;return d},m.prototype.canBePlacedWithRespectToHeight=function(t){if(!this.height)return true;var e=new m(this.width,null,this.float,0,h.map(this.nodes,function(t){return p.extend({},t)}));e.addNode(t);return e.getGridHeight()<=this.height},m.prototype.isNodeChangedPosition=function(t,e,i,n,o){if(typeof e!="number")e=t.x;if(typeof i!="number")i=t.y;if(typeof n!="number")n=t.width;if(typeof o!="number")o=t.height;if(typeof t.maxWidth!="undefined")n=Math.min(n,t.maxWidth);if(typeof t.maxHeight!="undefined")o=Math.min(o,t.maxHeight);if(typeof t.minWidth!="undefined")n=Math.max(n,t.minWidth);if(typeof t.minHeight!="undefined")o=Math.max(o,t.minHeight);if(t.x==e&&t.y==i&&t.width==n&&t.height==o)return false;return true},m.prototype.moveNode=function(t,e,i,n,o,s){if(!this.isNodeChangedPosition(t,e,i,n,o))return t;if(typeof e!="number")e=t.x;if(typeof i!="number")i=t.y;if(typeof n!="number")n=t.width;if(typeof o!="number")o=t.height;if(typeof t.maxWidth!="undefined")n=Math.min(n,t.maxWidth);if(typeof t.maxHeight!="undefined")o=Math.min(o,t.maxHeight);if(typeof t.minWidth!="undefined")n=Math.max(n,t.minWidth);if(typeof t.minHeight!="undefined")o=Math.max(o,t.minHeight);if(t.x==e&&t.y==i&&t.width==n&&t.height==o)return t;var a=t.width!=n;t._dirty=true;t.x=e;t.y=i;t.width=n;t.height=o;t.lastTriedX=e;t.lastTriedY=i;t.lastTriedWidth=n;t.lastTriedHeight=o;t=this._prepareNode(t,a);this._fixCollisions(t);if(!s){this._packNodes();this._notify()}return t},m.prototype.getGridHeight=function(){return h.reduce(this.nodes,function(t,e){return Math.max(t,e.y+e.height)},0)},m.prototype.beginUpdate=function(t){h.each(this.nodes,function(t){t._origY=t.y});t._updating=true},m.prototype.endUpdate=function(){h.each(this.nodes,function(t){t._origY=t.y});var t=h.find(this.nodes,function(t){return t._updating});if(t)t._updating=false};var i=function(t,e){var l=this;var i,n;e=e||{};this.container=p(t);if(typeof e.handle_class!=="undefined"){e.handleClass=e.handle_class;d("handle_class","handleClass")}if(typeof e.item_class!=="undefined"){e.itemClass=e.item_class;d("item_class","itemClass")}if(typeof e.placeholder_class!=="undefined"){e.placeholderClass=e.placeholder_class;d("placeholder_class","placeholderClass")}if(typeof e.placeholder_text!=="undefined"){e.placeholderText=e.placeholder_text;d("placeholder_text","placeholderText")}if(typeof e.cell_height!=="undefined"){e.cellHeight=e.cell_height;d("cell_height","cellHeight")}if(typeof e.vertical_margin!=="undefined"){e.verticalMargin=e.vertical_margin;d("vertical_margin","verticalMargin")}if(typeof e.min_width!=="undefined"){e.minWidth=e.min_width;d("min_width","minWidth")}if(typeof e.static_grid!=="undefined"){e.staticGrid=e.static_grid;d("static_grid","staticGrid")}if(typeof e.is_nested!=="undefined"){e.isNested=e.is_nested;d("is_nested","isNested")}if(typeof e.always_show_resize_handle!=="undefined"){e.alwaysShowResizeHandle=e.always_show_resize_handle;d("always_show_resize_handle","alwaysShowResizeHandle")}e.itemClass=e.itemClass||"grid-stack-item";var o=this.container.closest("."+e.itemClass).length>0;this.opts=h.defaults(e||{},{width:parseInt(this.container.attr("data-gs-width"))||12,height:parseInt(this.container.attr("data-gs-height"))||0,itemClass:"grid-stack-item",placeholderClass:"grid-stack-placeholder",placeholderText:"",handle:".grid-stack-item-content",handleClass:null,cellHeight:60,verticalMargin:20,auto:true,minWidth:768,float:false,staticGrid:false,_class:"grid-stack-instance-"+(Math.random()*1e4).toFixed(0),animate:Boolean(this.container.attr("data-gs-animate"))||false,alwaysShowResizeHandle:e.alwaysShowResizeHandle||false,resizable:h.defaults(e.resizable||{},{autoHide:!(e.alwaysShowResizeHandle||false),handles:"se"}),draggable:h.defaults(e.draggable||{},{handle:(e.handleClass?"."+e.handleClass:e.handle?e.handle:"")||".grid-stack-item-content",scroll:false,appendTo:"body"}),disableDrag:e.disableDrag||false,disableResize:e.disableResize||false,rtl:"auto",removable:false,removableOptions:h.defaults(e.removableOptions||{},{accept:"."+e.itemClass}),removeTimeout:2e3,verticalMarginUnit:"px",cellHeightUnit:"px",disableOneColumnMode:e.disableOneColumnMode||false,oneColumnModeClass:e.oneColumnModeClass||"grid-stack-one-column-mode",ddPlugin:null});if(this.opts.ddPlugin===false)this.opts.ddPlugin=u;else if(this.opts.ddPlugin===null)this.opts.ddPlugin=h.first(u.registeredPlugins)||u;this.dd=new this.opts.ddPlugin(this);if(this.opts.rtl==="auto")this.opts.rtl=this.container.css("direction")==="rtl";if(this.opts.rtl)this.container.addClass("grid-stack-rtl");this.opts.isNested=o;n=this.opts.cellHeight==="auto";if(n)l.cellHeight(l.cellWidth(),true);else this.cellHeight(this.opts.cellHeight,true);this.verticalMargin(this.opts.verticalMargin,true);this.container.addClass(this.opts._class);this._setStaticClass();if(o)this.container.addClass("grid-stack-nested");this._initStyles();this.grid=new m(this.opts.width,function(t,e){e=typeof e==="undefined"?true:e;var i=0;h.each(this.nodes,function(t){i=Math.max(i,t.y+t.height)});h.each(t,function(t){if(e&&t._id===null){if(t.el)t.el.remove()}else t.el.attr("data-gs-x",t.x).attr("data-gs-y",t.y).attr("data-gs-width",t.width).attr("data-gs-height",t.height)});l._updateStyles(i+10)},this.opts.float,this.opts.height);if(this.opts.auto){var s=[];var a=this;this.container.children("."+this.opts.itemClass+":not(."+this.opts.placeholderClass+")").each(function(t,e){e=p(e);s.push({el:e,i:parseInt(e.attr("data-gs-x"))+parseInt(e.attr("data-gs-y"))*a.opts.width})});h.chain(s).sortBy(function(t){return t.i}).each(function(t){l._prepareElement(t.el)}).value()}this.setAnimation(this.opts.animate);this.placeholder=p('<div class="'+this.opts.placeholderClass+" "+this.opts.itemClass+'">'+'<div class="placeholder-content">'+this.opts.placeholderText+"</div></div>").hide();this._updateContainerHeight();this._updateHeightsOnResize=h.throttle(function(){l.cellHeight(l.cellWidth(),false)},100);this.onResizeHandler=function(){if(n)l._updateHeightsOnResize();if(l._isOneColumnMode()&&!l.opts.disableOneColumnMode){if(i)return;l.container.addClass(l.opts.oneColumnModeClass);i=true;l.grid._sortNodes();h.each(l.grid.nodes,function(t){l.container.append(t.el);if(l.opts.staticGrid)return;l.dd.draggable(t.el,"disable");l.dd.resizable(t.el,"disable");t.el.trigger("resize")})}else{if(!i)return;l.container.removeClass(l.opts.oneColumnModeClass);i=false;if(l.opts.staticGrid)return;h.each(l.grid.nodes,function(t){if(!t.noMove&&!l.opts.disableDrag)l.dd.draggable(t.el,"enable");if(!t.noResize&&!l.opts.disableResize)l.dd.resizable(t.el,"enable");t.el.trigger("resize")})}};p(window).resize(this.onResizeHandler);this.onResizeHandler();if(!l.opts.staticGrid&&typeof l.opts.removable==="string"){var r=p(l.opts.removable);if(!this.dd.isDroppable(r))this.dd.droppable(r,l.opts.removableOptions);this.dd.on(r,"dropover",function(t,e){var i=p(e.draggable);var n=i.data("_gridstack_node");if(n._grid!==l)return;i.data("inTrashZone",true);l._setupRemovingTimeout(i)}).on(r,"dropout",function(t,e){var i=p(e.draggable);var n=i.data("_gridstack_node");if(n._grid!==l)return;i.data("inTrashZone",false);l._clearRemovingTimeout(i)})}if(!l.opts.staticGrid&&l.opts.acceptWidgets){var g=null;var c=function(t,e){var i=g;var n=i.data("_gridstack_node");var o=l.getCellFromPixel({left:t.pageX,top:t.pageY},true);var s=Math.max(0,o.x);var a=Math.max(0,o.y);if(!n._added){n._added=true;n.el=i;n.autoPosition=true;n.x=s;n.y=a;l.grid.cleanNodes();l.grid.beginUpdate(n);l.grid.addNode(n);l.container.append(l.placeholder);l.placeholder.attr("data-gs-x",n.x).attr("data-gs-y",n.y).attr("data-gs-width",n.width).attr("data-gs-height",n.height).show();n.el=l.placeholder;n._beforeDragX=n.x;n._beforeDragY=n.y;l._updateContainerHeight()}if(!l.grid.canMoveNode(n,s,a))return;l.grid.moveNode(n,s,a);l._updateContainerHeight()};this.dd.droppable(l.container,{accept:function(t){t=p(t);var e=t.data("_gridstack_node");if(e&&e._grid===l)return false;return t.is(l.opts.acceptWidgets===true?".grid-stack-item":l.opts.acceptWidgets)}}).on(l.container,"dropover",function(t,e){var i=l.container.offset();var n=p(e.draggable);var o=l.cellWidth();var s=l.cellHeight();var a=n.data("_gridstack_node");var r=a?a.width:Math.ceil(n.outerWidth()/o);var d=a?a.height:Math.ceil(n.outerHeight()/s);g=n;var h=l.grid._prepareNode({width:r,height:d,_added:false,_temporary:true});n.data("_gridstack_node",h);n.data("_gridstack_node_orig",a);n.on("drag",c)}).on(l.container,"dropout",function(t,e){var i=p(e.draggable);if(!i.data("_gridstack_node"))return;i.unbind("drag",c);var n=i.data("_gridstack_node");n.el=null;l.grid.removeNode(n);l.placeholder.detach();l._updateContainerHeight();i.data("_gridstack_node",i.data("_gridstack_node_orig"))}).on(l.container,"drop",function(t,e){l.placeholder.detach();var i=p(e.draggable).data("_gridstack_node");i._grid=l;var n=p(e.draggable).clone(false);n.data("_gridstack_node",i);var o=p(e.draggable).data("_gridstack_node_orig");if(typeof o!=="undefined"&&typeof o._grid!=="undefined")o._grid._triggerRemoveEvent();p(e.helper).remove();i.el=n;l.placeholder.hide();f.removePositioningStyles(n);n.find("div.ui-resizable-handle").remove();n.attr("data-gs-x",i.x).attr("data-gs-y",i.y).attr("data-gs-width",i.width).attr("data-gs-height",i.height).addClass(l.opts.itemClass).enableSelection().removeData("draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled").unbind("drag",c);l.container.append(n);l._prepareElementsByNode(n,i);l._updateContainerHeight();l.grid._addedNodes.push(i);l._triggerAddEvent();l._triggerChangeEvent();l.grid.endUpdate();p(e.draggable).unbind("drag",c);p(e.draggable).removeData("_gridstack_node");p(e.draggable).removeData("_gridstack_node_orig")})}};i.prototype._triggerChangeEvent=function(t){var e=this.grid.getDirtyNodes();var i=false;var n=[];if(e&&e.length){n.push(e);i=true}if(i||t===true)this.container.trigger("change",n)},i.prototype._triggerAddEvent=function(){if(this.grid._addedNodes&&this.grid._addedNodes.length>0){this.container.trigger("added",[h.map(this.grid._addedNodes,h.clone)]);this.grid._addedNodes=[]}},i.prototype._triggerRemoveEvent=function(){if(this.grid._removedNodes&&this.grid._removedNodes.length>0){this.container.trigger("removed",[h.map(this.grid._removedNodes,h.clone)]);this.grid._removedNodes=[]}},i.prototype._initStyles=function(){if(this._stylesId)f.removeStylesheet(this._stylesId);this._stylesId="gridstack-style-"+(Math.random()*1e5).toFixed();this._styles=f.createStylesheet(this._stylesId);if(this._styles!==null)this._styles._max=0},i.prototype._updateStyles=function(t){if(this._styles===null||typeof this._styles==="undefined")return;var e="."+this.opts._class+" ."+this.opts.itemClass;var i=this;var n;if(typeof t=="undefined")t=this._styles._max;this._initStyles();this._updateContainerHeight();if(!this.opts.cellHeight)return;if(this._styles._max!==0&&t<=this._styles._max)return;if(!this.opts.verticalMargin||this.opts.cellHeightUnit===this.opts.verticalMarginUnit)n=function(t,e){return i.opts.cellHeight*t+i.opts.verticalMargin*e+i.opts.cellHeightUnit};else n=function(t,e){if(!t||!e)return i.opts.cellHeight*t+i.opts.verticalMargin*e+i.opts.cellHeightUnit;return"calc("+(i.opts.cellHeight*t+i.opts.cellHeightUnit)+" + "+(i.opts.verticalMargin*e+i.opts.verticalMarginUnit)+")"};if(this._styles._max===0)f.insertCSSRule(this._styles,e,"min-height: "+n(1,0)+";",0);if(t>this._styles._max){for(var o=this._styles._max;o<t;++o){f.insertCSSRule(this._styles,e+'[data-gs-height="'+(o+1)+'"]',"height: "+n(o+1,o)+";",o);f.insertCSSRule(this._styles,e+'[data-gs-min-height="'+(o+1)+'"]',"min-height: "+n(o+1,o)+";",o);f.insertCSSRule(this._styles,e+'[data-gs-max-height="'+(o+1)+'"]',"max-height: "+n(o+1,o)+";",o);f.insertCSSRule(this._styles,e+'[data-gs-y="'+o+'"]',"top: "+n(o,o)+";",o)}this._styles._max=t}},i.prototype._updateContainerHeight=function(){if(this.grid._updateCounter)return;var t=this.grid.getGridHeight();var e=parseInt(this.container.css("min-height"));if(e>0){var i=(e+this.opts.verticalMargin)/(this.cellHeight()+this.opts.verticalMargin);if(t<i)t=i}this.container.attr("data-gs-current-height",t);if(!this.opts.cellHeight)return;if(!this.opts.verticalMargin)this.container.css("height",t*this.opts.cellHeight+this.opts.cellHeightUnit);else if(this.opts.cellHeightUnit===this.opts.verticalMarginUnit)this.container.css("height",t*(this.opts.cellHeight+this.opts.verticalMargin)-this.opts.verticalMargin+this.opts.cellHeightUnit);else this.container.css("height","calc("+(t*this.opts.cellHeight+this.opts.cellHeightUnit)+" + "+(t*(this.opts.verticalMargin-1)+this.opts.verticalMarginUnit)+")")},i.prototype._isOneColumnMode=function(){return(window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth)<=this.opts.minWidth},i.prototype._setupRemovingTimeout=function(t){var e=this;var i=p(t).data("_gridstack_node");if(i._removeTimeout||!e.opts.removable)return;i._removeTimeout=setTimeout(function(){t.addClass("grid-stack-item-removing");i._isAboutToRemove=true},e.opts.removeTimeout)},i.prototype._clearRemovingTimeout=function(t){var e=p(t).data("_gridstack_node");if(!e._removeTimeout)return;clearTimeout(e._removeTimeout);e._removeTimeout=null;t.removeClass("grid-stack-item-removing");e._isAboutToRemove=false},i.prototype._prepareElementsByNode=function(h,l){var g=this;var c;var u;var t=function(t,e){var i=Math.round(e.position.left/c);var n=Math.floor((e.position.top+u/2)/u);var o;var s;if(t.type!="drag"){o=Math.round(e.size.width/c);s=Math.round(e.size.height/u)}if(t.type=="drag"){var a=e.position.top-l._prevYPix;l._prevYPix=e.position.top;f.updateScrollPosition(h[0],e,a);if(h.data("inTrashZone")||i<0||i>=g.grid.width||n<0||!g.grid.float&&n>g.grid.getGridHeight()){if(!l._temporaryRemoved){if(g.opts.removable===true)g._setupRemovingTimeout(h);i=l._beforeDragX;n=l._beforeDragY;g.placeholder.detach();g.placeholder.hide();g.grid.removeNode(l);g._updateContainerHeight();l._temporaryRemoved=true}}else{g._clearRemovingTimeout(h);if(l._temporaryRemoved){g.grid.addNode(l);g.placeholder.attr("data-gs-x",i).attr("data-gs-y",n).attr("data-gs-width",o).attr("data-gs-height",s).show();g.container.append(g.placeholder);l.el=g.placeholder;l._temporaryRemoved=false}}}else if(t.type=="resize")if(i<0)return;var r=typeof o!=="undefined"?o:l.lastTriedWidth;var d=typeof s!=="undefined"?s:l.lastTriedHeight;if(!g.grid.canMoveNode(l,i,n,o,s)||l.lastTriedX===i&&l.lastTriedY===n&&l.lastTriedWidth===r&&l.lastTriedHeight===d)return;l.lastTriedX=i;l.lastTriedY=n;l.lastTriedWidth=o;l.lastTriedHeight=s;g.grid.moveNode(l,i,n,o,s);g._updateContainerHeight()};var e=function(t,e){g.container.append(g.placeholder);var i=p(this);g.grid.cleanNodes();g.grid.beginUpdate(l);c=g.cellWidth();var n=Math.ceil(i.outerHeight()/i.attr("data-gs-height"));u=g.container.height()/parseInt(g.container.attr("data-gs-current-height"));g.placeholder.attr("data-gs-x",i.attr("data-gs-x")).attr("data-gs-y",i.attr("data-gs-y")).attr("data-gs-width",i.attr("data-gs-width")).attr("data-gs-height",i.attr("data-gs-height")).show();l.el=g.placeholder;l._beforeDragX=l.x;l._beforeDragY=l.y;l._prevYPix=e.position.top;g.dd.resizable(h,"option","minWidth",c*(l.minWidth||1));g.dd.resizable(h,"option","minHeight",n*(l.minHeight||1));if(t.type=="resizestart")i.find(".grid-stack-item").trigger("resizestart")};var i=function(t,e){var i=p(this);if(!i.data("_gridstack_node"))return;var n=false;g.placeholder.detach();l.el=i;g.placeholder.hide();if(l._isAboutToRemove){n=true;var o=h.data("_gridstack_node")._grid;o._triggerRemoveEvent();h.removeData("_gridstack_node");h.remove()}else{g._clearRemovingTimeout(h);if(!l._temporaryRemoved){f.removePositioningStyles(i);i.attr("data-gs-x",l.x).attr("data-gs-y",l.y).attr("data-gs-width",l.width).attr("data-gs-height",l.height)}else{f.removePositioningStyles(i);i.attr("data-gs-x",l._beforeDragX).attr("data-gs-y",l._beforeDragY).attr("data-gs-width",l.width).attr("data-gs-height",l.height);l.x=l._beforeDragX;l.y=l._beforeDragY;l._temporaryRemoved=false;g.grid.addNode(l)}}g._updateContainerHeight();g._triggerChangeEvent(n);g.grid.endUpdate();var s=i.find(".grid-stack");if(s.length&&t.type=="resizestop"){s.each(function(t,e){var i=p(e).data("gridstack");if(i&&i.onResizeHandler)i.onResizeHandler()});i.find(".grid-stack-item").trigger("resizestop");i.find(".grid-stack-item").trigger("gsresizestop")}if(t.type=="resizestop")g.container.trigger("gsresizestop",i)};this.dd.draggable(h,{start:e,stop:i,drag:t}).resizable(h,{start:e,stop:i,resize:t});if(l.noMove||this._isOneColumnMode()&&!g.opts.disableOneColumnMode||this.opts.disableDrag||this.opts.staticGrid)this.dd.draggable(h,"disable");if(l.noResize||this._isOneColumnMode()&&!g.opts.disableOneColumnMode||this.opts.disableResize||this.opts.staticGrid)this.dd.resizable(h,"disable");h.attr("data-gs-locked",l.locked?"yes":null)},i.prototype._prepareElement=function(t,e){e=typeof e!="undefined"?e:false;var i=this;t=p(t);t.addClass(this.opts.itemClass);var n=i.grid.addNode({x:parseInt(t.attr("data-gs-x"),10),y:parseInt(t.attr("data-gs-y"),10),width:t.attr("data-gs-width"),height:t.attr("data-gs-height"),maxWidth:t.attr("data-gs-max-width"),minWidth:t.attr("data-gs-min-width"),maxHeight:t.attr("data-gs-max-height"),minHeight:t.attr("data-gs-min-height"),autoPosition:f.toBool(t.attr("data-gs-auto-position")),noResize:f.toBool(t.attr("data-gs-no-resize")),noMove:f.toBool(t.attr("data-gs-no-move")),locked:f.toBool(t.attr("data-gs-locked")),resizeHandles:t.attr("data-gs-resize-handles"),el:t,id:t.attr("data-gs-id"),_grid:i},e);t.data("_gridstack_node",n);this._prepareElementsByNode(t,n)},i.prototype.setAnimation=function(t){if(t)this.container.addClass("grid-stack-animate");else this.container.removeClass("grid-stack-animate")},i.prototype.addWidget=function(t,e,i,n,o,s,a,r,d,h,l){t=p(t);if(typeof e!="undefined")t.attr("data-gs-x",e);if(typeof i!="undefined")t.attr("data-gs-y",i);if(typeof n!="undefined")t.attr("data-gs-width",n);if(typeof o!="undefined")t.attr("data-gs-height",o);if(typeof s!="undefined")t.attr("data-gs-auto-position",s?"yes":null);if(typeof a!="undefined")t.attr("data-gs-min-width",a);if(typeof r!="undefined")t.attr("data-gs-max-width",r);if(typeof d!="undefined")t.attr("data-gs-min-height",d);if(typeof h!="undefined")t.attr("data-gs-max-height",h);if(typeof l!="undefined")t.attr("data-gs-id",l);this.container.append(t);this._prepareElement(t,true);this._triggerAddEvent();this._updateContainerHeight();this._triggerChangeEvent(true);return t},i.prototype.makeWidget=function(t){t=p(t);this._prepareElement(t,true);this._triggerAddEvent();this._updateContainerHeight();this._triggerChangeEvent(true);return t},i.prototype.willItFit=function(t,e,i,n,o){var s={x:t,y:e,width:i,height:n,autoPosition:o};return this.grid.canBePlacedWithRespectToHeight(s)},i.prototype.removeWidget=function(t,e){e=typeof e==="undefined"?true:e;t=p(t);var i=t.data("_gridstack_node");if(!i)i=this.grid.getNodeDataByDOMEl(t);this.grid.removeNode(i,e);t.removeData("_gridstack_node");this._updateContainerHeight();if(e)t.remove();this._triggerChangeEvent(true);this._triggerRemoveEvent()},i.prototype.removeAll=function(e){h.each(this.grid.nodes,h.bind(function(t){this.removeWidget(t.el,e)},this));this.grid.nodes=[];this._updateContainerHeight()},i.prototype.destroy=function(t){p(window).off("resize",this.onResizeHandler);this.disable();if(typeof t!="undefined"&&!t){this.removeAll(false);this.container.removeData("gridstack")}else this.container.remove();f.removeStylesheet(this._stylesId);if(this.grid)this.grid=null},i.prototype.resizable=function(t,n){var o=this;t=p(t);t.each(function(t,e){e=p(e);var i=e.data("_gridstack_node");if(typeof i=="undefined"||i===null)return;i.noResize=!(n||false);if(i.noResize||o._isOneColumnMode()&&!o.opts.disableOneColumnMode)o.dd.resizable(e,"disable");else o.dd.resizable(e,"enable")});return this},i.prototype.movable=function(t,n){var o=this;t=p(t);t.each(function(t,e){e=p(e);var i=e.data("_gridstack_node");if(typeof i=="undefined"||i===null)return;i.noMove=!(n||false);if(i.noMove||o._isOneColumnMode()&&!o.opts.disableOneColumnMode){o.dd.draggable(e,"disable");e.removeClass("ui-draggable-handle")}else{o.dd.draggable(e,"enable");e.addClass("ui-draggable-handle")}});return this},i.prototype.enableMove=function(t,e){this.movable(this.container.children("."+this.opts.itemClass),t);if(e)this.opts.disableDrag=!t},i.prototype.enableResize=function(t,e){this.resizable(this.container.children("."+this.opts.itemClass),t);if(e)this.opts.disableResize=!t},i.prototype.disable=function(){this.movable(this.container.children("."+this.opts.itemClass),false);this.resizable(this.container.children("."+this.opts.itemClass),false);this.container.trigger("disable")},i.prototype.enable=function(){this.movable(this.container.children("."+this.opts.itemClass),true);this.resizable(this.container.children("."+this.opts.itemClass),true);this.container.trigger("enable")},i.prototype.locked=function(t,n){t=p(t);t.each(function(t,e){e=p(e);var i=e.data("_gridstack_node");if(typeof i=="undefined"||i===null)return;i.locked=n||false;e.attr("data-gs-locked",i.locked?"yes":null)});return this},i.prototype.maxHeight=function(t,n){t=p(t);t.each(function(t,e){e=p(e);var i=e.data("_gridstack_node");if(typeof i==="undefined"||i===null)return;if(!isNaN(n)){i.maxHeight=n||false;e.attr("data-gs-max-height",n)}});return this},i.prototype.minHeight=function(t,n){t=p(t);t.each(function(t,e){e=p(e);var i=e.data("_gridstack_node");if(typeof i==="undefined"||i===null)return;if(!isNaN(n)){i.minHeight=n||false;e.attr("data-gs-min-height",n)}});return this},i.prototype.maxWidth=function(t,n){t=p(t);t.each(function(t,e){e=p(e);var i=e.data("_gridstack_node");if(typeof i==="undefined"||i===null)return;if(!isNaN(n)){i.maxWidth=n||false;e.attr("data-gs-max-width",n)}});return this},i.prototype.minWidth=function(t,n){t=p(t);t.each(function(t,e){e=p(e);var i=e.data("_gridstack_node");if(typeof i==="undefined"||i===null)return;if(!isNaN(n)){i.minWidth=n||false;e.attr("data-gs-min-width",n)}});return this},i.prototype._updateElement=function(t,e){t=p(t).first();var i=t.data("_gridstack_node");if(typeof i=="undefined"||i===null)return;var n=this;n.grid.cleanNodes();n.grid.beginUpdate(i);e.call(this,t,i);n._updateContainerHeight();n._triggerChangeEvent();n.grid.endUpdate()},i.prototype.resize=function(t,i,n){this._updateElement(t,function(t,e){i=i!==null&&typeof i!="undefined"?i:e.width;n=n!==null&&typeof n!="undefined"?n:e.height;this.grid.moveNode(e,e.x,e.y,i,n)})},i.prototype.move=function(t,i,n){this._updateElement(t,function(t,e){i=i!==null&&typeof i!="undefined"?i:e.x;n=n!==null&&typeof n!="undefined"?n:e.y;this.grid.moveNode(e,i,n,e.width,e.height)})},i.prototype.update=function(t,i,n,o,s){this._updateElement(t,function(t,e){i=i!==null&&typeof i!="undefined"?i:e.x;n=n!==null&&typeof n!="undefined"?n:e.y;o=o!==null&&typeof o!="undefined"?o:e.width;s=s!==null&&typeof s!="undefined"?s:e.height;this.grid.moveNode(e,i,n,o,s)})},i.prototype.verticalMargin=function(t,e){if(typeof t=="undefined")return this.opts.verticalMargin;var i=f.parseHeight(t);if(this.opts.verticalMarginUnit===i.unit&&this.opts.height===i.height)return;this.opts.verticalMarginUnit=i.unit;this.opts.verticalMargin=i.height;if(!e)this._updateStyles()},i.prototype.cellHeight=function(t,e){if(typeof t=="undefined"){if(this.opts.cellHeight)return this.opts.cellHeight;var i=this.container.children("."+this.opts.itemClass).first();return Math.ceil(i.outerHeight()/i.attr("data-gs-height"))}var n=f.parseHeight(t);if(this.opts.cellHeightUnit===n.unit&&this.opts.cellHeight===n.height)return;this.opts.cellHeightUnit=n.unit;this.opts.cellHeight=n.height;if(!e)this._updateStyles()},i.prototype.cellWidth=function(){return Math.round(this.container.outerWidth()/this.opts.width)},i.prototype.getCellFromPixel=function(t,e){var i=typeof e!="undefined"&&e?this.container.offset():this.container.position();var n=t.left-i.left;var o=t.top-i.top;var s=Math.floor(this.container.width()/this.opts.width);var a=Math.floor(this.container.height()/parseInt(this.container.attr("data-gs-current-height")));return{x:Math.floor(n/s),y:Math.floor(o/a)}},i.prototype.batchUpdate=function(){this.grid.batchUpdate()},i.prototype.commit=function(){this.grid.commit();this._updateContainerHeight()},i.prototype.isAreaEmpty=function(t,e,i,n){return this.grid.isAreaEmpty(t,e,i,n)},i.prototype.setStatic=function(t){this.opts.staticGrid=t===true;this.enableMove(!t);this.enableResize(!t);this._setStaticClass()},i.prototype._setStaticClass=function(){var t="grid-stack-static";if(this.opts.staticGrid===true)this.container.addClass(t);else this.container.removeClass(t)},i.prototype._updateNodeWidths=function(t,e){this.grid._sortNodes();this.grid.batchUpdate();var i={};for(var n=0;n<this.grid.nodes.length;n++){i=this.grid.nodes[n];this.update(i.el,Math.round(i.x*e/t),undefined,Math.round(i.width*e/t),undefined)}this.grid.commit()},i.prototype.setGridWidth=function(t,e){this.container.removeClass("grid-stack-"+this.opts.width);if(e!==true)this._updateNodeWidths(this.opts.width,t);this.opts.width=t;this.grid.width=t;this.container.addClass("grid-stack-"+t)},m.prototype.batch_update=e(m.prototype.batchUpdate),m.prototype._fix_collisions=e(m.prototype._fixCollisions,"_fix_collisions","_fixCollisions"),m.prototype.is_area_empty=e(m.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),m.prototype._sort_nodes=e(m.prototype._sortNodes,"_sort_nodes","_sortNodes"),m.prototype._pack_nodes=e(m.prototype._packNodes,"_pack_nodes","_packNodes"),m.prototype._prepare_node=e(m.prototype._prepareNode,"_prepare_node","_prepareNode"),m.prototype.clean_nodes=e(m.prototype.cleanNodes,"clean_nodes","cleanNodes"),m.prototype.get_dirty_nodes=e(m.prototype.getDirtyNodes,"get_dirty_nodes","getDirtyNodes"),m.prototype.add_node=e(m.prototype.addNode,"add_node","addNode, "),m.prototype.remove_node=e(m.prototype.removeNode,"remove_node","removeNode"),m.prototype.can_move_node=e(m.prototype.canMoveNode,"can_move_node","canMoveNode"),m.prototype.move_node=e(m.prototype.moveNode,"move_node","moveNode"),m.prototype.get_grid_height=e(m.prototype.getGridHeight,"get_grid_height","getGridHeight"),m.prototype.begin_update=e(m.prototype.beginUpdate,"begin_update","beginUpdate"),m.prototype.end_update=e(m.prototype.endUpdate,"end_update","endUpdate"),m.prototype.can_be_placed_with_respect_to_height=e(m.prototype.canBePlacedWithRespectToHeight,"can_be_placed_with_respect_to_height","canBePlacedWithRespectToHeight"),i.prototype._trigger_change_event=e(i.prototype._triggerChangeEvent,"_trigger_change_event","_triggerChangeEvent"),i.prototype._init_styles=e(i.prototype._initStyles,"_init_styles","_initStyles"),i.prototype._update_styles=e(i.prototype._updateStyles,"_update_styles","_updateStyles"),i.prototype._update_container_height=e(i.prototype._updateContainerHeight,"_update_container_height","_updateContainerHeight"),i.prototype._is_one_column_mode=e(i.prototype._isOneColumnMode,"_is_one_column_mode","_isOneColumnMode"),i.prototype._prepare_element=e(i.prototype._prepareElement,"_prepare_element","_prepareElement"),i.prototype.set_animation=e(i.prototype.setAnimation,"set_animation","setAnimation"),i.prototype.add_widget=e(i.prototype.addWidget,"add_widget","addWidget"),i.prototype.make_widget=e(i.prototype.makeWidget,"make_widget","makeWidget"),i.prototype.will_it_fit=e(i.prototype.willItFit,"will_it_fit","willItFit"),i.prototype.remove_widget=e(i.prototype.removeWidget,"remove_widget","removeWidget"),i.prototype.remove_all=e(i.prototype.removeAll,"remove_all","removeAll"),i.prototype.min_height=e(i.prototype.minHeight,"min_height","minHeight"),i.prototype.min_width=e(i.prototype.minWidth,"min_width","minWidth"),i.prototype._update_element=e(i.prototype._updateElement,"_update_element","_updateElement"),i.prototype.cell_height=e(i.prototype.cellHeight,"cell_height","cellHeight"),i.prototype.cell_width=e(i.prototype.cellWidth,"cell_width","cellWidth"),i.prototype.get_cell_from_pixel=e(i.prototype.getCellFromPixel,"get_cell_from_pixel","getCellFromPixel"),i.prototype.batch_update=e(i.prototype.batchUpdate,"batch_update","batchUpdate"),i.prototype.is_area_empty=e(i.prototype.isAreaEmpty,"is_area_empty","isAreaEmpty"),i.prototype.set_static=e(i.prototype.setStatic,"set_static","setStatic"),i.prototype._set_static_class=e(i.prototype._setStaticClass,"_set_static_class","_setStaticClass"),t.GridStackUI=i,t.GridStackUI.Utils=f,t.GridStackUI.Engine=m,t.GridStackUI.GridStackDragDropPlugin=u,p.fn.gridstack=function(e){return this.each(function(){var t=p(this);if(!t.data("gridstack"))t.data("gridstack",new i(this,e))})},t.GridStackUI}(jQuery,_),k=jQuery,M=_,x=GridStackUI,window,x.GridStackDragDropPlugin.registerPlugin(S),((S.prototype=Object.create(x.GridStackDragDropPlugin.prototype)).constructor=S).prototype.resizable=function(t,e){var i,n;return t=k(t),"disable"===e||"enable"===e?t.resizable(e):"option"===e?(i=arguments[2],n=arguments[3],t.resizable(e,i,n)):(n=t.data("gs-resize-handles")?t.data("gs-resize-handles"):this.grid.opts.resizable.handles,t.resizable(M.extend({},this.grid.opts.resizable,{handles:n},{start:e.start||function(){},stop:e.stop||function(){},resize:e.resize||function(){}}))),this},S.prototype.draggable=function(t,e){return t=k(t),"disable"===e||"enable"===e?t.draggable(e):t.draggable(M.extend({},this.grid.opts.draggable,{containment:this.grid.opts.isNested?this.grid.container.parent():null,distance:7,start:e.start||function(){},stop:e.stop||function(){},drag:e.drag||function(){}})),this},S.prototype.droppable=function(t,e){return(t=k(t)).droppable(e),this},S.prototype.isDroppable=function(t,e){return t=k(t),Boolean(t.data("droppable"))},S.prototype.on=function(t,e,i){return k(t).on(e,i),this},GridStackUI.prototype._updateStyles=function(t){if(null!==this._styles&&void 0!==this._styles){var e,i="."+this.opts._class+" > ."+this.opts.itemClass,n=this;if(void 0===t&&(t=this._styles._max,this._initStyles(),this._updateContainerHeight()),this.opts.cellHeight){if(!(0!==this._styles._max&&t<=this._styles._max)&&(e=this.opts.verticalMargin&&this.opts.cellHeightUnit!==this.opts.verticalMarginUnit?function(t,e){return t&&e?"calc("+(n.opts.cellHeight*t+n.opts.cellHeightUnit)+" + "+(n.opts.verticalMargin*e+n.opts.verticalMarginUnit)+")":n.opts.cellHeight*t+n.opts.verticalMargin*e+n.opts.cellHeightUnit}:function(t,e){return n.opts.cellHeight*t+n.opts.verticalMargin*e+n.opts.cellHeightUnit},0===this._styles._max&&GridStackUI.Utils.insertCSSRule(this._styles,i,"min-height: "+e(1,0)+";",0),t>this._styles._max)){for(var o=this._styles._max;o<t;++o)GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-height="'+(o+1)+'"]',"height: "+e(o+1,o)+";",o),GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-min-height="'+(o+1)+'"]',"min-height: "+e(o+1,o)+";",o),GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-max-height="'+(o+1)+'"]',"max-height: "+e(o+1,o)+";",o),GridStackUI.Utils.insertCSSRule(this._styles,i+'[data-gs-y="'+o+'"]',"top: "+e(o,o)+";",o);this._styles._max=t}}else this._styles._max=t}},GridStackUI.Utils.getScrollParent=_.wrap(GridStackUI.Utils.getScrollParent,function(t,e){return e&&e.parentNode&&e.parentNode.className&&0<=e.parentNode.className.indexOf("fillHeightMode")?null:t(e)});var H=d.ComponentDropView.extend({KEY_RELATIVE_HEIGHT:"Basics.RelativeHeight",KEY_FLOATABLE:"Basics.Floatable",KEY_ADVANCED:"Basics.Advanced",KEY_USER_LAYOUT:"Basics.UserLayout",KEY_COLUMN_COUNT:"Basics.ColCount",KEY_ROW_COUNT:"Basics.RowCount",KEY_ROW_HEIGHT:"Basics.RowHeight",CSS_REPLACING:"replacing",$gridstack:null,$highlightItem:null,$highlightLayer:null,$noWidgetsInfo:null,$rowHighlightItem:null,$worksheet:null,$worksheetHighlightItem:null,api:null,columnCount:void 0,columnWidth:null,currentActionWidget:null,dashboardAppModel:null,dashboardViewModel:null,DEFAULT_ROW_COUNT_IN_FILL_HEIGHT_MODE:24,DEFAULT_ROW_HEIGHT_IN_NON_FILL_HEIGHT_MODE:25,DEFAULT_WIDGET_ROW_SPAN:12,dropdownValues:null,gridstack:null,gridstackMargin:0,ignoreWidgetSelect:null,isBasePanel:!1,selected:null,settingsModel:null,rowDrop:null,rowDropNo:null,usedRowHeight:null,widgetClass:"ui-widget",widgetEdge:12,widgets:null,constructor:function(t){e.View.prototype.constructor.apply(this,arguments)},events:null,initialize:function(t){this.options=t,this.api=t.api,this.isBasePanel=t.isBasePanel||!1,this.dashboardAppModel=t.dashboardAppModel,this.dashboardViewModel=t.dashboardViewModel,this.documentModel=t.documentModel,this.dataModel=t.dataModel,this.DeltaClientLib=t.DeltaClientLib,this.documentViewModel=t.viewModel,this.model=this.model||t.componentModel,this.model instanceof d.Component&&(this.model.panelView=this),this.quickView=t.quickView,this.settingsModel=t.settingsModel,this.websiteUrl=t.websiteUrl,this.userWidgets=new d.WidgetCollection([],{},this.model),this.viewModel=new e.DeepModel,this.widgets=[],this.throttledUpdateHighlightItem=_.throttle(this.updateHighlightItem,41),this.debouncedRenderConfigureWidgetsMenu=_.debounce(this.renderConfigureWidgetsMenu,100),this.render(),this.isBasePanel&&(_.extend(this,E),this.initializeBasePanel(),this.triggerDragEvent=this.triggerDragEvent.bind(this),$(window).on("dragover",this.triggerDragEvent),this.onPanelDragEvent_throttled=_.throttle(this.onPanelDragEvent,200),this.listenTo(this.dashboardViewModel,"onPanelDragEvent",this.onPanelDragEvent_throttled))},initializeEvents:function(){d.ComponentDropView.prototype.initializeEvents.apply(this,arguments),this.listenTo(this.viewModel,"change:"+this.KEY_RELATIVE_HEIGHT,this.onChange_RelativeHeight),this.listenTo(this.viewModel,"change:"+this.KEY_FLOATABLE,this.onChange_Floatable),this.listenTo(this.viewModel,"change:"+this.KEY_COLUMN_COUNT,this.onChange_ColumnCount),this.listenTo(this.viewModel,"change:"+this.KEY_ROW_COUNT,this.onChange_RowCount),this.listenTo(this.viewModel,"change:"+this.KEY_ROW_HEIGHT,this.onChange_RowHeight),this.listenTo(this.viewModel,"change:"+this.KEY_ADVANCED,this.onPropAdvanced),this.$worksheet.on("click",$.proxy(this.onWorksheetClick,this)),this.$showConfigureWidgetsMenu.on("click",$.proxy(this.onShowConfigureWidgetsMenu,this)),this.$configureWidgetsMenu.on("click",$.proxy(this.onConfigureWidgetsMenuClick,this)),this.listenTo(this.userWidgets,"add remove reset",this.debouncedRenderConfigureWidgetsMenu),this.listenTo(this.userWidgets,"reset",this.onUserLayoutReset),this.$worksheet.on("dragenter",this.getSafeDragNDropHandler(this.onWorksheetDragEnter)),this.$worksheet.on("dragover",this.getSafeDragNDropHandler(this.onWorksheetDragOver)),this.$worksheet.on("dragleave",this.getSafeDragNDropHandler(this.onWorksheetDragLeave)),this.$worksheet.on("drop",this.getSafeDragNDropHandler(this.onWorksheetDrop)),this.listenTo(this.dashboardViewModel,"change:selectedWidget",this.changeOverlayVisibilty),this.listenTo(this.dashboardViewModel,"change:buildMode",this.changeOverlayVisibilty)},initializeEvents_widgetCollection:function(){this.listenTo(this.widgetsCollection,"remove",function(t,e,i){t=_.find(this.widgets,{model:t});this.selected&&this.selected===t&&this.deselectCurrentWidget(),this.removeWidget(t)}),this.listenTo(this.widgetsCollection,"add",function(t,e){this.ignoreGridstackEvents=!0,this.addWidget(t,!1,null),this.ignoreGridstackEvents=!1})},initializePost:function(){var t;this.hasInitPost||(this.hasInitPost=!0,this.initializeEvents(),this.isBasePanel&&this.set_gridstackMargin(),this.modifyFillHeightModeCssClass(),this.set_columnCount(),this.recalculateColumnWidth(),this.isUserEditMode()?(this.populateUserWidgetsCollection(),this.widgetsCollection=this.userWidgets,this.dashboardViewModel.set("userConfigurable",!0)):this.widgetsCollection=this.model.get("widgets"),this.initializeEvents_widgetCollection(),this.upgradeGridsterLayout(),(t=this.getMaxRowCount())>(this.viewModel.get(this.KEY_ROW_COUNT)||0)&&(this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.api.setProperty(this.KEY_ROW_COUNT,t):this.viewModel.set(this.KEY_ROW_COUNT,t,{silent:!0})),this.set_rowCount(),this.recalculateUsedRowHeight(),this.viewModel.get(this.KEY_ADVANCED)||this.initGridStack(),this.populatePanelWithWidgets(),this.switchBuildMode(this.dashboardViewModel.get("buildMode")),this.changeOverlayVisibilty(),this.isInitialized=!0)},addWidget:function(t){return this.$noWidgetsInfo.hide(),d.ComponentDropView.prototype.addWidget.apply(this,arguments)},addNewWidget:function(t,e,i,n,o,s,a){var r;return o||(o=new d.Widget({},{},this.widgetsCollection),r={},_.isNumber(t)&&(r.row=t),_.isNumber(e)&&(r.column=e),_.isNumber(i)&&(r.rowSpan=i),_.isNumber(n)&&(r.colSpan=n),_.isEmpty(r)||(n=o.get("layout"),_.extend(n.attributes,r),_.extend(n._previousAttributes,r))),s&&!a&&this.addComponentToWidget(o,s,!1),this.isUserEditMode()?this.widgetsCollection.add(o):this.widgetsCollection.commandAdd(o,a?"Paste":null),_.findLast(this.widgets,{widgetId:o.id})},addWidgetEvents:function(t){var e,i=this;if(!(t instanceof $))throw"Wrong parameter.";_.each(t,function(t){(e=$(t)).on("click",$.proxy(i.onWidgetClick,i)),e.on("dragenter",i.getSafeDragNDropHandler(i.onComponentDragEnter)),e.on("dragleave",i.getSafeDragNDropHandler(i.onComponentDragLeave)),e.on("dragover",i.getSafeDragNDropHandler(i.onComponentDragOver)),e.on("drop",i.getSafeDragNDropHandler(i.onComponentDrop)),e.on("mousedown",$.proxy(i.onWidgetMouseDown,i))})},applyGridStackMargin:function(){var t={margin:this.gridstackMargin};this.$gridstack.css(t),this.$rowHighlightItem.css(t),this.$worksheetHighlightItem.css("margin-left",this.gridstackMargin),this.recalculateUsedRowHeight()},changeLayout:function(t){var e=this,i=this.dashboardAppModel.get("copiedWidgetSize")||[300,200];if(this.viewModel.get(this.KEY_ADVANCED)){t.get("layout").set({row:this.getMaxRowCount(),column:0,rowSpan:1,colSpan:this.columnCount});var n=t.get("component").get("options").get("Style"),o=n.advanced||"";_.every([".advanced-item","width","height"],function(t){return o.indexOf(t)<0})&&(n.advanced=(o?o+"\n\n":"")+'.advanced-item[data-widgetid="'+t.get("id")+'"] { width: '+Math.min(i[0],this.columnCount*this.columnWidth)+"px; height: "+i[1]+"px; }\n\n")}else if(this.viewModel.get(this.KEY_RELATIVE_HEIGHT)){var s,a,r,i=this.dashboardAppModel.get("copiedWidgetSize")||[300,200],d=Math.max(1,Math.min(this.columnCount,Math.round(i[0]/this.columnWidth))),h=Math.max(1,Math.min(this.rowCount,Math.round(i[1]/this.usedRowHeight))),l=!1,g=0,c=0,u=_.map(Array(this.rowCount),function(){return _.fill(Array(e.columnCount),1)});this.widgetsCollection.each(function(t){for(var e,t=t.get("layout"),i=t.get("row"),n=t.get("column"),o=i+t.get("rowSpan"),s=n+t.get("colSpan");i<o;i++)for(e=n;e<s;e++)u[i][e]=0});for(var p=function(t,e){for(var i,n,o=1,s=0,a=e;u[t][a]&&a<e+d&&a<this.columnCount;a++,s++);if(c<=s){for(g=c<s?0:g,c=s,n=_.range(e,a),i=t+1;i<t+h&&i<this.rowCount;i++){if(!_.every(n,function(t){return u[i][t]}))break;o++}if(g<o)return[t,e,g=o,s]}}.bind(this),f=0;!l&&f<this.rowCount;f++)for(s=0;!l&&s<this.columnCount;s++)u[f][s]&&(a=p(f,s))&&(l=(r=a)[2]===h&&r[3]===d);if(!r)return!1;t.get("layout").set({row:r[0],column:r[1],rowSpan:r[2],colSpan:r[3]})}else t.get("layout").set({row:this.getMaxRowCount(),column:0,rowSpan:Math.max(1,Math.round(i[1]/this.usedRowHeight)),colSpan:Math.max(1,Math.min(this.columnCount,Math.round(i[0]/this.columnWidth)))});return!0},changeOverlayVisibilty:function(){var t;!!this.dashboardViewModel.get("buildMode")?null==(t=this.dashboardViewModel.get("selectedWidget"))?this.isBasePanel?this.$gridOverlay.show():this.$gridOverlay.hide():t.get("id")===this.options.widgetId?this.$gridOverlay.show():this.$gridOverlay.hide():this.$gridOverlay.hide()},clearPanel_initGridstack:function(){this.clearWidgets(),this.removeGridstack(),this.viewModel.get(this.KEY_ADVANCED)||this.initGridStack()},clearWidgets:function(){_.includes(this.model.get("widgets").map("id"),this.dashboardViewModel.get("selectedWidgetId"))&&this.deselectCurrentWidget(),0<this.widgets.length&&(_.each(this.widgets,function(t){t.view&&_.isFunction(t.view.remove)&&t.view.remove()}),this.widgets=[],this.gridstack?(this.ignoreGridstackEvents=!0,this.gridstack.removeAll(),this.ignoreGridstackEvents=!1):this.$gridstack&&this.$gridstack.children(":not(.grid-stack-overlay)").remove())},createUserWidget:function(t,e){var i=new d.Widget({id:t.id});return e=e||t.get("layout").attributes,i.get("layout").set(e),i.set("component",t.get("component")),i},deselectCurrentWidget:function(){this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})},disableWidgetSelect:function(){this.ignoreWidgetSelect=!0;var t=this.currentActionWidget&&this.currentActionWidget.$widget?this.currentActionWidget.$widget.find(".errorPanel"):null;t&&t.css("pointer-events","none")},enableWidgetSelect:function(){this.userCan("select")&&(this.ignoreWidgetSelect=!1);var t=this.currentActionWidget&&this.currentActionWidget.$widget?this.currentActionWidget.$widget.find(".errorPanel"):null;t&&t.css("pointer-events","")},findWidgetItem:function(t){return _.find(this.widgets,{widgetId:t})},isUserEditMode:function(){return this.viewModel.get(this.KEY_USER_LAYOUT)&&this.quickView},generateUserLayout:function(t){var e={};return t.each(function(t){e[t.id]=t.get("layout").attributes}),e},getMaxRowCount:function(){var t=this.widgetsCollection.models;return _.max(t.map(function(t){t=t.get("layout");return t.get("row")+t.get("rowSpan")}))||0},getNewWidgetLayout:function(t){var e=t.get("layout"),i=e.get("row"),n=e.get("column"),t=e.get("rowSpan"),e=e.get("colSpan");(_.isNaN(i)||_.isNaN(n))&&(n=null),t&&e||(t=this.DEFAULT_WIDGET_ROW_SPAN,e=Math.ceil(this.columnCount/2))},highlightItemToBeReplaced:function(t){t.hasClass(this.CSS_REPLACING)||_.includes(["Accordion","FlexPanel","Panel","Tabs"],t.data("componentid"))||t.addClass(this.CSS_REPLACING)},initGridStack:function(){H.gsStyleManager.add(this.columnCount),this.applyGridStackMargin(),this.setupMinHeight(),this.modifyFillHeightModeCssClass(),this.gridstack=this.$gridstack.gridstack({animate:!1,cellHeight:this.usedRowHeight,height:this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.rowCount:0,float:this.viewModel.get(this.KEY_FLOATABLE),width:this.columnCount,verticalMargin:0,resizable:{autoHide:!1,handles:"ne,nw,se,sw,s,e,w"}}).data("gridstack"),this.setupGetGridHeight(),this.$gridstack.addClass("grid-stack-"+this.columnCount),this.updateOverlaySize(),this.$gridstack.data("dragdata",{}),this.$gridstack.on("resizestart",$.proxy(this.onWidgetResizeStart,this)),this.$gridstack.on("resize",$.proxy(this.onWidgetResize,this)),this.$gridstack.on("resizestop",$.proxy(this.onWidgetResizeStop,this)),this.$gridstack.on("gsresizestop",$.proxy(this.onWidgetGSResizeStop,this)),this.$gridstack.on("dragstart",$.proxy(this.onWidgetDraggingStart,this)),this.$gridstack.on("dragstop",$.proxy(this.onWidgetDraggingStop,this)),this.$gridstack.on("change",$.proxy(this.onGridstackChange,this)),this.$gridstack.on("dragenter",this.getSafeDragNDropHandler(this.onGridstackDragEnter)),this.$gridstack.on("dragleave",this.getSafeDragNDropHandler(this.onGridstackDragLeave)),this.$gridstack.on("dragover",this.getSafeDragNDropHandler(this.onGridstackDragOver)),this.$gridstack.on("drop",this.getSafeDragNDropHandler(this.onGridstackDrop)),this.dashboardViewModel.get("buildMode")||this.switchBuildMode(this.dashboardViewModel.get("buildMode"))},initSortable:function(){var o=this;this.$gridstack.sortable({stop:function(){var t=$(this).children();_.each(t,function(e,t){var i=_.find(o.widgets,function(t){return t.$widget[0]===e}),n=$(e);i&&(i.model.get("layout").set("row",t*o.DEFAULT_WIDGET_ROW_SPAN),i.model.get("layout").set("rowSpan",o.DEFAULT_WIDGET_ROW_SPAN)),n.attr("data-gs-y",t*o.DEFAULT_WIDGET_ROW_SPAN),n.attr("data-gs-height",o.DEFAULT_WIDGET_ROW_SPAN)})}}),this.$gridstack.disableSelection()},modifyFillHeightModeCssClass:function(){this.$gridstack.removeClass("fillHeightMode"),this.viewModel.get(this.KEY_RELATIVE_HEIGHT)&&this.$gridstack.addClass("fillHeightMode")},onChange_ColumnCount:function(){this.$gridstack.removeClass("grid-stack-"+this.columnCount),H.gsStyleManager.remove(this.columnCount),this.set_columnCount(),this.recalculateColumnWidth(),H.gsStyleManager.add(this.columnCount),this.$gridstack.addClass("grid-stack-"+this.columnCount),this.gridstack&&this.gridstack.setGridWidth(this.columnCount,!0),this.updateOverlaySize()},onChange_Floatable:function(){this.gridstack&&(this.gridstack.grid.float=this.gridstack.grid._float=this.viewModel.get(this.KEY_FLOATABLE),this.gridstack.batchUpdate(),this.gridstack.commit())},onChange_RelativeHeight:function(){this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.$worksheetHighlightItem.hide():this.$worksheetHighlightItem.show(),this.isBasePanel&&this.updatePropertyInspectorForBasePanel(),this.modifyFillHeightModeCssClass(),this.recalculateUsedRowHeight(),this.setupGetGridHeight(),this.setupMinHeight(),this.onResize(!0)},onChange_RowCount:function(){this.set_rowCount(),this.setupGetGridHeight(),this.recalculateUsedRowHeight(),this.updateOverlaySize(),!this.viewModel.get(this.KEY_ADVANCED)&&this.viewModel.get(this.KEY_RELATIVE_HEIGHT)&&this.onResize(!0)},onChange_RowHeight:function(){this.viewModel.get(this.KEY_ADVANCED)||(this.recalculateUsedRowHeight(),this.viewModel.get(this.KEY_RELATIVE_HEIGHT)||(this.gridstack.cellHeight(this.usedRowHeight),this.updateOverlaySize(),this.onResize(!0)))},onComponentDragOver:function(t){var e,i,n,o;return this.triggerDragEvent(t),!!this.userCan("addNew")&&(o=$(t.target).closest(".grid-stack-item"),this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.highlightItemToBeReplaced(o):(i=o.offset(),e=t.originalEvent.pageY-i.top,t=t.originalEvent.pageX-i.left,i=o.outerHeight(),e<=this.widgetEdge?(this.rowDropNo=_.parseInt(o.attr("data-gs-y")),n=0===this.rowDropNo?0:o.position().top-this.widgetEdge/2+1,this.onComponentDragOver_moveHighlightItem(o,n,t)):i-e<=this.widgetEdge?(n=o.position().top+i-this.widgetEdge+this.widgetEdge/2-1,this.rowDropNo=_.parseInt(o.attr("data-gs-y"))+_.parseInt(o.attr("data-gs-height")),this.onComponentDragOver_moveHighlightItem(o,n,t)):(this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),this.highlightItemToBeReplaced(o))),!1)},onComponentDragOver_moveHighlightItem:function(t,e,i){this.rowDrop=!0,t.removeClass(this.CSS_REPLACING);t=_.parseInt(t.attr("data-gs-x"))*this.columnWidth,t=this.gridstackMargin+t+Math.max(0,Math.floor(i/this.columnWidth)*this.columnWidth),i=Math.min(Math.round(this.recommendedWidth/this.columnWidth)*this.columnWidth,this.columnCount*this.columnWidth-t+this.gridstackMargin);this.colDrop=Math.round((t-this.gridstackMargin)/this.columnWidth),this.colSpanDrop=Math.round(i/this.columnWidth),this.rowSpanDrop=Math.round(this.recommendedHeight/this.usedRowHeight),this.$rowHighlightItem.css({top:e,"margin-left":t,width:i,display:"block"})},onComponentDragEnter:function(t){this.triggerDragEvent(t),this.setVisibility_overlayOnly(!0)},onComponentDragLeave:function(t){this.triggerDragEvent(t),$(t.target).closest(".grid-stack-item").removeClass(this.CSS_REPLACING),this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),this.isDropping||this.setVisibility_overlayOnly(!1)},onComponentDrop:function(t){var e,i,n,o=null;return void 0!==t.originalEvent.dataTransfer&&(e=t.originalEvent.dataTransfer.getData("text"),i=this.dashboardAppModel.get("components").get(e),this.userCan("addNew")&&(i?(this.rowDrop?(this.rowDrop=!1,o=this.rowDropNo,this.$rowHighlightItem.hide()):(n=$(t.currentTarget).attr("data-widgetid"),n=this.findWidgetItem(n),this.dashboardViewModel.set("selectedWidget",null)),this.onComponentDragLeave(t),n?this.addComponentToWidget(n.model,e,!0):this.addNewWidget(o,this.colDrop,this.rowSpanDrop,this.colSpanDrop,null,e,!1)):(this.$highlightItem.hide(),this.rowDrop=!1,this.$rowHighlightItem.hide())),!1)},onComponentDropWrap:function(t,e,i,n,o){t=t.originalEvent.dataTransfer.getData("text");this.dashboardAppModel.get("components").has(t)&&this.addNewWidget(e,i,n,o,null,t,!1)},onConfigureWidgetsMenuClick:function(t){var e=$(t.target).data("actionid"),t=$(t.target).data("widgetid");t?(t=this.model.get("widgets").get(t))&&(t=this.createUserWidget(t),this.userWidgets.add(t)):e&&"reset"===e&&this.userWidgets.reset(),this.$configureWidgets.removeClass("showing-menu")},onGridstackChange:function(t){t.currentTarget===t.target&&this.updateWidgetsLayout()},onGridstackDragEnter:function(t){this.setDraggedWidgetRecommendedSize(),this.triggerDragEvent(t),this.setVisibility_overlayOnly(!0)},onGridstackDragLeave:function(t){this.triggerDragEvent(t),this.isDropping&&(this.isDropping=!1,this.dashboardAppModel.get("smartDrop")&&this.$highlightItem.hide(),this.rowDrop=!1,this.$rowHighlightItem.hide()),this.setVisibility_overlayOnly(!1)},onGridstackDragOver:function(t,e){return this.triggerDragEvent(t),this.prevX=t.originalEvent.layerX,this.prevY=t.originalEvent.layerY,this.isDropping?this.dashboardAppModel.get("smartDrop")&&this.throttledUpdateHighlightItem(this.prevX,this.prevY):(this.isDropping=!0,this.dashboardAppModel.get("smartDrop")&&this.updateHighlightLayer(t),this.dashboardAppModel.get("smartDrop")&&(this.throttledUpdateHighlightItem(this.prevX,this.prevY),this.$highlightItem.show())),this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide()),this.setVisibility_overlayOnly(!0),!1},onGridstackDrop:function(t){var e,i,n,o;return this.deselectCurrentWidget(),i=parseInt(this.$highlightItem.css("left"),10),e=parseInt(this.$highlightItem.css("top"),10),o=parseInt(this.$highlightItem.css("width"),10),n=parseInt(this.$highlightItem.css("height"),10),this.onGridstackDragLeave(),e=Math.round(e/this.gridstack.cellHeight()),i=Math.round(i/this.columnWidth),n=Math.round(n/this.gridstack.cellHeight()),o=Math.round(o/this.columnWidth),this.onComponentDropWrap(t,e,i,n,o),!1},onMaterialChange:function(){this.documentViewModel.trigger("materialChange")},onPanelDragEvent:function(t){t&&this.dashboardViewModel.get("buildMode")&&(t=$(t.target),_.includes(["Accordion","FlexPanel","Panel","Tabs"],t.closest(".grid-stack-item").data("componentid"))?this.$gridOverlay.hide():(t=t.closest(".worksheet")).length?t.get(0)===this.$worksheet.get(0)?this.$gridOverlay.show():this.$gridOverlay.hide():this.changeOverlayVisibilty())},onPropAdvanced:function(){this.clearPanel_initGridstack(),this.populatePanelWithWidgets()},onRemoveWidget:function(t){this.isUserEditMode()?this.widgetsCollection.remove(t):this.widgetsCollection.commandRemove(t)},onResize:function(t){!this.viewModel.get(this.KEY_ADVANCED)&&this.gridstack?(this.viewModel.get(this.KEY_RELATIVE_HEIGHT)&&(t=!0,this.setupMinHeight()),t&&(this.gridstack.setAnimation(!1),this.gridstack.batchUpdate(),this.recalculateUsedRowHeight(),this.recalculateColumnWidth(),this.gridstack.cellHeight(this.usedRowHeight),this.updateOverlaySize(),this.gridstack.commit(),this.onResizeWidgets(),this.gridstack.container.outerHeight(),this.gridstack.setAnimation(!0))):this.onResizeWidgets()},onResizeWidgets:function(){_.each(this.widgets,function(t){t.view&&(_.isFunction(t.view.onResize)&&t.view.onResize(!0),_.isFunction(t.view.onResizeStop)&&t.view.onResizeStop(!0))})},onSettingsChange:function(t){var i=this;_.each(t,function(t,e){i.viewModel.set(e,t)}),this.initializePost()},onShowConfigureWidgetsMenu:function(){this.$configureWidgets.toggleClass("showing-menu"),this.$configureWidgets.hasClass("showing-menu")&&this.$configureWidgetsMenu.position({of:this.$showConfigureWidgetsMenu,my:"right top",at:"right bottom"})},onUserLayoutReset:function(){this.api.saveSetting("layout",""),this.populateUserWidgetsCollection(),this.clearPanel_initGridstack(),this.populatePanelWithWidgets()},onWidgetDraggingStart:function(t,e){e&&e.helper&&e.helper.parent().get(0)===this.$gridstack.get(0)&&(this.setVisibility_overlay_outline(!0),this.disableWidgetSelect())},onWidgetDraggingStop:function(t,e){e&&e.helper&&e.helper.parent().get(0)===this.$gridstack.get(0)&&(this.setVisibility_overlay_outline(!1),this.enableWidgetSelect())},onWidgetMouseDown:function(t){t=$(t.currentTarget).attr("data-widgetid");t&&(this.currentActionWidget=this.findWidgetItem(t))},onWidgetGSResizeStop:function(t,e){this.gridstack.setAnimation(!1);var i=$(e).attr("data-gs-width")*this.gridstack.cellWidth(),e=$(e).attr("data-gs-height")*this.gridstack.cellHeight();this.currentActionWidget&&this.currentActionWidget.view&&this.currentActionWidget.view.onResize&&(this.currentActionWidget.view.onResize(),this.currentActionWidget.view.onResizeStop&&this.currentActionWidget.view.onResizeStop(i,e),this.currentActionWidget=null),this.gridstack.setAnimation(!0)},onWidgetResize:function(t,e){},onWidgetResizeStart:function(t,e){e&&e.element&&e.element.parent().get(0)===this.$gridstack.get(0)&&(this.gridstack.setAnimation(!1),this.setVisibility_overlay_outline(!0),this.disableWidgetSelect(),this.currentActionWidget&&this.currentActionWidget.view&&this.currentActionWidget.view.onResize&&(this.currentActionWidget.view.onResizeStart&&this.currentActionWidget.view.onResizeStart(),this.currentActionWidget.view.onResize()))},onWidgetResizeStop:function(t,e){e&&e.element&&e.element.parent().get(0)===this.$gridstack.get(0)&&(this.gridstack.setAnimation(!0),this.setVisibility_overlay_outline(!1),this.dashboardViewModel.get("buildMode")&&this.enableWidgetSelect())},onWorksheetClick:function(t){this.isBasePanel&&this.dashboardViewModel.get("buildMode")&&this.deselectCurrentWidget()},onWorksheetDragEnter:function(t){this.setDraggedWidgetRecommendedSize(),this.triggerDragEvent(t),this.setVisibility_overlayOnly(!0)},onWorksheetDragLeave:function(t){this.triggerDragEvent(t),this.isDraggingOverWorksheet&&(this.isDraggingOverWorksheet=!1,this.$worksheetHighlightItem.removeClass("now-over")),this.rowDrop=!1,this.$rowHighlightItem.hide(),this.isDropping||this.setVisibility_overlayOnly(!1)},onWorksheetDragOver:function(t){return this.triggerDragEvent(t),this.userCan("addNew")&&(this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.isDraggingOverWorksheet||(this.isDraggingOverWorksheet=!0,this.$worksheetHighlightItem.css({"margin-left":this.gridstackMargin,display:"none"}).addClass("now-over")):(this.isDraggingOverWorksheet=!0,n=t.originalEvent.layerX,e=this.gridstackMargin,i=this.usedRowHeight,t=this.columnWidth*this.columnCount,e+=n=Math.max(0,Math.floor((n-e)/this.columnWidth)*this.columnWidth),i=Math.round(this.recommendedHeight/this.usedRowHeight)*this.usedRowHeight,t=Math.min(Math.round(this.recommendedWidth/this.columnWidth)*this.columnWidth,this.columnWidth*this.columnCount-n),this.$worksheetHighlightItem.css({"margin-left":e,display:"block",width:t,height:i}).addClass("now-over")),this.rowDrop&&(this.rowDrop=!1,this.$rowHighlightItem.hide())),!1;var e,i,n},onWorksheetDrop:function(t){if(this.deselectCurrentWidget(),this.isDraggingOverWorksheet){if(this.isDraggingOverWorksheet=!1,this.$worksheetHighlightItem.removeClass("now-over"),this.$worksheetHighlightItem.hide(),this.gridstack&&this.viewModel.get(this.KEY_RELATIVE_HEIGHT))return!1;var e=this.getMaxRowCount(),i=_.parseInt(this.$worksheetHighlightItem.css("margin-left"))-this.gridstackMargin,n=Math.round(i/this.columnWidth),o=_.parseInt(this.$worksheetHighlightItem.css("height")),i=Math.round(o/this.usedRowHeight)||this.DEFAULT_WIDGET_ROW_SPAN,o=_.parseInt(this.$worksheetHighlightItem.css("width")),o=Math.round(o/this.columnWidth)||Math.ceil(this.columnCount/2);this.onComponentDropWrap(t,e,n,i,o)}return!1},pasteWidget:function(t){var e,i=t.clone(),t=i.get("component").get("definitionId"),n=this.dashboardViewModel.get("selectedWidgetView");if(n)switch(n.model instanceof d.Popup?"Popup":n.model.get("key")){case"Accordion":n.app.pasteWidget(i);break;case"Tabs":var o=i.get("component");o.set("id",i.get("id")),n.app.componentModel.get("components").add(o),i.get("component").setParent(n.app.componentModel.get("components"));break;case"Popup":n.pasteWidget(i);break;case"FlexPanel":n.app.pasteWidget(i);break;case"Panel":e=n.app;break;default:for(var s,a=n.model;!s&&(a=a.parent);)s=a.panelView;e=s||this}else e=this;e&&(e.changeLayout(i)?(e.addNewWidget(null,null,null,null,i,t,!0),i.setParent(e.widgetsCollection)):d.ErrorDialog.ShowError("No space available!"))},populatePanelWithWidgets:function(){var t=this.widgetsCollection.sortBy(function(t){t=t.get("layout");return 1e3*t.get("row")+t.get("column")});this.gridstack&&this.gridstack.batchUpdate(),this.ignoreGridstackEvents=!0,_.each(t,function(t){this.addWidget(t,!0,null)}.bind(this)),this.ignoreGridstackEvents=!1,this.gridstack&&(this.gridstack.commit(),_.defer(function(){this.gridstack&&this.gridstack.setAnimation(!0)}))},populateUserWidgetsCollection:function(){var i=this,e=this.api.loadSetting("layout");try{e=JSON.parse(e)}catch(t){e=null}e=e?_.pick(e,i.model.get("widgets").map(function(t){return t.id})):this.generateUserLayout(this.model.get("widgets")),_.isEmpty(e)?this.debouncedRenderConfigureWidgetsMenu():_.each(e,function(t,e){e=i.model.get("widgets").get(e);e&&(t=i.createUserWidget(e,{row:t.row,column:t.column,rowSpan:t.rowSpan,colSpan:t.colSpan}),i.userWidgets.add(t))})},recalculateUsedRowHeight:function(){this.viewModel.get(this.KEY_ADVANCED)?this.usedRowHeight=null:this.viewModel.get(this.KEY_RELATIVE_HEIGHT)?this.usedRowHeight=(this.$worksheet.height()-2*this.gridstackMargin)/this.rowCount:this.usedRowHeight=this.viewModel.get(this.KEY_ROW_HEIGHT)},recalculateColumnWidth:function(){this.columnWidth=(this.$worksheet.width()-2*this.gridstackMargin)/this.columnCount},recreateGridStackPanel:function(){this.$gridstack=$(document.createElement("div")),this.$gridstack.addClass("grid-stack"),this.$gridOverlay=$(document.createElement("div")).addClass("grid-stack-overlay").appendTo(this.$gridstack).hide(),this.changeOverlayVisibilty(),this.$gridstack.prependTo(this.$worksheet)},remove:function(){this.stopListening(),this.$worksheet.off(),this.$showConfigureWidgetsMenu.off(),this.$configureWidgetsMenu.off(),this.$gridstack.off(),this.clearWidgets(),this.removeGridstack(!0),this.isBasePanel&&(this.onPanelDragEvent_throttled.cancel(),$(window).off("dragover",this.triggerDragEvent)),e.View.prototype.remove.apply(this)},removeGridstack:function(t){this.gridstack&&(this.gridstack.destroy(),this.gridstack=null,this.$gridstack.remove(),H.gsStyleManager.remove(this.columnCount),t||this.recreateGridStackPanel())},removeWidget:function(t){t&&(_.pull(this.widgets,t),this.userCan("addNew")&&this.widgets.length<=0&&this.$noWidgetsInfo.show(),t.$widget.css({border:"none",background:"none","box-shadow":"none","pointer-events":"none"}),t.view&&t.view.remove&&t.view.remove(),t.$widget.off(),this.gridstack?(this.ignoreGridstackEvents=!0,this.gridstack.removeWidget(t.$widget),this.ignoreGridstackEvents=!1):t.$widget.remove())},render:function(){return this.$el.addClass("panel"),this.$el.html(i.app()),this.$worksheet=this.$el.find("> .worksheet"),this.$gridstack=this.$worksheet.find("> .grid-stack"),this.$worksheetHighlightItem=this.$worksheet.find("> .worksheet-highlight-item"),this.$rowHighlightItem=this.$worksheet.find("> .row-highlight-item"),this.$gridOverlay=this.$gridstack.find("> .grid-stack-overlay").hide(),this.$highlightLayer=this.$worksheet.find("> .highlight-viewport > .highlight-layer"),this.$highlightItem=this.$highlightLayer.find("> .highlight-item"),this.$configureWidgets=this.$el.find("> .configure-widgets"),this.$configureWidgetsMenu=this.$configureWidgets.find("> .configure-widgets-menu"),this.$showConfigureWidgetsMenu=this.$configureWidgets.find("> .show-configure-menu"),this.$noWidgetsInfo=this.$worksheet.find("> .no-widgets-info"),this.$configureWidgetsMenu.menu({items:"> :not(.ui-widget-header)"}),this},renderComponent:function(t,e){var e=this.createComponentView(t,e);this.trackWidgetModelChanges(t.model),e=$("<div/>",{class:"grid-stack-item-content"}).append(e.$el),t.$widget.append(e)},renderConfigureWidgetsMenu:function(){var t,e=this;this.isUserEditMode()&&(t=this.model.get("widgets").reject(function(t){return e.userWidgets.has(t)}),this.$configureWidgets.toggleClass("widgets-available",!_.isEmpty(t)),this.$configureWidgetsMenu.html(i.configureWidgetsMenu({widgets:_.map(t,function(t){return{id:t.id,name:t.get("component").get("options").get("format.widgetTitle")||t.get("component").get("key")}})})),this.$configureWidgetsMenu.menu("refresh"))},renderWidget:function(t){var e=t.get("layout"),i=e.get("row"),n=e.get("column"),t=e.get("rowSpan"),e=e.get("colSpan");return(_.isNaN(i)||_.isNaN(n))&&(n=i=null),t&&e||(t=this.DEFAULT_WIDGET_ROW_SPAN,e=Math.ceil(this.columnCount/2)),this.viewModel.get(this.KEY_ADVANCED)?($widget=$('<div class="advanced-item">'),void 0!==n&&$widget.attr("data-gs-x",n),void 0!==i&&$widget.attr("data-gs-y",i),void 0!==e&&$widget.attr("data-gs-width",e),void 0!==t&&$widget.attr("data-gs-height",t),this.$gridstack.append($widget),this.quickView||this.initSortable()):$widget=this.gridstack.addWidget("<div/>",n,i,e,t,null==n||null==i),$widget},set_columnCount:function(){this.columnCount=this.viewModel.get(this.KEY_COLUMN_COUNT)},set_rowCount:function(){this.rowCount=this.viewModel.get(this.KEY_ROW_COUNT)},setDraggedWidgetRecommendedSize:function(){var t=this.dashboardAppModel.get("draggedComponentId"),t=this.dashboardAppModel.get("components").get(t),t=_.get(t,"attributes.size",[300,200]);this.recommendedWidth=t[0],this.recommendedHeight=t[1]},setupGetGridHeight:function(){var t=this,e=this.viewModel.get(this.KEY_RELATIVE_HEIGHT);this.gridstack&&(e?(this.gridstack.grid.getGridHeight=function(){return t.rowCount},this.gridstack.grid.height=this.rowCount):(this.gridstack.grid.getGridHeight=GridStackUI.Engine.prototype.getGridHeight,this.gridstack.grid.height=0))},setupMinHeight:function(){},setVisibility_overlayOnly:function(t){!this.dashboardViewModel.get("buildMode")||(t?this.$gridOverlay.show():this.$gridOverlay.hide())},setVisibility_overlay_outline:function(t){this.$gridstack.removeClass("outlinedLocal"),t?(this.$gridstack.addClass("outlinedLocal"),this.$gridOverlay.show()):this.changeOverlayVisibilty()},stopTrackingWidgetChanges:function(t){t=t.model;this.stopListening(t.get("layout"),"change"),this.stopListening(t.get("component").get("options"),"change")},switchOffBuildMode:function(t){this.gridstack&&this.gridstack.disable(),this.$el.removeClass("user-configurable"),this.disableWidgetSelect(),this.$gridstack.find("> div").addClass("build-off"),this.viewModel.get("Basics.Advanced")&&this.$gridstack.sortable("instance")&&this.$gridstack.sortable("destroy"),this.isUserEditMode()&&t&&(t=this.generateUserLayout(this.widgetsCollection),_.isEqual(t,this.api.loadSetting("layout"))||(this.api.saveSetting("layout",JSON.stringify(t)),this.dashboardViewModel.trigger("widgets-configured")),this.$configureWidgets.removeClass("showing-menu"))},switchOnBuildMode:function(t){var e=this;this.userCan("layout")&&(this.gridstack&&this.gridstack.enable(),this.$el.addClass("user-configurable")),this.userCan("select")&&this.enableWidgetSelect(),this.viewModel.get("Basics.Advanced")&&this.initSortable(),this.userCan("configure")&&setTimeout(function(){e.$gridstack.find("> div").removeClass("build-off")},100)},trackWidgetModelChanges:function(o){this.listenTo(o.get("layout"),"change",function(t){this.gridstack&&this.gridstack.setAnimation(!1);var e=_.find(this.widgets,{widgetId:o.id}),i=e.$widget,n=t.attributes;this.ignoreGridstackEvents=!0,this.gridstack&&this.gridstack.update(i,n.column,n.row,n.colSpan,n.rowSpan),this.ignoreGridstackEvents=!1,(t.hasChanged("colSpan")||t.hasChanged("rowSpan"))&&_.hasIn(e,"view.app.onResize")&&e.view.app.onResize(),_.defer(function(){this.gridstack&&this.gridstack.setAnimation(!0)}.bind(this))})},triggerDragEvent:function(t){this.dashboardViewModel.trigger("onPanelDragEvent",t)},updateHighlightItem:function(i,n){var t=this.$gridstack,e=t.width(),o=t.height(),t=t.find("> .grid-stack-item"),s=[],a=[],r=[],d=[];s.push(0),r.push(0),a.push(e),d.push(o),_.each(t,function(t){var e=$(t),t=e.position();t.right=t.left+e.width(),t.bottom=t.top+e.height(),t.top<n?r.push(t.top):t.top>n&&d.push(t.top),t.bottom<n?r.push(t.bottom):t.bottom>n&&d.push(t.bottom)}),r=_.max(r),d=_.min(d),_.each(t,function(t){var e=$(t),t=e.position();t.right=t.left+e.width(),t.bottom=t.top+e.height(),(t.bottom>d&&t.top<d||t.top<r&&t.bottom>r||t.top>r&&t.bottom<d||t.top<r&&t.bottom>d||t.top===r&&t.bottom===d)&&(t.left<i?s.push(t.left):t.left>i&&a.push(t.left),t.right<i?s.push(t.right):t.right>i&&a.push(t.right))}),s=_.max(s),a=_.min(a),s=Math.max(0,Math.floor(i/this.columnWidth)*this.columnWidth),a=Math.min(a,s+Math.max(1,Math.round(this.recommendedWidth/this.columnWidth))*this.columnWidth),this.viewModel.get(this.KEY_FLOATABLE)&&(r=Math.floor(n/this.usedRowHeight)*this.usedRowHeight),d=Math.min(d,r+Math.max(1,Math.round(this.recommendedHeight/this.usedRowHeight))*this.usedRowHeight),this.$highlightItem.css({left:s,width:a-s,top:r,height:d-r})},updateHighlightLayer:function(){var t={top:0,left:0},e=this.$gridstack.position();t.top+=this.gridstackMargin,t.left+=e.left+this.gridstackMargin,t.top+=parseInt(this.$gridstack.parent().css("margin-top")),t.left+=parseInt(this.$gridstack.parent().css("margin-left")),this.$highlightLayer.css({"margin-top":t.top,"margin-left":t.left,width:this.$gridstack.width(),height:this.$gridstack.height()})},updateOverlaySize:function(){this.$gridOverlay.css({"background-size":100/this.columnCount+"% "+this.usedRowHeight+"px"})},updateWidgetsLayout:function(e){this.ignoreGridstackEvents||this.isUserEditMode()?_.each(this.widgets,function(t){t.model.get("layout").set({row:parseInt(t.$widget.attr("data-gs-y"),10),column:parseInt(t.$widget.attr("data-gs-x"),10),rowSpan:parseInt(t.$widget.attr("data-gs-height"),10),colSpan:parseInt(t.$widget.attr("data-gs-width"),10)},{silent:e||!1})}):this.widgetsCollection.commandSet(_.map(this.widgets,function(t){return{id:t.model.id,layout:{row:parseInt(t.$widget.attr("data-gs-y"),10),column:parseInt(t.$widget.attr("data-gs-x"),10),rowSpan:parseInt(t.$widget.attr("data-gs-height"),10),colSpan:parseInt(t.$widget.attr("data-gs-width"),10)}}}),{silent:e||!1})},upgradeGridsterLayout:function(){var t=this.widgetsCollection.map(function(t){return t.get("layout")});this.viewModel.get(this.KEY_FLOATABLE)||_.some(t,function(t){return 0===t.get("row")||0===t.get("column")})||_.each(t,function(t){t.set("row",t.get("row")-1),t.set("column",t.get("column")-1)})},userCan:function(t){var e=!1;return this.dashboardViewModel.get("buildMode")&&(this.quickView?this.isUserEditMode()&&(_.includes(["addNew","select"],t)||(e=!0)):e=!0),e}},{getComponentDefinition:s.getComponentDefinition,gsStyleManager:new o});return H});