define(["vs/editor/editor.main","polyfill","backbone","Handlebars","css!./css/app.css"],function(d,e,n,t){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},a="abs|aj|acos|all|and|any|asc|asin|asof|atan|attr|avg|avgs|bin|binr|by|ceiling|cols|cor|cos|count|cov|cross|csv|cut|delete|deltas|desc|dev|differ|distinct|div|do|dsave|each|ej|ema|enlist|eval|except|exec|exit|exp|fby|fills|first|flip|floor|fkeys|from|get|getenv|group|gtime|hclose|hcount|hdel|hopen|hsym|iasc|idesc|if|ij|in|insert|inter|inv|key|keys|last|ljf|like|lj|load|log|lower|lsq|ltime|ltrim|mavg|max|maxs|mcount|md5|mdev|med|meta|min|mins|mmax|mmin|mmu|mod|msum|neg|next|not|null|or|over|parse|peach|pj|prd|prds|prev|prior|rand|rank|ratios|raze|read0|read1|reciprocal|reval|reverse|rload|rotate|rsave|rtrim|save|scan|scov|sdev|svar|select|set|setenv|show|signum|sin|sqrt|ss|ssr|string|sublist|sum|sums|sv|system|tables|tan|til|trim|type|uj|ungroup|union|update|upper|upsert|value|var|view|views|vs|wavg|where|while|within|wj|wsum|ww|xasc|xbar|xcol|xcols|xdesc|xexp|xgroup|xkey|xlog|xprev|xrank",s="asBoolean|asByte|asChar|asDate|asDatetime|asFloat|asGUID|asInt|asList|asLong|asMinute|asMonth|asReal|asSecond|asShort|asString|asSymbol|asTime|asTimespan|asTimestamp|asType|catch|INFINITY|isAtom|isBoolean|isByte|isChar|isCompound|isDate|isDatetime|isDict|isDictionary|isEmpty|isEnum|isFloat|isFunction|isGeneral|isGUID|isInfinity|isInt|isKeyedTable|isLinked|isList|isLong|isMinute|isMonth|isNull|isNumber|isReal|isSecond|isShort|isString|isSymbol|isTable|isTime|isTimespan|isTimestamp|isType|isVector|NULL|parseBoolean|parseByte|parseChar|parseDate|parseDatetime|parseFloat|parseGUID|parseInt|parseLong|parseMinute|parseMonth|parseReal|parseSecond|parseShort|parseSymbol|parseTime|parseTimespan|parseTimestamp|parseType|typeOf|typeSymbol|until|xor",u="Mlim|Q7|access|accp|adict|arch|assign|badtail|branch|cast|char|conn|constants|domain|elim|glim|globals|length|limit|locals|loop|mismatch|mq|noamend|nosocket|noupdate|nyi|os|par|params|part|pl|pwuid|splay|srv|stack|step|stop|stype|sys|threadview|unmappable|upd|user|utf8|vd1|wha|wsfull|wsm",l=(new RegExp("^("+u+")\\b"),f.prototype.eol=function(){return this.pos>=this.string.length},f.prototype.sol=function(){return this.pos==this.lineStart},f.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},f.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},f.prototype.eat=function(e){var t=this.string.charAt(this.pos),e="string"==typeof e?t==e:t&&(e.test?e.test(t):e(t));if(e)return++this.pos,t},f.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},f.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},f.prototype.skipToEnd=function(){this.pos=this.string.length},f.prototype.skipTo=function(e){e=this.string.indexOf(e,this.pos);if(-1<e)return this.pos=e,!0},f.prototype.backUp=function(e){this.pos-=e},f.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=c(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?c(this.string,this.lineStart,this.tabSize):0)},f.prototype.indentation=function(){return c(this.string,null,this.tabSize)-(this.lineStart?c(this.string,this.lineStart,this.tabSize):0)},f.prototype.match=function(e,t,n){if("string"!=typeof e){var o=this.string.slice(this.pos).match(e);return o&&0<o.index?null:(o&&!1!==t&&(this.pos+=o[0].length),o)}o=function(e){return n?e.toLowerCase():e};if(o(this.string.substr(this.pos,e.length))==o(e))return!1!==t&&(this.pos+=e.length),!0},f.prototype.current=function(){return this.string.slice(this.start,this.pos)},f.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},f.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},f.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)},f);function f(e,t,n){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=n}function c(e,t,n,o,r){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var i=o||0,a=r||0;;){var s=e.indexOf("\t",i);if(s<0||t<=s)return a+(t-i);a+=s-i,a+=n-a%n,i=s+1}}var m=(p.prototype.clone=function(){return new p(this)},p.prototype.equals=function(e){return e===this},p);function p(e){var t=e.mode,n=e.prevToken,o=e.braceDepth,r=e.qukeMixed,e=e.depth;this.mode=t,this.prevToken=n,this.braceDepth=o,this.qukeMixed=r,this.depth=e}var h,g,b,y,k,v,w,T,S,x,C,L,M,O,D,P,V,A,B,N,E,j,q,z,I,R,U,F,Z,W,Q,G,K=(h={},b=!!(g={name:"q",isSpreadsheet:"false"}).isSpreadsheet,y=/^[\[({]/,k=/^[\])}]/,v=/^[a-zA-Z](\.|$|(?![a-zA-Z0-9_]))/,w=/^[~!@#$%^&*:<>,\?|+=_-]/,T=/^[012]:/,S=/^(&&|\|\||(<>|[<>]=):|[~!@#$%\^&*\-_+\\,?]=)/,x=new RegExp("^("+u+")\\b"),C=/^(asDatetime|parseDatetime)$/,L=/^[a-zA-Z]/,M=/^[a-zA-Z0-9.]/,O=/^[a-zA-Z0-9._/:]*/,D=/^[a-zA-Z0-9._]*(:[a-zA-Z0-9._/:]*)?/,P=/^[a-zA-Z][a-zA-Z]?[1-9][0-9]*\b/,V=/^([abBcCdefgopPsStTuvwWxz]|ts)\b/,A=/^\/*\s*@?TODO\b/i,B=/^k\)/,N=/^([\\\/nrt"0-7])/,E=/^\s+$/,j=/^[a-zA-Z0-9_]*/,q=/^[a-zA-Z0-9_]*(\.[a-zA-Z0-9_]+)*\.?/,z=new RegExp("^[a-zA-Z0-9_]+\\.("+a+"|"+s+")(\\.[a-zA-Z0-9_]+)*\\.?\\b"),I=/^([0-9]+(f|e(-?[0-9]+e?)?)?|(f|e(-?[0-9]+e?)?))/,F=["0[nNwW][hjemdzuvtifpgn]?",R="[10]+b",U="0x[\\da-fA-Fa-f]*","\\d{4}\\.\\d{2}([ptnm]|\\.\\d{2}([DPtdp](\\d{2}(:\\d{2}(:\\d{2}(\\.\\d{0,9})?)?)?)[pn]?|[pnd]?))","\\d{2}:\\d{2}(:\\d{2}(\\.\\d{0,9})?)?[ptnvu]?|\\d{2}[ptnvu]","\\d{1,6}D(\\d{1,2}(:\\d{2}(:\\d{2}(\\.\\d{0,9}|\\.?)?)?)?)?[np]?","\\d{1,6}P\\d{2}:\\d{2}([np]|:\\d{2}([np]|\\.[np]|\\.\\d{0,9}[np]|\\.\\d{3,9}[np]?))","(\\d+(\\.\\d*)?|\\d*\\.\\d+)(e[+-]?\\d+)[ef]?|(\\d+\\.\\d*|\\d*\\.\\d+)[ef]?|\\d+[eihjf]?"].join("|"),Z=new RegExp("^("+R+"|"+U+"|"+F+")"),W=new RegExp("^("+F+")"),Q=new RegExp("^("+a+"|"+s+(b?"":"|aj0|wj1")+")\\b"),{startState:function(){return new m({mode:G.SOL,prevToken:null,braceDepth:0,qukeMixed:!!g.qukeMixed,depth:0})},indent:function(e){return h.indentUnit*e.depth},token:function(e,t){if(e.sol()&&t.mode!==G.commentTilEnd&&t.mode!==G.multilineComment&&t.mode!==G.unclosedString&&(t.mode=G.SOL,t.prevToken="SOL"),t.mode===G.unclosedString)return e.eat("\\")?ue(t,"error-SOLBackslashInString"):Y(e,t);if(t.mode===G.SOL){if(e.eatSpace())return t.mode=G.afterSpace,null;if(e.eat("/"))return r=t,(o=e).eol()||o.match(E)?(o.eatSpace(),r.mode=G.multilineComment,ue(r,"error-multilineComment")):te(o,r);if(!t.qukeMixed&&0<t.depth&&")"!==e.peek()&&"]"!==e.peek()&&"}"!==e.peek())return e.next(),ue(t,"error-unindentedToken");if(e.match(B,!1,!1))return n=t,e.skipToEnd(),ue(n,"command");if(e.match(L,!1,!1))return ee(e,t);if(e.eat(";"))return t.mode=G.afterPunctuation,null;if(e.eat("\\"))return ne(e,t);if(e.eat("`"))return X(e,t);if(e.eat("."))return re(e,t);if(e.eat('"'))return Y(e,t);if(e.eat("'"))return ie(e,t);if(e.eat("-"))return H(e,t);if(e.match(S,!0,!1))return t.mode=G.afterPunctuation,ue(t,"error");if(e.eat(w))return t.mode=G.afterPunctuation,ue(t,"keyword");if(e.eat(y))return se(t);if(e.eat(k))return ae(t),ue(t,"error-unindentedToken");if(e.match(T,!0,!1))return t.mode=G.afterPunctuation,ue(t,"keyword");if(e.match(Z,!0,!1))return t.mode=G.afterVarNumSym,ue(t,"number")}else if(t.mode===G.afterSpace){if(e.eatSpace(),e.match(L,!1,!1))return ee(e,t);if(e.eat(";"))return t.mode=G.afterPunctuation,null;if(e.eat("/"))return te(e,t);if(e.eat("`"))return X(e,t);if(e.eat("."))return re(e,t);if(e.eat('"'))return Y(e,t);if("\\"===e.peek()&&"SOL"===t.prevToken)return e.next(),ue(t,"error-indentedCommand");if(e.eat(/['\\]/))return ie(e,t);if(e.eat("-"))return H(e,t);if(e.match(S,!0,!1))return t.mode=G.afterPunctuation,ue(t,"error");if(e.eat(w))return t.mode=G.afterPunctuation,ue(t,"keyword");if(e.eat(y))return se(t);if(e.eat(k))return ae(t);if(e.match(T,!0,!1))return t.mode=G.afterPunctuation,ue(t,"keyword");if(e.match(Z,!0,!1))return t.mode=G.afterVarNumSym,ue(t,"number")}else if(t.mode===G.afterVarNumSym){if(e.eatSpace())return t.mode=G.afterSpace,null;if(e.eat(";"))return t.mode=G.afterPunctuation,null;if(e.eat("`"))return X(e,t);if(e.eat('"'))return Y(e,t);if(e.eat(/['/\\]/))return ie(e,t);if(e.match(S,!0,!1))return t.mode=G.afterPunctuation,ue(t,"error");if(e.eat(w))return t.mode=G.afterPunctuation,ue(t,"keyword");if(e.eat(y))return se(t);if(e.eat(k))return ae(t);if(e.match(/^[Tz]/))return t.mode=G.afterPunctuation,ue(t,"error-datetime")}else if(t.mode===G.afterPunctuation||t.mode===G.afterOpenBracket||t.mode===G.afterCloseBracket){if(e.eatSpace())return t.mode=G.afterSpace,null;if(e.match(L,!1,!1))return ee(e,t);if(e.eat(";"))return t.mode=G.afterPunctuation,null;if(e.eat("`"))return X(e,t);if(e.eat("."))return re(e,t);if(e.eat('"'))return Y(e,t);if(e.eat(/['/\\]/))return ie(e,t);if(e.eat("-"))return H(e,t);if(e.match(S,!0,!1))return t.mode=G.afterPunctuation,ue(t,"error");if(e.eat(w))return t.mode=G.afterPunctuation,ue(t,"keyword");if(e.eat(y))return se(t);if(e.eat(k))return ae(t);if(e.match(T,!0,!1))return t.mode=G.afterPunctuation,ue(t,"keyword");if(e.match(Z,!0,!1))return t.mode=G.afterVarNumSym,ue(t,"number")}else{if(t.mode===G.commentTilEnd)return e.skipToEnd(),ue(t,"comment");if(t.mode===G.multilineComment)return n=t,(t=e).eat("\\")&&(t.eol()||t.match(E))?(t.eatSpace(),n.mode=G.SOL):t.skipToEnd(),ue(n,"error-multilineComment")}var n,o,r;return e.next()}});function H(e,t){return t.mode!==G.afterCloseBracket&&e.match(W,!0,!1)?(t.mode=G.afterVarNumSym,ue(t,"number")):(t.mode=G.afterPunctuation,ue(t,"keyword"))}function J(e,t,n){return e.match(q,!0,!1),t.mode=G.afterVarNumSym,ue(t,n)}function Y(e,t){for(;;){if(e.eat('"'))return t.mode=G.afterPunctuation,ue(t,"string");if(e.eol())return t.mode=G.unclosedString,ue(t,"string");if(e.eat("\\")){if(!e.eat(N))return e.next(),ue(t,"error-invalidEscape")}else e.next()}}function X(e,t){return e.eat(M)?e.match(D,!0,!1):e.eat(":")&&e.match(O,!0,!1),t.mode=G.afterVarNumSym,ue(t,"symbol")}function ee(e,t){var n=e.match(j,!0,!1);return t.mode=G.afterVarNumSym,C.test(n[0])?ue(t,"error-datetime"):Q.test(n[0])?ue(t,"keyword"):x.test(n[0])?ue(t,"error-illegalKeyword"):e.eat(".")?J(e,t,"variable"):b&&n[0].match(P)?ue(t,"cell"):ue(t,"variable")}function te(e,t){return e.match(A,!0)?(e.skipToEnd(),ue(t,"toDo")):(e.skipToEnd(),ue(t,"comment"))}function ne(e,t){return e.eol()||e.match(E)?(e.eatSpace(),t.mode=G.commentTilEnd,e.skipToEnd(),ue(t,"error-multilineComment")):0<t.depth?(t.mode=G.afterPunctuation,ue(t,"error-unindentedToken")):(t=t,((e=e).match(V,!0,!1)?function(e,t){return e.eat(" ")||e.eol()?ue(t,"command"):oe(e,t)}:oe)(e,t))}function oe(e,t){return e.skipToEnd(),ue(t,"command")}function re(e,t){return e.match(v,!1,!1)?J(e,t,"keyword"):e.match(z,!0,!1)?ue(t,"error-reservedInContext"):e.match(L,!1,!1)?J(e,t,"variable"):e.match(I,!0,!1)?(t.mode=G.afterVarNumSym,ue(t,"number")):(t.mode=G.afterPunctuation,ue(t,"keyword"))}function ie(e,t){return e.eatWhile(":"),t.mode=G.afterPunctuation,ue(t,"keyword")}function ae(e){return e.depth--,e.mode=G.afterCloseBracket,null}function se(e){return e.depth++,e.mode=G.afterOpenBracket,null}function ue(e,t){return e.prevToken=t}var de=[{id:"foldAll",text:"Collapse All",action:"editor.foldAll",icon:"fa fa-minus"},{id:"foldRecursively",text:"Collapse",action:"editor.foldRecursively",icon:"fa fa-minus"},{id:"unfoldAll",text:"Expand All",action:"editor.unfoldAll",icon:"fa fa-plus"},{id:"unfoldRecursively",text:"Expand",action:"editor.unfoldRecursively",icon:"fa fa-plus"},{id:"format",text:"Format",action:"editor.action.formatDocument",icon:"fa fa-align-right"}],le={autoIndent:!0,automaticLayout:!0,contextmenu:!0,fixedOverflowWidgets:!0,formatOnType:!0,fontSize:12,lineDecorationsWidth:0,lineNumbersMinChars:2,scrollBeyondLastLine:!(G={SOL:0,afterSpace:1,afterVarNumSym:2,afterPunctuation:3,unclosedString:4,multilineComment:5,commentTilEnd:6,afterOpenBracket:7,afterCloseBracket:8}),wordWrap:"on",dragAndDrop:!1},fe=["plaintext","json","handlebars","html","java","javascript","markdown","python","r","sql","typescript","xml","q"],ce=(me.getComponentDefinition=function(e){var t,n,o={id:19,componentName:"Editor",componentDescription:"Editor for HTML, Python, Q, JSON, etc.",appKey:"Editor",css:"Editor",ghostViewThumb:null,buildViewThumb:null,appArgs:{websiteUrl:e.websiteUrl,json:{version:"4.4.0S2",Basic:{Language:"json",Value:"",DebounceUpdate:200,Theme:"Dark",FormatOnChange:!0,ShowToolbar:!1},Configuration:{Minimap:!0,LineNumbers:!0,ReadOnly:!1}},schema:{type:"object",title:"Properties",properties:{Basic:{type:"object",title:"Basic",options:{collapsed:!1},propertyOrder:200,properties:{Language:{type:"string",title:"Language",default:"json",enum:fe},Value:{type:"viewstate",title:"Value",default:""},DebounceUpdate:{type:"number",min:0,max:1e3,title:"Debounce Update (ms)",default:200},FormatOnChange:{type:"boolean",title:"Format On Value Change",format:"checkbox",default:!0},ShowToolbar:{type:"boolean",title:"Show Toolbar",format:"checkbox",default:!1},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Dark","Light"]},DashboardTheme:{options:{hidden:!0}}}},Configuration:{type:"object",title:"Editor Configuration",options:{collapsed:!1},propertyOrder:200,properties:{Minimap:{type:"boolean",title:"Show Minimap",format:"checkbox",default:!0},LineNumbers:{type:"boolean",title:"Show Line Numbers",format:"checkbox",default:!0},ReadOnly:{type:"boolean",title:"Read Only",format:"checkbox",default:!1},Theme:{type:"string",title:"Theme",options:{hidden:!0},enum:["Dark","Light"]},DashboardTheme:{options:{hidden:!0}}}}}}}};if(0<_.keys(e.settingsModel.attributes).length)for(n=me.upgrades.indexOf(_.find(me.upgrades,{version:e.settingsModel.get("version")}))+1;n<me.upgrades.length;n+=1)(t=me.upgrades[n]).fn(e.settingsModel,e),e.settingsModel.set("version",t.version);return o},me);function me(){}ce.upgrades=[{version:"4.4.0S2",fn:function(e){e.set("Style",{advanced:"",cssClasses:""})}}];var pe=(he.app=t.template({compiler:[7,">= 4.0.0"],main:function(e,t,n,o,r){return'<div class="editor-toolbar ui-widget-header"></div>\n<div class="editor-container"></div>'},useData:!0}),he);function he(){}var ge,be,ye=(ge=n.View,r(ke,ge),ke.prototype.toggleToolbar=function(e){this.$el.toggle(e)},ke);function ke(e){var r=ge.call(this,e)||this;return r.buttons={},de.forEach(function(e){var t=e.id,n=e.text,o=e.action,e=e.icon,n=$('<button id="'+t+'" class="editor-btn">\n                    <i class="'+e+'" style="opacity: .8;padding-right: 2px;"></i>\n                    <span>'+n+"</span>\n                </button>").button();r.$el.append(n),r.buttons[t]=r.$el.find("button#"+t),r.buttons[t].click(function(){r.trigger("action",o)})}),r}function ve(e){var t=be.call(this,e)||this;return t.debounceUpdate=_.debounce(function(){return t.updateViewstate()},200),t.api=e.api,t.theme=e.dashboardViewModel.get("DashboardTheme"),t.$el.html(pe.app({})),t.$el.addClass("editor-app"),t.viewModel=new n.DeepModel({}),t.toolbar=new ye({el:t.$el.find(".editor-toolbar")[0]}),t.listenTo(t.toolbar,"action",function(e){t.editor&&t.editor.getAction(e).run()}),t.listenToOnce(t.viewModel,"change",function(){return t.onReady()}),t.listenTo(t.viewModel,"change:Basic.ShowToolbar",function(){return t.toolbar.toggleToolbar(t.viewModel.get("Basic.ShowToolbar"))}),t.listenTo(t.viewModel,"change:Basic.Language",function(){return t.onLanguageChange()}),t}return d.editor.defineTheme("q-dark",{base:"vs-dark",inherit:!0,rules:[{token:"default",background:"#161616",foreground:"#aaaaaa"},{token:"number",background:"#ce3595",foreground:"#ce3595"},{token:"keyword",background:"#161616",foreground:"#bd9c39"},{token:"string",background:"#161616",foreground:"#78abd2"},{token:"variable",background:"#161616",foreground:"#bdbdbd"},{token:"symbol",background:"#161616",foreground:"#8e7bbb"}],colors:{"editor.background":"#161616","editorLineNumber.foreground":"#8d8d8d"}}),d.editor.defineTheme("q-light",{base:"vs",inherit:!0,rules:[{token:"default",background:"#ffffff",foreground:"#09026f"},{token:"number",background:"#ffffff",foreground:"#0000ef"},{token:"keyword",background:"#ffffff",foreground:"#996900"},{token:"comment",background:"#ffffff",foreground:"#109900"},{token:"string",background:"#ffffff",foreground:"#006b99"},{token:"variable",background:"#ffffff",foreground:"#09026f"},{token:"symbol",background:"#ffffff",foreground:"#845df4"}],colors:{"editor.background":"#ffffff","editorLineNumber.foreground":"#09026f"}}),be=n.View,r(ve,be),ve.prototype.remove=function(){return this.disposable&&this.disposable.dispose(),this},ve.prototype.onSettingsChange=function(e){this.viewModel.set(e)},ve.prototype.setTheme=function(e){this.theme=e,this.editor&&d.editor.setTheme(this.getTheme())},ve.prototype.executeAction=function(e){this.editor&&this.editor.getAction(e).run()},ve.prototype.setValue=function(e){this.viewModel.set("Basic.Value",e)},ve.prototype.getValue=function(){return this.editor?this.editor.getValue():""},ve.prototype.getTheme=function(){return"q"!==this.viewModel.get("Basic").Language?"Light"!==this.theme?"vs-dark":"vs":"Light"!==this.theme?"q-dark":"q-light"},ve.prototype.onLanguageChange=function(){var e,t=this.viewModel.get("Basic").Language;this.editor&&(d.editor.setTheme(this.getTheme()),"q"!==t?(e=this.editor.getModel())&&(d.editor.setModelLanguage(e,t),this.formatDocument()):this.onLanguageChangeToQ())},ve.prototype.onLanguageChangeToQ=function(){var i=this;d.languages.register({id:"q"}),d.editor.defineTheme("q-theme",{base:"vs-dark",colors:{"editor.background":"#161616","editorLineNumber.foreground":"#8d8d8d"},inherit:!0,rules:[{background:"#161616",foreground:"#aaaaaa"},{token:"number",background:"#ce3595",foreground:"#ce3595"},{token:"keyword",background:"#161616",foreground:"#bd9c39"},{token:"string",background:"#161616",foreground:"#78abd2"},{token:"variable",background:"#161616",foreground:"#bdbdbd"},{token:"symbol",background:"#161616",foreground:"#8e7bbb"}]}),d.editor.defineTheme("q-theme-light",{base:"vs",colors:{"editor.background":"#ffffff","editorLineNumber.foreground":"#09026f"},inherit:!0,rules:[{background:"#ffffff",foreground:"#09026f"},{token:"number",background:"#ffffff",foreground:"#0000ef"},{token:"keyword",background:"#ffffff",foreground:"#996900"},{token:"comment",background:"#ffffff",foreground:"#109900"},{token:"string",background:"#ffffff",foreground:"#006b99"},{token:"variable",background:"#ffffff",foreground:"#09026f"},{token:"symbol",background:"#ffffff",foreground:"#845df4"}]}),d.languages.setTokensProvider("q",{getInitialState:function(){return K.startState()},tokenize:function(e,t){for(var n=new l(e),o=[];!n.eol();){var r=K.token(n,t);o.push({scopes:i.getScopeFromStyle(r),startIndex:n.start}),n.start=n.pos}return{endState:t,tokens:o}}}),d.languages.setLanguageConfiguration("q",{brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[],indentationRules:{decreaseIndentPattern:void 0,increaseIndentPattern:/[{(\[]/},onEnterRules:[{action:{indentAction:3},beforeText:/^[^\[]*[})\]]/}]}),this.fetchAutoCompleteItems();var e=this.editor.getModel();e&&d.editor.setModelLanguage(e,"q")},ve.prototype.fetchAutoCompleteItems=function(){var t=this;this.disposable||$.ajax("../modules/vendor/types/q.json").then(function(e){var u=e.autocompleteItems.map(function(e){return i(i({},e),{insertText:"."===e.label[0]?e.label.substring(1):e})});t.disposable=d.languages.registerCompletionItemProvider("q",{provideCompletionItems:function(e,t,n,o){if(t.column<=1)return{suggestions:[]};try{var r=e.getLineContent(t.lineNumber).substring(0,t.column),i=r.lastIndexOf(" "),a=r.substring(i).trim(),s=new RegExp(_.escapeRegExp(r.substring(i).trim()));return{suggestions:u.filter(function(e){return 1<t.column&&e.label.match(s)}).map(function(e){return{label:e.label,detail:e.detail,insertText:e.insertText,kind:d.languages.CompletionItemKind.Function,range:{startLineNumber:t.lineNumber,startColumn:t.column-a.length,endLineNumber:t.lineNumber,endColumn:t.column+e.insertText.length-a.length}}})}}catch(e){return{suggestions:[]}}}})})},ve.prototype.getScopeFromStyle=function(e){switch(e){case null:return"default";case"error-multilineComment":return"comment.block";case"symbol":return"symbol";case"error-unindentedToken":return"invalid";default:return e}},ve.prototype.viewModelToOptions=function(){var e=this.viewModel.get("Configuration"),t=e.Minimap;return{lineNumbers:e.LineNumbers?"on":"off",minimap:{enabled:t},readOnly:e.ReadOnly}},ve.prototype.onReady=function(){var t=this;this.initializeMonaco(),this.listenTo(this.viewModel,"change:Basic.Value",function(){var e=t.viewModel.get("Basic").Value;t.editor.setValue(e),t.formatDocument()}),this.listenTo(this.viewModel,"change:Basic.DebounceUpdate",function(){t.debounceUpdate=_.debounce(function(){return t.updateViewstate()},t.viewModel.get("Basic.DebounceUpdate")),t.editorListener.dispose(),t.editorListener=t.editor.onDidChangeModelContent(t.debounceUpdate)}),this.listenTo(this.viewModel,"change:Configuration",function(){t.editor.updateOptions(t.viewModelToOptions())})},ve.prototype.initializeMonaco=function(){var e=this.viewModel.get("Basic"),t=e.Language,e=e.Value;this.editor=d.editor.create(this.$el.find(".editor-container")[0],Object.assign(le,{language:t,theme:this.getTheme(),value:e},this.viewModelToOptions())),this.formatDocument(),"q"===t&&this.onLanguageChangeToQ(),this.editorListener=this.editor.onDidChangeModelContent(this.debounceUpdate)},ve.prototype.formatDocument=function(){var e=this;this.viewModel.get("Basic.FormatOnChange")&&setTimeout(function(){return e.editor.getAction("editor.action.formatDocument").run()},500)},ve.prototype.updateViewstate=function(){var e=this.editor.getValue();e!==this.viewModel.get("Basic.Value")&&(this.viewModel.set("Basic.Value",e,{silent:!0}),this.api.setProperty("Basic.Value",e))},ve.getComponentDefinition=ce.getComponentDefinition,ve});