define(["backbone","Handlebars","dashMoment","css!./css/app.css"],function(m,s,y){var n,i,o,l,p,r,a,u,f,e,c,d,h,g,v,b,w,S,C=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),T=this&&this.__assign||function(){return(T=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var o in e=arguments[i])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},D=function(){var t;function y(t,e,i){null!=t&&("number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromBytes(t):this.fromString(t,e))}function v(){return new y(null)}t="Microsoft Internet Explorer"==navigator.appName?(y.prototype.am=function(t,e,i,n,o,r){for(var s=32767&e,a=e>>15;0<=--r;){var l=32767&this[t],u=this[t++]>>15,c=a*l+u*s;o=((l=s*l+((32767&c)<<15)+i[n]+(1073741823&o))>>>30)+(c>>>15)+a*u+(o>>>30),i[n++]=1073741823&l}return o},30):"Netscape"!=navigator.appName?(y.prototype.am=function(t,e,i,n,o,r){for(;0<=--r;){var s=e*this[t++]+i[n]+o;o=Math.floor(s/67108864),i[n++]=67108863&s}return o},26):(y.prototype.am=function(t,e,i,n,o,r){for(var s=16383&e,a=e>>14;0<=--r;){var l=16383&this[t],u=this[t++]>>14,c=a*l+u*s;o=((l=s*l+((16383&c)<<14)+i[n]+o)>>28)+(c>>14)+a*u,i[n++]=268435455&l}return o},28),y.prototype.DB=t,y.prototype.DM=(1<<t)-1,y.prototype.DV=1<<t;y.prototype.FV=Math.pow(2,52),y.prototype.F1=52-t,y.prototype.F2=2*t-52;for(var e="0123456789abcdefghijklmnopqrstuvwxyz",i=new Array,n="0".charCodeAt(0),o=0;o<=9;++o)i[n++]=o;for(n="a".charCodeAt(0),o=10;o<36;++o)i[n++]=o;for(n="A".charCodeAt(0),o=10;o<36;++o)i[n++]=o;function l(t){return e.charAt(t)}function u(t,e){e=i[t.charCodeAt(e)];return null==e?-1:e}function m(t){var e=v();return e.fromInt(t),e}function b(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}function w(t){this.m=t}function S(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function r(t,e){return t&e}function s(t,e){return t|e}function a(t,e){return t^e}function c(t,e){return t&~e}function p(){}function d(t){return t}function _(t){this.r2=v(),this.q3=v(),y.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}w.prototype.convert=function(t){return t.s<0||0<=t.compareTo(this.m)?t.mod(this.m):t},w.prototype.revert=function(t){return t},w.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},w.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i),this.reduce(i)},w.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},S.prototype.convert=function(t){var e=v();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&0<e.compareTo(y.ZERO)&&this.m.subTo(e,e),e},S.prototype.revert=function(t){var e=v();return t.copyTo(e),this.reduce(e),e},S.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],n=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[i=e+this.m.t]+=this.m.am(0,n,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),0<=t.compareTo(this.m)&&t.subTo(this.m,t)},S.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i),this.reduce(i)},S.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},y.prototype.copyTo=function(t){for(var e=this.t-1;0<=e;--e)t[e]=this[e];t.t=this.t,t.s=this.s},y.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,0<t?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},y.prototype.fromString=function(t,e){var i;if(16==e)i=4;else if(8==e)i=3;else if(256==e)i=8;else if(2==e)i=1;else if(32==e)i=5;else{if(4!=e)return void this.fromRadix(t,e);i=2}this.t=0,this.s=0;for(var n=t.length,o=!1,r=0;0<=--n;){var s=8==i?255&t[n]:u(t,n);s<0?"-"==t.charAt(n)&&(o=!0):(o=!1,0==r?this[this.t++]=s:r+i>this.DB?(this[this.t-1]|=(s&(1<<this.DB-r)-1)<<r,this[this.t++]=s>>this.DB-r):this[this.t-1]|=s<<r,(r+=i)>=this.DB&&(r-=this.DB))}8==i&&0!=(128&t[0])&&(this.s=-1,0<r&&(this[this.t-1]|=(1<<this.DB-r)-1<<r)),this.clamp(),o&&y.ZERO.subTo(this,this)},y.prototype.fromBytes=function(t){this.t=0;for(var e=-1,i=this.s=0;++e<t.length;){var n=255&t[e];0==i?this[this.t++]=n:i+8>this.DB?(this[this.t-1]|=(n&(1<<this.DB-i)-1)<<i,this[this.t++]=n>>this.DB-i):this[this.t-1]|=n<<i,(i+=8)>=this.DB&&(i-=this.DB)}0!=(128&t[t.length-1])&&(this.s=-1,0<i&&(this[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp()},y.prototype.clamp=function(){for(var t=this.s&this.DM;0<this.t&&this[this.t-1]==t;)--this.t},y.prototype.dlShiftTo=function(t,e){for(var i=this.t-1;0<=i;--i)e[i+t]=this[i];for(i=t-1;0<=i;--i)e[i]=0;e.t=this.t+t,e.s=this.s},y.prototype.drShiftTo=function(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s},y.prototype.lShiftTo=function(t,e){for(var i=t%this.DB,n=this.DB-i,o=(1<<n)-1,r=Math.floor(t/this.DB),s=this.s<<i&this.DM,a=this.t-1;0<=a;--a)e[a+r+1]=this[a]>>n|s,s=(this[a]&o)<<i;for(a=r-1;0<=a;--a)e[a]=0;e[r]=s,e.t=this.t+r+1,e.s=this.s,e.clamp()},y.prototype.rShiftTo=function(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)e.t=0;else{var n=t%this.DB,o=this.DB-n,r=(1<<n)-1;e[0]=this[i]>>n;for(var s=i+1;s<this.t;++s)e[s-i-1]|=(this[s]&r)<<o,e[s-i]=this[s]>>n;0<n&&(e[this.t-i-1]|=(this.s&r)<<o),e.t=this.t-i,e.clamp()}},y.prototype.subTo=function(t,e){for(var i=0,n=0,o=Math.min(t.t,this.t);i<o;)n+=this[i]-t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n-=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n-=t[i],e[i++]=n&this.DM,n>>=this.DB;n-=t.s}e.s=n<0?-1:0,n<-1?e[i++]=this.DV+n:0<n&&(e[i++]=n),e.t=i,e.clamp()},y.prototype.multiplyTo=function(t,e){var i=this.abs(),n=t.abs(),o=i.t;for(e.t=o+n.t;0<=--o;)e[o]=0;for(o=0;o<n.t;++o)e[o+i.t]=i.am(0,n[o],e,o,0,i.t);e.s=0,e.clamp(),this.s!=t.s&&y.ZERO.subTo(e,e)},y.prototype.squareTo=function(t){for(var e=this.abs(),i=t.t=2*e.t;0<=--i;)t[i]=0;for(i=0;i<e.t-1;++i){var n=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,n,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}0<t.t&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()},y.prototype.divRemTo=function(t,e,i){var n=t.abs();if(!(n.t<=0)){var o=this.abs();if(o.t<n.t)return null!=e&&e.fromInt(0),void(null!=i&&this.copyTo(i));null==i&&(i=v());var r=v(),s=this.s,a=t.s,t=this.DB-b(n[n.t-1]);0<t?(n.lShiftTo(t,r),o.lShiftTo(t,i)):(n.copyTo(r),o.copyTo(i));var l=r.t,u=r[l-1];if(0!=u){var o=u*(1<<this.F1)+(1<l?r[l-2]>>this.F2:0),c=this.FV/o,p=(1<<this.F1)/o,d=1<<this.F2,h=i.t,g=h-l,f=null==e?v():e;for(r.dlShiftTo(g,f),0<=i.compareTo(f)&&(i[i.t++]=1,i.subTo(f,i)),y.ONE.dlShiftTo(l,f),f.subTo(r,r);r.t<l;)r[r.t++]=0;for(;0<=--g;){var m=i[--h]==u?this.DM:Math.floor(i[h]*c+(i[h-1]+d)*p);if((i[h]+=r.am(0,m,i,g,0,l))<m)for(r.dlShiftTo(g,f),i.subTo(f,i);i[h]<--m;)i.subTo(f,i)}null!=e&&(i.drShiftTo(l,e),s!=a&&y.ZERO.subTo(e,e)),i.t=l,i.clamp(),0<t&&i.rShiftTo(t,i),s<0&&y.ZERO.subTo(i,i)}}},y.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return 0<(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)?this.DV-e:-e},y.prototype.isEven=function(){return 0==(0<this.t?1&this[0]:this.s)},y.prototype.exp=function(t,e){if(4294967295<t||t<1)return y.ONE;var i,n=v(),o=v(),r=e.convert(this),s=b(t)-1;for(r.copyTo(n);0<=--s;)e.sqrTo(n,o),0<(t&1<<s)?e.mulTo(o,r,n):(i=n,n=o,o=i);return e.revert(n)},y.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i,n=(1<<e)-1,o=!1,r="",s=this.t,a=this.DB-s*this.DB%e;if(0<s--)for(a<this.DB&&0<(i=this[s]>>a)&&(o=!0,r=l(i));0<=s;)a<e?(i=(this[s]&(1<<a)-1)<<e-a,i|=this[--s]>>(a+=this.DB-e)):(i=this[s]>>(a-=e)&n,a<=0&&(a+=this.DB,--s)),(o=0<i?!0:o)&&(r+=l(i));return o?r:"0"},y.prototype.negate=function(){var t=v();return y.ZERO.subTo(this,t),t},y.prototype.abs=function(){return this.s<0?this.negate():this},y.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t;if(0!=(e=i-t.t))return this.s<0?-e:e;for(;0<=--i;)if(0!=(e=this[i]-t[i]))return e;return 0},y.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+b(this[this.t-1]^this.s&this.DM)},y.prototype.mod=function(t){var e=v();return this.abs().divRemTo(t,null,e),this.s<0&&0<e.compareTo(y.ZERO)&&t.subTo(e,e),e},y.prototype.modPowInt=function(t,e){return e=new(t<256||e.isEven()?w:S)(e),this.exp(t,e)},y.ZERO=m(0),y.ONE=m(1),p.prototype.convert=d,p.prototype.revert=d,p.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i)},p.prototype.sqrTo=function(t,e){t.squareTo(e)},_.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=v();return t.copyTo(e),this.reduce(e),e},_.prototype.revert=function(t){return t},_.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);0<=t.compareTo(this.m);)t.subTo(this.m,t)},_.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i),this.reduce(i)},_.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)};var h=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],g=(1<<26)/h[h.length-1];return y.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},y.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||t<2||36<t)return"0";var e=this.chunkSize(t),i=Math.pow(t,e),n=m(i),o=v(),r=v(),s="";for(this.divRemTo(n,o,r);0<o.signum();)s=(i+r.intValue()).toString(t).substr(1)+s,o.divRemTo(n,o,r);return r.intValue().toString(t)+s},y.prototype.fromRadix=function(t,e){this.fromInt(0);for(var i=this.chunkSize(e=null==e?10:e),n=Math.pow(e,i),o=!1,r=0,s=0,a=0;a<t.length;++a){var l=u(t,a);l<0?"-"==t.charAt(a)&&0==this.signum()&&(o=!0):(s=e*s+l,++r>=i&&(this.dMultiply(n),this.dAddOffset(s,0),s=r=0))}0<r&&(this.dMultiply(Math.pow(e,r)),this.dAddOffset(s,0)),o&&y.ZERO.subTo(this,this)},y.prototype.fromNumber=function(t,e,i){if("number"==typeof e)if(t<2)this.fromInt(1);else for(this.fromNumber(t,i),this.testBit(t-1)||this.bitwiseTo(y.ONE.shiftLeft(t-1),s,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(y.ONE.shiftLeft(t-1),this);else{var n=new Array,i=7&t;n.length=1+(t>>3),e.nextBytes(n),0<i?n[0]&=(1<<i)-1:n[0]=0,this.fromString(n,256)}},y.prototype.bitwiseTo=function(t,e,i){for(var n,o=Math.min(t.t,this.t),r=0;r<o;++r)i[r]=e(this[r],t[r]);if(t.t<this.t){for(n=t.s&this.DM,r=o;r<this.t;++r)i[r]=e(this[r],n);i.t=this.t}else{for(n=this.s&this.DM,r=o;r<t.t;++r)i[r]=e(n,t[r]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()},y.prototype.changeBit=function(t,e){return t=y.ONE.shiftLeft(t),this.bitwiseTo(t,e,t),t},y.prototype.addTo=function(t,e){for(var i=0,n=0,o=Math.min(t.t,this.t);i<o;)n+=this[i]+t[i],e[i++]=n&this.DM,n>>=this.DB;if(t.t<this.t){for(n+=t.s;i<this.t;)n+=this[i],e[i++]=n&this.DM,n>>=this.DB;n+=this.s}else{for(n+=this.s;i<t.t;)n+=t[i],e[i++]=n&this.DM,n>>=this.DB;n+=t.s}e.s=n<0?-1:0,0<n?e[i++]=n:n<-1&&(e[i++]=this.DV+n),e.t=i,e.clamp()},y.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},y.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},y.prototype.multiplyLowerTo=function(t,e,i){var n,o=Math.min(this.t+t.t,e);for(i.s=0,i.t=o;0<o;)i[--o]=0;for(n=i.t-this.t;o<n;++o)i[o+this.t]=this.am(0,t[o],i,o,0,this.t);for(n=Math.min(t.t,e);o<n;++o)this.am(0,t[o],i,o,0,e-o);i.clamp()},y.prototype.multiplyUpperTo=function(t,e,i){var n=i.t=this.t+t.t- --e;for(i.s=0;0<=--n;)i[n]=0;for(n=Math.max(e-this.t,0);n<t.t;++n)i[this.t+n-e]=this.am(e-n,t[n],i,0,0,this.t+n-e);i.clamp(),i.drShiftTo(1,i)},y.prototype.modInt=function(t){if(t<=0)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(0<this.t)if(0==e)i=this[0]%t;else for(var n=this.t-1;0<=n;--n)i=(e*i+this[n])%t;return i},y.prototype.millerRabin=function(t){var e=this.subtract(y.ONE),i=e.getLowestSetBit();if(i<=0)return!1;var n=e.shiftRight(i);h.length<(t=t+1>>1)&&(t=h.length);for(var o=v(),r=0;r<t;++r){o.fromInt(h[Math.floor(Math.random()*h.length)]);var s=o.modPow(n,this);if(0!=s.compareTo(y.ONE)&&0!=s.compareTo(e)){for(var a=1;a++<i&&0!=s.compareTo(e);)if(0==(s=s.modPowInt(2,this)).compareTo(y.ONE))return!1;if(0!=s.compareTo(e))return!1}}return!0},y.prototype.clone=function(){var t=v();return this.copyTo(t),t},y.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},y.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},y.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},y.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},y.prototype.toByteArray=function(){var t=this.t,e=new Array;e[0]=this.s;var i,n=this.DB-t*this.DB%8,o=0;if(0<t--)for(n<this.DB&&(i=this[t]>>n)!=(this.s&this.DM)>>n&&(e[o++]=i|this.s<<this.DB-n);0<=t;)n<8?(i=(this[t]&(1<<n)-1)<<8-n,i|=this[--t]>>(n+=this.DB-8)):(i=this[t]>>(n-=8)&255,n<=0&&(n+=this.DB,--t)),0!=(128&i)&&(i|=-256),0==o&&(128&this.s)!=(128&i)&&++o,(0<o||i!=this.s)&&(e[o++]=i);return e},y.prototype.equals=function(t){return 0==this.compareTo(t)},y.prototype.min=function(t){return this.compareTo(t)<0?this:t},y.prototype.max=function(t){return 0<this.compareTo(t)?this:t},y.prototype.and=function(t){var e=v();return this.bitwiseTo(t,r,e),e},y.prototype.or=function(t){var e=v();return this.bitwiseTo(t,s,e),e},y.prototype.xor=function(t){var e=v();return this.bitwiseTo(t,a,e),e},y.prototype.andNot=function(t){var e=v();return this.bitwiseTo(t,c,e),e},y.prototype.not=function(){for(var t=v(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t},y.prototype.shiftLeft=function(t){var e=v();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},y.prototype.shiftRight=function(t){var e=v();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},y.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+function(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}(this[t]);return this.s<0?this.t*this.DB:-1},y.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=function(t){for(var e=0;0!=t;)t&=t-1,++e;return e}(this[i]^e);return t},y.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)},y.prototype.setBit=function(t){return this.changeBit(t,s)},y.prototype.clearBit=function(t){return this.changeBit(t,c)},y.prototype.flipBit=function(t){return this.changeBit(t,a)},y.prototype.add=function(t){var e=v();return this.addTo(t,e),e},y.prototype.subtract=function(t){var e=v();return this.subTo(t,e),e},y.prototype.multiply=function(t){var e=v();return this.multiplyTo(t,e),e},y.prototype.divide=function(t){var e=v();return this.divRemTo(t,e,null),e},y.prototype.remainder=function(t){var e=v();return this.divRemTo(t,null,e),e},y.prototype.divideAndRemainder=function(t){var e=v(),i=v();return this.divRemTo(t,e,i),new Array(e,i)},y.prototype.modPow=function(t,e){var i=t.bitLength(),n=m(1);if(i<=0)return n;var o=i<18?1:i<48?3:i<144?4:i<768?5:6,r=new(i<8?w:e.isEven()?_:S)(e),s=new Array,a=3,l=o-1,u=(1<<o)-1;if(s[1]=r.convert(this),1<o){var c=v();for(r.sqrTo(s[1],c);a<=u;)s[a]=v(),r.mulTo(c,s[a-2],s[a]),a+=2}for(var p,d,h=t.t-1,g=!0,f=v(),i=b(t[h])-1;0<=h;){for(l<=i?p=t[h]>>i-l&u:(p=(t[h]&(1<<i+1)-1)<<l-i,0<h&&(p|=t[h-1]>>this.DB+i-l)),a=o;0==(1&p);)p>>=1,--a;if((i-=a)<0&&(i+=this.DB,--h),g)s[p].copyTo(n),g=!1;else{for(;1<a;)r.sqrTo(n,f),r.sqrTo(f,n),a-=2;0<a?r.sqrTo(n,f):(d=n,n=f,f=d),r.mulTo(f,s[p],n)}for(;0<=h&&0==(t[h]&1<<i);)r.sqrTo(n,f),d=n,n=f,f=d,--i<0&&(i=this.DB-1,--h)}return r.revert(n)},y.prototype.modInverse=function(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return y.ZERO;for(var i=t.clone(),n=this.clone(),o=m(1),r=m(0),s=m(0),a=m(1);0!=i.signum();){for(;i.isEven();)i.rShiftTo(1,i),e?(o.isEven()&&r.isEven()||(o.addTo(this,o),r.subTo(t,r)),o.rShiftTo(1,o)):r.isEven()||r.subTo(t,r),r.rShiftTo(1,r);for(;n.isEven();)n.rShiftTo(1,n),e?(s.isEven()&&a.isEven()||(s.addTo(this,s),a.subTo(t,a)),s.rShiftTo(1,s)):a.isEven()||a.subTo(t,a),a.rShiftTo(1,a);0<=i.compareTo(n)?(i.subTo(n,i),e&&o.subTo(s,o),r.subTo(a,r)):(n.subTo(i,n),e&&s.subTo(o,s),a.subTo(r,a))}return 0!=n.compareTo(y.ONE)?y.ZERO:0<=a.compareTo(t)?a.subtract(t):a.signum()<0?(a.addTo(t,a),a.signum()<0?a.add(t):a):a},y.prototype.pow=function(t){return this.exp(t,new p)},y.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone();e.compareTo(i)<0&&(o=e,e=i,i=o);var n=e.getLowestSetBit(),o=i.getLowestSetBit();if(o<0)return e;for(0<(o=n<o?n:o)&&(e.rShiftTo(o,e),i.rShiftTo(o,i));0<e.signum();)0<(n=e.getLowestSetBit())&&e.rShiftTo(n,e),0<(n=i.getLowestSetBit())&&i.rShiftTo(n,i),0<=e.compareTo(i)?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return 0<o&&i.lShiftTo(o,i),i},y.prototype.isProbablePrime=function(t){var e,i=this.abs();if(1==i.t&&i[0]<=h[h.length-1]){for(e=0;e<h.length;++e)if(i[0]==h[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<h.length;){for(var n=h[e],o=e+1;o<h.length&&n<g;)n*=h[o++];for(n=i.modInt(n);e<o;)if(n%h[e++]==0)return!1}return i.millerRabin(t)},y.prototype.square=function(){var t=v();return this.squareTo(t),t},{BigInteger:y}}();function M(){}function E(){}function P(){}function I(){}function k(t){return encodeURIComponent(t)}function A(t,e){t=function(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(r," "))}catch(t){}}(t);return p.isFunction(e)?e(t):t}function x(){}function N(){}function L(){return null!==e&&e.apply(this,arguments)||this}function V(){}function B(t){var e=c.call(this,t)||this;return e.cssClass=t.cssClass,e.anchorEl=t.anchorEl,e.data=t.data||{},e.text=t.text,e.position=t.position,e.$el.addClass("generic-tooltip "+e.cssClass),e.$el.appendTo("#appdiv"),e.compileTemplate(),e}function O(){}function R(t,e,i,n){return w.call(this,t,e,i,n,8)||this}function U(t,e,i,n){this.length=t,this.keys=e,this.values=i,this.qtype=n||S.TypeNum.Dict}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(i[r]=o[r])}return i},writable:!0,configurable:!0}),b=zt=zt||{},M.binarySearch=function(t,e,i,n){i=M.getComparator(n,i);return M.binarySearch2(t,e,i)},M.binarySearch2=function(t,e,i){for(var n,o,r=0,s=e.length-1;r<=s;)if(0<(n=i(t,e[o=s+r>>1])))r=1+o;else{if(!(n<0))return o;s=o-1}return-r-1},M.calcDialogHeight=function(t,e){e="FSBL"in window?window.finApi.getDialogHeightOffset(e):40;return window.innerHeight<t+e?window.innerHeight-e:t},M.calculateFontContrast=function(t){var e="",i=0===t.indexOf("#"),n=0===t.indexOf("rgb")||0===t.indexOf("rgba");return!t||!i&&!n||(t=i?M.hex2RGB(t):M.rgbStr2Array(t)).length&&(e=125<Math.round((299*parseInt(String(t[0]))+587*parseInt(String(t[1]))+114*parseInt(String(t[2])))/1e3)?i?M.getDefaultThemeColors("Dark")[0]:"rgb(40,40,40)":i?M.getDefaultThemeColors("Light")[0]:"rgb(15,15,15)"),e},M.clickEvent=function(t){var e=this.hasTouch();return t?e?"touchend mouseup":"click":e?"touchstart click":"click"},M.convertDateStringValueToMoment=function(t,e){return y.tz(t,e||"UTC")},M.convertISODatetimeToKDBLikeObject=function(t){var e=this.TIME_RX.exec(t),e=_.filter(e,function(t){return void 0!==t});return!e||e.length<2?t:M.convertValueToMoment(t).toKdbObject()},M.convertKDBTemporalToMoment=function(t){var e,i=!1;if(t&&_.isNumber(t.i)&&_.includes(M.Types.kdbTemporals,t.class)){switch(t.class){case"1212":(e=y.tz(t.i,"UTC")).nanoseconds(t.n%1e6),i=!0;break;case"1213":(e=y.tz("2000-01-01","UTC")).add(t.i,"month");break;case"1214":e=y.tz(t.toString(),"UTC");break;case"1216":(e=y.duration(0<t.i?Math.floor(t.i/1e6):Math.ceil(t.i/1e6))).nanoseconds(t.i%1e6);break;case"1217":e=y.duration(60*t.i*1e3);break;case"1218":e=y.duration(1e3*t.i);break;case"1219":e=y.duration(t.i);break;default:e=y.tz(t.i,"UTC"),i=!0}e.kdbType(t.class)}else e=y.tz(t,"UTC");return i&&this.timezone&&e.isValid()&&e.tz(this.timezone),e},M.convertKDBToViewstateValue=function(t){var e=t;return e=_.hasIn(t,"class")?"1222"===t.class?t.toString():M.convertKDBTemporalToMoment(t).toDashString():e},M.convertMomentToDatePicker=function(t,e){return t=M.convertValueToMoment(t),e?t.tz("UTC"):this.timezone&&t.isValid()&&!y.isDuration(t)&&t.tz(this.timezone),e=new Date(t.year(),t.month(),t.date(),t.hour(),t.minute(),t.second(),t.millisecond()),(t=t.nanoseconds())&&!_.isNaN(t)&&(e.nanoseconds=t),e},M.convertTypeToKdbType=function(t,e){return t?_.includes(M.Types.kdbTemporals,t)?t:_.includes(M.Types.kdbTemporals,M.Types.dashboardToKdb[t])?M.Types.dashboardToKdb[t]:null:M.inferKdbTypeFromDashString(e)},M.convertUserInputToMoment=function(t,e,i){return _.isString(t)?(t=t.replace(/(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3"),i=i?y.tz(t,e,"UTC"):this.timezone?y.tz(t,e,this.timezone):y(t,e),(e=M.extractNanos(t))&&!_.isNaN(e)&&(i.kdbType("1212"),i.nanoseconds(e)),i):t},M.convertValueToDuration=function(t,e){var i,n,o=M.convertTypeToKdbType(e,t);return _.includes(["1212","1213","1214","1215"],e)?M.convertValueToMoment(t,e):t?(y.isDuration(t)?i=t:_.isString(t)&&(n=(t=t.replace("1970-01-01T","").replace("Z","")).match(/(\d\d:\d\d:\d\d.\d\d\d)(\d\d\d\d\d\d)/))&&n[1]?("1216"===e&&-1!==t.indexOf("D")&&(e=t.substring(0,t.indexOf(":")).split("D"),(e=Number(e[1])+24*Number(e[0]))&&(n[1]=e+n[1].substring(t.indexOf(":")-2))),i=y.duration(n[1]),(n=n[2]?Number(n[2]):0)&&!_.isNaN(n)&&i.nanoseconds(n)):i=y.duration(t),i&&o&&i.kdbType(o),i):y.duration(0)},M.convertValueToMoment=function(t,e,i){var n,o=M.convertTypeToKdbType(e,t),r=0;return _.includes(["1216","1217","1218","1219"],e)?M.convertValueToDuration(t,e):(null==t?(n=y(),i||n.tz(this.timezone)):y.isMoment(t)?n=t:(!_.isString(t)||"1214"!==o&&"1213"!==o?(n=y(t),i||n.tz(this.timezone)):n=y.utc(t),_.isDate(t)?r=t.nanoseconds:_.isString(t)&&(r=M.extractNanos(t)),r&&!_.isNaN(r)&&n.nanoseconds(r)),n&&o&&n.kdbType(o),n)},M.convertStringToMomentFormat=function(t,e){if(t){var i=!1;switch(e){case"1213":t=t.replace("m","");break;case"1212":t=t.split("D")[0].replace(/\./g,"-")+"T"+t.split("D")[1]+"Z",i=!0;break;case"1215":t=t.split("T")[0].replace(/\./g,"-")+"T"+t.split("T")[1]+"Z",i=!0}return M.convertValueToMoment(t,e,i)}},M.createPivotCollectionFunc=function(t){return m.Collection.extend({model:m.Model.extend({idAttribute:t,set:function(t,e){"function"==typeof t.subscribe&&(this.subscribe=t.subscribe),"function"==typeof t.unsubscribe&&(this.unsubscribe=t.unsubscribe),m.Model.prototype.set.call(this,t,e)}})})},M.castToDashString=function(t,e){return e&&t&&t.class&&_.includes(["date","datetime","month","timestamp","minute","time","timespan","second"],e)?t=M.convertKDBTemporalToMoment(t).toDashString():_.isString(t)&&"timespan"===e&&-1<t.indexOf(".000Z")?t=t.replace(".000Z",".000000000Z"):_.isString(t)&&"datetime"===e&&null!==t.match(/[DTZ]/g)&&23<t.length&&(t=t.slice(0,23)+"Z"),t},M.extractNanos=function(t){var e,i=0;return i=t&&(e=(t=_.isFunction(t.toString)?t.toString():t).match(/\d{1,2}:\d{2}:\d{2}\.\d{3}(\d{6})/))?Number(e[1]):i},M.convertDataUrlToBlob=function(t){for(var t=t.split(","),e=atob(t[1]),i=e.length,n=new Uint8Array(i);i--;)n[i]=e.charCodeAt(i);return n},M.fileSave=function(t,e,i){var n,o;i=i||"application/octet-stream",o=document.createElement("a"),window.Blob?(n=new Blob([e],{type:i}),window.navigator.msSaveOrOpenBlob?o.onclick=function(){window.navigator.msSaveOrOpenBlob(n,t)}:void 0!==o.download&&o.setAttribute("href",URL.createObjectURL(n))):o.setAttribute("href",encodeURI(i+","+e)),void 0!==o.download&&o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o)},M.formatNumber=function(t,e){var i=t;return $.isNumeric(t)?(i=(e=this.toFixedNumber(t,e).split("."))[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),2===e.length&&(i+="."+e[1]),i):this.htmlEncode(i)},M.getComparator=function(t,r){switch(t){default:case 1:case 2:case 4:case 5:case 6:case 8:case 9:return function(t,e){e=r(e);return null==t||null==e?null!=t?1:null!=e?-1:0:e<t?1:t<e?-1:0};case 10:case 11:return function(t,e){e=r(e);return null==t||null==e?null!=t?1:null!=e?-1:0:t.localeCompare(e,{caseFirst:"lower"})};case 7:return function(t,e){if(e=r(e),null==t||null==e)return null!=t?1:null!=e?-1:0;var i="-"===t[0],n=i?1-t.length:t.length,o="-"===e[0]?1-e.length:e.length;return n!==o?o<n?1:-1:(i?-1:1)*(e<t?1:t<e?-1:0)};case 12:case 16:return function(t,e){var i=r(e),n=null==t||t===1/0||t===-1/0,e=null==i||i===1/0||i===-1/0;return n&&e?i<t?1:t<i?-1:0:n?t>i.i?1:t<i.i?-1:0:e?t.i>i?1:t.i<i?-1:0:t.i>i.i?1:t.i<i.i?-1:t.n>i.n?1:t.n<i.n?-1:0};case 13:case 14:case 15:case 17:case 18:case 19:return function(t,e){var i=r(e),n=null==t||t===1/0||t===-1/0,e=null==i||i===1/0||i===-1/0;return n&&e?i<t?1:t<i?-1:0:n?t>i.i?1:t<i.i?-1:0:e?t.i>i?1:t.i<i?-1:0:t.i>i.i?1:t.i<i.i?-1:0}}},M.getCookie=function(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return decodeURIComponent(o.substring(e.length,o.length))}return""},M.getDefaultThemeColors=function(t){return"Light"===t?["#ffffff","#f4f4f4","#cecece"]:["#282828","#303030","#505050"]},M.getHash=function(t){t=(t||window).location.href.match(/#(.*)$/);return t?t[1]:""},M.getTimezoneOffset=function(){var t=this.timezone?y.tz(this.timezone):y();return t.utcOffset()},M.getTypeCategory=function(t){var e="";switch(t){case"1212":case"1213":case"1214":case"1215":case"date":case"datetime":case"month":case"timestamp":e="date";break;case"1216":case"1217":case"1218":case"1219":case"minute":case"second":case"time":case"timespan":e="duration"}return e},M.getNumberDecimalPlaces=function(t){var e=0;return e=-1!==t.lastIndexOf(".")?t.substr(t.lastIndexOf(".")+1,t.length).length:e},M.hasDefaultThemeColors=function(t,e,i,n){return!("Light"!==t||"#f0f0f0"!==e||"#e0e0e0"!==i&&i||"#c8c8c8"!==n&&n)||!("Dark"!==t||"#282828"!==e||"#303030"!==i&&i||"#505050"!==n&&n)},M.hasTouch=function(){return $(document).hasClass("touch")},M.hex2RGB=function(t){t=(4<t.length?RegExp(/^\#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/):RegExp(/^\#?([a-f\d])([a-f\d])([a-f\d])$/)).exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:[]},M.hoverFix=function(t){var e=t.parentNode,i=t.nextSibling;e.removeChild(t),setTimeout(function(){e.insertBefore(t,i)},0)},M.htmlEncode=function(t){return t.toString().replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},M.inferKdbTypeFromDashString=function(t){var e;if(!t||!_.isString(t))return null;if(e=t.match(/^(\d\d\d\d-\d\d)?(-\d\d)?(T\d\d:\d\d:\d\d\.\d{3})?(\d{6})?(?:Z)?$/)){if(e[1]&&e[2]&&e[3]&&e[4])return"1970-01-01"===t.substr(0,10)?"1216":"1212";if(e[1]&&e[2]&&e[3])return"1970-01-01"===t.substr(0,10)?"1219":"1215";if(e[1]&&e[2])return"1214";if(e[1])return"1213"}return null},M.isIE=function(){var t=window.navigator.userAgent,e=t.indexOf("MSIE ");if(0<e)return parseInt(t.substring(e+5,t.indexOf(".",e)),10);if(0<t.indexOf("Trident/")){var i=t.indexOf("rv:");return parseInt(t.substring(i+3,t.indexOf(".",i)),10)}i=t.indexOf("Edge/");return 0<i&&parseInt(t.substring(i+5,t.indexOf(".",i)),10)},M.isKDBTemporal=function(t){return t&&t.class&&_.includes(M.Types.kdbTemporals,t.class)||!1},M.objToUri=function(i){return _.reduce(_.keys(i),function(t,e){return e&&t.push(e+"="+i[e]),t},[]).join("&")},M.padLeft=function(t,e){return _.isNull(t)||_.isUndefined(t)?"":(t=t.toString()).length<e?M.padLeft("0"+t,e):t},M.roundToPlaces=function(t,e){e=Math.pow(10,e);return t*=e,(t=Math.round(t))/e},M.round=function(t,e,i){return i===this.Rounding.Normal?M.roundToPlaces(t,e):(e=Math.pow(10,e),i===M.Rounding.Floor?Math.floor(t*e)/e:Math.ceil(t*e)/e)},M.rgb2hex=function(t){var e="";return e=t.length?"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1):e},M.rgbStr2Array=function(t){t=t.match(/rgba?\((\d{1,3}), ?(\d{1,3}), ?(\d{1,3})\)?(?:, ?(\d(?:\.\d?))\))?/);return t?[t[1],t[2],t[3],t[4]]:[]},M.smartFormatNumber=function(t,e,i){var n=Number(t),o="",r=1;return isNaN(n)?"":"string"==typeof t&&(n>Number.MAX_SAFE_INTEGER||n<Number.MIN_SAFE_INTEGER)?this.toFixedNumber(t,e):(t=Math.max(0,void 0===e?2:e),1e18<=(e=Math.abs(n))?(r=1e18,o="E"):1e15<=e?(r=1e15,o="P"):1e12<=e?(r=1e12,o="T"):1e9<=e?(r=1e9,o="B"):1e6<=e?(r=1e6,o="M"):1e3<=e&&(r=1e3,o="k"),r=M.roundToPlaces(n/r,t),(r=i?r.toFixed(t):r)+o)},M.sum=function(t){return _.reduce(t,function(t,e){return t+e},0)},M.toFixedNumber=function(t,e){e=void 0===e?2:e,e=Math.min(20,Math.max(0,e));return"string"!=typeof t||/(^[^-\d]|^[-\d].*[^\d]+|^-$)/.test(t)?"number"==typeof t?t.toFixed(e):this.htmlEncode(t):t+(e?".":"")+_.repeat("0",e)},M.touchDownEvent=function(t){return this.hasTouch()?"touchstart":"mousedown"},M.tapEvent=function(){return this.hasTouch()?"tap":"mousedown"},M.uriToObj=function(t){return _.reduce(t.split("&"),function(t,e){e=e.split("=");return t[e[0]]=e[1],t},{})},M.isIE11=/Trident\/.*rv:11/.test(navigator.userAgent),M.timezone=function(t){for(var e=t+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var o=i[n];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return decodeURIComponent(o.substring(e.length,o.length))}return""}("dashboard-timezone")||y.tz.guess(),M.Formats={Date:["YYYY-MM-DD","DD/MM/YYYY","DD.MM.YYYY","MM/DD/YYYY","D/M/YYYY","M/D/YYYY","D/M/YY","M/D/YY","YYYY-MMM-DD","D MMM","D MMM YYYY","MMM D","MMM D, YYYY","YYYY-MM","MM/YYYY","M/YY","MMM YYYY"],DateTime:["YYYY-MM-DD HH:mm:ss","YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS","YYYY-MM-DD","MM/DD/YYYY","D/M/YYYY","M/D/YYYY","D/M/YY","M/D/YY","YYYY-MMM-DD","D MMM","D MMM YYYY","MMM D","MMM D, YYYY","HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","mm:ss.SSSSSS","mm:ss.SSSSSSSSS","ss","ss.SSS","ss.SSSSSS","ss.SSSSSSSSS"],Time:["HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","ss","ss.SSS"]},M.TIME_RX=/^((\d\d\d\d-\d\d)|(\d\d\d\d-\d\d-\d\d))?((T\d\d:\d\d:\d\d\.\d{3})(\d{6})?)?(?:Z)?$/,M.Rounding={Normal:0,Floor:1,Ceiling:2},M.Types={dashboardToKdb:{timestamp:"1212",month:"1213",date:"1214",datetime:"1215",timespan:"1216",minute:"1217",second:"1218",time:"1219"},kdbTemporals:["1212","1213","1214","1215","1216","1217","1218","1219"],kdbToDashboard:{1212:"timestamp",1213:"month",1214:"date",1215:"datetime",1216:"timespan",1217:"minute",1218:"second",1219:"time"}},b.Tools=M,i=zt=zt||{},E.castDate=function(t){return t instanceof Date?t:t&&t.i?new Date(t.i):new Date(t)},E.convertDateToTimeObject=function(t){return{hour:t.getUTCHours(),minute:t.getUTCMinutes(),second:t.getUTCSeconds(),millisec:t.getUTCMilliseconds()}},E.getByQTypeNum=function(t){return(E.infosByNum=!E.infosByNum?_.map(E.simple,function(t){return E.infos[t]}):E.infosByNum)[t]},E.getByName=function(t){var e=this.infos["double"===t?"float":t];return e||((e=this.infos[t.replace("[]","")])?{char:e.char+"[]",num:-e.num,literal:e.literal,null:"",name:t,editor:_.extend({},e.editor,{type:"List",itemType:e.editor.type,editorClass:e.name+"List"}),toKDBInput:function(t){t=_.values(t);return null!=t&&0<t.length?"("+(1<t.length?"":"enlist ")+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():e.toKDBInput(t)}).join(";")+")":"()"}}:this.infos.symbol)},E.infos={List:{char:void 0,size:void 0,num:0,literal:void 0,null:"",name:"list",editor:"List",toKDBInput:function(t){return t?"("+(_.every(t,function(t){return _.isNull(t)||_.isUndefined(t)||_.isNumber(t)})?_.map(t,function(t){return E.infos.float.toKDBInput(t)}):_.map(t,function(t){return E.infos.char.toKDBInput(t)})).join(";")+")":"()"}},boolean:{char:"b",size:"1",num:1,literal:"0b",null:"",name:"boolean",editor:{type:"Checkbox"},toKDBInput:function(t){return t?"1b":"0b"}},guid:{char:"g",size:"16",num:2,literal:"",null:"0Ng",name:"guid",editor:{type:"Text",editorAttrs:{maxLength:36},validators:[function(t){if(!t.match(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/))return{type:"guid",message:"Invalid, requires: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||""===t?"0Ng":t===-1/0?"0w":t===1/0?"-0w":'"G"$"'+t.toString()+'"'}},byte:{char:"x",size:"1",num:4,literal:"0x00",null:"",name:"byte",editor:{type:"Number",editorAttrs:{min:-128,max:127,step:1},validators:["number",{type:"range",min:-128,max:127},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t||t===-1/0?"0x0":t===1/0?"0xFF":"0x"+Number(t).toString(16)}},short:{char:"h",size:"2",num:5,literal:"0h",null:"0Nh",name:"short",editor:{type:"Number",editorAttrs:{min:-32768,max:32767,step:1},validators:["number",{type:"range",min:-32768,max:32767},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t?"0Nh":t===-1/0?"-0Wh":t===1/0?"0Wh":t+"h"}},int:{char:"i",size:"4",num:6,literal:"0",null:"0N",name:"int",editor:{type:"Number",editorAttrs:{min:-2147483648,max:2147483647,step:1},validators:["number",{type:"range",min:-2147483648,max:2147483647},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t?"0Ni":t===-1/0?"-0Wi":t===1/0?"0Wi":t+"i"}},long:{char:"j",size:"8",num:7,literal:"0j",null:"0Nj",name:"long",editor:{type:"Long",validators:["number",{type:"range",min:-0x8000000000000000,max:0x8000000000000000},function(t){if(t%1!=0)return{type:"whole-number",message:"Must be a whole number"}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t?"0Nj":t===-1/0?"-0W":t===1/0?"0W":t}},real:{char:"e",size:"4",num:8,literal:"0e",null:"0Ne",name:"real",editor:{type:"Number",editorAttrs:{step:"any"},validators:["number"]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t?"0Ne":t===-1/0?"-0We":t===1/0?"0We":t+"e"}},float:{char:"f",size:"8",num:9,literal:"0.0 or 0f",null:"0n",name:"float",editor:{type:"Number",editorAttrs:{step:"any"},validators:["number"]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||isNaN(t)||""===t?"0n":t===-1/0?"-0Wf":t===1/0?"0Wf":t+"f"}},char:{char:"c",size:"1",num:10,literal:'" "',null:'" "',name:"char",editor:{type:"Text",editorAttrs:{maxlength:1}},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)||0===t.length?'" "':'"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):" ")+'"'}},symbol:{char:"s",size:".",num:11,literal:"`",null:"`",name:"symbol",editor:{type:"Text"},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"`":'`$"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'"'}},timestamp:{char:"p",size:"8",num:12,literal:"dateDtimespan",null:"0Np",name:"timestamp",editor:{type:"DateTimePicker",options:{hasNano:!0,isTimestamp:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSSSSSSSS",width:200,bindButton:!1},validators:[function(t){if(t){t=i.Tools.convertUserInputToMoment(t,"YYYY/MM/DD HH:mm:ss.SSS");if(t&&!t.isValid())return{type:"timestamp",message:"Invalid date/time"}}}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"0Np":t===-1/0?"-0Wp":t===1/0?"0Wp":(_.isString(t)&&(t=t.replace("D","T").replace(/^(\d\d\d\d)\.(\d\d).(\d\d)/,"$1-$2-$3"),t=/Z$/.test(t)?t:t+"Z"),t=i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):i.Tools.convertValueToMoment(t),y.isMoment(t)&&t.isValid()?t.utcOffset(0).format("YYYY.MM.DD")+"D"+t.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1}):"0Np")}},month:{char:"m",size:"4",num:13,literal:"2000.01m",null:"0Nm",name:"month",editor:{type:"Month",options:{bindButton:!1}},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"0Nm":t==-1/0?"-0Wm":t===1/0?"0Wm":(t=i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):y.tz(t,"Y.MM","UTC"),y.isMoment(t)&&t.isValid()?t.utcOffset(0).format("YYYY.MM")+"m":"0Nm")}},date:{char:"d",size:"4",num:14,literal:"2000.01.01",null:"0Nd",name:"date",editor:{type:"DatePicker",options:{dateFormat:"yy-mm-dd",width:75,bindButton:!0},validators:[function(t){if(t){var e=i.Tools.convertUserInputToMoment(t,"YYYY/MM/DD");if(e&&!e.isValid())return{type:"date",message:"Invalid date"}}return!E.REGEX_DATEPICKER.test(t.substr(0,10))}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"0Nd":t==-1/0?"-0Wd":t==1/0?"0Wd":(_.isString(t)&&(t=t.replace(/^(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3")),t=i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):y.tz(t,"UTC"),y.isMoment(t)&&t.isValid()?t.utcOffset(0).format("YYYY.MM.DD"):"0Nd")}},datetime:{char:"z",size:"8",num:15,literal:"dateTtime",null:"0Nz",name:"datetime",editor:{type:"DateTimePicker",options:{dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSS",width:155,bindButton:!0},validators:[function(t){return _.isFunction(t.toISOString)&&(t=t.toISOString()),!E.REGEX_TIMEPICKER.test(t)}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"0Nz":t==-1/0?"-0Wz":t==1/0?"0Wz":(_.isString(t)&&(t=t.replace(/^(\d\d\d\d)\.(\d\d).(\d\d)/,"$1-$2-$3"),t=/Z$/.test(t)?t:t+"Z"),t=i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):i.Tools.convertValueToMoment(t),y.isMoment(t)&&t.isValid()?t.utcOffset(0).format("YYYY.MM.DD")+"T"+t.formatNano("HH:mm:ss.SSS",{trim:!1}):"0Np")}},timespan:{char:"n",size:"8",num:16,literal:"00:00:00.00",null:"0Nn",name:"timespan",editor:{type:"TimePicker",options:{isDuration:!0,hasNano:!0,isTimespan:!0,timeFormat:"HH:mm:ss.SSSSSSSSS",width:142,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"0Nn":t==-1/0?"-0Wn":t==1/0?"0Wn":(t=i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):i.Tools.convertValueToDuration(t),y.isDuration(t)?t.format("DD")+"D"+t.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1}):"0Nn")}},minute:{char:"u",size:"4",num:17,literal:"00:00:00",null:"0Nu",name:"minute",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm",width:61,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"0Nu":t==-1/0?"-0Wu":t==1/0?"0Wu":(t=i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):i.Tools.convertValueToDuration(t),y.isDuration(t)?t.format("HH:mm",{trim:!1}):"0Nu")}},second:{char:"v",size:"4",num:18,literal:"00:00:00",null:"0Nv",name:"second",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm:ss",width:79,bindButton:!1},validators:[function(t){return!1}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"0Nv":t==-1/0?"-0Wv":t==1/0?"0Wv":(t=i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):i.Tools.convertValueToDuration(t),y.isDuration(t)?t.formatNano("HH:mm:ss",{trim:!1}):"0Nv")}},time:{char:"t",size:"4",num:19,literal:"00:00:00.000",null:"0Nt",name:"time",editor:{type:"TimePicker",options:{isDuration:!0,timeFormat:"HH:mm:ss.SSS",width:102,bindButton:!1},validators:[function(t){return!E.REGEX_TIMEPICKER.test(t.toString())}]},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?"0Nt":t==-1/0?"-0Wt":t==1/0?"0Wt":(t=i.Tools.isKDBTemporal(t)?i.Tools.convertKDBTemporalToMoment(t):i.Tools.convertValueToDuration(t),y.isDuration(t)?t.formatNano("HH:mm:ss.SSS",{trim:!1}):"0Nt")}},string:{char:"",size:".",num:20,literal:"",null:"",name:"string",editor:{type:"TextArea"},toKDBInput:function(t){return _.isNull(t)||_.isUndefined(t)?'""':'"'+(t&&t.toString?t.toString().replace(/\\/g,"\\\\").replace(/"/g,'\\"'):"")+'"'}},list:{char:"Q",size:"",num:21,literal:[],null:"",name:"list",editor:{type:"CustomList",options:{itemType:"Text"}},toKDBInput:function(t){t=_.values(t);return null!=t&&0<t.length?"("+(1<t.length?"":"enlist ")+_.map(t,function(t){return t&&t.toKDBInput?t.toKDBInput():'`$"'+(_.isString(t)?t.replace(/\"/g,'\\"'):t)+'"'}).join(";")+")":"()"}},dateRolling:{char:"d",size:"4",num:22,literal:"2000.01.01",null:"0Nd",name:"dateRolling",editor:{type:"DatePickerRolling",options:{dateFormat:"yy-mm-dd"},validators:[function(t){return!(E.REGEX_ROLLING.test(t.toString())||t&&t.toISOString&&E.REGEX_DATEPICKER.test(t.toISOString())||E.REGEX_DATEPICKER.test(t.substr(0,10)))&&{type:"rolling",message:"Valid rolling syntax includes NOW, T+x or T+x@HH:mm"}}]},toKDBInput:function(t){return $.datepicker.formatDate("yy.mm.dd",E.castDate(t))}},datetimeRolling:{char:"z",size:"8",num:23,literal:"dateTtime",null:"0Nz",name:"datetimeRolling",editor:{type:"DateTimePickerRolling",options:{dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSS"},validators:[function(t){return!(E.REGEX_ROLLING.test(t.toString())||t&&t.toISOString&&E.REGEX_TIMEPICKER.test(t.toISOString())||E.REGEX_TIMEPICKER.test(t))&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T+x@HH:mm"}}]}},timestampRolling:{char:"p",size:"8",num:24,literal:"dateDtimespan",null:"0Np",name:"timestampRolling",editor:{type:"DateTimePickerRolling",options:{hasNano:!0,isTimestamp:!0,dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss.SSSSSSSSS"},validators:[function(t){return!(E.REGEX_ROLLING.test(t.toString())||t&&t.toISOString&&E.REGEX_TIMEPICKER.test(t.toISOString())||E.REGEX_TIMEPICKER.test(t))&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T+x@HH:mm"}}]}},timeRolling:{char:"t",size:"4",num:25,literal:"00:00:00.000",null:"0Nt",name:"timeRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm:ss.SSS"},validators:[function(t){return!E.REGEX_ROLLING.test(t.toString())&&!E.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T-x"}}]}},minuteRolling:{char:"u",size:"4",num:26,literal:"00:00:00",null:"0Nu",name:"minuteRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm"},validators:[function(t){return!E.REGEX_ROLLING.test(t.toString())&&!E.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T-x"}}]}},secondRolling:{char:"v",size:"4",num:27,literal:"00:00:00",null:"0Nv",name:"secondRolling",editor:{type:"TimePickerRolling",options:{isDuration:!0,timeFormat:"HH:mm:ss"},validators:[function(t){return!E.REGEX_ROLLING.test(t.toString())&&!E.REGEX_TIMEPICKER.test(t.toString())&&{type:"guid",message:"Valid rolling syntax includes NOW, T+x or T-x"}}]}},dict:{char:"Q",size:"",num:98,literal:[],null:"",name:"dict",editor:{type:"Dict",options:{itemType:"Text"}},toKDBInput:function(t){if(_.isEmpty(t))return"()!()";var e=_.keys(t),i=_.values(t),t=1===e.length?"enlist ":"";return"("+t+_.map(e,function(t){return'`$"'+t+'"'}).join(";")+")!("+t+_.map(i,function(t){return t.type?E.getByName(t.type).toKDBInput(t.value):'`$"'+t.replace(/\"/g,'\\"')+'"'}).join(";")+")"}},email:{char:"",size:"",num:29,literal:"",null:"",name:"email",editor:{type:"Text",options:{itemType:"Text"},validators:["email"]},toKDBInput:function(t){return E.infos.symbol.toKDBInput(t)}}},E.simple=["list","boolean","guid","byte","byte","short","int","long","real","float","char","symbol","timestamp","month","date","datetime","timespan","minute","second","time","dict"],E.infosByNum=null,E.REGEX_DATEPICKER=/^\d{4}-\d{2}-\d{2}$/,E.REGEX_ROLLING=/^(?:NOW|T([\+|\-]\d+)|T)(\@)?(\d{1,2})?(:\d{2})?(:\d{2})?(.(\d{9}|\d{3}))?(?:Z)?$/,E.REGEX_DURATION=/^\d{4}-\d{2}-\d{2}T(\d{2,6}):(\d{2}):(\d{2})?[.](\d{9}|\d{3})?Z$/,E.REGEX_TIMEPICKER=/^\d{4}-\d{2}-\d{2}T(\d{2}):(\d{2}):(\d{2})?[.](\d{9}|\d{3})?Z$/,i.RTTI=E,o=zt=zt||{},P.constructPivotWhereString=function(t){var e=[];return t.forEach(function(t){switch(t.columnType){case 1:case 2:case 4:case 5:case 6:case 7:case 8:case 9:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:e.push("("+t.columnOperator+';`$"'+t.columnName+'"; '+o.RTTI.getByQTypeNum(t.columnType).toKDBInput(t.columnValue)+")");break;case 10:1==t.columnValue.length?e.push("("+t.columnOperator+';`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")'):e.push('(~\\:;`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")');break;case 11:e.push("("+t.columnOperator+';`$"'+t.columnName+'"; enlist `$"'+t.columnValue.toString()+'")');break;default:_.isString(t.columnValue)?e.push('(~\\:;`$"'+t.columnName+'"; "'+t.columnValue.toString()+'")'):e.push("("+t.columnOperator+';`$"'+t.columnName+'"; enlist `$"'+t.columnValue.toString()+'")')}}),1==e.length?"enlist "+e[0]:"("+e.join(";")+")"},P._generateOrderingKdbSyntax=function(t){var e,i="";return i=2===(t=(t=t||"").split(",")).length&&"null"!=(e=t[1])?"`"+t[0]+";"+("asc"===e?1:-1):i},P.strip=function(t){return t&&0<t.length?t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," "):t},P.constructPivotQuery=function(i){var t,e,n,o,r,s,a="",l="0j",u=i.pivotSource,c=i.table,p=this.strip(i.queryString),d=i.queryParams,h=i.aggFn,g=i.aggregateFns,f=i._generateOrderingKdbSyntax,m=/^[A-Za-z0-9]+\w*$/;function y(t){return 1<t.length?_.reduce(t,function(t,e,i,n){t+=";"!==t.substr(-1)&&0<i?";":"";return e.match(m)?t+="`"+e:t+='`$"'+e+'"'+(i<n.length-1?";":""),t},"(")+")":1===t.length?t[0].match(m)?"enlist `"+t[0]:'enlist `$"'+t[0]+'"':void 0}return f=this._generateOrderingKdbSyntax(f),t=y(i.dimensions),e=y(_.isArray(i.aggregateLabels)&&!_.isEmpty(i.aggregateLabels)?_.map(i.aggregateLabels,function(t,e){return t||i.aggregateCols[e]}):i.aggregateCols),n=this.constructPivotWhereString(i.wheres),1===i.aggregateCols.length&&(a="enlist "),a+="(",_.each(i.aggregateCols,function(t,e){0<t.length&&(o=g&&g[e]||h,a+="("+o+";"+(t.match(m)?"`"+t:'`$"'+t+'"')+");")}),a=a.substr(0,a.length-1)+")",i.topX&&"null"!==i.topX&&"all"!==i.topX&&(l=i.topX+"j"),s="`d`g!("+t+";"+(i.columnLabel&&0<i.columnLabel.length?"enlist `"+i.columnLabel:"()")+")","query"===u?(p=$.trim(p),r=/^{\[([a-z0-9A-Z\;\w\/ ]+?)\]/.exec(p),u="",$.isArray(r)?u=r[0]:"{[]"!==p.substring(0,3)?p="{[] "+p+"}[]":p+="[]",0<u.length&&(1===d.length?p=p+"["+d[0].name+"]":(p+="[",_.each(d,function(t,e){0<e&&(p+=";"),p+=t.name}),p+="]")),r=u+" "+this.PIVOT_FUNCTION+"["+p+";"+n+";"+s+";"+e+";"+a+";"+l+";("+f+")]",0<u.length&&(r+="}")):r=this.PIVOT_FUNCTION+"[`"+c+";"+n+";"+s+";"+e+";"+a+";"+l+";("+f+")]",r},P.PIVOT_FUNCTION="$[{x~key x}`.pivot.pivotV3;.pivot.pivotV3;{[t;w;d;a;f;n;o] g:(); if [(type d)=99h; [g:d[`g]; d:d[`d],g;]];piv: 0!?[t;w;d!d;a!f]; if [(count g)>0; [d: (-1 _ d); a2:d,a; piv2: 0!?[piv;();g!g;a2!a2]; grpData:{[x;d;grpCol;f] labels: $[(count f)>1;(`$((string x[grpCol]) ,/: string f[;0]));x[grpCol]]; d xkey (d,labels) xcol flip x _ grpCol}; piv: 0! () uj/ each[grpData[;d;g[0];f]] piv2; ]]; if [(count o)>0;[field: o[0]; order: o[1]; piv:$[order>0;field xasc piv;field xdesc piv];]]; $[n<=0;piv;n sublist piv]}]",o.Pivot=P,l=zt=zt||{},I.applyAnalytic=function(){function t(t,e){n.onExecuteSubscriptionSuccess(t,n.get("_forceReset"),e)}function e(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];n.onError(n,n.attributes,t,"Error",e)}var n=this,i=n.get("_subscriptionKey")||l.DataSet.DEFAULT_ROW_INDEX;n.dataSet=new l.DataSet({idAttribute:i,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:i})}),agent:n.agent,maxRows:n.get("_maxRows"),primaryKey:i}),n.dataSet2=new l.DataSet2({idAttribute:i,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:i})}),agent:n.agent,maxRows:n.get("_maxRows"),primaryKey:i}),n.unset("error"),n.unset("queryStatus"),n.updateParameters(!0),"streaming"===n.get("_subscriptionType")?n.execute=n.wrapWithErrorHandler(function(){n.onExecuteBegin(),n.runWithConnectionCheck(e,function(){n.updateBuilder(function(){n.subscriptionId=l.DashClient.client.subscribe(n.get("_maxRows"),n.get("_selectedAnalytic"),n.get("_connection"),t,e,n.bindViewStateToKdbParams(n.get("_analyticParams"))),l.Log.Log("Subbd: "+n.subscriptionId)},e)})},n,n.attributes):n.execute=n.wrapWithErrorHandler(function(){n.onExecuteBegin(),n.runWithConnectionCheck(e,function(){n.updateBuilder(function(){l.DashClient.runAnalytic2(n.get("_selectedAnalytic"),n.get("_connection"),n.bindViewStateToKdbParams(n.get("_analyticParams")),t,e,n.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,null,n.performance)},e)})},n,n.attributes)},I.applyQuery=function(){function i(t,e){o.onExecuteSuccess(t,o.get("_forceReset"),e)}function n(t){o.onError(o,o.attributes,t,"Error",arguments)}var o=this,t=o.get("_subscriptionKey")||l.DataSet.DEFAULT_ROW_INDEX;o.applyViewStateAttributes();o.dataSet=new l.DataSet({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:o.agent,maxRows:o.get("_maxRows"),primaryKey:t}),o.dataSet2=new l.DataSet2({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:o.agent,maxRows:o.get("_maxRows"),primaryKey:t}),o.unset("error"),o.unset("queryStatus"),o.updateParameters(),"streaming"===o.get("_subscriptionType")?o.execute=o.wrapWithErrorHandler(function(){o.onExecuteBegin();var t=o.get("_queryString"),e=o.bindViewStateToKdbParams(o.get("_queryParams")),t=I.replaceParameters(t,e);o.subscriptionId=l.DashClient.client.subscribe(o.get("_maxRows"),t,o.get("_connection"),i,n),l.Log.Log("Subbd: "+o.subscriptionId)},o,o.attributes):o.execute=o.wrapWithErrorHandler(function(){o.onExecuteBegin();var t=o.get("_queryString"),e=o.bindViewStateToKdbParams(o.get("_queryParams"));""!==t.trim()&&l.DashClient.getQueryData2("q",o.get("_connection"),t,e,i,n,o.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,void 0,o.performance)},o,o.attributes)},I.bindViewStateToKdbParams=function(t){var o,r=this,e=[];return $.extend(!0,e,t),0<e.length&&_.each(e,function(n){var t,e,i;"string"==typeof n.value&&(!(o=n.value.match(l.DocumentDataModel.PARAMETER_RX))||(t=r.getViewState().getByPath($.trim(o[0].substring(2,o[0].length-2))))&&(void 0===(e=_.isFunction(t.get)?t.get("value"):t.value)&&(n.value=null),n.value=_.isObject(e)&&!_.isArray(e)?$.extend(!0,{},e):e)),"dict"===n.type&&_.isObject(n.value)?_.each(_.keys(n.value),function(t){var e,i;n.value[t]instanceof m.Model?n.value[t]={type:n.value[t].get("_type"),IsKdbParam:!0,isViewState:!0,name:n.value[t].path,value:n.value[t].get("value")}:"object"==typeof n.value[t]?_.has(n.value[t],"_isKdbReady")||((i=r.getViewState().getByPath(n.value[t].name))?(n.value[t].type=i.get("_type"),n.value[t].value=i.get("value")):"string"==typeof n.value[t].value&&0===n.value[t].value.indexOf("<%")&&(e=$.trim(n.value[t].value.substring(2,n.value[t].value.length-2)),(i=r.getViewState().getByPath(e))&&(n.value[t].value=i.get("value")))):"string"==typeof n.value[t]&&0===n.value[t].indexOf("<%")&&(e=$.trim(n.value[t].substring(2,n.value[t].length-2)),(i=r.getViewState().getByPath(e))&&(n.value[t]={type:i.get("_type"),IsKdbParam:!0,isViewState:!0,name:n.value[t],value:i.get("value")}))}):(o=n.type,(o=l.RTTI.getByName(o))&&"dict"===o.name&&(e=n.value.split(""),i={},_.each(e,function(t){t=t.split("");6===t.length&&(i[t[0]]={type:t[1],IsKdbParam:!0,isViewState:!0,name:t[0],value:t[2]})}),n.value=i))}),e},I.generatePivotModel=function(t,e,i,r){var s,a=this;return r.breakdownCols instanceof m.Model&&(r.breakdownCols=r.breakdownCols.get("value")),a.meta={},s=m.Model.extend({defaults:{_dataType:a.get("_dataType"),_pivotType:a.get("_pivotType"),_subscriptionType:a.get("_subscriptionType"),_subscriptionInterval:a.get("_subscriptionInterval")},idAttribute:t,childId:e,childModelType:i,initialize:function(){this.isDirty=!0,this.isPending=!1,this.legacyUpdates=[],this.agent=new l.Agent},apply:function(){this.dataSet=new l.DataSet({idAttribute:e,collectionFunc:m.Collection.extend({model:i}),agent:this.agent,maxRows:r.maxRows,primaryKey:e})},getRoot:function(){return a},getViewState:function(){return a.getViewState()},execute:function(t){function e(t,e){n.onExecuteSuccess(a.executeClientPivotQuery(a.clientPivotData,{wheres:r.wheres}),a.get("_forceReset"),void 0)}var i,n=this,o=!a.clientPivotData||a.isDirty||t&&t.intervalQuery;this.wheres||(this.wheres=r.wheres),n.onExecuteBegin();try{r.topX=null,r.ordering=null,r.queryParams=a.bindViewStateToKdbParams(a.get("_queryParams")),r.maxRows=a.get("_maxRows")||l.DocumentDataModel.DEFAULT_MAX_ROWS,r.queryString=r.queryString,_.each(r.wheres,function(t,e){var i="string"==typeof t?t:t.columnName,t=a.meta[i];r.wheres[e]={columnName:i,columnType:t,columnOperator:"=",columnValue:n.get(i)}}),i=function(t){a.onError(s,r,t,"Error",arguments)},"client"===n.get("_pivotType")?o?a.runWithConnectionCheck(i,function(){switch(a.get("_dataType")){case"query":l.DashClient.getQueryData("kdb",a.get("_connection"),r.queryString,r.queryParams,function(t){t&&(a.clientPivotData=t),e()},i,null,null,a.performance);break;case"virtual":a.executeVirtualQuery(a.get("_virtualQueryString"),a.get("_virtualParams"),function(t){a.clientPivotData=t,e()})}}):e():a.runWithConnectionCheck(i,function(){I.getPivotData(r,function(t,e){_.extend(a.meta,t.meta),n.onExecuteSuccess(t,a.get("_forceReset"),e,a.meta)},i,a.performance)})}catch(t){a.onError(s,r,t,"Error",arguments)}},exportPivotData:function(t,e){e("Pivot export not supported")},clearVirtualSubscriptions:_.noop,clearVirtualSubscriptionsAll:_.noop,executeClientPivotQuery:a.executeClientPivotQuery,formatValue:a.formatValue,getViewStateAttribute:a.getViewStateAttribute,isPagingData:a.isPagingData,legacyFlush:a.legacyFlush,legacyUpdate:a.legacyUpdate,logPrefix:a.logPrefix,onComplete:a.onComplete,onExecuteBegin:a.onExecuteBegin,onExecuteSuccess:a.onExecuteSuccess,reset:a.reset,start:a.start,stop:a.stop,subscribe:a.subscribe,triggerCallbacks:_.noop,updateVirtualSubscriptions:_.noop,unsubscribe:a.unsubscribe},{staticIdAttribute:t})},I.connectionCollectionSync=function(t,e,i){if("read"!==t)throw"data operation not supported for DocumentCollection";l.DashClient.runAPI(".api.conList","gw",[],function(t){return i.success(_.map(t.rows,function(t){return t.type=t.dbtype,delete t.type,t.password=t.pass,delete t.pass,t}))},function(t){return i.error(t)})},I.connectionSync=function(t,e,i){var n,o=this;switch(t){case"update":(n={}).originalName=o.get("originalName");case"create":n=_.extend(n||{},{name:o.id,dbtype:o.get("type"),tls:o.get("tls"),host:o.get("host"),port:o.get("port"),user:o.get("user"),pass:o.get("password"),database:""}),l.DashClient.runAPI(".api.conUpsert","gw",[{type:"symbol",value:o.id},{type:"string",value:JSON.stringify(n)}],function(t){return i.success(t)},function(t){return i.error(t)});break;case"delete":l.DashClient.runAPI(".api.conDelete","gw",[{type:"symbol",value:o.id}],function(){return i.success()},function(t){return i.error(t)});break;default:throw"data operation not supported for Document"}},I.documentCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DashCollection";l.DashClient.runAPI(".api.dashList","gw",[],function(t){var i=[];t.rows.forEach(function(e){try{i.push(new l.Document(JSON.parse(e.description)))}catch(t){l.Log.Error("Error parsing dashboard description",e)}}),n.success&&n.success(i)},function(t){alert("Retrieve Dashboards FAILED"),n.error&&n.error(t)})},I.documentSync=function(t,e,i){var n,o=this;switch(t){case"read":l.DashClient.runAPI(".api.dashRead","gw",[{type:"symbol",value:o.id}],function(t){try{n=JSON.parse(t.rows[0].string)}catch(t){i.error&&i.error(t)}i.success&&i.success(n)},function(t){i.error&&i.error(t)});break;case"update":l.DashClient.runAPI(".api.dashUpsert","gw",[{type:"symbol",value:o.id},{type:"string",value:JSON.stringify(_.omit(o.attributes,["permissionEntity"]),null,2)}],function(){i.success&&i.success(o.attributes)},function(t){i.error&&i.error(t)});break;case"delete":l.DashClient.runAPI(".api.dashDelete","gw",[{type:"symbol",value:o.id}],function(){i.success&&i.success()},function(t){i.error&&i.error(t)});break;default:throw"data operation not supported for Document"}},I.replaceParameters=function(t,i){var e,n=0;if("string"==typeof t){if(t=this.strip(t),(e=/^\{(\[([^\]]+)\])?(.*)\}$/.exec(t))&&4===e.length)return e[2]?(e=e[2].split(";"),n+=e.length,t+"["+_.map(e,function(t,e){return l.RTTI.getByName(i[e].type).toKDBInput(i[e].value)}).join(";")+"]"):t+"[]";t=t.replace(/<%[^<>%]+%>/g,function(t){var e=n++;return l.RTTI.getByName(i[e].type).toKDBInput(i[e].value)})}return t},I.stop=function(){var t=this;t.pollingEvent&&(clearInterval(t.pollingEvent),t.pollingEvent=null),t.subscriptionId&&(l.DashClient.client.unsubscribe(t.subscriptionId),t.subscriptionId=null,t.isPending=!1)},I.getPivotData=function(t,i,e,n){l.DashClient.getQueryData("q",t.connection,l.Pivot.constructPivotQuery(t),t.queryParams,function(t,e){i(t,e)},e,t.maxRows,void 0,n)},I.strip=function(t){return t&&0<t.length?t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," ").trim():t},I.parameterRx=new RegExp("<%([^<>%]+?)%>","g"),I.DEFAULT_NULL_VALL=-0x8000000000000000,l.DashClientLib=I,p=$,r=/\+/g,p.cookie=function(t,e,i){var n,o;if(void 0!==e&&!p.isFunction(e))return"number"==typeof(i=p.extend({},i)).expires&&(n=i.expires,(o=i.expires=new Date).setTime(+o+864e5*n)),document.cookie=[k(t),"=",k(String(e)),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("");for(var r=t?void 0:{},s=document.cookie?document.cookie.split("; "):[],a=0,l=s.length;a<l;a++){var u=s[a].split("="),c=(c=u.shift(),decodeURIComponent(c)),u=u.join("=");if(t&&t===c){r=A(u,e);break}t||void 0===(u=A(u))||(r[c]=u)}return r},p.removeCookie=function(t,e){return void 0!==p.cookie(t)&&(p.cookie(t,"",p.extend({},e,{expires:-1})),!p.cookie(t))},a=zt=zt||{},x.attemptUpload=function(t){x.logUploadConnected?a.DeltaClientLib.createLog(t,function(){},function(){x.logUploadConnected=!1,x.storeLocal(t),x.debounceRetryConnection()}):x.storeLocal(t)},x.logPerformanceMetrics=function(t,e){var i,n,o;x.clientLoggingEnabled&&(i=e.performance,n=i.onAgentNotify-i.apply,o="Performance Metrics<--\x3e"+y().format("H:mm:ss.SSS")+"<--\x3e"+t+" (Roundtrip: "+n.toFixed(0)+"ms)<--\x3e",e=function(t){var e=t/n*100;return t.toFixed(0)+" ms  "+e.toFixed(2)+"%"},(t=[])[0]=i.serverStart?i.serverStart-i.apply:0,t[1]=i.serverStart&&i.serverEnd?i.serverEnd-i.serverStart:n,t[2]=i.serverEnd?i.onAgentNotify-i.serverEnd:0,o+="Dispatch: "+e(t[0]),o+=", Server Duration: "+e(t[1]),o+=", IPC & Deserialize: "+e(t[2]),x.attemptUpload(o))},x.setClientLogging=function(){x.logUploadConnected=!0,x.clientLoggingEnabled=!0,x.traceConsoleError(),x.trace(a.Tools.getCookie("dashboard-log-level"))},x.trace=function(t){t=Number(t);x.clientLoggingEnabled?x.turnOnUploads(t):(x.Error=0<t?console.error.bind(console,"%s",x.logPrefix(x.Level.Error)):_.noop,x.Handled=1<t?console.error.bind(console,"%s",x.logPrefix(x.Level.Handled)):_.noop,x.Warn=1<t?console.warn.bind(console,"%s",x.logPrefix(x.Level.Warn)):_.noop,x.Debug=2<t?console.debug.bind(console,"%s",x.logPrefix(x.Level.Debug)):_.noop,x.Log=2<t?console.log.bind(console,"%s",x.logPrefix(x.Level.Info)):_.noop,x.Info=3<t?console.info.bind(console,"%s",x.logPrefix(x.Level.Info)):_.noop)},x.turnOnUploads=function(i){x.Error=function(t,e){0<i&&console.error(t,e||""),0<x.ServerLogLevel&&x.attemptUpload(x.logUploadString(this.Level.Error,t,e))},x.Handled=function(t,e){1<i&&console.error(t,e||""),1<x.ServerLogLevel&&x.attemptUpload(x.logUploadString(this.Level.Handled,t,e))},x.Warn=function(t,e){1<i&&console.warn(x.logPrefix(this.Level.Warn)+t,e||""),2<x.ServerLogLevel&&x.attemptUpload(x.logUploadString(this.Level.Warn,t,e))},x.Debug=function(t,e){2<i&&console.debug(x.logPrefix(this.Level.Debug)+t,e||""),2<x.ServerLogLevel&&x.attemptUpload(x.logUploadString(this.Level.Debug,t,e))},x.Log=function(t,e){2<i&&console.log(x.logPrefix(this.Level.Log)+t,e||""),2<x.ServerLogLevel&&x.attemptUpload(x.logUploadString(this.Level.Log,t,e))},x.Info=function(t,e){3<i&&console.info(x.logPrefix(this.Level.Info)+t,e||""),3<x.ServerLogLevel&&x.attemptUpload(x.logUploadString(this.Level.Info,t,e))}},x.getStackTrace=function(){return"\nStack Trace: "+(new Error("").stack||"").split("\n").slice(3,9).join("\n")},x.logPrefix=function(t){function e(){}return e.toString=function(){return t+"\t"+y().format("H:mm:ss.SSS")+"\t"},e},x.logUploadString=function(t,e,i){e=t+"<--\x3e"+y().format("H:mm:ss.SSS")+"<--\x3e"+e+"<--\x3e";return i&&(e+=JSON.stringify(i)),t!==this.Level.Info&&(e+=x.getStackTrace()),e},x.retryConnection=function(t){var e=[1,3,15,60,180,900];t===e.length&&--t,setTimeout(function(){x.uploadStoredLogs(t)},1e3*e[t])},x.storeLocal=function(t){var e,i,n=localStorage.length-1;if(localStorage.getItem("0000"))for(;!i;)(e=localStorage.key(n)).match(/\d\d\d\d/)&&(i=("000"+(parseInt(e)+1)).slice(-4)),--n;else i="0000";localStorage.setItem(i,t)},x.traceConsoleError=function(){var n=console.error;console.error=function(t,e){var i=x.logPrefix(x.Level.Error)+t;n.apply(console,[i,e||""]),x.attemptUpload(x.logUploadString(x.Level.Error,t,e))}},x.uploadStoredLogs=function(e){var i,n,o=!1,r=function(t){t<localStorage.length?(i=localStorage.key(t)).match(/\d\d\d\d/)?(n=localStorage.getItem(i),a.DeltaClientLib.createLog(n,function(){o=!0,localStorage.removeItem(i),r(t)},function(){x.retryConnection(o?0:e+1)})):r(t+1):x.logUploadConnected=!0};r(0)},x.ServerLogLevel=4,x.debounceRetryConnection=_.debounce(function(){x.retryConnection(0)},300,{maxWait:1e3}),K=x,a.Log=K,(b=(b=K=a.Log||(a.Log={})).Level||(b.Level={})).Info="INFO",b.Warn="WARN",b.Error="ERROR",b.Fatal="FATAL",b.Critical="CRITICAL",b.Off="OFF",b.Handled="HANDLED",b.Debug="DEBUG",K.trace($.cookie("dashboard-log-level")),window.onerror=function(t,e,i,n,o){t&&t.toString&&t.toString(),o&&o.toString&&o.toString(),a.DeltaClientLib.createLog(t+"<--\x3e"+y().format("H:mm:ss.SSS")+"<--\x3e"+o,_.noop,_.noop)},u=zt=zt||{},N.initializeDeltaClient=function(t,e,i,n,o,r,s,a,l,u,c,p,d){this.host=t,this.port=e,this.secure=i,this.fromUrl=n,this.username=o,this.successCallback=s,this.errorCallback=a,this.token=l,this.appid=u,this.saml=p,this.forceLogin=d,this.properties={},this.clientLoggedIn=!1,this.errorCallback=a,this.deltaClient?this.saml?this.deltaClient.register("dashboards"):this.deltaClient.login(this.username,r,this.appid,[],this.forceLogin):(this.deltaClient=new win.Client({host:this.host,port:this.port,secure:this.secure,fromURL:this.fromUrl},c,c),this.initDeltaClient(r))},N.initializeDeltaClientCopy=function(t,e,i,n,o,r,s,a,l,u,c){this.host=e,this.port=i,this.secure=n,this.fromUrl=o,this.username=r,this.successCallback=a,this.errorCallback=l,this.appid=u,this.saml=c,this.properties={},this.clientLoggedIn=!0,this.deltaClient=t,this.deltaClient.DeltaClientLogin=!0,this.initDeltaClient(s)},N.initDeltaClient=function(t){var i=this,n=!1,o=null;this.deltaClient.status._subscribe({next:function(t){switch(t.type){case win.Client.status.CONNECTING:n&&($(i).trigger("DeltaClientDisconnect"),i.disconnected=!0),i.eCode=t.eCode,o=o||_.delay(function(){i.sendError(1006===i.eCode?"WebSocket connection error, please check proxy settings":"Server connectivity issues, please try again.")},i.DEFAULT_TIMEOUT);break;case win.Client.status.CONNECTED:try{n=!0;var e=i.deltaClient.systemConfig();e&&(i.showLastLoginAttempts=e.showLastLoginAttempts),i.clientLoggedIn?$(i).trigger("DeltaClientConnect"):i.onFirstLogin(),clearTimeout(o),$.cookie("deltaToken",i.deltaClient.tokenKey(),{expires:30,path:"/"}),o=null}catch(t){i.sendError("There was a problem connecting to the server: "+t)}break;case win.Client.status.LOGGED_IN:clearTimeout(o),o=null,i.username=i.deltaClient.user();break;case win.Client.status.LOGGED_OUT:i.changingPassword&&_.isString(t.data)&&-1!==t.data.indexOf("Client action")?setTimeout(function(){this.changingPasswordFailed=!1,this.deltaClient.resetPassword(this.username,this.changingPasswordOld,this.changingPasswordNew)},500):_.isString(t.data)&&-1===t.data.indexOf("no connection available")?($.removeCookie("deltaToken",{path:"/"}),i.saml?i.ssoLogout("local"):(-1!==t.data.indexOf("timeout")?$.cookie("deltaLoginError","Your session timed out",{expires:30,path:"/"}):-1!==t.data.indexOf("session limit")?$.cookie("deltaLoginError",t.data.split("|")[2],{expires:30,path:"/"}):$.removeCookie("deltaLoginError",{path:"/"}),window.onbeforeunload=function(t){},location.reload())):!t.data&&i.disconnected&&i.errorCallback("loginRequired");break;case win.Client.status.EXPIRED:clearTimeout(o),o=null,u.Log.Log("Expired",t),i.sendError("Your password has expired");break;case win.Client.status.RESET:clearTimeout(o),o=null,$(i).trigger("Reset"),i.sendError("Please reset password"),u.Log.Log("Reset",t);break;case win.Client.status.RESET_FAIL:clearTimeout(o),o=null,i.changingPasswordFail&&i.changingPasswordFail(t.data),i.changingPasswordFailed=!0,u.Log.Log("Reset Fail",t);break;case win.Client.status.RESET_SUCCESS:i.changingPassword&&(i.changingPasswordFailed?i.changingPassword=!1:(i.changingPasswordSuccess&&i.changingPasswordSuccess(),i.changingPassword=!1,i.changingPasswordFail=null,i.changingPasswordSuccess=null,i.changingPasswordOld=null,i.changingPasswordNew=null,i.successCallback&&i.successCallback(),$.cookie("deltaLoginError","Password changed. Please login again.",{expires:30,path:"/"}),$.removeCookie("deltaToken",{path:"/"})));break;case win.Client.status.FAULT:u.Log.Log("Fault",t),clearTimeout(o),o=null,"userSessionLimit"!==t.data&&$.removeCookie("deltaToken",{path:"/"}),i.sendError(t.data)}},error:function(){u.Log.Error("onError",arguments)},complete:function(){u.Log.Info("onCompleted",arguments)}}),this.token=this.token||this.deltaClient.tokenKey(),this.deltaClient.DeltaClientLogin?this.onFirstLogin():this.saml?this.deltaClient.register("dashboards"):this.token?this.deltaClient.loginWithTokenKey(this.token,this.appid):(this.deltaClient.login(this.username,t,this.appid,[],this.forceLogin),t=null)},N.getDashboardProperty=function(t){return this.properties[t]},N.changeUserPassword=function(t,e,i,n){this.changingPassword||(this.changingPassword=!0,this.changingPasswordOld=t,this.changingPasswordNew=e,this.changingPasswordSuccess=i,this.changingPasswordFail=n,this.changingPasswordFailed=!1,this.deltaClient.resetPassword(this.username,this.changingPasswordOld,this.changingPasswordNew))},N.onFirstLogin=function(){var e=this;this.deltaClient.request("ConfigAPI.getConfigParameter",function(t){t.rows.forEach(function(t){e.properties[t.Property.elementValue]=t.Value.elementValue}),"true"==e.properties.legacy_managed&&(e.startManagedQuery=e.startLegacyManagedQuery,e.startManagedQuery2=e.startLegacyManagedQuery2),u.Tools.timezone=$.cookie("dashboard-timezone")||e.properties.timezone||y.tz.guess(),e.clientLoggedIn=!0,e.deltaClient.clientLoggingEnabled()&&(e.properties.hasOwnProperty("log-level")&&(u.Log.ServerLogLevel=Number(e.properties["log-level"])),u.Log.setClientLogging()),$(e).trigger("DeltaClientLogin"),e.deltaClient.DeltaClientLogin=!0,e.successCallback&&e.successCallback(),$(e).trigger("DeltaClientConnect")},_.noop,"DASHproperties","DEFAULT","delta_install_default")},N.sendError=function(t,e){this.errorCallback&&this.errorCallback(t)},N.ssoLogout=function(t){this.deltaClient.ssoLogout(t)},N.clientLoggedIn=!1,N.changingPassword=!1,N.changingPasswordFailed=!1,N.disconnected=!1,N.DEFAULT_TIMEOUT=1e4,u.DCBase=N,function(t){t.DCRequest=function(t,e,i,n,o){this.op=t,this.connectionId=e,this.query=i,this.success=n||function(){},this.error=o||function(){},this.timestamp=(new Date).getTime()};var d=function(t,e){this.offset=t,this.qtype=e};t.qAtom=d;var o,h=(C(e,o=d),e);function e(t,e,i,n){t=o.call(this,n,t)||this;return t.isSorted=e,t.length=i,t}t.qVector=h;var g=function(t,e,i){this.qtype=0,this.isSorted=t,this.values=e,this.end=i};t.qGenericList=g;var f=function(t,e){this.qtype=11,this.isSorted=t,this.offsets=e};t.qSymList=f;var m=function(t,e,i,n){this.keys=i,this.values=n,this.qtype=t,this.isSorted=e};function y(t){switch(t){case 1:case 4:case 10:return 1;case 5:return 2;case 6:case 8:case 13:case 14:case 17:case 18:case 19:return 4;case 7:case 9:case 12:case 15:case 16:return 8;case 2:return 16;default:return}}function v(t){for(var e,i,n,o="",r=0;r<t.length;r++)switch((e=t[r])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:i=t[++r],o+=String.fromCharCode((31&e)<<6|63&i);break;case 14:i=t[++r],n=t[++r],o+=String.fromCharCode((15&e)<<12|(63&i)<<6|(63&n)<<0)}return o}t.qDict=m,t.getTypeSize=y,t.u8u16=function(t){for(var e=[],i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e.push(n):n<2048?e.push(192|n>>6,128|63&n):n<55296||57344<=n?e.push(224|n>>12,128|n>>6&63,128|63&n):(n=65536+((1023&n)<<10|1023&t.charCodeAt(++i)),e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return e},t.u16u8=v,t.deserialize=function(t,e,i){var l=e||8,o=new DataView(t);function r(){return o.getInt8(l++)}function u(){return o.getUint8(l++)}function c(){var t=o.getInt32(l,!0);return l+=4,t}function s(t){var e=1===u(),i=c(),n=y(t);if(n){var o=new h(t,e,i,l);return l+=i*n,o}if(11===t){for(var r=new Array(i),s=0;s<i;s++){r[s]=l;for(;0!==u(););}return new f(e,r)}if(0!==t)throw"Unsupported type";for(var a=new Array(i),s=0;s<i;s++)a[s]=p();return new g(e,a,l)}function a(){var t=1===u();return 99!==r()&&console.error("c.js Assertion type=99 failed."),new m(98,t,s(r()),s(r()))}function p(){var t=r();if(-20<t&&t<0)return function(t){var e=new d(l,t),i=y(-t);if(i)l+=i;else{if(-11!==t)throw"Unsupported type";for(;0!==u(););}return e}(t);if(99<t){var e=new d(l,t);if(100===t)return function(){for(var t,e=[];0!==(t=o.getUint8(l++));)e.push(t);v(e)}(),p();if(t<104)return 0===r()&&101===t?new d(l-1,t):e;if(105<t)p();else for(var i=0,n=c()||0;i<n;i++)p();return e}return 99===t?function(){if(98!==o.getUint8(l))return e=s(r()),i=98===(i=u())?a():s(i),new m(99,!1,e,i);var t=1===u(),e=a();l++;var i=a();return new m(99,t,e,i)}():98===t?a():s(t)}if(i){if(0===r()){c();if(0===r()&&-6===r()){i=c(),r();return[i,u(),p()]}}return[0,5,"Message parse error"]}return p()}}(zt=zt||{}),f=zt=zt||{},e=f.DCBase,C(L,e),L.createLog=function(t,e,i){var n,o,r,s;this.deltaClient&&this.deltaClient.clientLoggingEnabled()&&(s=[],_.isString(t)&&(s=t.split("<--\x3e")),n=this.username,o=s[0]||"",t=s[1]||"",r=s[2]||"",s=s[3]||"",this.deltaClient.request("ClientLoggerAPI.log",function(t){_.isFunction(e)&&e()},function(t){console.log("Client logging FAILED\n\n"),null==t?console.log("Client logging: "+r+"failed. Data is null"):console.log("Client logging:",t.toString()),_.isFunction(i)&&i()},n,t,o,r,s))},L.deleteComponent=function(t,e,i){this.deltaClient.request("ComponentAPI.deleteComponent",function(t){e(t)},function(t){i(t)},t)},L.connectionCollectionSync=function(t,e,i){if("read"!==t)throw"data operation not supported for DocumentCollection";L.deltaClient.request("ConnectionAPI.getConnections",L.generateSuccessCallback(i),L.generateErrorCallback(i,"Error reading connections"))},L.connectionSync=function(t,e,i){var n,o=this;switch(t){case"update":(n=new win.ConnectionEntity).originalName=o.get("originalName");case"create":(n=n||new win.ConnectionEntity).name=o.id,n.host=o.get("host"),n.port=o.get("port"),n.user=o.get("user"),n.password=o.get("password"),n.type=o.get("type"),n.driver=o.get("driver"),n.tls=o.get("tls"),L.deltaClient.request("ConnectionAPI.updateConnections",L.generateSuccessCallback(i),L.generateErrorCallback(i,"Error "+t.substring(0,5)+"ing connection"),[n],[]);break;case"delete":L.deltaClient.request("ConnectionAPI.updateConnections",L.generateSuccessCallback(i),L.generateErrorCallback(i,"Error deleting connection"),[],[o.id]);break;default:throw"data operation not supported for Document"}},L.connectionGroupCollectionSync=function(t,e,i){if("read"!==t)throw"data operation not supported for ConnectionGroup Collection";L.deltaClient.request("ConnectionAPI.getConnectionGroups",L.generateSuccessCallback(i),L.generateErrorCallback(i,"Error reading connection groups"))},L.connectionGroupSync=function(t,e,i){var n,o=this;switch(t){case"create":(n=new win.ConnectionGroupEntity).name=o.id,n.type=o.get("type"),n.connections=o.get("connections"),n.connectionsType=o.get("connectionsType"),L.deltaClient.request("ConnectionAPI.createConnectionGroup",L.generateSuccessCallback(i),L.generateErrorCallback(i,"Error creating connection group"),n);break;case"update":(n=new win.ConnectionGroupEntity).name=o.id,n.type=o.get("type"),n.connections=o.get("connections");for(var r=0;r<n.connections.length;r+=1)n.connectionsType.push("default");L.deltaClient.request("ConnectionAPI.updateConnectionGroup",L.generateSuccessCallback(i),L.generateErrorCallback(i,"Error updating connection group"),n);break;case"delete":L.deltaClient.request("ConnectionAPI.deleteConnectionGroup",L.generateSuccessCallback(i),L.generateErrorCallback(i,"Error deleting connection group"),o.id);break;default:throw"data operation not supported for Connection Group"}},L.documentCollectionSync=function(t,e,n){if("read"!==t)throw"data operation not supported for DashCollection";L.deltaClient.request("ProjectAPI.getDashboards",function(t){var i=[];_.each(t,function(e){if(!e.accessLevel||!f.DocumentCollection.requiredAccessLevel||e.accessLevel===f.DocumentCollection.requiredAccessLevel)try{var t=JSON.parse(e.description);i.push(new f.Document({id:e.name,name:e.displayName,creationDate:t.creationDate,lastUpdateDate:t.lastUpdateDate||t.creationDate,screenDetails:t.screenDetails||[],thumb:t.thumb||null,tags:t.tags||[]}))}catch(t){f.Log.Error("Error parsing dashboard description",e)}}),n.success&&n.success(i)},function(t){alert("Retrieve Dashboards FAILED"),n.error&&n.error(t)})},L.documentSync=function(t,e,i){var n,o=this;switch(t){case"read":L.deltaClient.request("ProjectAPI.getDashboard",function(t){var e;t?((e=JSON.parse(t.dataJSON)).permissionEntity=t.permissionEntity,i.success&&i.success(e)):i.error&&i.error()},function(t){i.error&&i.error(t)},o.id);break;case"update":n={name:o.id,displayName:o.get("name"),description:JSON.stringify({creationDate:o.get("creationDate"),lastUpdateDate:o.get("lastUpdateDate"),tags:o.get("tags"),screenDetails:o.get("screenDetails"),thumb:o.get("thumb")},null,2),dataJSON:JSON.stringify(_.omit(o.attributes,["permissionEntity"]),null,2),class:"api.entity.DashboardEntity",permissionEntity:{permissions:o.get("permissionEntity")?o.get("permissionEntity").permissions:{}}},L.deltaClient.request("ProjectAPI.setDashboard",function(t){t?i.success&&i.success(o.attributes):i.error&&i.error()},function(t){i.error&&i.error(t)},n);break;case"delete":L.deltaClient.request("ProjectAPI.deleteDashboard",function(t){t?i.success&&i.success():i.error&&i.error()},function(t){i.error&&i.error(t)},o.id);break;default:throw"data operation not supported for Document"}},L.documentViewSync=function(t,e,i){var n,o=this;switch(t){case"read":n=L.generateErrorCallback(i,"Error reading viewstate"),L.deltaClient.request("UserSettingsAPI.readUserSetting",function(t){var e;t?i.success&&(t&&t[0]&&(e=JSON.parse(t[0].jsonData)),i.success(e)):n()},n,o.id);break;case"create":case"update":n=L.generateErrorCallback(i,"Error updating viewstate"),L.deltaClient.request("UserSettingsAPI.updateUserSetting",function(t){t?i.success&&i.success(o.attributes):n()},n,{class:"api.entity.UserSettingEntity",id:o.id,type:"dashboard_view_state",jsonData:o.attributes});break;case"delete":n=L.generateErrorCallback(i,"Error deleting viewstate"),L.deltaClient.request("UserSettingsAPI.deleteUserSetting",function(t){t?i.success&&i.success():n()},n,o.id);break;default:throw"data operation not supported for user settings: "+t}},L.exportAnalyticData=function(t,e,i,n,o,r,s){var a=[],l=null;i=i||[],_.keys(o).length&&(l=this.processExportParams(o)),this.createParamsObj(a,i),L.exportData(n,t,a,l,e,r,s)},L.exportQueryData=function(t,e,i,n,o,r,s){var a=[],e=kdb.KDBQuery.create(e,void 0,void 0,!0);i&&(this.createParamsObj(a,i),e.parameters=a,_.keys(o).length&&(e.uiParams=this.processExportParams(o))),L.exportData(n,e,null,null,t,r,s)},L.exportPivotData=function(t,e,i){var n,o=t.pivotSource,r=t.queryParams,s=[],a={},l="";t&&(t.exportName&&(l=t.exportName),t.exportParams&&(a=t.exportParams)),n=f.Pivot.constructPivotQuery(t),n=kdb.KDBQuery.create(n,void 0,void 0,!0),"query"===o&&(this.createParamsObj(s,r),n.parameters=s,_.keys(a).length&&(n.uiParams=this.processExportParams(a))),L.exportData(l,n,null,null,t.connection,e,i)},L.exportData=function(i,t,e,n,o,r,s){var a=this,t=["ExportAPI.export"+(i?"ToFile":""),function(t){var e;_.isFunction(r)&&(t=t+"/"+(e=(i||t)+".zip"),t=a.deltaClient.connection.url+"/FileDownloadServlet?client="+a.deltaClient.base64DeltaClient()+"&filename="+e+"&filepath="+t,r(t))},s,t];e&&t.push(e),n&&t.push(n),t.push(o),i&&t.push(i),this.deltaClient.request.apply(this.deltaClient.request,t)},L.generateSuccessCallback=function(e){return function(t){e.success&&e.success(t)}},L.generateErrorCallback=function(e,i){return function(t){f.Log.Error(i,t),e.error&&e.error(t)}},L.getComponents=function(e,i){f.Log.Info("Running Get Components"),this.deltaClient.request("ComponentAPI.getComponents",function(t){e(t)},function(t){i(t)})},L.getDeltaAnalytics=function(e){this.deltaClient.request("AnalyticAPI.getAnalytics",function(t){e&&e(t)},function(){f.Log.Error("Failed to retrieve Analytics\n\n")})},L.getDeltaInstances=function(e){this.deltaClient.request("ConnectionAPI.getProcessInstances",function(t){e&&e(t)},function(){f.Log.Error("Failed to retrieve Instances\n\n")})},L.getPivotData=function(t,n,e,o){var i=t.connection,r=t.pivotSource,s=t.queryParams,a=[],l=t.maxRows||null,u=f.Pivot.constructPivotQuery(t),l=kdb.KDBQuery.create(u,l);"query"===r&&(this.createParamsObj(a,s),l.parameters=a),o&&o.trigger("serverStart"),this.deltaClient.request("QueryAPI.runQueryBA",function(t,e){o&&o.trigger("serverEnd");var i=f.deserialize(e);n&&n(i,e)},function(){e&&e(arguments)},l,i),"subscription"===t.subscriptionType&&(o&&o.trigger("serverStart"),this.deltaClient.request("SubscriptionAPI.addSubscription",function(t,e){n&&(o&&o.trigger("serverEnd"),e&&e.byteLength&&(t.dataSet=f.deserialize(e)),n(t,e))},function(t){e&&e(t)},l,i,1e3*t.subscriptionInterval))},L.getPolledSubscription=function(e){return this.deltaClient.connection.oobupdate.filter(function(t){return"QRPolledMessage"===t.type&&t.data[0]===e})},L.getQueryData=function(t,e,i,n,o,r,s,a,l){L.getQueryData2(t,e,i,n,L.legacyRowCallback(o),r,s,a,l)},L.getQueryData2=function(t,i,e,n,o,r,s,a,l){var u,c,p,d=[],h=s&&0!=s?Number(s):null,g=this;a&&i&&_.includes(L.PAGING_TYPES,a.type)||(a={type:"NONE"}),"sql"===t?this.getSqlQueryData(i,this.strip(e),n,o,r,s):(a&&"NONE"!==a.type?(u=new kdb.QDict,_.each(a.sorting,function(t,e){u.add(e,!0===t,kdb.KDB.BOOLEAN)}),(p=kdb.KDBQuery.createPaged(this.strip(e),a.type,a.num,a.size,u)).unlimitedRows=-1===a.size):p=kdb.KDBQuery.create(this.strip(e),h),n&&(this.createParamsObj(d,n),p.parameters=d),f.Log.Info("QUERY: ",p),g=this,p=[i?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){l&&l.trigger("serverEnd"),g.deltaClient.connection.removeResponder(c.uid);t=i?f.deserialize(e):t;o&&o(t,e)},function(){g.deltaClient.connection.removeResponder(c.id),r&&r(arguments)},p],i&&p.push(i),l&&l.trigger("serverStart"),c=this.deltaClient.request.apply(this.deltaClient.request,p))},L.getConfigAPIDataWithProfile=function(t,e,i,n,o,r,s,a){r=[i,function(t){t&&s&&s(t)},function(){a&&a(arguments)},n,o,r];e&&r.push(e),this.deltaClient.request.apply(this.deltaClient.request,r)},L.getConfigAPIData=function(t,e,i,n,o,r){n=[i,function(t){t&&o&&o(t)},function(){r&&r(arguments)},n];e&&n.push(e),this.deltaClient.request.apply(this.deltaClient.request,n)},L.getConfigAPIDataNoParam=function(t,e,i,n,o){i=[i,function(t){t&&n&&n(t)},function(){o&&o(arguments)}];e&&i.push(e),this.deltaClient.request.apply(this.deltaClient.request,i)},L.getAPIQueryData=function(t,i,e,n,o,r){var s=[],a=kdb.APIQuery.create(e);a.lambda=e,this.createParamsObj(s,n),a.parameters=s,a=[i?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){t=i?f.deserialize(e):t;o&&o(t,e)},function(){r&&r(arguments)},a],i&&a.push(i),this.deltaClient.request.apply(this.deltaClient.request,a)},L.getSqlQueryData=function(t,e,i,n,o,r){var s,a=[],r=r||2e3;e=$.trim(e),i?(s=kdb.SQLQuery.create(e,r),this.createSqlParamsObj(a,i),s.parameters=a):s=kdb.SQLQuery.create(e,r),i&&(s=kdb.SQLQuery.create(e,r),this.createSqlParamsObj(a,i),s.parameters=a),this.deltaClient.request("QueryAPI.runQuery",function(t){n&&n(t)},function(){o&&o(arguments)},s,t)},L.isConnectionAlive=function(t){return this.deltaClient.request("ConnectionAPI.isAlive",function(t){f.Log.Info(t)},function(t){f.Log.Info(t)},t)},L.legacyRowCallback=function(i){return function(t,e){i&&(e&&e.byteLength&&(t.dataSet?t.dataSet=f.ipc.Parse.reshape(t.dataSet,e).toLegacy():t=f.ipc.Parse.reshape(t,e).toLegacy()),i(t))}},L.logout=function(){this.deltaClient?this.deltaClient.logout():($.removeCookie("deltaToken",{path:"/"}),location.reload())},L.processExportParams=function(o){var r=new kdb.QDict;return _.each({columnLabel:"SYMBOL",dateFormat:"STRING"},function(e,t){var i,n;o[t]&&o[t].length&&(i=new kdb.QDict,n=o[t].split("&&"),_.each(n,function(t){t=t.trim().split("#");i.add(t[0],t[1],kdb.KDB[e])}),r.add(t,i,kdb.KDB.DICT))}),r},L.runAnalytic=function(t,e,i,n,o,r,s,a){L.runAnalytic2(t,e,i,L.legacyRowCallback(n),o,r,s,a)},L.runAnalytic2=function(e,i,t,n,o,r,s,a){var l,u,c=[],r=r&&0!=r?Number(r):null,p=this;t=t||[],i=i||"ds_rdb_fx_eval",s&&i&&_.includes(L.PAGING_TYPES,s.type)||(s={type:"NONE"}),this.createParamsObj(c,t),s&&"NONE"!==s.type?(a&&a.trigger("serverStart"),l=this.deltaClient.request(i?"AnalyticAPI.runPagedBA":"AnalyticAPI.runPaged",function(t,e){a&&a.trigger("serverEnd"),p.deltaClient.connection.removeResponder(l.uid);t=i?f.deserialize(e):t;n&&n(t,e)},function(t){p.deltaClient.connection.removeResponder(l.uid),f.Log.Error("Analytic run failed ("+e+")",t),o&&o(t)},e,c,i,s.type,s.num,s.size,_.keys(s.sorting)[0]||"",_.values(s.sorting)[0]||!1)):(a&&a.trigger("serverStart"),u=this.deltaClient.request(i?"AnalyticAPI.runBA":"AnalyticAPI.run",function(t,e){a&&a.trigger("serverEnd"),p.deltaClient.connection.removeResponder(u.uid);t=i?f.deserialize(e):t;n&&n(t,e)},function(t){p.deltaClient.connection.removeResponder(u.uid),f.Log.Error("Analytic run failed ("+e+")",t),o&&o(t)},e,c,i,r))},L.runApiFunction=function(i,t,e,n,o){var r=_.once(function(t,e){t?e&&n&&n(e):(f.Log.Error("Api Analytic run failed ("+i+")",e),o&&o(e)),clearTimeout(this.timeout)});this.timeout=_.delay(function(){r&&r(!1,"timed out")},this.DEFAULT_TIMEOUT),e=_.flatten([i,_.partial(r,!0,_),_.partial(r,!1,_),e]),this.deltaClient.request.apply(this.deltaClient,e)},L.servicesSync=function(t,e,i){throw"data operation not supported for Service"},L.servicesCollectionSync=function(t,e,i){if("read"!==t)throw"data operation not supported for Service Collection";L.deltaClient.request("ConnectionAPI.getServiceClasses",L.generateSuccessCallback(i),L.generateErrorCallback(i,"Error reading services data"))},L.setComponent=function(e,t,i,n,o,r){this.deltaClient.request("ComponentAPI.setComponent",function(t){f.Log.Info("Save component "+e+" successful",t),o(t)},function(t){f.Log.Error("Save Dashboard "+e+" FAILED"),r(t)},{name:e,displayName:t,description:i,dataJSON:n,class:"api.entity.ComponentEntity"})},L.startManagedAnalytic=function(t,e,i,n,o,r,s,a){L.startManagedAnalytic2(t,e,i,L.legacyRowCallback(n),o,r,s,a)},L.startManagedAnalytic2=function(i,n,t,e,o,r,s,a){var l=this,u=[],c=e||_.noop,p=s||null;this.createParamsObj(u,t=t||[]),a&&a.trigger("serverStart"),this.deltaClient.request(n?"AnalyticAPI.runBA":"AnalyticAPI.run",function(t,e){a&&a.trigger("serverEnd"),t=t||{},e&&e.byteLength&&(t=f.deserialize(e)),c(t,e),l.deltaClient.request("AnalyticAPI.startPolled",function(t,e){"com.fd.delta.stream.queryrouter.entity.QRResponseMessage"==t.class&&t.success?c({class:"207",add:!0,subId:t.runID,clientId:"polled"},void 0):o(t),L.getPolledSubscription(t.runID).subscribe(function(t){t.data[1]||o("Analytic Failed: "+t.data),a&&a.trigger("serverEnd"),t.appMsg&&t.appMsg.byteLength&&(t.data.class="209",t.data.subId=t.data[0],t.data.clientId="polled",t.data.dataSet=f.deserialize(t.appMsg)),c(t.data,t.appMsg)})},function(t){f.Log.Error("Managed Analytic run failed.",t),o&&o(t)},i,u,n,r,p)},function(t){f.Log.Error("Analytic run failed.",t),o&&o(t)},i,u,n,p)},L.startLegacyManagedQuery=function(t,e,i,n,o,r,s,a,l){L.startLegacyManagedQuery2(t,e,i,L.legacyRowCallback(n),o,r,s,a,l)},L.startLegacyManagedQuery2=function(t,e,i,n,o,r,s,a,l){var u,c,p=this,d=n||_.noop,n=[],s=s&&0!=s?Number(s):null,s=(a=!(a&&t&&_.includes(L.PAGING_TYPES,a.type))?{type:"NONE"}:a)&&"NONE"!==a.type?(u=new kdb.QDict,_.each(a.sorting,function(t,e){u.add(e,!0===t,kdb.KDB.BOOLEAN)}),kdb.KDBQuery.createPaged(this.strip(e),a.type,a.num,a.size,u)):kdb.KDBQuery.create(this.strip(e),s);i&&(this.createParamsObj(n,i),s.parameters=n),n=[t?"QueryAPI.runQueryBA":"QueryAPI.runQuery",function(t,e){t=t||{},l&&l.trigger("serverEnd"),e&&e.byteLength&&(t=f.deserialize(e)),d(t,e),p.deltaClient.request.apply(p.deltaClient.request,c)},function(){o&&o(arguments)},s,t],c=["SubscriptionAPI.addSubscription",function(t,e){d&&(e&&e.byteLength&&(t.dataSet=f.deserialize(e)),d(t,e))},function(t){o&&o(t)},s,t,r],l&&l.trigger("serverStart"),this.deltaClient.request.apply(this.deltaClient.request,n)},L.startManagedQuery=function(t,e,i,n,o,r,s,a,l){L.startManagedQuery2(t,e,i,L.legacyRowCallback(n),o,r,s,a,l)},L.startManagedQuery2=function(t,e,i,n,o,r,s,a,l){var u,c=n||_.noop,n=[],s=s&&0!=s?Number(s):null,s=(a=!(a&&t&&_.includes(L.PAGING_TYPES,a.type))?{type:"NONE"}:a)&&"NONE"!==a.type?(u=new kdb.QDict,_.each(a.sorting,function(t,e){u.add(e,!0===t,kdb.KDB.BOOLEAN)}),kdb.KDBQuery.createPaged(this.strip(e),a.type,a.num,a.size,u)):kdb.KDBQuery.create(this.strip(e),s);i&&(this.createParamsObj(n,i),s.parameters=n),l&&l.trigger("serverStart"),this.deltaClient.request("QueryAPI.startPolledQuery",function(t){"com.fd.delta.stream.queryrouter.entity.QRResponseMessage"==t.class&&t.success?c({class:"207",add:!0,subId:t.runID,clientId:"polled"},void 0):o(t),L.getPolledSubscription(t.runID).subscribe(function(t){return l&&l.trigger("serverEnd"),t.data[1]?(t.appMsg&&t.appMsg.byteLength&&(t.data.class="209",t.data.subId=t.data[0],t.data.clientId="polled",t.data.dataSet=f.deserialize(t.appMsg)),void c(t.data,t.appMsg)):o("Query Failed: "+t.data)})},function(){o&&o(arguments)},s,t,r)},L.startStreamingAnalytic=function(t,e,i,n,o,r){L.startStreamingAnalytic2(t,e,i,L.legacyRowCallback(n),o,r)},L.startStreamingAnalytic2=function(i,t,e,n,o,r){var s=[];this.createParamsObj(s,e||[]),r&&r.trigger("serverStart"),this.deltaClient.request("AnalyticAPI.startStreaming",function(t,e){r&&r.trigger("serverEnd"),e&&e.byteLength&&(t.dataSet=f.deserialize(e)),e&&10===e.byteLength&&101===new DataView(e).getInt8(8)?f.Log.Info("Streaming "+i+" returned unary primitive!"):n&&n(t,e)},function(t){f.Log.Info("Analytic run failed.",t),o&&o(t)},i,s,t)},L.strip=function(t){if(null==t||null==t||0==t.length)return t;t=t.replace(/((^|\s+)\/.*$)|^\s+|\s*\n/gm," ");var e=/^\{(.*)\}\s*\[\]\s*$/g.exec(t);return t=e?e[1]:t},L.removeSubscriptions=function(t){var i,n,o,e,r=this;t?(i=0==t.indexOf("polled:"),n=i?t.substr(7):t.split(":")[1],o=this.deltaClient.request(i?"QueryAPI.stopPolledQuery":"SubscriptionAPI.removeSubscription",function(t){var e;!i||-1!=(e=L.getPolledSubscription(n))&&e.unsubscribe(),r.deltaClient.connection.removeResponder(o.uid),f.Log.Info("Stop Subscriptions succeeded.",t)},function(t){r.deltaClient.connection.removeResponder(o.uid),f.Log.Error("Stop Subscriptions failed",t)},i?[n]:t),this.deltaClient.connection.removeResponder(n)):(e=this.deltaClient.request("SubscriptionAPI.removeSubscriptions",function(t){r.deltaClient.connection.removeResponder(e.uid),f.Log.Info("Stop Subscriptions succeeded.",t)},function(t){r.deltaClient.connection.removeResponder(e.uid),f.Log.Error("Stop Subscriptions failed",t)}),this.deltaClient.connection.oobupdate.filter(function(t){return"QRPolledMessage"===t.type}).unsubscribe())},L.updateTable=function(i,t,e){for(var n=this,o=[],r=0;r<3;r+=1)o[r]={type:"dict",value:{},index:r};_.each(i.updateParams,function(t){o.push(t)}),_.each(o,function(t,e){t.index=e}),_.each(i.addedDict.items,function(t,e){o[0].value[e]={type:n.updateTableGetListType(i.typeConfig[e],t),value:t}}),_.each(i.updatedDict.items,function(t,e){o[1].value[e]={type:n.updateTableGetListType(i.typeConfig[e],t),value:t}}),_.each(i.deletedDict.items,function(t,e){o[2].value[e]={type:n.updateTableGetListType(i.typeConfig[e],t),value:t}}),"analytic"===i.updateType?i.updateAnalytic&&n.runAnalytic(i.updateAnalytic,i.connection,o,t,e):n.getQueryData("kdb",i.connection,i.query,o,t,e)},L.updateTableGetListType=function(t,e){var i;switch(t){case 0:return i=_.isArray(e)?_.isBoolean(e[0])?"listlistboolean":_.isString(e[0])?"listliststring":"listlistsymbol":_.isString(e)?"string[]":"symbol[]";case 1:return"boolean[]";case 2:return"guid[]";case 4:return"byte[]";case 5:return"short[]";case 6:return"int[]";case 7:return"long[]";case 8:return"real[]";case 9:return"float[]";case 10:return i="char[]",_.each(e,function(t){1<t.length&&(i="string[]")}),i;case 11:return"symbol[]";case 12:return"timestamp[]";case 13:return"month[]";case 14:return"date[]";case 15:return"datetime[]";case 16:return"timespan[]";case 17:return"minute[]";case 18:return"second[]";case 19:return"time[]";default:return"symbol[]"}},L.createDeltaObj=function(i){function n(t){return _.has(t,"i")||"string"!=typeof t?t:(10<(t=t.replace("D","T").replace(/(\d\d\d\d)\.(\d\d)\.(\d\d)/,"$1-$2-$3")).length&&(t+="Z"),f.Tools.convertISODatetimeToKDBLikeObject(t))}var o,r,s,e;switch(i.type.toLowerCase()){case"boolean":(o=new kdb.QBoolean).setValue("string"==typeof i.value?"1b"==i.value:i.value);break;case"guid":o=new kdb.QGUID,e="string"==typeof i.value?i.value.match(/"G"\$"(.+)"$/):i.value,o.value=e?e[1]:"0Ng"==i.value?null:i.value;break;case"symbol":o=new kdb.QSymbol,e="string"==typeof i.value?i.value.match(/`\$"(.*)"$/):i.value,o.value=e?e[1]:i.value;break;case"byte":(o=new kdb.QByte).value="string"==typeof i.value?parseInt(i.value):i.value;break;case"short":(o=new kdb.QShort).value=parseInt(i.value,10);break;case"int":case"integer":(o=new kdb.QInt).value=parseInt(i.value,10);break;case"long":(o=new kdb.QLong).value="number"==typeof i.value?i.value:parseInt(i.value,10);break;case"real":(o=new kdb.QReal).value=parseFloat(i.value);break;case"float":case"double":(o=new kdb.QFloat).value=parseFloat(i.value);break;case"char":(o=new kdb.QChar).setValue(i.value);break;case"timestamp":o=new kdb.QTimeStamp,null!==i.value&&(s=n(i.value),o.setValue(s.i),s&&s.n&&(o.nanoValue=s.n));break;case"month":o=new kdb.QMonth,null!==i.value&&o.setValue(_.has(i.value,"i")?i.value.i:i.value);break;case"date":o=new kdb.QDate,null!==i.value&&o.setValue(n(i.value).i);break;case"datetime":o=new kdb.QDateTime,null!==i.value&&o.setValue(n(i.value).i);break;case"timespan":(o=new kdb.QTimeSpan).setValue(i.value);break;case"minute":(o=new kdb.QMinute).setValue(_.has(i.value,"i")?i.value.i:i.value);break;case"second":(o=new kdb.QSecond).setValue(_.has(i.value,"i")?i.value.i:i.value);break;case"time":(o=new kdb.QTime).setValue(_.has(i.value,"i")?i.value.i:i.value);break;case"string":(o=new kdb.QString).setValue(i.value);break;case"string[]":o=new kdb.QList,r=[],_.each(i.value,function(t){(s=new kdb.QString).setValue(t),r.push(s)}),o.value=r;break;case"symbol[]":case"liststring":case"list":o=new kdb.QList,r=[],"string"==typeof i.value&&(e=i.value.match(/^\((.+)\)$/),i.value=e?e[1].split(";"):[i.value]),_.each(i.value,function(t){e="string"==typeof t?/`\$"(.*)"$/.exec(t):null,(s=new kdb.QSymbol).setValue(e?e[1]:t),r.push(s)}),o.value=r;break;case"listobject":o=new kdb.QList,r=[],_.each(i.value,_.bind(function(t){_.isEmpty(t)||(t=this.createDeltaObj(t),r.push(t))},this)),o.value=r;break;case"listlistsymbol":(o=new kdb.QList).value=_.map(i.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QSymbol;return e.setValue(t),e}),e});break;case"listlistboolean":(o=new kdb.QList).value=_.map(i.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QBoolean;return e.setValue(t),e}),e});break;case"listliststring":(o=new kdb.QList).value=_.map(i.value,function(t){var e=new kdb.QList;return e.value=_.map(t,function(t){var e=new kdb.QString;return e.setValue(t),e}),e});break;case"listlong":o=new kdb.QList,r=[],_.each(i.value,function(t){(s=new kdb.QLong).setValue(t),r.push(s)}),o.value=r;break;case"listtimestamp":o=new kdb.QList,r=[],_.each(i.value,function(t){var e=new kdb.QTimeStamp;null===t?e.setValue("0Np"):(s=n(t),e.setValue(s.i),s&&s.n&&(e.nanoValue=s.n)),r.push(e)}),o.value=r;break;case"dict":o=new kdb.QDict,_.each(i.value,_.bind(function(t,e){var i=t;_.isString(t)&&(i={type:"symbol",value:t}),i=this.createDeltaObj(i),o.values.push(i),o.fields.push(e)},this));break;case"table":o=new kdb.QFlip,_.each(i.value.columns,function(t,e){o.fields.push(t),o.values.push(this.createDeltaObj({type:i.value.types[e]+"[]",value:i.value.values[e]}))}.bind(this));break;case"nulltype":o=new kdb.QDict;break;case"listdate":o=new kdb.QList,r=[],_.each(i.value,function(t){var e=new kdb.QDate;null===t?e.setValue("0Nd"):e.setValue(n(t).i),r.push(e)}),o.value=r;break;default:-1<i.type.toLowerCase().indexOf("[]")&&(o=new kdb.QList,r=[],_.each(i.value,_.bind(function(t,e){r.push(this.createDeltaObj({type:i.type.toLowerCase().replace("[]",""),value:t,index:e}))},this)),o.value=r)}return o.orderIndex=i.index,o},L.createParamsObj=function(e,t){var i,n=0;t.attributes?i=t.attributes:t&&(i=t),i&&(_.each(i,_.bind(function(t){t.type&&"t"!==t.type&&("symbol[]"===t.type&&(t.type="list"),e[n]=this.createDeltaObj(t),n+=1)},this)),e.sort(function(t,e){return t.orderIndex-e.orderIndex}))},L.createSqlParamsObj=function(e,t){var n,o,r,i,s,a=0;t.attributes?i=t.attributes:t&&(i=t),s=function(t){var i;switch(t.type.toLowerCase()){case"boolean":(i=new kdb.SQLBoolean).value=t.value;break;case"guid":case"symbol":(i=new kdb.SQLVarChar).value=t.value;break;case"byte":(i=new kdb.SQLByte).value=t.value;break;case"short":(i=new kdb.SQLShort).value=t.value;break;case"int":case"integer":(i=new kdb.SQLInt).value=parseInt(t.value,10);break;case"long":(i=new kdb.SQLLong).value=t.value;break;case"real":(i=new kdb.SQLFloat).value=t.value;break;case"float":(i=new kdb.SQLFloat).value=parseFloat(t.value);break;case"double":(i=new kdb.SQLDouble).setValue(t.value);break;case"char":(i=new kdb.SQLVarChar).value=t.value;break;case"timestamp":(i=new kdb.SQLTime).setValue(t.value);break;case"month":(i=new kdb.SQLInt).setValue(t.value);break;case"date":case"datetime":(i=new kdb.SQLTime).setValue(new Date(t.value));break;case"timespan":(i=new kdb.SQLTime).setValue(t.value);break;case"minute":case"second":(i=new kdb.SQLInt).setValue(t.value);break;case"time":(i=new kdb.SQLTime).setValue(t.value);break;case"string":i=new kdb.SQLList,r=t.value.split(""),n=[],_.each(r,function(t){(o=new kdb.SQLVarChar).value=t,n.push(o)}),i.value=n;break;case"list":i=new kdb.SQLList,n=[],_.each(t.value,function(t){(o=new kdb.SQLVarChar).setValue(t),n.push(o)}),i.value=n;break;case"symbol[]":i=new kdb.SQLList,n=[],_.each(t.value,function(t){(o=new kdb.SQLVarChar).setValue(t),n.push(o)}),i.value=n;break;case"listtimestamp":i=new kdb.SQLList,n=[],_.each(t.value,function(t){(o=new kdb.SQLTime).setValue(t),n.push(o)}),i.value=n;break;case"dict":i=new kdb.SQLDict,_.each(t.value,function(t,e){t=s(t);i.values.push(t),i.fields.push(e)});break;case"nulltype":i=new kdb.SQLDict}return i.orderIndex=t.index,i.setName(t.name),i},i&&(_.each(i,function(t){t.type&&"t"!==t.type&&("symbol[]"===t.type&&(t.type="list"),e[a]=s(t),a+=1)}),e.sort(function(t,e){return t.orderIndex-e.orderIndex}))},L.parameterRx=new RegExp("<%([^<>%]+?)%>","g"),L.DEFAULT_NULL_VAL=-0x8000000000000000,L.PAGING_TYPES=["OFFSET","OFFSET_NOCACHE","PAGENO","PAGENO_NOCACHE"],f.DeltaClientLib=L,b=zt=zt||{},V.clearAll=function(t){t?$("body .field-error").fadeOut():$("body .field-error").remove()},V.clear=function(t,e){t&&(e?t.fadeOut():t.remove())},V.show=function(t,e,i){if(t&&e)return(t=$("<div/>",{text:t}).addClass("field-error").appendTo("body")).position({of:$(e),my:i?"right center":"left center",at:i?"left center":"right center",collision:"flip fit",using:function(t,e){"right"===e.horizontal?$(this).addClass("error-left-side"):$(this).removeClass("error-left-side"),$(this).css({left:t.left+"px",top:t.top+"px"})}}),t},b.ErrorTooltip=V,K=zt=zt||{},c=m.View,C(B,c),B.prototype.remove=function(){return m.View.prototype.remove.call(this)},B.prototype.renderTemplate=function(t){try{var e=!this.anchorEl||this.anchorEl.offsetWidth&&this.anchorEl.offsetHeight;this.el.style.display=e?"":"none",e&&(this.el.innerHTML="<div>"+this.templateFn(_.extend({},this.data,t))+"</div>",this.updatePosition(this.position))}catch(t){console.log(this.cssClass+" handlebars render error.",t)}},B.prototype.updateCSS=function(t){return this.$el.css(_.reduce(t,function(t,e,i){return t[i]=e,t},{})),this},B.prototype.updatePosition=function(t){var i,n=this;return this.anchorEl&&(i=this.anchorEl.getBoundingClientRect()),this.updateCSS(_.mapValues(_.pickBy(t,function(t){return!_.isNil(t)}),function(t,e){t=Math.max(0,t);return t+=i?i[e]:0,("left"===e||"right"===e)&&$(window).width()<t+n.$el.outerWidth()?t=$(window).width()-n.$el.outerWidth():("top"===e||"bottom"===e)&&$(window).height()<t+n.$el.outerHeight()&&(t=$(window).height()-n.$el.outerHeight()),t+"px"}))},B.prototype.updateTooltip=function(t){var i=this;return _.each(t,function(t,e){i[e]=t}),this},B.prototype.compileTemplate=function(){try{this.templateFn=s.compile(this.text)}catch(t){console.log(this.cssClass+" handlebars compile error.",t)}},B.directions=["left","right","top","bottom"],K.GenericTooltip=B,d=zt=zt||{},O.convertRollingToDate=function(t,e){var i,n,o,r=d.Tools.convertValueToMoment(null,e);if(t=t||"NOW","duration"===d.Tools.getTypeCategory(e)&&(r=d.Tools.convertValueToDuration(r.formatNano("HH:mm:ss.SSS"),e)),"T"===t)_.includes(["date","datetime","timestamp"],e)&&r.set({hour:0,minute:0,second:0,millisecond:0});else if(t.toString().match(d.RTTI.REGEX_ROLLING)){if((n=t.toString().match(/^T([\+|\-]\d+)/))&&(i=parseInt(n[1],10)))switch(e){case"date":case"datetime":case"timestamp":r.set({hour:0,minute:0,second:0,millisecond:0}),r.add(i,"days");break;case"time":case"minute":r.add(i,"minutes");break;case"second":r.add(i,"seconds")}(n=t.toString().match(/(?:@)(.+)$/))&&(o=d.Tools.convertUserInputToMoment(n[1],"HH:mm:ss.SSS")).isValid()&&!y.isDuration(r)&&(r.set({hour:o.hour(),minute:o.minute(),second:o.second(),millisecond:o.millisecond()}),o.nanosecond()&&r.nanosecond(o.nanosecond()))}return r.toDashString()},O.convertViewSchemaToBackbone=function(e){var i=this,n={};return _.each(_.keys(e),function(t){_.isObject(e[t])?n[t]=i.convertViewSchemaToBackbone(e[t]):n[t]=e[t]}),m.Model.extend({defaults:function(){var e={};return _.each(_.keys(n),function(t){"function"==typeof n[t]?e[t]=new n[t]:e[t]=n[t]}),e}})},O.getGUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},O.preventBackspaceBack=function(){$(document).on("keydown",function(t){var e,i=!1;(i=8===t.which?!("INPUT"===(e=t.srcElement||t.target).tagName.toUpperCase()&&!_.includes(["RADIO","CHECKBOX"],e.type.toUpperCase())||"TEXTAREA"===e.tagName.toUpperCase()||$(e).hasClass("nicEdit-main"))||(e.readOnly||e.disabled):i)&&t.preventDefault()})},O.validateGuid=function(t){return!!_.isString(t)&&t.match(/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i)},d.Helpers=O,(h=zt=zt||{}).InitializeQuickbase=function(i){var n=$.cookie("dashboard-language")||"en";require.config({paths:{cldr:"./locale/cldr","cldr-data":"./locale/cldr-data",globalize:"./locale/globalize",locales:"./locale/locales"}}),require(["json!locales/messages.json"],function(t){var e=t[n||"en"]||{},t=function(t){return e[t]||t||""};window.t=t,s.registerHelper("moment",function(t,e,i){if(null!=t||!e){if(null==t&&null==e)return y.locale("en"),y().format("MMMM DD, YYYY");var n={lang:"en",date:new Date},n=_.extend({},n,t,e,i);if(n=_.extend({},n,n.hash),y.locale(n.lang),"string"==typeof t&&"string"==typeof e)return y(t).format(e);if(h.Tools.isKDBTemporal(t)){i=h.Tools.convertKDBTemporalToMoment(t);return y.isDuration(i)?i.formatNano(e):i.format(e)}if(n.hash){n.context&&_.extend(n.hash,n.context);var o,r=y(t);for(o in n.hash){if(r[o])return r[o](n.hash[o]);console.log('moment.js does not support "'+o+'"')}}return"object"==typeof t||"string"!=typeof t||e?y(t).format(e):y().format(t)}}),s.registerHelper("t",t),s.registerHelper("typeOf",function(t){function e(t){return t.constructor?t.constructor.name:null}var i=Object.prototype.toString;if(void 0===t)return"undefined";if(null===t)return"null";var n,o=typeof t;if("boolean"===o)return"boolean";if("string"===o)return"string";if("number"===o)return"number";if("symbol"===o)return"symbol";if("function"===o)return"GeneratorFunction"===e(t)?"generatorfunction":"function";if(h.Tools.isKDBTemporal(t))return h.Tools.Types.kdbToDashboard[t.class];if(_.isArray(t))return"array";if(_.isBuffer(t))return"buffer";if(_.isArguments(t))return"arguments";if(_.isDate(t))return"date";if(_.isError(t))return"error";if(_.isRegExp(t))return"regexp";switch(e(t)){case"Symbol":return"symbol";case"Promise":return"promise";case"WeakMap":return"weakmap";case"WeakSet":return"weakset";case"Map":return"map";case"Set":return"set";case"Int8Array":return"int8array";case"Uint8Array":return"uint8array";case"Uint8ClampedArray":return"uint8clampedarray";case"Int16Array":return"int16array";case"Uint16Array":return"uint16array";case"Int32Array":return"int32array";case"Uint32Array":return"uint32array";case"Float32Array":return"float32array";case"Float64Array":return"float64array"}if("function"==typeof(n=t).throw&&"function"==typeof n.return&&"function"==typeof n.next)return"generator";switch(o=i.call(t)){case"[object Object]":return"object";case"[object Map Iterator]":return"mapiterator";case"[object Set Iterator]":return"setiterator";case"[object String Iterator]":return"stringiterator";case"[object Array Iterator]":return"arrayiterator"}return o.slice(8,-1).toLowerCase().replace(/\s/g,"")}),s.registerHelper("isNull",function(t,e){return!0!==e&&_.isString(t)?0===t.length:_.isNull(t)}),s.registerHelper("encodeURI",function(t){return null==t?"":encodeURI(t)}),s.registerHelper("encodeURIComponent",function(t){return null==t?"":encodeURIComponent(t)}),s.registerHelper("toISOString",function(t){return h.Tools.convertKDBToViewstateValue(t)}),_.isFunction(i)&&i({globalize:void 0,language:n})})},function(t){var e=(i.prototype.toDate=function(){return t.Tools.convertKDBTemporalToMoment(this)},i.prototype.toString=function(){return this.toDate().formatNano("YYYY-MM-DD HH:mm:ss.SSSSSSSSS")},i);function i(t,e){this.i=t,this.n=e}t.rTimestampClass=e;var n=(o.prototype.toDate=function(){return t.Tools.convertKDBTemporalToMoment(this)},o.prototype.toString=function(){return"number"!=typeof this.i||isNaN(this.i)?"":this.i===Number.POSITIVE_INFINITY?"Infinity":this.i===Number.NEGATIVE_INFINITY?"-Infinity":this.toDate().format("YYYY-MM")},o);function o(t){this.i=t}t.rMonthClass=n;var r=(s.prototype.toDate=function(){return t.Tools.convertKDBTemporalToMoment(this)},s.prototype.toString=function(){return"number"!=typeof this.i||isNaN(this.i)?"":this.i===Number.POSITIVE_INFINITY?"Infinity":this.i===Number.NEGATIVE_INFINITY?"-Infinity":y(new Date(this.i)).utcOffset(0).format("YYYY-MM-DD")},s);function s(t,e){this.i=t,this.n=e}t.rDateClass=r;var a=(l.prototype.toDate=function(){return t.Tools.convertKDBTemporalToMoment(this)},l.prototype.toString=function(){return this.toDate().format("YYYY-MM-DD HH:mm:ss.SSS")},l);function l(t){this.i=t}t.rDateTimeClass=a;var u=(c.prototype.toDate=function(){return t.Tools.convertKDBTemporalToMoment(this)},c.prototype.toString=function(){return this.toDate().formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1})},c);function c(t){this.i=t}t.rTimespanClass=u;var p=(d.prototype.toDate=function(){return t.Tools.convertKDBTemporalToMoment(this)},d.prototype.toString=function(){return this.toDate().format("HH:mm",{trim:!1})},d);function d(t){this.i=t,this.n=0}t.rMinuteClass=p;var h=(g.prototype.toDate=function(){return t.Tools.convertKDBTemporalToMoment(this)},g.prototype.toString=function(){return this.toDate().format("HH:mm:ss",{trim:!1})},g);function g(t){this.i=t}t.rSecondClass=h;var f=(m.prototype.toDate=function(){return t.Tools.convertKDBTemporalToMoment(this)},m.prototype.toString=function(){return this.toDate().format("HH:mm:ss.SSS",{trim:!1})},m);function m(t){this.i=t}t.rTimeClass=f,e.prototype.class="1212",n.prototype.class="1213",r.prototype.class="1214",a.prototype.class="1215",u.prototype.class="1216",p.prototype.class="1217",h.prototype.class="1218",f.prototype.class="1219"}(zt=zt||{}),function(t){var e=(d.isLong=function(t){return!0===(t&&t.__isLong__)},d.fromInt=function(t,e){var i,n,o;return e?(o=0<=(t>>>=0)&&t<256)&&(n=d.UINT_CACHE[t])?n:(i=d.fromBits(t,(0|t)<0?-1:0,!0),o&&(d.UINT_CACHE[t]=i),i):(o=-128<=(t|=0)&&t<128)&&(n=d.INT_CACHE[t])?n:(i=d.fromBits(t,t<0?-1:0,!1),o&&(d.INT_CACHE[t]=i),i)},d.fromNumber=function(t,e){if(isNaN(t))return e?d.UZERO:d.ZERO;if(e){if(t<0)return d.UZERO;if(d.TWO_PWR_64_DBL<=t)return d.MAX_UNSIGNED_VALUE}else{if(t<=-d.TWO_PWR_63_DBL)return d.MIN_VALUE;if(d.TWO_PWR_63_DBL<=t+1)return d.MAX_VALUE}return t<0?d.fromNumber(-t,e).neg():d.fromBits(t%d.TWO_PWR_32_DBL|0,t/d.TWO_PWR_32_DBL|0,e)},d.fromBits=function(t,e,i){return new d(t,e,i)},d.fromString=function(t,e,i){if(0===t.length)throw Error("empty string");if("NaN"===t||"Infinity"===t||"+Infinity"===t||"-Infinity"===t)return d.ZERO;if(e="number"==typeof e?(i=e,!1):!!e,(i=i||10)<2||36<i)throw RangeError("radix");var n;if(0<(n=t.indexOf("-")))throw Error("interior hyphen");if(0===n)return d.fromString(t.substring(1),e,i).neg();for(var o=d.fromNumber(Math.pow(i,8)),r=d.ZERO,s=0;s<t.length;s+=8){var a=Math.min(8,t.length-s),l=parseInt(t.substring(s,s+a),i);r=a<8?(a=d.fromNumber(Math.pow(i,a)),r.mul(a).add(d.fromNumber(l))):(r=r.mul(o)).add(d.fromNumber(l))}return r.unsigned=e,r},d.fromValue=function(t,e){return"number"==typeof t?d.fromNumber(t,e):"string"==typeof t?d.fromString(t,e):d.fromBits(t.low,t.high,"boolean"==typeof e?e:t.unsigned)},d.prototype.toInt=function(){return this.unsigned?this.low>>>0:this.low},d.prototype.toNumber=function(){return this.unsigned?(this.high>>>0)*d.TWO_PWR_32_DBL+(this.low>>>0):this.high*d.TWO_PWR_32_DBL+(this.low>>>0)},d.prototype.toString=function(t){if((t=t||10)<2||36<t)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(d.MIN_VALUE)){var e=d.fromNumber(t),i=this.div(e),e=i.mul(e).sub(this);return i.toString(t)+e.toInt().toString(t)}return"-"+this.neg().toString(t)}for(var n=d.fromNumber(Math.pow(t,6),this.unsigned),o=this,r="";;){var s=o.div(n),a=(o.sub(s.mul(n)).toInt()>>>0).toString(t);if((o=s).isZero())return a+r;for(;a.length<6;)a="0"+a;r=""+a+r}},d.prototype.getHighBits=function(){return this.high},d.prototype.getHighBitsUnsigned=function(){return this.high>>>0},d.prototype.getLowBits=function(){return this.low},d.prototype.getLowBitsUnsigned=function(){return this.low>>>0},d.prototype.getNumBitsAbs=function(){if(this.isNegative())return this.eq(d.MIN_VALUE)?64:this.neg().getNumBitsAbs();for(var t=0!=this.high?this.high:this.low,e=31;0<e&&0==(t&1<<e);e--);return 0!=this.high?e+33:e+1},d.prototype.isZero=function(){return 0===this.high&&0===this.low},d.prototype.isNegative=function(){return!this.unsigned&&this.high<0},d.prototype.isPositive=function(){return this.unsigned||0<=this.high},d.prototype.isOdd=function(){return 1==(1&this.low)},d.prototype.isEven=function(){return 0==(1&this.low)},d.prototype.equals=function(t){return d.isLong(t)||(t=d.fromValue(t)),(this.unsigned===t.unsigned||this.high>>>31!=1||t.high>>>31!=1)&&(this.high===t.high&&this.low===t.low)},d.prototype.notEquals=function(t){return!this.eq(t)},d.prototype.lessThan=function(t){return this.comp(t)<0},d.prototype.lessThanOrEqual=function(t){return this.comp(t)<=0},d.prototype.greaterThan=function(t){return 0<this.comp(t)},d.prototype.greaterThanOrEqual=function(t){return 0<=this.comp(t)},d.prototype.compare=function(t){if(d.isLong(t)||(t=d.fromValue(t)),this.eq(t))return 0;var e=this.isNegative(),i=t.isNegative();return e&&!i?-1:!e&&i?1:this.unsigned?t.high>>>0>this.high>>>0||t.high===this.high&&t.low>>>0>this.low>>>0?-1:1:this.sub(t).isNegative()?-1:1},d.prototype.negate=function(){return!this.unsigned&&this.eq(d.MIN_VALUE)?d.MIN_VALUE:this.not().add(d.ONE)},d.prototype.add=function(t){d.isLong(t)||(t=d.fromValue(t));var e=this.high>>>16,i=65535&this.high,n=this.low>>>16,o=65535&this.low,r=t.high>>>16,s=65535&t.high,a=t.low>>>16,l=0,u=0,c=0,p=0;return c+=(p+=o+(65535&t.low))>>>16,u+=(c+=n+a)>>>16,l+=(u+=i+s)>>>16,l+=e+r,d.fromBits((c&=65535)<<16|(p&=65535),(l&=65535)<<16|(u&=65535),this.unsigned)},d.prototype.subtract=function(t){return d.isLong(t)||(t=d.fromValue(t)),this.add(t.neg())},d.prototype.multiply=function(t){if(this.isZero())return d.ZERO;if(d.isLong(t)||(t=d.fromValue(t)),d.wasm){var e=d.wasm.mul(this.low,this.high,t.low,t.high);return d.fromBits(e,d.wasm.get_high(),this.unsigned)}if(t.isZero())return d.ZERO;if(this.eq(d.MIN_VALUE))return t.isOdd()?d.MIN_VALUE:d.ZERO;if(t.eq(d.MIN_VALUE))return this.isOdd()?d.MIN_VALUE:d.ZERO;if(this.isNegative())return t.isNegative()?this.neg().mul(t.neg()):this.neg().mul(t).neg();if(t.isNegative())return this.mul(t.neg()).neg();if(this.lt(d.TWO_PWR_24)&&t.lt(d.TWO_PWR_24))return d.fromNumber(this.toNumber()*t.toNumber(),this.unsigned);var i=this.high>>>16,n=65535&this.high,o=this.low>>>16,r=65535&this.low,s=t.high>>>16,a=65535&t.high,l=t.low>>>16,u=65535&t.low,c=0,p=0,e=0,t=0;return e+=(t+=r*u)>>>16,p+=(e+=o*u)>>>16,e&=65535,p+=(e+=r*l)>>>16,c+=(p+=n*u)>>>16,p&=65535,c+=(p+=o*l)>>>16,p&=65535,c+=(p+=r*a)>>>16,c+=i*u+n*l+o*a+r*s,d.fromBits((e&=65535)<<16|(t&=65535),(c&=65535)<<16|(p&=65535),this.unsigned)},d.prototype.divide=function(t){if((t=!d.isLong(t)?d.fromValue(t):t).isZero())throw Error("division by zero");if(d.wasm){if(!this.unsigned&&-2147483648===this.high&&-1===t.low&&-1===t.high)return this;var e=(this.unsigned?d.wasm.div_u:d.wasm.div_s)(this.low,this.high,t.low,t.high);return d.fromBits(e,d.wasm.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?d.UZERO:d.ZERO;var i,n,o;if(this.unsigned){if((t=!t.unsigned?t.toUnsigned():t).gt(this))return d.UZERO;if(t.gt(this.shru(1)))return d.UONE;n=d.UZERO}else{if(this.eq(d.MIN_VALUE))return t.eq(d.ONE)||t.eq(d.NEG_ONE)?d.MIN_VALUE:t.eq(d.MIN_VALUE)?d.ONE:(o=this.shr(1).div(t).shl(1)).eq(d.ZERO)?t.isNegative()?d.ONE:d.NEG_ONE:(i=this.sub(t.mul(o)),n=o.add(i.div(t)));else if(t.eq(d.MIN_VALUE))return this.unsigned?d.UZERO:d.ZERO;if(this.isNegative())return t.isNegative()?this.neg().div(t.neg()):this.neg().div(t).neg();if(t.isNegative())return this.div(t.neg()).neg();n=d.ZERO}for(i=this;i.gte(t);){o=Math.max(1,Math.floor(i.toNumber()/t.toNumber()));for(var r=Math.ceil(Math.log(o)/Math.LN2),s=r<=48?1:Math.pow(2,r-48),a=d.fromNumber(o),l=a.mul(t);l.isNegative()||l.gt(i);)l=(a=d.fromNumber(o-=s,this.unsigned)).mul(t);a.isZero()&&(a=d.ONE),n=n.add(a),i=i.sub(l)}return n},d.prototype.modulo=function(t){if(d.isLong(t)||(t=d.fromValue(t)),d.wasm){var e=(this.unsigned?d.wasm.rem_u:d.wasm.rem_s)(this.low,this.high,t.low,t.high);return d.fromBits(e,d.wasm.get_high(),this.unsigned)}return this.sub(this.div(t).mul(t))},d.prototype.not=function(){return d.fromBits(~this.low,~this.high,this.unsigned)},d.prototype.and=function(t){return d.isLong(t)||(t=d.fromValue(t)),d.fromBits(this.low&t.low,this.high&t.high,this.unsigned)},d.prototype.or=function(t){return d.isLong(t)||(t=d.fromValue(t)),d.fromBits(this.low|t.low,this.high|t.high,this.unsigned)},d.prototype.xor=function(t){return d.isLong(t)||(t=d.fromValue(t)),d.fromBits(this.low^t.low,this.high^t.high,this.unsigned)},d.prototype.shiftLeft=function(t){return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d.fromBits(this.low<<t,this.high<<t|this.low>>>32-t,this.unsigned):d.fromBits(0,this.low<<t-32,this.unsigned)},d.prototype.shiftRight=function(t){return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d.fromBits(this.low>>>t|this.high<<32-t,this.high>>t,this.unsigned):d.fromBits(this.high>>t-32,0<=this.high?0:-1,this.unsigned)},d.prototype.shiftRightUnsigned=function(t){return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:t<32?d.fromBits(this.low>>>t|this.high<<32-t,this.high>>>t,this.unsigned):d.fromBits(32===t?this.high:this.high>>>t-32,0,this.unsigned)},d.prototype.rotateLeft=function(t){var e;return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?d.fromBits(this.high,this.low,this.unsigned):t<32?d.fromBits(this.low<<t|this.high>>>(e=32-t),this.high<<t|this.low>>>e,this.unsigned):d.fromBits(this.high<<(t-=32)|this.low>>>(e=32-t),this.low<<t|this.high>>>e,this.unsigned)},d.prototype.rotateRight=function(t){var e;return d.isLong(t)&&(t=t.toInt()),0==(t&=63)?this:32===t?d.fromBits(this.high,this.low,this.unsigned):t<32?d.fromBits(this.high<<(e=32-t)|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned):d.fromBits(this.low<<(e=32-(t-=32))|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)},d.prototype.toSigned=function(){return this.unsigned?d.fromBits(this.low,this.high,!1):this},d.prototype.toUnsigned=function(){return this.unsigned?this:d.fromBits(this.low,this.high,!0)},d.prototype.toBytes=function(t){return t?this.toBytesLE():this.toBytesBE()},d.prototype.toBytesLE=function(){var t=this.high,e=this.low;return[255&e,e>>>8&255,e>>>16&255,e>>>24,255&t,t>>>8&255,t>>>16&255,t>>>24]},d.prototype.toBytesBE=function(){var t=this.high,e=this.low;return[t>>>24,t>>>16&255,t>>>8&255,255&t,e>>>24,e>>>16&255,e>>>8&255,255&e]},d.fromBytes=function(t,e,i){return i?d.fromBytesLE(t,e):d.fromBytesBE(t,e)},d.fromBytesLE=function(t,e){return new d(t[0]|t[1]<<8|t[2]<<16|t[3]<<24,t[4]|t[5]<<8|t[6]<<16|t[7]<<24,e)},d.fromBytesBE=function(t,e){return new d(t[4]<<24|t[5]<<16|t[6]<<8|t[7],t[0]<<24|t[1]<<16|t[2]<<8|t[3],e)},d.wasm=null,d.INT_CACHE={},d.UINT_CACHE={},d.TWO_PWR_16_DBL=65536,d.TWO_PWR_24_DBL=1<<24,d.TWO_PWR_63_DBL=(d.TWO_PWR_64_DBL=(d.TWO_PWR_32_DBL=d.TWO_PWR_16_DBL*d.TWO_PWR_16_DBL)*d.TWO_PWR_32_DBL)/2,d.TWO_PWR_24=d.fromInt(d.TWO_PWR_24_DBL),d.ZERO=d.fromInt(0),d.UZERO=d.fromInt(0,!0),d.ONE=d.fromInt(1),d.UONE=d.fromInt(1,!0),d.NEG_ONE=d.fromInt(-1),d.MAX_VALUE=d.fromBits(-1,2147483647,!1),d.MAX_UNSIGNED_VALUE=d.fromBits(-1,-1,!0),d.MIN_VALUE=d.fromBits(0,-2147483648,!1),d);function d(t,e,i){this.eqz=this.isZero.bind(this),this.eq=this.equals.bind(this),this.neq=this.notEquals.bind(this),this.ne=this.notEquals.bind(this),this.lt=this.lessThan.bind(this),this.lte=this.lessThanOrEqual.bind(this),this.le=this.lessThanOrEqual.bind(this),this.gt=this.greaterThan.bind(this),this.gte=this.greaterThanOrEqual.bind(this),this.ge=this.greaterThanOrEqual.bind(this),this.comp=this.compare.bind(this),this.neg=this.negate.bind(this),this.sub=this.subtract.bind(this),this.mul=this.multiply.bind(this),this.div=this.divide.bind(this),this.mod=this.modulo.bind(this),this.rem=this.modulo.bind(this),this.shl=this.shiftLeft.bind(this),this.shr=this.shiftRight.bind(this),this.shru=this.shiftRightUnsigned.bind(this),this.shr_u=this.shiftRightUnsigned.bind(this),this.rotl=this.rotateLeft.bind(this),this.rotr=this.rotateRight.bind(this),this.low=0|t,this.high=0|e,this.unsigned=!!i}t.Long=e,Object.defineProperty(e.prototype,"__isLong__",{value:!0});try{e.wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(t){}}(zt=zt||{}),function(e){e.fromString=function(t,e){return _.isString(e)&&t.fromString?t.fromString(e):e},(t=e.TypeNum||(e.TypeNum={}))[t.List=0]="List",t[t.Bool=1]="Bool",t[t.Guid=2]="Guid",t[t.Byte=4]="Byte",t[t.Short=5]="Short",t[t.Int=6]="Int",t[t.Long=7]="Long",t[t.Float=8]="Float",t[t.Double=9]="Double",t[t.Char=10]="Char",t[t.Symbol=11]="Symbol",t[t.Timestamp=12]="Timestamp",t[t.Month=13]="Month",t[t.Date=14]="Date",t[t.DateTime=15]="DateTime",t[t.Timespan=16]="Timespan",t[t.Minute=17]="Minute",t[t.Second=18]="Second",t[t.Time=19]="Time",t[t.Table=98]="Table",t[t.Dict=99]="Dict",t[t.Unary=101]="Unary";var t=(i.prototype.isAligned=function(){return!0},i.prototype.isTemporal=function(){return this.qtype<=12&&this.qtype<=19},i.prototype.toLegacy=function(t){return this.getValue(t)},i.prototype.toViewState=function(t){return{_type:e.Parse.TYPE_NAMES[Math.abs(this.qtype)],value:g.Tools.convertKDBToViewstateValue(this.toLegacy(t))}},i);function i(t,e,i,n){this.length=t,this.offset=e,this.qtype=i,this.dataView=n}e.TypeBase=t}((g=zt=zt||{}).ipc||(g.ipc={})),function(n){var t,r;function e(t,e,i,n,o){n=r.call(this,t,e,i,n)||this;return n.indexOffset=0,n.index=null,n.rangeCache=null,n.SIZE=o,n.bufferLength=t,n}t=n.ipc||(n.ipc={}),r=t.TypeBase,C(e,r),e.prototype.getRange=function(){return this.index&&0!==this.index.length?[this.hash(this.index[0]),this.hash(this.index[this.index.length-1])]:this.rangeCache||(this.rangeCache=this.calcRange())},e.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";this.resetRangeCache(),new Uint8Array(this.dataView.buffer,this.offset,t.length*this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset,t.length*this.SIZE))},e.prototype.checkIndex=function(){for(var t=1;t<this.index.length;t++)if(this.hash(this.index[t-1])>this.hash(this.index[t]))return!0;return!1},e.prototype.hasIndex=function(){return!!this.index},e.prototype.getIndexFromSortedIndex=function(t){return(this.length+this.index[t]-this.indexOffset)%this.length},e.prototype.getScalarFromSortedIndex=function(t){return t=(this.indexOffset+t)%this.length,8===this.SIZE&&n.Tools.isIE11&&-1!==[9,15].indexOf(this.qtype)?this.getLegacyScalar(this.index[t]):this.getScalar(this.index[t])},e.prototype.findIndex=function(t){var i=this,e=8!==this.SIZE||-1!==[9,15].indexOf(this.qtype)?function(t,e){return t-i.hash(e)}:n.Tools.isIE11?function(t,e){return t.compare(i.hash(e))}:function(t,e){return Number(t-i.hash(e))};return n.Tools.binarySearch2(t,this.index,e)},e.prototype.mergeKeyedPrimary=function(t,e,i){this.resetRangeCache(),this.hasIndex()||this.generateIndex();for(var n=0;n<t.length;n++){var o,r,s=this.findIndex(t.hash(n));s<0?(o=void 0,this.length===e?(o=this.indexOffset%e,r=this.findIndex(this.hash(o)),this.index.splice(r,1),r<-s-1&&s++,this.index.splice(-s-1,0,o),this.indexOffset=(this.indexOffset+1)%e):((o=this.length)>=this.bufferLength&&this.reallocate(e),this.index.splice(-s-1,0,o),this.length++),new Uint8Array(this.dataView.buffer,this.offset+o*this.SIZE,this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset+n*this.SIZE,this.SIZE)),i.push(o)):(s=this.index[s],i.push(s))}return this.indexOffset},e.prototype.mergeKeyed=function(t,e,i,n){this.resetRangeCache();for(var o=0;o<e.length;o++){var r=e[o];r===this.length&&(r>=this.bufferLength&&this.reallocate(n),this.length++),new Uint8Array(this.dataView.buffer,this.offset+r*this.SIZE,this.SIZE).set(new Uint8Array(t.dataView.buffer,t.offset+o*this.SIZE,this.SIZE))}this.indexOffset=i},e.prototype.reallocate=function(t){this.bufferLength=t||this.bufferLength;t=new ArrayBuffer(this.bufferLength*this.SIZE);new Uint8Array(t,0,this.length*this.SIZE).set(new Uint8Array(this.dataView.buffer,this.offset,this.length*this.SIZE)),this.dataView=new DataView(t),this.offset=0},e.prototype.toTypedArray=function(){var t;if(this.align(),1===this.SIZE?t=Uint8Array:2===this.SIZE?t=Int16Array:4===this.SIZE?t=8===this.qtype?Float32Array:Int32Array:8===this.SIZE&&(t=-1!==[9,15].indexOf(this.qtype)?Float64Array:BigInt64Array),0===this.indexOffset)return new t(this.dataView.buffer,this.offset,this.length);var e=new t(this.length);return e.set(new t(this.dataView.buffer,this.indexOffset*this.SIZE,this.length-this.indexOffset)),e.set(new t(this.dataView.buffer,0,this.indexOffset),this.length-this.indexOffset),e},e.prototype.align=function(){this.offset%this.SIZE!=0&&this.reallocate()},e.prototype.getByteLocation=function(t){return this.offset+(t+this.indexOffset)%this.length*this.SIZE},e.prototype.getHashLocation=function(t){return this.offset+t*this.SIZE},e.prototype.generateIndex=function(){var i=this;this.index=new Array(this.length);for(var t=0;t<this.length;t++)this.index[t]=t;8!==this.SIZE||-1!==[9,15].indexOf(this.qtype)?this.index.sort(function(t,e){return i.hash(t)-i.hash(e)}):n.Tools.isIE11?this.index.sort(function(t,e){return i.hash(t).compare(i.hash(e))}):this.index.sort(function(t,e){return Number(i.hash(t)-i.hash(e))})},e.prototype.resetRangeCache=function(){this.rangeCache=null},t.Vector=e}(zt=zt||{}),function(t){var o;function r(t,e,i,n){return o.call(this,t,e,i,n,1)||this}t=t.ipc||(t.ipc={}),o=t.Vector,C(r,o),r.prototype.calcRange=function(){for(var t=r.MIN,e=r.MAX,i=0;i<this.length;i+=1){var n=this.getScalar(i);t<n&&(t=n),n<e&&(e=n)}return[e,t]},r.prototype.getScalar=function(t){return this.dataView.getUint8(this.getByteLocation(t))},r.prototype.hash=function(t){return this.dataView.getUint8(this.getHashLocation(t))},r.MIN=0,r.MAX=255,t.U8=r}(zt=zt||{}),function(t){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Bool,i)||this}n=t.ipc||(t.ipc={}),o=n.U8,C(r,o),r.listToIPC=function(t){var e=t.length+6,i=n.Util.createBuffer(e);return i.wb(r.TYPE_NUM),i.wb(0),i.wi(t.length),_.each(t,function(t){return i.wb(t?1:0)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(2);return e.wb(256-r.TYPE_NUM),e.wb(t?1:0),e.data},r.prototype.getValue=function(t){return 1===this.getScalar(t)},r.TYPE_NUM=1,n.Boolean=r}(zt=zt||{}),function(t){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Byte,i)||this}n=t.ipc||(t.ipc={}),o=n.U8,C(r,o),r.listToIPC=function(t){var e=t.length+6,i=n.Util.createBuffer(e);return i.wb(r.TYPE_NUM),i.wb(0),i.wi(t.length),_.each(t,function(t){return i.wb(t)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(2);return e.wb(256-r.TYPE_NUM),e.wb(t||0),e.data},r.prototype.getValue=function(t){return this.getScalar(t)},r.TYPE_NUM=4,n.Byte=r}(zt=zt||{}),v=zt=zt||{},b=v.ipc||(v.ipc={}),w=b.Vector,C(R,w),R.prototype.calcRange=function(){if("undefined"!=typeof BigInt){for(var t=this.getScalar(0),e=t,i=BigInt("-9223372036854775808"),n=1;n<this.length;n++){var o=this.getScalar(n);(t===i||t<o&&o!==i)&&(t=o),(e===i||o<e&&o!==i)&&(e=o)}return[e,t]}for(var r=this.getLegacyScalar(0),s=r,a=R.LONG_NULL,n=1;n<this.length;n++){o=this.getLegacyScalar(n);(r.eq(a)||o.gt(r)&&!o.eq(a))&&(r=o),(s.eq(a)||o.lt(s)&&!o.eq(a))&&(s=o)}return[s,r]},R.prototype.getLegacyScalar=function(t){t=new Uint8Array(this.dataView.buffer,this.getByteLocation(t),this.SIZE);return v.Long.fromBytesLE(t)},R.prototype.getScalar=function(t){return this.dataView.getBigInt64(this.getByteLocation(t),!0)},R.prototype.hash=function(t){return this.dataView.getBigInt64(this.getHashLocation(t),!0)},R.LONG_NULL=new v.Long(0,2147483648),R.LONG_INFINITY_NEGATIVE=new v.Long(1,2147483648),R.LONG_INFINITY_POSITIVE=v.Long.MAX_VALUE,K=R,b.I64=K,v.Tools.isIE11&&(K.prototype.hash=function(t){t=new Uint8Array(this.dataView.buffer,this.getHashLocation(t),this.SIZE);return v.Long.fromBytesLE(t)},K.prototype.toTypedArray=function(){if(this.align(),0===this.indexOffset)return new Uint8Array(this.dataView.buffer,this.offset,this.length*this.SIZE);var t=new Uint8Array(this.length*this.SIZE);return t.set(new Uint8Array(this.dataView.buffer,this.indexOffset*this.SIZE,(this.length-this.indexOffset)*this.SIZE)),t.set(new Uint8Array(this.dataView.buffer,0,this.indexOffset*this.SIZE),(this.length-this.indexOffset)*this.SIZE),t}),function(n){var o,r;function s(t,e,i){return r.call(this,t,e,o.TypeNum.Char,i)||this}o=n.ipc||(n.ipc={}),r=o.U8,C(s,r),s.listToIPC=function(t){var e=t.map(function(t){return n.u8u16(t&&t.length?t[0]:" ")}),t=[].concat.apply([],e),e=e.length+6,i=o.Util.createBuffer(e);return i.wb(s.TYPE_NUM),i.wb(0),i.wi(t.length),_.each(t,function(t){return i.wb(t)}),i.data},s.toIPC=function(t){var t=n.u8u16(t&&t.length?t[0]:" "),e=o.Util.createBuffer(1+t.length);return e.wb(256-s.TYPE_NUM),t.forEach(function(t){return e.wb(t)}),e.data},s.u16u8=function(t){for(var e,i,n,o="",r=0;r<t.length;r++)switch((e=t[r])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o+=String.fromCharCode(e);break;case 12:case 13:i=t[++r],o+=String.fromCharCode((31&e)<<6|63&i);break;case 14:i=t[++r],n=t[++r],o+=String.fromCharCode((15&e)<<12|(63&i)<<6|(63&n)<<0)}return o},s.prototype.getValue=function(t){t=this.getScalar(t);return 0===t?"":n.u16u8([t])},s.TYPE_NUM=10,o.Char=s}(zt=zt||{}),function(t){var o;function r(t,e,i,n){return o.call(this,t,e,i,n,4)||this}t=t.ipc||(t.ipc={}),o=t.Vector,C(r,o),r.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=0;i<this.length;i+=1){var n=this.getScalar(i);(t===r.NULL||t<n&&n!==r.NULL)&&(t=n),(e===r.NULL||n<e&&n!==r.NULL)&&(e=n)}return[e,t]},r.prototype.getScalar=function(t){return this.dataView.getInt32(this.getByteLocation(t),!0)},r.prototype.hash=function(t){return this.dataView.getInt32(this.getHashLocation(t))},r.NULL=-2147483648,r.INFINITY_NEGATIVE=-2147483647,r.INFINITY_POSITIVE=2147483647,t.I32=r}(zt=zt||{}),function(t){var e;function i(){}e=t.ipc||(t.ipc={}),i.QEPOCH=10957*(i.MSDAY=864e5),i.LONG_NULL=new t.Long(0,2147483648),i.LONG_INFINITY_NEGATIVE=new t.Long(1,2147483648),i.LONG_INFINITY_POSITIVE=t.Long.MAX_VALUE,i.JS_DATE_MIN=-864e13,i.TIME_PARTS_RX=/(-?\d{1,7}:\d\d:\d\d.\d\d\d)(\d\d\d\d\d\d)/,i.BQEPOCH=new D.BigInteger((1e6*i.QEPOCH).toString()),e.Constants=i}(zt=zt||{}),function(e){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Date,i)||this}n=e.ipc||(e.ipc={}),o=n.I32,C(r,o),r.fromMoment=function(t){return null===t?null:new e.rDateClass(t.valueOf())},r.fromScalar=function(t){return null===t?null:new e.rDateClass(n.Constants.QEPOCH+t*n.Constants.MSDAY)},r.fromString=function(t){if(!t)return null;t=t.replace(/\./g,"-");t=y.utc(t);return r.fromMoment(t)},r.listToIPC=function(t){var e=4*t.length+6,i=n.Util.createBuffer(e);return i.wb(n.TypeNum.Date),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(5);return e.wb(256-n.TypeNum.Date),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){n.Int.writeValue(null===t?null:r.toScalar(t),e)},r.toMoment=function(t){return null===t?null:y.tz(t.toString(),"UTC")},r.toScalar=function(t){return null===t?null:(t.i-n.Constants.QEPOCH)/n.Constants.MSDAY},r.toString=function(t,e){return void 0===e&&(e="YYYY-MM-DD"),null===t?null:r.toMoment(t).format(e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===n.I32.NULL?null:t===n.I32.INFINITY_NEGATIVE?-1/0:t===n.I32.INFINITY_POSITIVE?1/0:new e.rDateClass(n.Constants.QEPOCH+t*n.Constants.MSDAY)},n.QDate=r}(zt=zt||{}),function(t){var o;function e(t,e,i,n){return o.call(this,t,e,i,n,8)||this}t=t.ipc||(t.ipc={}),o=t.Vector,C(e,o),e.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=0;i<this.length;i+=1){var n=this.getScalar(i);(isNaN(t)||t<n&&!isNaN(n))&&(t=n),(isNaN(e)||n<e&&!isNaN(n))&&(e=n)}return[e,t]},e.prototype.getScalar=function(t){return this.dataView.getFloat64(this.getByteLocation(t),!0)},e.prototype.hash=function(t){return this.dataView.getFloat64(this.getHashLocation(t),!0)},e.prototype.toSplitTypedArray=function(){return this.align(),new Float32Array(this.dataView.buffer,this.offset,2*this.length)},t.F64=e}(zt=zt||{}),function(e){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.DateTime,i)||this}n=e.ipc||(e.ipc={}),o=n.F64,C(r,o),r.fromMoment=function(t){return null===t?null:new e.rDateTimeClass(t.valueOf())},r.fromScalar=function(t){return isNaN(t)||null===t?null:new e.rDateTimeClass(n.Constants.QEPOCH+t*n.Constants.MSDAY)},r.fromString=function(t){if(null===t)return null;var e=t.match(/(.*)(D|T)(.*?)Z?$/);if(!e)return null;t=e[1].replace(/\./g,"-")+"T"+e[3]+"Z";t=y(t);return r.fromMoment(t)},r.listToIPC=function(t){var e=8*t.length+6,i=n.Util.createBuffer(e);return i.wb(n.TypeNum.DateTime),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(9);return e.wb(256-n.TypeNum.DateTime),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){if(null===t)return null;t=y.tz(t.i,"UTC");return e.Tools.timezone&&t.isValid()&&t.tz(e.Tools.timezone),t},r.toScalar=function(t){return null===t?null:(t.i-n.Constants.QEPOCH)/n.Constants.MSDAY},r.toString=function(t,e){if(null===t)return"";t=r.toMoment(t);return void 0!==e?t.format(e):t.toISOString()},r.writeValue=function(t,e){n.Double.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){return r.fromScalar(this.getScalar(t))},n.DateTime=r}(zt=zt||{}),K=zt=zt||{},S=K.ipc||(K.ipc={}),U.toIPC=function(t,e){var i=_.sumBy(t,function(t){return t.length+1})+7+e.length,n=S.Util.createBuffer(i);return n.wb(99),n.wb(11),n.wb(0),n.wi(t.length),_.each(t,function(t){return S.Symbol.writeValue(t,n.wb)}),_.each(e,function(t){return n.wb(t)}),n.data},U.prototype.getKey=function(t){return this.keys.getValue(t)},U.prototype.getValue=function(t){return this.values.getValue(t)},U.prototype.toObject=function(){for(var t={},e=0;e<this.length;e++)t[this.getKey(e)]=this.getValue(e);return t},U.prototype.toLegacy=function(){var e=this,i=new S.Table;return 99===this.qtype?(i.addParsedColumn("Property",this.keys),i.addParsedColumn("Value",this.values)):_.times(this.keys.length,function(t){i.addParsedColumn(e.keys.toLegacy(t),e.values.getValue(t))}),i.toLegacy()},U.prototype.toViewState=function(){for(var t={},e=0;e<this.length;e++)t[this.getKey(e)]=this.values.toViewState(e);return{_type:"dict",value:t}},K=U,(S.Dict=K).prototype.qtype=99,function(t){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Double,i)||this}n=t.ipc||(t.ipc={}),o=n.F64,C(r,o),r.listToIPC=function(t){var e=8*t.length+6,i=n.Util.createBuffer(e);return i.wb(r.TYPE_NUM),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(9);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){var i;null!==t?((i=new Float64Array(1))[0]=t,_.each(new Uint8Array(i.buffer),function(t){return e(t)})):_.each([0,0,0,0,0,0,248,255],function(t){return e(t)})},r.prototype.getValue=function(t){t=this.getScalar(t);return isNaN(t)?null:t},r.TYPE_NUM=9,n.Double=r}(zt=zt||{}),function(t){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Float,i,4)||this}n=t.ipc||(t.ipc={}),o=n.Vector,C(r,o),r.listToIPC=function(t){var e=4*t.length+6,i=n.Util.createBuffer(e);return i.wb(r.TYPE_NUM),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(5);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){var i;null!==t?((i=new Float32Array(1))[0]=t,_.each(new Uint8Array(i.buffer),function(t){return e(t)})):_.each([0,0,192,255],function(t){return e(t)})},r.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=0;i<this.length;i+=1){var n=this.getScalar(i);(isNaN(t)||t<n&&!isNaN(n))&&(t=n),(isNaN(e)||n<e&&!isNaN(n))&&(e=n)}return[e,t]},r.prototype.getScalar=function(t){return this.dataView.getFloat32(this.getByteLocation(t),!0)},r.prototype.getValue=function(t){t=this.getScalar(t);return isNaN(t)?null:t},r.prototype.hash=function(t){return this.dataView.getFloat32(this.getHashLocation(t),!0)},r.TYPE_NUM=8,n.Float=r}(zt=zt||{}),function(t){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Int,i)||this}n=t.ipc||(t.ipc={}),o=n.I32,C(r,o),r.listToIPC=function(t){var e=4*t.length+6,i=n.Util.createBuffer(e);return i.wb(r.TYPE_NUM),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(5);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){var i;null!==t?((i=new Int32Array(1))[0]=t,_.each(new Uint8Array(i.buffer),function(t){return e(t)})):_.each([0,0,0,128],function(t){return e(t)})},r.prototype.getValue=function(t){t=this.getScalar(t);return-2147483648===t?null:-2147483647===t?-1/0:2147483647===t?1/0:t},r.TYPE_NUM=6,n.Int=r}(zt=zt||{});var F=(q.hash=function(t){t=q.md51_array(t);return q.hex(t)},q.rhex=function(t){for(var e="",i=0;i<4;i+=1)e+=q.hex_chr[t>>8*i+4&15]+q.hex_chr[t>>8*i&15];return e},q.hex=function(t){for(var e=0;e<t.length;e+=1)t[e]=q.rhex(t[e]);return t.join("")},q.md5cycle=function(t,e){var i=t[0],n=t[1],o=t[2],r=t[3],n=((n+=((o=((o+=((r=((r+=((i=((i+=(n&o|~n&r)+e[0]-680876936|0)<<7|i>>>25)+n|0)&n|~i&o)+e[1]-389564586|0)<<12|r>>>20)+i|0)&i|~r&n)+e[2]+606105819|0)<<17|o>>>15)+r|0)&r|~o&i)+e[3]-1044525330|0)<<22|n>>>10)+o|0;n=((n+=((o=((o+=((r=((r+=((i=((i+=(n&o|~n&r)+e[4]-176418897|0)<<7|i>>>25)+n|0)&n|~i&o)+e[5]+1200080426|0)<<12|r>>>20)+i|0)&i|~r&n)+e[6]-1473231341|0)<<17|o>>>15)+r|0)&r|~o&i)+e[7]-45705983|0)<<22|n>>>10)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n&o|~n&r)+e[8]+1770035416|0)<<7|i>>>25)+n|0)&n|~i&o)+e[9]-1958414417|0)<<12|r>>>20)+i|0)&i|~r&n)+e[10]-42063|0)<<17|o>>>15)+r|0)&r|~o&i)+e[11]-1990404162|0)<<22|n>>>10)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n&o|~n&r)+e[12]+1804603682|0)<<7|i>>>25)+n|0)&n|~i&o)+e[13]-40341101|0)<<12|r>>>20)+i|0)&i|~r&n)+e[14]-1502002290|0)<<17|o>>>15)+r|0)&r|~o&i)+e[15]+1236535329|0)<<22|n>>>10)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n&r|o&~r)+e[1]-165796510|0)<<5|i>>>27)+n|0)&o|n&~o)+e[6]-1069501632|0)<<9|r>>>23)+i|0)&n|i&~n)+e[11]+643717713|0)<<14|o>>>18)+r|0)&i|r&~i)+e[0]-373897302|0)<<20|n>>>12)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n&r|o&~r)+e[5]-701558691|0)<<5|i>>>27)+n|0)&o|n&~o)+e[10]+38016083|0)<<9|r>>>23)+i|0)&n|i&~n)+e[15]-660478335|0)<<14|o>>>18)+r|0)&i|r&~i)+e[4]-405537848|0)<<20|n>>>12)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n&r|o&~r)+e[9]+568446438|0)<<5|i>>>27)+n|0)&o|n&~o)+e[14]-1019803690|0)<<9|r>>>23)+i|0)&n|i&~n)+e[3]-187363961|0)<<14|o>>>18)+r|0)&i|r&~i)+e[8]+1163531501|0)<<20|n>>>12)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n&r|o&~r)+e[13]-1444681467|0)<<5|i>>>27)+n|0)&o|n&~o)+e[2]-51403784|0)<<9|r>>>23)+i|0)&n|i&~n)+e[7]+1735328473|0)<<14|o>>>18)+r|0)&i|r&~i)+e[12]-1926607734|0)<<20|n>>>12)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n^o^r)+e[5]-378558|0)<<4|i>>>28)+n|0)^n^o)+e[8]-2022574463|0)<<11|r>>>21)+i|0)^i^n)+e[11]+1839030562|0)<<16|o>>>16)+r|0)^r^i)+e[14]-35309556|0)<<23|n>>>9)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n^o^r)+e[1]-1530992060|0)<<4|i>>>28)+n|0)^n^o)+e[4]+1272893353|0)<<11|r>>>21)+i|0)^i^n)+e[7]-155497632|0)<<16|o>>>16)+r|0)^r^i)+e[10]-1094730640|0)<<23|n>>>9)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n^o^r)+e[13]+681279174|0)<<4|i>>>28)+n|0)^n^o)+e[0]-358537222|0)<<11|r>>>21)+i|0)^i^n)+e[3]-722521979|0)<<16|o>>>16)+r|0)^r^i)+e[6]+76029189|0)<<23|n>>>9)+o|0,n=((n+=((o=((o+=((r=((r+=((i=((i+=(n^o^r)+e[9]-640364487|0)<<4|i>>>28)+n|0)^n^o)+e[12]-421815835|0)<<11|r>>>21)+i|0)^i^n)+e[15]+530742520|0)<<16|o>>>16)+r|0)^r^i)+e[2]-995338651|0)<<23|n>>>9)+o|0,n=((n+=((r=((r+=(n^((i=((i+=(o^(n|~r))+e[0]-198630844|0)<<6|i>>>26)+n|0)|~o))+e[7]+1126891415|0)<<10|r>>>22)+i|0)^((o=((o+=(i^(r|~n))+e[14]-1416354905|0)<<15|o>>>17)+r|0)|~i))+e[5]-57434055|0)<<21|n>>>11)+o|0,n=((n+=((r=((r+=(n^((i=((i+=(o^(n|~r))+e[12]+1700485571|0)<<6|i>>>26)+n|0)|~o))+e[3]-1894986606|0)<<10|r>>>22)+i|0)^((o=((o+=(i^(r|~n))+e[10]-1051523|0)<<15|o>>>17)+r|0)|~i))+e[1]-2054922799|0)<<21|n>>>11)+o|0,n=((n+=((r=((r+=(n^((i=((i+=(o^(n|~r))+e[8]+1873313359|0)<<6|i>>>26)+n|0)|~o))+e[15]-30611744|0)<<10|r>>>22)+i|0)^((o=((o+=(i^(r|~n))+e[6]-1560198380|0)<<15|o>>>17)+r|0)|~i))+e[13]+1309151649|0)<<21|n>>>11)+o|0,n=((n+=((r=((r+=(n^((i=((i+=(o^(n|~r))+e[4]-145523070|0)<<6|i>>>26)+n|0)|~o))+e[11]-1120210379|0)<<10|r>>>22)+i|0)^((o=((o+=(i^(r|~n))+e[2]+718787259|0)<<15|o>>>17)+r|0)|~i))+e[9]-343485551|0)<<21|n>>>11)+o|0,t[0]=i+t[0]|0,t[1]=n+t[1]|0,t[2]=o+t[2]|0,t[3]=r+t[3]|0},q.md5blk_array=function(t){for(var e=[],i=0;i<64;i+=4)e[i>>2]=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+(t[i+3]<<24);return e},q.md51_array=function(t){for(var e,i,n,o,r=t.length,s=[1732584193,-271733879,-1732584194,271733878],a=64;a<=r;a+=64)q.md5cycle(s,q.md5blk_array(t.subarray(a-64,a)));for(e=(t=a-64<r?t.subarray(a-64):new Uint8Array(0)).length,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a=0;a<e;a+=1)i[a>>2]|=t[a]<<(a%4<<3);if(i[a>>2]|=128<<(a%4<<3),55<a)for(q.md5cycle(s,i),a=0;a<16;a+=1)i[a]=0;return o=(o=8*r).toString(16).match(/(.*?)(.{0,8})$/),n=parseInt(o[2],16),o=parseInt(o[1],16)||0,i[14]=n,i[15]=o,q.md5cycle(s,i),s},q.hex_chr=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],q);function q(){}!function(r){var s,n;function a(t,e,i){i=n.call(this,t.length,void 0,0,i)||this;return i.indexOffset=0,i.end=e,i.values=t,i}s=r.ipc||(r.ipc={}),n=s.TypeBase,C(a,n),a.toIPC=function(t){var e=_.sumBy(t,function(t){return t.length})+6,i=s.Util.createBuffer(e);return i.wb(0),i.wb(0),i.wi(t.length),_.each(t,function(t){_.each(t,function(t){return i.wb(t)})}),i.data},a.prototype.getFirstOffset=function(t){var e=this.values[t];if(0!==(e=98===e.qtype||99===e.qtype?(98===(t=e).keys.qtype||99===t.keys.qtype?t.keys:t).keys:e).qtype)return 11===e.qtype?e.offsets[0]:(0<=e.qtype&&e.qtype,e.offset);return new a(e.values,e.end,this.dataView).getFirstOffset(0)},a.prototype.getEndOffset=function(t){var e=this.values[t];if(0===(e=98===e.qtype||99===e.qtype?(98===(t=e).values.qtype||99===t.values.qtype?t.values:t).values:e).qtype)return e.end;if(11===e.qtype){for(var i=e,n=i.offsets[i.offsets.length-1];0!==this.dataView.getUint8(n++););return n}if(-11===e.qtype){for(n=e.offset;0!==this.dataView.getUint8(n++););return n}if(0<=e.qtype&&e.qtype<=19){i=e;return i.offset+r.getTypeSize(i.qtype)*i.length}return e.offset+r.getTypeSize(Math.abs(e.qtype))},a.prototype.getValue=function(t){t=this.values[t];return 98===t.qtype||99===t.qtype?s.Parse.table(t,this.dataView):s.Parse.col(t,this.dataView)},a.prototype.isolate=function(t){var e=this.getFirstOffset(t),i=this.getEndOffset(t)-e,n=new ArrayBuffer(i),o=new Uint8Array(n,0,i);if(o.set(new Uint8Array(this.dataView.buffer,e,i)),this.offsetItem(t,-e),98===this.values[t].qtype||99===this.values[t].qtype)return this.values[t]=s.Parse.table(this.values[t],new DataView(n)),F.hash(o);if(this.values[t]=n=s.Parse.col(this.values[t],new DataView(n)),10===n.qtype)return this.toLegacy(t);if(1===n.length&&-20<n.qtype&&n.qtype<20&&0!==n.qtype&&11!==n.qtype&&-11!==n.qtype){n=n.hash(0);return r.Long.isLong(n)?n.toString():n}return F.hash(o)},a.prototype.offsetItem=function(t,e){var i,n=this.values[t];98!==n.qtype&&99!==n.qtype||(n=(98===(i=n).keys.qtype||99===i.keys.qtype?i.keys:i).keys,i=(98===i.values.qtype||99===i.values.qtype?i.values:i).values,this.offsetQTyped(t,e,i)),this.offsetQTyped(t,e,n)},a.prototype.offsetQTyped=function(t,e,i){if(0===i.qtype)for(var n=new a(i.values,i.end,this.dataView),o=0;o<n.length;o++)n.offsetItem(o,e);else if(11===i.qtype)for(var r=i,s=0;s<r.offsets.length;s++)r.offsets[s]+=e;else i.offset+=e},a.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";if(0!==t.length){var e=t.getFirstOffset(0),i=t.end-e,n=this.getFirstOffset(t.values.length),o=this.end-n,r=new ArrayBuffer(i+o);new Uint8Array(r,0,i).set(new Uint8Array(t.dataView.buffer,e,i)),new Uint8Array(r,i,o).set(new Uint8Array(this.dataView.buffer,n,o));for(var s=0;s<t.length;s++)this.values[s]=t.values[s],this.offsetItem(s,-e);for(var a=i-n,s=t.length;s<this.length;s++)this.offsetItem(s,a);this.end+=a,this.dataView=new DataView(r)}},a.prototype.mergeKeyedPrimary=function(t,e,i){var n=this;if(void 0===this.keyIndex){for(var o={},r=0;r<this.length;r++)o[this.isolate(r)]=r;this.keyIndex=o,delete this.dataView,this.getValue=function(t){return n.values[(t+n.indexOffset)%n.length]}}for(r=0;r<t.length;r++){var s,a=t.isolate(r),l=t.values[r],u=this.keyIndex[a];void 0===u?this.length===e?(s=this.indexOffset%e,this.keyIndex[a]=s,this.values[s]=l,i.push(s),this.indexOffset++):(this.keyIndex[a]=this.length,i.push(this.length),this.values.push(l),this.length++):i.push(u)}return this.indexOffset},a.prototype.mergeKeyed=function(t,e,i,n){var o=this;if(void 0===this.values){for(var r=[],s=0;s<this.length;s++){var a=this.getValue(s);r.push(a)}this.values=r,delete this.dataView,this.getValue=function(t){return o.values[(t+o.indexOffset)%o.length]}}for(s=0;s<e.length;s++){var l=t.getValue(s),u=e[s];u===this.length?(this.values.push(l),this.length++):u>this.length||(this.values[u]=l)}this.indexOffset=i},a.prototype.toLegacy=function(t){var e=this.values[t],i=this.dataView;if(10===e.qtype){var n=e,o=[];for(t=0;t<n.length;t++)o.push(i.getUint8(n.offset+t));return s.Char.u16u8(o)}if(-20<e.qtype&&e.qtype<0)return s.Parse.col(e,i).toLegacy(0);if(0<=e.qtype&&e.qtype<20){var r=s.Parse.col(e,i);return _.times(r.length).map(function(t){return r.toLegacy(t)})}return 98===e.qtype||99===e.qtype?s.Parse.table(e,i).toLegacy():101===e.qtype?null:void 0},a.prototype.toViewState=function(t){var e=this.values[t];return 99===e.qtype||98===e.qtype?s.Parse.table(e,this.dataView).toViewState():{_type:10===e.qtype?"string":s.Parse.TYPE_NAMES[Math.abs(e.qtype)],value:r.Tools.convertKDBToViewstateValue(this.toLegacy(t))}},s.List=a}(zt=zt||{}),function(i){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Long,i)||this}n=i.ipc||(i.ipc={}),o=n.I64,C(r,o),r.listToIPC=function(t){var e=8*t.length+6,i=n.Util.createBuffer(e);return i.wb(r.TYPE_NUM),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(9);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){null!==t?(t=i.Long.fromString(""+t),_.each(t.toBytesLE(),function(t){return e(t)})):_.each([0,0,0,0,0,0,0,128],function(t){return e(t)})},r.prototype.getValue=function(t){t=this.getLegacyScalar(t);return t.equals(n.I64.LONG_INFINITY_NEGATIVE)?-1/0:t.equals(n.I64.LONG_INFINITY_POSITIVE)?1/0:t.equals(n.I64.LONG_NULL)?null:t.toString()},r.TYPE_NUM=7,n.QLong=r}(zt=zt||{}),function(e){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Minute,i)||this}n=e.ipc||(e.ipc={}),o=n.I32,C(r,o),r.fromMoment=function(t){return r.fromScalar(t.asMinutes())},r.fromScalar=function(t){return null===t?null:new e.rMinuteClass(t)},r.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(n.Constants.TIME_PARTS_RX),t=y.duration(e&&e[1]?e[1]:t);return r.fromMoment(t)},r.listToIPC=function(t){var e=4*t.length+6,i=n.Util.createBuffer(e);return i.wb(n.TypeNum.Minute),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toMoment=function(t){return null===t?null:y.duration(60*t.i*1e3)},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e,i){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===i&&(i={trim:!1}),null===t?"":r.toMoment(t).format(e,i)},r.toIPC=function(t){var e=n.Util.createBuffer(5);return e.wb(256-n.TypeNum.Minute),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){n.Int.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===n.I32.NULL?null:new e.rMinuteClass(t)},n.Minute=r}(zt=zt||{}),function(e){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Month,i)||this}n=e.ipc||(e.ipc={}),o=n.I32,C(r,o),r.fromMoment=function(t){return null===t?null:new e.rMonthClass(Math.round(t.diff(y([2e3]),"months",!0)))},r.fromScalar=function(t){return null===t?null:new e.rMonthClass(t)},r.fromString=function(t){if(null===t)return null;t=t.replace(/\./g,"-").replace(/m$/,"");t=y.utc(t);return r.fromMoment(t)},r.listToIPC=function(t){var e=4*t.length+6,i=n.Util.createBuffer(e);return i.wb(r.TYPE_NUM),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(5);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){if(null===t)return null;var e=y.tz("2000-01-01","UTC");return e.add(t.i,"month"),e},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e){return void 0===e&&(e="YYYY-MM"),null===t?"":r.toMoment(t).format(e)},r.writeValue=function(t,e){n.Int.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===n.I32.NULL?null:new e.rMonthClass(t)},r.TYPE_NUM=13,n.Month=r}(zt=zt||{}),function(e){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Second,i)||this}n=e.ipc||(e.ipc={}),o=n.I32,C(r,o),r.fromMoment=function(t){return null===t?null:new e.rSecondClass(t.asSeconds())},r.fromScalar=function(t){return null===t?null:new e.rSecondClass(t)},r.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(n.Constants.TIME_PARTS_RX),t=y.duration(e&&e[1]?e[1]:t);return r.fromMoment(t)},r.listToIPC=function(t){var e=4*t.length+6,i=n.Util.createBuffer(e);return i.wb(n.TypeNum.Second),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(5);return e.wb(256-n.TypeNum.Second),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){return null===t?null:y.duration(1e3*t.i)},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e,i){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===i&&(i={trim:!1}),null===t?"":r.toMoment(t).format(e,i)},r.writeValue=function(t,e){n.Int.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===n.I32.NULL?null:new e.rSecondClass(t)},n.Second=r}(zt=zt||{}),function(t){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Short,i,2)||this}n=t.ipc||(t.ipc={}),o=n.Vector,C(r,o),r.listToIPC=function(t){var e=2*t.length+6,i=n.Util.createBuffer(e);return i.wb(r.TYPE_NUM),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(3);return e.wb(256-r.TYPE_NUM),r.writeValue(t,e.wb),e.data},r.writeValue=function(t,e){var i;null!==t?((i=new Int16Array(1))[0]=t,_.each(new Uint8Array(i.buffer),function(t){return e(t)})):_.each([0,128],function(t){return e(t)})},r.prototype.getValue=function(t){t=this.getScalar(t);return-32768===t?null:-32767===t?-1/0:32767===t?1/0:t},r.prototype.calcRange=function(){for(var t=Number.NEGATIVE_INFINITY,e=Number.POSITIVE_INFINITY,i=0;i<this.length;i+=1){var n=this.getScalar(i);(t===r.SHORT_NULL||t<n&&n!==r.SHORT_NULL)&&(t=n),(e===r.SHORT_NULL||n<e&&n!==r.SHORT_NULL)&&(e=n)}return[e,t]},r.prototype.getScalar=function(t){return this.dataView.getInt16(this.getByteLocation(t),!0)},r.prototype.hash=function(t){return this.dataView.getInt16(this.getHashLocation(t))},r.TYPE_NUM=5,r.SHORT_NULL=-32768,n.Short=r}(zt=zt||{}),function(o){var n,r;function s(t,e,i){i=r.call(this,t,t?e[0]:void 0,n.TypeNum.Symbol,i)||this;return i.indexOffset=0,i.offsets=e,i}n=o.ipc||(o.ipc={}),r=n.TypeBase,C(s,r),s.listToIPC=function(t){var e=_.sumBy(t,function(t){return t.length+1})+6,i=n.Util.createBuffer(e);return i.wb(11),i.wb(0),i.wi(t.length),_.each(t,function(t){return s.writeValue(t,i.wb)}),i.data},s.toIPC=function(t){var e=t?t.length+2:2,e=n.Util.createBuffer(e);return e.wb(245),null===t&&void 0===t||s.writeValue(t,e.wb),e.data},s.writeValue=function(t,e){null!=t&&_.each(""+t,function(t){return e(t.charCodeAt(0))}),e(0)},s.prototype.getValue=function(t){if(this.values)return this.values[(t+this.indexOffset)%this.length];for(var e,i=this.offsets[(t+this.indexOffset)%this.length],n=[];0!==(e=this.dataView.getUint8(i++));)n.push(e);return o.u16u8(n)},s.prototype.hash=function(t){return this.getValue(t)},s.prototype.mergeIndexed=function(t){if(t.length>=this.length)throw"Invalid Merge Size";if(null!==t.offset){for(var e=_.last(t.offsets);0!==t.dataView.getUint8(e++););for(var i=e-t.offset,n=this.offsets[t.length],o=_.last(this.offsets);0!==this.dataView.getUint8(o++););var r=o-n,s=new ArrayBuffer(i+r);new Uint8Array(s,0,i).set(new Uint8Array(t.dataView.buffer,t.offset,i)),new Uint8Array(s,i,r).set(new Uint8Array(this.dataView.buffer,n,r));for(var a=0;a<t.length;a++)this.offsets[a]=t.offsets[a]-t.offset;for(var l=i-n,a=t.length;a<this.length;a++)this.offsets[a]=this.offsets[a]+l;this.offset=0,this.dataView=new DataView(s)}},s.prototype.mergeKeyedPrimary=function(t,e,i){if(void 0===this.keyIndex){for(var n={},o=[],r=0;r<this.length;r++){var s=this.getValue(r);n[s]=r,o.push(s)}this.keyIndex=n,this.values=o,delete this.offsets,delete this.dataView}for(r=0;r<t.length;r++){var a,l=t.getValue(r),u=this.keyIndex[l];void 0===u?this.length===e?(a=this.indexOffset%e,this.keyIndex[l]=a,this.values[a]=l,i.push(a),this.indexOffset++):(this.keyIndex[l]=this.length,i.push(this.length),this.values.push(l),this.length++):i.push(u)}return this.indexOffset},s.prototype.mergeKeyed=function(t,e,i,n){if(void 0===this.values){for(var o=[],r=0;r<this.length;r++){var s=this.getValue(r);o.push(s)}this.values=o,delete this.offsets,delete this.dataView}for(r=0;r<e.length;r++){var a=t.getValue(r),l=e[r];l===this.length?(this.values.push(a),this.length++):l>this.length||(this.values[l]=a)}this.indexOffset=i},n.Symbol=s}(zt=zt||{}),function(t){var n;function o(){}n=t.ipc||(t.ipc={}),o.u8u16=function(t){for(var e=[],i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e.push(n):n<2048?e.push(192|n>>6,128|63&n):n<55296||57344<=n?e.push(224|n>>12,128|n>>6&63,128|63&n):(n=65536+((1023&n)<<10|1023&t.charCodeAt(++i)),e.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n))}return e},o.listToIPC=function(t){return n.List.toIPC(t.map(function(t){return o.toIPC(t)}))},o.toIPC=function(t){var e=t?o.u8u16(t):[],t=e.length+6,i=n.Util.createBuffer(t);return i.wb(o.TYPE_NUM),i.wb(0),i.wi(e.length),_.each(e,function(t){return i.wb(t)}),i.data},o.TYPE_NUM=10,n.QString=o}(zt=zt||{}),function(e){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Time,i)||this}n=e.ipc||(e.ipc={}),o=n.I32,C(r,o),r.fromMoment=function(t){return null===t?null:new e.rTimeClass(t.asMilliseconds())},r.fromScalar=function(t){return null===t?null:new e.rTimeClass(t)},r.fromString=function(t){var e=(t=t.replace("1970-01-01T","").replace("Z","")).match(n.Constants.TIME_PARTS_RX),t=y.duration(e&&e[1]?e[1]:t);return r.fromMoment(t)},r.listToIPC=function(t){var e=4*t.length+6,i=n.Util.createBuffer(e);return i.wb(n.TypeNum.Time),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(5);return e.wb(256-n.TypeNum.Time),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){return null===t?null:y.duration(t.i)},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e,i){return void 0===e&&(e="HH:mm:ss.SSS"),void 0===i&&(i={trim:!1}),null===t?"":r.toMoment(t).format(e,i)},r.writeValue=function(t,e){n.Int.writeValue(r.toScalar(t),e)},r.prototype.getValue=function(t){t=o.prototype.getScalar.call(this,t);return t===n.I32.NULL?null:new e.rTimeClass(t)},n.Time=r}(zt=zt||{}),function(e){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Timespan,i)||this}n=e.ipc||(e.ipc={}),o=n.I64,C(r,o),r.fromScalar=function(t){return null===t?null:new e.rTimespanClass(t)},r.fromMoment=function(t){return null===t?null:new e.rTimespanClass(t.valueOfNano())},r.fromString=function(t){var e,i=(t=t.replace("1970-01-01T","").replace("Z","")).match(n.Constants.TIME_PARTS_RX);return i&&i[1]?(-1!==t.indexOf("D")&&(e=t.substring(0,t.indexOf(":")).split("D"),(e=Number(e[1])+24*Number(e[0]))&&(i[1]=e+i[1].substring(2))),e=y.duration(i[1]),(i=Number(i[2]||0))&&!_.isNaN(i)&&e.nanoseconds(i)):e=y.duration(t),r.fromMoment(e)},r.listToIPC=function(t){var e=8*t.length+6,i=n.Util.createBuffer(e);return i.wb(n.TypeNum.Timespan),i.wb(0),i.wi(t.length),_.each(t,function(t){return r.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(9);return e.wb(256-n.TypeNum.Timespan),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){if(null===t)return null;var e=y.duration((0<t.i?Math.floor:Math.ceil)(t.i/1e6));return e.nanoseconds(t.i%1e6),e},r.toScalar=function(t){return null===t?null:t.i},r.toString=function(t,e,i){if(null===t)return"";t=r.toMoment(t),i=t.format(e||"HH:mm:ss.SSS",i||{trim:!1});return e?i:i+_.padEnd(""+t.nanoseconds(),6,"0")},r.writeValue=function(t,e){n.QLong.writeValue(t?r.toScalar(t).toFixed(0):null,e)},r.prototype.getValue=function(t){t=this.getLegacyScalar(t),t="bigint"==typeof t||"number"==typeof t?e.Long.fromString(t.toString()):t;return t.equals(n.I64.LONG_NULL)?null:new e.rTimespanClass(Number(t.toString()))},n.Timespan=r}(zt=zt||{}),function(i){var n,o;function r(t,e,i){return o.call(this,t,e,n.TypeNum.Timestamp,i)||this}n=i.ipc||(i.ipc={}),o=n.I64,C(r,o),r.fromMoment=function(t){return null===t?null:new i.rTimestampClass(t.valueOf(),1e6*t.milliseconds()+t.nanoseconds())},r.fromScalar=function(t){t="bigint"==typeof t||"number"==typeof t?i.Long.fromString(t.toString()):t;if(t.equals(n.Constants.LONG_NULL))return null;t=new D.BigInteger(t.toString()).add(n.Constants.BQEPOCH).toString();return new i.rTimestampClass(Number(t.substring(0,t.length-6)),Number(t.substring(t.length-9)))},r.fromString=function(t){if(null===t)return null;var e=t.match(/(.*)(D|T)(.*?)Z?$/);if(!e)return null;t=e[1].replace(/\./g,"-")+"T"+e[3]+"Z";e=y(t);return e.nanoseconds(i.Tools.extractNanos(t)),r.fromMoment(e)},r.listToIPC=function(t){var e=8*t.length+6,i=n.Util.createBuffer(e);return i.wb(n.TypeNum.Timestamp),i.wb(0),i.wi(t.length),_.each(t,function(t){return n.DateTime.writeValue(t,i.wb)}),i.data},r.toIPC=function(t){var e=n.Util.createBuffer(9);return e.wb(256-n.TypeNum.Timestamp),r.writeValue(t,e.wb),e.data},r.toMoment=function(t){if(null===t)return null;var e=y.tz(t.i,"UTC");return e.nanoseconds(t.n%1e6),i.Tools.timezone&&e.isValid()&&e.tz(i.Tools.timezone),e},r.toScalar=function(t){return null===t?null:BigInt(r.toScalarString(t))},r.toString=function(t,e){if(null===t)return"";var i=r.toMoment(t),t=i.format(e||"YYYY-MM-DDTHH:mm:ss.SSS");return e?t:t.substr(0,23)+_.padEnd(""+i.nanoseconds(),6,"0")+"Z"},r.writeValue=function(t,e){t=r.toScalarString(t);n.QLong.writeValue(t,e)},r.toScalarString=function(t){if(null===t)return null;var e=_.padStart(t.n.toFixed(0),9,"0"),t=t.i.toFixed(0);return new D.BigInteger(t+e.substring(3)).subtract(n.Constants.BQEPOCH).toString()},r.prototype.getValue=function(t){t=new Uint8Array(this.dataView.buffer,this.getByteLocation(t),this.SIZE),t=i.Long.fromBytesLE(t);if(t.equals(r.LONG_NULL))return null;t=new D.BigInteger(t.toString()).add(n.Constants.BQEPOCH).toString();return new i.rTimestampClass(Number(t.substring(0,t.length-6)),Number(t.substring(t.length-9)))},n.Timestamp=r}(zt=zt||{}),function(t){function i(){}t=t.ipc||(t.ipc={}),i.getType=function(t){return i.typeDict[t]},i.mergeTypedArraysUnsafe=function(t,e){var i=new t.constructor(t.length+e.length);return i.set(t),i.set(e,t.length),i},i.fromHexString=function(t){return new Uint8Array(((t||"").match(/.{1,2}/g)||[]).map(function(t){return parseInt(t,16)}))},i.toHexString=function(t){for(var e="",i=0;i<t.length;i++){var n=t[i].toString(16);e+=1===n.length?"0"+n:n}return e},i.pack=function(t){for(var e=[],i=0,n=t.length;i<n;)e.push((255&t[i++])<<8|255&t[i++]);return String.fromCharCode.apply(null,e)},i.base64=function(t){return btoa(String.fromCharCode.apply(null,t))},i.toMessage=function(t){var e=i.createBuffer(8);return e.wi(1),e.wi(t.length+8),i.mergeTypedArraysUnsafe(e.data,t)},i.createBuffer=function(t){var e={data:new Uint8Array(t),i:0,wb:function(t){e.data[e.i++]=t},wi:function(t){_.times(4,function(){e.wb(255&t),t>>=8})}};return e},i.typeDict={10:t.QString,0:t.List,"-1":t.Boolean,"-2":t.Symbol,"-4":t.Byte,"-5":t.Short,"-6":t.Int,"-7":t.QLong,"-8":t.Float,"-9":t.Double,"-10":t.Char,"-11":t.Symbol,"-12":t.Timestamp,"-13":t.Month,"-14":t.QDate,"-15":t.DateTime,"-16":t.Timespan,"-17":t.Minute,"-18":t.Second,"-19":t.Time},t.Util=i}(zt=zt||{});function Y(t,e){if(("Accordion"===t||"Popup"===t)&&e&&e.widgets&&1<e.widgets.length&&!(e.widgets instanceof m.Collection))if("Popup"===t){t=_.findLast(e.widgets,function(t){return t.component});e.widgets.length=0,t&&e.widgets.push(t)}else for(var i,n={},o=e.widgets.length-1;0<=o;o--)n[i=e.widgets[o].sectionId]?e.widgets.splice(o,1):n[i]=!0}var H,K=(H=m.Model,C(W,H),W.objToPaths=function(t,e,i){var n,o,r=!1,s={},a=W.keyPathSeparator;for(o in t){var l=t[o];if(i=i?i+a+o:o,(!0===e||e&&"string"==typeof e&&e!==i&&0===e.indexOf(i))&&(r=!0),l&&l.constructor===Object)if(_.isEmpty(l))s[o]=l;else if(_.has(l,"_dashboardsType"))s[o]=l;else for(var u in n=this.objToPaths(l,e,i)){var c=n[u];s[o+a+u]=c}else if(l&&l.constructor===Array&&r)for(var u in n=this.objToPaths(l,e,i)){c=n[u];s[o+a+u]=c}else s[o]=l}return s},W.getNested=function(t,e,i){for(var n=e?e.split(W.keyPathSeparator):[],o=t,r=0,s=n.length;r<s;r++){if(i&&!_.has(o,n[r]))return!1;if(void 0===(o=null==(o=o[n[r]])&&r<s-1?{}:o))return!!i||o}return!!i||o},W.setNested=function(t,e,i,n){n=n||{};for(var o=e?e.split(W.keyPathSeparator):[],r=t,s=0,a=o.length;s<a&&void 0!==r;s++){var l,u=o[s];s===a-1?n.unset?delete r[u]:r[u]=i:(void 0!==r[u]&&_.isObject(r[u])||(l=o[s+1],r[u]=/^\d+$/.test(l)?[]:{}),r=r[u])}},W.deleteNested=function(t,e){this.setNested(t,e,null,{unset:!0})},W.prototype.toJSON=function(t){return _.merge({},this.attributes)},W.prototype.get=function(t){return W.getNested(this.attributes,t)},W.prototype.set=function(t,e,i){var n,o,r,s,a,l,u,c;if(null==t)return this;if("object"==typeof t?(o=t,i=e||{}):(o={})[t]=e,!this._validate(o,i=i||{}))return null;for(n in r=i.unset,a=i.silent,s=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=_.merge({},this.attributes),this.changed={}),c=this.attributes,u=this._previousAttributes,this.idAttribute in o&&(this.id=o[this.idAttribute]),o=W.objToPaths(o))e=o[n],_.isEqual(W.getNested(c,n),e)||s.push(n),_.isEqual(W.getNested(u,n),e)?W.deleteNested(this.changed,n):W.setNested(this.changed,n,e),r?W.deleteNested(c,n):W.setNested(c,n,e);if(_.each(this.changed,_.bind(function(t,e){_.isEmpty(t)&&_.isObject(t)&&!_.isArray(t)&&delete this.changed[e]},this)),!a){s.length&&(this._pending=!0);for(var p=W.keyPathSeparator,d={},h=0,g=s.length;h<g;h++){t=s[h];d.hasOwnProperty(t)&&d[t]||(d[t]=!0,this.trigger("change:"+t,this,W.getNested(c,t),i));for(var f=t.split(p),m=f.length-1;0<m;m--){var y=f.slice(0,m).join(p),v=y+p+"*";d.hasOwnProperty(v)&&d[v]||(d[v]=!0,this.trigger("change:"+v,this,W.getNested(c,y),i)),d.hasOwnProperty(y)&&d[y]||(d[y]=!0,this.trigger("change:"+y,this,W.getNested(c,y),i))}}}if(l)return this;if(!a)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},W.prototype.clear=function(t){var e,i={};for(e in W.objToPaths(this.attributes))i[e]=void 0;return this.set(i,_.extend({},t,{unset:!0}))},W.prototype.hasChanged=function(t){return null==t?!_.isEmpty(this.changed):void 0!==W.getNested(this.changed,t)},W.prototype.changedAttributes=function(t,e){if(!t)return!!this.hasChanged()&&W.objToPaths(this.changed,e);var i,n=this._changing?this._previousAttributes:this.attributes,o=W.objToPaths(t),r=W.objToPaths(n),s=!1;for(i in o)_.includes(["array","object"],typeof n[i])&&void 0===t[i]?(s=s||{})[i]=void 0:_.isEqual(r[i],o[i])||((s=s||{})[i]=o[i]);return s},W.prototype.previous=function(t){return null!=t&&this._previousAttributes?W.getNested(this._previousAttributes,t):null},W.prototype.previousAttributes=function(){return _.merge({},this._previousAttributes)},W.prototype.toFlat=function(t){return W.objToPaths(this.attributes,t)},W.keyPathSeparator=".",W);function W(t,e){var i,n=H.call(this,t,e)||this,o=t||{};return n.cid=_.uniqueId("c"),n.attributes={},e&&e.collection&&(n.collection=e.collection),e&&e.parse&&(o=n.parse(o,e)||{}),(i=_.result(n,"defaults"))&&(o=_.merge(i,o)),n.set(o,e),n.changed={},n.initialize.apply(n,arguments),n}m.DeepModel=K;function z(){return{appArgs:{json:{Style:{advanced:"",cssClasses:""},Alignment:{paddingLeft:null,paddingRight:null,paddingTop:null,paddingBottom:null,innerPaddingLeft:null,innerPaddingRight:null,innerPaddingTop:null,innerPaddingBottom:null,titlePaddingLeft:null,titlePaddingRight:null,titlePaddingTop:7,titlePaddingBottom:7},format:{widgetTitle:null,titleFontSize:16,titleHorizontal:"Center",titleColor:null,titleBottomBorderWidth:null,titleFontBold:null,titleShadow:!1,titleBackgroundColor:null,titleTransparentBackground:null,tileBorderWidth:null,tileBorderRounding:null,tileBorderColor:null,tileBackgroundColor:null,tileTransparentBackground:null,tileShadow:null}},schema:{properties:{Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{advanced:{type:"css",title:"Advanced CSS",default:""},cssClasses:{type:"string",title:"CSS Classes",default:""}}},Alignment:{type:"object",title:"Margins",options:{collapsed:!0},properties:{paddingLeft:{type:"number",title:"Outer Left",default:null,format:"number",propertyOrder:2001},paddingRight:{type:"number",title:"Outer Right",default:null,format:"number",propertyOrder:2002},paddingTop:{type:"number",title:"Outer Top",default:null,format:"number",propertyOrder:2003},paddingBottom:{type:"number",title:"Outer Bottom",default:null,format:"number",propertyOrder:2004},innerPaddingLeft:{type:"number",title:"Inner Left",default:null,format:"number",propertyOrder:2005},innerPaddingRight:{type:"number",title:"Inner Right",default:null,format:"number",propertyOrder:2006},innerPaddingTop:{type:"number",title:"Inner Top",default:null,format:"number",propertyOrder:2007},innerPaddingBottom:{type:"number",title:"Inner Bottom",default:null,format:"number",propertyOrder:2008},titlePaddingLeft:{type:"number",title:"Title Left",default:null,format:"number",propertyOrder:2009},titlePaddingRight:{type:"number",title:"Title Right",default:null,format:"number",propertyOrder:2010},titlePaddingTop:{type:"number",title:"Title Top",default:null,format:"number",propertyOrder:2011},titlePaddingBottom:{type:"number",title:"Title Bottom",default:null,format:"number",propertyOrder:2012}}},format:{type:"object",title:"Format",options:{collapsed:!0},properties:{widgetTitle:{type:"string",title:"Title",propertyOrder:2001},titleFontSize:{type:"number",title:"Title Font Size",propertyOrder:2002},titleColor:{type:"gradient",title:"Title Font Color",options:{gradient:!1,noColor:!0},default:null,propertyOrder:2003},titleFontBold:{type:"boolean",title:"Title Bold",default:!1,format:"checkbox",propertyOrder:2004},titleShadow:{type:"boolean",title:"Title Shadow",default:!1,format:"checkbox",propertyOrder:2005},titleHorizontal:{type:"string",title:"Title Horizontal Align",enum:["Left","Center","Right"],propertyOrder:2006},titleBottomBorderWidth:{type:"number",title:"Title Bottom Border Size",default:null,format:"number",propertyOrder:2007},titleBackgroundColor:{type:"gradient",title:"Title Background Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2008},titleTransparentBackground:{type:"boolean",title:"Title Transparent Background",default:!1,format:"checkbox",propertyOrder:2009},tileBackgroundColor:{type:"gradient",title:"Background Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2010},tileTransparentBackground:{type:"boolean",title:"Transparent Background",default:!1,format:"checkbox",propertyOrder:2011},tileBorderWidth:{type:"number",title:"Border Size",default:null,format:"number",propertyOrder:2012},tileBorderRounding:{type:"number",title:"Border Rounding",default:null,format:"number",propertyOrder:2013},tileBorderColor:{type:"gradient",title:"Border Color",default:null,options:{gradient:!1,noColor:!0},propertyOrder:2014},tileShadow:{type:"boolean",title:"Component Shadow",default:!1,format:"checkbox",propertyOrder:2015}}}}}}}}var Q,j,G={VALUE_CREATED:"created",VALUE_UPDATED:"updated",VALUE_DELETED:"deleted",VALUE_UNCHANGED:"unchanged",getDiff:function(t,e){return this.removeUnchanged(this.map(t,e))},map:function(t,e){if(this.isFunction(t)||this.isFunction(e))throw"Invalid argument. Function given, object expected.";if(this.isValue(t)||this.isValue(e))return _.clone(void 0===t?e:t);var i,n,o={};for(n in t)this.isFunction(t[n])||((i=void 0)!==e[n]&&(i=e[n]),"_Hidden"===n?o[n]=t[n]:"unchanged"!==this.compareValues(t[n],i)?o[n]=this.map(t[n],i):o[n]=null);for(n in e)this.isFunction(e[n])||void 0!==o[n]||(o[n]=this.map(void 0,e[n]));return o},compareValues:function(t,e){return t===e||this.isDate(t)&&this.isDate(e)&&t.getTime()===e.getTime()?this.VALUE_UNCHANGED:void 0===t?this.VALUE_CREATED:void 0===e?this.VALUE_DELETED:this.VALUE_UPDATED},isFunction:function(t){return"[object Function]"==={}.toString.apply(t)},isArray:function(t){return"[object Array]"==={}.toString.apply(t)},isDate:function(t){return"[object Date]"==={}.toString.apply(t)},isObject:function(t){return"[object Object]"==={}.toString.apply(t)},isValue:function(t){return!this.isObject(t)&&!this.isArray(t)},removeUnchangedJSON:function(i){_.each(i,_.bind(function(t,e){_.isEqual(t,{})||_.isEqual([],t)||null===t?delete i[e]:_.isArray(t)||"string"==typeof t||this.removeUnchangedJSON(i[e])},this))},removeUsedKeys:function(t){for(var e in t)null!==t[e]&&"object"==typeof t[e]&&(this.removeUsedKeys(t[e]),_.isEqual(t[e],{})&&delete t[e]),null===t[e]&&delete t[e]},removeUnchanged:function(t){var i={},n=["string","number","boolean"];return _.each(t,_.bind(function(t,e){0<=_.indexOf(n,typeof t)||null===t&&_.isArray(t)?i[e]=t:i[e]=_.pickBy(t,function(t,e){return null!==t})},this)),this.removeUsedKeys(i),i}};function X(t,e,i){e=j.call(this,t,e,i)||this;return e.IMMATERIAL_ATTRIBUTES=["isGridstack"],e.parent=i,e.listenTo(e,"change",e.determineMaterialChange.bind(e)),e}!function(t){var o;(i=o=t.CommandOp||(t.CommandOp={}))[i.Add=0]="Add",i[i.Remove=1]="Remove",i[i.Set=2]="Set";var r=function(t,e,i){this.op=t,this.key=e,this.payload=i};t.Todo=r;var s=(e.pathArrayToText=function(t){return t.reverse().join(".")},e.prototype.pathText=function(){return e.pathArrayToText(this.path)},e);function e(t,e,i,n){this.title=t,this.path=e,this.todo=i,this.undo=n}t.Command=s;var n,i=(n=m.Model,C(a,n),a.prototype.setParent=function(t){this.parent=t},a);function a(t,e,i){e=n.call(this,t,e)||this;return e.parent=i,e}t.CommandoModel=i;var l,i=(l=m.Collection,C(u,l),u.prototype.commandAdd=function(t,e){var i=_.isArray(t)?t:[t];this.postCommand(this,new s(this.getCommandDescription(o.Add,t,e||"Add"),[],i.map(function(t){return new r(o.Add,"",{attributes:t.toJSON()})}),i.map(function(t){return new r(o.Remove,"",t.id)})))},u.prototype.commandRemove=function(t){var e=this,i=_.isArray(t)?t:[t];this.postCommand(this,new s(this.getCommandDescription(o.Remove,t),[],i.map(function(t){return new r(o.Remove,"",t.id)}),i.map(function(t){return new r(o.Add,"",{attributes:t.toJSON(),index:e.findIndex(t)})})))},u.prototype.commandSet=function(t){var n=this,e=t.map(function(t,e){var i=n.get(t.id)||n.at(e);if(i){t=i.changedAttributes(t),t=_.mapValues(t,function(t,e){return i.previous(e)});return i.id&&(t.id=i.id),t}});this.postCommand(this,new s(this.getCommandDescription(o.Set,t),[],[new r(o.Set,"",t)],[new r(o.Set,"",e)]))},u.prototype.doCommand=function(t,e){var i=this,n=t.pop();n?(n=this.get(n))&&n.doCommand(t,e):e.forEach(function(t){i.doCommandByOp[t.op](t.payload)})},u.prototype.doCommandAdd=function(t){this.add(t.attributes,{at:t.index})},u.prototype.doCommandSet=function(t){this.set(t,{remove:!1})},u.prototype.doCommandRemove=function(t){this.remove(t)},u.prototype.getCommandDescription=function(t,e,i){var n=this.getCommandDescriptor(e);return(i=i||o[t])+" "+(n=n&&_.isArray(e)&&1<e.length?this.getPluralDescriptor(n):n)},u.prototype.getCommandDescriptor=function(t){return this.descriptor},u.prototype.getPluralDescriptor=function(t){return t+"s"},u.prototype.postCommand=function(t,e){return this.parent.postCommand(this,e)},u.prototype.preinitialize=function(t,e){this.parent=e.parent},u.prototype.setParent=function(t){this.parent=t},u.prototype._prepareModel=function(t,e){if(this._isModel(t))return t.collection||(t.collection=this),t;t=new((e=e?_.clone(e):{}).collection=this).model(t,e,this);return t.validationError?(this.trigger("invalid",this,t.validationError,e),!1):t},u);function u(t,e,i){e=l.call(this,t,_.extend(e,{parent:i}))||this;return e.doCommandByOp=((i={})[o.Add]=e.doCommandAdd.bind(e),i[o.Remove]=e.doCommandRemove.bind(e),i[o.Set]=e.doCommandSet.bind(e),i),e}t.ComandoCollection=i}(zt=zt||{}),function(l){var n,e=(n=m.DeepModel,C(i,n),i.setDataProperties=function(t){if(t){for(var e in t)t[e]&&t[e].path?t[e]instanceof l.DocumentDataModel?t[e]={_dashboardsType:"data",value:t[e].path}:t[e]instanceof l.DocumentViewModel&&(t[e]={_dashboardsType:"viewstate",value:t[e].path}):"object"==typeof t[e]&&(t[e]=i.setDataProperties(t[e]));return t}},i.prototype.initialize=function(){this.listenTo(this,"change",this.determineMaterialChange.bind(this))},i.prototype.clone=function(t){var o,r,s,e={},a=function(i,n){_.each(_.keys(i),function(t){var e=0;if(i[t]instanceof l.DocumentViewModel||i[t]instanceof l.DocumentDataModel)n[t]=i[t];else if(i[t]instanceof Array)for(n[t]=new Array(i[t].length),e=0;e<i[t].length;e+=1)_.isObjectLike(i[t][e])?(n[t][e]=i[t][e]instanceof Array?[]:{},a(i[t][e],n[t][e])):n[t][e]=i[t][e];else i[t]instanceof Date?(n[t]=new Date,n[t].setTime(i[t].getTime())):_.isObject(i[t])?(n[t]={},a(i[t],n[t])):"advanced"===t&&-1!==i[t].indexOf(o)&&r?n[t]=i[t].replace(s,r):n[t]=i[t]})};return t&&(o=t.previousWidgetId,r=t.widgetId,s=new RegExp(o,"g")),a(this.attributes,e),new i(e,{},this.parent)},i.prototype.commandSet=function(t){var i=this,e=_.mapValues(t,function(t,e){return i.get(e)}),n=_.keys(t),o="Set ";n[0]&&(o+=_.last(n[0].split("."))),1<n.length&&(o+=" & "+(n.length-1)+" more");e=new l.Command(o,[],[new l.Todo(l.CommandOp.Set,"",t)],[new l.Todo(l.CommandOp.Set,"",e)]);this.postCommand(this,e)},i.prototype.determineMaterialChange=function(t,e){t.changed&&!_.isEmpty(_.omit(t.changed,t.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},i.prototype.doCommand=function(t,e){var i=this;e.forEach(function(t){i.set(t.payload)})},i.prototype.postCommand=function(t,e){return this.parent&&this.parent.postCommand(this,e)},i.prototype.setParent=function(t){this.parent=t},i.prototype.toDiff=function(t){var o={},r=this._templates;return r&&r.Defaults&&(_.defaultsDeep(r.Defaults,z().appArgs.json),_.each(t,_.bind(function(t,n){var e;r.Defaults[n]&&("string"==typeof t?o[n]=t:_.isArray(t)||(e=G.getDiff(t,r.Defaults[n]),_.isEmpty(e)||(o[n]=e)),_.isArray(t)&&_.each(t,_.bind(function(t,e){var i={},i=t&&t._Hidden&&t._Hidden._Type?G.getDiff(t,r[n][t._Hidden._Type]):void 0!==r[n]&&r[n][n]?G.getDiff(t,r[n][n]):t;o[n]=void 0===o[n]?[]:o[n],o[n].push(i)},this)))},this))),o},i.prototype.toJSON=function(){var t=$.extend(!0,{},this.attributes);i.setDataProperties(t);var e=this.toDiff(t);return _.isEmpty(e)?t:e},i);function i(t,e,i){e=n.call(this,t,e)||this;return e.IMMATERIAL_ATTRIBUTES=["version","poss_sel_cols","possible_axis","possible_colors","possible_columns","possible_dashboards","possible_floats","possible_keys","possible_labels","possible_Period","possible_screens","possible_selected_columns","possible_servers","possible_shapes","possible_strings","possible_track","possible_values","possible_viewstates","possibleColumns","possibleConnections","possibleKeys","possibleLabels","possibleValues","datagridPossibleColumns","datagridPossibleColumnsWithItself","selectedColumnPossibleValues","highlightTargetPossibleValues","sortingPossibleValues","Selection"],e.parent=i,e}l.ComponentOptions=e;var t,o=(t=l.CommandoModel,C(r,t),r.convertDashboardTypesToModels=function(n,t,e){var o,r,s,a=m.DeepModel.keyPathSeparator;n&&(o={data:t,viewstate:e},e=n.toFlat(!0),r=_.keys(o),s=function(t,e){var i;_.isObject(t)&&_.includes(r,t._dashboardsType)&&"string"==typeof(i=t.value)&&((t=(t=o[t._dashboardsType](i))||{}).path=i,n.set(e,t,{silent:!0}))},_.each(e,function(t,n){_.isArray(t)?_.each(t,function(t,i){_.each(t,function(t,e){s(t,n+a+i+a+e)})}):s(t,n)}))},r.prototype.initialize=function(){var t=this.get("key");t&&/App$/.test(t)&&this.set("key",t.replace(/App$/,""),{silent:!0}),this.silentCast("options",e),this.silentCast("components",a),this.listenTo(this.get("components"),"materialChange",function(){this.trigger("materialChange")}),Y(this.attributes.key,this.attributes),this.silentCast("widgets",l.WidgetCollection),this.listenTo(this.get("widgets"),"materialChange",function(){this.trigger("materialChange")}),this.listenTo(this.get("options"),"materialChange",this.onOptionsMaterialChange)},r.prototype.clone=function(t){var e=new r({definitionId:this.get("definitionId"),key:this.get("key"),containerId:this.get("containerId"),components:this.get("components").clone(),widgets:this.get("widgets").clone()},{},this.parent);return t=t||{previousWidgetId:this.id,widgetId:e.id},e.set("options",this.get("options").clone(t),{silent:!0}),e},r.prototype.defaults=function(){return{id:l.Helpers.getGUID(),key:null,options:new e({},{},this),containerId:null,components:new a([],{},this),widgets:new l.WidgetCollection([],{},this)}},r.prototype.doCommand=function(t,e){if(0<t.length){var i=t.pop();if(-1!=["options","components","widgets"].indexOf(i))return this.get(i).doCommand(t,e);throw"Unsupported command key"}},r.prototype.getInnermostComponents=function(t){var e=this.get("components");return 0<e.length&&e.at(0).get("key")===t?e.at(0).getInnermostComponents(t):e},r.prototype.postCommand=function(t,e){return t instanceof a?e.path.push("components"):t instanceof l.WidgetCollection?e.path.push("widgets"):t instanceof Object&&e.path.push("options"),e.path.push(this.id),this.parent&&this.parent.postCommand(this,e)},r.prototype.onOptionsMaterialChange=function(){this.get("upgrading")||this.trigger("materialChange")},r.prototype.silentCast=function(t,e,i){this.get(t)instanceof e||this.set(t,new e(this.get(t),i,this),{silent:!0})},r.prototype.parseCastAndListen=function(t,e,i,n,o){var r=this;!t||!t[e]||t[e]instanceof i||(t[e]=new i(t[e],o,this),this.listenTo(t[e],n,function(t){r.trigger("change",r)}))},r.prototype.parse=function(t){return this.parseCastAndListen(t,"components",a,"change add remove"),this.parseCastAndListen(t,"options",e,"change"),Y(this.attributes.key,t),this.parseCastAndListen(t,"widgets",l.WidgetCollection,"change add remove"),t},r.prototype.setParent=function(t){this.parent=t,this.get("components")&&this.get("components").setParent(this),this.get("options")&&this.get("options").setParent(this),this.get("widgets")&&this.get("widgets").setParent(this)},r);function r(){return null!==t&&t.apply(this,arguments)||this}l.Component=o;var s,a=(s=l.ComandoCollection,C(u,s),u.prototype.clone=function(){return new u(_.map(this.models,function(t){return t.clone()}),{model:this.model,comparator:this.comparator},this.parent)},u.prototype.getCommandDescriptor=function(t){var e,i=s.prototype.getCommandDescriptor.call(this,t);return _.isArray(t)&&1===t.length?e=t[0]:t instanceof o&&(e=t),(i=e instanceof m.Model?e.get("key"):i)||this.descriptor},u.prototype.setParent=function(t){var e=this;this.parent=t,this.map(function(t){return t.setParent(e)})},u);function u(){var t=null!==s&&s.apply(this,arguments)||this;return t.descriptor="Component",t}a.prototype.model=o}(zt=zt||{}),function(t){var e,i=(e=m.Model,C(n,e),n.prototype.defaults=function(){return{listViewThumb:null,ghostViewThumb:null,buildViewThumb:null,appKey:null,appArgs:null,name:null,description:null}},n);function n(){return null!==e&&e.apply(this,arguments)||this}t.ComponentDefinition=i;var o,r=(o=m.Collection,C(s,o),s);function s(){var t=null!==o&&o.apply(this,arguments)||this;return t.model=i,t}t.ComponentDefinitionCollection=r}(zt=zt||{}),m.emulateHTTP=!0,function(t){var e,i=(e=m.Model,C(n,e),Object.defineProperty(n.prototype,"idAttribute",{get:function(){return"name"},enumerable:!1,configurable:!0}),n.prototype.defaults=function(){return{name:"default",type:"q",host:"localhost",port:"80",tls:"false",user:"",password:""}},n);function n(){return null!==e&&e.apply(this,arguments)||this}t.Connection=i;var o,r=(o=m.Collection,C(s,o),s);function s(){var t=null!==o&&o.apply(this,arguments)||this;return t.model=i,t}t.ConnectionCollection=r}(zt=zt||{}),m.emulateHTTP=!0,function(t){var e,i=(e=m.Model,C(n,e),Object.defineProperty(n.prototype,"idAttribute",{get:function(){return"name"},enumerable:!1,configurable:!0}),n.prototype.defaults=function(){return{name:"default",type:"kdb",connections:[],connectionsType:[]}},n);function n(){return null!==e&&e.apply(this,arguments)||this}t.ConnectionGroup=i;var o,r=(o=m.Collection,C(s,o),s);function s(){var t=null!==o&&o.apply(this,arguments)||this;return t.model=i,t}t.ConnectionGroupCollection=r}(zt=zt||{}),m.emulateHTTP=!0,function(t){var e,i=(e=m.Model,C(n,e),Object.defineProperty(n.prototype,"idAttribute",{get:function(){return"name"},enumerable:!1,configurable:!0}),n.prototype.defaults=function(){return{name:"default",type:"q",host:"localhost",port:"80",tls:"false",user:"",password:""}},n);function n(){return null!==e&&e.apply(this,arguments)||this}t.Service=i;var o,r=(o=m.Collection,C(s,o),s);function s(){var t=null!==o&&o.apply(this,arguments)||this;return t.model=i,t}t.ServiceCollection=r}(zt=zt||{}),Q=zt=zt||{},j=Q.CommandoModel,C(X,j),X.prototype.commandSet=function(t){this.postCommand(this,new Q.Command("Set Layout",[],[new Q.Todo(Q.CommandOp.Set,"",t)],[new Q.Todo(Q.CommandOp.Set,"",_.clone(this.toJSON()))]))},X.prototype.defaults=function(){return{row:null,column:null,rowSpan:12,colSpan:6}},X.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},X.prototype.doCommand=function(t,e){var i=this;e.forEach(function(t){i.set(t.payload)})},X.prototype.postCommand=function(t,e){return this.parent.postCommand(this,e)},Q.Layout=X;var Z,J,tt,et,it,nt,ot,rt,st,at,lt,ut,ct,pt,dt,ht,gt,ft,mt,yt,vt,bt,wt,St,_t,Ct,Tt,Dt,Mt,Et,Pt,It,kt,At,xt,Nt,Lt,Vt,Bt,Ot,Rt,$t,Ut,Ft,qt,Yt,Ht,Kt,Wt,zt,Qt;function jt(t,i,n){var o=this;this.class="203",this.columns=[],this.meta={},this.cols={},void 0!==t&&(this.columns=t).forEach(function(t,e){o.meta[t]=i[e].qtype,o.cols[t]=Z.Parse.col(i[e],n)})}function Gt(t){var e=this;if(this.requests={},this.requestId=1,this.httpOn=!1,(Gt.client=this).debouncedHeartbeat=t.httpOnly?_.noop.bind(this):_.debounce(this.heartbeat.bind(this),15e3),(t.httpOn||t.httpOnly)&&(this.httpOn=!0),t.noWorker||t.httpOnly)t.httpOnly?_.defer(function(){return e.onOpen(void 0)}):this.init();else{var i=requirejs.toUrl("worker")+".js";J.Log.Log(Gt.WORK+i);try{!window.SharedWorker||"FSBL"in window?(this.worker=new Worker(i,t),this.worker.onmessage=function(t){return e.onWsMessage(t)},this.worker.onerror=function(t){return e.onWorkerError(t)}):(this.worker=new SharedWorker(i,t),this.worker.port.onmessage=function(t){return e.onWsMessage(t)},this.worker.port.onmessageerror=function(t){return e.onWorkerError(t)},this.worker.port.start(),this.worker.onerror=function(t){return e.onWorkerError(t)})}catch(t){throw J.Log.Log(Gt.WORK+"create err",t),t}}}function Xt(){this.perf={}}function Zt(){this.legacySubscribers={},this.rawSubscribers={}}function Jt(t){var i=this,n=t.mappings||{};this.setDataModelMappings=t.setMappings,this.subscriptionKey=_.uniqueId("mapper_"),this.subscribe=t.subscribe,this.subscribed=!1,this.unsubscribe=t.unsubscribe,this.viewState=t.viewState,this.model=new m.Model({key:n.key||"",value:n.value||""}),this.mappings=new m.Collection(_.map(n.mappings,function(t,e){return new m.Model({key:e,value:"",viewstate:t&&t._dashboardsType?i.viewState.getByPath(n.mappings[e].value):t})})||[]),_.extend(this,m.Events)}function te(t){this.collection=t}function ee(t){this.breakdownColumns=[],this.columns=new m.Collection,this.columnDict={},this.breakdownColumns=[],this.agent=t.agent,this.idAttribute=t.idAttribute,this.maxRows=Number(t.maxRows||100),this.primaryKey=t.primaryKey||it.DataSet.DEFAULT_ROW_INDEX}function ie(t,e,i,n,o,r){var s=ot.call(this,t)||this;s.agent=new nt.Agent,s.callbacks=[],s.dataMapper=null,s.dataSet=null,s.dataSet2=null,s.forceInternalReset=!1,s.isClone=!1,s.isDirty=!1,s.isPending=!1,s.legacyFlushTime=0,s.consolidateCount=0,s.dataExecuteSuccessCount=0,s.durationMovingAverage=ie.FAST_THRESHOLD,s.paramChanged=[],s.parameterModels=[],s.performance=new nt.PerformanceMetrics,s.pollingEvent=null,s.subscriptionId=null,s.subscriptionTypes=["polling","subscription","streaming"],s.viewStateBindings={},s.virtualSubscriptions={};var a=[];return s.root=e||s,s.path=i,s.viewState=n,s.group=o,s.virtualSubscriptions=r||{},s.group&&s.unset("_pagingType",{silent:!0}),s.get("_queryString")||!s.get("_pivotQuery")&&!s.get("_table")||(s.set("_queryString",s.get("_pivotQuery")||"select from "+s.get("_table")),s.unset("_pivotQuery"),s.unset("_table")),_.keys(s.attributes).forEach(function(t){var e,i=s.get(t);_.isArray(i)||!_.isObject(i)||i instanceof m.Model||(i._dataType?("copy"===i._dataType&&(i._dataType="query"),_.includes(["analytic","streaming","pivot","query","virtual","builder"],i._dataType)?(e=new ie(i,s.root,s.path?s.path+"/"+t:t,s.viewState),a.push(e),s.set(t,e,{silent:!0}),s.listenTo(e,"materialChange",s.onMaterialChange)):nt.Log.Error(s.logPrefix()+" unsupported datatype: ",i._dataType)):"viewstate"===i._dashboardsType?(e=s.viewState.getByPath(i.value),s.set(t,e,{silent:!0})):_.includes(["_analyticParams","_mappings","_pageSort"],t)||i instanceof m.Model&&i.get("_viewType")||(e=new ie(i,s.root,s.path?s.path+"/"+t:t,s.viewState,!0),s.set(t,e,{silent:!0}),s.listenTo(e,"change",function(){return s.trigger("change",s)}),s.listenTo(e,"materialChange",s.onMaterialChange)))}),s.has("_pagingNum")&&s.set("_pagingNum",0,{silent:!0}),s.has("_pageSort")&&s.set("_pageSort",{},{silent:!0}),s.debouncedParameterChange=_.throttle(s.applyParameterChange.bind(s),60,{leading:!1}),s.listenTo(s,"change",s.onModelChange),s}function ne(t,e,i){i=st.call(this,t,e,i)||this;return i.MATERIAL_ATTRIBUTES=["_type","_default"],i.withAllProperties=!1,e&&(e.path&&(i.path=e.path),i.root=!0===e.root?i:e.root),_.each(_.keys(i.attributes),function(t){var e,i=this.get(t);if(_.isObject(i)&&-1===["_default","value",".settings"].indexOf(t))e=new ne(i,{path:this.path?this.path+"/"+t:t,root:this.root},this),this.set(t,e,{silent:!0}),this.listenTo(e,"change",this.onChildModelChange),this.listenTo(e,"materialChange",this.onMaterialChange);else if(".settings"===t){if(!(i instanceof m.Model)){for(var n in i)i.hasOwnProperty(n)&&(i[n]=new m.Model(i[n]));this.set(t,new m.Model(i))}}else this.set(t,i),"_default"===t&&(this.get("_rolling")?this.set("value",rt.Helpers.convertRollingToDate(i,this.get("_type"))):this.set("value",i))}.bind(i)),_.has(i.attributes,"_default")&&_.has(i.attributes,"value")&&(i.attributes._type=i.attributes._type||"symbol",i.schema={_type:{type:"Select",options:["boolean","byte","char","date","datetime","dict","double","float","guid","int","list","long","minute","month","second","short","string","symbol","time","timespan","timestamp"]}},i.updateSchema()),i.listenTo(i,"change",i.onChange),i}function oe(t,e){e=lt.call(this,t,e)||this;return(at.Document.parent=e).listenTo(e,"change:selectedDocumentId",e.resetCommands.bind(e)),e}function re(){}function se(e){var i=ct.call(this,e)||this;return i.$dialog=null,i.$nameInput=null,i.container=null,i.appModel=null,i.viewModel=null,i.appModel=e.appModel,i.container=e.container,i.viewModel=e.viewModel,i.el.className="quick-base window dashboard-name-prompt",i.$el.html(ut.T.AboutDialog(_.extend({DeltaClientHost:location.hostname,DeltaClientPort:location.port||("https:"==location.protocol?443:80)},i.appModel.toJSON()))),i.$nameInput=i.$el.find(".name-input"),i.$dialog=i.$el.dialog(_.extend({appendTo:i.container,dialogClass:"quick-base about-dialog",title:t("About"),resizable:!0,height:329,width:470,modal:!0,autoOpen:!0,draggable:!0,open:function(){$('<i class="fa fa-info-circle" />').insertBefore(i.$el.parent().find(".ui-dialog-title"))},close:function(){i.remove()}},e)),i}function ae(t){var i=pt.call(this)||this;return i.HEADING_HEIGHT=28,i.onUpdate=t.onUpdate,i.sections=t.sections||[],i.$el=t.el,i.$el.addClass("dash-accordion accordion"),i.sections.forEach(function(t,e){t.$el&&(t.$heading=t.$el.find(t.$heading),t.$content=t.$el.find(t.$content),t.$el.addClass("section"),t.$heading.click(function(){i.onClick(t)}))}),i.debouncedRemoveAnimate=_.debounce(function(){i.$el.removeClass("animate"),i.onUpdate&&i.onUpdate(i.sections)},300),i.updateLayout(!1),i}function le(){_.extend(this,m.Events)}function ue(t,e,i,n){var o=ht.call(this)||this;return o.nodes={},o.edges={},o.edgesR={},o.subscriptions={},o.activeViewStateToSubscriptions={},o.getDataSourceByPath=i,o.onNodeUpdate=n,t.getViewStateList().forEach(function(t){var e;"dict"===t.model.get("_type")&&(e=o.addNode("vs",t.path,t.model),_.each(t.model.get("value"),function(t){t&&t.path&&(t=o.addNode("vs",t.path,t),o.addEdge({fromNodeId:t,toNodeId:e}))}))}),_.each(e,function(e){var i;e&&e.path&&(i=o.addNode("ds",e.path,e),_.each(e.getViewStateDict(),function(t){t&&t.path&&(t=o.addNode("vs",t.path,t),o.addEdge({fromNodeId:t,toNodeId:i}))}),_.each(e.getMappedViewStates(),function(t){t&&t.path&&(t=o.addNode("vs",t.path,t),o.addEdge({fromNodeId:i,toNodeId:t}))}),"virtual"===e.get("_dataType")&&_.each(_.filter(e.get("_virtualParams"),{type:"datasource"}).map(function(t){return t.value}),function(t){o.getDataSourceByPath(t)?(t=o.addNode("ds",t,e),o.addEdge({fromNodeId:t,toNodeId:i})):dt.Log.Warn("DocumentGraph: "+e.path+" has invalid source parameter  "+e.path)}))}),_.isUndefined(o.hierarchical)&&(o.hierarchical=_.keys(o.nodes).length<20),o}function ce(){}function pe(t){var e=mt.call(this)||this;e.saveSettingsNowDebounced=_.debounce(e.saveSettingsNow.bind(e),100),e.activeViewStateToPropertyPaths={},e.propertyPathsToViewStates={},e.activeViewStateToSubscriptions={},e.subscriptionsToViewStates={},e.viewStateSubscriptions={},e.interface={},e.subscriptions={},e.getTemplateViewStates=function(t){return this.processTemplateViewStates(this.getViewStates(this.extractTemplateViewStates(t)))},e.notifyViewStateSubscriber=function(t){var e=this.viewStateSubscriptions[t],t=this.subscriptionsToViewStates[t];_.isFunction(e)&&e(this.getViewStates(t))},e.subscribe=function(t,e,i,n){var o;if("data"===this.getSourceType(t)){if(o=this.getDataSourceKey(t),this.subscriptions[o])return this.subscriptions[o].callback=e,!1;this.subscriptions[o]={key:this.getSubscriptionKey(t.path),source:t,onData:e},t.subscribe(this.subscriptions[o].key,this.subscriptions[o],i,n)}else ft.Log.Warn("Source type not implemented")},e.subscribeTemplateViewStates=function(t,e){var i=this;return this.subscribeViewStates(this.extractTemplateViewStates(t),function(t){e(i.processTemplateViewStates(t))})},e.subscribeViewStates=function(t,e){var i=this,n=_.uniqueId("vs_");return this.viewStateSubscriptions[n]=e,this.subscriptionsToViewStates[n]=[],_.each(t,function(t){t=i.docViewModel.getByPath(t);t&&(i.subscriptionsToViewStates[n].push(t.path),i.activeViewStateToSubscriptions[t.path]?-1===i.activeViewStateToSubscriptions[t.path].indexOf(n)&&i.activeViewStateToSubscriptions[t.path].push(n):(i.activeViewStateToSubscriptions[t.path]=[n],i.listenTo(t,"change:value",function(t,e){var i=this;_.each(this.activeViewStateToSubscriptions[t.path],function(t){i.notifyViewStateSubscriber(t)})})))}),this.notifyViewStateSubscriber(n),n},e.unsubscribe=function(t){var e;switch(this.getSourceType(t)){case"data":e=this.getDataSourceKey(t),this.subscriptions[e]&&(t.unsubscribe(this.subscriptions[e].key),delete this.subscriptions[e]);break;case"viewstate":this.stopListening(t,"change:value")}},e.unsubscribeAll=function(){var n=this;_.each(this.subscriptions,function(t,e){t.source.unsubscribe(t.key),delete n.subscriptions[e]}),_.defer(function(){_.each(n.activeViewStateToPropertyPaths,function(t,e){var i=n.docViewModel.getByPath(e);n.stopListening(i,"change:value"),delete n.activeViewStateToPropertyPaths[e]}),_.each(n.activeViewStateToSubscriptions,function(t,e){var i=n.docViewModel.getByPath(e);n.stopListening(i,"change:value"),delete n.activeViewStateToSubscriptions[e]})})},e.unsubscribeViewStates=function(i){var n=this;this.viewStateSubscriptions[i]&&(_.each(this.subscriptionsToViewStates[i],function(t){var e;n.activeViewStateToSubscriptions[t]=_.without(n.activeViewStateToSubscriptions[t],i),_.isEmpty(n.activeViewStateToSubscriptions[t])&&_.isEmpty(n.activeViewStateToPropertyPaths[t])&&(e=n.docViewModel.getByPath(t),n.stopListening(e,"change:value"),delete n.activeViewStateToSubscriptions[t])}),delete this.subscriptionsToViewStates[i],delete this.viewStateSubscriptions[i])},e.unsubscribeTemplateViewStates=function(t){this.unsubscribeViewStates(t)};var i=[];return e.appKey=t.appKey,e.componentId=t.componentId,e.dashboardAppModel=t.dashboardAppModel,e.dashboardViewModel=t.dashboardViewModel,e.deltaClient=t.deltaClient,e.deltaClientLib=t.deltaClientLib,e.docDataModel=t.docDataModel,e.docViewModel=t.docViewModel,e.settingsModel=t.settingsModel,e.quickView=t.quickView,e.widgetId=t.widgetId,e.activeViewStateToPropertyPaths={},e.propertyPathsToViewStates={},e.interface={},e.subscriptions={},i=_.union(i,pe.API_METHODS),t.advancedMethods&&(i=_.union(i,pe.ADVANCED_METHODS)),_.each(i,_.bind(function(t){_.isFunction(this[t])?this.interface[t]=_.bind(this[t],this):_.isUndefined(this[t])||(this.interface[t]=this[t])},e)),e.listenTo(e.docViewModel,"change",function(t,e){var n,o;e&&e.unset?(this.renamingViewState=(t.path?t.path+"/":"")+_.first(_.keys(t.changed)),_.defer(_.bind(function(){this.renamingViewState=null},this))):(this.renamingViewState&&(n=this.renamingViewState,o=(t.path?t.path+"/":"")+_.first(_.keys(t.changed)),n!==o&&(this.activeViewStateToPropertyPaths[n]&&(this.activeViewStateToPropertyPaths[o]=this.activeViewStateToPropertyPaths[n],delete this.activeViewStateToPropertyPaths[n]),this.activeViewStateToSubscriptions[n]&&(this.activeViewStateToSubscriptions[o]=this.activeViewStateToSubscriptions[n],delete this.activeViewStateToSubscriptions[n]),_.each(this.propertyPathsToViewStates,_.bind(function(t,e){t===n&&(this.propertyPathsToViewStates[e]=o)},this)),_.each(this.subscriptionsToViewStates,_.bind(function(t,i){_.each(t,function(t,e){t===n&&(this.subscriptionsToViewStates[i][e]=o)})},this)))),this.renamingViewState=null)}),e}function de(t){var e=vt.call(this,t)||this;return e.$appDiv=null,e.app=null,e.appOnSettingsChange=null,t.el||e.el.classList.add("component-build-view"),_.extend(e,_.pick(t,de.COMMON_OPTIONS)),t.key?(e.componentId=t.namespace||_.uniqueId("component_"),e.appOptions=t.appOptions,e.key=t.key,e.settingsModel=t.settings instanceof m.Model?t.settings:new yt.ComponentOptions(t.settings,{},null)):(e.componentId=e.model.id,e.key=e.model.get("key"),e.settingsModel=e.model.get("options")),e.initializeApi(),e.render(),e.requireApp(),e}function he(t){var e=wt.call(this,t)||this;return e.isCancel=!1,e.options=t,e.preRender(),e.render(),e.postRender(),e.resizeListener=e.onResize.bind(e),$(window).on("resize",e.resizeListener),e}function ge(t){return _t.call(this,_.extend({iconClass:"fa-asterisk",dialogTitle:"Save Changes",minHeight:110,width:300},t,{userClass:"areyousure-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function fe(e){var i=Tt.call(this,e)||this;i.MESSAGE_TYPES=["error","success","warning"],i.clicked=!1;var n=m.Model.extend({schema:{username:{title:t("Username")},oldpassword:{title:t("Current Password"),type:"Password",validators:["required"]},password1:{title:t("New Password"),type:"Password",validators:["required"]},password2:{title:t("Re-Enter"),type:"Password",validators:[{type:"match",field:"password1",message:"Passwords must match!"},"required"]}}});return i.boundToggleCaps=i.toggleCapsLockMsg.bind(i),i.model=new n({username:void 0}),delete i.model.schema.username,i.form=new m.Form({model:i.model}).render(),i.$el.append(i.form.el),i.$el.append('<div class="message-box">'),$(i.form.el).submit($.proxy(i.onSubmit,i)),i.$messageBox=i.$el.find(".message-box"),e.message?i.showMessage(e.message):i.showMessage(),i.onChangeSuccess=e.onChangeSuccess,i.$dialog=i.$el.dialog(_.extend({appendTo:e.container,dialogClass:"quick-base change-password-dialog",title:t("Change Password"),resizable:!1,height:262,width:320,modal:!0,autoOpen:!0,draggable:!0,buttons:[{text:t("OK"),click:$.proxy(i.onSubmit,i),icons:{primary:"fa fa-check"}},{text:t("Cancel"),click:$.proxy(i.close,i),icons:{primary:"fa fa-times"}}],open:function(){$('<i class="fa fa-check" />').insertBefore(i.$el.parent().find(".ui-dialog-title")),$(".quick-base").addClass("disturbed"),i.$okBtn=$(i).parent().find(".ui-dialog-buttonpane button").first(),i.$el.find(".old-password-input").focus()},close:function(){$(".quick-base").removeClass("disturbed"),Ct.ErrorTooltip.clearAll(),_.isFunction(e.onClose)&&e.onClose(),i.onRemove(),_.isFunction(e.onDialogClose)&&e.onDialogClose()}},e)),$(i.form.el).find("input").on("keydown",function(t){13===t.which&&i.onSubmit()}),$(i.form.el).find("input").on("keypress",function(e){Ct.LoginDialog.checkCapslockOn(e.originalEvent)?i.showMessage('<i class="fa fa-warning"/>'+t("Caps Lock is on"),"warning"):i.showMessage()}),window.addEventListener("keydown",i.boundToggleCaps,!0),i}function me(t){var e=Dt.call(this,_.extend({iconClass:"fa-trash-o",dialogTitle:"Confirm Delete",minHeight:110,width:275},t,{userClass:"confirm-dialog"+(t.userClass?" "+t.userClass:"")}))||this;return _.isFunction(t.renderTemplate)&&(e.renderTemplate=t.renderTemplate),e}function ye(t){t=Et.call(this,t)||this;return t.COMPONENT_SAVE_TIMEOUT=2e3,t.QUERY_STATUS_DELAY=200,t.QUERY_STATUS_FADE=3e3,t.showNoResultsIndicators=!1,t.customErrorClass="",t.model.set("upgrading",!0,{silent:!0}),ye._instances.push(t),t}function ve(t){t=It.call(this,t)||this;return t.widgetClass="component-drop-widget",t}function be(t){var e=At.call(this,t)||this;return e.appModel=null,e.availableHeight=0,e.documentsList=null,e.documentTypeMap=null,e.showManage=!1,e.viewModel=null,e.RECENT_DOCUMENT_COUNT=3,e.appModel=t.appModel,e.viewModel=t.viewModel,e.showManage=t.showManage,e.debouncedRender=_.debounce(e.render,100),e.initializeEvents(),e}function we(t){var e=Nt.call(this,t)||this;return e.cssClasses=null,e.customCss=null,e.$customCss=null,e.popups=[],e.prevCssViewModel=null,e.appModel=t.appModel,e.viewModel=t.viewModel,e.quickView=t.quickView,e.model.upgrade(),e.el.className="document-view",e.$el.html(xt.T.DocumentView({})),e.initializeEvents(),e.applyCustomCss(),e.onCssClassesChanged(),e.onSelectedScreenChanged(),e.quickView||e.onResetPopups(),e}function Se(t){var e=Vt.call(this,t)||this;return e.errorMessage=t.errorMessage,e.appModel=t.appModel,e.container=t.container,e.doLogin=t.doLogin,e.container.html(e.render().$el),e.boundCapsLockFn=$.proxy(e.onWindowCapsLockClick,e),e.initializeEvents(),e}function _e(){}function Ce(t){var e=Ot.call(this,t)||this;return e.MAJOR_TIMEZONES=[{label:"UTC / Unaltered",value:"UTC"},{label:"Frankfurt",value:"Europe/Berlin"},{label:"London",value:"Europe/London"},{label:"New York",value:"America/New_York"},{label:"Sydney",value:"Australia/Sydney"},{label:"Tokyo",value:"Asia/Tokyo"}],e.logLevels=[{label:"None",value:0},{label:"Errors",value:1},{label:"Handled/Warnings",value:2},{label:"Log & Debugs",value:3},{label:"All",value:4}],e.dialogContainer=null,e.isQuickView=!1,e.el.className="account-menu ui-widget ui-widget-content",e.appModel=t.appModel,e.dialogContainer=t.dialogContainer,e.themes=t.themes,e.viewModel=t.viewModel,e.isQuickView=!!t.isQuickView,e.$el.click(function(t){$(t.target).is("li")||t.stopPropagation()}),e.listenTo(e.viewModel,"change:themeSwitchable",e.onThemeSwitchableChange),e.getTimezones(),e.render(),e}function Te(t){var e=$t.call(this,t)||this;return e.viewStateListeners={},e.appModel=t.appModel,e.viewModel=t.viewModel,e.quickView=t.quickView,e.isEditing=t.isEditing,e.$el.html(Rt.T.popup({})),e.$dialog=e.$el.find(".dialog"),e.$contentPanel=e.$dialog.find(".content-panel"),t.container?e.$dialogContainer=t.container:e.$dialogContainer=$(".quick-dash > .content-panel > .document-view"),e.onDialogAttributeChange=_.debounce(e.initializeDialog,100),e.initializeDialog(),e.initializeEvents(),e.initializeVisible(),e}function De(){}function Me(){}function Ee(t){return qt.call(this,_.extend({iconClass:"fa-keyboard-o",dialogTitle:"Simple Input",userClass:"simpleinput-dialog",width:275,height:140},t,{userClass:"simpleinput-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function Pe(t){this.csvExportDelimiter=t.csvExportDelimiter,this.dataSet=t.dataSet,this.metaData=t.metaData,this.configSets=t.configSets,this.workSheetTitle=t.workSheetTitle,this.fileFormat=t.fileFormat,this.fileName=t.fileName,this.bookType={".xlsx":"xlsx",".xls":"xlml",".csv":"csv"}[t.fileFormat]}function Ie(t){return Ht.call(this,_.extend({iconClass:"fa-exclamation-triangle",dialogTitle:"Error",minHeight:110,width:275},t,{userClass:"error-dialog"+(t.userClass?" "+t.userClass:"")}))||this}function ke(t){var e=Wt.call(this,t)||this;return e.DATA_SOURCE_PROPERTY="Basics.Data",e.EXPORT_PROPERTY_OBJECT="FileExport",e.EXPORT_PROPERTY_KEYS=["ShowExportCsvButton","ShowExportExcelButton","ShowFullExportButton","ShowClipboard","ShowScreenshot"],_.extend(e,_.pick(t,e.SETTINGS)),e.isIE=HTMLCanvasElement&&HTMLCanvasElement.prototype&&HTMLCanvasElement.prototype.msToBlob,e.$el.html(Kt.T.fileExporter({})),e.$root=e.$el.find(">.pnlButtons"),e.$lnksExport=e.$el.find(".lnksExport"),e.$lnkCsvExport=e.$el.find("a.lnkCsvExport"),e.$lnkExcelExport=e.$el.find("a.lnkExcelExport"),e.$lnkFullExport=e.$el.find("a.lnkFullExport"),e.$lnksScreenshot=e.$el.find(".lnksScreenshot"),e.$lnkCopyScreenshot=e.$el.find("a.lnkCopyScreenshot"),e.$lnkDownloadScreenshot=e.$el.find("a.lnkDownloadScreenshot"),e.initializeEvents(),e}function Ae(){}!function(o){var n,r=(n=o.CommandoModel,C(i,n),i.prototype.clone=function(t){var e=new i({},{},this.parent);t&&e.set("id",t);t=_.omit(this.attributes,"id");return t.component=this.get("component").clone({previousWidgetId:this.id,widgetId:e.id}),t.layout=this.get("layout").clone(),e.set(t),e},i.prototype.defaults=function(){return{id:o.Helpers.getGUID(),layout:new o.Layout({},{},this),component:null}},i.prototype.commandSet=function(t){var e=this.clone(this.id).toJSON();this.postCommand(this,new o.Command("Set Widget",[],[new o.Todo(o.CommandOp.Set,"",t)],[new o.Todo(o.CommandOp.Set,"",e)]))},i.prototype.doCommand=function(t,e){var i=this;if(0<t.length){var n=t.pop();if(-1!==["layout","component"].indexOf(n))return this.get(n).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){t.payload.component&&(t.payload.component instanceof m.Model?i.set("component",t.payload.component):i.set("component",new o.Component(t.payload.component,{},i)))})},i.prototype.postCommand=function(t,e){return t instanceof o.Layout?e.path.push("layout"):t instanceof o.Component&&(e.path.pop(),e.path.push("component")),e.path.push(this.id),this.parent.postCommand(this,e)},i.prototype.onComponentChanged=function(t,e,i){e&&this.listenTo(e,"change",function(t,e){this.trigger("change",t,e)})},i.prototype.onMaterialChange=function(){this.trigger("materialChange")},i.prototype.setParent=function(t){this.parent=t,this.get("component")&&this.get("component").setParent(this),this.get("layout")&&this.get("layout").setParent(this)},i);function i(t,e,i){i=n.call(this,t,e,i)||this;return i.IMMATERIAL_ATTRIBUTES=[],!i.get("layout")||i.get("layout")instanceof o.Layout||i.set({layout:new o.Layout(i.get("layout"),{},i)},{silent:!0}),!i.get("component")||i.get("component")instanceof o.Component||i.set({component:new o.Component(i.get("component"),{},i)},{silent:!0}),i.get("component")&&i.listenTo(i.get("component"),"materialChange",i.onMaterialChange.bind(i)),i.get("layout")&&i.listenTo(i.get("layout"),"materialChange",i.onMaterialChange.bind(i)),i.listenTo(i,"change:component",i.onComponentChanged.bind(i)),i.onComponentChanged(i,i.get("component")),i}o.Widget=r;var s,t=(s=o.ComandoCollection,C(e,s),e.prototype.clone=function(){return new e(_.map(this.models,function(t){return t.clone()}),{model:r,comparator:this.comparator},this.parent)},e.prototype.commandSet=function(t){var n=this,e=t.map(function(t,e){var i=n.get(t.id)||n.at(e);if(i){t=i.changedAttributes(t),t=_.mapValues(t,function(t,e){e=i.get(e);return e instanceof m.Model?e.toJSON():e});return i.id&&(t.id=i.id),t}}),e=new o.Command(this.getCommandDescription(o.CommandOp.Set,t),[],[new o.Todo(o.CommandOp.Set,"",t)],[new o.Todo(o.CommandOp.Set,"",e)]);this.postCommand(this,e)},e.prototype.doCommandSet=function(t){var i=this;t.forEach(function(t){var e=i.get(t.id);e&&(t.component&&e.get("component").set(t.component),t.layout&&e.get("layout").set(t.layout))})},e.prototype.getCommandDescriptor=function(t){var e,i=s.prototype.getCommandDescriptor.call(this,t);return _.isArray(t)&&1===t.length?e=t[0]:t instanceof r&&(e=t),(i=e instanceof m.Model&&e.get("component")?e.get("component").get("key"):i)||this.descriptor},e.prototype.setParent=function(t){var e=this;this.parent=t,this.map(function(t){return t.setParent(e)})},e);function e(){var t=null!==s&&s.apply(this,arguments)||this;return t.commandQueue=[],t.descriptor="Widget",t.model=r,t}(o.WidgetCollection=t).prototype.model=r}(zt=zt||{}),function(t){var n,o;function e(t,e,i){return o.call(this,t,e,n.TypeNum.Guid,i,16)||this}n=t.ipc||(t.ipc={}),o=n.Vector,C(e,o),e.prototype.calcRange=function(){throw"Not implemented"},e.prototype.hash=function(t){throw"GUID hash not implemented "+t},e.prototype.getScalar=function(t){return this.dataView.getBigInt64(this.getByteLocation(t),!0)},e.prototype.getValue=function(t){for(var e=this.getByteLocation(t),i=e+this.SIZE,n="0123456789abcdef",o="",r=e;r<i;r++){var s=this.dataView.getUint8(r),a=r-e;o+=4==a||6==a||8==a||10==a?"-":"",o+=n[s>>4],o+=n[15&s]}return"00000000-0000-0000-0000-000000000000"===o?null:o},n.Guid=e}(zt=zt||{}),function(t){var n,o;function e(t,e,i){return o.call(this,t,e,n.TypeNum.Unary,i)||this}n=t.ipc||(t.ipc={}),o=n.U8,C(e,o),e.prototype.getValue=function(t){return this.getScalar(t)},n.Unary=e}(zt=zt||{}),K=zt=zt||{},Z=K.ipc||(K.ipc={}),jt.toLegacy=function(t,n,o){for(var e=0<n.length?o[n[0]].length:0,r=new Array(e),i=0;i<e;i++)!function(e){var i=new Object;n.forEach(function(t){return i[t]=o[t].toLegacy(e)}),r[e]=i}(i);return{class:"203",columns:n.slice(0),meta:_.clone(t),rows:r}},jt.prototype.addColumn=function(t,e,i){this.columns.push(t),this.meta[t]=e.qtype,this.cols[t]=Z.Parse.col(e,i)},jt.prototype.addParsedColumn=function(t,e){this.columns.push(t),this.meta[t]=e.qtype,this.cols[t]=e},jt.prototype.merge=function(e){var i=this;return this.columns=this.columns.concat(e.columns),e.columns.forEach(function(t){i.meta[t]=e.meta[t],i.cols[t]=e.cols[t]}),this},jt.prototype.toLegacy=function(){return jt.toLegacy(this.meta,this.columns,this.cols)},jt.prototype.toViewState=function(){return{_type:"table",value:this.toLegacy()}},K=jt,(Z.Table=K).prototype.qtype=98,function(c){var p;function d(){}p=c.ipc||(c.ipc={}),d.col=function(t,e){if(-11===t.qtype){var i=t;return new p.Symbol(1,[i.offset],e)}if(11===t.qtype)return new p.Symbol(t.offsets.length,t.offsets,e);if(0===t.qtype)return new p.List(t.values,t.end,e);if(101===t.qtype){i=t;return new p.Unary(1,i.offset,e)}if(98===t.qtype||99===t.qtype){i=t;return d.table(i,e)}if(101===t.qtype){i=t;return new p.Unary(1,i.offset,e)}var n=d.VECTOR_COLUMN_CLASSES[Math.abs(t.qtype)];return n?t.qtype<0?new n(1,(i=t).offset,e):new n(t.length,t.offset,e):null},d.dict=function(t,e){var i=d.col(t.keys,e),e=d.col(t.values,e);return new p.Dict(i.length,i,e,t.qtype)},d.flipDict=function(t,e){var i=d.col(t.keys,e),n=d.col(t.values,e);return new p.Table(_.times(i.length,function(t){return i.toLegacy(t)}),_.times(n.length,function(t){return n.getValue(t)}),e)},d.reshape=function(t,e){var i=t.qtype,n=new DataView(e);if("com.fd.business.querymanager.subscriptions.StreamingSubscription"===t.class||"210"===t.class||"207"===t.class)return t;e=d.table(t,n);if(e&&98===e.qtype)return e;var o=new p.Table;if(-20<i&&i<0){var r=d.TYPE_NAMES[-i]||"unknown";o.addColumn(r,-11===i?new c.qSymList(!0,[t.offset]):new c.qVector(-i,!0,1,t.offset),n)}else if(99===i){r=t;o.addColumn("Property",r.keys,n),o.addColumn("Value",r.values,n)}else if(10===i){var s=t;o.addColumn("string",new c.qGenericList(!0,[s],s.offset+s.length*c.getTypeSize(s.qtype)),n)}else if(0===i)t.values.forEach(function(t,e){null!==t&&(e=(10===t.qtype?"string":d.TYPE_NAMES[Math.abs(t.qtype)]||"unknown")+e,t.qtype<0?o.addColumn(e,-11===t.qtype?new c.qSymList(!0,[t.offset]):new c.qVector(-t.qtype,!0,1,t.offset),n):o.addColumn(e,10!==t.qtype&&t.qtype<=19?t:new c.qGenericList(!0,[t],10===t.qtype?t.offset+c.getTypeSize(t.qtype)*t.length:t.offset),n))});else if(11===i){var a=t;a.offsets.forEach(function(t,e){o.addColumn((d.TYPE_NAMES[a.qtype]||"unknown")+e,new c.qSymList(!0,[t]),n)})}else{if(!(0<=i&&i<20)){if(101===i)return o;throw"Unsupported Root Object"}for(var s=t,l=c.getTypeSize(s.qtype),u=0;u<s.length;u++)o.addColumn((d.TYPE_NAMES[s.qtype]||"unknown")+u,new c.qVector(s.qtype,!0,1,s.offset+l*u),n)}return o},d.table=function(t,e){if(98===t.qtype)return d.flipDict(t,e);if(99===t.qtype){var i=t;if(98!==i.values.qtype)return d.dict(t,e);if(98===i.keys.qtype){var t=d.flipDict(i.keys,e),n=d.flipDict(i.values,e);return t.merge(n)}if(11!==i.keys.qtype||11!==i.values.keys.qtype)throw"Unsupported nested table/dict";var o=d.col(i.values.keys,e),n=["key"].concat(_.times(o.length,function(t){return o.toLegacy(t)})),r=d.col(i.values.values,e);return new p.Table(n,[i.keys].concat(_.times(r.length,function(t){return r.getValue(t)})),e)}},d.TYPE_NAMES=["list","boolean","guid",void 0,"byte","short","int","long","real","float","char","symbol","timestamp","month","date","datetime","timespan","minute","second","time"],d.VECTOR_COLUMN_CLASSES=[null,p.Boolean,p.Guid,null,p.Byte,p.Short,p.Int,p.QLong,p.Float,p.Double,p.Char,null,p.Timestamp,p.Month,p.QDate,p.DateTime,p.Timespan,p.Minute,p.Second,p.Time],p.Parse=d}(zt=zt||{}),J=zt=zt||{},Gt.createLog=function(t,e,i){},Gt.getQueryData=function(t,e,i,n,o,r,s,a,l){Gt.getQueryData2(t,e,i,n,Gt.legacyRowCallback(o),r,s,a,l)},Gt.getQueryData2=function(t,e,i,n,o,r,s,a,l){a&&J.Log.Error("Paging not supported in lite"),"sql"===t&&J.Log.Error("SQL not supported in lite");n=this.parametersToString(n);n&&(i=i+"["+n+"]"),l&&l.trigger("serverStart"),Gt.client.send(2,s,e,J.ipc.QString.toIPC(i),function(t,e,i){i&&l&&(l.set("serverStart",i[0]),l.set("serverEnd",i[1])),o(t,e)},r)},Gt.parametersToString=function(t){var i,e="";return _.isEmpty(t)||(i=[],_.each(t,function(t,e){i.push(J.RTTI.getByName(t.type).toKDBInput(t.value))}),e=i.join(";")),e},Gt.parametersToIPC=function(t){function i(t){var e=Gt.deltaNameMap[t.type];if(!e)throw"Unsupported param type: "+t.type;return e.toIPC(J.ipc.fromString(e,t.value))}var n=[];return _.isEmpty(t)||_.each(t,function(t,e){"dict"===t.type?n.push(J.ipc.Dict.toIPC(_.map(t.value,function(t,e){return e}),J.ipc.List.toIPC(_.map(t.value,i)))):"list"===t.type?n.push(J.ipc.Symbol.listToIPC(t.value.map(function(t){return _.isNil(t)?"":t.toString()}))):n.push(i(t))}),J.ipc.List.toIPC(n)},Gt.runAnalytic=function(t,e,i,n,o,r,s,a){Gt.runAnalytic2(t,e,i,function(t,e){var i=J.ipc.Parse.reshape(t,e),t=i.toLegacy();return delete i.cols,e=null,n(t)||{}},o,r,null,a)},Gt.runAnalytic2=function(t,e,i,n,o,r,s,a){i&&_.values(i).length||(i=[{type:"symbol",value:null}]);i=this.parametersToIPC([{type:"symbol",value:t}].concat(_.values(i)));Gt.client.send(2,r,e,i,function(t,e,i){i&&a&&(a.set("serverStart",i[0]),a.set("serverEnd",i[1])),n(t,e)},o)},Gt.runAPI=function(t,e,i,n,o,r,s,a){i&&_.values(i).length||(i=[{type:"symbol",value:null}]);i=this.parametersToIPC([{type:"symbol",value:t}].concat(_.values(i)));Gt.client.send(1,r,e,i,function(t,e){var i=J.ipc.Parse.reshape(t,e),t=i.toLegacy();return delete i.cols,e=null,n(t)||{}},o)},Gt.getDeltaAnalytics=function(e,t){Gt.runAnalytic(".api.getFunctions",t,[],function(t){return e(_.map(t.rows,function(t){return t.parameters=t.parameters.rows,t.name=".api."+t.name,t}))},function(){})},Gt.legacyRowCallback=function(i){return function(t,e){i&&(e&&e.byteLength&&(t.dataSet?t.dataSet=J.ipc.Parse.reshape(t.dataSet,e).toLegacy():t=J.ipc.Parse.reshape(t,e).toLegacy()),i(t))}},Gt.updateTable=function(i,t,e){for(var n=[],o=0;o<3;o+=1)n[o]={type:"dict",value:{},index:o};_.each(n,function(t,e){t.index=e}),_.each(i.addedDict.items,function(t,e){n[0].value[e]={type:Gt.updateTableGetListType(i.typeConfig[e],t),value:t}}),_.each(i.updatedDict.items,function(t,e){n[1].value[e]={type:Gt.updateTableGetListType(i.typeConfig[e],t),value:t}}),_.each(i.deletedDict.items,function(t,e){n[2].value[e]={type:Gt.updateTableGetListType(i.typeConfig[e],t),value:t}}),"analytic"===i.updateType?i.updateAnalytic&&Gt.runAnalytic(i.updateAnalytic,i.connection,n,t,e):Gt.getQueryData("kdb",i.connection,i.query,n,t,e)},Gt.updateTableGetListType=function(t,e){var i;switch(t){case 0:return i=_.isArray(e)?_.isBoolean(e[0])?"listlistboolean":_.isString(e[0])?"listliststring":"listlistsymbol":_.isString(e)?"string[]":"symbol[]";case 1:return"boolean[]";case 2:return"guid[]";case 4:return"byte[]";case 5:return"short[]";case 6:return"int[]";case 7:return"long[]";case 8:return"real[]";case 9:return"float[]";case 10:return i="char[]",_.each(e,function(t){1<t.length&&(i="string[]")}),i;case 11:return"symbol[]";case 12:return"timestamp[]";case 13:return"month[]";case 14:return"date[]";case 15:return"datetime[]";case 16:return"timespan[]";case 17:return"minute[]";case 18:return"second[]";case 19:return"time[]";default:return"symbol[]"}},Gt.prototype.destroy=function(){if(this.ws)try{this.ws.onopen=_.noop.bind(this),this.ws.onclose=_.noop.bind(this),this.ws.onmessage=_.noop.bind(this),this.ws.close(),this.ws=null}catch(t){this.ws=null}},Gt.prototype.send=function(t,e,i,n,o,r){return this.sendMessage(new J.DCRequest(t,i,J.ipc.List.toIPC([J.ipc.Int.toIPC(e||2147483647),n]),o,r))},Gt.prototype.subscribe=function(t,e,i,n,o,r){if(void 0===r){var s=void 0,a=/^(`[a-zA-Z]\w+)+$/gm;if(e.match(/^\((`\$"([^"]+)")(;`\$"([^"]+)")*\)$/gm))s=e.match(/`\$"([^"]+)"/g).map(function(t){return t.substring(3,t.length-1)});else{if(!e.match(a))return void o('Enter stream query as a symbol list in the form: (`$"symA";`$"symB")');s=e.match(a).map(function(t){return t.substring(1,t.length)})}e=s[0],r=(1<s.length?s.slice(1):[]).map(function(t){return{type:"symbol",value:t}})}r=_.first(r),r=J.ipc.List.toIPC([J.ipc.Symbol.toIPC(e),!r||_.isEmpty(r.value)?J.ipc.Symbol.toIPC(null):"list"===r.type?J.ipc.Symbol.listToIPC(r.value.map(function(t){return _.isNil(t)?"":t.toString()})):Gt.parametersToIPC([r])]);return this.send(3,-t,i,r,n,o)},Gt.prototype.unsubscribe=function(t){delete this.requests[t],this.sendMessage(new J.DCRequest(4,null,null,_.noop.bind(this),_.noop.bind(this)),t)},Gt.prototype.addOptionalRequestParams=function(t,e){e.connectionId&&(t.push(J.ipc.Symbol.toIPC(e.connectionId)),e.query&&t.push("string"==typeof e.query?J.ipc.Char.listToIPC(e.query.split("")):e.query instanceof Array?J.ipc.Symbol.listToIPC(e.query):e.query))},Gt.prototype.heartbeat=function(){this.ws?this.sendMessage(new J.DCRequest(0)):this.init()},Gt.prototype.init=function(){try{var t="file:"===location.protocol?"ws://localhost:10001/":("https:"===location.protocol?"wss://":"ws://")+location.host+location.pathname.replace(/(\/|\/edit\/?)?(index.html)?$/,"");J.Log.Log(Gt.SOCK+t),this.ws=new WebSocket(t),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onWsOpen.bind(this),this.ws.onclose=this.onWsClose.bind(this),this.ws.onerror=this.onWsError.bind(this),this.ws.onmessage=this.onWsMessage.bind(this)}catch(t){J.Log.Log(Gt.SOCK+"Create Err",t)}this.debouncedHeartbeat()},Gt.prototype.sendMessage=function(t,e){var i,n,o,r=this;return e=e||this.requestId++,this.requests[e]=t,!this.worker||this.httpOn&&-1!==[1,2].indexOf(t.op)?(o=[J.ipc.Int.toIPC(this.httpOn?0:e),J.ipc.Int.toIPC(t.op)],this.addOptionalRequestParams(o,t),this.httpOn?((i=new XMLHttpRequest).onprogress=function(t){t.lengthComputable&&(t=t.loaded/t.total*100,J.Log.Log("DashClient download: "+t+"%"))},i.onload=function(){i.response&&20<i.response.byteLength?(new DataView(i.response).setInt32(15,e,!0),r.onWsMessage({data:i.response})):r.onWsMessage({data:[5,"Invalid response"]})},(n=J.ipc.Util.toMessage(J.ipc.List.toIPC(o))).byteLength<2048?(i.open("GET",location.protocol+"//"+location.host+"/api/"+btoa(n.reduce(function(t,e){return t+String.fromCharCode(e)},"")).replace(/\//g,"+"),!0),i.responseType="arraybuffer",i.send()):(i.open("POST",location.protocol+"//"+location.host+"/api/",!0),i.responseType="arraybuffer",i.send(n))):this.ws&&this.ws.readyState===WebSocket.OPEN&&(this.ws.send(J.ipc.Util.toMessage(J.ipc.List.toIPC(o))),this.debouncedHeartbeat())):(o=[e,t.op],this.addOptionalRequestParams(o,t),(!window.SharedWorker||"FSBL"in window?this.worker:this.worker.port).postMessage(o)),e},Gt.prototype.onDisconnect=function(t){J.Log.Log("DashClient Disconnect",t),$(this).trigger("DeltaClientDisconnect",t)},Gt.prototype.onOpen=function(t){J.Log.Log("DashClient Connect"),$(this).trigger("DeltaClientConnect"),J.Log.Log("DashClient Login"),$(this).trigger("DeltaClientLogin")},Gt.prototype.onWorkerError=function(t){J.Log.Log(Gt.WORK+"error",t),this.onDisconnect(t)},Gt.prototype.onWsClose=function(t){J.Log.Log(Gt.SOCK+"Closed",t),this.destroy()},Gt.prototype.onWsError=function(t){J.Log.Log(Gt.SOCK+"Error",t),this.onDisconnect(t),this.destroy()},Gt.prototype.onWsMessage=function(t){if(t.data instanceof Array){if(6===t.data[0])return void(t.data[1]===WebSocket.OPEN?this.onOpen(null):this.onWorkerError(t.data[2]||"ws not open"));if(5===t.data[0])return this.onWorkerError(t.data[1])}var e,i=J.deserialize(t.data,8,!0),n=i[0],o=i[1],r=this.requests[n];r?(3!==r.op&&delete this.requests[n],2!==r.op&&1!==r.op&&3!==r.op||(5===o?(e=i[2],r.error(J.u16u8(new Uint8Array(t.data,e.offset,e.length)))):(e=this.httpOn&&3!==r.op?Date.now():new Float64Array(t.data,0,1)[0],r.success(i[2]||{},t.data,[r.timestamp,e])))):J.Log.Warn('Stray Response "'+n+'"')},Gt.prototype.onWsOpen=function(t){console.log("websocket open",t),this.ws.readyState===WebSocket.OPEN?(J.Log.Log(Gt.SOCK+"Open",t),this.onOpen(t)):(J.Log.Log(Gt.SOCK+"Open Error",t),this.onDisconnect(t))},Gt.SOCK="Socket ",Gt.WORK="Worker ",Gt.deltaNameMap={boolean:J.ipc.Boolean,guid:J.ipc.Symbol,byte:J.ipc.Byte,short:J.ipc.Short,int:J.ipc.Int,long:J.ipc.QLong,real:J.ipc.Float,float:J.ipc.Double,char:J.ipc.Char,symbol:J.ipc.Symbol,timestamp:J.ipc.Timestamp,month:J.ipc.Month,date:J.ipc.QDate,datetime:J.ipc.DateTime,timespan:J.ipc.Timespan,minute:J.ipc.Minute,second:J.ipc.Second,time:J.ipc.Time,string:J.ipc.QString},K=Gt,J.DashClient=K,K=zt=zt||{},Xt.prototype.trigger=function(t){this.perf[t]=Date.now()},Xt.prototype.set=function(t,e){this.perf[t]=e},Object.defineProperty(Xt.prototype,"performance",{get:function(){return this.perf},enumerable:!1,configurable:!0}),K.PerformanceMetrics=Xt,tt=zt=zt||{},Zt.prototype.notifyAllLegacyChange=function(e,i,n,o){var r=this;_.each(this.legacySubscribers,function(t){return r.notifyChange(t,e,i,n,o)})},Zt.prototype.notifyAllRawChange=function(e,i,n,o){var r=this;_.each(this.rawSubscribers,function(t){return r.notifyChange(t,e,i,n,o)})},Zt.prototype.notifyChange=function(t,e,i,n,o){this.callSubscriber(t,t.onData,e,i,n,o)},Zt.prototype.getSubscribers=function(){return _.union(_.keys(this.legacySubscribers),_.keys(this.rawSubscribers))||[]},Zt.prototype.subscribe=function(t,e,i){i=i?this.rawSubscribers:this.legacySubscribers;return!i[t]&&(i[t]=e,!0)},Zt.prototype.subscriberCount=function(){return this.subscriberLegacyCount()+this.subscriberRawCount()},Zt.prototype.subscriberLegacyCount=function(){return _.keys(this.legacySubscribers).length},Zt.prototype.subscriberRawCount=function(){return _.keys(this.rawSubscribers).length},Zt.prototype.unsubscribe=function(t){return this.legacySubscribers[t]?(delete this.legacySubscribers[t],!0):!!this.rawSubscribers[t]&&(delete this.rawSubscribers[t],!0)},Zt.prototype.unsubscribeAll=function(){return this.legacySubscribers={},this.rawSubscribers={},!0},Zt.prototype.callSubscriber=function(e,t,i,n,o,r){if(t)try{t.apply(e,Array.prototype.slice.call(arguments,2))}catch(t){this.onSubscriberError(e,t)}},Zt.prototype.onSubscriberError=function(t,e){tt.Log.Error("ERROR: Subscriber error!",e)},tt.Agent=Zt,et=zt=zt||{},Jt.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]},Jt.prototype.listenTo=function(t,e,i){},Jt.prototype.stopListening=function(t,e,i){},Jt.prototype.initialize=function(){this.setSubscription(),this.initializeEvents()},Jt.prototype.initializeEvents=function(){this.listenTo(this.mappings,"add reset remove",this.onMappingsCollectionChange),this.listenTo(this.mappings,"change:key",this.onMappingItemKeyChange),this.listenTo(this.mappings,"change:viewstate",this.onMappingItemViewStateChange),this.listenTo(this.model,"change:key",this.onMappingKeyChange),this.listenTo(this.model,"change:value",this.onMappingValueChange)},Jt.prototype.addMapping=function(){var t=this.getPossibleKeys(),e=_.difference(t,this.mappings.map(function(t){return t.get("key")})),e=e?e[0]:t[0]||"",t=_.isString(e)?this.viewState.getByPath(e):"";this.mappings.add({key:e,value:this.getValue(e),viewstate:t||""})},Jt.prototype.cleanUp=function(){this.stopListening(),this.mappings.reset(),this.setSubscription()},Jt.prototype.generateValues=function(){this.mappings.each(function(t){t.set("value",this.getValue(t.get("key")))}.bind(this))},Jt.prototype.getColumns=function(){return this.columns||[]},Jt.prototype.getPossibleKeys=function(){return this.data?_.keys(this.data):[]},Jt.prototype.getValue=function(t){return this.data?this.data[t]:void 0},Jt.prototype.onData=function(t,e,i){var n,o=this.model.get("key"),r=this.model.get("value"),s={},a=[],l=this.mappings.reduce(function(t,e){return t[e.get("key")]=e.get("viewstate"),t},{}),u=e.cols?e.cols[o]?e.cols[o].length:0:(n=e.collection.models.map(function(t){return t.attributes})).length;this.columns=t.columns.collection.map("id"),this.columns.length&&!_.isEqual(this.columns,["unknown0"])&&(this.model.get("key")&&_.includes(this.columns,this.model.get("key"))||this.model.set("key",(_.intersection(this.columns,["k","Key","key"])||[])[0]||this.columns[0]||""),this.model.get("value")&&_.includes(this.columns,this.model.get("value"))||this.model.set("value",(_.intersection(this.columns,["v","Val","val"])||[])[0]||this.columns[1]||""));for(var c=0;c<u;c++){var p=n?n[c][o]:e.cols[o].getValue(c);s[p]=n?et.Tools.convertKDBToViewstateValue(n[c][r]):(e.cols[r]&&e.cols[r].toViewState(c)||{}).value,a.push({Key:p,Viewstate:l[p]})}this.data=s,this.trigger("on-data"),_.each(a,function(t){var e=t.Key,e=s[e],t=_.isString(t.Viewstate)?this.viewState.getByPath(t.Viewstate):t.Viewstate&&t.Viewstate.path?this.viewState.getByPath(t.Viewstate.path):null;_.isObject(e)&&_.each(e,function(t){t&&t._type&&(t.type=t._type,delete t._type)}),t&&_.isFunction(t.set)&&!_.isUndefined(e)&&t.setModelValue(e)}.bind(this))},Jt.prototype.onMappingItemKeyChange=function(t){t.set("value",this.getValue(t.get("key"))),this.setDataModel()},Jt.prototype.onMappingItemViewStateChange=function(){this.setDataModel()},Jt.prototype.onMappingKeyChange=function(){this.generateValues(),this.setDataModel(),this.trigger("key-change")},Jt.prototype.onMappingsCollectionChange=function(){this.setSubscription(),this.setDataModel(),this.trigger("mappings-change")},Jt.prototype.onMappingValueChange=function(){this.generateValues(),this.setDataModel(),this.trigger("value-change")},Jt.prototype.removeMapping=function(t){this.mappings.remove(t)},Jt.prototype.resetMappings=function(){var e=this;this.mappings.reset(_.map(this.getPossibleKeys(),function(t){return new m.Model({key:t,value:e.getValue(t),viewstate:""})})),this.onMappingsCollectionChange()},Jt.prototype.setDataModel=function(){this.setDataModelMappings(this.toJSON())},Jt.prototype.setSubscription=function(t){this.mappings.isEmpty()&&!t?this.subscribed&&(this.subscribed=!1,this.unsubscribe(this.subscriptionKey)):this.subscribed||(this.subscribed=!0,this.subscribe(this.subscriptionKey,{onData:this.onData.bind(this)}))},Jt.prototype.toJSON=function(){return{key:this.model.get("key"),mappings:this.mappings.reduce(function(t,e){var i=e.get("key"),e=e.get("viewstate");return e instanceof et.DocumentViewModel?t[i]={_dashboardsType:"viewstate",value:e.path}:t[i]=e,t},{}),value:this.model.get("value")}},et.DataMapper=Jt,K=zt=zt||{},te.prototype.assign=function(t){this.collection=t},te.prototype.items=function(){return this.reset||_.map(this.collection.models,function(t){return t.attributes})},K.ChangeSet=te,function(u){var s={1212:!0,1213:!0,1214:!0,1215:!0,1216:!0,1217:!0,1218:!0,1219:!0};m.Model;function e(t,e,i){if(null==t)return this;var n,o;for(o in"object"==typeof t?(n=t,0):(n={})[t]=e,this.changed={},n){var r=this.attributes[o];e=n[o],(r&&e&&"object"==typeof r&&"object"==typeof e?s[r.class]&&s[e.class]?r.i===e.i&&r.n===e.n:_.isEqual(r,e):r==e)||(this.attributes[o]=this.changed[o]=e)}return this.idAttribute in n&&(this.id=this.get(this.idAttribute)),this}function i(){return!!this.hasChanged()&&this.changed}var t=(g.columnsToCollection=function(t){var e=new m.Collection;return e.models=t.map(function(t){var e=new m.Model;return e.id=t.id,e.attributes=t,e}),e.length=t.length,e},g.updateColumns=function(e,t,i,n){var r=[],s=[],o=t.columns||[],t=[];return n||_.isEmpty(e)?(e={},o.forEach(function(t){return e[t.id]=t}),i.reset=o):(o.forEach(function(t){var i,n,o=e[t.id];o?(n=!(i={}),_.each(t,function(t,e){o[e]!==t&&(n=!0,i[e]=t)}),n&&s.push(_.extend(i,{id:t.id}))):r.push(t)}),(t=(n=_.values(e)).length+r.length>o.length?_.reject(n,function(e){return _.find(o,function(t){return t.id===e.id})}):t).forEach(function(t){return delete e[t.id]}),r.forEach(function(t){return e[t.id]=t}),r.length&&(i.add=r),s.length&&(i.change=s),t&&t.length&&(i.remove=t)),e},g.prototype.addOrExtendExisting=function(t,e,i){var n=t[e=_.isObject(e)?e.toString():e];return n?(_.extend(n,i),!1):(t[e]=i,!0)},g.prototype.addSubscribeFunctions=function(t){var e=this;return t.forEach(function(t){var i=e.collection.get(t[e.primaryKey]);i&&(i.subscribe&&(t.subscribe=function(t,e){i.subscribe(t,e)}),i.unsubscribe&&(t.unsubscribe=function(t){i.unsubscribe(t)}))}),t},g.prototype.background=function(){this.preferBackground=!0},g.prototype.cleanUp=function(){this.columnDict={},this.columns=g.columnsToCollection([]),this.collection.reset(),this.visibilityChangeHandler&&document.removeEventListener("visibilitychange",this.visibilityChangeHandler)},g.prototype.flushUpdates=function(){this.tempDataSet&&(this.onDataInternal({breakdownColumns:this.tempDataSet.breakdownColumns,columns:_.values(this.tempDataSet.columnDict),paging:this.tempDataSet.pagingMeta},this.tempDataSet.collection.models.map(function(t){return t.attributes}),this.tempDataSet.forceReset),delete this.tempDataSet,this.preferBackground=!1)},g.prototype.indexArray=function(t){var e,i;if(this.lazyLoading)for(i=this.pagingMeta.startRows,e=0;e<t.length;e+=1,i+=1)t[e][g.DEFAULT_ROW_INDEX]=i;else for(e=0;e<t.length;e+=1)t[e][g.DEFAULT_ROW_INDEX]=e},g.prototype.isBackground=function(){return!this.noBackground&&(this.preferBackground||document.hidden&&!("FSBL"in window))},g.prototype.isEmpty=function(){return!(this.collection&&this.collection.models&&this.collection.models.length)&&(!this.tempDataSet||this.tempDataSet.isEmpty())},g.prototype.mergeData=function(t,e,i,n){var o,r,s,a,l,u=this,c={},p={},d=[],h=[];if(u.primaryKey===g.DEFAULT_ROW_INDEX&&u.indexArray(t),0===u.collection.length&&0<t.length)t.forEach(function(t){_.isNull(t[u.primaryKey])&&(t[u.primaryKey]=""),d.push(t)}),i.reset=d,u.collection.model&&u.collection.model.prototype.defaults?u.collection.reset(d):u.collection.reset(d.map(function(t){var e=new u.collection.model;return e.attributes=t,e.idAttribute in t&&(e.id=t[e.idAttribute]),e})),u.addSubscribeFunctions(d);else{for(o=0;o<t.length;o+=1)_.isNull(t[o][u.primaryKey])&&(t[o][u.primaryKey]=""),r=t[o][u.primaryKey],r=_.isObject(r)?r.toString():r,!c[r]&&u.collection.get(r)?u.addOrExtendExisting(p,r,t[o]):u.addOrExtendExisting(c,r,t[o])&&d.push(t[o]);l=[],e?l=u.collection.filter(function(t){return r=t.get(u.primaryKey),!(_.has(p,r)||_.has(c,r))}):(a=u.collection.length+d.length,(a-=(l=a>u.maxRows?u.collection.models.slice(0,a-u.maxRows):l).length)>u.maxRows&&(d=d.slice(a-u.maxRows))),l.length&&(u.collection.remove(l),n||(i.remove=_.map(l,function(t){return t.attributes}))),_.each(p,function(t){r=t[u.primaryKey],(s=u.collection.get(r))&&(s.set(t),n||(t=s.changedAttributes())&&(t[u.primaryKey]=r,h.push(t)))}),u.collection.add(d),u.addSubscribeFunctions(d),n||(d.length&&(i.add=d),h.length&&(i.change=h),e&&0===t.length&&!(i.add||i.change||i.remove)&&(i.reset=[]))}},g.prototype.onData=function(t,e,i,n,o){if(this.isBackground())return this.tempDataSet||(this.tempDataSet=new g({idAttribute:this.idAttribute,collectionFunc:this.collectionFunc,agent:new u.Agent,maxRows:this.maxRows,primaryKey:this.primaryKey}),this.tempDataSet.forceReset=!1),this.tempDataSet.onDataInternal(t,e,i,n,void 0,!0),void(i&&(this.tempDataSet.forceReset=!0));this.onDataInternal(t,e,i,n,o)},g.prototype.onDataInternal=function(t,e,i,n,o,r){var s,a=new u.ChangeSet(this.collection),l=new u.ChangeSet(void 0);t&&(_.isUndefined(t.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns),this.columnDict=g.updateColumns(this.columnDict,t,l,r),l.remove&&(s=l.remove.map(function(t){return t.id}),this.collection.models.forEach(function(e){s.forEach(function(t){delete e.attributes[t],delete e.changed[t]})}))),this.pagingMeta=t.paging,e&&(this.mergeData(e,i,a,r),u.Log.Info("Data: "+this.updateSetCountToString(a,this.collection.models))),r||(l={primaryKey:this.primaryKey,columns:l},n=n||void 0,this.pagingMeta&&(l.paging=this.pagingMeta),_.isArray(this.breakdownColumns)&&(l.breakdownColumns=this.breakdownColumns,l.breakdownColumns instanceof m.Model&&(l.breakdownColumns=l.breakdownColumns.get("value"))),o&&o.trigger("onAgentNotify"),l.columns.assign(this.columns=g.columnsToCollection(_.values(this.columnDict))),this.agent.notifyAllLegacyChange(l,a,n,o))},g.prototype.onDataRefresh=function(t){var e=_.values(this.columnDict),i=new u.ChangeSet(this.collection),n=new u.ChangeSet(this.columns),o={};n.reset=e,o={primaryKey:this.primaryKey,columns:n},_.isArray(this.breakdownColumns)&&(o.breakdownColumns=this.breakdownColumns,o.breakdownColumns instanceof m.Model&&(o.breakdownColumns=o.breakdownColumns.get("value"))),this.pagingMeta&&(o.paging=this.pagingMeta),i.reset=this.addSubscribeFunctions(this.collection.map(function(t){return t.attributes})),t?this.agent.notifyChange(t,o,i):this.agent.notifyAllLegacyChange(o,i)},g.prototype.updateSetCountToString=function(t,e){return(t.add?" +"+t.add.length:"")+(t.remove?" -"+t.remove.length:"")+(t.change?" ~"+t.change.length:"")+(t.reset?" ="+t.reset.length:"")+" ==>"+e.length},g.DEFAULT_ROW_INDEX="_rowIndex",g);function g(t){this.breakdownColumns=[],this.columns=new m.Collection,this.columnDict={},this.preferBackground=!1,this.breakdownColumns=[],this.agent=t.agent,this.collection=new t.collectionFunc,this.collectionFunc=t.collectionFunc,this.collection.model.prototype.set=e,this.collection.model.prototype.changedAttributes=i,this.idAttribute=t.idAttribute,this.maxRows=t.maxRows||100,this.primaryKey=t.primaryKey||g.DEFAULT_ROW_INDEX,this.lazyLoading=t.lazyLoading||!1}u.DataSet=t}(zt=zt||{}),it=zt=zt||{},ee.prototype.cleanUp=function(){this.columnDict={},this.columns=it.DataSet.columnsToCollection([]),this.cols=void 0},ee.prototype.indexArray=function(t){for(var e=0;e<t.length;e+=1)t[e][it.DataSet.DEFAULT_ROW_INDEX]=e},ee.prototype.isEmpty=function(){var t=Object.keys(this.columnDict);return!this.cols||0==t.length||!this.cols[t[0]]||0==this.cols[t[0]].length},ee.prototype.onData=function(t,e,i,n,o){var r,s,a=this,l=new it.ChangeSet(this.collection),u=new it.ChangeSet(void 0),c={},n=n||void 0;t&&(_.isUndefined(t.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns),this.columnDict=it.DataSet.updateColumns(this.columnDict,t,u)),c={primaryKey:this.primaryKey,columns:u},this.pagingMeta=t.paging,this.pagingMeta&&(c.paging=this.pagingMeta),_.isArray(this.breakdownColumns)&&(c.breakdownColumns=this.breakdownColumns,c.breakdownColumns instanceof m.Model&&(c.breakdownColumns=c.breakdownColumns.get("value"))),i||!this.cols?this.cols=e:null==this.primaryKey||"_rowIndex"===this.primaryKey?_.each(e,function(t,e){var i=a.cols[e];i&&(t.length<i.length?t.qtype!==i.qtype?it.Log.Error("Column '"+e+"': meta mis-match - cannot merge kdb type "+t.qtype+" -> "+i.qtype):i.mergeIndexed(t):a.cols[e]=t)}):(i=this.cols[this.primaryKey],e[this.primaryKey]&&e[this.primaryKey].length>=this.maxRows?this.cols=e:(s=i.mergeKeyedPrimary(e[this.primaryKey],this.maxRows,r=[]),_.each(e,function(t,e){var i;e!==a.primaryKey&&((i=a.cols[e])?i.mergeKeyed(t,r,s,a.maxRows):a.cols[e]=t)}))),l.cols=this.cols,u.assign(this.columns=it.DataSet.columnsToCollection(_.values(this.columnDict))),this.agent.notifyAllRawChange(c,l,n,o)},ee.prototype.onDataRefresh=function(t){var e=_.values(this.columnDict),i=new it.ChangeSet(this.collection),n=new it.ChangeSet(this.columns);n.reset=e;n={primaryKey:this.primaryKey,columns:n};_.isArray(this.breakdownColumns)&&(n.breakdownColumns=this.breakdownColumns,n.breakdownColumns instanceof m.Model&&(n.breakdownColumns=n.breakdownColumns.get("value"))),this.pagingMeta&&(n.paging=this.pagingMeta),i.cols=this.cols,t?this.agent.notifyChange(t,n,i):this.agent.notifyAllRawChange(n,i)},ee.prototype.updateSetCountToString=function(t,e){return(t.add?" +"+t.add.length:"")+(t.remove?" -"+t.remove.length:"")+(t.change?" ~"+t.change.length:"")+(t.reset?" ="+t.reset.length:"")+" ==>"+e.length},it.DataSet2=ee,(zt||(zt={})).LegacyUpdate=function(t,e,i,n){this.table=t,this.forceReset=e,this.pagingMeta=i,this.pivotMeta=n},(zt||(zt={})).ViewStateBinding=function(t,e){this.callback=t,this.model=e},function(a){var t,i;function n(t){var e=i.call(this,t)||this;return e.options=t,e.setSchema(),e}t=a.DataFilter||(a.DataFilter={}),i=m.Model,C(n,i),n.prototype.defaults=function(){return{propertyName:null,propertyType:null,operator:null,value:null,value2:null,active:!0,type:"normal",compareFields:!1}},n.prototype.getBindingValue=function(e){var t=_.find(this.get("appModel").get("settingsModel").get("Bindings"),function(t){return t.Key===e});return t&&t.ViewState instanceof a.DocumentViewModel?t.ViewState.get("value"):""},n.prototype.getTypeOperators=function(t){void 0===t&&(t=null);function e(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];_.each(t,function(t){return i.push.apply(i,t)})}var i=[],n={equal:[{label:"equal",val:"equal"},{label:"not equal",val:"not_equal"}],like:[{label:"like",val:"like"},{label:"not like",val:"not_like"}],blank:[{label:"is blank",val:"is_blank"},{label:"is not blank",val:"is_not_blank"}],compare:[{label:"less",val:"less"},{label:"less or equal",val:"less_or_equal"},{label:"greater",val:"greater"},{label:"greater or equal",val:"greater_or_equal"}],in:[{label:"in",val:"in"},{label:"not in",val:"not_in"}]};switch(this.get("compareFields")&&(n.like=n.blank=n.in=[]),e(n.equal),t){case 0:e(n.like,n.blank);break;case 5:case 6:case 7:case 8:case 9:case 4:e(n.compare,n.blank,n.in);break;case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:e(n.compare,n.blank);break;case 11:e(n.in,n.like,n.blank);break;case 2:e(n.in,n.blank);break;case 10:case 1:e(n.blank)}return i},n.prototype.replaceBindings=function(t){var e=this;return _.isString(t)&&this.get("appModel").get("Bindings")?t.replace(n.VSRx,function(t){t=t.substring(2,t.length-2);return e.getBindingValue(t)}):t},n.prototype.setSchema=function(){var i,t,n,o,e,r=this,s=this.get("propertyType");"histogram"===this.get("type")?(i=[5,6,7,8,9,12,13,14,15,16,17,18,19],t=this.options.appModel.get("data.items").filter(function(t,e){return _.includes(i,r.options.appModel.get("data.meta.columns.models")[e].get("kdbType"))}).map(function(t){return{label:t.get("propertyName"),val:t.get("propertyName")}}),this.schema={active:{title:"Is Active:",type:"Checkbox"},propertyName:{title:"Property:",type:"Select",options:_.sortBy(t,"label")},value:_.extend({title:"From"},a.RTTI.getByQTypeNum(s||11).editor),value2:_.extend({title:"To"},a.RTTI.getByQTypeNum(s||11).editor)}):(t=this.options.appModel.get("data.items").map(function(t){return{label:t.get("propertyName"),val:t.get("propertyName")}}),this.schema={active:{title:"Is Active:",type:"Checkbox"},propertyName:{title:"Property:",type:"Select",options:_.sortBy(t,"label")},operator:{title:"Operator:",type:"Select",options:this.getTypeOperators(s)},value:_.extend({title:"Value"},a.RTTI.getByQTypeNum(s||11).editor)}),this.get("compareFields")?this.schema.value={title:"Value",type:"Select"}:this.get("operator")&&this.get("propertyName")&&_.some(["in","not_in","equal","not_equal","greater","less","greater_or_equal","less_or_equal"],function(t){return t===r.get("operator")})&&(t=this.options.appModel.get("data.items").get(this.get("propertyName")),s=0<=_.indexOf(["equal","not_equal","greater","less","greater_or_equal","less_or_equal"],this.get("operator")),t&&(e=null,t.get("result")&&t.get("result").data?(n=t.get("DataSourceMapping.Text")||this.get("propertyName"),o=t.get("DataSourceMapping.Value")||this.get("propertyName"),e=t.get("result").data.collection.map(function(t){var e=t.get(n),t=t.get(o);return{label:_.isBoolean(e)?e+"":e,val:_.isBoolean(t)?t+"":t}}),(e=_.uniqBy(_.reject(e,function(t){return _.isNil(t.label)}),function(t){return t.label})).length<=0&&this.get("value")&&_.isArray(this.get("value"))&&0<this.get("value").length&&_.each(this.get("value"),function(t){e.push({label:t,val:t})}),e.splice(0,0,{label:"",val:""}),this.schema.value={title:"Value",type:s?"Select":"MultiSelect",options:e,modelKey:"value"}):0<t.get("items").length?((e=_.map(t.get("items"),function(t){return{label:t.Text,val:t.Value}})).splice(0,0,{label:"",val:""}),this.schema.value={title:"Value",type:s?"Select":"MultiSelect",options:e,modelKey:"value"}):s||(this.schema.value=_.extend({title:"Value"},a.RTTI.getByQTypeNum(0).editor))))},n.prototype.isValueValid=function(t){return!!_.includes(["is_not_blank","is_blank"],this.get("operator"))||!(_.isUndefined(t)||_.isNull(t)||""===t)},n.prototype.toJSON=function(){var t="histogram"===this.get("type")?_.pick(this.attributes,"propertyName","propertyType","value","value2","active","type"):_.pick(this.attributes,"propertyName","propertyType","operator","value","active","type","compareFields");return null===t.propertyType&&(t.propertyType=11),t},n.prototype.toIPC=function(){return"histogram"===this.get("type")?this.toIPCHistogram():this.toIPCNormal()},n.prototype.toIPCHistogram=function(){var t=new Uint8Array([102,5]),e=[],i=this.get("propertyName"),n=this.get("propertyType"),o=7===n?Math.ceil(this.get("value")):this.get("value"),r="greater_or_equal",s=7===n?Math.floor(this.get("value2")):this.get("value2"),n="less_or_equal";return this.get("active")&&i&&this.isValueValid(o)&&this.isValueValid(s)?(e.push(this.toIPCNormal(i,r,o)),e.push(this.toIPCNormal(i,n,s)),a.ipc.List.toIPC([t].concat(e))):null},n.prototype.toIPCNormal=function(t,e,i){var n=this;void 0===e&&(e=null),void 0===i&&(i=null),t=(t=void 0===t?null:t)||this.get("propertyName"),e=e||this.get("operator"),i=this.replaceBindings(i||this.get("value"));var o=-this.get("propertyType")||10;if(this.get("active")&&t&&e&&this.isValueValid(i)){t=a.ipc.Util.getType(o);return i=this.get("compareFields")&&i===this.get("value")?a.ipc.Symbol.toIPC(i):"in"===e||"not_in"===e?(_.isArray(i)||(i=null===i?[]:[i]),t.listToIPC(_.map(i,function(t){return n.typeCast(t)}))):(-1===o&&_.isString(i)&&(i="true"===i),t.toIPC(a.ipc.fromString(t,i))),a.ipc.Dict.toIPC(["src","comparison","value","dataType","compareFields"],a.ipc.List.toIPC(_.map([this.get("propertyName"),e],function(t){return a.ipc.Symbol.toIPC(t)}).concat([i,a.ipc.Short.toIPC(o),a.ipc.Boolean.toIPC(this.get("compareFields"))])))}return null},n.prototype.toKDB=function(){var t,e;return this.get("active")&&this.get("propertyName")&&this.get("operator")&&this.isValueValid(this.get("value"))?(e="in"===this.get("operator")||"not_in"===this.get("operator")?(t=a.RTTI.getByQTypeNum(0),e=this.get("value"),t.toKDBInput(e)):(t=a.RTTI.getByQTypeNum(this.get("propertyType")||11)).toKDBInput(this.get("value")),"(`src`comparison`value!(`"+this.get("propertyName")+";`"+this.get("operator")+";"+e+"))"):null},n.prototype.typeCast=function(t){switch(this.get("propertyType")){case 4:case 5:case 6:case 7:case 8:case 9:if(!_.isNaN(Number(t)))return Number(t)}return null!==t?""+t:""},n.prototype.validate=function(t,e){var i,e=isNaN(t)||isNaN(e)?(i=y(t),y(e)):(i=new Number(t),new Number(e));return e<=i},n.VSRx=/^<%[^<>%]*%>$/i,t.RuleModel=n}(zt=zt||{}),function(n){var o,r;function s(e){var i,t=r.call(this,e)||this,n=t.get("children");return n&&!_.isArray(n)||(i=new m.Collection,_.each(n||[],function(t){_.extend(t,{appModel:e.appModel}),t=new(t.hasOwnProperty("children")?s:o.RuleModel)(t),i.add(t)}),t.set("children",i)),0<t.get("children").length&&t.set("active",!0,{silent:!0}),t.listenTo(t.get("children"),"add remove reset change",function(){0<t.get("children").filter(function(t){return t.get("active")}).length?t.set("active",!0):t.set("active",!1),t.trigger("change")}),t}o=n.DataFilter||(n.DataFilter={}),r=m.Model,C(s,r),s.prototype.defaults=function(){return{children:new m.Collection,operator:"AND",active:!1}},s.prototype.isNull=function(){return _.every(this.get("children").filter(function(t){return t.get("active")}),function(t){return t instanceof s?t.isNull():_.isNull(t.toIPC())})},s.prototype.toJSON=function(){return{operator:this.get("operator"),children:this.get("children").toJSON()}},s.prototype.toIPC=function(){var e,i=new Array,t=this.get("children").filter(function(t){return t.get("active")});0<t.length&&_.each(t,function(t){(e=t instanceof s&&t.isNull()?null:t.toIPC())&&i.push(e)});t=new Uint8Array([102,"AND"===this.get("operator")?5:6]);return n.ipc.List.toIPC([t].concat(i))},s.prototype.toKDB=function(){var e,t="("+this.get("operator")+";",i=[];return 0<this.get("children").length?(this.get("children").each(function(t){(e=t.toKDB())&&i.push(e)}),i.length<=0?null:(t+=i.join(";"))+")"):null},o.GroupModel=s}(zt=zt||{}),function(e){var i,t;function n(){return null!==t&&t.apply(this,arguments)||this}i=e.DataFilter||(e.DataFilter={}),t=m.View,C(n,t),n.generateIpcHexMessage=function(t){t=new i.GroupModel(_.extend({appModel:new m.DeepModel({"data.items":new m.Collection})},t));return e.ipc.Util.toHexString(e.ipc.Util.toMessage(t.toIPC()))},i.App=n}(zt=zt||{}),function(t){var e;function s(t){this.id=t.id,this.group=t.group,t.meta&&(this.meta=t.meta),"result"!==this.group&&(this.data=t.data||{})}e=t.QueryBuilder||(t.QueryBuilder={}),s.getBindingKeysFromArray=function(t,e){return t.concat(_.filter(e,function(t){return _.isString(t)&&s.VSRx.exec(t)}).map(function(t){return t.substring(2,t.length-2)}))},s.getActiveBindingKeys=function(t){return[]},s.replaceAllBindings=function(t,e){void 0===e&&(e="value"),_.each(t,function(t){!t[e]&&t.children?s.replaceAllBindings(t.children):t[e]="string"==typeof t[e]&&s.VSRx.test(t[e])?s.replaceBindings(t[e]):t[e]})},s.replaceBindings=function(t){var e=t.substring(2,t.length-2);if(s.viewModel){t=s.viewModel.getByPath(e);return t&&t.get("value")}return s.bindings[e]},s.replaceKeys=function(t){var o=this,r=!1;_.each(t,function(t,e,i){var n;s.VSRx.exec(e)&&(n=e.replace(s.VSRx,s.replaceBindings.bind(o)),r=!0),r&&(delete i[e],i[n||e]=t)})},s.prototype.toIPC=function(){return t.ipc.Dict.toIPC(["type","data"],t.ipc.List.toIPC([t.ipc.Symbol.toIPC(this.group),e.App.groupToClass[this.group].dataToIPC(this.data)]))},s.bindings={},s.VSRx=/^<%[^<>%]*%>$/i,e.GraphNode=s}(zt=zt||{}),function(n){var e,t;function o(){return null!==t&&t.apply(this,arguments)||this}e=n.QueryBuilder||(n.QueryBuilder={}),t=e.GraphNode,C(o,t),o.partitionParameterToIPC=function(t,e){return t instanceof Array?n.ipc.List.toIPC(t.map(function(t){return e.toIPC(n.ipc.fromString(e,""+t))})):e.toIPC(n.ipc.fromString(e,""+t))},o.dataToIPC=function(t){if((t=o.processBindings(t)).name&&t.params)return n.ipc.List.toIPC([n.ipc.Symbol.toIPC(t.name)].concat(o.recursiveToIPC(t.params)));if(t.name&&t.partition){var e=n.RTTI.getByName(t.partition.type).num,i=n.ipc.Util.getType("-"+e),e="equals"===t.partition.operator?8:"in"===t.partition.operator?23:24;return n.ipc.Dict.toIPC(["table","operator","type","values"],n.ipc.List.toIPC([n.ipc.Symbol.toIPC(t.partition.name),new Uint8Array([102,e]),n.ipc.Symbol.toIPC("long"===t.partition.type?"year":t.partition.type),1<t.partition.parameters.length?n.ipc.List.toIPC(t.partition.parameters.map(function(t){return o.partitionParameterToIPC(t.value,i)})):o.partitionParameterToIPC(t.partition.parameters[0].value,i)]))}return n.ipc.QString.toIPC(t)},o.processBindings=function(t){return(t=_.cloneDeep(t))&&t.params?o.replaceAllBindings(t.params):t&&t.partition&&o.replaceAllBindings(t.partition.parameters),t},o.getActiveBindingKeys=function(t){return t.params?t.params.filter(function(t){return!!_.isString(t.value)&&e.GraphNode.VSRx.exec(t.value)}).map(function(t){return t.value.substring(2,t.value.length-2)}):[]},o.recursiveToIPC=function(t){return _.flatten(_.map(t,function(t){var e=n.RTTI.getByName("list"===t.type?"List":t.type),i=e?e.num:11;return 98===i?o.recursiveToIPC(t.value):(7===i&&""===t.value&&(t.value="0"),e=n.ipc.Util.getType(0<i?"-"+i:""+i)||n.ipc.Util.getType("-11"),0===i&&t.value instanceof Array?e.toIPC(t.value.map(function(t){return n.ipc.Symbol.toIPC(t)})):e.toIPC(n.ipc.fromString(e,t.value)))}))},e.DataNode=o}(zt=zt||{}),function(e){var t,i;function n(){return null!==i&&i.apply(this,arguments)||this}t=e.QueryBuilder||(e.QueryBuilder={}),i=t.GraphNode,C(n,i),n.dataToIPC=function(t){return t=n.processBindings(t),e.ipc.Dict.toIPC(["select","where","distinct"],e.ipc.List.toIPC([e.ipc.Dict.toIPC(_.keys(t.select),e.ipc.Symbol.listToIPC(_.values(t.select))),e.ipc.Util.fromHexString(e.DataFilter.App.generateIpcHexMessage(t.where).slice(16)),e.ipc.Boolean.toIPC(t.distinct)]))},n.getActiveBindingKeys=function(t){var e=[];return _.each(t.where.children,function(t){return e=n.getBindingKeysFromArray(e,_.keys(t))}),n.getBindingKeysFromArray(e,_.keys(t.select))},n.processBindings=function(t){return t=_.cloneDeep(t),this.replaceAllBindings(t.where.children),this.replaceKeys(t.select),t},n.operatorMap={AND:" and ",OR:" or ",equal:"=",in:" in ",like:" like ",greater_or_equal:">=",less:"<",less_or_equal:"<=",greater:">",is_blank:" is blank",not_equal:"!=",not_in:" not in ",not_like:" not like ",is_not_blank:" is not blank"},t.FilterNode=n}(zt=zt||{}),function(e){var i,t;function n(){return null!==t&&t.apply(this,arguments)||this}i=e.QueryBuilder||(e.QueryBuilder={}),t=i.GraphNode,C(n,t),n.dataToIPC=function(t){return t=n.processBindings(t),e.ipc.Dict.toIPC(["groupBy","agg"],e.ipc.List.toIPC([e.ipc.Dict.toIPC(_.keys(t.groupBy),e.ipc.List.toIPC(_.values(t.groupBy).map(function(t){return _.isString(t)?e.ipc.Symbol.toIPC(t):e.ipc.Dict.toIPC(_.keys(t),e.ipc.Symbol.listToIPC(_.values(t)))}))),_.isEmpty(t.agg)?e.ipc.List.toIPC([]):e.ipc.Dict.toIPC(_.keys(t.agg),e.ipc.List.toIPC(_.map(_.values(t.agg),function(t){return e.ipc.Symbol.listToIPC(t.map(function(t){return String(t)}))})))]))},n.getActiveBindingKeys=function(t){return n.getBindingKeysFromArray([],_.union(_.keys(t.agg),_.keys(t.groupBy)))},n.processBindings=function(t){return t=_.cloneDeep(t),i.GraphNode.replaceKeys(t.agg),i.GraphNode.replaceKeys(t.groupBy),t},i.GroupByNode=n}(zt=zt||{}),function(e){var t,i;function n(t){t=i.call(this,t)||this;return _.isEmpty(t.data)&&(t.data={fn:"lj",swap:!1,left:[],right:[]}),t}t=e.QueryBuilder||(e.QueryBuilder={}),i=t.GraphNode,C(n,i),n.dataToIPC=function(t){return t?e.ipc.Dict.toIPC(["fn","swap","left","right"],e.ipc.List.toIPC([e.ipc.Symbol.toIPC(t.fn),e.ipc.Boolean.toIPC(t.swap),e.ipc.List.toIPC(_.map(t.left,function(t){return e.ipc.Symbol.toIPC(String(t))})),e.ipc.List.toIPC(_.map(t.right,function(t){return e.ipc.Symbol.toIPC(String(t))}))])):e.ipc.Int.toIPC(null)},t.JoinNode=n}(zt=zt||{}),function(t){var e,i;function n(){return null!==i&&i.apply(this,arguments)||this}e=t.QueryBuilder||(t.QueryBuilder={}),i=e.GraphNode,C(n,i),n.dataToIPC=function(){return t.ipc.Int.toIPC(null)},e.ResultNode=n}(zt=zt||{}),function(i){var e,t;function n(){return null!==t&&t.apply(this,arguments)||this}e=i.QueryBuilder||(i.QueryBuilder={}),t=e.GraphNode,C(n,t),n.dataToIPC=function(t){return t=n.processBindings(t),i.ipc.Dict.toIPC(["filter","update"],i.ipc.List.toIPC([i.ipc.Util.fromHexString(i.DataFilter.App.generateIpcHexMessage(t.filter).slice(16)),i.ipc.Dict.toIPC(_.map(t.update,"column"),i.ipc.List.toIPC(_.map(t.update,function(t){var e=i.ipc.Util.getType(t.propertyType),e=e.toIPC(i.ipc.fromString(e,t.val));return-11===t.propertyType?i.ipc.List.toIPC([e]):e})))]))},n.getActiveBindingKeys=function(t){var e=[];return _.each(t.filter.children,function(t){return e=n.getBindingKeysFromArray(e,_.keys(t))}),_.each(t.update,function(t){return e=n.getBindingKeysFromArray(e,_.values(t))}),e},n.processBindings=function(t){return t=_.cloneDeep(t),e.GraphNode.replaceAllBindings(t.filter.children),e.GraphNode.replaceAllBindings(t.update,"val"),t},e.UpdateNode=n}(zt=zt||{}),function(u){var e,i;function s(){var t=null!==i&&i.apply(this,arguments)||this;return t.docDataModel=null,t.bindingParams=[],t}e=u.QueryBuilder||(u.QueryBuilder={}),i=m.View,C(s,i),s.calculateReverseEdges=function(t){t=_.reduce(t,function(e,t,i){return _.each(t,function(t){void 0===e[t]?e[t]=[i]:e[t].push(i)}),e},{});return _.fromPairs(_.map(t,function(t,e){return[e,_.sortBy(t)]}))},s.createNode=function(t){switch(t.group){case"data":case"function":case"stream":return new e.DataNode(t);case"filter":return new e.FilterNode(t);case"groupBy":return new e.GroupByNode(t);case"join":return new e.JoinNode(t);case"update":return new e.UpdateNode(t);case"result":return new e.ResultNode(t);default:throw"Invalid node "+t}},s.graphToIPC=function(e,i,n){var o=this,r={},s={},a=this.calculateReverseEdges(i),l=function(t){_.extend(r,_.pick(e,t)),t!==n&&_.extend(s,_.pick(i,t)),_.each(a[t],function(t){l(t)})};l(n||"result"),e=r,i=s;var t=u.ipc.Dict.toIPC(["nodes","edges"],u.ipc.List.toIPC([u.ipc.Dict.toIPC(_.keys(e),u.ipc.List.toIPC(_.values(e).map(function(t){return o.createNode(t).toIPC()}))),u.ipc.Dict.toIPC(_.keys(a),u.ipc.List.toIPC(_.values(a).map(function(t){return u.ipc.List.toIPC(_.sortBy(t).map(function(t){return u.ipc.Symbol.toIPC(t)}))})))]));return u.ipc.Util.toHexString(u.ipc.Util.toMessage(t))},s.prototype.getIPC=function(t,e,i){t=JSON.parse(t);return this.docDataModel=i,t=this.replaceBindingsInGraph(t),s.graphToIPC(t.nodes,t.edges,e)},s.prototype.replaceBindings=function(t){var e=t.substring(2,t.length-2),e=this.docDataModel.getViewState().getByPath(e);return this.bindingParams.push({value:t}),e&&e.get("value")},s.prototype.replaceBindingsInGraph=function(t){var i=this;return this.bindingParams=[],_.values(t.nodes).forEach(function(e){[{type:"params",value:"value",children:null},{type:"filter",value:"value",children:"children"},{type:"where",value:"value",children:"children"},{type:"update",value:"val",children:null}].forEach(function(t){return e.data&&e.data[t.type]&&i.replaceAllBindings(e.data[t.type],t.value,t.children)}),["select","agg","groupBy"].forEach(function(t){return e.data&&e.data[t]&&i.replaceKeys(e.data[t])})}),this.docDataModel.set("_builderParams",this.bindingParams),t},s.prototype.replaceAllBindings=function(t,e,i){var n=this;void 0===e&&(e="value"),void 0===i&&(i=""),_.isEmpty(i)||(t=t[i]),_.each(t,function(t){!t[e]&&t.children?n.replaceAllBindings(t.children):void 0!==t[e]&&(t[e]="string"==typeof t[e]&&s.VSRx.test(t[e])?n.replaceBindings(t[e]):t[e])})},s.prototype.replaceKeys=function(t){var o=this,r=!1;_.each(t,function(t,e,i){var n;s.VSRx.exec(e)&&(n=e.replace(s.VSRx,o.replaceBindings.bind(o)),r=!0),r&&(delete i[e],i[n||e]=t)})},s.groupToClass={data:e.DataNode,function:e.DataNode,stream:e.DataNode,filter:e.FilterNode,update:e.UpdateNode,groupBy:e.GroupByNode,join:e.JoinNode,result:e.ResultNode},s.VSRx=/^<%[^<>%]*%>$/i,e.App=s}(zt=zt||{}),nt=zt=zt||{},ot=m.Model,C(ie,ot),ie.convertDeltaClientColumnSpecToMeta=function(i){return(i.columns||[]).map(function(t,e){return{id:t,index:e,kdbType:i.meta[t]}})},ie.convertMetaToDeltaClientColumnSpec=function(t){return{columns:_.map(t,function(t){return t.id}),meta:_.fromPairs(_.map(t,function(t){return[t.id,t.kdbType]}))}},ie.prototype.apply=function(){var i=this;this.performance.trigger("apply");var n=!1;if(this.has("error")||this.set("error",null,{silent:!0}),"pivot"===this.get("_dataType")&&this.set({_dataType:"query",_pivotType:"server"},{silent:!0}),this.stop(),this.reset(),this.get("_pivotType"))this.applyPivot();else switch(this.get("_dataType")){case"query":this.applyQuery();break;case"analytic":case"builder":case"streaming":this.applyAnalytic();break;case"copy":this.applyCopy();break;case"virtual":this.applyVirtual(),n=!0}this.forceInternalReset=!0,n&&this.performance&&this.performance.trigger("serverStart"),this.updateVirtualSubscriptions(),n&&this.performance&&this.performance.trigger("serverEnd"),this.dataMapper=new nt.DataMapper({mappings:this.get("_mappings"),setMappings:function(t){i.set("_mappings",t)},subscribe:function(t,e){return i.subscribe(t,e,!n)},unsubscribe:function(t){return i.unsubscribe(t)},viewState:this.viewState}),this.dataMapper.initialize()},ie.prototype.applyCopy=function(){var t=this.get("_subscriptionKey")||nt.DataSet.DEFAULT_ROW_INDEX;this.dataSet=new nt.DataSet({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:t}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),this.execute=_.noop.bind(this)},ie.prototype.applyAnalytic=function(){function t(t,e){o.onExecuteSubscriptionSuccess(t,o.get("_forceReset"),e)}function e(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];o.onError(o,o.attributes,t,"Error",e)}var i,n,o=this,r=this.get("_subscriptionKey")||nt.DataSet.DEFAULT_ROW_INDEX,s=this.applyViewStateAttributes();this.dataSet=new nt.DataSet({idAttribute:r,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:r})}),agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:r}),this.dataSet2=new nt.DataSet2({idAttribute:r,agent:this.agent,maxRows:this.get("_maxRows"),primaryKey:r}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(!0),"subscription"===this.get("_subscriptionType")?(n=this.formatValue(s._subscriptionInterval,"_subscriptionInterval"),this.execute=this.wrapWithErrorHandler(function(){o.onExecuteBegin(),o.get("_serverPaging")&&(i={type:o.getPagingType(),num:o.get("_pagingNum")||0,size:o.get("_pageSize")||ie.DEFAULT_PAGE_SIZE,sorting:o.get("_pageSort")||{}}),o.runWithConnectionCheck(e,function(){o.updateBuilder(function(){nt.DeltaClientLib.startManagedAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,n,o.get("_maxRows")||ie.DEFAULT_MAX_ROWS,o.performance)},e)})},this,this.attributes)):"streaming"===this.get("_subscriptionType")?this.execute=this.wrapWithErrorHandler(function(){o.updateBuilder(function(){o.onExecuteBegin(),o.runWithConnectionCheck(e,function(){nt.DeltaClientLib.startStreamingAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,o.performance)})},e)},this,this.attributes):this.execute=this.wrapWithErrorHandler(function(){o.updateBuilder(function(){o.onExecuteBegin(),o.get("_serverPaging")&&(i={type:o.getPagingType(),num:o.get("_pagingNum")||0,size:o.get("_pageSize")||ie.DEFAULT_PAGE_SIZE,sorting:o.get("_pageSort")||{}}),o.runWithConnectionCheck(e,function(){nt.DeltaClientLib.runAnalytic2(o.get("_selectedAnalytic"),o.get("_connection"),o.bindViewStateToKdbParams(o.get("_analyticParams")),t,e,o.get("_maxRows")||ie.DEFAULT_MAX_ROWS,i,o.performance)})},e)},this,this.attributes)},ie.prototype.updateBuilder=function(t,e){var i,n;"builder"===this.get("_dataType")&&(i="streaming"===this.get("_subscriptionType"),n=(new nt.QueryBuilder.App).getIPC(this.get("_graphJSON"),this.get("_selectedNode"),this),i?(this.set("_selectedAnalytic",n),this.set("_analyticParams",[],{silent:!0})):(this.set("_selectedAnalytic",".queryBuilder.processGraph2"),this.set("_analyticParams",[{id:"graph",name:"graph",index:0,type:i?"symbol":"string",value:n}],{silent:!0}))),t()},ie.prototype.runWithConnectionCheck=function(t,e){var i=this.get("_connection");!this.get("_ignoreNullConnectionCheck")&&(null==i||"DC"===i)?t({message:"Invalid connection specified"}):e()},ie.prototype.applyPivot=function(){var r,s=this,a=this.get("_breakdownCols"),l={dataSource:this.get("_dataSource"),connection:this.get("_connection"),pivotSource:"query",queryString:this.get("_queryString"),queryParams:this.get("_queryParams"),breakdownCols:this.get("_breakdownCols"),aggFn:this.get("_aggFn"),ordering:this.get("_ordering"),maxRows:this.get("_maxRows"),subscriptionType:this.get("_subscriptionType"),subscriptionInterval:this.get("_subscriptionInterval"),columnLabel:this.get("_columnLabel")},i=this.applyViewStateAttributes();_.each(i,function(t,e){"_subscriptionInterval"===e?i[e]=s.formatValue(t,"_subscriptionInterval"):_.isString(t)&&(i[e]=t.trim(),i[e]=t.split(",")),l[e.replace("_","")]=t}),a=l.breakdownCols,r=m.Model.extend({idAttribute:_.last(a),getRoot:function(){return s}}),_.each(a,function(t,e){var i={},n=a[a.length-e-1],o=e===a.length-1?"id":a[a.length-e-2];_.extend(i,l,{dimensions:a.slice(0,a.length-e),wheres:a.slice(0,a.length-e-1),id:o}),r=s.generatePivotModel(o,n,r,i)}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),_.extend(this,{dataSet:new nt.DataSet({idAttribute:r.prototype.childId,collectionFunc:m.Collection.extend({model:r.prototype.childModelType||r}),agent:this.agent,maxRows:l.maxRows,primaryKey:r.prototype.childId}),dataSet2:new nt.DataSet2({idAttribute:r.prototype.childId,agent:this.agent,maxRows:l.maxRows,primaryKey:r.prototype.childId}),execute:r.prototype.execute||_.noop.bind(this),exportPivotData:r.prototype.exportPivotData,staticIdAttribute:r.staticIdAttribute})},ie.prototype.applyQuery=function(){function i(t,e){r.onExecuteSubscriptionSuccess(t,r.get("_forceReset"),e)}function n(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];r.onError(r,r.attributes,t,"Error",e)}var o,r=this,t=this.get("_subscriptionKey")||nt.DataSet.DEFAULT_ROW_INDEX,e=this.applyViewStateAttributes();this.dataSet=new nt.DataSet({idAttribute:t,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:t})}),agent:this.agent,lazyLoading:this.get("_lazyLoading"),maxRows:this.get("_maxRows"),primaryKey:t}),this.dataSet2=new nt.DataSet2({idAttribute:t,agent:this.agent,lazyLoading:this.get("_lazyLoading"),maxRows:this.get("_maxRows"),primaryKey:t}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),"subscription"===this.get("_subscriptionType")?(o=this.formatValue(e._subscriptionInterval,"_subscriptionInterval"),this.execute=this.wrapWithErrorHandler(function(){var t=null;r.onExecuteBegin();var e=r.replaceViewStateParams(r.get("_queryString"));r.get("_serverPaging")&&(t={type:r.getPagingType(),num:r.get("_pagingNum")||0,size:r.get("_pageSize")||ie.DEFAULT_PAGE_SIZE,sorting:r.get("_pageSort")||{}}),r.runWithConnectionCheck(n,function(){nt.DeltaClientLib.startManagedQuery2(r.get("_connection"),e,r.bindViewStateToKdbParams(r.get("_queryParams")),i,n,o,r.get("_maxRows")||ie.DEFAULT_MAX_ROWS,t,r.performance)})},this,this.attributes)):this.execute=this.wrapWithErrorHandler(function(){var t=null;r.onExecuteBegin();var e=r.replaceViewStateParams(r.get("_queryString"));r.get("_serverPaging")&&(t={type:r.getPagingType(),num:r.get("_pagingNum")||0,size:r.get("_pageSize")||ie.DEFAULT_PAGE_SIZE,sorting:r.get("_pageSort")||{}}),r.runWithConnectionCheck(n,function(){nt.DeltaClientLib.getQueryData2(r.get("_dataSource"),r.get("_connection"),e,r.bindViewStateToKdbParams(r.get("_queryParams")),i,n,r.get("_maxRows")||ie.DEFAULT_MAX_ROWS,t,r.performance)})},this,this.attributes)},ie.prototype.applyVirtual=function(){function t(t,e){i.onExecuteSuccess(t,i.get("_forceReset"),e)}var i=this,e=this.get("_subscriptionKey")||nt.DataSet.DEFAULT_ROW_INDEX;this.dataSet=new nt.DataSet({idAttribute:e,collectionFunc:m.Collection.extend({model:m.Model.extend({idAttribute:e})}),agent:this.agent,maxRows:9007199254740991,primaryKey:e}),this.unset("error"),this.unset("queryStatus"),this.updateParameters(),this.execute=this.wrapWithErrorHandler(function(){this.onExecuteBegin(),this.updateVirtualSubscriptions(),this.executeVirtualQuery(this.get("_virtualQueryString"),this.get("_virtualParams"),t)},this,this.attributes)},ie.prototype.applyParameterChange=function(){var t,e;this.paramChanged&&this.paramChanged.length&&(t=!!_.find(this.paramChanged,function(t){return"#forced"===t}),e=!!_.find(this.paramChanged,function(t){return t.runApply}),nt.Log.Info(this.logPrefix()+"apply parameter change",this.paramChanged),this.paramChanged=[],this.agent.subscriberCount()?e?(this.apply(),this.start()):this.isPending?this.isDirty=!0:(this.isDirty=this.isDirty||t,this.performance.trigger("paramChange"),this.start()):t&&(this.dataSet||this.apply(),this.execute()))},ie.prototype.applyViewStateAttributes=function(){var e=this,r={},t=_.clone(ie.VIEW_STATE_ATTRIBUTES[this.get("_dataType")])||{},s=_.clone(this.viewStateBindings);return this.get("_pivotType")&&_.extend(t,ie.VIEW_STATE_ATTRIBUTES.pivot),_.each(t,function(i,n){var o=e.get(n),t=_.findKey(s,function(t,e){return e===n&&t.callback===i&&t.model===o});t?(s=_.omit(s,t),o=o.get("value")):o instanceof m.Model&&(e.listenTo(o,"change:value",e[i]),e.viewStateBindings[n]=new nt.ViewStateBinding(i,o),o=o.get("value")),r[n]=o}),this.get("_pivotType")&&r[ie.AGGREGATE_COLS_PROP]&&r[ie.AGGREGATE_LABELS_PROP]&&r[ie.AGGREGATE_COLS_PROP].length!==r[ie.AGGREGATE_LABELS_PROP].length&&(nt.Log.Warn(this.logPrefix()+"invalid aggregate labels length"),r[ie.AGGREGATE_LABELS_PROP]=[]),_.each(s,function(t){e.stopListening(t.model,"change:value",t.callback)}),r},ie.prototype.bindViewStateToKdbParams=function(t){var o,r,s,a=this,e=[];return $.extend(!0,e,t),e&&0<e.length&&e.forEach(function(n){var t,e,i;"string"==typeof n.value&&(!(s=n.value.match(ie.PARAMETER_RX))||(t=a.getViewState().getByPath($.trim(s[0].substring(2,s[0].length-2))))&&(void 0===(e=_.isFunction(t.get)?t.get("value"):t.value)&&(n.value=null),n.value=_.isObject(e)&&!_.isArray(e)?$.extend(!0,{},e):e)),"dict"===n.type&&_.isObject(n.value)?_.keys(n.value).forEach(function(t){if(n.value[t]instanceof m.Model)n.value[t]={type:n.value[t].get("_type"),IsKdbParam:!0,isViewState:!0,name:n.value[t].path,value:n.value[t].get("value")};else if("object"==typeof n.value[t]){if(_.has(n.value[t],"_isKdbReady"))return;"string"==typeof n.value[t].value&&0===n.value[t].value.indexOf("<%")&&(e=$.trim(n.value[t].value.substring(2,n.value[t].value.length-2)),(i=a.getViewState().getByPath(e))&&(n.value[t].type=i.get("_type"),n.value[t].value=i.get("value")))}else{var e,i;"string"==typeof n.value[t]&&(e=void 0,0===n.value[t].indexOf("<%")&&(e=$.trim(n.value[t].substring(2,n.value[t].length-2)),(i=a.getViewState().getByPath(e))&&(n.value[t]={type:i.get("_type"),IsKdbParam:!0,isViewState:!0,name:n.value[t],value:i.get("value")})))}o=n.value[t].type,(r=o?nt.RTTI.getByName(o):null)&&r.toKDBInput&&(n.value[t].value=_.includes(ie.TYPES_TO_PARSE,o)?r.toKDBInput(n.value[t].value):n.value[t].value,nt.Log.Info(a.logPrefix()+"View State  Binding ["+n.name+"]",n.value[t].value))}):(o=n.type,(r=nt.RTTI.getByName(o))&&("dict"!==r.name&&r.toKDBInput?(n.value=_.includes(ie.TYPES_TO_PARSE,o)?r.toKDBInput(n.value):n.value,nt.Log.Info(a.logPrefix()+"View State  Binding ["+n.name+"]",n.value)):"dict"===r.name&&(e=n.value.split(""),i={},e.forEach(function(t){t=t.split("");6===t.length&&(i[t[0]]={type:t[1],IsKdbParam:!0,isViewState:!0,name:t[0],value:t[2]})}),n.value=i)))}),e},ie.prototype.clearVirtualSubscriptions=function(t){var i=this;_.each(t,function(t){var e=i.virtualSubscriptions[t];e&&(e instanceof ie&&e.unsubscribe(t),delete i.virtualSubscriptions[t])})},ie.prototype.clearVirtualSubscriptionsAll=function(){var t=_.keys(this.virtualSubscriptions);this.clearVirtualSubscriptions(t)},ie.prototype.clone=function(){var t=new ie(this.attributes,this.root,this.path,this.viewState,this.group);return t.isClone=!0,t},ie.prototype.defaults=function(){return{_pagingType:"NONE"}},ie.prototype.destroy=function(){this.stop(),this.reset(),this.agent&&this.agent.unsubscribeAll(),m.Model.prototype.destroy.call(this)},ie.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,ie.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},ie.prototype.doCommand=function(t,e){if(0<t.length){var i=t.reverse().join("/");return this.getByPath(i).doCommand(t,e)}},ie.prototype.executeClientPivotQuery=function(i,t){var r=this,n={columns:[],meta:{},rows:[]};if(!i)return n;var s=this.getViewStateAttribute("_aggregateCols")||[],a=this.getViewStateAttribute("_aggregateFns")||[],l=this.getViewStateAttribute("_aggregateLabels")||[],o=this.getViewStateAttribute("_breakdownCols")||[],u=s.map(function(t){return nt.Tools.getComparator(i.meta[t]||0,function(t){return t})}),l=_.map(s,function(t,e){return l[e]||t}),c=t&&t.wheres?t.wheres:[],c=_.filter(c,function(t,e){return t.comparator=nt.Tools.getComparator(i.meta[t.columnName]||0,function(t){return t}),t.columnName===o[e]}),p=_.take(o,c.length+1),d=_.last(p),h=nt.Tools.getComparator(i.meta[d]||0,function(t){return t[d]});return i.rows.forEach(function(o){for(var t,r,e=0;e<c.length;e++){var i=c[e];if(0!==i.comparator(i.columnValue,o[i.columnName]))break}e<c.length||(t=o[d],(t=nt.Tools.binarySearch2(t,n.rows,h))<0?(r=_.pick(o,p),n.rows.splice(-t-1,0,r),l.forEach(function(t,e){"count"===a[e]?r[t]=0:_.includes(["max","min","sum"],a[e])?r[t]=null:r[t]=[]})):r=n.rows[t],s.forEach(function(t,e){var i=a[e],n=l[e];switch(i){case"count":r[n]+=1;break;case"max":null===o[t]||null!==r[n]&&-1!==u[e](r[n],o[t])||(r[n]=o[t]);break;case"min":null===o[t]||null!==r[n]&&1!==u[e](r[n],o[t])||(r[n]=o[t]);break;case"sum":null!==o[t]&&(r[n]+=Number(o[t]));break;default:r[n]=r[n]||[],r[n].push(o)}}))}),_.every(a,function(t){return _.includes(["count","max","min","sum"],t)})||n.rows.forEach(function(o){l.forEach(function(t,e){var i=o[t],n=a[e];if(_.isArray(i))switch(n){case"avg":i=_.map(i,function(t){return _.transform(t,function(t,e,i){return t[i]=Number(e)})}),o[t]=_.meanBy(i,s[e]);break;case"first":o[t]=_.first(i)[s[e]];break;case"last":o[t]=_.last(i)[s[e]];break;default:o[t]=r.executeUserJavascript(n,["data"],[i])}})}),_.each(p,function(t){n.columns.push(t),n.meta[t]=i.meta[t]||11}),_.each(s,function(t,e){n.columns.push(l[e]),n.meta[l[e]]=i.meta[t]||11}),n},ie.prototype.executeUserJavascript=function(e,t,i){try{return new Function(t,e).apply({},i)}catch(t){e=/<anonymous>:(\d+):(\d+)/.exec(t.stack);if(e&&3===e.length){i=Number(e[1]),e=Number(e[2]);throw t.message+" ("+(i-2)+":"+e+")"}throw t.message}},ie.prototype.executeVirtualQuery=function(t,e,i){var o=this,t=ie.VIRTUAL_QUERY_REGEX.exec(t),r=[],s=[],a=!1;if(!t)throw"Invalid function definition";_.each(e,function(t){var e;switch(t.type){case"datasource":var i,n=o.path+"_"+t.value;o.get("isSourceDataDialog")&&(n+="#edit"),r.push(t.name),(e=o.virtualSubscriptions[n])?(i=e.get("_subscriptionKey")||nt.DataSet.DEFAULT_ROW_INDEX,n=o.get("_subscriptionKey")||nt.DataSet.DEFAULT_ROW_INDEX,a=a||n===nt.DataSet.DEFAULT_ROW_INDEX&&(i===nt.DataSet.DEFAULT_ROW_INDEX||"virtual"===e.get("_dataType")),s.push(_.extend(ie.convertMetaToDeltaClientColumnSpec(e.dataSet?_.sortBy(e.dataSet.columns.map(function(t){return t.attributes}),"index"):[]),{rows:e.dataSet?e.dataSet.collection.models.map(function(t){return t.attributes}):[]}))):s.push(null);break;case"text":r.push(t.name),s.push(t.value);break;case"viewstate":r.push(t.name),(e=o.viewState.getByPath(t.value))?s.push(e.get("value")):s.push(null)}}),r.push("callback"),s.push(function(t){t.rows&&a&&(t.rows=t.rows.map(function(t){return Object.assign({},t)})),i(t)}),r.push("Tools"),s.push(nt.Tools),t&&6===t.length&&(t=t[4],this.executeUserJavascript(t,r,s))},ie.prototype.exportData=function(t,e,i){var n,o,r={},s="";i&&(i.exportName&&(s=i.exportName),i.exportParams&&(r=i.exportParams)),"analytic"===this.get("_dataType")?this.runWithConnectionCheck(e,function(){nt.DeltaClientLib.exportAnalyticData(this.get("_selectedAnalytic"),this.get("_connection"),this.bindViewStateToKdbParams(this.get("_analyticParams")),s,r,t,e)}.bind(this)):"pivot"===this.get("_dataType")||this.get("_pivotType")?(n=this,i&&i.focus&&_.isString(i.focus)&&(o=i.focus.split(","),_.each(o,function(t){n.dataSet.collection.has(t)&&(n=n.dataSet.collection.get(t))})),n.exportPivotData(t,e,i)):"query"===this.get("_dataType")?this.runWithConnectionCheck(e,function(){nt.DeltaClientLib.exportQueryData(this.get("_connection"),this.replaceViewStateParams(this.get("_queryString")),this.bindViewStateToKdbParams(this.get("_queryParams")),s,r,t,e)}.bind(this)):e("Export not currently supported for type "+this.get("_dataType"))},ie.prototype.flatten=function(){return _.includes(["analytic","streaming","pivot","query","virtual","builder"],this.get("_dataType"))?[this]:_.reduce(_.omit(this.attributes,"error"),function(t,e){return t.concat(e.flatten())},[])},ie.prototype.flattenObject=function(t){var e={};if(_.keys(t).length){for(var i in t)if(t.hasOwnProperty(i))if("object"==typeof t[i]){var n,o=this.flattenObject(t[i]);for(n in o)o.hasOwnProperty(n)&&(e[i+"."+n]=o[n])}else e[i]=t[i];return e}return{0:t.toString()}},ie.prototype.forceExecute=function(t,e){this.paramChanged.push("#forced"),e&&this.callbacks.push(e),this.debouncedParameterChange()},ie.prototype.formatValue=function(t,e){return t="_subscriptionInterval"===e?1e3*Math.min(3600,Math.max(.5,Number(t||0))):t},ie.prototype.generatePivotModel=function(t,e,i,s){var a=this;s.breakdownCols instanceof m.Model&&(s.breakdownCols=s.breakdownCols.get("value")),a.meta={};var l=m.Model.extend({defaults:{_dataType:a.get("_dataType"),_pivotType:a.get("_pivotType"),_subscriptionType:a.get("_subscriptionType"),_subscriptionInterval:a.get("_subscriptionInterval")},idAttribute:t,childId:e,childModelType:i,initialize:function(){this.isDirty=!0,this.isPending=!1,this.legacyUpdates=[],this.agent=new nt.Agent},apply:function(){this.dataSet=new nt.DataSet({idAttribute:e,collectionFunc:m.Collection.extend({model:i}),agent:this.agent,maxRows:s.maxRows,primaryKey:e})},getRoot:function(){return a},getViewState:function(){return a.getViewState()},execute:function(e){var n=this,t=!a.clientPivotData||a.isDirty||e&&e.intervalQuery;this.wheres||(this.wheres=s.wheres);function i(t){t?o(t):o(a.executeClientPivotQuery(a.clientPivotData,{wheres:s.wheres}),a.get("_forceReset"))}var o=n.onExecuteSubscriptionSuccess.bind(n);n.onExecuteBegin();try{s.topX=null,s.ordering=null,s.queryParams=a.bindViewStateToKdbParams(a.get("_queryParams")),s.maxRows=a.get("_maxRows")||ie.DEFAULT_MAX_ROWS,_.each(s.wheres,function(t,e){var i="string"==typeof t?t:t.columnName,t=a.meta[i];s.wheres[e]={columnName:i,columnType:t,columnOperator:"=",columnValue:n.get(i)}});function r(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];a.onError(l,s,t,"Error",e)}"client"===n.get("_pivotType")?t?(n.stop(),a.runWithConnectionCheck(r,function(){switch(a.get("_dataType")){case"query":var t=a.replaceViewStateParams(s.queryString);"subscription"===n.get("_subscriptionType")?nt.DeltaClientLib.startManagedQuery(s.connection,t,a.bindViewStateToKdbParams(s.queryParams),function(t,e){t&&t.dataSet&&t.dataSet.rows?(a.clientPivotData=t.dataSet,i()):i(t)},r,1e3*s.subscriptionInterval,s.maxRows,null,n.performance):nt.DeltaClientLib.getQueryData(s.dataSource,s.connection,t,a.bindViewStateToKdbParams(s.queryParams),function(t){a.clientPivotData=t,i()},r,s.maxRows,null,n.performance);break;case"analytic":case"streaming":"subscription"===n.get("_subscriptionType")?nt.DeltaClientLib.startManagedAnalytic(a.get("_selectedAnalytic"),a.get("_connection"),a.bindViewStateToKdbParams(a.get("_analyticParams")),function(t,e){t&&t.rows?(a.clientPivotData=t,i()):i(t)},r,1e3*s.subscriptionInterval,s.maxRows,n.performance):nt.DeltaClientLib.runAnalytic(a.get("_selectedAnalytic"),a.get("_connection"),a.bindViewStateToKdbParams(a.get("_analyticParams")),function(t){a.clientPivotData=t,i()},r,s.maxRows,null,n.performance);break;case"virtual":a.executeVirtualQuery(a.get("_virtualQueryString"),a.get("_virtualParams"),function(t){a.clientPivotData=t,i()});break;case"builder":"subscription"===n.get("_subscriptionType")?nt.DeltaClientLib.startManagedQuery(s.connection,n.get("_analyticString"),n.get("_queryBuilderParams"),function(t,e){t&&t.dataSet&&t.dataSet.rows?(a.clientPivotData=t.dataSet,i()):i(t)},r,1e3*s.subscriptionInterval,s.maxRows,null,n.performance):nt.DeltaClientLib.getQueryData(s.dataSource,s.connection,n.get("_analyticString"),n.get("_queryBuilderParams"),function(t){a.clientPivotData=t,i()},r,s.maxRows,null,n.performance)}})):i():("builder"===a.get("_dataType")&&(s.queryString=a.get("_analyticString"),s.queryParams=a.get("_queryBuilderParams")),a.runWithConnectionCheck(r,function(){nt.DeltaClientLib.getPivotData(s,function(t,e){_.extend(a.meta,t.meta),"subscription"===a.get("_subscriptionType")?n.onExecuteSubscriptionSuccess(t,a.get("_forceReset"),e,a.meta):n.onExecuteSuccess(t,a.get("_forceReset"),e,a.meta)},r,n.performance)}))}catch(t){a.onError(l,s,t,"Error",e)}},exportPivotData:function(t,e,i){a.runWithConnectionCheck(e,function(){nt.DeltaClientLib.exportPivotData($.extend({},s,i),t,e)})},clearVirtualSubscriptions:_.noop,clearVirtualSubscriptionsAll:_.noop,executeClientPivotQuery:a.executeClientPivotQuery,formatValue:a.formatValue,getViewStateAttribute:a.getViewStateAttribute,isPagingData:a.isPagingData,logPrefix:a.logPrefix,legacyFlush:a.legacyFlush,legacyUpdate:a.legacyUpdate,onComplete:a.onComplete,onExecuteSubscriptionSuccess:a.onExecuteSubscriptionSuccess,onExecuteBegin:a.onExecuteBegin,onExecuteSuccess:a.onExecuteSuccess,reset:a.reset,start:a.start,stop:a.stop,subscribe:a.subscribe,triggerCallbacks:_.noop,updateVirtualSubscriptions:_.noop,unsubscribe:a.unsubscribe},{staticIdAttribute:t});return l},ie.prototype.getByPath=function(t){if(t){var t=_.filter(t.split("/"),function(t){return t&&0<t.length}),e=this;return _.each(t,function(t){e=e&&e.get(t)}),e}},ie.prototype.getExecutionRate=function(){if(this.performance){var t=this.performance.performance.apply;return t?6e4*this.dataExecuteSuccessCount/(Date.now()-t):0}return 0},ie.prototype.getMappedViewStates=function(){var t=this.get("_mappings"),e=[];return t&&t.mappings&&_.each(t.mappings,function(t){e.push(t&&t._dashboardsType?this.viewState.getByPath(t.value):t)}.bind(this)),e},ie.prototype.getMeta=function(e){var i=this,n=_.uniqueId("getMeta_");this.subscribe(n,{onData:function(t){e(t),_.defer(function(){return i.unsubscribe(n)})}})},ie.prototype.getRoot=function(){return this},ie.prototype.getTreeList=function(){var t=_.filter(this.attributes,function(t){return t instanceof ie});return t.length?_.chain(t).map(function(t){return t.getTreeList()}).flatten().value():[this]},ie.prototype.getViewState=function(){return this.viewState},ie.prototype.getPagingType=function(){var t=ie.DEFAULT_PAGING;return t=this.get("_serverPaging")?this.get("_forceReset")?"PAGENO_NOCACHE":this.get("_pagingType")&&"NONE"!==this.get("_pagingType")?this.get("_pagingType"):"PAGENO":t},ie.prototype.getParameters=function(){var i,e,n,t,o=this,r=[];return this.get("_queryParams")?t=this.get("_queryParams"):this.get("_updateQueryParams")?t=this.get("_updateQueryParams"):this.get("_builderParams")?t=this.get("_builderParams"):this.get("_analyticParams")?t=this.get("_analyticParams"):this.get("_virtualParams")&&(t=_.filter(this.get("_virtualParams"),{type:"viewstate"}).map(function(t){return{value:"<%"+t.value+"%>"}})),t&&_.each(t,function(t){"string"==typeof t.value&&(e=t.value.match(ie.PARAMETER_RX))&&(i={path:e[0].substring(2,e[0].length-2)},(n=o.viewState.getByPath(e[0].substring(2,e[0].length-2)))&&"dict"===n.get("_type")&&(i.dictParameters=[],_.each(n.get("value"),function(t,e){t instanceof m.Model?i.dictParameters.push({path:t.path,key:e}):_.isObject(t)?t.name?i.dictParameters.push({path:t.name,key:e}):t.type&&i.dictParameters.push({raw:!0,key:e,type:t.type,value:t.value}):_.isString(t)?t.match(ie.PARAMETER_RX)?i.dictParameters.push({path:t.substring(2,t.length-2)}):i.dictParameters.push({path:t}):t&&i.dictParameters.push({path:t.name||t})})),r.push(i))}),r},ie.prototype.getViewStateAttribute=function(t){t=this.get(t);return t instanceof m.Model?t.get("value"):t},ie.prototype.getViewStateDict=function(){var n={},e=[],i=_.union(_.filter(this.get("_analyticParams"),function(t){return"dict"===t.type&&e.push(t),t.isViewState}),_.filter(this.get("_queryParams"),function(t){return"dict"===t.type&&e.push(t),t.isViewState}),_.filter(this.get("_virtualParams"),function(t){return"dict"===t.type&&e.push(t),t.isVirtual=!0,"viewstate"===t.type}));return _.each(e,function(t){_.each(t.value,function(t){t.isViewState&&i.push(t)})}),i&&0<i.length&&_.each(i,_.bind(function(i){var t=this.parseViewState(i.value,i.isVirtual);t&&(n[i.name]=t),"dict"===i.type&&_.isObject(i.value)&&_.each(i.value,function(t,e){t=this.parseViewState(t);t&&(n[i.name+"."+e]=t)}.bind(this))},this)),_.each(_.reduce(_.values(ie.VIEW_STATE_ATTRIBUTES),function(t,e){return t.concat(_.keys(e))},[]),_.bind(function(t){var e=this.get(t);e instanceof m.Model&&(n[t]=e)},this)),n},ie.prototype.isMapping=function(){return this.get("_mappings")&&!_.isEmpty(this.get("_mappings").mappings)},ie.prototype.isPagingData=function(t){return t&&t.rows&&t.rows[0]&&"startRows"===t.rows[0].Property&&t.rows[3]},ie.prototype.legacyFlush=function(){var t;this.legacyFlushTime=Date.now(),this.legacyFlushFrame=void 0,(this.deferredUpdate&&this.agent.subscriberLegacyCount()||this.get("_dataType").match(/virtual|copy/))&&(t=this.legacyUpdate(this.deferredUpdate),this.dataSet&&this.dataSet.flushUpdates(),this.deferredUpdate.forceReset&&t.rows&&!t.rows.length||!this.dataSet||this.dataSet&&this.dataSet.isEmpty()?0===this.agent.subscriberRawCount()&&this.set("queryStatus",{type:"NoResults",options:{}}):this.unset("queryStatus"),0<this.consolidateCount?nt.Log.Info(this.logPrefix()+"consolidated "+(this.consolidateCount+1)):nt.Log.Info(this.logPrefix()+"deferred")),this.consolidateCount=0,this.deferredUpdate=void 0,this.durationMovingAverage=(2*this.durationMovingAverage+(Date.now()-this.legacyFlushTime))/3},ie.prototype.legacyUpdate=function(t){var e=t.forceReset,i=t.table,n=t.pivotMeta,o=this.get("_breakdownCols");o instanceof m.Model&&(o=o.get("value")),n&&_.extend(n,i.meta);i=i.rows?i:i.toLegacy();return this.dataSet.onData({breakdownColumns:o,columns:ie.convertDeltaClientColumnSpecToMeta(i),paging:_.omit(t.pagingMeta,"data")},i.rows,e,void 0,this.performance),i},ie.prototype.logPrefix=function(){return"DataModel "+this.agent.subscriberCount()+" "+this.path+" "},ie.prototype.objToString=function(e){var i=[];return _.each(_.keys(e),function(t){i.push(t+": "+e[t])}),i.join("\n")},ie.prototype.onComplete=function(){this.isDirty&&!this.isPending&&(this.stop(),this.start())},ie.prototype.onError=function(t,e,i,n,o){e={error:_.isObject(i)?this.objToString(this.flattenObject(i)):i,type:n,options:$.extend({},e),args:void 0};this.triggerCallbacks(e),o&&(e.args=$.extend({},o)),this.set({error:e}),this.set({queryStatus:e}),this.isPending=!1,this.onComplete();try{this.dataSet&&this.dataSet.onData([],[],this.forceInternalReset,e),this.dataSet2&&this.dataSet2.onData([],{},this.forceInternalReset,e)}catch(t){}nt.Log.Error(this.logPrefix()+"onError ",e),t&&t.trigger&&t.trigger("error",t,e)},ie.prototype.onExecuteBegin=function(){this.isPending=!0,this.isDirty=!1,this.set({queryStatus:{type:"Loading"}}),nt.Log.Info(this.logPrefix()+"execute begin")},ie.prototype.onExecuteSuccess=function(e,t,i,n){var o,r={},s=this.get("_breakdownCols");if(s instanceof m.Model&&(s=s.get("value")),this.dataExecuteSuccessCount++,this.triggerCallbacks(),i&&i.byteLength){var a=["startRows","numRows","totalNumRows","data"];if(e&&99===e.qtype&&11===e.keys.qtype&&4===e.keys.offsets.length&&_.isEqual(a,_.times(4,function(t){return nt.ipc.Parse.col(e.keys,new DataView(i)).toLegacy(t)}))){for(var l=nt.ipc.Parse.col(e.values,new DataView(i)),u=0;u<3;u++)r[a[u]]=l.toLegacy(u);r.pagingType=this.getPagingType(),r.pageSize=this.get("_pageSize"),o=nt.ipc.Parse.reshape(l.values[3],i),t=!0}else o=nt.ipc.Parse.reshape(e.dataSet||e,i);n&&_.extend(n,o.meta),t=t||this.forceInternalReset,this.agent.subscriberRawCount()&&(this.unset("error"),this.dataSet2.onData({breakdownColumns:s,columns:ie.convertDeltaClientColumnSpecToMeta(o),paging:_.omit(r,"data")},o.cols,t,void 0,this.performance),this.forceInternalReset=!1,!this.dataSet2||this.dataSet2&&this.dataSet2.isEmpty()?this.set("queryStatus",{type:"NoResults",options:{}}):this.unset("queryStatus"))}else this.isPagingData(e)?(_.each(e.rows,function(t){r[t.Property]=t.Value}),r.pagingType=this.getPagingType(),r.pageSize=this.get("_pageSize"),o=r.data||{},t=!0):o=e;(this.agent.subscriberLegacyCount()||this.get("_dataType").match(/virtual|copy/))&&(t=t||this.forceInternalReset,n=new nt.LegacyUpdate(o,t,r,n),this.forceInternalReset=!1,this.deferredUpdate?(this.dataSet.background(),this.consolidateCount++,this.legacyUpdate(this.deferredUpdate),this.deferredUpdate=n):!this.dataSet.isBackground()&&(this.durationMovingAverage<=ie.FAST_THRESHOLD||Date.now()-this.legacyFlushTime-this.durationMovingAverage>ie.OLD_THRESHOLD)?(this.deferredUpdate=n,this.legacyFlush(),nt.Log.Info(this.logPrefix()+" Express")):this.deferredUpdate=n,!this.legacyFlushFrame&&this.deferredUpdate&&(this.legacyFlushFrame=window.requestAnimationFrame(this.legacyFlush.bind(this)),this.deferredUpdate=n)),this.isPending=!1,this.unset("error"),nt.Log.Info(this.logPrefix()+"execute success"),this.onComplete()},ie.prototype.onExecuteSubscriptionSuccess=function(t,e,i,n){if("207"===t.class)return this.stop(),void(t.add?(this.subscriptionId=t.clientId+":"+t.subId,this.isPending=!1,nt.Log.Info(this.logPrefix()+"sub started "+t.subId)):nt.Log.Info(this.logPrefix()+"sub stopped "+t.subId));if("208"===t.class)return nt.Log.Info(this.logPrefix()+"sub failed "+t.subId+": "+t.reason),void nt.DeltaClientLib.removeSubscriptions(t.clientId+":"+t.subId);if("209"===t.class){if(this.subscriptionId!==t.clientId+":"+t.subId)return nt.Log.Warn(this.logPrefix()+"sub stray persisting: "+t.clientId+":"+t.subId),void nt.DeltaClientLib.removeSubscriptions(t.clientId+":"+t.subId)}else{if("210"===t.class)return;if("com.fd.business.querymanager.subscriptions.ManagedSubscription"===t.class||"com.fd.business.querymanager.subscriptions.StreamingSubscription"===t.class)return}this.onExecuteSuccess(t.dataSet||t,e,i,n)},ie.prototype.onMaterialChange=function(){this.trigger("materialChange")},ie.prototype.onModelChange=function(t,e){var i=_.keys(t.changed),t=_.intersection(i,ie.PAGING_ATTRIBUTES);_.find(i,function(t){return 0===t.indexOf("_")})&&(this.determineMaterialChange(),_.some(i,function(t){return 0===t.indexOf("_")&&!_.includes(["_layout","_mappings"],t)})&&(this.isDirty=!0),t&&t.length&&(this.paramChanged=this.paramChanged.concat(t),this.stop(),this.isDirty=!0,this.forceInternalReset=!0,this.debouncedParameterChange()))},ie.prototype.onParameterChange=function(t,e,i){e={runApply:!(!i||!i.runApply)||!!this.get("_pivotType"),modelPath:t.path,previous:t.previous("value"),new:e};this.paramChanged.push(e),nt.Log.Info(this.logPrefix()+"parameter change",e),this.stop(),this.isDirty=!0,this.forceInternalReset=!0,this.get("_pagingType")!==ie.DEFAULT_PAGING&&0!==this.get("_pagingNum")&&this.set("_pagingNum",0),this.debouncedParameterChange()},ie.prototype.onPivotSettingChange=function(t,e){this.onParameterChange(t,e,{runApply:!0})},ie.prototype.onQuerySettingChange=function(t,e,i){i=_.extend(!0,{runApply:!0},i),this.onParameterChange(t,e,i)},ie.prototype.parseViewState=function(t,e){if("string"==typeof t){if(e)return this.getViewState().getByPath(t);t=t.match(ie.PARAMETER_RX);return t?this.getViewState().getByPath($.trim(t[0].substring(2,t[0].length-2))):void 0}},ie.prototype.postCommand=function(t,e){return this.root.postCommand(this,e)},ie.prototype.removeSubscriptions=function(){this.stop(),this.group&&this.values().forEach(function(t){return t.removeSubscriptions()})},ie.prototype.replaceViewStateParams=function(t){var n=this;return"string"==typeof t?t.replace(ie.PARAMETER_RX,function(t,e){var i=n.getViewState().getByPath(e);if(i){i=i.get("value");return void 0===i?null:i}return nt.Log.Error(n.logPrefix()+"replace parameter: "+e+" not found"),""}):t},ie.prototype.reset=function(){this.dataMapper&&(this.dataMapper.cleanUp(),delete this.dataMapper),this.dataSet&&(this.dataSet.cleanUp(),delete this.dataSet),this.dataSet2&&(this.dataSet2.cleanUp(),delete this.dataSet2),this.deferredUpdate=void 0,this.isDirty=!0,this.isPending=!1,this.dataExecuteSuccessCount=0},ie.prototype.start=function(){var t,e,i=this;0!==this.agent.subscriberCount()?(t=this.formatValue(this.getViewStateAttribute("_subscriptionInterval"),"_subscriptionInterval"),"polling"===(e=this.get("_subscriptionType"))?this.pollingEvent?nt.Log.Info(this.logPrefix()+"start: already polling!"):(nt.Log.Info(this.logPrefix()+"start: polling now..."),this.pollingEvent=setInterval(function(){i.isPending||(nt.Log.Info(i.logPrefix()+"poll"),i.execute({intervalQuery:!0}))},t),this.execute()):"subscription"===e||"streaming"===e?this.subscriptionId||this.execute():this.isDirty&&!this.isPending&&this.execute()):nt.Log.Info(this.logPrefix()+"start: no subscriptions")},ie.prototype.stop=function(){this.pollingEvent&&(clearInterval(this.pollingEvent),this.pollingEvent=null),this.subscriptionId&&(nt.DeltaClientLib.removeSubscriptions(this.subscriptionId),nt.Log.Info(this.logPrefix()+" unsubcribed "+this.subscriptionId),this.subscriptionId=null)},ie.prototype.subscribe=function(t,e,i,n){this.agent.subscribe(t,e,i)?(nt.Log.Info(this.logPrefix()+"subscribed "+t),n?this.set(n,{silent:!0}):this.has("_lazyLoading")&&(this.unset("_lazyLoading"),this.dataSet&&(this.dataSet.lazyLoading=!1),this.set({_pagingType:"NONE",_pageNum:0},{silent:!0})),this.dataSet?(i||this.dataSet.collection.isEmpty()&&this.dataSet.columns.isEmpty()?this.dataSet2&&!this.dataSet2.columns.isEmpty()?i?this.dataSet2.onDataRefresh(e):(n=nt.ipc.Table.toLegacy(_.mapValues(_.keyBy(this.dataSet2.columns.map(function(t){return t.attributes}),"id"),"kdbType"),this.dataSet2.columns.map(function(t){return t.id}),this.dataSet2.cols),this.dataSet.onData({breakdownColumns:this.dataSet2.breakdownColumns,columns:ie.convertDeltaClientColumnSpecToMeta(n)},n.rows,!0,void 0)):i&&!this.dataSet.columns.isEmpty()&&this.apply():this.dataSet.onDataRefresh(e),this.trigger("change:queryStatus",this,this.get("queryStatus"))):this.apply(),this.start()):nt.Log.Error(this.logPrefix()+"subscribe: already subscribed",t)},ie.prototype.toJSON=function(){var n=this,o={};return _.keys(this.attributes).forEach(function(t){var e=n.attributes[t],i={};_.isObject(e)&&e.has&&e.has("_dataType")?(_.each(_.filter(_.keys(e.attributes),function(t){return 0===t.indexOf("_")&&!_.includes(["_pageSort","_pagingNum"],t)}),function(t){e.get(t)instanceof m.Model?i[t]={_dashboardsType:"viewstate",value:e.get(t).path}:i[t]=e.get(t)}),o[t]=i):e instanceof nt.DocumentViewModel?o[t]={_dashboardsType:"viewstate",value:e.path}:(_.isObject(e)&&"Error"===e.type&&(e.options={}),o[t]=e)}),o},ie.prototype.triggerCallbacks=function(e){void 0===e&&(e=null),this.callbacks.forEach(function(t){t({success:!e,error:e})}),this.callbacks=[]},ie.prototype.unsubscribe=function(t){this.agent.unsubscribe(t)?(nt.Log.Info(this.logPrefix()+"unsubscribed "+t),0===this.agent.subscriberCount()&&(this.stop(),this.reset(),this.clearVirtualSubscriptionsAll(),nt.Log.Info(this.logPrefix()+"0 subscribers, data source reset"))):nt.Log.Warn("unsubscribe not found",t,this)},ie.prototype.updateParameterPath=function(t,e,i){var n=new RegExp("^<%"+e);"vs"===t?(_.each([this.get("_analyticParams"),this.get("_queryParams"),this.get("_updateQueryParams")],function(t){_.each(t,function(t){"viewstate"===t.isViewState&&(t.value=t.value.replace(n,"<%"+i))})}),_.each(this.get("_virtualParams"),function(t){"viewstate"===t.type&&(t.value=t.value.replace(n,"<%"+i))})):"ds"===t&&_.each(this.get("_virtualParams"),function(t){"datasource"===t.type&&(t.value=t.value.replace(n,"<%"+i))})},ie.prototype.updateParameters=function(t){var e,i,n,o=this,r=[];_.each(_.filter(_.keys(o.attributes),function(t){return 0===t.indexOf("_")}),function(t){"string"==typeof o.get(t)&&o.get(t).replace(ie.PARAMETER_RX,function(t,e){return r.push(e),""})}),o.get("_queryParams")&&0<o.get("_queryParams").length?_.each(o.get("_queryParams"),function(t){"string"==typeof t.value&&((e=t.value.match(ie.PARAMETER_RX))&&(r.push(e[0].substring(2,e[0].length-2)),n=o.viewState.getByPath(e[0].substring(2,e[0].length-2))),n&&"dict"===n.get("_type")&&_.each(n.get("value"),function(t,e){var i;t instanceof m.Model?r.push(t.path):_.isObject(t)&&t.value?(i=t.value,_.isString(i)&&i.match(ie.PARAMETER_RX)&&r.push(i.substring(2,i.length-2))):_.isString(t)&&t.match(ie.PARAMETER_RX)&&r.push(t.substring(2,t.length-2))}))}):o.get("_updateQueryParams")&&0<o.get("_updateQueryParams").length?_.each(o.get("_updateQueryParams"),function(t){"string"==typeof t.value&&((e=t.value.match(ie.PARAMETER_RX))&&(r.push(e[0].substring(2,e[0].length-2)),n=o.viewState.getByPath(e[0].substring(2,e[0].length-2))),n&&"dict"===n.get("_type")&&_.each(n.get("value"),function(t,e){var i;t instanceof m.Model?r.push(t.path):_.isObject(t)&&t.value?(i=t.value,_.isString(i)&&i.match(ie.PARAMETER_RX)&&r.push(i.substring(2,i.length-2))):_.isString(t)&&t.match(ie.PARAMETER_RX)&&r.push(t.substring(2,t.length-2))}))}):o.get("_analyticParams")&&0<o.get("_analyticParams").length?_.each(o.get("_analyticParams"),function(t){"string"==typeof t.value?((e=t.value.match(ie.PARAMETER_RX))&&(r.push(e[0].substring(2,e[0].length-2)),n=o.viewState.getByPath(e[0].substring(2,e[0].length-2))),n&&"dict"===n.get("_type")&&_.each(n.get("value"),function(t,e){var i;t instanceof m.Model?r.push(t.path):_.isObject(t)&&t.value?(i=t.value,_.isString(i)&&i.match(ie.PARAMETER_RX)&&r.push(i.substring(2,i.length-2))):_.isString(t)&&t.match(ie.PARAMETER_RX)&&r.push(t.substring(2,t.length-2))})):"object"==typeof t.value&&"dict"===t.type&&_.each(t.value,function(t){_.has(t,"_isKdbReady")||(i="object"==typeof t?t.value:"<%"+t+"%>",(e="string"==typeof i&&i.match(ie.PARAMETER_RX))&&r.push(e[0].substring(2,e[0].length-2)))})}):o.get("_virtualParams")&&0<o.get("_virtualParams").length&&_.each(o.get("_virtualParams"),function(t){(e=t.value)&&"viewstate"===t.type&&(r.push(e),n=o.viewState.getByPath(e)),n&&"dict"===n.get("_type")&&_.each(n.get("value"),function(t,e){var i;t instanceof m.Model?r.push(t.path):_.isObject(t)&&t.value?(i=t.value,_.isString(i)&&i.match(ie.PARAMETER_RX)&&r.push(i.substring(2,i.length-2))):_.isString(t)&&t.match(ie.PARAMETER_RX)&&r.push(t.substring(2,t.length-2))})}),o.parameterModels&&_.each(o.parameterModels,function(t){t&&o.stopListening(t,"change:value",o.onParameterChange)}),o.parameterModels=[],_.each(r,function(t){t=o.getViewState().getByPath(t);t&&(o.listenTo(t,"change:value",o.onParameterChange),o.parameterModels.push(t))})},ie.prototype.updateVirtualSubscriptions=function(){var n,o=this,i=[];"virtual"===this.get("_dataType")?(_.each(this.get("_virtualParams"),function(t){var e=t.value;e&&"datasource"===t.type&&i.push(e)}),n=_.keys(this.virtualSubscriptions),_.each(i,function(t){var e,i=o.path+"_"+t;o.get("isSourceDataDialog")&&(i+="#edit"),_.includes(n,i)?n=_.without(n,i):(e=o.root?o.root.getByPath(t):e)&&!o.virtualSubscriptions[i]&&((o.virtualSubscriptions[i]=e).unsubscribe(i),e.subscribe(i,{key:i,onData:function(t,e,i){o.onParameterChange({path:"#virtual",previous:_.noop.bind(o)},Math.random(),{})},source:e}))}),this.clearVirtualSubscriptions(n)):this.clearVirtualSubscriptionsAll()},ie.prototype.wrapWithErrorHandler=function(t,e,i){var n=this;return function(){try{t.apply(n,arguments)}catch(t){n.onError(e,$.extend(!0,{},i),t,"Error",Array.prototype.slice.call(3,arguments))}}},ie.DEFAULT_MAX_ROWS=null,ie.DEFAULT_PAGE_SIZE=2e3,ie.DEFAULT_PAGING="NONE",ie.IMMATERIAL_ATTRIBUTES=["error","queryStatus"],ie.NO_DATA_ERROR_TEXT="No data returned from selected data source",ie.PAGING_ATTRIBUTES=["_pagingNum","_pageSize","_pagingType","_pageSort","_serverPaging"],ie.PARAMETER_RX=new RegExp("<%([^<>%]+?)%>","g"),ie.TYPES_TO_PARSE=["date","datetime","guid","minute","month","second","time","timespan","timestamp"],ie.VIEW_STATE_ATTRIBUTES={analytic:{_subscriptionInterval:"onQuerySettingChange"},pivot:{_aggregateCols:"onPivotSettingChange",_aggregateFns:"onPivotSettingChange",_aggregateLabels:"onPivotSettingChange",_breakdownCols:"onPivotSettingChange"},query:{_subscriptionInterval:"onQuerySettingChange"}},ie.VIRTUAL_QUERY_REGEX=/^(function(?: )?\()([a-z0-9A-Z,\w\/ ]+?)(,(?: +)?callback\)(?: ){)([\s\S]+)(\})$/,ie.AGGREGATE_COLS_PROP="_aggregateCols",ie.AGGREGATE_LABELS_PROP="_aggregateLabels",ie.OLD_THRESHOLD=2e3,ie.FAST_THRESHOLD=10,nt.DocumentDataModel=ie,rt=zt=zt||{},st=rt.CommandoModel,C(ne,st),ne.prototype.postInitialize=function(){var n=this;_.each(n.getViewStateList(),function(t){"dict"===t.model.get("_type")&&(t.model.set("_default",_.mapValues(t.model.get("_default"),function(t,e){var i;return _.isString(t)&&0===t.indexOf("<%")?i=n.getByPath(t.substring(2,t.length-2)):_.isObject(t)&&(t._viewType?t=t.value:t.isViewState&&(i=n.getByPath(t.name))),i||t}),{silent:!0}),t.model.set("value",t.model.get("_default")))})},ne.prototype.destroyOnServer=function(e){e=e?_.clone(e):{};function i(){s.trigger("destroy",s,s.collection,e)}var n,o,r,s=this,a=e.success,l=e.wait,t=!(e.success=function(t){l&&i(),a&&a.call(e.context,s,t,e),s.isNew()||s.trigger("sync",s,t,e)});return this.isNew()?_.defer(e.success):(n=this,r=(o=e).error,o.error=function(t){r&&r.call(o.context,n,t,o),n.trigger("error",n,t,o)},t=this.sync("delete",this,e)),l||i(),t},ne.prototype.doCommand=function(t,e){if(0<t.length){var i=t.reverse().join("/");return this.getByPath(i).doCommand(t,e)}},ne.prototype.getByPath=function(t){var e;if(t)return _.isObject(t)?(console.warn("getByPath is deprecated, please update component."),t):(t=_.filter(t.split("/"),function(t){return t&&0<t.length}),e=this,_.each(t,function(t){e&&e.get&&(e=e.get(t))}),e)},ne.prototype.getViewStateExport=function(){var s={},a=function(e,i){var n,o,r;if(e&&e.attributes)return _.each(_.keys(e.attributes),function(t){r=i?i+"/"+t:t,o=e.get(t),_.isObject(o)&&_.isFunction(o.get)&&(o.get("_viewType")?_.isEqual(o.get("value"),o.get("_default"))||(s[r]=o.get("value")):".settings"===r?(n=_.mapValues(o.attributes,function(t){return t.omit("version")}),_.isEmpty(n)||(s[r]=n)):a(o,r))}),s};return a(this)},ne.prototype.getViewStateList=function(t){return this.viewStates=[],this.getViewStates(this),this.viewStates},ne.prototype.getViewStates=function(e,i,n){var o,r,s=this;e.attributes&&_.each(_.keys(e.attributes),function(t){r=i?i+"/"+t:t,o=e.get(t),!n&&".settings"===t||(_.isObject(o)&&_.isFunction(o.get)&&o.get("_viewType")&&"."!==t.substr(0,1)?s.viewStates.push({model:o,path:r}):s.getViewStates(o,r,n))})},ne.prototype.onChange=function(){var i=this;_.each(this.changedAttributes(),function(t,e){void 0===i.previous(e)&&t instanceof ne?(i.stopListening(t,"change materialChange"),i.listenTo(t,"change",i.onChildModelChange),i.listenTo(t,"materialChange",i.onMaterialChange)):void 0===t&&i.previous(e)instanceof ne&&(i.stopListening(i.previous(e),"change"),i.stopListening(i.previous(e),"materialChange"))}),this.changed&&_.some(this.MATERIAL_ATTRIBUTES,function(t){return i.hasChanged(t)})&&this.trigger("materialChange")},ne.prototype.onChildModelChange=function(t,e){this.trigger("change",t,e)},ne.prototype.postCommand=function(t,e){return e.path.push(this.id),this.parent.postCommand(this,e)},ne.prototype.onMaterialChange=function(){this.trigger("materialChange")},ne.prototype.setModelValue=function(n){var o=this,r=!1;"dict"===this.get("_type")&&_.each(_.pickBy(n,function(t,e){return o.get("value")[e]instanceof rt.DocumentViewModel}),function(t,e){t=_.includes(_.keys(t),"value")?t.value:t;var i=o.get("value")[e];i.get("value")!==t&&(r=!0),i.setModelValue(t),n[e]=i}),this.set("value",n),r&&_.isEmpty(this.changed)&&this.trigger("change:value",this,n)},ne.prototype.toJSON=function(o){var r=this,s={},t=_.keys(r.attributes);return o=!0===o||this.root&&this.root.withAllProperties,r.get("_rolling")&&rt.Helpers.convertRollingToDate(r.get("_default"),r.get("_type"))===r.get("value")&&(t=_.without(t,"value")),_.each(t,function(t){var e,i=r.attributes[t],n={};if(".settings"===t)for(e in s[t]=i.toJSON(),s[t])s[t].hasOwnProperty(e)&&(s[t][e]=s[t][e].toJSON());else _.isObject(i)&&i.has&&i.has("_viewType")?(_.each(_.filter(_.keys(i.attributes),function(t){return!!o||0===t.indexOf("_")}),function(t){n[t]=i.get(t)}),"dict"===n._type&&(n._default=_.mapValues(i.get("_default"),function(t,e){return t instanceof ne?"<%"+t.path+"%>":t}),n.value=_.mapValues(i.get("value"),function(t,e){return t instanceof ne?"<%"+t.path+"%>":t})),s[t]=n):s[t]=i}),s},ne.prototype.parse=function(t){var e;if(t&&t[".settings"]&&!((e=t[".settings"])instanceof m.Model)){for(var i in e)e.hasOwnProperty(i)&&(e[i]=new m.Model(e[i]));t[".settings"]=new m.Model(e)}return t},ne.prototype.updateBinding=function(t,e,i,n,o){var r=_.isString(t)?this.getByPath(t):t;e.stopListening(i,"change:"+n),t&&r&&(o.push(r),i.set(n,r.get("value")),e.listenTo(r,"change:value",function(t,e){i.set(n,e)}),e.listenTo(i,"change:"+n,function(t,e){r.set("value",e)}))},ne.prototype.updateBindingDeep=function(t,e,i,n,o){var r=this.get(t);e.stopListening(i,"change:"+n),t&&r&&(o.push(r),i.set(n,r.get("value")),e.listenTo(r,"change:value",function(t,e){i.set(n,e)}),e.listenTo(i,"change:"+n,function(t,e){r.set("value",e)}))},ne.prototype.updateSchema=function(){var t=rt.RTTI.getByName(this.get("_type")).editor;this.schema._default=t,this.schema.value=t},ne.prototype.silentCast=function(t,e,i){this.get(t)instanceof e||this.set(t,new e(this.get(t),i),{silent:!0})},rt.DocumentViewModel=ne,function(n){var o,t=(o=n.CommandoModel,C(i,o),i.prototype.clone=function(){var t=this.toJSON();delete t.id,t.widgets=t.widgets.clone();var e=new i(t,{},this.parent);return t.widgets.setParent(e),e},i.prototype.defaults=function(){return{id:null,name:"Screen 1",thumb:null,widgets:new n.WidgetCollection([],{},this),relativeHeight:void 0,rowCount:void 0,rowHeight:void 0,colCount:36,floatable:!0}},i.prototype.commandSet=function(t){var i=this,e=_.mapValues(t,function(t,e){return i.previous(e)});this.postCommand(this,new n.Command("Set Screen",[],[new n.Todo(n.CommandOp.Set,"",t)],[new n.Todo(n.CommandOp.Set,"",e)]))},i.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},i.prototype.doCommand=function(t,e){var i=this;if(0<t.length){var n=t.pop();if("widgets"===n)return this.get(n).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){i.set(t.payload)})},i.prototype.onMaterialChange=function(){this.trigger("materialChange")},i.prototype.parseCastAndListen=function(t,e,i,n){!t||!t[e]||t[e]instanceof i||(t[e]=new i(t[e],{},this),this.listenTo(t[e],n,function(){this.trigger("change",this)}))},i.prototype.parse=function(t){return this.parseCastAndListen(t,"widgets",n.WidgetCollection,"change add remove"),t},i.prototype.postCommand=function(t,e){return t instanceof n.WidgetCollection&&e.path.push("widgets"),e.path.push(this.id),this.parent&&this.parent.postCommand(this,e)},i.prototype.silentCast=function(t,e){this.get(t)instanceof e||this.set(t,new e(this.get(t),{},this),{silent:!0})},i);function i(t,e,i){i=o.call(this,t,e,i)||this;return i.IMMATERIAL_ATTRIBUTES=["isDefault","thumb","widgets"],i.get("id")||i.set({id:n.Helpers.getGUID()},{silent:!0}),i.get("widgets")&&(i.silentCast("widgets",n.WidgetCollection),i.listenTo(i.get("widgets"),"change add remove",function(t){this.trigger("change")})),i.listenTo(i,"change",i.determineMaterialChange.bind(i)),i.listenTo(i.get("widgets"),"materialChange",i.onMaterialChange.bind(i)),i}n.Screen=t;var e,r=(e=n.ComandoCollection,C(s,e),s);function s(){var t=null!==e&&e.apply(this,arguments)||this;return t.descriptor="Screen",t}(n.ScreenCollection=r).prototype.model=t}(zt=zt||{}),function(s){var n,a=(n=s.CommandoModel,C(t,n),t.prototype.convertPathsToModels=function(o){var e=this;_.each(this.attributes,function(n,t){n instanceof Array&&_.each(n,function(t,i){_.each(t,function(t,e){"viewstate"===t._dashboardsType&&(n[i][e]=o.getByPath(t.value))})}),"viewstate"===n._dashboardsType&&e.set(t,o.getByPath(n.value),{silent:!0})})},t.prototype.defaults=function(){return{visible:!1,dialogTitle:"",dialogHeight:0,dialogWidth:0,modal:!1,resizable:!1,widgets:new s.WidgetCollection([],{},this),id:s.Helpers.getGUID()}},t.prototype.doCommand=function(t,e){var i=this;if(0<t.length){var n=t.pop();if("widgets"===n)return this.get(n).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){t=_.isArray(t.payload)?_.find(t.payload,{id:i.id}):t.payload;t&&i.set(t)})},t.prototype.postCommand=function(t,e){return t instanceof s.WidgetCollection&&e.path.push("widgets"),e.path.push(this.id),this.parent.postCommand(this,e)},t.prototype.onMaterialChange=function(){this.trigger("materialChange")},t.prototype.transformToWidgetCollection=function(){var t=this.get("widgets");t instanceof s.WidgetCollection||(t=new s.WidgetCollection(t?t[0]:[],{},this),this.set("widgets",t,{silent:!0}))},t);function t(t,e,i){i=n.call(this,t,e,i)||this;return i.idAttribute="id",i.get("id")||i.set({id:s.Helpers.getGUID()},{silent:!0}),i.transformToWidgetCollection(),i.listenTo(i,"change",i.onMaterialChange.bind(i)),i.listenTo(i.get("widgets"),"add remove materialChange",i.onMaterialChange.bind(i)),i}s.Popup=a;var e,i=(e=s.ComandoCollection,C(o,e),o.prototype.commandSet=function(t){var i=this,e=[],n=this.toJSON(),o=[],e=_.differenceBy(t,n,function(t){return t.id}),r=_.filter(t,function(t){var e=i.get(t.id);return!!e&&e.changedAttributes(t)}),o=_.differenceBy(n,t,function(t){return t.id});e.length&&this.commandAdd(e.map(function(t){return new a(t,{},i)})),_.each(r,function(t){i.postCommand(i,new s.Command(i.getCommandDescription(s.CommandOp.Set,t),[t.id],[new s.Todo(s.CommandOp.Set,"",t)],[new s.Todo(s.CommandOp.Set,"",n)]))}),o.length&&this.commandRemove(o.map(function(t){return i.get(t.id)||new a(t,{},i)}))},o.prototype.postInitialize=function(e){this.each(function(t){t.convertPathsToModels(e)}),this.trigger("viewStatesParsed"),this.listenTo(this,"add remove reset",function(){this.trigger("materialChange")})},o);function o(){var t=null!==e&&e.apply(this,arguments)||this;return t.descriptor="Popup",t}(s.PopupCollection=i).prototype.model=a}(zt=zt||{}),function(r){var n,t=(n=m.Model,C(i,n),i.reorganizePopupsAndMappers=function(d,h){var g={"Basics.DialogHeight":"dialogHeight","Basics.DialogTitle":"dialogTitle","Basics.DialogWidth":"dialogWidth","Basics.Modal":"modal","Basics.Resizable":"resizable","Basics.Visible":"visible"},f=function(t){var i=[],p=function(e){var i,n,o,r,s,t,a,l,u=e.get("components"),c=e.get("widgets");e&&"Popup"===e.get("key")?(a=(t=e).get("options"),l={},_.each(g,function(t,e){e=a.get(e);_.isObject(e)&&"viewstate"===e._dashboardsType?l[t]=d.get("viewState").getByPath(e.value):l[t]=e}),l.widgets=t.get("widgets"),d.get("popups").add(l),h&&f(l.widgets)):e&&"QueryMapper"===e.get("key")?(o=(t=e).get("options").get("Basics.Mapping"),t=t.get("options").get("Basics.Data"),r={key:void 0,value:void 0,mappings:void 0},s=_.uniqueId("queryMapperUpgrade_"),(i=_.isObject(t)&&"data"===t._dashboardsType?d.get("data").getByPath(t.value):i)&&o&&o.length&&(n=i.get("_mappings")||{},i.subscribe(s,{onData:function(t,e){t=t.columns.collection.map("id");i.unsubscribe(s),r.key=t[0]||"",r.value=t[1]||"",r.mappings=n.mappings||{},_.each(o,function(t){t.Viewstate instanceof m.Model?r.mappings[t.Key]={_dashboardsType:"viewstate",value:t.Viewstate.path}:r.mappings[t.Key]=t.Viewstate||""}),i.set("_mappings",r),i.apply()}},!1))):u&&!u.isEmpty()?u.each(function(t){e&&_.includes(["Popup","QueryMapper"],e.get("key"))&&u.remove(t),p(t)}):c&&!c.isEmpty()&&f(c)};t.each(function(t){var e;(t=(e=t).get("component"))&&(_.includes(["Popup","QueryMapper"],t.get("key"))&&i.push(e),p(t))}),t.remove(i)};d.get(h?"popups":"screens").each(function(t){f(t.get("widgets"))})},i.renameCookie=function(t){_.each({viewStateDialogSize:"dashboard-viewStateDialog-size",viewStateDialogPosition:"dashboard-viewStateDialog-position",viewStateDialogWeights:"dashboard-viewStateDialog-weights","kx-datadialog-settings":"dashboard-datadialog-settings"},function(t,e){var i=$.cookie(e);$.removeCookie(e,{path:"/"}),$.cookie(t,i)})},i.prototype.commandSet=function(t){var i=this,e=_.mapValues(t,function(t,e){return i.previous(e)}),e=new r.Command("Set Options",[],[new r.Todo(r.CommandOp.Set,"",t)],[new r.Todo(r.CommandOp.Set,"",e)]);this.postCommand(this,e)},i.prototype.defaults=function(){var t=new r.DocumentViewModel({selected:{_viewType:!0,_default:"0",value:""},".settings":new m.Model},{root:!0},this),e=new r.ScreenCollection([],{},this);return e.add(new r.Screen({},{},e)),{id:null,name:"My New Dashboard",creationDate:null,lastUpdateDate:null,thumb:null,screenDetails:[],screens:e,popups:new r.PopupCollection([],{},this),tags:[],dashboardTheme:_.capitalize(($.cookie("dashboard-theme")||"dark").replace(/(kx-|room)/g,"")),themeSwitchable:!0,saveTimestamp:null,relativeHeight:void 0,rowCount:void 0,rowHeight:void 0,colCount:36,floatable:!0,viewState:t,data:new r.DocumentDataModel({},null,"",t,!0),permissionEntity:null,worksheetPadding:10,widgetsSpacing:0,borderColor:"000000",borderBackground:"000000",transparentBackground:!0,borderWidth:0,borderRounding:0,borderSpacing:0,borderShadow:!1,saveViewerState:"Enabled",enableShareDashboard:!1,notifications:null,showLoadingIndicators:!0,unsavedViewerPrompt:!1,advancedCss:"",cssClasses:""}},i.prototype.doCommand=function(t,e){var i=this;if(0<t.length){var n=t.pop();if(-1!=["screens","popups","data","viewState"].indexOf(n))return this.get(n).doCommand(t,e);throw"Unsupported command key"}e.forEach(function(t){i.set(t.payload)})},i.prototype.determineMaterialChange=function(){this.changed&&!_.isEmpty(_.omit(this.changed,this.IMMATERIAL_ATTRIBUTES))&&this.trigger("materialChange")},i.prototype.onViewStateInit=function(){this.get("viewState").postInitialize();var t=this.get("cssClasses");t&&"viewstate"===t._dashboardsType&&this.set("cssClasses",this.get("viewState").getByPath(t.value),{silent:!0}),this.get("popups").postInitialize(this.get("viewState")),this.viewStateInit=!0},i.prototype.saveDelayed=function(t){var e=this;this.saveTimeout&&clearTimeout(this.saveTimeout),this.saveTimeout=setTimeout(function(){return e.saveNow(t)},this.SAVE_DELAY)},i.prototype.saveNow=function(t,e){var i=this,n=[];if(_.isEmpty(this.get("screens").models))return t("Document is empty, skipping save."),void r.Log.Warn("Document is empty, skipping save.");this.saveTimeout&&clearTimeout(this.saveTimeout),r.Log.Info("SAVE",this.id),this.set({lastUpdateDate:(new Date).toUTCString()},{silent:!0}),_.each(this.get("screens").models,function(t){n.push({label:t.get("name"),value:t.id})}),this.set({screenDetails:n}),this.set({thumb:0<this.get("screens").models.length?this.get("screens").models[0].get("thumb"):null},{silent:!0});var o=$.extend(!0,{},this.attributes);this.setDataProperties(o.notifications),this.setDataProperties(o.shortcuts),o.popups.each(function(t){t.set(i.setDataProperties(_.omit(t.attributes,"widgets")),{silent:!0})}),o.cssClasses=this.setViewStateProperty(o.cssClasses),this.save(o,{error:t,success:function(t){r.Log.Info("success",arguments),i.trigger("documentSaved"),i.set("wasChanged",!1),e&&e(t)}})},i.prototype.silentCast=function(t,e,i){this.get(t)instanceof e||this.set(t,new e(this.get(t),i,this),{silent:!0})},i.prototype.setDataProperties=function(t){if(t){for(var e in t)t[e]&&t[e].path?t[e]instanceof r.DocumentDataModel?t[e]={_dashboardsType:"data",value:t[e].path}:t[e]instanceof r.DocumentViewModel&&(t[e]={_dashboardsType:"viewstate",value:t[e].path}):"object"==typeof t[e]&&(t[e]=this.setDataProperties(t[e]));return t}},i.prototype.setViewStateProperty=function(t){return t=t instanceof r.DocumentViewModel?{_dashboardsType:"viewstate",value:t.path}:t},i.prototype.toJSON=function(){var e=this,t=$.extend(!0,{},this.attributes);return this.setDataProperties(t.notifications),this.setDataProperties(t.shortcuts),t.popups.each(function(t){t.set(e.setDataProperties(_.omit(t.attributes,"widgets")))}),t.cssClasses=this.setViewStateProperty(t.cssClasses),t},i.prototype.toJSONClone=function(){var e=this,t=_.cloneDeep(this.attributes);return this.setDataProperties(t.notifications),this.setDataProperties(t.shortcuts),t.popups.each(function(t){t.attributes=_.extend(e.setDataProperties(_.omit(t.attributes,"widgets")),{widgets:t.get("widgets")})}),t.cssClasses=this.setViewStateProperty(t.cssClasses),t},i.prototype.parseCastAndListen=function(t,e,i,n,o){!t||!t[e]||t[e]instanceof i||(t[e]=o?o(t[e]):new i(t[e],{},this))},i.prototype.postCommand=function(t,e){return t instanceof r.ScreenCollection?e.path.push("screens"):t instanceof r.PopupCollection?e.path.push("popups"):t instanceof r.DocumentDataModel?e.path.push("data"):t instanceof r.DocumentViewModel&&e.path.push("viewState"),this.trigger("postCommand"),this.set("wasChanged",!0),i.parent&&i.parent.postCommand(this,e)},i.prototype.parse=function(i){var t=this.get("cssClasses");return t&&"viewstate"===t._dashboardsType&&this.set("cssClasses",this.get("viewState").getByPath(t.value)),this.parseCastAndListen(i,"viewState",r.DocumentViewModel,"change",function(t){return new r.DocumentViewModel(t,{root:!0},this)}),this.parseCastAndListen(i,"data",r.DocumentDataModel,"change",function(t){return new r.DocumentDataModel(t,null,"",i.viewState,!0)}),this.parseCastAndListen(i,"screens",r.ScreenCollection,"change add remove"),this.parseCastAndListen(i,"popups",r.PopupCollection,"change add remove"),this.viewStateInit&&this.get("popups").postInitialize(this.get("viewState")),_.each(i.shortcuts,function(t){var e=t.Data;e&&"data"===e._dashboardsType&&(t.Data=i.data.getByPath(e.value))}),i},i.prototype.upgrade=function(){var t,e;if(0<_.keys(this.attributes).length)for(t=r.Document.upgrades.indexOf(_.find(r.Document.upgrades,{version:this.get("version")}))+1;t<r.Document.upgrades.length;t+=1)(e=r.Document.upgrades[t]).fn(this),this.set("version",e.version)},i.upgrades=[{version:"4.3.0",fn:function(i){_.each(i.get("viewState").getViewStateList(),function(t){function e(t){return t=t instanceof r.DocumentViewModel?t.path:_.isObject(t)?t.name:t,i.get("viewState").getByPath(t)}"dict"===t.model.get("_type")&&(t.model.set("_default",_.mapValues(t.model.get("_default"),e)),t.model.set("value",_.mapValues(t.model.get("value"),e)))})}},{version:"4.4.0",fn:function(t){i.reorganizePopupsAndMappers(t,!1)}},{version:"4.4.0p7",fn:function(t){i.reorganizePopupsAndMappers(t,!0)}},{version:"4.6.0",fn:function(t){t.set("saveViewerState",!1===t.get("enableSaveViewState")?"disabled":"enabled")}},{version:"4.6.0P1",fn:function(t){i.renameCookie(t)}}],i);function i(t,e){e=n.call(this,t,e)||this;e.IMMATERIAL_ATTRIBUTES=["data","viewState","wasChanged"],e.sampleData=null,e.SAVE_DELAY=3e4,e.saveTimeout=null,e.version="4.6.0P1",e.viewStateInit=!1;var i=e;return e.get("id")||e.set({id:r.Helpers.getGUID()},{silent:!0}),e.silentCast("viewState",r.DocumentViewModel,{root:!0}),e.silentCast("popups",r.PopupCollection),e.silentCast("screens",r.ScreenCollection),e.get("data")instanceof r.DocumentDataModel||e.set("data",new r.DocumentDataModel(e.get("data"),null,"",e.get("viewState"),!0),{silent:!0}),e.listenTo(e,"view-state-init",e.onViewStateInit),e.listenTo(e,"change",e.determineMaterialChange),e.listenTo(e.get("screens"),"change add remove",function(t){i.trigger("change",arguments)}),e.has("showLoadingIndicators")||e.set("showLoadingIndicators",!0,{silent:!0}),e}r.Document=t;var o,e=(o=m.Collection,C(s,o),s.prototype.getSortedDocuments=function(){return this.sortBy(function(t){return 3-(2*(_.includes(t.get("tags"),"defaultdash")?1:0)+(_.includes(t.get("tags"),"starred")?1:0))+t.get("name")})},s.requiredAccessLevel=null,s);function s(t,e){e=o.call(this,t,e)||this;if(s.singleton)throw"Singleton Error! DocumentCollection() invoked 2x.";return s.singleton=e}(r.DocumentCollection=e).prototype.model=t}(zt=zt||{}),at=zt=zt||{},lt=m.Model,C(oe,lt),oe.prototype.defaults=function(){return{commands:[],commandIndex:-1,buildMode:!0,isInspecting:!1,selectedDocumentId:null,selectedScreenId:null,selectedWidgetId:null,selectedSubComponent:null,userConfigurable:!1,componentsPanel:new m.Model({search:null})}},oe.prototype.goToCommandIndex=function(t){var e=this.get("commandIndex"),i=this.get("commands"),n=at.DocumentCollection.singleton.get(this.get("selectedDocumentId"));if(t===e&&(t-=1),e<t)for(var o=e+1;o<=t;o++)0<=o&&o<i.length&&n.doCommand(_.clone(i[o].path),i[o].todo);else if(t<e)for(o=e;t<o;o--)0<=o&&o<i.length&&n.doCommand(_.clone(i[o].path),i[o].undo);this.set("commandIndex",t)},oe.prototype.doCommand=function(t,e){},oe.prototype.postCommand=function(t,e){var i=this.get("commands"),n=this.get("commandIndex");n<i.length-1&&i.splice(n+1,i.length-n-1),i.push(e),at.Log.Info("AppViewModel::onCommand",this.get("commands")),this.goToCommandIndex(n+1)},oe.prototype.redo=function(){this.goToCommandIndex(this.get("commandIndex")+1)},oe.prototype.resetCommands=function(){this.set("commands",[],{silent:!0}),this.set("commandIndex",-1,{silent:!0}),this.trigger("change:commandIndex")},oe.prototype.undo=function(){this.goToCommandIndex(this.get("commandIndex")-1)},at.AppViewModel=oe,K=zt=zt||{},re.AboutDialog=s.template({1:function(t,e,i,n,o){var r=t.lambda,s=t.escapeExpression;return"            <tr>\r\n                <td>Delta Control Host:</td>\r\n                <td>"+s(r(null!=(t=null!=e?e.dashboardControlDetails:e)?t.dchost:t,e))+"</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Delta Control Port:</td>\r\n                <td>"+s(r(null!=(t=null!=e?e.dashboardControlDetails:e)?t.dcport:t,e))+"</td>\r\n            </tr>\r\n            <tr>\r\n                <td>Delta Control TLS:</td>\r\n                <td>"+s(r(null!=(t=null!=e?e.dashboardControlDetails:e)?t.dctls:t,e))+"</td>\r\n            </tr>\r\n            <tr>\r\n                <td>KDB Banner:</td>\r\n                <td>"+s(r(null!=(t=null!=e?e.dashboardControlDetails:e)?t.bannerText:t,e))+"</td>\r\n            </tr>\r\n            <tr>\r\n                <td>KDB Version:</td>\r\n                <td>"+s(r(null!=(t=null!=e?e.dashboardControlDetails:e)?t.kdbVersion:t,e))+"</td>\r\n            </tr>\r\n            <tr>\r\n                <td>KDB Release Date:</td>\r\n                <td>"+s(r(null!=(t=null!=e?e.dashboardControlDetails:e)?t.releaseDate:t,e))+"</td>\r\n            </tr>\r\n            <tr>\r\n                <td>KDB Update Date:</td>\r\n                <td>"+s(r(null!=(t=null!=e?e.dashboardControlDetails:e)?t.updateDate:t,e))+"</td>\r\n            </tr>\r\n"},3:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},s=i.helperMissing,a=t.escapeExpression;return"            <tr>\r\n                <td>"+a("function"==typeof(t=null!=(t=i.key||(null!=e?e.key:e))?t:s)?t.call(r,{name:"key",hash:{},data:o}):t)+":</td>\r\n                <td>"+a("function"==typeof(t=null!=(t=i.value||(null!=e?e.value:e))?t:s)?t.call(r,{name:"value",hash:{},data:o}):t)+"</td>\r\n            </tr>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},s=i.helperMissing,a="function",l=t.escapeExpression,l='<div class="splash">\r\n    <div class="version">'+l(typeof(u=null!=(u=i.PackageName||(null!=e?e.PackageName:e))?u:s)==a?u.call(r,{name:"PackageName",hash:{},data:o}):u)+'</div>\r\n    <div class="scroll">\r\n        <p>Copyright in Kx Dashboards belongs to First Derivatives plc. © First Derivatives plc 2009-2018. All rights reserved. Use of the software is subject to the terms of First Derivatives plc’s license agreement. Kx and kdb+ are trademarks of Kx Systems Inc.<br/>Kx System Inc. is a subsidiary of First Derivatives plc. Portions of the Kx Dashboards software use code and/or materials under license from third-party suppliers.</p>\r\n        <table style="width: 100%;">\r\n            <tr>\r\n                <td>'+l((i.t||e&&e.t||s).call(r,"User Name",{name:"t",hash:{},data:o}))+":</td>\r\n                <td>"+l(typeof(u=null!=(u=i.userName||(null!=e?e.userName:e))?u:s)==a?u.call(r,{name:"userName",hash:{},data:o}):u)+"</td>\r\n            </tr>\r\n            \x3c!--\r\n            <tr>\r\n                <td>"+l((i.t||e&&e.t||s).call(r,"Delta Client Host",{name:"t",hash:{},data:o}))+":</td>\r\n                <td>"+l(typeof(u=null!=(u=i.DeltaClientHost||(null!=e?e.DeltaClientHost:e))?u:s)==a?u.call(r,{name:"DeltaClientHost",hash:{},data:o}):u)+"</td>\r\n            </tr>\r\n            <tr>\r\n                <td>"+l((i.t||e&&e.t||s).call(r,"Delta Client Port",{name:"t",hash:{},data:o}))+":</td>\r\n                <td>"+l(typeof(u=null!=(u=i.DeltaClientPort||(null!=e?e.DeltaClientPort:e))?u:s)==a?u.call(r,{name:"DeltaClientPort",hash:{},data:o}):u)+"</td>\r\n            </tr>\r\n            <tr>\r\n                <td>&nbsp;</td>\r\n            </tr>\r\n            <tr>\r\n                <td>"+l((i.t||e&&e.t||s).call(r,"Delta Control",{name:"t",hash:{},data:o}))+":</td>\r\n            </tr>--\x3e\r\n"+(null!=(c=i.unless.call(r,null!=e?e.isLite:e,{name:"unless",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?c:"")+"            <tr>\r\n                <td>&nbsp;</td>\r\n            </tr>\r\n            <tr>\r\n                <td>"+l((i.t||e&&e.t||s).call(r,"UI Components",{name:"t",hash:{},data:o}))+":</td>\r\n            </tr>\r\n",u=null!=(u=i.paths||(null!=e?e.paths:e))?u:s,o={name:"paths",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o},c=typeof u==a?u.call(r,o):u;return null!=(c=!i.paths?i.blockHelperMissing.call(e,c,o):c)&&(l+=c),l+"        </table>\r\n    </div>\r\n</div>"},useData:!0}),re.AreYouSureDialog=s.template({1:function(t,e,i,n,o){var r;return"<p>\r\n    "+t.escapeExpression("function"==typeof(r=null!=(r=i.message||(null!=e?e.message:e))?r:i.helperMissing)?r.call(null!=e?e:t.nullContext||{},{name:"message",hash:{},data:o}):r)+"\r\n</p>\r\n"},3:function(t,e,i,n,o){var r,s=null!=e?e:t.nullContext||{};return"<p>\r\n    Components "+(null!=(r=i.if.call(s,null!=e?e.dashChanged:e,{name:"if",hash:{},fn:t.program(4,o,0),inverse:t.noop,data:o}))?r:"")+"have unsaved changes:\r\n    <ul>\r\n"+(null!=(r=i.each.call(s,null!=e?e.components:e,{name:"each",hash:{},fn:t.program(6,o,0),inverse:t.noop,data:o}))?r:"")+"    </ul>\r\n</p>\r\n"},4:function(t,e,i,n,o){return"also "},6:function(t,e,i,n,o){var r=t.lambda,s=t.escapeExpression;return'        <li><span title="'+s(r(null!=e?e.widget:e,e))+'">'+s(r(null!=e?e.component:e,e))+"</span>"+(null!=(o=i.if.call(null!=e?e:t.nullContext||{},null!=e?e.message:e,{name:"if",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o}))?o:"")+"</li>\r\n"},7:function(t,e,i,n,o){return": "+t.escapeExpression(t.lambda(null!=e?e.message:e,e))},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){var r,s=null!=e?e:t.nullContext||{};return(null!=(r=i.if.call(s,null!=e?e.dashChanged:e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?r:"")+(null!=(r=i.if.call(s,null!=e?e.components:e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o}))?r:"")+'<p>Would you like to save?</p>\r\n<div class="error-info" style="color: red;">\r\n    There was an error saving this dashboard.\r\n\r\n    <ul class="error-list"></ul>\r\n</div>'},useData:!0}),re.ComponentView=s.template({compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},s=i.helperMissing,t=t.escapeExpression;return'<div class="border-div">\r\n    <div class="title-div"></div>\r\n    <div class="app-div dashboard-dark"></div>\r\n</div>\r\n\r\n<div class="errorMessage ui-state-header">\r\n    <div class="errorPanel ui-state-error">\r\n        <div class="errorTitle"><i class="fa fa-exclamation-triangle"></i><span>'+t((i.t||e&&e.t||s).call(r,"Error",{name:"t",hash:{},data:o}))+'</span></div>\r\n        <span class="errorText"></span>\r\n    </div>\r\n    <div class="errorPanel ui-state-warning">\r\n        <div class="errorTitle"><i class="fa fa-exclamation-circle"></i><span>'+t((i.t||e&&e.t||s).call(r,"Warning",{name:"t",hash:{},data:o}))+'</span></div>\r\n        <span class="errorText"></span>\r\n    </div>\r\n    <div class="errorPanel ui-state-highlight">\r\n        <div class="errorTitle"><i class="fa fa-info-circle"></i><span>'+t((i.t||e&&e.t||s).call(r,"Info",{name:"t",hash:{},data:o}))+'</span></div>\r\n        <span class="errorText"></span>\r\n    </div>\r\n</div>\r\n\r\n<div class="queryStatus ui-state-header">\r\n    <div class="statusPanel Error ui-state-error">\r\n        <div class="statusTitle"><i class="fa fa-exclamation-triangle"></i><span>'+t((i.t||e&&e.t||s).call(r,"Error",{name:"t",hash:{},data:o}))+'</span></div>\r\n        <span class="statusText"></span>\r\n    </div>\r\n    <div class="statusPanel Warning ui-state-warning">\r\n        <div class="statusTitle"><i class="fa fa-exclamation-circle"></i><span>'+t((i.t||e&&e.t||s).call(r,"Warning",{name:"t",hash:{},data:o}))+'</span></div>\r\n        <span class="statusText"></span>\r\n    </div>\r\n    <div class="statusPanel Info ui-state-highlight">\r\n        <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+t((i.t||e&&e.t||s).call(r,"Info",{name:"t",hash:{},data:o}))+'</span></div>\r\n        <span class="statusText"></span>\r\n    </div>\r\n    <div class="statusPanel Loading ui-state-highlight">\r\n        <div class="statusTitle"><i class="fa fa-spinner fa-pulse"></i><span>'+t((i.t||e&&e.t||s).call(r,"Loading",{name:"t",hash:{},data:o}))+'</span></div>\r\n        <span class="statusText"></span>\r\n    </div>\r\n<div class="statusPanel NoResults ui-state-highlight">\r\n        <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+t((i.t||e&&e.t||s).call(r,"No Results",{name:"t",hash:{},data:o}))+'</span></div>\r\n        <span class="statusText"></span>\r\n    </div>\r\n</div>\r\n\r\n<div class="progress-bar-div" style="width: 100%; height: 100%; overflow: hidden; position: absolute; left: 0; top: 0; z-index: 999;">\r\n    <div class="loading" style="display: table; width: 100%; height: 100%; max-height: 100%; opacity: 0.9; overflow: hidden;">\r\n        <div style="display: table-cell; width: 100%; height: 100%; max-height: 100%; vertical-align: middle; text-align: center;">\r\n            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="32" height="32" fill="#ffffff">\r\n                <circle cx="16" cy="3" r="0">\r\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n                </circle>\r\n                <circle transform="rotate(45 16 16)" cx="16" cy="3" r="0">\r\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.125s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n                </circle>\r\n                <circle transform="rotate(90 16 16)" cx="16" cy="3" r="0">\r\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.25s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n                </circle>\r\n                <circle transform="rotate(135 16 16)" cx="16" cy="3" r="0.567031">\r\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.375s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n                </circle>\r\n                <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\r\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n                </circle>\r\n                <circle transform="rotate(225 16 16)" cx="16" cy="3" r="2.88475">\r\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.625s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n                </circle>\r\n                <circle transform="rotate(270 16 16)" cx="16" cy="3" r="2.1029">\r\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.75s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n                </circle>\r\n                <circle transform="rotate(315 16 16)" cx="16" cy="3" r="0.60761">\r\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.875s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n                </circle>\r\n                <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\r\n                    <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n                </circle>\r\n            </svg>\r\n            <div class="loadingText" style="font-weight: bold; margin-top: 7px; font-size: 11px; letter-spacing: 1px;">\r\n                '+t((i.t||e&&e.t||s).call(r,"loading",{name:"t",hash:{},data:o}))+" "+t("function"==typeof(e=null!=(e=i.componentName||(null!=e?e.componentName:e))?e:s)?e.call(r,{name:"componentName",hash:{},data:o}):e)+"...\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"},useData:!0}),re.DocumentSelector=s.template({1:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},s=i.helperMissing,a=t.escapeExpression;return'    <option value="'+a("function"==typeof(t=null!=(t=i.id||(null!=e?e.id:e))?t:s)?t.call(r,{name:"id",hash:{},data:o}):t)+'">'+a("function"==typeof(t=null!=(t=i.name||(null!=e?e.name:e))?t:s)?t.call(r,{name:"name",hash:{},data:o}):t)+"</option>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){return"<select>\r\n"+(null!=(o=i.each.call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?o:"")+"</select>\r\n"},useData:!0}),re.DocumentView=s.template({compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){return'<div class="screen-view-div">\r\n</div>\r\n\r\n'},useData:!0}),re.InBrowserNotification=s.template({1:function(t,e,i,n,o){var r;return'    <i class="icon fa fa-'+t.escapeExpression("function"==typeof(r=null!=(r=i.icon||(null!=e?e.icon:e))?r:i.helperMissing)?r.call(null!=e?e:t.nullContext||{},{name:"icon",hash:{},data:o}):r)+'"></i>\r\n'},3:function(t,e,i,n,o){var r;return'    <div class="ttl">'+t.escapeExpression("function"==typeof(r=null!=(r=i.title||(null!=e?e.title:e))?r:i.helperMissing)?r.call(null!=e?e:t.nullContext||{},{name:"title",hash:{},data:o}):r)+"</div>\r\n"},5:function(t,e,i,n,o){var r;return'    <div class="msg">'+(null!=(r="function"==typeof(r=null!=(r=i.message||(null!=e?e.message:e))?r:i.helperMissing)?r.call(null!=e?e:t.nullContext||{},{name:"message",hash:{},data:o}):r)?r:"")+"</div>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){var r,s=null!=e?e:t.nullContext||{};return'<div class="inBrowserNotification">\r\n'+(null!=(r=i.if.call(s,null!=e?e.icon:e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?r:"")+"\r\n"+(null!=(r=i.if.call(s,null!=e?e.title:e,{name:"if",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o}))?r:"")+"\r\n"+(null!=(r=i.if.call(s,null!=e?e.message:e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o}))?r:"")+'\r\n    <i class="fa fa-times-circle"></i>\r\n</div>'},useData:!0}),re.LoginDialog=s.template({compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},s=i.helperMissing,t=t.escapeExpression;return'<div class="login-container quick-base login-dialog ui-widget ui-widget-content ui-corner-all ui-front">\r\n    <div class="logo"></div>\r\n    <div class="login-form user-login-form open">\r\n\r\n        <div class="input-container" style="margin-top: 7px">\r\n\r\n            <span>'+t((i.t||e&&e.t||s).call(r,"User",{name:"t",hash:{},data:o}))+':\r\n            </span>\r\n            <span>\r\n                <input class="username" tabindex="1" type="text" name="username" />\r\n            </span>\r\n\r\n        </div>\r\n        <div class="input-container" style="margin-top: 11px;">\r\n            <span >'+t((i.t||e&&e.t||s).call(r,"Password",{name:"t",hash:{},data:o}))+':\r\n            </span>\r\n            <span>\r\n                <input class="password" tabindex="2" type="password" name="password" />\r\n            </span>\r\n        </div>\r\n        <div class="forgot-info">'+t((i.t||e&&e.t||s).call(r,"forgot password",{name:"t",hash:{},data:o}))+'?</div>\r\n        <div class="loginErrorPanel">'+t((i.t||e&&e.t||s).call(r,null!=e?e.An:e,null!=e?e.error:e,null!=e?e.has:e,null!=e?e.occurred:e,e,{name:"t",hash:{},data:o}))+'</div>\r\n    </div>\r\n    <div class="login-form forgot-password-form">\r\n        <div class="form-text">Reset Password</div>\r\n        <div class="input-container">\r\n            <span>'+t((i.t||e&&e.t||s).call(r,"User",{name:"t",hash:{},data:o}))+':\r\n            </span>\r\n            <span>\r\n                <input class="reset-username" type="text"/>\r\n            </span>\r\n        </div>\r\n        <div class="reset-password-error">'+t((i.t||e&&e.t||s).call(r,"Please enter valid user name",{name:"t",hash:{},data:o}))+'</div>\r\n    </div>\r\n    <div class="login-form password-reset-info">\r\n        <div class="recovery-response form-text"></div>\r\n    </div>\r\n    <div class="login-button-panel ui-dialog-buttonpane ui-helper-clearfix">\r\n        <button class="login-btn ui-button ui-widget" tabindex="3" ></button>\r\n        <button class="reset-btn ui-button ui-widget"></button>\r\n        <button class="back-btn ui-button ui-widget"></button>\r\n    </div>\r\n</div>'},useData:!0}),re.ProfileMenu=s.template({1:function(t,e,i,n,o){var r=t.escapeExpression;return'            <option value="'+r(t.lambda(null!=e?e.id:e,e))+'">'+r((i.t||e&&e.t||i.helperMissing).call(null!=e?e:t.nullContext||{},null!=e?e.name:e,{name:"t",hash:{},data:o}))+"</option>\r\n"},3:function(t,e,i,n,o){var r=t.lambda,t=t.escapeExpression;return'                <option value="'+t(r(null!=e?e.value:e,e))+'">'+t(r(null!=e?e.label:e,e))+"</option>\r\n"},5:function(t,e,i,n,o){var r,s=null!=e?e:t.nullContext||{};return'            <optgroup label="'+t.escapeExpression("function"==typeof(r=null!=(r=i.key||o&&o.key)?r:i.helperMissing)?r.call(s,{name:"key",hash:{},data:o}):r)+'">\r\n'+(null!=(o=i.each.call(s,e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o}))?o:"")+"            </optgroup>\r\n"},7:function(t,e,i,n,o){var r=t.lambda,t=t.escapeExpression;return'            <option value="'+t(r(null!=e?e.value:e,e))+'">'+t(r(null!=e?e.label:e,e))+"</option>\r\n"},9:function(t,e,i,n,o){return'    <li data-options="document-breadcrumbs" class="breadcrumbs '+(null!=(o=i.if.call(null!=e?e:t.nullContext||{},null!=e?e.showBreadcrumbs:e,{name:"if",hash:{},fn:t.program(10,o,0),inverse:t.noop,data:o}))?o:"")+'">\r\n        <label>Show Selection Breadcrumb</label>\r\n        <i class="fa fa-check ui-checkboxradio-icon" />\r\n    </li>\r\n'},10:function(t,e,i,n,o){return"checked"},12:function(t,e,i,n,o){return'    <li class="ext-link" data-options="open-viewer">'+t.escapeExpression((i.t||e&&e.t||i.helperMissing).call(null!=e?e:t.nullContext||{},"Open Viewer",{name:"t",hash:{},data:o}))+'<i class="fa fa-external-link"\r\n            aria-hidden="true"></i></li>\r\n'},14:function(t,e,i,n,o){return null!=(o=i.if.call(null!=e?e:t.nullContext||{},null!=e?e.isLite:e,{name:"if",hash:{},fn:t.program(15,o,0),inverse:t.noop,data:o}))?o:""},15:function(t,e,i,n,o){return'    <li class="ext-link" data-options="open-editor">'+t.escapeExpression((i.t||e&&e.t||i.helperMissing).call(null!=e?e:t.nullContext||{},"Open Editor",{name:"t",hash:{},data:o}))+'<i class="fa fa-external-link"\r\n            aria-hidden="true"></i></li>\r\n'},17:function(t,e,i,n,o){return'    <li data-options="login-history">'+t.escapeExpression((i.t||e&&e.t||i.helperMissing).call(null!=e?e:t.nullContext||{},"Login History",{name:"t",hash:{},data:o}))+"</li>\r\n"},19:function(t,e,i,n,o){return'    <li data-options="helpguide">'+t.escapeExpression((i.t||e&&e.t||i.helperMissing).call(null!=e?e:t.nullContext||{},"Help",{name:"t",hash:{},data:o}))+"</li>\r\n"},21:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},s=i.helperMissing,t=t.escapeExpression;return'    <li data-options="logout-local">'+t((i.t||e&&e.t||s).call(r,"Local Logout",{name:"t",hash:{},data:o}))+'</li>\r\n    <li data-options="logout-global">'+t((i.t||e&&e.t||s).call(r,"Global Logout",{name:"t",hash:{},data:o}))+"</li>\r\n"},23:function(t,e,i,n,o){return null!=(o=i.unless.call(null!=e?e:t.nullContext||{},null!=e?e.isLite:e,{name:"unless",hash:{},fn:t.program(24,o,0),inverse:t.noop,data:o}))?o:""},24:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},s=i.helperMissing,t=t.escapeExpression;return'    <li data-options="change-password">'+t((i.t||e&&e.t||s).call(r,"Change Password",{name:"t",hash:{},data:o}))+'</li>\r\n    <li data-options="logout">'+t((i.t||e&&e.t||s).call(r,"Logout",{name:"t",hash:{},data:o}))+"</li>\r\n"},compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){var r,s=null!=e?e:t.nullContext||{},a=i.helperMissing,l=t.escapeExpression;return'<div class="row theme">\r\n    <div class="label">'+l((i.t||e&&e.t||a).call(s,"Editor Theme",{name:"t",hash:{},data:o}))+'</div>\r\n    <div class="control">\r\n        <select style="width: 100%" class="select-theme">\r\n'+(null!=(r=i.each.call(s,null!=e?e.themes:e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?r:"")+'        </select>\r\n    </div>\r\n</div>\r\n<div class="row viewer-theme">\r\n    <div class="label">'+l((i.t||e&&e.t||a).call(s,"Theme",{name:"t",hash:{},data:o}))+'</div>\r\n    <div class="control">\r\n        <select style="width: 100%" class="select-viewer-theme">\r\n'+(null!=(r=i.each.call(s,null!=e?e.themes:e,{name:"each",hash:{},fn:t.program(1,o,0),inverse:t.noop,data:o}))?r:"")+'        </select>\r\n    </div>\r\n</div>\r\n\x3c!-- <div class="row language">\r\n    <div class="label">'+l((i.t||e&&e.t||a).call(s,"Language",{name:"t",hash:{},data:o}))+'</div>\r\n    <div class="control">\r\n        <select style="width: 100%" class="select-language">\r\n            <option value="en">'+l((i.t||e&&e.t||a).call(s,"English",{name:"t",hash:{},data:o}))+'</option>\r\n            <option value="zh-HK">'+l((i.t||e&&e.t||a).call(s,"Chinese HK",{name:"t",hash:{},data:o}))+'</option>\r\n            <option value="de">'+l((i.t||e&&e.t||a).call(s,"German",{name:"t",hash:{},data:o}))+'</option>\r\n            <option value="ja">'+l((i.t||e&&e.t||a).call(s,"Japanese",{name:"t",hash:{},data:o}))+'</option>\r\n            <option value="ar">'+l((i.t||e&&e.t||a).call(s,"Arabic",{name:"t",hash:{},data:o}))+'</option>\r\n        </select>\r\n    </div>\r\n</div> --\x3e\r\n<div class="row timezone">\r\n    <div class="label">'+l((i.t||e&&e.t||a).call(s,"Timezone",{name:"t",hash:{},data:o}))+'</div>\r\n    <div class="control">\r\n        <select style="width: 100%" class="select-timezone">\r\n            <optgroup label="Major">\r\n'+(null!=(r=i.each.call(s,null!=e?e.majorTimezones:e,{name:"each",hash:{},fn:t.program(3,o,0),inverse:t.noop,data:o}))?r:"")+"            </optgroup>\r\n"+(null!=(r=i.each.call(s,null!=e?e.timezones:e,{name:"each",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o}))?r:"")+'        </select>\r\n    </div>\r\n</div>\r\n<div class="row log-level">\r\n    <div class="label">'+l((i.t||e&&e.t||a).call(s,"Log Level",{name:"t",hash:{},data:o}))+'</div>\r\n    <div class="control">\r\n        <select style="width: 100%" class="select-log-level">\r\n'+(null!=(r=i.each.call(s,null!=e?e.logLevel:e,{name:"each",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o}))?r:"")+'        </select>\r\n    </div>\r\n</div>\r\n<ul class="buttonset">\r\n'+(null!=(r=i.if.call(s,null!=e?e.editor:e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o}))?r:"")+(null!=(r=i.if.call(s,null!=e?e.editor:e,{name:"if",hash:{},fn:t.program(12,o,0),inverse:t.program(14,o,0),data:o}))?r:"")+(null!=(r=i.unless.call(s,null!=e?e.isLite:e,{name:"unless",hash:{},fn:t.program(17,o,0),inverse:t.noop,data:o}))?r:"")+'    <li data-options="about">'+l((i.t||e&&e.t||a).call(s,"About",{name:"t",hash:{},data:o}))+"</li>\r\n"+(null!=(r=i.if.call(s,null!=e?e.editor:e,{name:"if",hash:{},fn:t.program(19,o,0),inverse:t.noop,data:o}))?r:"")+(null!=(r=i.if.call(s,null!=e?e.saml:e,{name:"if",hash:{},fn:t.program(21,o,0),inverse:t.program(23,o,0),data:o}))?r:"")+"</ul>"},useData:!0}),re.fileExporter=s.template({compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){var r=null!=e?e:t.nullContext||{},s=i.helperMissing,t=t.escapeExpression;return'<div class="pnlButtons">\r\n    <span class="lnksExport link-disabled">\r\n        <i class="fa fa-fw fa-download" title="'+t((i.t||e&&e.t||s).call(r,"Data",{name:"t",hash:{},data:o}))+'"></i>\r\n        <a class="lnkExcelExport" title="'+t((i.t||e&&e.t||s).call(r,"Download the current dataset in Excel format",{name:"t",hash:{},data:o}))+'">'+t((i.t||e&&e.t||s).call(r,"Excel",{name:"t",hash:{},data:o}))+'</a>\r\n        <a class="lnkCsvExport" title="'+t((i.t||e&&e.t||s).call(r,"Download the current dataset in CSV format",{name:"t",hash:{},data:o}))+'">'+t((i.t||e&&e.t||s).call(r,"CSV",{name:"t",hash:{},data:o}))+'</a>\r\n        <a class="lnkFullExport" title="'+t((i.t||e&&e.t||s).call(r,"Download the full dataset from the server",{name:"t",hash:{},data:o}))+'">'+t((i.t||e&&e.t||s).call(r,"Full",{name:"t",hash:{},data:o}))+'</a>\r\n        <a class="lnkDownloadScreenshot" title="'+t((i.t||e&&e.t||s).call(r,"Download a PNG image of the chart",{name:"t",hash:{},data:o}))+'">'+t((i.t||e&&e.t||s).call(r,"PNG",{name:"t",hash:{},data:o}))+"</a>\r\n    </span> \r\n</div> \r\n"},useData:!0}),re.popup=s.template({compiler:[7,">= 4.0.0"],main:function(t,e,i,n,o){return'<div class="dialog">\n    <div class="content-panel" tabindex="1"></div>\n</div>'},useData:!0}),K.T=re,ut=zt=zt||{},ct=m.View,C(se,ct),se.prototype.remove=function(){return this.stopListening(),this.$el.off(),m.View.prototype.remove.call(this)},ut.AboutDialog=se,K=zt=zt||{},pt=m.View,C(ae,pt),ae.prototype.adjustWeights=function(t,i){var n=this.sum(_.map(t,function(t){return t.weight})),o=this.sum(i);_.each(t,function(t,e){t.weight=n*(i[e]/o)})},ae.prototype.onClick=function(t){t.isExpanded=!t.isExpanded,this.updateLayout(!0)},ae.prototype.onSectionResize=function(t,e,i){for(var n,o,r=0,s=t.$el.height(),a=s-i.originalSize.height,l=[t],u=[s],c=this.sections.indexOf(t)+1;c<this.sections.length&&(!(n=this.sections[c]).isExpanded||n.fixed||(o=Math.max(this.HEADING_HEIGHT,n.startHeight-(a-r)),r+=Math.min(n.startHeight-this.HEADING_HEIGHT,a-r),n.$el.height(o+"px"),l.push(n),u.push(o),r!==a));c+=1);this.adjustWeights(l,u)},ae.prototype.resize=function(){this.updateLayout(!1)},ae.prototype.setExpanded=function(t,e,i){i=i||!0,this.sections[t].isExpanded=e,this.updateLayout(i)},ae.prototype.sum=function(t){return _.reduce(t,function(t,e){return t+e},0)},ae.prototype.updateLayout=function(t){var i,e,n=this,o=n.$el.height();n.$el.toggleClass("animate",t),e=_.filter(n.sections,{isExpanded:!0}),o-=(n.sections.length-e.length)*n.HEADING_HEIGHT,o-=this.sum(_.map(_.filter(e,function(t){return t.isExpanded&&t.fixed}),function(t){return t.fixed})),e=this.sum(_.map(e,function(t){return t.weight})),i=o/e,_.each(n.sections,function(t,e){t.$el.toggleClass("expanded",t.isExpanded),t.isExpanded?t.$el.height((t.fixed||t.weight*i)+"px"):t.$el.height(0),t.resize&&t.resize(),t.isResizable&&t.isExpanded&&!t.fixed&&e<n.sections.length-1&&_.some(n.sections.slice(e+1),function(t){return t.isExpanded&&!t.fixed})?t.resizeable=t.$el.resizable({handles:"s",resize:$.proxy(n.onSectionResize,n,t),start:function(){_.each(n.sections,function(t){t.startHeight=t.$el.height()}),t.$el.resizable("option","maxHeight",n.$el.height()-(n.sections.length-1)*n.HEADING_HEIGHT)},stop:function(){n.updateLayout()}}):t.resizeable&&(t.$el.resizable("destroy"),delete t.resizeable)}),t?this.debouncedRemoveAnimate():n.onUpdate&&n.onUpdate(n.sections)},K.AccordionView=ae,K=zt=zt||{},le.prototype.on=function(t,e,i){},le.prototype.off=function(t,e,i){},le.prototype.trigger=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i]},le.prototype.bind=function(t,e,i){},le.prototype.unbind=function(t,e,i){},le.prototype.once=function(t,e,i){},le.prototype.listenTo=function(t,e,i){},le.prototype.listenToOnce=function(t,e,i){},le.prototype.stopListening=function(t,e,i){},K.CustomEvents=le,dt=zt=zt||{},ht=dt.CustomEvents,C(ue,ht),ue.addEdgeToCollection=function(t,e,i){var n=t[e];n?-1===n.indexOf(i)&&n.push(i):t[e]=[i]},ue.prototype.getFormDataSources=function(t,e,i){var n=this,o=this.getRelatedDataSources(_.map(t,function(t){return"vs:"+t}),this.edges),t=this.getRelatedDataSources(_.map(t,function(t){return"vs:"+t}),this.edgesR),e=this.getRelatedDataSources(_.map(e,function(t){return"ds:"+t}),this.edgesR),i=this.getRelatedDataSources(_.map(i,function(t){return"vs:"+t}),this.edgesR);return _.map(_.union(_.intersection(o,e),_.intersection(o,t),i),function(t){return n.nodes[t].model})},ue.prototype.unsubscribeAll=function(){var e=this;_.each(this.subscriptions,function(t){return e.unsubscribe(t.source)}),_.each(this.activeViewStateToSubscriptions,function(t){return e.unsubscribeViewStates(t)})},ue.prototype.addEdge=function(t){var e=t.fromNodeId,t=t.toNodeId;ue.addEdgeToCollection(this.edges,e,t),ue.addEdgeToCollection(this.edgesR,t,e)},ue.prototype.addNode=function(t,e,i){var n=t+":"+e;return this.nodes[n]||(this.nodes[n]={id:n,label:e,model:i,visited:!1}),this.onNodeUpdate&&("ds"===t&&i.agent.subscriberCount()&&this.subscribe(i,this.onNodeUpdate(n),n),"vs"===t&&(this.activeViewStateToSubscriptions[i.path]=i,this.listenTo(i,"change:value",this.onNodeUpdate(n)))),n},ue.prototype.breadthFirstSearch=function(t,e){return _.each(this.nodes,function(t){t.visited=!1}),this.visitAndMeetNeighbors(t,e)},ue.prototype.getDataSourceKey=function(t){if(t)return t.path||t.cid},ue.prototype.getRelatedDataSources=function(t,i){var n=this,t=_.reduce(t,function(t,e){return t.concat(n.breadthFirstSearch(e,i))},[]);return _.uniq(t.filter(function(t){return 0===t.indexOf("ds")}))},ue.prototype.subscribe=function(t,e,i,n,o){var r=this.getDataSourceKey(t);return this.subscriptions[r]?(this.subscriptions[r].callback=e,!1):(this.subscriptions[r]={source:t,onData:e},this.subscriptions[r].key=_.uniqueId(i+"_"),t.subscribe(this.subscriptions[r].key,this.subscriptions[r],n,o),!0)},ue.prototype.unsubscribe=function(t){var e=this.getDataSourceKey(t);this.subscriptions[e]&&(t.unsubscribe(this.subscriptions[e].key),delete this.subscriptions[e])},ue.prototype.unsubscribeViewStates=function(n){var o=this;_.each(this.activeViewStateToSubscriptions,function(t,e){var i=n.getByPath(e);o.stopListening(i,"change:value"),delete o.activeViewStateToSubscriptions[e]})},ue.prototype.visitAndMeetNeighbors=function(t,i){var n=this,e=[];return this.nodes[t]&&(this.nodes[t].visited||(this.nodes[t].visited=!0,e.push(t),(t=i[t])&&(e=_.reduce(t,function(t,e){return t.concat(n.visitAndMeetNeighbors(e,i))},e)))),e},dt.DocumentGraph=ue,function(t){var e=(i.prototype.onTriggerChange=function(t){var o=this,e=(this.triggers=t).map(function(t){if(t.source)return t.source.cid});t.forEach(function(t){var e=t.template,i=t.source,n=t.icon,t=t.sound;i&&!o.datasources[i.cid]?o.datasources[i.cid]=new r(i,e,n,t,o.sendNotification):i&&o.datasources[i.cid].updateTemplate(e,n,t)}),Object.keys(this.datasources).filter(function(t){return-1===e.indexOf(t)}).forEach(function(t){o.datasources[t].unsubscribe(),o.datasources[t]=void 0,delete o.datasources[t]})},i);function i(t){this.datasources={},this.templates={},this.triggers=[],this.sendNotification=t}t.DatasourceNotifier=e;var r=(n.prototype.updateTemplate=function(t,e,i){this.template=s.compile(t),this.icon=e,this.sound=i},n.prototype.subscribe=function(){this.source.subscribe("notifications",this),this.source.dataSet.noBackground=!0},n.prototype.unsubscribe=function(){this.source.unsubscribe("notifications")},n.prototype.onData=function(t,e){var o=this;e.add&&e.add.length&&e.add.forEach(function(t){t=_.omit(t,["_rowIndex"]);var e=o.template(t),i=o.source.path,n=o.sound,t=o.icon;o.sendNotification("datasource-notifications",{title:i,message:e,icon:t},{sound:n})})},n);function n(t,e,i,n,o){this.source=t,this.sound=n,this.icon=i,this.template=s.compile(e),this.sendNotification=o,this.subscribe()}}(zt=zt||{}),gt=zt=zt||{},ce.generateAggregatedMessage=function(t){var e=[];return _.each(t,function(t){t&&t[1]&&(t=t[1].message||"",e.push(37<t.length?t.substring(0,37)+" ..":t))}),e.join("\r\n")},ce.generateAudio=function(t){var e=_.now(),i=ce.suspendedAudioNotifications[t];return void 0===i||i<e?(ce.suspendedAudioNotifications[t]=e+5e3,new Audio(ce.MEDIA_LOCATION+t+".mp3")):null},ce.notify=function(t,e,i){var n=ce.currentSettings.Notifications;if(t!==ce.AGGREGATED_ID&&n.Grouping&&n.GroupingInterval)return 0===ce.pendingNotifications.length&&(ce.pendingNotificationsTimeoutId=setTimeout(function(){1<ce.pendingNotifications.length?ce.notify(ce.AGGREGATED_ID,{title:ce.pendingNotifications.length+" alerts received",message:ce.generateAggregatedMessage(ce.pendingNotifications)},!0):(ce.pendingNotifications[0][0]=ce.AGGREGATED_ID,ce.notify.apply(ce,ce.pendingNotifications[0])),ce.pendingNotificationsTimeoutId=void 0,ce.pendingNotifications=[]},1e3*n.GroupingInterval)),void ce.pendingNotifications.push(_.concat([],arguments));if(i&&n.SoundVolume&&"Audio"in window)try{var o=void 0;_.isBoolean(i)&&"none"!==n.Sound?o=ce.generateAudio(n.Sound):"none"!=i.sound&&(o=ce.generateAudio(i.sound)),o&&(o.volume=n.SoundVolume/100,o.play().then(function(){}).catch(function(){ce.hasNotified||(ce.notify("Notification API",{icon:"fa-volume-off",message:"Your browser is blocking notification audio, interact with the page to enable audio.",title:"Notification Audio Error"}),ce.hasNotified=!0)}))}catch(t){gt.Log.Error("Audio API ERROR",arguments)}if(e){var r,s=n.InBrowserNotifications||!("Notification"in window)||"denied"===Notification.permission,a=e.title||"Alert",l=e.message||"",o=e.icon||("none"!==n.Icon?n.Icon:null);if(o=o.substring(3),s)ce.$pnlNotifications||(r=function(){var t=$(this).closest(".inBrowserNotification"),e=t.data("fadeOutId");e&&clearTimeout(e),t.remove()},(ce.$pnlNotifications=$("<div></div>",{class:"pnlInBrowserNotifications"}).appendTo($(".document-view"))).on("click","i",r),ce.$pnlNotifications.on("dblclick",".inBrowserNotification",r)),ce.positionPanel(ce.$pnlNotifications,n.Position),ce.$pnlNotifications.children().length>=n.MaxVisibleCount&&ce.$pnlNotifications.children().first().remove(),r=$(gt.T.InBrowserNotification({title:a,message:l.replace(/\r\n/g,"<br/>"),icon:o})).appendTo(ce.$pnlNotifications),n.FadeOut&&r.data("fadeOutId",setTimeout(r.remove.bind(r),1e3*n.FadeOut));else try{var u,c=new Notification(a,{body:l,icon:o?ce.isWindows10()?ce.ICON_LOCATION_LIGHT+o+".png":ce.ICON_LOCATION+o+".png":void 0,silent:!0});n.FadeOut&&(u=function(){c.close(),window.removeEventListener("beforeunload",u)},c.onshow=function(){setTimeout(u,1e3*n.FadeOut)},window.addEventListener("beforeunload",u))}catch(t){gt.Log.Error("Notification API ERROR",arguments)}}},ce.positionPanel=function(t,e){e={"Top Left":"","Top Center":"position_center","Top Right":"position_right","Center Left":"position_middle","Center Center":"position_middle position_center","Center Right":"position_middle position_right","Bottom Left":"position_bottom","Bottom Center":"position_bottom position_center","Bottom Right":"position_bottom position_right"}[e];t.removeClass("position_middle position_bottom position_center position_right").addClass(e)},ce.isWindows10=function(){return 0<=window.navigator.userAgent.search(/(Windows 10.0)|(Windows NT 10.0)/)},ce.setOptions=function(t){ce.currentSettings=t,ce.datasourceNotifier.onTriggerChange(t.Notifications.triggers||[]),ce.pendingNotificationsTimeoutId&&(clearTimeout(ce.pendingNotificationsTimeoutId),ce.pendingNotificationsTimeoutId=void 0,ce.pendingNotifications=[])},ce.show=function(t,e,i){var n;ce.currentSettings.Notifications.Enabled&&(!ce.currentSettings.Notifications.InBrowserNotifications&&"Notification"in window&&"granted"!==Notification.permission&&"denied"!==Notification.permission?(n=arguments,Notification.requestPermission(function(){ce.show.apply(this,n)})):ce.notify(t,e,i))},ce.upgradeConfig=function(t){var e;return t?(e=void 0,t.Notifications._Version!==(e=ce.DEFAULT_JSON.Notifications._Version)&&(t.Notifications._Version=e)):t=ce.DEFAULT_JSON,t.Notifications.triggers=t.Notifications.triggers?t.Notifications.triggers.map(function(t){var e=t.source;return T(T({},t),{source:"data"===e._dashboardsType?ce.documentDataModel.getByPath(e.value):e})}):[],t},ce.setDocumentDataModel=function(t){this.documentDataModel=t},ce.pendingNotifications=[],ce.AGGREGATED_ID="AGGREGATED_NOTIFICATION",ce.hasNotified=!1,ce.suspendedAudioNotifications={},ce.MEDIA_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/notifications/",ce.ICON_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/images/black/",ce.ICON_LOCATION_LIGHT=require.toUrl("QuickBase").replace("/main","")+"/images/white/",ce.SCHEMA={type:"object",title:"Properties",properties:{Notifications:{type:"object",title:"Notifications",options:{collapsed:!0},properties:{_Version:{type:"string",default:"4.2.0s2",options:{hidden:!0}},Enabled:{title:"Enabled",propertyOrder:100,type:"boolean",format:"checkbox",default:!0},InBrowserNotifications:{title:"InBrowser",propertyOrder:110,type:"boolean",format:"checkbox",default:!1},Position:{title:"Position",propertyOrder:120,type:"string",enum:["Top Left","Top Center","Top Right","Center Left","Center Center","Center Right","Bottom Left","Bottom Center","Bottom Right"],default:"Bottom Right"},MaxVisibleCount:{title:"Max Count",propertyOrder:130,type:"number",minimum:1,default:3},FadeOut:{title:"FadeOut (s)",propertyOrder:140,type:"number",minimum:0,default:5},Icon:{title:"Icon",propertyOrder:150,type:"icon",default:"fa-bell-o",iconTypes:"fa"},Sound:{title:"Sound",propertyOrder:160,type:"string",enum:ce.NOTIFICATION_SOUNDS=["beep","beepbeep","ding","exquisite","long-expected","festive","job-done","arcade","echo","case-closed","none"],default:"beep"},SoundVolume:{title:"Sound Volume",propertyOrder:170,type:"number",format:"range",minimum:0,maximum:100,default:100},Grouping:{title:"Group Notifications",propertyOrder:180,type:"boolean",format:"checkbox",default:!1},GroupingInterval:{title:"Grouping Interval (s)",propertyOrder:190,type:"number",minimum:0,default:1},triggers:{title:"Additional Triggers",type:"array",items:{type:"object",id:"arrItem",additionalProperties:!1,options:{collapsed:!0},title:"Datasource Trigger",properties:{source:{type:"data",propertyOrder:100,title:"Datasource"},template:{type:"tooltipTemplate",propertyOrder:101,title:"Notification Template",default:"{{#each this}}{{@key}}: {{this}}\n{{/each}}"},sound:{title:"Sound",propertyOrder:103,type:"string",enum:ce.NOTIFICATION_SOUNDS,default:"beep"},icon:{title:"Icon",iconTypes:"fa",propertyOrder:102,type:"icon",default:"fa-bell-o"}}}}}}}},ce.DEFAULT_JSON={Notifications:_.mapValues(ce.SCHEMA.properties.Notifications.properties,"default")},ce.currentSettings=ce.DEFAULT_JSON,ce.datasourceNotifier=new gt.DatasourceNotifier(ce.show),ce.CONFIG={SCHEMA:ce.SCHEMA,upgradeConfig:ce.upgradeConfig},gt.NotificationManager=ce,ft=zt=zt||{},mt=ft.CustomEvents,C(pe,mt),pe.prototype.getDataSourceMap=function(t,e,i){var n=this.dashboardViewModel.get("selectedDocumentId"),n=this.dashboardAppModel.get("documents").get(n);try{return new ft.DocumentGraph(n.get("viewState"),n.get("data").flatten(),n.get("data").getByPath.bind(n.get("data")),null).getFormDataSources(t,e,i)}catch(t){console.error("ComponentApi.getDataSourceMap error",t)}},pe.prototype.convertPathsToModels=function(t,e,s){var a,l=m.DeepModel.keyPathSeparator;if(!t)return!1;switch(t){case"data":a=$.proxy(this.docDataModel.getByPath,this.docDataModel);break;case"viewstate":a=$.proxy(this.docViewModel.getByPath,this.docViewModel)}e=this.getPropertiesByType(t,e.properties,e.definitions),_.each(e,function(t){var i,n,o,r,e=t.replace(/\.properties/g,"");1<(t=(e=e.replace(/\.oneOf\.\d+/g,"")).split(".items.")).length?(o=t[0],r=t[1],t=s.get(o),_.each(t,function(t,e){(n=function(t,e){e=e.split(".");for(var i=t,n=0;n<e.length;n++)i=i&&i[e[n]];return i}(t,r))&&"string"==typeof(n=n._dashboardsType?n.value:n)&&(i=(i=a(n))||{},s.set(o+l+e+l+r,i,{silent:!0}))})):(n=s.get(e))&&"string"==typeof(n=n._dashboardsType?n.value:n)&&(i=(i=a(n))||{},s.set(e,i,{silent:!0}))})},pe.prototype.destroySettings=function(){var t;this.quickView&&(t=this.docViewModel.get(".settings"))&&t.unset(this.componentId)},pe.prototype.exportData=function(t,i,e){"data"===this.getSourceType(t)?t.exportData(function(t){var e;(-1<navigator.userAgent.toLowerCase().indexOf("firefox")||-1<navigator.userAgent.toLowerCase().indexOf("safari"))&&-1===navigator.userAgent.toLowerCase().indexOf("chrome")?((e=document.createElement("a")).setAttribute("href",t),e.setAttribute("download",""),document.body.appendChild(e),e.click(),document.body.removeChild(e)):window.open(t,"_blank"),_.isFunction(i)&&i(t)},function(t){ft.Log.Error("Export Data error"+(t?": "+t.toString():"")),_.isFunction(i)&&i()},e):_.isFunction(i)&&i()},pe.prototype.doActions=function(t,a){var l=this,u={dashboard:"<none>",screen:"<none>",target:""};_.each(t,function(t,e){t._Type||(_.isObject(t)?t._Type="nav":t={_Type:"nav",Value:t});var e=t._PropertyIndex||e,i=(a||"Actions")+"."+e;switch(t._Type){case"map":var n=l.getPropertyMeta(i+".Current"),o=l.getPropertyMeta(i+".Target"),r=void 0;u.viewstate||(u.viewstate={}),n&&(r="viewstate"===n.type?n.value:t.Current,ft.Tools.isKDBTemporal(r)&&(r=ft.Tools.convertKDBTemporalToMoment(r).toDashString()),o&&"viewstate"===o.type&&o.path?l.setProperty(i+".Target",r):u.viewstate[t.Target]=r);break;case"nav":var s=l.getPropertyMeta(i+".SelectDashboardScreen"),s="viewstate"===s.type?s.value:t.SelectDashboardScreen;_.isString(s)?(u.dashboard=s,u.screen=null):_.isObject(t)&&(t["SelectDashboardScreen._dashboardsType"]?_.extend(u,{dashboard:t["SelectDashboardScreen.dashboard"],screen:t["SelectDashboardScreen.screen"]}):_.isObject(s)&&_.extend(u,s)),t.Target&&(u.target=t.Target);break;case"query":t.DataSource&&t.DataSource.forceExecute(void 0,t.callback);break;case"url":s=t.Url;/\S+/g.test(s)&&(/^https?:\/\//i.test(s)||(s="//"+s),window.open(s,t.Target||"_blank"))}}),"<none>"===u.dashboard&&"<none>"===u.screen||l.navigate(u)},pe.prototype.removeTooltip=function(){var t;this.unsubscribeTemplateViewStates(this.tooltipSubscriptionKey),this.tooltipSubscriptionKey="",null!==(t=this.genericTooltip)&&void 0!==t&&t.remove(),delete this.genericTooltip},pe.prototype.setTooltip=function(t){var e=this;return this.genericTooltip?this.genericTooltip.updateTooltip(t):this.genericTooltip=new ft.GenericTooltip(_.extend(t,{cssClass:this.appKey+"-tooltip"})),this.unsubscribeTemplateViewStates(this.tooltipSubscriptionKey),this.tooltipSubscriptionKey=this.subscribeTemplateViewStates(this.genericTooltip.text,function(t){e.genericTooltip.renderTemplate(t)}),this.genericTooltip},pe.prototype.extractTemplateViewStates=function(t){var e=this,t=t.match(/\$[^$]*\$/gi);return _.map(_.uniq(t),function(t){t=e.docViewModel.getByPath(t.substring(1,t.length-1).replace(/\./g,"/"));if(t)return t.path})},pe.prototype.getDashboardId=function(e){var t="<none>"===e?null:e&&"<this>"!==e?this.dashboardAppModel.get("documents").find(function(t){return t.get("name")===e}):this.dashboardAppModel.get("documents").get(this.dashboardViewModel.get("selectedDocumentId"));return t?t.id:"<none>"},pe.prototype.getScreenId=function(t,e){var i,n,o=this.dashboardAppModel.get("documents").get(t);return o&&(e&&"<none>"!==e?o.has("screens")?(t=o.get("screens").find(function(t){return t.get("name")===e}))&&(n=t.id):(i=_.find(o.get("screenDetails"),function(t){return t.label===e}))&&(n=i.value):(i=o.get("screenDetails")[0])&&(n=i.value)),n||"<none>"},pe.prototype.getDataSourceKey=function(t){return!!t&&(t.path||t.cid)},pe.prototype.getDictValue=function(t){var n=this,o={};return"dict"!==t.get("_type")||"object"!=typeof t.get("value")?t.get("value"):(_.each(t.get("value"),function(t,e){var i;t instanceof ft.DocumentViewModel?i=t.path:t instanceof m.Model?o[e]=t.get("value"):_.isObject(t)&&t.name?i=t.name:_.isString(t)&&t.match(ft.DocumentDataModel.PARAMETER_RX)&&(i=t.substring(2,t.length-2)),i?(i=n.docViewModel.getByPath(i),o[e]=i?i.get("value"):t):o[e]=t}),o)},pe.prototype.getPropertiesByType=function(i,t,n,o,r){var s=this,a=m.DeepModel.keyPathSeparator;return o=o||"",n=n||{},r=r||[],t&&(t.type===i?r.push(o):t&&t.constructor===Object?_.each(t,function(t,e){"$ref"===e?s.getPropertiesByType(i,n[t.replace("#/definitions/","")],n,o,r):s.getPropertiesByType(i,t,n,(o?o+a:"")+e,r)}):t&&t.constructor===Array&&_.each(t,function(t,e){s.getPropertiesByType(i,t,n,(o?o+a:"")+e,r)})),_.uniq(r)},pe.prototype.getProperty=function(t){var e,i;if(!t)return null;switch(e=this.settingsModel.get(t),this.getSourceType(e)){case"data":i=null;break;case"viewstate":i=this.getPropertyValue(e);break;default:i=e}return i},pe.prototype.getPropertyMeta=function(t){var e,i,n,o;if(!t)return null;if(null==(e=this.settingsModel.get(t)))return null;switch(t=this.getSourceType(e)){case"data":o=null;break;case"viewstate":o=this.getPropertyValue(e),i=e.get("_default"),n=e.get("_type");break;default:o=e}return{path:e.path||null,type:t,value:o,viewstateType:n||null,defaultValue:i||null}},pe.prototype.getPropertyValue=function(t){return"viewstate"===this.getSourceType(t)?"dict"===t.get("_type")?this.getDictValue(t):t.get("value"):t},pe.prototype.getSourceType=function(t){return t?t instanceof ft.DocumentViewModel||t.get&&t.get("_viewType")||t.has&&t.has("_default")&&t.has("value")?"viewstate":t instanceof ft.DocumentDataModel||t.subscribe&&t.unsubscribe?"data":null:null},pe.prototype.getSubscriptionKey=function(t){var e=this.appKey?this.appKey+" ":"";return e+=t||this.widgetId,_.uniqueId(e+":")},pe.prototype.getViewState=function(t){return!(!t||!t.attributes)&&t.get("value")},pe.prototype.getViewStates=function(t){var e=this;return _.zipObject(t,_.map(t,function(t){t=e.docViewModel.getByPath(t);if(t)return t.get("value")}))},pe.prototype.hideErrorMessage=function(){this.trigger("hideErrorMessage")},pe.prototype.hideQueryStatus=function(){this.trigger("hideQueryStatus")},pe.prototype.isBuildMode=function(){return this.dashboardViewModel.get("buildMode")&&!this.quickView},pe.prototype.isSelected=function(){var t=this.dashboardViewModel.get("selectedWidget");return!!t&&t.id===this.widgetId},pe.prototype.loadApp=function(t,e,i,n,o,r){t&&e&&(r=r||t,new ft.AppView(_.extend({},{el:e,key:t,settings:i,appOptions:n,callback:function(t){_.isFunction(o)&&o(t)},namespace:this.componentId+pe.NAMESPACE_SEPARATOR+r},_.pick(this,ft.AppView.COMMON_OPTIONS))))},pe.prototype.loadSetting=function(t,e){var i;if(!t||!this.quickView)return null;if(i=this.docViewModel.get(".settings"),n=this.componentId,e&&(n+=pe.NAMESPACE_SEPARATOR+e),i){var n=i.get(n);return n?n.get(t):null}return null},pe.prototype.navigate=function(t){var e,i,n=null,o=null,r=null,s=null,a=null,l="";_.isString(t)?(i=t,r=this.dashboardAppModel.get("documents").get(i)?i:this.getDashboardId(i),a="<none>"):_.isObject(t)&&(n=t.dashboard,s=t.screen,e=t.viewstate,n instanceof m.Model?n=n.get("value"):_.isObject(n)&&n.id&&(n=n.id),s instanceof m.Model?s=s.get("value"):_.isObject(s)&&s.id&&(s=s.id),"<this>"===n&&(n=this.dashboardViewModel.get("selectedDocumentId")),(o=this.dashboardAppModel.get("documents").get(n))?r=n:(r=this.getDashboardId(n),o=this.dashboardAppModel.get("documents").get(r)),o&&(a=_.isEmpty(o.get("screenDetails"))&&ft.Helpers.validateGuid(s)||_.find(o.get("screenDetails"),function(t){return t.value===s})?s:this.getScreenId(r,s))),_.isObject(e)&&!_.isEmpty(e)&&(l="?viewstate="+encodeURIComponent(JSON.stringify(e))),r&&a&&"<none>"!==r&&("_blank"===t.target||"FSBL"in window&&r!==window.finApi.documentId?(t="#"+r,t+=a?"/"+a:"",t+=l||"",window.open(t)):"<none>"===a?this.dashboardAppModel.get("router").navigate(r+l,{trigger:!0}):this.dashboardAppModel.get("router").navigate(r+"/"+a+l,{trigger:!0}))},pe.prototype.page=function(t,e){if(!_.isObject(e)||"data"!==this.getSourceType(t))return!1;e=_.pick(e,"_pagingType","_pagingNum","_pageSize","_pageSort"),t.set(e)},pe.prototype.processSettings=function(t,u){var c=this,p=m.DeepModel.keyPathSeparator,d=function(e,i,n,o){var r,s,a,l,t;if(i=i||"",o=o||{},l=_.isUndefined(n)?i:n,e&&e.constructor===Object&&!_.isEmpty(e))_.each(e,function(t,e){d(a=t,s=(i?i+p:"")+e,r=(n?n+p:"")+e,o)});else if(e&&e.constructor===Array&&!_.isEmpty(e))_.keys(e).length<e.length?_.each(_.keys(e),function(t){a=e[t],d(a,s=(i?i+p:"")+t,r=(n?n+p:"")+t,o)}):_.each(e,function(t,e){o[l]||(o[l]=[]),a=t,s=(i?i+p:"")+e,r="",o[l][e]=d(a,s,r,null)});else if("viewstate"===c.getSourceType(e)&&(c.activeViewStateToPropertyPaths[e.path]?-1===c.activeViewStateToPropertyPaths[e.path].indexOf(i)&&c.activeViewStateToPropertyPaths[e.path].push(i):(c.activeViewStateToPropertyPaths[e.path]=[i],c.listenTo(e,"change:value",function(t,e){var i=c.activeViewStateToPropertyPaths[t.path];"dict"===t.get("_type")&&(e=_.transform(e,function(t,e,i){t[i]=c.getPropertyValue(e)}));e=_.zipObject(i,_.times(i.length,_.constant(e)));u&&u(e)})),c.propertyPathsToViewStates[i]=e.path),t=c.getPropertyValue(e),!_.isUndefined(t)){if(!l)return t;o[l]=t}return o},t=d(t);return _.each(c.activeViewStateToPropertyPaths,function(t,e){t=_.filter(t,function(t){return c.propertyPathsToViewStates[t]===e&&"viewstate"===c.getSourceType(c.settingsModel.get(t))});0<t.length?c.activeViewStateToPropertyPaths[e]=t:(t=c.docViewModel.getByPath(e),c.stopListening(t,"change:value"),delete c.activeViewStateToPropertyPaths[e])}),t},pe.prototype.processTemplateViewStates=function(t){return _.mapKeys(t,function(t,e){return"$"+e.replace(/\//g,".")+"$"})},pe.prototype.saveSetting=function(t,e,i){var n;t&&this.quickView&&(n=this.componentId,i&&(n+=pe.NAMESPACE_SEPARATOR+i),(i=this.docViewModel.get(".settings"))||(i=new m.Model,this.docViewModel.set(".settings",i)),(i=i.get(n))||(i=new m.Model,this.docViewModel.get(".settings").set(n,i),i.set("version",0)),i.set(t,e),this.autosaveDashboardId=this.getDashboardId(null),this.saveSettingsNowDebounced())},pe.prototype.saveSettingsNow=function(){var e,i=this.getDashboardId(null);this.autosaveDashboardId===i&&(e=this.docViewModel.get(".settings"),new ft.DocumentViewModel({id:i},null).fetch({success:function(t){t.set(".settings",e),t.save({},{error:function(){ft.Log.Error("Autosave user settings FAILED",i)},success:function(){ft.Log.Info("Autosave user settings SUCCEEDED",i)}})}.bind(this),error:function(t,e){this.dashboardAppModel.get("isLite")&&"Record Not Found"===e?new ft.DocumentViewModel({id:i},null).save({},{success:function(){this.saveSettingsNow()}.bind(this)}):ft.Log.Error("Unable to fetch user settings for Autosave",i)}.bind(this)}))},pe.prototype.setProperty=function(t,e,i){var n;t&&(n=this.settingsModel.get(t),"viewstate"===this.getSourceType(n)?n.setModelValue(e):this.settingsModel.set(t,e,_.extend({},i,{propertyPath:t})))},pe.prototype.setViewState=function(t,e){return!(!t||!t.attributes)&&t.set("value",e)},pe.prototype.showErrorMessage=function(t){this.trigger("showErrorMessage",t)},pe.prototype.showNotification=function(t,e){ft.NotificationManager.show(this.widgetId,t,e)},pe.prototype.showQueryStatus=function(t){this.trigger("showQueryStatus",t)},pe.prototype.updateTable=function(t,e,i,n){"data"===this.getSourceType(t)&&(e.query=t?t.get("_updateQueryString"):"",e.connection=t?t.get("_connection"):"",e.updateType=t?t.get("_updateType"):"",e.updateAnalytic=t?t.get("_updateAnalytic"):"",e.updateParams=t.bindViewStateToKdbParams(t.get("_updateQueryParams")),ft.DeltaClientLib.updateTable(e,function(){i(),t.isDirty=!0,t.forceInternalReset=!0,t.execute()},n))},pe.ADVANCED_METHODS=["deltaClient"],pe.NAMESPACE_SEPARATOR=":",pe.API_METHODS=["destroySettings","doActions","exportData","getProperty","getPropertyMeta","getDataSourceMap","getViewState","getTemplateViewStates","hideErrorMessage","hideQueryStatus","isBuildMode","isSelected","loadApp","loadSetting","navigate","page","removeTooltip","saveSetting","setProperty","setTooltip","setViewState","showErrorMessage","showNotification","showQueryStatus","subscribe","subscribeTemplateViewStates","unsubscribe","unsubscribeTemplateViewStates","updateTable"],ft.ComponentApi=pe,yt=zt=zt||{},vt=m.View,C(de,vt),de.prototype.initializeApi=function(){this.componentApi=new yt.ComponentApi(_.extend({},_.pick(this,de.COMMON_OPTIONS),{advancedMethods:!0,appKey:this.key,componentId:this.componentId,deltaClient:this.deltaClient?this.deltaClient.deltaClient:null,deltaClientLib:this.deltaClient,settingsModel:this.settingsModel}))},de.prototype.initalizeEvents=function(){this.settingsModel&&this.listenTo(this.settingsModel,"change",this.onSettingsModelChange)},de.prototype.initializeOnSettingsChange=function(){var t=!1;this.app&&_.isFunction(this.app.onSettingsChange)&&(this.appOnSettingsChange=_.bind(this.app.onSettingsChange,this.app)),this.appOnSettingsChange&&_.isFunction(this.settingsModel.toFlat)&&(this.appOnSettingsChange(this.componentApi.processSettings(this.settingsModel.toFlat(),this.appOnSettingsChange)),"BasicComponents"===this.key&&!_.isFunction(this.app.$view.onSettingsChange)||(t=!0)),this.model&&(t?this.model.set("hasOnSettingsChange",!0,{silent:!0}):this.model.unset("hasOnSettingsChange"))},de.prototype.onSettingsModelChange=function(r,t){try{var e,s=r.changedAttributes(null,t&&t.propertyPath?t.propertyPath:null);_.each(s,function(t,e){var i,n;function o(t,e){var i,n=/^(\w+)((?:\.\w+)+)$/.exec(e);return n?(i=_.isArray(t)?Number(n[1]):n[1],_.isObject(t)?o(t[i],n[2].substring(1)):t):_.isObject(t)?t[e]:t}i=o(r.attributes,e),n=o(r.previousAttributes(),e),_.isEqual(n,i)&&delete s[e]}),e=this.componentApi.processSettings(s,this.appOnSettingsChange),this.appOnSettingsChange&&!_.isEmpty(e)&&this.appOnSettingsChange(e)}catch(t){yt.Log.Error("AppView Settings Error",t,this)}},de.prototype.onResize=function(t){this.app&&this.app.onResize&&this.app.onResize(t)},de.prototype.onResizeStart=function(t){this.app&&this.app.onResizeStart&&this.app.onResizeStart(t)},de.prototype.onResizeStop=function(t){this.app&&this.app.onResizeStop&&this.app.onResizeStop(t)},de.prototype.remove=function(){return this.app&&_.isFunction(this.app.remove)&&this.app.remove(),this.componentApi&&(this.componentApi.removeTooltip(),this.componentApi.unsubscribeAll()),m.View.prototype.remove.apply(this)},de.prototype.render=function(){return this.$appDiv=this.$el,this},de.prototype.requireApp=function(){var e=this;requirejs([e.key],function(t){try{e.initializeApi(),e.app=new t(_.extend({el:e.$appDiv,viewModel:e.docViewModel,dataModel:e.docDataModel,dashboardAppModel:e.dashboardAppModel,dashboardViewModel:e.dashboardViewModel,settingsModel:e.settingsModel,websiteUrl:e.dashboardAppModel.get("websiteUrl"),DeltaClientLib:e.deltaClient,api:e.componentApi.interface,widgetId:e.widgetId},e.appOptions)),e.initalizeEvents(),e.initializeOnSettingsChange(),_.isFunction(e.callback)&&e.callback(e.app)}catch(t){yt.Log.Error("loading app error, require key: "+e.key,t),_.isFunction(e.callback)&&e.callback(t)}},function(t){yt.Log.Error("ComponentView:loadApp require error",t),_.isFunction(e.callback)&&e.callback(t)})},de.COMMON_OPTIONS=["callback","dashboardAppModel","dashboardViewModel","deltaClient","docDataModel","docViewModel","widgetId","quickView"],yt.AppView=de,bt=zt=zt||{},wt=m.View,C(he,wt),he.prototype.dialogClass=function(){return"dialog-base "+(this.options.userClass||"")},he.prototype.dialogButtons=function(){var t=this;return[{text:"Cancel",click:function(){return t.dialogClose()},icons:{primary:"fa fa-times"}}]},he.prototype.dialogClose=function(){function t(){e.$dialog&&e.$dialog.dialog("close")}var e=this;this.isCancel?(this.options.cancelBtnCallback&&this.options.cancelBtnCallback(),t()):this.options.requireSuccess?this.options.callback&&this.options.callback(this.model,t,function(t,e){bt.ErrorDialog.ShowError(e||"Unspecified Error")}):(this.options.callback&&this.options.callback(this.model),t())},he.prototype.dialogOpen=function(){},he.prototype.onResize=function(){var t=$(window).height();this.$dialogRoot.position({of:$(window)}),t=.95*t-(this.$dialogTitlebar.outerHeight(!0)+this.$dialogButtonpane.outerHeight(!0)),this.$dialog.css("max-height",t)},he.prototype.preRender=function(){},he.prototype.postRender=function(){},he.prototype.remove=function(){return this.$dialog&&this.$dialog.dialog("destroy"),this.options=null,this.$dialog=null,this.$dialogTitlebar=null,this.$dialogButtonpane=null,this.$dialogRoot=null,$(window).off("resize",this.resizeListener),m.View.prototype.remove.apply(this)},he.prototype.openDialog=function(){this.$el.dialog("open")},he.prototype.render=function(){var t=this,e={};return this.options.container&&(e.appendTo=this.options.container),this.preRender(),this.$el.html((this.options.renderTemplate?this.options:this).renderTemplate()),this.$dialog=this.$el.dialog(_.extend({dialogClass:this.dialogClass(),title:this.options.dialogTitle,resizable:!1,minHeight:this.options.minHeight||300,width:this.options.width||"57em",height:this.options.height||"auto",modal:!0,autoOpen:!0,draggable:!1,closeOnEscape:!0,buttons:this.dialogButtons(),position:{my:"center",at:"center",of:$(window)},open:function(){t.$el.parent().find(".titleIcon").remove(),$('<i class="titleIcon fa '+t.options.iconClass+'" />').insertBefore(t.$el.parent().find(".ui-dialog-title")),t.$dialogRoot=$(".ui-dialog.dialog-base"),t.$dialogTitlebar=t.$dialogRoot.find(".ui-dialog-titlebar"),t.$dialogButtonpane=t.$dialogRoot.find(".ui-dialog-buttonpane"),t.dialogOpen(),t.$dialogButtonpane.find(".ui-dialog-buttonpane > div > button:nth-child(1)").focus(),t.options.onOpen&&t.options.onOpen()},close:function(){t.trigger("closing"),t.options.onClose&&t.options.onClose(),t.remove()},resize:$.proxy(this.onResize,this)},e)),this},he.prototype.renderTemplate=function(){return""},bt.DialogBase=he,St=zt=zt||{},_t=St.DialogBase,C(ge,_t),ge.prototype.dialogButtons=function(){return[{text:"Save",click:_.bind(this.onClickSave,this),icons:{primary:"fa fa-floppy-o"}},{text:"Don't Save",click:_.bind(this.onClickDontSave,this),icons:{primary:"fa fa-ban"}},{text:"Cancel",click:_.bind(this.onClickCancel,this),icons:{primary:"fa fa-times"}}]},ge.prototype.doSave=function(){var t=$.Deferred();return this.model.saveNow(t.reject,t.resolve),t.promise()},ge.prototype.onKeyDown=function(t){switch(t.stopPropagation(),t.keyCode){case $.ui.keyCode.ESCAPE:this.onClickCancel();break;case 78:this.onClickDontSave();break;case 83:case 89:this.onClickSave()}},ge.prototype.onClickCancel=function(){this.isCancel=!0,this.closeArgs="cancel",this.dialogClose()},ge.prototype.onClickDontSave=function(){this.options&&this.options.noSaveCb&&this.options.noSaveCb(),this.dialogClose()},ge.prototype.onClickSave=function(){this.options&&this.options.saveCb?(this.options.saveCb(),this.dialogClose()):(this.$firstBtn.button("disable"),this.$firstBtn.next().button("disable"),this.$firstBtn.next().next().button("disable"),this.doSave().done(_.bind(this.onSaveDone,this)).fail(_.bind(this.onSaveFail,this)))},ge.prototype.onSaveDone=function(){var i,n=this,o=[];_.isEmpty(this.options.components)?this.dialogClose():(i=_.after(this.options.components.length,function(){_.isEmpty(o)?n.dialogClose():(n.$errorInfo.show(),n.$errorList.empty(),_.each(o,function(t){var e=$("<li />"),i=$("<span />");i.attr("title",t.widget),i.text(t.component),e.text(": "+t.message),e.prepend(i),n.$errorList.append(e)}),n.$firstBtn.button("enable"),n.$firstBtn.next().button("enable"),n.$firstBtn.next().next().button("enable"))}),_.each(this.options.components,function(e){_.isFunction(e.callback)&&e.callback(function(t){t&&o.push(_.extend({message:t},_.pick(e,["component","widget"]))),i()})}))},ge.prototype.onSaveFail=function(){this.$errorInfo.show(),this.$firstBtn.button("enable"),this.$firstBtn.next().button("enable"),this.$firstBtn.next().next().button("enable")},ge.prototype.getPromptMessage=function(){return this.options.message||"There are unsaved changes in this dashboard."},ge.prototype.postRender=function(){$(window).on("keydown.AreYouSureDialog",_.bind(this.onKeyDown,this)),this.$errorInfo=this.$(".error-info"),this.$errorList=this.$(".error-list"),this.$firstBtn=this.$dialog.next().find("button").first(),this.$errorInfo.hide()},ge.prototype.renderTemplate=function(){return St.T.AreYouSureDialog({dashChanged:this.options.dashChanged,components:this.options.components,message:this.getPromptMessage()})},ge.prototype.remove=function(){return $(window).off(".AreYouSureDialog"),this.trigger("close",this.closeArgs),St.DialogBase.prototype.remove.apply(this)},St.AreYouSureDialog=ge,Ct=zt=zt||{},Tt=m.View,C(fe,Tt),fe.prototype.close=function(){this.$dialog.dialog("close")},fe.prototype.onSubmit=function(e){var i,n,o,r,s=this;e&&e.stopPropagation(),this.clicked||(e=this.form.commit(),_.isEmpty(e)&&(this.clicked=!0,this.$messageBox.hide(),r=function(){o.removeClass("fa-spinner fa-pulse"),o.css({width:"",height:""}),o.addClass("fa-check"),i.find(".ui-button-text").text(t("OK")),n.button("enable"),s.clicked=!1,Ct.DeltaClientLib.changingPassword=!1},i=this.$okBtn,(o=i.find(".ui-button-icon-primary.fa-check")).removeClass("fa-check"),o.css({width:"auto",height:"auto"}),o.addClass("fa-spinner fa-pulse"),i.find(".ui-button-text").text(t("wait...")),(n=i.next()).button("disable"),Ct.DeltaClientLib.changeUserPassword(s.model.get("oldpassword"),s.model.get("password1"),function(){Ct.Log.Info("Password changed successfully"),s.showMessage("Password changed successfully","success"),_.isFunction(s.onChangeSuccess)&&s.onChangeSuccess(),_.delay(function(){s.close()},1e3)},function(t){Ct.Log.Error("Password change failed"),s.showMessage(t),r()})))},fe.prototype.onRemove=function(){$(this.form.el).find("input").off(),window.removeEventListener("keydown",this.boundToggleCaps,!0),this.remove()},fe.prototype.showMessage=function(t,e){t?(this.$messageBox.html(t),this.$messageBox.removeClass(this.MESSAGE_TYPES.join(" ")).addClass(e||"error"),this.$messageBox.show()):(this.$messageBox.html(),this.$messageBox.removeClass(this.MESSAGE_TYPES.join(" ")),this.$messageBox.hide())},fe.prototype.toggleCapsLockMsg=function(e){20===e.which&&(e.getModifierState("CapsLock")?this.showMessage('<i class="fa fa-warning"/>'+t("Caps Lock is on"),"warning"):this.showMessage())},Ct.ChangePasswordDialog=fe,K=zt=zt||{},Dt=K.DialogBase,C(me,Dt),me.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.dialogClose()},icons:{primary:"fa fa-check"}},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icons:{primary:"fa fa-times"}}]},me.prototype.renderTemplate=function(){return t("Are you sure you want to delete this item?")},me.ShowDelete=function(t,e){new me(_.extend({iconClass:"fa-trash-o",dialogTitle:"Confirm Delete",callback:t},e?{renderTemplate:function(){return e}}:{}))},me.ShowConfirm=function(e){var i=e.txt||"",n=e.container?{container:e.container}:{};new me(_.extend({iconClass:e.iconClass||"fa-question-circle",dialogTitle:e.dialogTitle||"Confirmation",callback:e.callback,cancelBtnCallback:e.cancelBtnCallback||_.noop,renderTemplate:e.renderTemplate||function(){return i+t("<br/>Are you sure you want to reload the Application?")}},n))},K.ConfirmDialog=me,Mt=zt=zt||{},Et=Mt.AppView,C(ye,Et),ye.getInstances=function(){return ye._instances},ye.prototype.initalizeEvents=function(){var i=this,t=this.getContainerDocument();Mt.AppView.prototype.initalizeEvents.apply(this,arguments),this.listenTo(this.model,"beforeRemove",this.beforeRemove),this.listenTo(this.dashboardViewModel,"change:buildMode",this.onBuildModeChanged),this.listenTo(this.componentApi,"hideErrorMessage",this.hideErrorMessage),this.listenTo(this.componentApi,"hideQueryStatus",this.hideQueryStatus),this.listenTo(this.componentApi,"showErrorMessage",this.showErrorMessage),this.listenTo(this.componentApi,"showQueryStatus",this.showQueryStatus),this.listenTo(t,"change:borderBackground",function(t,e){return i.setOptionsValue("format",{tileBackgroundColor:"#"+e})}),this.listenTo(t,"change:transparentBackground",function(t,e){return i.setOptionsValue("format",{tileTransparentBackground:e})}),this.listenTo(t,"change:borderColor",function(t,e){return i.setOptionsValue("format",{tileBorderColor:"#"+e})}),this.listenTo(t,"change:borderRounding",function(t,e){return i.setOptionsValue("format",{tileBorderRounding:e})}),this.listenTo(t,"change:borderSpacing",function(t,e){return i.setOptionsValue("Alignment",{innerPaddingLeft:e,innerPaddingRight:e,innerPaddingTop:e,innerPaddingBottom:e,titlePaddingLeft:e,titlePaddingRight:e,titlePaddingTop:e})}),this.listenTo(t,"change:borderWidth",function(t,e){return i.setOptionsValue("format",{tileBorderWidth:e})}),this.listenTo(t,"change:widgetsSpacing",function(t,e){return i.setOptionsValue("Alignment",{paddingLeft:e,paddingRight:e,paddingTop:e,paddingBottom:e})}),this.listenTo(t,"change:borderShadow",function(t,e){return i.setOptionsValue("format",{tileShadow:e})}),this.listenTo(t,"change:showLoadingIndicators",this.onShowLoadingIndicatorsChanged),this.listenTo(this.model.get("options"),"change:format",this.onFormatChanged),this.debouncedOnAlignmentChanged=_.debounce(this.onAlignmentChanged,240),this.listenTo(this.model.get("options"),"change:Alignment",this.debouncedOnAlignmentChanged)},ye.prototype.applyCustomCss=function(t){t?(this.$customCss&&this.$customCss.length?this.$customCss.html(t):this.$customCss=$("<style />",{"data-widgetid":this.widgetId,html:t,type:"text/css"}).appendTo(document.head),this.customCss=t):this.$customCss&&(this.$customCss.remove(),this.$customCss=null,this.customCss=null)},ye.prototype.applyCssClasses=function(t){this.$appDiv.removeClass(this.cssClasses),t?(_.isString(t)?this.cssClasses=t:this.cssClasses=_.reduce(t,function(t,e){return t+" "+e}),this.$appDiv.addClass(this.cssClasses)):this.cssClasses=null},ye.prototype.applyDashboardStyleSettings=function(){var t=this.dashboardViewModel.get("selectedDocumentId"),e=this.dashboardAppModel.get("documents").get(t),i=this.model.get("options").get("format"),t=this.model.get("options").get("Alignment");null===i.tileBackgroundColor&&(i.tileBackgroundColor="#"+e.get("borderBackground")),null===i.tileBorderColor&&(i.tileBorderColor="#"+e.get("borderColor")),null===i.tileBorderRounding&&(i.tileBorderRounding=e.get("borderRounding")),null===i.tileBorderWidth&&(i.tileBorderWidth=e.get("borderWidth")),null===i.tileTransparentBackground&&(i.tileTransparentBackground=e.get("transparentBackground")),null===i.tileShadow&&(i.tileShadow=e.get("borderShadow")),this.model.get("options").set("format",i),null===t.innerPaddingLeft&&(t.innerPaddingLeft=e.get("borderSpacing")),null===t.innerPaddingRight&&(t.innerPaddingRight=e.get("borderSpacing")),null===t.innerPaddingTop&&(t.innerPaddingTop=e.get("borderSpacing")),null===t.innerPaddingBottom&&(t.innerPaddingBottom=e.get("borderSpacing")),null===t.titlePaddingLeft&&(t.titlePaddingLeft=e.get("borderSpacing")),null===t.titlePaddingRight&&(t.titlePaddingRight=e.get("borderSpacing")),null===t.titlePaddingTop&&(t.titlePaddingTop=e.get("borderSpacing")),null===t.titlePaddingBottom&&(t.titlePaddingBottom=0),null===t.paddingLeft&&(t.paddingLeft=e.get("widgetsSpacing")),null===t.paddingRight&&(t.paddingRight=e.get("widgetsSpacing")),null===t.paddingTop&&(t.paddingTop=e.get("widgetsSpacing")),null===t.paddingBottom&&(t.paddingBottom=e.get("widgetsSpacing")),this.model.get("options").set("Alignment",t)},ye.prototype.beforeRemove=function(){var n,t,e,o=this;if(this.app&&_.isFunction(this.app.beforeRemove)&&((e=this.app.beforeRemove())&&(_.isFunction(e)?n=e:_.isFunction(e.callback)&&(n=e.callback,t=e.message)),n))return{callback:function(t){var e=_.once(t),i=_.delay(function(){e("Timed out")},o.COMPONENT_SAVE_TIMEOUT);try{n(function(t){clearTimeout(i),e(t)})}catch(t){Mt.Log.Error("Save error",t),clearTimeout(i),e("Save error")}},component:o.model.get("key"),message:t,widget:o.model.id}},ye.prototype.getComponentName=function(){var t=this.dashboardAppModel.get("components").get(this.model.get("definitionId"))||this.dashboardAppModel.get("components").find({appKey:this.model.get("key")});return t?t.get("componentName"):""},ye.prototype.getContainerDocument=function(){var t=this.dashboardViewModel.get("selectedDocumentId");return this.dashboardAppModel.get("documents").get(t)},ye.prototype.hideErrorMessage=function(){this.$errorMessage.hide()},ye.prototype.hideQueryStatus=function(){var t=this;clearTimeout(this.queryStatusTimer),clearInterval(this.loadingTimer),this.queryStatusRemoveTimer=_.delay(function(){t.$queryStatus.hide()},200)},ye.prototype.onAlignmentChanged=function(t){var e=this,i=this.model.get("options").get("Alignment"),n=function(t){return Number(e.componentApi.getPropertyValue(i[t],"Alignment."+t))},o={"margin-left":n("paddingLeft"),"margin-right":n("paddingRight"),"margin-top":n("paddingTop"),"margin-bottom":n("paddingBottom")};this.$borderDiv.css(o),o={"margin-left":n("titlePaddingLeft"),"margin-right":n("titlePaddingRight"),"padding-top":n("titlePaddingTop"),"padding-bottom":n("titlePaddingBottom")},this.$titleDiv.css(o),o=e.$titleDiv.is(":visible")?e.$titleDiv.outerHeight(!0)+n("innerPaddingTop"):n("innerPaddingTop"),n={left:n("innerPaddingLeft"),right:n("innerPaddingRight"),top:o,bottom:n("innerPaddingBottom")},e.$appDiv.css(n),t||e.onResize()},ye.prototype.onBuildModeChanged=function(t,e,i){this.dashboardViewModel.get("buildMode")?this.$el.removeClass("build-off"):this.$el.addClass("build-off")},ye.prototype.onFormatChanged=function(t){var e=this.model.get("options").get("format"),i=this,n=function(t){return i.componentApi.getPropertyValue(e[t],"Format."+t)},o={"border-width":n("tileBorderWidth"),"border-radius":n("tileBorderRounding"),"border-color":n("tileBorderColor"),"background-color":n("tileTransparentBackground")?"transparent":n("tileBackgroundColor"),"box-shadow":n("tileShadow")?"rgba(0, 0, 0, 0.78) 2px 2px 5px":"none"};this.$borderDiv.css(o);var r={"font-size":n("titleFontSize"),"font-weight":n("titleFontBold")?"bold":"normal","text-align":n("titleHorizontal"),color:n("titleColor"),"background-color":n("titleTransparentBackground")?"transparent":n("titleBackgroundColor"),"border-bottom-width":n("titleBottomBorderWidth"),"text-shadow":n("titleShadow")?"rgba(0, 0, 0, 0.5) 2px 2px 3px":"none"},o=0;0<n("tileBorderRounding")&&(o=.85*n("tileBorderRounding")-n("tileBorderWidth")/4),this.$titleDiv.css("border-top-left-radius",o),this.$titleDiv.css("border-top-right-radius",o),o=i.model.get("options").get("Alignment"),(n=n("widgetTitle"))?(this.$titleDiv.css(r),this.$titleDiv.text(n),this.$titleDiv.show(),i.$appDiv.css("top",o.innerPaddingTop+i.$titleDiv.outerHeight(!0))):(this.$titleDiv.hide(),i.$appDiv.css("top",o.innerPaddingTop)),t||this.onResize()},ye.prototype.onShowLoadingIndicatorsChanged=function(t,e){this.showLoadingIndicators=e},ye.prototype.onShowNoResultsIndicatorsChanged=function(t,e){this.showNoResultsIndicators=e},ye.prototype.onStyleChanged=function(){var e=this,i=this.model.get("options").get("Style"),t=function(t){return e.componentApi.getPropertyValue(i[t],"Style."+t)},n=t("advanced");n!==this.customCss&&this.applyCustomCss(n);t=t("cssClasses");t!==this.cssClasses&&this.applyCssClasses(t)},ye.prototype.postComponentLoad=function(i,n){var t,o=this;this.appOnSettingsChange=function(t){var e=Object.keys(t);o.quickStart(i.appArgs.quickStart),_.find(e,function(t){return 0===t.indexOf("Style")})&&o.onStyleChanged(),_.find(e,function(t){return 0===t.indexOf("format")})&&o.onFormatChanged(),_.find(e,function(t){return 0===t.indexOf("Alignment")})&&o.onAlignmentChanged(),n?n.settings=t:o.app&&_.isFunction(o.app.onSettingsChange)&&o.app.onSettingsChange(t)},this.appOnSettingsChange&&this.model.get("options").toFlat&&(t=this.componentApi.processSettings(this.model.get("options").toFlat(),this.appOnSettingsChange),n?(n.settings=t,this.quickStart(i.appArgs.quickStart)):(this.app&&_.isFunction(this.app.onSettingsChange)&&(this.app.onSettingsChange(t),this.quickStart(i.appArgs.quickStart)),_.isFunction(this.app.onSettingsChange)&&("BasicComponents"!==this.model.get("key")||_.isFunction(this.app.$view.onSettingsChange))?this.model.set("hasOnSettingsChange",!0,{silent:!0}):this.model.unset("hasOnSettingsChange",{silent:!0}))),this.model.trigger("componentLoaded")},ye.prototype.processComponentDefinition=function(t,e){var i=this;t&&t.set(_.omit(e,"id","componentName","componentDescription","appKey","buildModeOnly","listViewThumb")),e.buildModeOnly&&this.$el.addClass("build-mode-only"),this.dashboardViewModel.get("buildMode")||this.$el.addClass("build-off"),this.updateComponentDefinition(e,this.model),$.isEmptyObject(this.model.get("options").attributes)&&e?this.model.get("options").set(e.appArgs.json):(this.model.get("options").set("Alignment",_.extend({},e.appArgs.json.Alignment,this.model.get("options").get("Alignment")),{silent:!0}),this.model.get("options").set("Style",_.extend({},e.appArgs.json.Style,this.model.get("options").get("Style")),{silent:!0}),delete(t=_.extend({},e.appArgs.json.format,this.model.get("options").get("format"))).titlePaddingLeft,delete t.titlePaddingRight,delete t.titlePaddingTop,delete t.titlePaddingBottom,this.model.get("options").set({format:null},{silent:!0}),this.model.get("options").set({format:t},{silent:!0})),this.componentApi.convertPathsToModels("data",e.appArgs.schema,this.model.get("options")),this.componentApi.convertPathsToModels("viewstate",e.appArgs.schema,this.model.get("options")),Mt.Component.convertDashboardTypesToModels(this.model.get("options"),function(t){return i.docDataModel.getByPath(t)},function(t){return i.docViewModel.getByPath(t)}),this.applyDashboardStyleSettings(),this.model.unset("upgrading",{silent:!0}),this.onStyleChanged(),this.onFormatChanged(),this.onAlignmentChanged()},ye.prototype.quickStart=function(e){var n=this;_.each(e,function(e){if(!n.settingsModel.get(e.path)&&!n.quickView){var i=e.message||"populate widget";return n.showErrorMessage({error:t("Click to ")+" <b> "+i+"</b>",type:"QuickStart",onClick:function(){n.dashboardViewModel.get("selectedWidgetId")!==n.widgetId&&n.$el.trigger("click"),n.model.get("options").trigger("quickStart",e.path)}}),!1}n.hideErrorMessage()})},ye.prototype.remove=function(){this.$customCss&&this.$customCss.remove(),ye._instances=_.without(ye._instances,this),Mt.AppView.prototype.remove.apply(this,arguments)},ye.prototype.render=function(){var t=this.getContainerDocument().get("showLoadingIndicators");return this.$el.html(Mt.T.ComponentView(this.model.toJSON())),this.$errorMessage=this.$el.find(".errorMessage"),this.$queryStatus=this.$el.find(".queryStatus"),this.$titleDiv=this.$el.find(".title-div"),this.$borderDiv=this.$el.find(".border-div"),this.$appDiv=this.$el.find(".app-div"),this.widgetId&&(this.$customCss=$("head style[data-widgetid='"+this.widgetId+"']")),this.$progressBarDiv=this.$el.find(".progress-bar-div"),this.onShowLoadingIndicatorsChanged(null,t),this.model.set("upgrading",!0,{silent:!0}),this},ye.prototype.requireApp=function(){var e,i=this,n=this,t=n.model.get("key"),o=n.dashboardAppModel.get("components").get(n.model.get("definitionId")),r=(o=o||n.dashboardAppModel.get("components").find({appKey:n.model.get("key")})).get("customElement");r&&customElements.get(r)?(e=document.createElement(r),n.$appDiv.append(e),e.addEventListener("componentDefinition",function(t){t=t.detail;e.componentApi=i.componentApi.interface,i.processComponentDefinition(o,t),i.initalizeEvents(),e.theme=i.dashboardViewModel.get("DashboardTheme"),i.listenTo(n.dashboardViewModel,"change:DashboardTheme",function(){e.theme=i.dashboardViewModel.get("DashboardTheme")}),i.listenTo(n.dashboardViewModel,"change:buildMode",function(){return e.resize=""}),i.postComponentLoad(t,e)}),_.delay(function(){e.options={api:n.componentApi.interface,componentId:parseInt(n.model.get("definitionId"),10),componentModel:n.model,dashboardAppModel:n.dashboardAppModel,dashboardViewModel:n.dashboardViewModel,dataModel:n.docDataModel,settingsModel:n.model.get("options"),viewModel:n.docViewModel,websiteUrl:n.dashboardAppModel.get("websiteUrl")},i.$progressBarDiv.fadeOut(0,function(){$(this).remove()})},1e3)):requirejs([t],function(t){try{n.$progressBarDiv.fadeOut(0,function(){$(this).remove()}),t.mergeWithDefault&&n.model.set("options",t.mergeWithDefault(n.model.get("options")),{silent:!0}),t.getDefaultJSONTemplates&&(n.model.get("options")._templates=t.getDefaultJSONTemplates(),n.model.get("options")._templates.Defaults=_.extend({},n.model.get("options")._templates.Defaults));var e=_.isFunction(t.getComponentDefinition)?t.getComponentDefinition({api:n.componentApi.interface,componentId:parseInt(n.model.get("definitionId"),10),componentModel:n.model,dashboardAppModel:n.dashboardAppModel,dashboardViewModel:n.dashboardViewModel,dataModel:n.docDataModel,settingsModel:n.model.get("options"),viewModel:n.docViewModel,websiteUrl:n.dashboardAppModel.get("websiteUrl")}):_.cloneDeep({appArgs:{json:{},schema:{properties:{},type:"object"}}});n.processComponentDefinition(o,e),n.app=new t({el:n.$appDiv[0],viewModel:n.docViewModel,dataModel:n.docDataModel,dashboardAppModel:n.dashboardAppModel,dashboardViewModel:n.dashboardViewModel,settingsModel:n.model.get("options"),websiteUrl:n.dashboardAppModel.get("websiteUrl"),componentModel:n.model,DeltaClientLib:n.deltaClient,api:n.componentApi.interface,widgetId:n.widgetId,quickView:n.quickView}),n.initalizeEvents(),n.postComponentLoad(e),_.isFunction(n.callback)&&n.callback(n.app)}catch(t){Mt.Log.Error("loading app error, require key: "+n.model.get("key"),t),_.isFunction(n.callback)&&n.callback(t)}},function(t){Mt.Log.Error("ComponentView:loadApp require error",t),_.isFunction(n.callback)&&n.callback(t)})},ye.prototype.showErrorMessage=function(i){var e=this,n=i.type||"Error",o=i.error,r=this.$errorMessage.find(".errorText");0===o.indexOf("0.0")&&(o=o.substring(4)),this.$errorMessage.removeClass("Error Warning Info QuickStart").addClass(n),this.$errorMessage.find(".errorTitle span").text(t(n)),r.html(o),this.$errorMessage.show(),this.fadeTimer&&clearTimeout(this.fadeTimer),this.$errorMessage.off("click"),i.onClick&&this.$errorMessage.click(function(t){var e=$(t.target);(e.hasClass("errorPanel")||e.parents(".errorPanel").length)&&(t.stopPropagation(),i.onClick(t))}),"Info"===n&&(this.fadeTimer=_.delay(function(){return e.$errorMessage.fadeOut("slow")},3e3))},ye.prototype.showQueryStatus=function(e){var i,n=this,o=e.message||e.error||"",r=e.type||"Error";if(n.customErrorClass&&(n.$queryStatus.removeClass(n.customErrorClass),n.customErrorClass=""),clearInterval(n.loadingTimer),"Loading"===r){var s,a=y();if(!n.showLoadingIndicators)return;o="0s",n.loadingTimer=setInterval(function(){s=y.duration(y().diff(a)),o=s.format("m[m] s[s]"),n.$queryStatus.find(".statusText").html(o)},1e3)}e="NoResults"===r?"No Results":r,0===o.indexOf("0.0")&&(o=o.substring(4)),n.$queryStatus.css("margin",n.$borderDiv.css("border-width")),n.$queryStatus.css("border-radius",n.$borderDiv.css("border-radius")),n.$queryStatus.removeClass("Error Warning Info Loading NoResults").addClass(r),n.$queryStatus.find(".statusTitle span").text(t(e)+(o&&"Loading"!==r?": ":"")),"Error"===r&&(i=/(.*)cssClass:"(.*)":(.*)/m.exec(o))&&(n.customErrorClass=i[2],n.$queryStatus.addClass(n.customErrorClass),o=i[3]),n.$queryStatus.find(".statusText").html(o),clearTimeout(n.queryStatusTimer),clearTimeout(n.queryStatusRemoveTimer),n.queryStatusTimer=_.delay(function(){n.$queryStatus.show()},n.QUERY_STATUS_DELAY),n.fadeTimer&&clearTimeout(n.fadeTimer),"Info"===r&&(n.fadeTimer=_.delay(function(){n.$queryStatus.fadeOut("slow")},n.QUERY_STATUS_FADE))},ye.prototype.updateComponentDefinition=function(t,e){var i=z(),n=t.appArgs.schema.properties.Alignment,o=t.appArgs.schema.properties.format,r=t.appArgs.schema.properties.Style,s=t.appArgs.json.Style;r?_.each(i.appArgs.schema.properties.Style.properties,function(t,e){r.properties[e]=t}):t.appArgs.schema.properties.Style=i.appArgs.schema.properties.Style,t.appArgs.json.Style=s?_.extend({},i.appArgs.json.Style,s):_.clone(i.appArgs.json.Style),n?_.each(i.appArgs.schema.properties.Alignment.properties,function(t,e){n.properties[e]=t}):t.appArgs.schema.properties.Alignment=i.appArgs.schema.properties.Alignment,s=t.appArgs.json.Alignment,t.appArgs.json.Alignment=s?_.extend({},i.appArgs.json.Alignment,s):_.clone(i.appArgs.json.Alignment),o?(_.each(i.appArgs.schema.properties.format.properties,function(t,e){o.properties[e]=t}),delete o.properties.titlePaddingLeft,delete o.properties.titlePaddingRight,delete o.properties.titlePaddingTop,delete o.properties.titlePaddingBottom):t.appArgs.schema.properties.format=i.appArgs.schema.properties.format,(s=t.appArgs.json.format)?(t.appArgs.json.format=_.extend({},i.appArgs.json.format,s),delete t.appArgs.json.format.titlePaddingLeft,delete t.appArgs.json.format.titlePaddingRight,delete t.appArgs.json.format.titlePaddingTop,delete t.appArgs.json.format.titlePaddingBottom):t.appArgs.json.format=_.clone(i.appArgs.json.format)},ye.prototype.setOptionsValue=function(t,e){var i=this.model.get("options").get(t);this.model.get("options").set(t,_.extend({},i,e))},ye._instances=[],K=ye,Mt.ComponentView=K,Pt=zt=zt||{},It=m.View,C(ve,It),ve.prototype.initialize=function(t){this.$el.addClass("component-drop"),this.dashboardAppModel=t.dashboardAppModel,this.dashboardViewModel=t.dashboardViewModel,this.DeltaClientLib=t.DeltaClientLib,this.quickView=t.quickView,this.websiteUrl=t.websiteUrl,this.widgetsCollection=this.widgetsCollection||t.widgets,this.widgets=this.widgets||[],this.ignoreWidgetSelect=!1,this.widgetClass="component-drop-widget",this.initializeEvents(),this.initializeEvents_widgetCollection(),this.quickView?this.switchOffBuildMode():this.switchBuildMode(this.dashboardViewModel.get("buildMode")),this.applyCurrentWidgets()},ve.prototype.initializeEvents=function(){this.listenTo(this.dashboardViewModel,"change:buildMode",this.onBuildModeChanged),this.listenTo(this.dashboardViewModel,"change:selectedWidget",this.onSelectedWidgetChanged),this.listenTo(this.dashboardAppModel,"change:pendingSelectionWidgetId",this.onSelectingWidget)},ve.prototype.initializeEvents_widgetCollection=function(){this.listenTo(this.widgetsCollection,"add",this.onWidgetCollectionAdd),this.listenTo(this.widgetsCollection,"remove",this.onWidgetCollectionRemove)},ve.prototype.events=function(){return{dragenter:"onDragEnter",dragleave:"onDragLeave",dragover:"onDragOver",drop:"onDrop"}},ve.prototype.addComponentToWidget=function(t,e,i){var n=this.dashboardAppModel.get("components").get(e),o=this.getAppKey(n),r=t.get("component"),n=this.findWidgetItem(t.id),e=this.createNewComponent(e,o,t);r?"Tabs"===(o=r.get("key"))?((o=r.getInnermostComponents(o)).add(e),e.setParent(o)):(n&&n.view&&(n.view.remove(),n.view=null),i?t.commandSet({component:e}):t.set("component",e)):i?t.commandSet({component:e}):t.set("component",e)},ve.prototype.addWidget=function(e,t,i){var n,o=this,r=this,s=e.id,a=this.renderWidget(e),l=$(document.createElement("div"));return l.addClass("fa fa-times remove-btn"),l.appendTo(a),l.click(function(t){t.preventDefault(),t.stopPropagation(),e.trigger("removeWidget")}),a.addClass(this.getWidgetClass(i)),a.attr("data-widgetid",s),this.dashboardViewModel.get("buildMode")||a.addClass("build-off"),this.addWidgetEvents(a),n={$remove:l,$widget:a,widgetId:s,model:e,view:null},this.widgets.push(n),e.get("component")&&this.renderComponent(n,t?function(){}:function(){return o.selectWidget(n)}),r.stopListening(e,"change:component"),r.listenTo(e,"change:component",_.bind(function(){n.view&&(n.view.remove(),n.view=null),n.$widget.find(".grid-stack-item-content").remove(),r.renderComponent(n,function(){return r.selectWidget(n)})},r,n)),r.stopListening(e,"removeWidget"),r.listenTo(e,"removeWidget",r.onRemoveWidget.bind(r,e)),n},ve.prototype.addNewWidget=function(t,e,i){return t=t||new Pt.Widget({},{},this.widgetsCollection),e&&!i&&this.addComponentToWidget(t,e,!1),this.widgetsCollection.commandAdd(t,i?"Paste":null),_.findLast(this.widgets,{widgetId:t.id})},ve.prototype.addWidgetEvents=function(t){var e,i=this;if(!(t instanceof $))throw"Wrong parameter.";_.each(t,function(t){(e=$(t)).off("click"),e.on("click",$.proxy(i.onWidgetClick,i))})},ve.prototype.applyCurrentWidgets=function(){var e=this;_.each(this.widgetsCollection.models,function(t){e.addWidget(t,!0,null)})},ve.prototype.clearWidgets=function(t){this.deselectCurrentWidget(),0<this.widgets.length&&(_.each(this.widgets,function(t){t.view&&_.isFunction(t.view.remove)&&t.view.remove()}),this.widgets=[]),t&&t()},ve.prototype.createComponentView=function(t,e){var i=t.model.get("component"),n=this.getSelectedDocument();return this.listenToOnce(i,"componentLoaded",function(){t.model.trigger("componentLoaded")}),n=new Pt.ComponentView({model:i,callback:e,dashboardAppModel:this.dashboardAppModel,dashboardViewModel:this.dashboardViewModel,deltaClient:this.dashboardAppModel.get("isLite")?Pt.DashClient:Pt.DeltaClientLib,docViewModel:n.get("viewState"),docDataModel:n.get("data"),quickView:this.quickView,websiteUrl:this.websiteUrl,widgetId:t.widgetId}),(t.view=n).model&&(t.$widget.attr("data-componentid",n.model.get("key")),t.$remove.attr("title",n.getComponentName())),n},ve.prototype.createNewComponent=function(t,e,i){i=new Pt.Component({},{},i);return i.set({definitionId:t,key:e}),i},ve.prototype.deselectCurrentWidget=function(){this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})},ve.prototype.disableWidgetSelect=function(t){t&&t.stopPropagation&&t.stopPropagation(),this.ignoreWidgetSelect=!0},ve.prototype.enableWidgetSelect=function(){this.ignoreWidgetSelect=!1},ve.prototype.findWidgetItem=function(e){return e?_.find(this.widgets,function(t){return t.widgetId===e}):null},ve.prototype.getAppKey=function(t){var e=t.get("appKey");return e=t.get("user")&&!e.match(/^(?:[a-z]+:)?\/\/|^\//)?e.replace(/\.js$/,""):e},ve.prototype.getSafeDragNDropHandler=function(e){return function(t){return!(!this.isDragValid()&&!this.isDraggingSupportedFile(t))&&e.apply(this,arguments)}.bind(this)},ve.prototype.getSelectedDocument=function(){return this.dashboardAppModel.get("documents").get(this.dashboardViewModel.get("selectedDocumentId"))},ve.prototype.getWidgetClass=function(t){return this.widgetClass},ve.prototype.isDragValid=function(){return this.dashboardAppModel.has("draggedComponentId")&&!this.quickView},ve.prototype.isDraggingSupportedFile=function(t){return!!t.originalEvent.dataTransfer&&_.includes(t.originalEvent.dataTransfer.types,"Files")&&!this.quickView&&(void 0===t.originalEvent.dataTransfer.items||_.some(t.originalEvent.dataTransfer.items,function(t){return _.includes(["application/json","text/xml"],t.type)}))},ve.prototype.onBuildModeChanged=function(t,e,i){this.switchBuildMode(this.dashboardViewModel.get("buildMode"),i.userInitiated)},ve.prototype.onDragEnter=function(t){return this.isDragValid()&&this.userCan("addNew")&&this.$el.addClass("drop-target"),!1},ve.prototype.onDragLeave=function(t){this.isDragValid()&&this.$el.removeClass("drop-target")},ve.prototype.onDragOver=function(t){return this.isDragValid()&&!this.$el.hasClass("drop-target")&&this.$el.addClass("drop-target"),!1},ve.prototype.onDrop=function(t){var e,i,n;if(this.isDragValid()){if(this.$el.removeClass("drop-target"),!(i=t.originalEvent.dataTransfer?t.originalEvent.dataTransfer.getData("text"):i))return!1;if(e=this.dashboardAppModel.get("components").get(i),t=$(t.currentTarget).find(".component-drop-widget").first().attr("data-widgetid"),!e)return!1;t&&(n=this.findWidgetItem(t),this.deselectCurrentWidget()),n?this.addComponentToWidget(n.model,i,!0):this.addNewWidget(new Pt.Widget({},{},this.widgetsCollection),i,!1)}return!1},ve.prototype.onRemoveWidget=function(t){this.widgetsCollection.commandRemove(t)},ve.prototype.onResizeStart=function(){_.each(this.widgets,function(t){t.view.onResizeStart&&t.view.onResizeStart(!0)})},ve.prototype.onResize=function(t){_.each(this.widgets,function(t){t.view.onResize&&t.view.onResize(!0)})},ve.prototype.onResizeStop=function(){_.each(this.widgets,function(t){t.view.onResizeStop&&t.view.onResizeStop(!0)}),this.userCan()?this.$el.find(".component-build-view").removeClass("build-off"):this.$el.find(".component-build-view").addClass("build-off")},ve.prototype.onSelectedWidgetChanged=function(t,e){this.selected&&this.selected.$widget.removeClass("selected"),e?(e=this.findWidgetItem(e.id))&&(this.selected=e,this.selected.$widget.addClass("selected")):this.selected=null},ve.prototype.onSelectingWidget=function(t,e){t&&(this.onWidgetClick(null,e),this.dashboardAppModel.set("pendingSelectionWidgetId",null,{silent:!0}))},ve.prototype.onWidgetClick=function(t,e){var i;t&&(e=$(t.currentTarget).attr("data-widgetid")),!(i=this.findWidgetItem(e))||!e&&$(t.target).is(i.$remove)||this.ignoreWidgetSelect||(t&&t.stopPropagation&&t.stopPropagation(),t&&$(t.target).parent().hasClass("QuickStart")||(this.dashboardViewModel.get("selectedWidget")===i.model?(this.dashboardViewModel.set("selectedWidget",null),this.dashboardViewModel.set("selectedWidgetView",null,{silent:!0})):(this.dashboardViewModel.set("selectedWidget",i.model),this.dashboardViewModel.set("selectedWidgetView",i.view,{silent:!0}))))},ve.prototype.onWidgetCollectionAdd=function(t,e,i){this.addWidget(t,!1,null)},ve.prototype.onWidgetCollectionRemove=function(t,e,i){this.removeWidget(t)},ve.prototype.remove=function(){return this.clearWidgets(),m.View.prototype.remove.apply(this)},ve.prototype.removeWidget=function(t){t=_.find(this.widgets,{model:t});t&&(this.selected&&this.selected===t&&this.deselectCurrentWidget(),this.widgets=_.without(this.widgets,t),t.$widget.css({border:"none",background:"none","box-shadow":"none","pointer-events":"none"}),t.view&&_.isFunction(t.view.remove)&&t.view.remove(),t.$widget.off(),t.$widget.remove())},ve.prototype.renderComponent=function(t,e){e=this.createComponentView(t,e);t.$widget.append(e.$el),this.$el.append(t.$widget)},ve.prototype.renderWidget=function(t){return $("<div/>")},ve.prototype.selectWidget=function(t){this.ignoreWidgetSelect||(this.dashboardViewModel.set("selectedWidget",t.model),this.dashboardViewModel.set("selectedWidgetView",t.view,{silent:!0}))},ve.prototype.setTheme=function(e){_.each(this.widgets,function(t){t.view&&t.view.app&&_.isFunction(t.view.app.setTheme)&&t.view.app.setTheme(e)})},ve.prototype.showReplaceConfirmationDialog=function(e,i){var n=_.get(this.dashboardAppModel.get("components").get(_.get(i,"model.attributes.component.attributes.definitionId",null)),"attributes.componentName","");Pt.ConfirmDialog.ShowConfirm({dialogTitle:"Confirm Replace",renderTemplate:function(){return t("Are you sure you would like to replace this "+n+" component?")},callback:e})},ve.prototype.switchBuildMode=function(t,e){t?this.switchOnBuildMode(e):this.switchOffBuildMode(e)},ve.prototype.switchOffBuildMode=function(t){this.disableWidgetSelect(),_.each(this.widgets,function(t){t.$widget&&t.$widget.addClass("build-off")})},ve.prototype.switchOnBuildMode=function(t){this.enableWidgetSelect(),_.each(this.widgets,function(t){t.$widget&&t.$widget.removeClass("build-off")})},ve.prototype.userCan=function(t){return this.dashboardViewModel.get("buildMode")&&!this.quickView},Pt.ComponentDropView=ve,kt=zt=zt||{},At=m.View,C(be,At),be.prototype.initializeEvents=function(){var t=this.appModel.get("documents");this.listenTo(t,"reset",this.onDocumentsReset),this.listenTo(t,"add",this.onDocumentsAdd),this.listenTo(t,"remove",this.onDocumentsRemove),this.listenTo(this.viewModel,"change:selectedDocumentId",this.onViewModelSelectedChanged)},be.prototype.blurSelect=function(){this.select2.data("select2").$container.find(".select2-selection").blur()},be.prototype.getDocuments=function(){var e=this,i=[],n=[],o=[];this.documentTypeMap={},_.sortBy(this.appModel.get("documents").map(function(t){return t.attributes}),function(t){return-Date.parse(t.lastUpdateDate)}).forEach(function(t){e.appModel.get("quickview")&&0===t.name.indexOf("Draft:")||(_.includes(t.tags,"starred")?(o.push(t),e.documentTypeMap[t.id]="starred"):n.length<e.RECENT_DOCUMENT_COUNT?(n.push(t),e.documentTypeMap[t.id]="recent"):(i.push(t),e.documentTypeMap[t.id]="other"))}),o=_.sortBy(o,function(t){return t.name.toLowerCase()}),i=_.sortBy(i,function(t){return t.name.toLowerCase()}),this.documentsList=n.concat(o,i)},be.prototype.onDocumentsAdd=function(t){this.listenTo(t,"change:name",this.render),this.$el.find("select").select2("close"),this.render()},be.prototype.onDocumentsRemove=function(t){this.stopListening(t),this.render()},be.prototype.onDocumentsReset=function(t,e){var i=this;_.each(e.previousModels,function(t){i.stopListening(t)}),t.each(function(t){i.listenTo(t,"change:name",i.render)}),this.render()},be.prototype.onResize=function(){this.availableHeight=.4*$("body").height()},be.prototype.onViewModelSelectedChanged=function(t,e){e!==this.$el.find("select").val()&&this.selectDocument(e)},be.prototype.render=function(){var n=this,i=this;return this.getDocuments(),this.$el.html(kt.T.DocumentSelector(this.documentsList)),this.select2=this.$el.find("select").select2({language:{noResults:function(){return"No Dashboards found"}},templateResult:function(t){var e;switch(i.documentTypeMap[t.id]){case"starred":e=$('<span><i class="dashboard-selector-icon fa fa-star" title="Starred"></i>'+_.escape(t.text)+"</span>");break;case"recent":e=$('<span><i class="dashboard-selector-icon fa fa-clock-o" title="Recent"></i>'+_.escape(t.text)+"</span>");break;default:e=$("<span>"+_.escape(t.text)+"</span>")}return e},theme:"document-selector",width:"225px"}),this.onResize(),this.select2.on("select2:open",function(){var e,i=$(".select2-container--document-selector .select2-dropdown");n.showManage&&0==i.find(".manage").length&&((e=$('<a class="manage" title="'+t("Manage Dashboards")+'">'+t("Manage Dashboards")+"</a>")).button({icons:{secondary:"fa fa-share-square-o"}}).click(function(){e.removeClass("ui-state-hover"),n.select2.select2("close"),n.trigger("manage")}),i.append("<hr>"),i.append(e)),i.find(".select2-results > ul").css("max-height",n.availableHeight+"px"),kt.Tools.isIE()||$(".select2-search__field").attr("placeholder","Search...")}),this.select2.on("select2:close",function(){_.defer(function(){i.blurSelect()})}),this.select2.on("select2:select",function(){var t=i.select2.val();if(t!==i.viewModel.get("selectedDocumentId"))try{i.appModel.get("router").onNavCancel=function(){i.select2.val(i.viewModel.get("selectedDocumentId")).trigger("change")},i.appModel.get("router").navigate(t,{trigger:!0})}catch(t){kt.Log.Error("Select Document Error:",t)}i.blurSelect()}),this.selectDocument(this.viewModel.get("selectedDocumentId")),this},be.prototype.selectDocument=function(t){var e=this.$el.find("select"),i=this.appModel.get("documents").get(t);e.val(t).trigger("change"),i&&this.$el.find("input").val(i.get("name"))},kt.DocumentSelector=be,xt=zt=zt||{},Nt=m.View,C(we,Nt),we.prototype.initializeEvents=function(){this.listenTo(this.model.get("popups"),"reset viewStatesParsed",this.onResetPopups),this.listenTo(this.model.get("popups"),"add",this.onAddPopup),this.listenTo(this.model.get("popups"),"remove",this.onRemovePopup),this.listenTo(this.model,"change:advancedCss",this.applyCustomCss),this.listenTo(this.model,"change:cssClasses",this.onCssClassesChanged),this.listenTo(this.viewModel,"change:selectedScreenId",this.onSelectedScreenChanged),this.listenTo(this.viewModel,"change:DashboardTheme",function(t){this.applyTheme(t.get("DashboardTheme"))}),$(window).on("keydown",this.onKeyDown.bind(this))},we.prototype.applyCustomCss=function(){var t=this.model.get("advancedCss");t?t!==this.customCss&&(this.$customCss&&this.$customCss.length?this.$customCss.html(t):this.$customCss=$("<style />",{documentid:this.model.id,html:t,type:"text/css"}).appendTo(document.head),this.customCss=t):this.$customCss&&(this.$customCss.remove(),this.$customCss=null,this.customCss=null)},we.prototype.applyCssClasses=function(t){t?(t=_.isArray(t)?_.reduce(t,function(t,e){return t+" "+e}):t)!==this.cssClasses&&(this.$el.removeClass(this.cssClasses),this.$el.addClass(t),this.cssClasses=t):(this.$el.removeClass(this.cssClasses),this.cssClasses=null)},we.prototype.applyDataSources=function(){_.each(this.model.get("data").flatten(),function(t){t.isMapping()&&t.apply()})},we.prototype.applyTheme=function(e){var i=this;this.screenView&&_.each(this.screenView.widgets,function(t){i.applyThemeToWidget(t,e)})},we.prototype.applyThemeToWidget=function(t,e){t.view.app&&t.view.app.setTheme&&t.view.app.setTheme(e)},we.prototype.changeScreen=function(e){this.screenView&&this.screenView.remove();var i=$(document.createElement("div"));i.addClass("screen-view"),i.appendTo(this.$el.find(".screen-view-div")),this.screenView=null,require(["Panel"],function(t){this.screenView||(this.applyDataSources(),this.passScreenPropertiesToDocumentModel(e,this.model),this.screenView=new t({el:i,model:e,dashboardAppModel:this.appModel,documentModel:this.model,dashboardViewModel:this.viewModel,websiteUrl:this.appModel.get("websiteUrl"),DeltaClientLib:this.deltaClient,api:{},isBasePanel:!0,quickView:this.quickView}))}.bind(this))},we.prototype.createPopup=function(t){return new xt.PopupView({viewModel:this.viewModel,appModel:this.appModel,container:this.$el,quickView:this.quickView,model:t})},we.prototype.onAddPopup=function(){this.popups.push(this.createPopup(arguments[0]))},we.prototype.onRemovePopup=function(e){var t=_.find(this.popups,function(t){return t.model.get("id")===e.get("id")});this.popups.splice(this.popups.indexOf(t),1),t.remove()},we.prototype.onResetPopups=function(){var e=this;_.each(this.popups,function(t){t.remove()}),this.popups=[],this.model.get("popups").each(function(t){e.popups.push(e.createPopup(t))})},we.prototype.onKeyDown=function(t){var e,i=t.keyCode;(t.ctrlKey||t.metaKey)&&(t=this.model.get("shortcuts"),e=String.fromCharCode(i).toLowerCase(),(t=_.find(t,function(t){return t.Key===e}))&&t.Data&&t.Data.forceExecute())},we.prototype.onCssClassesChanged=function(){var t=this.model.get("cssClasses");t&&t._dashboardsType||(this.prevCssViewModel&&(this.stopListening(this.prevCssViewModel),this.prevCssViewModel=null),t instanceof m.Model&&(this.listenTo(t,"change:value",function(t,e){this.applyCssClasses(e)}),t=(this.prevCssViewModel=t).get("value")),this.applyCssClasses(t))},we.prototype.onResize=function(){this.screenView&&this.screenView.onResize(!0)},we.prototype.onSelectedScreenChanged=function(){var t,e=!1,i=this.viewModel.get("selectedScreenId");i&&(t=this.model.get("screens").get(i))&&(this.changeScreen(t),e=!0),e||((t=this.model.get("screens").findWhere({isDefault:!0}))?this.viewModel.set("selectedScreenId",t.id):(t=this.model.get("screens").first())&&(t.set("isDefault",!0),this.viewModel.set("selectedScreenId",t.id)))},we.prototype.passScreenPropertiesToDocumentModel=function(t,e){var i=t.get("relativeHeight"),n=t.get("rowCount")||24,o=t.get("rowHeight")||25;void 0===i&&void 0===(i=e.get("relativeHeight"))&&(i=!0),t.set(o={relativeHeight:i,rowCount:n,rowHeight:o}),e.set(_.extend(o,{colCount:t.get("colCount"),floatable:t.get("floatable")})),e.trigger("basePanelLayoutChanged")},we.prototype.pasteWidget=function(t){this.screenView&&!this.quickView&&this.screenView.pasteWidget(t)},we.prototype.remove=function(){var t;return this.stopListening(),this.screenView&&this.screenView.remove(),_.each(this.popups,function(t){t.remove()}),this.$customCss&&this.$customCss.remove(),(t=this.model.get("data"))&&(t.stopPolledQueries&&t.stopPolledQueries(),t.removeSubscriptions&&t.removeSubscriptions()),$(window).off("keydown"),m.View.prototype.remove.call(this)},xt.DocumentView=we,Lt=zt=zt||{},Vt=m.View,C(Se,Vt),Se.checkCapslockOn=function(t){var e=/Mac/.test(navigator.platform),i=t.charCode,n=t.shiftKey,o=!1;return 97<=i&&i<=122?o=n:!(65<=i&&i<=90)||n&&e?122<i&&t.getModifierState("CapsLock")&&(o=!0):o=!n,o},Se.prototype.onWindowCapsLockClick=function(t){20===t.which&&(t.getModifierState("CapsLock")?this.setErrorMessage("capsLock","#ffc800"):this.$el.find(".loginErrorPanel").css("visibility","hidden"))},Se.prototype.render=function(){var e=this;return this.$el.html(Lt.T.LoginDialog({})),$(".quick-base").addClass("disturbed"),$(document).find(".loadingScreen svg").hide(),$(document).find(".loading-info svg").hide(),e.$userLoginForm=this.$el.find(".user-login-form"),e.$forgotPasswordForm=this.$el.find(".forgot-password-form"),e.$forgotPasswordBtn=this.$el.find(".forgot-info"),e.$passwordResetInfo=this.$el.find(".password-reset-info"),e.$recoveryResponse=this.$el.find(".recovery-response"),e.$resetUserName=this.$el.find(".reset-username"),this.$restPasswordError=this.$el.find(".reset-password-error"),e.$dialog=this.$el.find(".login-form"),e.$buttonPanel=this.$el.find(".login-button-panel"),this.$el.find(".login-btn").button({label:t("Login"),icons:{primary:"fa fa-check"}}),this.$el.find(".back-btn").button({label:t("Back"),icons:{primary:"fa fa-arrow-left"}}),this.$el.find(".reset-btn").button({icons:{primary:"fa fa-undo"},label:t("Reset")}),e.$loginBtn=this.$el.find(".login-btn"),e.$backBtn=this.$el.find(".back-btn"),e.$backBtn.hide(),e.$resetBtn=this.$el.find(".reset-btn"),e.$resetBtn.hide(),(e=$.cookie("deltaLoginError"))?$.removeCookie("deltaLoginError",{path:"/"}):e=this.errorMessage,e&&this.setErrorMessage(e),this},Se.prototype.initializeEvents=function(){var e=this;e.$el.find(".password, .username").on("keydown",function(t){13===t.which&&e.onLoginButtonClick(t)}),window.addEventListener("keydown",this.boundCapsLockFn,!0),e.$el.find(".password").on("keypress",function(t){Se.checkCapslockOn(t.originalEvent)?e.setErrorMessage("capsLock","#ffc800"):e.$el.find(".loginErrorPanel").css("visibility","hidden")}),e.$forgotPasswordBtn.on("click",function(){e.showForgotPasswordForm()}),e.$loginBtn.on("click",function(t){t.preventDefault(),e.onLoginButtonClick(t)}),e.$backBtn.on("click",function(t){t.preventDefault(),e.hideForgotPasswordForm()}),e.$resetBtn.on("click",function(t){t.preventDefault(),e.onResetButtonClick()}),$(Lt.DeltaClientLib).one("DeltaClientLogin",$.proxy(e.onLoginSuccess,e))},Se.prototype.clickLoginButton=function(){this.onLoginButtonClick({currentTarget:$(".login-button-panel .login-btn")})},Se.prototype.onLoginButtonClick=function(e){var i,n,o=this;if(!this.clicked){if(i=this.$el.find(".username").val(),n=this.$el.find(".password").val(),this.$buttonText=$(e.currentTarget).find(".ui-button-text"),!i||!n)return this.setErrorMessage("Please enter your username and password."),void e.preventDefault();this.setErrorMessage("Connecting please wait...","#fff"),this.clicked=!0,e&&($(e.currentTarget).find(".ui-button-icon-primary").removeClass("fa-check"),$(e.currentTarget).find(".ui-button-icon-primary").css({width:"auto",height:"auto"}),$(e.currentTarget).find(".ui-button-icon-primary").addClass("fa-spinner fa-pulse"),this.$buttonText.text(t("wait")+"...")),this.$el.find("input").attr("disabled","disabled"),_.isFunction(o.doLogin)&&o.doLogin(i,n,function(t){o.setErrorMessage(t)})}},Se.prototype.onLoginSuccess=function(){this.appModel.set("userName",Lt.DeltaClientLib.deltaClient.user()),$.cookie("deltaToken",Lt.DeltaClientLib.deltaClient.tokenKey(),{expires:30,path:"/"}),$(".quick-base").removeClass("disturbed"),this.onRemove()},Se.prototype.onRemove=function(){this.$loginBtn.off(),this.$backBtn.off(),this.$resetBtn.off(),this.$forgotPasswordBtn.off(),$(document).find(".loadingScreen svg").show(),$(document).find(".loading-info svg").show(),$(Lt.DeltaClientLib).off("DeltaClientLogin",this.onLoginSuccess),window.removeEventListener("keydown",this.boundCapsLockFn,!0),this.remove()},Se.prototype.onResetButtonClick=function(){var t,i=this;this.$restPasswordError.css("visibility","hidden"),this.$userLoginForm.removeClass("open"),(t=this.$resetUserName.val())&&0<t.length?(this.showPasswordResetInfo(),$.get("/kxuseradmin?operation=request&data="+t).done(function(t){i.$recoveryResponse.text(t)}).fail(function(t){var e="Error";_.isString(t)?e+=": "+t:t&&t.statusText&&(e+=": "+t.statusText),i.$recoveryResponse.text(e)})):this.$restPasswordError.css("visibility","visible")},Se.prototype.setErrorMessage=function(e,i){var n=this,o=n.$dialog.parent().find(".ui-button-icon-primary.fa-spinner.fa-pulse");this.$el.find(".loginErrorPanel").removeClass("warning"),"#fff"===i?this.$el.find(".loginErrorPanel").addClass("info"):"#ffc800"===i?this.$el.find(".loginErrorPanel").addClass("warning"):this.$el.find(".loginErrorPanel").removeClass("info"),"locked"===e?e=t("Account is locked; please contact your administrator"):"capsLock"===e&&(e='<i class="fa fa-warning"/>'+t("Caps Lock is on")),this.$el.find(".loginErrorPanel").css({}),this.$el.find(".loginErrorPanel").html(e).css("visibility","visible"),n.clicked=!1,o.length&&(o.removeClass("fa-spinner fa-pulse"),o.addClass("fa-check"),this.$loginBtn.find(".ui-button-text").text(t("Login"))),n.$el.find("input").removeAttr("disabled"),"Please reset password"!==e&&"Your password has expired"!==e||n.changePasswordDialog||(n.changePasswordDialog=new Lt.ChangePasswordDialog({appModel:n.appModel,container:n.container,message:e,onChangeSuccess:function(){n.$el.find(".loginErrorPanel").css("visibility","hidden"),n.$el.data("uiDialog")&&n.$el.dialog("close")},onDialogClose:_.bind(function(){n.changePasswordDialog=null},n)}))},Se.prototype.showForgotPasswordForm=function(){this.$userLoginForm.removeClass("open"),this.$forgotPasswordForm.addClass("open"),this.$passwordResetInfo.removeClass("open"),this.$loginBtn.hide(),this.$backBtn.show(),this.$resetBtn.show()},Se.prototype.showPasswordResetInfo=function(){this.$userLoginForm.removeClass("open"),this.$forgotPasswordForm.removeClass("open"),this.$passwordResetInfo.addClass("open"),this.$loginBtn.hide(),this.$resetBtn.hide(),this.$backBtn.show()},Se.prototype.hideForgotPasswordForm=function(){this.$forgotPasswordForm.removeClass("open"),this.$passwordResetInfo.removeClass("open"),this.$userLoginForm.addClass("open"),this.$loginBtn.show(),this.$backBtn.hide(),this.$resetBtn.hide()},Lt.LoginDialog=Se,K=zt=zt||{},_e.getStringColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){return 11===Number(t.get("kdbType"))}).map(function(t){return t.id})},_e.getScalarColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 3<t&&t<11||11<t&&t<20}).map(function(t){return t.id})},_e.getNumericColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 3<t&&t<11}).map(function(t){return t.id})},_e.getTimeColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){t=Number(t.get("kdbType"));return 11<t&&t<20}).map(function(t){return t.id})},_e.getListColumns=function(t){t=t.source||t;return _.filter(t.dataSet.columns.models,function(t){return 0===Number(t.get("kdbType"))}).map(function(t){return t.id})},K.HeuristicHelpers=_e,(zt||(zt={})).HelpDialog=m.View.extend({$dialog:null,appModel:null,className:"quick-base window",viewModel:null,initialize:function(t){this.appModel=t.appModel,this.container=t.container,this.viewModel=t.viewModel,this.tag=t.tag,this.render()},remove:function(){this.$el.dialog("destroy").remove(),this.stopListening(),this.$el.off(),this.$el.remove()},render:function(){var e=this,i=$(document),n=this.appModel.get("DocsUrl"),o=this.appModel.get("websiteUrl").replace("/edit",""),n=void 0!==n?n:o+"docs/",o=this.appModel.get("isHelpDialogTabbed")||!1,n=void 0!==this.tag?n+"/"+this.tag:n;o?window.open(n,"_blank"):(this.$el.html($("<iframe />").attr("src",n)),this.$dialog=this.$el.dialog(_.extend({appendTo:this.container,dialogClass:"quick-base help-dialog",title:t("Help"),resizable:!0,height:.8*i.height(),width:.8*i.width(),modal:!0,autoOpen:!0,draggable:!0,open:function(){$('<i class="fa fa-question-circle" />').insertBefore(e.$el.parent().find(".ui-dialog-title"))},close:function(){e.remove()}},this.options)))}}),Bt=zt=zt||{},Ot=m.View,C(Ce,Ot),Ce.prototype.getTimezones=function(){this.timezones=_.map(y.tz.names(),function(t){return{group:t.substr(0,t.indexOf("/")),label:t.substr(t.indexOf("/")+1),value:t}}),this.timezones=_.groupBy(this.timezones,"group")},Ce.prototype.onAbout=function(){new Bt.AboutDialog({appModel:this.appModel,container:this.dialogContainer,viewModel:this.viewModel})},Ce.prototype.onHelp=function(){new Bt.HelpDialog({appModel:this.appModel,container:this.dialogContainer,viewModel:this.viewModel})},Ce.prototype.onChangeLanguage=function(){var t=this.$selectLanguage.val();t&&t!==$.cookie("dashboard-language")&&($.cookie("dashboard-language",t,{expires:90,path:"/"}),window.location.reload(!1))},Ce.prototype.onChangeLogLevel=function(){var t=this.$selectLogLevel.val();t&&t!==$.cookie("dashboard-log-level")&&$.cookie("dashboard-log-level",t,{expires:90,path:"/"}),Bt.Log.trace(t.toString())},Ce.prototype.onChangePassword=function(){new Bt.ChangePasswordDialog({appModel:this.appModel,container:this.dialogContainer})},Ce.prototype.onChangeTheme=function(){var t=this.$selectTheme.val();t&&t!==$.cookie("dashboard-theme")&&($.cookie("dashboard-theme",t,{expires:90,path:"/"}),this.trigger("themeChange",t))},Ce.prototype.onChangeViewerTheme=function(){var t=this.$selectViewerTheme.val();t&&t!==$.cookie("dashboard-viewer-theme")&&($.cookie("dashboard-viewer-theme",t,{expires:90,path:"/"}),this.trigger("themeChange",t))},Ce.prototype.onChangeTimezone=function(){var t=this.$selectTimezone.val();t&&t!==$.cookie("dashboard-timezone")&&($.cookie("dashboard-timezone",t,{expires:90,path:"/"}),window.location.reload(!1))},Ce.prototype.onLogout=function(){var t=this,e=this.viewModel.get("selectedDocumentId"),i=this.appModel.get("documents").find(function(t){return t.id===e});!(this.isQuickView?i&&i.get("viewState").wasChanged:i&&i.get("wasChanged"))||this.isQuickView&&!i.get("unsavedViewerPrompt")?Bt.DeltaClientLib.logout():new Bt.AreYouSureDialog({userClass:this.isQuickView?"quick-view":"quick-dash",container:this.dialogContainer,noSaveCb:_.bind(Bt.DeltaClientLib.logout,Bt.DeltaClientLib),saveCb:function(){t.isQuickView?i.get("viewState").save({id:e},{success:_.bind(Bt.DeltaClientLib.logout,Bt.DeltaClientLib)}):i.saveNow($.noop,_.bind(Bt.DeltaClientLib.logout,Bt.DeltaClientLib))}})},Ce.prototype.onThemeSwitchableChange=function(){this.viewModel.get("themeSwitchable")?this.$selectViewerTheme.prop("disabled",!1):this.$selectViewerTheme.prop("disabled",!0)},Ce.prototype.render=function(){var t,e=this;return this.$el.html(Bt.T.ProfileMenu({majorTimezones:this.MAJOR_TIMEZONES,saml:this.appModel.get("saml"),isLite:this.appModel.get("isLite"),logLevel:this.logLevels,themes:this.themes,timezones:this.timezones,editor:!this.isQuickView,showBreadcrumbs:this.appModel.get("showBreadcrumbs")})),this.$buttonset=this.$el.find(".buttonset"),this.$selectLanguage=this.$el.find(".select-language"),this.$selectLogLevel=this.$el.find(".select-log-level"),this.$selectTheme=this.$el.find(".select-theme"),this.$selectTimezone=this.$el.find(".select-timezone"),this.$selectViewerTheme=this.$el.find(".select-viewer-theme"),this.$breadcrumbs=this.$el.find(".breadcrumbs"),this.$buttonset.buttonset(),this.$buttonset.menu({select:function(t){switch($(t.currentTarget).attr("data-options")){case"change-password":e.onChangePassword();break;case"about":e.onAbout();break;case"helpguide":e.onHelp();break;case"logout":e.onLogout();break;case"login-history":e.trigger("login-history");break;case"logout-local":e.ssoLogout("local");break;case"logout-global":e.ssoLogout("global");case"open-editor":window.open("./edit#"+Bt.Tools.getHash(),"_blank");break;case"open-viewer":window.open("../#"+Bt.Tools.getHash(),"_blank");break;case"document-breadcrumbs":e.toggleBreadcrumbs()}}}),t=[{$el:this.$selectLanguage,value:$.cookie("dashboard-language")||"en",options:{},callback:this.onChangeLanguage},{$el:this.$selectLogLevel,value:$.cookie("dashboard-log-level")||"4",options:{minimumResultsForSearch:10},callback:this.onChangeLogLevel},{$el:this.$selectTheme,value:$.cookie("dashboard-theme")||"kx-darkroom",options:{minimumResultsForSearch:3},callback:this.onChangeTheme},{$el:this.$selectViewerTheme,value:$.cookie("dashboard-viewer-theme")||"kx-darkroom",options:{minimumResultsForSearch:3},callback:this.onChangeViewerTheme},{$el:this.$selectTimezone,value:Bt.Tools.timezone,options:{},callback:this.onChangeTimezone}],_.each(t,function(t){t.$el.val(t.value),t.$el.select2(_.extend({theme:"dashboards"},t.options)),t.$el.on("select2:select",_.bind(t.callback,e)),t.$el.on("select2:open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment"),$(".select2-search__field").on("click",function(t){t.stopPropagation()})}),t.$el.on("select2:close",function(){$(".select2-search__field").off()})}),(this.isQuickView?this.$el.find(".row.theme"):this.$el.find(".row.viewer-theme")).css("display","none"),this},Ce.prototype.ssoLogout=function(t){Bt.DeltaClientLib.ssoLogout(t)},Ce.prototype.toggleBreadcrumbs=function(){this.appModel.set("showBreadcrumbs",!this.appModel.get("showBreadcrumbs")),this.appModel.get("showBreadcrumbs")?this.$breadcrumbs.addClass("checked"):this.$breadcrumbs.removeClass("checked")},Bt.ProfileMenu=Ce,Rt=zt=zt||{},$t=m.View,C(Te,$t),Te.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:buildMode",this.onBuildModeChange),this.listenTo(this.model,"change:dialogTitle change:dialogWidth change:dialogHeight change:modal change:resizable",this.onDialogAttributeChange),this.listenTo(this.model,"change:visible",this.initializeVisible)},Te.prototype.destroyDialog=function(){this.$dialog.dialog("instance")&&this.$dialog.dialog("destroy")},Te.prototype.initializeComponentDrop=function(){var t;this.componentDropView||(t=$("<div></div>",{class:"component-drop"}),this.$contentPanel.append(t),this.componentDropView=new Rt.ComponentDropView({el:t,dashboardAppModel:this.appModel,dashboardViewModel:this.viewModel,DeltaClientLib:Rt.DeltaClientLib,quickView:this.quickView,widgets:this.model.get("widgets")}))},Te.prototype.initializeDialog=function(){var e=this,t=!1,i=this.processSettings(),n={appendTo:this.$dialogContainer,autoOpen:!1,close:function(){var t=e.model.get("visible");!e.isEditing&&t instanceof m.Model&&!1!==t.get("value")&&t.set("value",!1),e.doActions(e.model.get("Actions")),e.isEditing?e.remove():e.removeComponentDropView()},dialogClass:"popup-dialog",open:function(){e.componentDropView&&e.componentDropView.onResize(),e.$dialog.dialog("option",{position:{my:"center",at:"center",of:e.$dialogContainer}}),e.$dialog.parent().attr("data-widgetid",e.widgetId),e.isEditing&&$("<div />").addClass("popup-mask ui-widget-overlay").appendTo(e.$dialogContainer).click(function(){e.$dialog.dialog("close")})},position:{my:"center",at:"center",of:this.$dialogContainer},resizeStop:function(){e.componentDropView&&e.componentDropView.onResize()},title:i.dialogTitle};_.assign(n,this.getAdjustedSize(i)),this.isEditing?(n.modal=!1,n.resizable=!1):(n.modal=!0===i.modal,n.resizable=!0===i.resizable),this.$dialog.dialog("instance")?(this.$dialog.dialog("option","modal")!==n.modal&&(t=this.$dialog.dialog("isOpen")),this.$dialog.dialog("option",n),t&&(this.$dialog.dialog("close"),this.$dialog.dialog("open"))):this.$dialog.dialog(n)},Te.prototype.initializeVisible=function(){var t=this.model.get("visible");this.visibleListener&&this.stopListening(this.visibleListener),t instanceof Rt.DocumentViewModel&&(this.listenTo(t,"change:value",this.onVisibleChange),this.visibleListener=t),this.onVisibleChange()},Te.prototype.onBuildModeChange=function(){this.isEditing?this.remove():this.viewModel.get("buildMode")?this.$dialog.dialog("close"):(this.initializeDialog(),this.onVisibleChange())},Te.prototype.getAdjustedSize=function(t){return{height:Math.min(t.dialogHeight,this.$dialogContainer.height())||.8*this.$dialogContainer.height(),width:Math.min(t.dialogWidth,this.$dialogContainer.width())||.8*this.$dialogContainer.width()}},Te.prototype.onVisibleChange=function(){var t=this,e=this.model.get("visible");this.viewModel.get("buildMode")||(e instanceof Rt.DocumentViewModel&&(e=e.get("value")),this.$dialog.dialog("instance")&&_.defer(function(){t.toggleDialog(e)}))},Te.prototype.pasteWidget=function(t){var e=t.get("component").get("definitionId"),i=this.componentDropView.widgetsCollection.first();i?((t=t.clone(i.get("id"))).setParent(this.componentDropView.widgetsCollection),i.commandSet({component:t.get("component")})):(t.setParent(this.componentDropView.widgetsCollection),this.componentDropView.addNewWidget(t,e,!0))},Te.prototype.processSettings=function(){var i=this,t=_.omit(this.model.attributes,"visible"),n={};return _.each(this.viewStateListeners,function(t){i.stopListening(t,"change:value")}),this.viewStateListeners={},_.each(t,function(t,e){t instanceof Rt.DocumentViewModel?(n[e]=t.get("value"),i.viewStateListeners[t.path]||(i.listenTo(t,"change:value",function(){i.$dialog.dialog("instance")&&i.$dialog.dialog("isOpen")&&("height"===t.path||"width"===t.path)?i.$dialog.dialog(i.getAdjustedSize(i.processSettings())):i.initializeDialog()}),i.viewStateListeners[t.path]=t)):n[e]=t}),n},Te.prototype.remove=function(){return this.isEditing&&this.$dialogContainer.find(".popup-mask").remove(),this.onDialogAttributeChange.cancel(),this.destroyDialog(),this.removeComponentDropView(),this.viewStateListeners={},m.View.prototype.remove.apply(this)},Te.prototype.removeComponentDropView=function(){this.componentDropView&&(this.componentDropView.remove(),this.componentDropView=null)},Te.prototype.stringToBoolean=function(t){if("boolean"==typeof t)return t;if(!t)return!1;var e=t.toString();switch(e.toLowerCase().trim()){case"true":case"yes":case"1":return!0;case"false":case"no":case"0":case null:return!1;default:return Boolean(e)}},Te.prototype.toggleDialog=function(t){var t=_.isUndefined(t)?!this.$dialog.dialog("isOpen"):t;this.$dialog.dialog("instance")&&(this.stringToBoolean(t)?(this.initializeComponentDrop(),t=_.pick(this.$dialog.dialog("option"),["width","height"]),0!==Number(t.width)&&0!==Number(t.height)||this.$dialog.dialog("option",this.getAdjustedSize(this.processSettings())),this.$dialog.dialog("open"),this.viewModel.get("buildMode")&&(this.viewModel.set("selectedWidget",this.model),this.viewModel.set("selectedWidgetView",this,{silent:!0}))):this.$dialog.dialog("close"))},Te.prototype.doActions=function(t){var o=this;_.each(t,function(t,e){var i=o.getPropertyMeta(e,"Current"),n=o.getPropertyMeta(e,"Target");i&&(t="viewstate"===i.type?i.value:t.Current,Rt.Tools.isKDBTemporal(t)&&(t=Rt.Tools.convertKDBTemporalToMoment(t).toDashString()),n&&"viewstate"===n.type&&n.path&&o.model.get("Actions")[e].Target.set("value",t))})},Te.prototype.getPropertyMeta=function(t,e){var i,n,o,t=this.model.get("Actions")[t][e];if(_.isNil(t))return null;e=this.getSourceType(t);return"viewstate"===e?(o=t.get("value"),i=t.get("_default"),n=t.get("_type")):o=t,{path:t.path||null,type:e,value:o,viewstateType:n||null,defaultValue:i||null}},Te.prototype.getSourceType=function(t){return t&&(t instanceof Rt.DocumentViewModel||t.get&&t.get("_viewType")||t.has&&t.has("_default")&&t.has("value"))?"viewstate":null},Rt.PopupView=Te,Ut=zt=zt||{},De.applyFormatToValue=function(t,e,i,n,o){var r={1:"Boolean",2:"String",4:"Number",5:"Number",6:"Number",7:"Number",8:"Number",9:"Number",10:"String",11:"String",12:"Timestamp",13:"Month",14:"Date",15:"Datetime",16:"Timespan",17:"Minute",18:"Second",19:"Time"}[n],n=3<n&&n<10?"Number":11<n&&n<20?"DateTime":"String";return"TO_STRING"==e?t.toString():e?De._applyFormat(t,e,i,r,o,n):De._applyDefaultFormat(t,i,r,o,n)},De._applyFormat=function(t,e,i,n,o,r){var s=t.toString();switch(n=0===e.indexOf("SmartNumber")?"Smart Number":n){case"Smart Number":"DateTime"===r&&(u=Ut.Tools.convertKDBTemporalToMoment(t),t=_.escape(u)),l=-1!==e.indexOf(".")?e.split(".")[1].length:0,s=Ut.Tools.smartFormatNumber(t,l,!o);break;case"Number":!_.isNaN(Number(t))&&_.isFinite(Number(t))&&(s=XLSX.SSF.format(e,Number(t)),o&&(s=De._hideTrailingZeroes(s)));break;case"Date":case"Month":case"Timestamp":case"Datetime":case"Timespan":case"Minute":case"Second":case"Time":var a="Time"===i,l="DateTime"===i,u=Ut.Tools.convertKDBTemporalToMoment(t);"Number"===i?(s=_.escape(u),!_.isNaN(Number(s))&&_.isFinite(Number(s))&&(s=XLSX.SSF.format(e,Number(s)),o&&(s=De._hideTrailingZeroes(s)))):s=_.isFunction(u.isValid)&&!u.isValid()?_.escape(u):a||l?u.formatNano(e,{trim:!1,trimNano:!1}):u.formatNano(e);break;case"String":default:s=t.toString()}return s},De._applyDefaultFormat=function(t,e,i,n,o){var r=t.toString(),s=null;return Ut.Tools.isKDBTemporal(t)&&(s=Ut.Tools.convertKDBTemporalToMoment(t)),"DateTime"===o?"Number"===e?r=_.escape(s):s&&_.isFunction(s.format)?r=s.format():_.isFunction(t.toString)&&(r=t.toString()):"Number"===o&&n&&(r=De._hideTrailingZeroes(r)),r},De._hideTrailingZeroes=function(t){var e=t;if(0<=e.indexOf(".")){for(e[e.length-1],0;"0"===e[e.length-1];)e=e.slice(0,-1);"."===e[e.length-1]&&(e=e.slice(0,-1)),e+=""}return e},Ut.RawDataFormatter=De,Ft=zt=zt||{},Me.getFormData=function(n,t,o){var e=[],r=[];e.push(_.map(t,function(t,e){t=t.colName||t.colId;return n.length||(r[e]={isStringType:!1,format:"",type:"String"}),{formattedVal:t,value:t,type:"String"}}));for(var s=0;s<n.length;s++){var a=[];_.each(t,function(t,e){var i=n[s][t.colId];null!=i?(i=Me.generateExportData(t,i,e,o,r),a.push(i)):(r[e]=r[e]||{isStringType:!1,format:t.dataFormat,type:t.dataType},a.push({formattedVal:"",value:"",type:null}),console.log("Cell value is either undefined or null: "+t.colId))}),e.push(a)}return{data:e,columnHeaders:r}},Me.generateExportData=function(t,e,i,n,o){var r=i,s=t.dataFormat,a=t.dataKdbType,l=t.dataType,u=t.hideTrailingZeroes,c=t.prefix,p=t.suffix,d={},i=Me.checkIfFormatXLSXCompatible(s),t=!("Boolean"===l||s&&i);return o[r]=o[r]||{isStringType:!1,format:s,type:l},""!==e?(i=Ft.RawDataFormatter.applyFormatToValue(e,s,l,a,u),"csv"===n&&/^[-\+=@]/.test(i)&&(i="'"+i),t?(d={formattedVal:i,value:c+i+p},o[r].type="String"):"Boolean"===l?d={formattedVal:i,value:"true"===i}:"Number"===l&&"%"===p?(t=0<(a=100*Number(e))-Math.floor(a)?a.toFixed(2):a.toFixed(0),i=a+"%",s=-1!==t.indexOf(".")?"0.00%":"0%",16<t.length&&(o[r].isStringType=!0),d={formattedVal:i,value:Number(e),format:s}):_.includes(["Date","Time","DateTime","Boolean"],l)||!c&&!p?d=Me._convertToExportFormat(r,i,e,l,s,n,u,o):(d={formattedVal:i,value:c+i+p},o[r].type="String")):d={formattedVal:"",value:"",type:"String"},d},Me.checkIfFormatXLSXCompatible=function(t){var e=!0;return e=_.includes(Me.EXCEL_INCOMPATIBLE_FORMATS,t)||-1!==t.indexOf(".SSS")?!1:e},Me._convertToExportFormat=function(t,e,i,n,o,r,s,a){var l,u,c={format:void 0,formattedVal:e,value:"",type:void 0};switch("Number"===n&&(isNaN(Number(i))||!_.isFinite(Number(i))?c.type=n="String":_.isString(e)&&16<e.length&&(n="String",a[t].isStringType=!0)),n){case"Number":s&&!/[%]/.test(o)&&(u=(u=-1!==e.indexOf(".")?e.split(".")[1].length:0)?"."+Array(u+1).join("0"):"",(u=(-1!==o.indexOf(".")?o.split(".")[0]:o)+u)!==o&&(c.format=u)),l=Number(i);break;case"Date":"csv"!==r&&y.utc(e,o).isValid()&&"Invalid date"!==y.utc(e,o).format()?l=y.utc(e,o).format():"csv"===r?(l=e,a[t].type="String"):(l=e,a[t].isStringType=!0);break;case"Time":case"DateTime":l=e,a[t].type="String";break;case"String":default:l=e}return c.value=l,c},Me.EXCEL_INCOMPATIBLE_FORMATS=["","SmartNumber","SmartNumber.0","SmartNumber.00","SmartNumber.000","SmartNumber.0000","SmartNumber.00000","SmartNumber.000000","SmartNumber.0000000","SmartNumber.00000000","SmartNumber.000000000","SmartNumber.0000000000","HH:mm","HH:mm:ss","HH:mm:ss.SSS","HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS","YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS","mm:ss","mm:ss.SSS","Mm:ss.SSSSSS","mm:ss.SSSSSSSSS","ss","ss.SSS","ss.SSSSSS","ss.SSSSSSSSS"],Ft.FileExportDataGenerator=Me,K=zt=zt||{},qt=K.DialogBase,C(Ee,qt),Ee.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.options&&(t.options.showLoading?(t.showLoadingSpinner(),_.defer(function(){t.dialogClose()})):t.dialogClose())},icons:{primary:"fa fa-check"}},{text:"Cancel",click:function(){t.isCancel=!0,t.dialogClose()},icons:{primary:"fa fa-times"}}]},Ee.prototype.postRender=function(){var e=this;this.$("input").val(this.options.inputValue),this.$("input").on("input",function(t){e.options.inputValue=e.inputValue=$(t.target).val()})},Ee.prototype.renderTemplate=function(){return t("<span>what?</span><input />")},Ee.prototype.showLoadingSpinner=function(){var t=this.$dialogButtonpane.find("span.fa.fa-check");t.removeClass("fa-check"),t.addClass("fa-spinner fa-pulse")},Ee.ShowInput=function(e,i,n,o,r,s,a){return new Ee(_.extend({iconClass:o,dialogTitle:i,callback:e,inputValue:r,userClass:s,showLoading:a},n?{renderTemplate:function(){return t("<div>"+n+"</div><input style='width: 100%; box-sizing: border-box;' />")}}:{}))},K.SimpleInputDialog=Ee,Yt=zt=zt||{},Pe.prototype.createExportOfCurrentData=function(i){var n,o,r=this,t=r.configSets,e=r.dataSet,s=r.metaData,a=[],l={SheetNames:[],Sheets:{}},u=",",c=r.bookType;t&&_.keys(t).length?_.each(t,function(t){a.push(Yt.FileExportDataGenerator.getFormData(t.dataSet,t.metaData,c))}):e&&e.length&&s&&s.length&&(a[0]=Yt.FileExportDataGenerator.getFormData(e,s,c)),a.length&&a[0].data.length?(_.each(a,function(t,e){var i=r.workSheetTitle||"Work_sheet";i+=1<a.length?"_"+e:"",t=r.convertDataToWorksheet(t.data,t.columnHeaders),l.SheetNames.push(i),l.Sheets[i]=t}),"csv"!==c?(n=XLSX.write(l,{bookType:c,bookSST:!1,type:"binary"}),s=Pe.s2ab(n),r.downloadExportFile(i,s)):(o=1,r.csvExportDelimiter&&r.csvExportDelimiter.length&&(u=r.csvExportDelimiter),_.each(l.Sheets,function(t){var e=1<a.length?i.slice(0,-4)+"part"+o+".csv":i;try{n=XLSX.utils.sheet_to_csv(t,{FS:u})}catch(t){return void console.log("Error",t)}0===n.indexOf("ID")&&(/[-\+\{\}\[\]\?\^\*\.\|\$]/.test(u)&&(u="\\"+u),t=new RegExp("(ID[^"+u+"\n]*)"),n=n.replace(t,'"$1"')),r.downloadExportFile(e,n),o+=1}))):console.error("Data formatter function returned invalid parameter or no data")},Pe.prototype.downloadExportFile=function(t,e){var i,n="application/octet-stream",o=document.createElement("a");window.Blob?(i=new Blob([e],{type:n}),window.navigator.msSaveOrOpenBlob?o.onclick=function(){window.navigator.msSaveOrOpenBlob(i,t)}:void 0!==o.download&&o.setAttribute("href",URL.createObjectURL(i))):o.setAttribute("href",encodeURI(n+","+e)),void 0!==o.download&&o.setAttribute("download",t),document.body.appendChild(o),o.click(),document.body.removeChild(o)},Pe.prototype.showDialog=function(){var e=this,i=e.fileFormat,n={".csv":"Csv",".xlsx":"Excel"}[i],o=e.fileName+i;Yt.SimpleInputDialog.ShowInput(function(){var t=this.inputValue;t=(t=""+t||Yt.ExportTools.getDefaultExportFileName(n)).replace(/:/g,"-").replace(/[^\w \.\-]/g,""),new RegExp(i+"$").test(t)||(t+=i),e.createExportOfCurrentData(t)},t("Export file"),t("Please enter the filename"),"fa fa-download",o,"",!0)},Pe.prototype.convertDataToWorksheet=function(t,e){for(var i={},n={s:{c:1e7,r:1e7},e:{c:0,r:0}},o=0;o!=t.length;++o)for(var r=0;r!=t[o].length;++r){n.s.r>o&&(n.s.r=o),n.s.c>r&&(n.s.c=r),n.e.r<o&&(n.e.r=o),n.e.c<r&&(n.e.c=r);var s=t[o][r],a=(void 0!==s.type&&""!==s.type?s:e[r]).type,l=s.format||e[r].format,u={};if(null!==a){e[r].isStringType&&(a="String",s.value=s.formattedVal||s.value);var c=XLSX.utils.encode_cell({c:r,r:o});switch(a){case"Number":l?(u.t="n",u.z=l):u.t="s";break;case"Boolean":u.t="b";break;case"Date":case"DateTime":u.t="d",u.z=l;break;default:u.t="s"}u.s={alignment:{horizontal:"top"}},u.v=s.value,i[c]=u}}return n.s.c<1e7&&(i["!ref"]=XLSX.utils.encode_range(n)),i},Pe.s2ab=function(t){for(var e=new ArrayBuffer(t.length),i=new Uint8Array(e),n=0;n!=t.length;++n)i[n]=255&t.charCodeAt(n);return e},Yt.FileExport=Pe,K=zt=zt||{},Ht=K.DialogBase,C(Ie,Ht),Ie.prototype.dialogButtons=function(){var t=this;return[{text:"OK",click:function(){t.dialogClose()},icons:{primary:"fa fa-check"}}]},Ie.prototype.renderTemplate=function(){return t("Are you sure you want to delete this item?")},Ie.ShowError=function(t,e){new Ie(_.extend({callback:_.isFunction(e)?e:_.noop},t?{renderTemplate:function(){return t}}:{}))},K.ErrorDialog=Ie,Kt=zt=zt||{},Wt=m.View,C(ke,Wt),ke.prototype.initializeEvents=function(){this.listenTo(this.appViewModel,"change:"+this.EXPORT_PROPERTY_OBJECT+this.EXPORT_PROPERTY_KEYS.concat(" change:"+this.EXPORT_PROPERTY_OBJECT),this.displayChoiceLinkButtons),this.$lnkCsvExport.click(_.bind(this.fileExport,this,".csv")),this.$lnkExcelExport.click(_.bind(this.fileExport,this,".xlsx")),this.$lnkFullExport.click(_.bind(this.apiExport,this)),this.$lnkDownloadScreenshot.click(_.bind(this.downloadImage,this))},ke.prototype.apiExport=function(){var e=this,i=this.getExportConfig(),i=Kt.ExportTools.getExportFileName(i.fileName,i.altFileName,"FullExport"),n=$("<span />").addClass("export-spinner fa fa-spinner fa-pulse").attr("title",t("Download in progress")).appendTo(this.$lnkFullExport);e.$lnkFullExport.addClass("export-in-progress"),e.api.exportData(this.appViewModel.get(e.DATA_SOURCE_PROPERTY),function(){n.remove(),e.$lnkFullExport.removeClass("export-in-progress")},{exportName:i})},ke.prototype.displayChoiceLinkButtons=function(){var t=!1,e=!1,i=this.appViewModel.get(this.EXPORT_PROPERTY_OBJECT);i&&(i.changed&&(t=!0),i.ShowExportCsvButton||i.ShowExportExcelButton||i.ShowFullExportButton||i.ShowScreenshot&&!this.isIE?(this.$lnksExport.hasClass("link-disabled")&&t&&(e=!0),this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!i.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!i.ShowExportExcelButton),this.$lnkFullExport.toggleClass("link-disabled",!i.ShowFullExportButton),this.$lnkDownloadScreenshot.toggleClass("link-disabled",!(i.ShowScreenshot&&!this.isIE))):(this.$lnksExport.addClass("link-disabled"),t&&(e=!0)),i.ShowExportCsvButton||i.ShowExportExcelButton||i.ShowFullExportButton||i.ShowScreenshot&&!this.isIE?this.trigger("enable-links"):this.trigger("disable-links"),e&&this.trigger("redraw-chart"))},ke.prototype.downloadImage=function(){var e=this.getFileName(),e=_.isString(e)&&e.length?e:"Screenshot";e+=".png",this.generateImage(function(t){Kt.Tools.fileSave(e,t)})},ke.prototype.generateImage=function(t){var n,o,e,i,r=document.createElement("canvas"),s=r.getContext("2d"),a=new Image,l=this.getSvgNode();function u(t){var i=document.defaultView.getComputedStyle(t,"");try{return i.cssText||Array.from(i).reduce(function(t,e){return t+e+": "+i[e]+"; "},"").trim()}catch(t){return""}}i=l.getBoundingClientRect(),n=Math.round(i.height),o=Math.round(i.width),r.width=o,r.height=n,r.style.display="block",l.style.width=o,l.style.height=n,i=function(t){var t=function(t){var e=t,t=t.cloneNode(!0);t.style.cssText=u(e);for(var i=e.getElementsByTagName("*"),n=t.getElementsByTagName("*"),o=i.length;o--;){var r=i[o];n[o].style.cssText=u(r)}return t}(t),e=(new XMLSerializer).serializeToString(t);if(e=(e=(e=e.replace(/<svg/,'<svg width="'+o+'" height="'+n+'"')).replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href"),/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))for(var i=void 0;i=/(<rect[^>]*) style="[^>]*"([^>]*>)/.exec(e);)e=e.replace(i[0],i[1]+i[2]);return e}(l),this.isIE?alert("This feature is not supported in your browser"):(s.clearRect(0,0,o,n),s.fillStyle=function t(e){var i=document.defaultView.getComputedStyle(e)["background-color"];return/^rgb\(/.test(i)?i:t(e.parentNode)}(l),s.fillRect(0,0,o,n),i=new Blob([i],{type:"image/svg+xml;charset=utf-8"}),e=URL.createObjectURL(i),a.onload=function(){URL.revokeObjectURL(e),s.drawImage(a,0,0),r.toBlob(t)},a.src=e)},ke.prototype.getButtonSettings=function(){},ke.prototype.getFileName=function(){var t=this.getExportConfig(),e="";return e=_.isObject(t)&&(_.isArray(t.fileName)&&t.fileName.length||t.altFileName)?Kt.ExportTools.getExportFileName(t.fileName,t.altFileName,""):e},ke.prototype.remove=function(){return this.$lnkCsvExport.off(),this.$lnkExcelExport.off(),this.$lnkFullExport.off(),this.$lnkCopyScreenshot.off(),this.$lnkDownloadScreenshot.off(),m.View.prototype.remove.apply(this,arguments)},ke.prototype.showExportError=function(t){t=t||"Export of .csv or .xlsx for pivot charts is not supported.";Kt.ErrorDialog.ShowError(t)},K=ke,(Kt.FileExporterView=K).prototype.SETTINGS=["api","appViewModel"],Qt=zt=zt||{},Ae.resolveChartColumnFormatAndType=function(t,e,i){var n=Ae.CHARTS_DATA_FORMAT_MAP[e],o=!!Ae.CHARTS_DATE_FORMAT_MAP[n],r=8===i||9===i,s=11<i&&i<20,a=3<i&&i<10;return 3===i||i<1||19<i?(i=11,n="TO_STRING",t="String"):void 0===(n=!o&&!r&&-1!==n.indexOf(".")?n.split(".")[0]:n)?(console.log("Invalid format: "+n+" or kdbType: "+i+". Exporting with default formats as String type"),n="",t="String"):("String"===t?n="":(!s||"Number"!==t&&o)&&(s||!o&&"Date"!==t)?"Number"!==t||a||(t="String"):(t="String",n="",console.log("!ExportTools format mismatch, using default format.Params, value kdbType : "+i+", col type: "+t+", format: "+e)),"Date"===t&&o&&(t=Ae.getTemporalTypeFromFormat(n)),0===n.indexOf("SmartNumber")&&(t="String")),{dataType:t=1===i?"Boolean":t,dataFormat:n,dataKdbType:i}},Ae.getExportFileName=function(t,e,i){return t=(t=(t=t&&_.isObject(t)?_.map(t,function(t){return(t=null===(t=t.FileNamePart)||_.isObject(t)?"":t).toString()}).join(""):t)||(e||Ae.getDefaultExportFileName(i))).replace(/:/g,"-").replace(/[^\w \.\-]/g,"")},Ae.getDefaultExportFileName=function(t){function e(t){return t=1===(t=""+t).length?"0"+t:t}var i=t?t+"_":"",n=new Date,o=n.getMonth()+1,t=n.getDate();return i+n.getFullYear()+e(o)+e(t)},Ae.onQueryChange=function(e,i){var n;e&&(n=e.get("_dataType"),e=e.get("_subscriptionType"),"virtual"===n||"streaming"===e?(i.toggleClass("events-disabled",!0),i.attr("title",t("Full export is not supported in Virtual and Streaming queries"))):(i.toggleClass("events-disabled",!1),i.attr("title",t("Download the full dataset from the server"))))},Ae.openFileExportDialog=function(t){var e,i=t,t={};try{if(!(4<=_.keys(i).length))throw"Incorrect number of FileExport parameters expected 5, got: "+i.length;if(i.configSets&&_.keys(i.configSets).length)t.configSets=i.configSets;else{if(!(i.dataSet&&_.isArray(i.dataSet)&&_.isObject(i.dataSet[0])))throw"Missing or invalid dataSet parameter";if(t.dataSet=i.dataSet,!i.metaData||!_.isArray(i.metaData))throw"Missing or invalid metaData parameter";if(e=i.metaData,!_.every(e,function(t){var e=0===_.difference(_.keys(t),["colId","dataType","dataKdbType","dataFormat","hideTrailingZeroes","prefix","suffix","colName"]).length,t=0<t.dataKdbType&&t.dataKdbType<20&&3!==t.dataKdbType;return e&&t}))throw"Invalid metaData properities.";t.metaData=i.metaData}if(void 0===i.fileFormat||!_.isString(i.fileFormat)||!_.includes([".xlsx",".xls",".csv"],i.fileFormat))throw"Invalid file format property";if(t.fileFormat=i.fileFormat,void 0===i.fileName||!_.isString(i.fileName))throw"Invalid file name property";if(t.fileName=i.fileName,void 0===i.workSheetTitle||!_.isString(i.workSheetTitle))throw"Invalid workSheetTitle property";t.workSheetTitle=i.workSheetTitle,void 0!==i.csvExportDelimiter&&_.isString(i.csvExportDelimiter)&&(t.csvExportDelimiter=i.csvExportDelimiter),new Qt.FileExport(t).showDialog()}catch(t){console.error("FileConverterTools validation error: ",t)}},Ae.getTemporalTypeFromFormat=function(t){var e,i="";return t&&(e=!!/[M,Y,D,d,Q]/.test(t),t=!!/[H,h,k,m,S,s]/.test(t),e?i=t?"DateTime":"Date":t&&(i="Time")),i},Ae.regExValidateColumnIDs=function(t,e){var t=0==t.indexOf("/")?t.substring(1):"^"+t.replace(/\*/g,"(.*)")+"$",i=new RegExp(t);return _.filter(e,function(t){return t.match(i)})},Ae.FileExporterView=Qt.FileExporterView,Ae.CHARTS_DATETIME_FORMAT_MAP={"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss":"YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss":"YYYY-MM-DD kk:mm:ss","YYYY-MM-DD HH:mm:ss.SSS":"YYYY-MM-DD HH:mm:ss.SSS","YYYY-MM-DD HH:mm:ss.SSSSSS":"YYYY-MM-DD HH:mm:ss.SSSSSS","YYYY-MM-DD HH:mm:ss.SSSSSSSSS":"YYYY-MM-DD HH:mm:ss.SSSSSSSSS"},Ae.TIME_FORMAT_MAP={"HH:mm":"HH:mm","HH:mm:ss":"HH:mm:ss","hh:mm:ss":"hh:mm:ss","kk:mm:ss":"kk:mm:ss","hh:mm:ss.SS":"hh:mm:ss.SS","HH:mm:ss.SSS":"HH:mm:ss.SSS","HH:mm:ss.SSSSSS":"HH:mm:ss.SSSSSS","HH:mm:ss.SSSSSSSSS":"HH:mm:ss.SSSSSSSSS","mm:ss":"mm:ss","kk:mm":"kk:mm","mm:ss.SS":"mm:ss.SS","mm:ss.SSS":"mm:ss.SSS","mm:ss.SSSSSS":"mm:ss.SSSSSS","mm:ss.SSSSSSSSS":"mm:ss.SSSSSSSSS",ss:"ss","ss.SSS":"ss.SSS","ss.SSSSSS":"ss.SSSSSS","ss.SSSSSSSSS":"ss.SSSSSSSSS"},Ae.DATE_FORMAT_MAP={"YYYY-MM-DD":"YYYY-MM-DD","DD.MM.YYYY":"DD.MM.YYYY","YYYY-MMM-DD":"YYYY-MMM-DD","YYYY-MMMM-DD":"YYYY-MMMM-DD","YYYY-MM":"YYYY-MM","YYYY-MMM":"YYYY-MMM","YYYY-MMMM":"YYYY-MMMM","MM/DD/YYYY":"MM/DD/YYYY","DD/MM/YYYY":"DD/MM/YYYY","D/M/YYYY":"D/M/YYYY","M/D/YYYY":"M/D/YYYY","D/M/YY":"D/M/YY","M/D/YY":"M/D/YY","D MMM":"D MMM","D MMM YYYY":"D MMM YYYY","MMM D":"MMM D","MMM DD":"MMM DD","MMM Do":"MMM Do","MMM D, YYYY":"MMM D, YYYY","MM/YYYY":"MM/YYYY","M/YY":"M/YY","MMM YYYY":"MMM YYYY"},Ae.CHARTS_DATE_FORMAT_MAP=_.extend({},Ae.DATE_FORMAT_MAP,Ae.TIME_FORMAT_MAP,Ae.CHARTS_DATETIME_FORMAT_MAP),Ae.CHARTS_NUMBERS_FORMAT_MAP={"no decimal":"0","No Decimal Point":"0",0:"0",1:"#0.0","1 decimal":"#0.0","1 Decimal Points":"#0.0",2:"#0.00","2 decimal":"#0.00","2 Decimal Points":"#0.00",3:"#0.000","3 decimal":"#0.000","3 Decimal Points":"#0.000",4:"#0.0000","4 decimal":"#0.0000","4 Decimal Points":"#0.0000",5:"#0.00000","5 Decimal Points":"#0.00000",6:"#0.000000","6 Decimal Points":"#0.000000","no decimal + seperator":"#,##0","1 decimal + seperator":"#,##0.0","2 decimal + seperator":"#,##0.00","3 decimal + seperator":"#,##0.000","4 decimal + seperator":"#,##0.0000","Smart Number":"SmartNumber",Logarithmic:"","no format":""},Ae.CHARTS_DATA_FORMAT_MAP=_.extend({},Ae.CHARTS_DATE_FORMAT_MAP,Ae.CHARTS_NUMBERS_FORMAT_MAP),Qt.ExportTools=Ae,zt.BigInteger=D.BigInteger;K={language:$.cookie("dashboard-language")||"en",logLevel:$.cookie("dashboard-log-level")||1,theme:$.cookie("dashboard-theme")||"kx-darkroom",viewerTheme:$.cookie("dashboard-viewer-theme")||"kx-darkroom"};return $.cookie("dashboard-language",K.language,{expires:30,path:"/"}),$.cookie("dashboard-log-level",K.logLevel,{expires:30,path:"/"}),$.cookie("dashboard-theme",K.theme,{expires:30,path:"/"}),$.cookie("dashboard-viewer-theme",K.viewerTheme,{expires:30,path:"/"}),_.extend(m.History.prototype,{decodeFragment:function(t){return t}}),zt});