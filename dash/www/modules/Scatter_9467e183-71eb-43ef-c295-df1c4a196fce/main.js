define(["backbone","echarts","./lib/ecStat-custom.min","Handlebars","QuickBase","moment","xlsx","css!./css/app.css"],function(o,i,s,a,d,l,e){"use strict";var r,n=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),p=(h.app=a.template({compiler:[7,">= 4.0.0"],main:function(t,e,i,a,r){return'<div class="scatterplot-container">\n    <div class="notifications-panel hidden"></div>\n    <div class="tools-panel"></div>\n    <div class="chart-legends-container"></div>\n    <div class="chart-area"></div>\n    \x3c!-- Only used to store current last tooltip html --\x3e\n    <div class="tooltip" style="display: none"></div>\n</div>'},useData:!0}),h.legend=a.template({1:function(t,e,i,a,r){var o=null!=e?e:t.nullContext||{},n=i.helperMissing,s="function",l=t.escapeExpression;return'        <li>\n            <section class="chart-legend-icon">\n'+(null!=(t=i.if.call(o,null!=e?e.noSvg:e,{name:"if",hash:{},fn:t.program(2,r,0),inverse:t.program(4,r,0),data:r}))?t:"")+'            </section>\n            <section class="chart-legend-text" style="color:'+l(typeof(t=null!=(t=i.fontColor||(null!=e?e.fontColor:e))?t:n)==s?t.call(o,{name:"fontColor",hash:{},data:r}):t)+";font-size:"+l(typeof(t=null!=(t=i.fontSize||(null!=e?e.fontSize:e))?t:n)==s?t.call(o,{name:"fontSize",hash:{},data:r}):t)+'">\n                '+l(typeof(t=null!=(t=i.legendName||(null!=e?e.legendName:e))?t:n)==s?t.call(o,{name:"legendName",hash:{},data:r}):t)+"\n            </section>\n        </li>\n"},2:function(t,e,i,a,r){var o=null!=e?e:t.nullContext||{},n=i.helperMissing,s="function",l=t.escapeExpression;return'                    <i class="fa '+l(typeof(t=null!=(t=i.icon||(null!=e?e.icon:e))?t:n)==s?t.call(o,{name:"icon",hash:{},data:r}):t)+'" style="color:'+l(typeof(t=null!=(t=i.iconColor||(null!=e?e.iconColor:e))?t:n)==s?t.call(o,{name:"iconColor",hash:{},data:r}):t)+'"></i>\n'},4:function(t,e,i,a,r){var o;return"                    "+(null!=(o="function"==typeof(o=null!=(o=i.icon||(null!=e?e.icon:e))?o:i.helperMissing)?o.call(null!=e?e:t.nullContext||{},{name:"icon",hash:{},data:r}):o)?o:"")+"\n"},compiler:[7,">= 4.0.0"],main:function(t,e,i,a,r){return'<ul class="chart-legends">\n'+(null!=(r=i.each.call(null!=e?e:t.nullContext||{},e,{name:"each",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r}))?r:"")+"</ul>"},useData:!0}),h.tooltip=a.template({1:function(t,e,i,a,r){var o=null!=e?e:t.nullContext||{},n=i.helperMissing,s="function",l=t.escapeExpression;return"            <tr>\n                <td> \n"+(null!=(t=i.if.call(o,null!=e?e.noSvg:e,{name:"if",hash:{},fn:t.program(2,r,0),inverse:t.program(4,r,0),data:r}))?t:"")+"                <td>\n                    "+l(typeof(t=null!=(t=i.chartName||(null!=e?e.chartName:e))?t:n)==s?t.call(o,{name:"chartName",hash:{},data:r}):t)+': \n                </td>\n                </td>\n                <td style="padding-right: 10px; text-align: left;">\n                        '+l(typeof(t=null!=(t=i.layerDataFormatted||(null!=e?e.layerDataFormatted:e))?t:n)==s?t.call(o,{name:"layerDataFormatted",hash:{},data:r}):t)+"\n                </td>\n            </tr>\n"},2:function(t,e,i,a,r){var o=null!=e?e:t.nullContext||{},n=i.helperMissing,s="function",l=t.escapeExpression;return'                        <i class ="fa '+l(typeof(t=null!=(t=i.iconFa||(null!=e?e.iconFa:e))?t:n)==s?t.call(o,{name:"iconFa",hash:{},data:r}):t)+'" style="color:'+l(typeof(t=null!=(t=i.plotColor||(null!=e?e.plotColor:e))?t:n)==s?t.call(o,{name:"plotColor",hash:{},data:r}):t)+'"></i>\n'},4:function(t,e,i,a,r){var o;return"                        "+(null!=(o="function"==typeof(o=null!=(o=i.svg||(null!=e?e.svg:e))?o:i.helperMissing)?o.call(null!=e?e:t.nullContext||{},{name:"svg",hash:{},data:r}):o)?o:"")+"\n"},compiler:[7,">= 4.0.0"],main:function(t,e,i,a,r){var o,n=null!=e?e:t.nullContext||{},s=i.helperMissing,l="function",p=t.escapeExpression;return'<table class="scatter-tooltip" style="'+p(typeof(o=null!=(o=i.fontSize||(null!=e?e.fontSize:e))?o:s)==l?o.call(n,{name:"fontSize",hash:{},data:r}):o)+'">\n    <thead>\n        <tr style="padding-right: 10px;">\n            <th> '+p(typeof(o=null!=(o=i.xLabel||(null!=e?e.xLabel:e))?o:s)==l?o.call(n,{name:"xLabel",hash:{},data:r}):o)+' </th>\n            <th> </th>\n        </tr>\n    </thead>\n    \x3c!-- TODO add scroll event to enable context scrolling --\x3e\n    <tbody style="display:block;overflow:hidden;'+p(typeof(o=null!=(o=i.maxHeight||(null!=e?e.maxHeight:e))?o:s)==l?o.call(n,{name:"maxHeight",hash:{},data:r}):o)+'">\n'+(null!=(r=i.each.call(n,null!=e?e.points:e,{name:"each",hash:{},fn:t.program(1,r,0),inverse:t.noop,data:r}))?r:"")+"    </tbody> \n</table>"},useData:!0}),h);function h(){}"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),a=1;a<arguments.length;a++){var r=arguments[a];if(null!=r)for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(i[o]=r[o])}return i},writable:!0,configurable:!0});var y=(u.setApiProperty=function(t,e,i,a){a?i.api.setProperty(t,e):(i.api.setProperty(t,e,{silent:!0}),i.onSettingsChange(((i={})[t]=e,i)))},u.renderSVGIcon=function(t,e){var i=u.hex2RGB(t.plotColor),e=e?e+"px":"12px",a='<svg height="'+e+'" width="'+e+'" viewbox="0 0 15 15" style="margin-right:5px">',r=i?"rgba("+i[0]+","+i[1]+","+i[2]+",0.8)":"rgba(79,106,166, 0.8)",o=r,n="80",s=t.legendIconCustom||"none";switch(s){case"circle":a=a+'<circle cx="7.5" cy="7.5" r="5" stroke="'+o+'" stroke-width="'+Math.min(1,1)+'" fill="'+r+'" />';break;case"diamond":a=a+'<path fill="'+r+'" stroke="'+o+'" stroke-width="'+Math.min(1,1)+'"  stroke-linecap="butt" stroke-linejoin="miter" opacity="'+n+'" d="M 0 7.5 L 7 3.5 L 14 7.5 L 7 11.5 Z" ></path>';break;case"rect":case"rectangle":a=a+'<rect style="fill:'+r+";stroke:"+o+";stroke-width:"+Math.min(1,1)+";stroke-linecap:butt stroke-linejoin:miter;opacity:"+n+'" x="0" y="3.5"  width="14" height="7.5" />';break;case"square":a=a+'<rect style="fill:'+r+";stroke:"+o+";stroke-width:"+Math.min(1,1)+";stroke-linecap:butt stroke-linejoin:miter;opacity:"+n+'" x="3.5" y="3.5"  width="7.5" height="7.5" />';break;case"roundRect":a=a+'<rect style="fill:'+r+";stroke:"+o+";stroke-width:"+Math.min(1,1)+";stroke-linecap:butt stroke-linejoin:miter;opacity:"+n+'" x="0" y="3.5" rx="2" ry="2" width="14" height="7.5" >';break;case"triangle":a=a+'<path fill="'+r+'" stroke="'+o+'" stroke-width="'+Math.min(1,1)+'"  stroke-linecap="butt" stroke-linejoin="miter" opacity="'+n+'" d="M 0 13 L 6 2 L 13 13 L 0 13 Z" ></path>';break;case"none":break;default:0===s.indexOf("path://")&&(s=s.replace("path://",'<path d="')+'"></path>',a=a.replace('viewbox="0 0 15 15"',"")),a+=s}return"none"===s?a="":a+="</svg>",a},u.compareKDBTimes=function(t,e){return t.i>e.i?1:t.i<e.i?-1:t.n>e.n?1:t.n<e.n?-1:0},u.convertPropertyIfMoment=function(t){t=rt.convertISODatetimeToKDBLikeObject(t);return rt.isKDBTemporal(t)?rt.convertKDBTemporalToMoment(t):t},u.calculateDataMinMax=function(t){for(var e=u.sortArrayAcs(t);null===e.slice(-1)[0];)e.pop();return[_.isNaN(Number(e[0]))?null:e[0],_.isNaN(Number(e.slice(-1)[0]))?null:e.slice(-1)[0]]},u.calculateMinMaxOffset=function(t){var e=Math.abs(Number(t[1])-Number(t[0])),t=String(e).split("."),e=t[0].length-2;return 1<t.length&&"0"===t[0]?(t=Number("0."+t[1]),t=1-Math.floor(Math.log(t)/Math.log(10)+1),1/Math.pow(10,t)):Math.pow(10,e)},u.expandNestedViewStates=function(t,i){var e=/([a-zA-Z]+)\.[0-9]+\./,a=Object.keys(t),r=[];if((r=_.every(a,function(t){var e=i.getPropertyMeta(a[0]);return e&&"viewstate"==e.type})?_.uniq(_.filter(_.map(a,function(t){t=e.exec(t);return t?t[1]:null}))):r).length){var o={};return _.each(r,function(t){return o[t]=i.getProperty(t)}),o}return t},u.focus2Array=function(t){var e,i=[],a=/"([^"]*)"/g,t=t.toString?t.toString():"",r=/^\[([^\]]*)]$/.exec(t);if(null!=r){if(/^(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*")(?:,"[^"\\]*(?:\\[\S\s][^"\\]*)*")*/.test(r[1]))for(;null!==(e=a.exec(r[1]));)i.push(_.map(e[1].split(","),function(t){return t.replace(/&#44;/g,",")}))}else i.push(t.split(","));return _.filter(i,function(t){return 0<(""+t).length})},u.hex2RGB=function(t){t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null},u.RGB2hex=function(t){return"#"+((1<<24)+(t[0]<<16)+(t[1]<<8)+t[2]).toString(16).slice(1)},u.clamp=function(t,e,i){return i<t?i:t<e?e:t},u.interpolateColor=function(t,e,i,a){for(var i=(i-e)/(t.length-1),e=this.clamp((a-e)/i,0,t.length-1),i=t[Math.floor(e)].type,t=t[Math.ceil(e)].type,r=this.hex2RGB(i),o=this.hex2RGB(t),n=e-Math.floor(e),s=r.slice(),l=0;l<3;l++)s[l]=Math.round(s[l]+n*(o[l]-r[l]));return this.RGB2hex(s)},u.getColumnKeysFromAxisString=function(e,t){e=0==e.indexOf("/")?e.substring(1):"^"+e.replace(/\*/g,"(.*)")+"$";try{var i=new RegExp(e);return t.getColumnNames().filter(function(t){return t.match(i)})}catch(t){return console.warn("Invalid regular expression: "+e+" : Nothing to repeat"),[]}},u.getFormatter=function(a,r,o,n){return"Number"===a||"Formatted Number"===a||"Smart Number"===a||"Datetime"===a||"Currency"===a||"SmartCurrency"===a?function(t){var e=t;if(null==(t=!("Smart Number"!==a&&"Formatted Number"!==a||_.isNumber(t))?_.isNumber(parseFloat(t))?parseFloat(t):t:t)||null==t)return"";if("Smart Number"===a)e=_.isNumber(t)?rt.smartFormatNumber(t,r):_.escape(t);else{if("Datetime"===a){var i=t;return l.isMoment(t)||l.isDuration(t)?t.format(n):rt.isKDBTemporal(t)?rt.convertKDBTemporalToMoment(t).format(n):("number"==typeof t&&(i=new Date(t)),rt.convertDateStringValueToMoment(i.toString()).format(n))}e="Formatted Number"===a&&t.toFixed?rt.formatNumber(t,r):t.toFixed?t.toFixed(r):_.escape(e)}if(o&&0<=e.toString().indexOf(".")){for(;"0"===e[e.length-1];)e=e.slice(0,-1);"."===e[e.length-1]&&(e=e.slice(0,-1))}return e}:"General"===a?function(t){return l.isMoment(t)||l.isDuration(t)?t.format():_.escape(t)}:"Boolean"===a?function(t){return _.escape(t)}:void 0},u.convertTempralToEchart=function(t,e){var i,a=u.TEMPORALFORMATMAP[e],r=rt.convertKDBTemporalToMoment({i:t,n:0,class:"12"+e});return 14===e||13===e?t:(12!==e&&15!==e&&r.add(1970,"y").add(1,"M").add(1,"d"),i=r.format(a),new Date(i).valueOf())},u.decimalRoundToFirstDigit=function(t){var e=Number(t),i=String(t).split(".");return 1<i.length&&(i=Number("0."+i[1]),i=1-Math.floor(Math.log(i)/Math.log(10)+1),e=Number(parseFloat(String(t)).toFixed(i))),e},u.filterTooltipArraySeries=function(t){var e=[],i={};return _.each(t,function(t){i[t.seriesId]=i[t.seriesId]||[],-1===i[t.seriesId].indexOf(t.dataIndex)&&(i[t.seriesId].push(t.dataIndex),e.push(t))}),e},u.getLinearRegresionLineCoords=function(e,i,t){var a=u.linearRegression(e,i),r=void 0!==t.XAxis.min?t.XAxis.min:t.XAxis[0],o=void 0!==t.XAxis.max?t.XAxis.max:t.XAxis[1],n=void 0!==t.YAxis.min?t.YAxis.min:t.YAxis[0],s=void 0!==t.YAxis.max?t.YAxis.max:t.YAxis[1],l=0===a.slope,p=[r,a.slope*r+a.intercept],h=[o,a.slope*o+a.intercept],t="";try{t=u.linearRegressionFormulaStr(r,o,a.slope,a.intercept,!1)}catch(t){d.Log.Warn("Scatter: can not generate formula, check axis data type matching data ",e,i)}o={startXY:p,endXY:h,formula:t};if(l)console.log("! Median Line slope is 0, reverting back to x min/max");else{t=[(n-a.intercept)/a.slope,n],l=[(s-a.intercept)/a.slope,s];try{o.formula=u.linearRegressionFormulaStr(n,s,a.slope,a.intercept,!0)}catch(t){d.Log.Warn("Scatter: can not generate formula, check axis data type matching data ",e,i)}(p[1]<n||s<p[1])&&(o.startXY=t),s<h[1]&&(o.endXY=l)}return o},u.isDecimal=function(t){return-1!==String(t).indexOf(".")},u.linearRegression=function(t,e){for(var i={},a=e.length,r=0,o=0,n=0,s=0,l=0,p=0;p<e.length;p++)r+=t[p],o+=e[p],n+=t[p]*e[p],s+=t[p]*t[p],l+=e[p]*e[p];return i.slope=(a*n-r*o)/(a*s-r*r),i.intercept=(o-i.slope*r)/a,i.r2=Math.pow((a*n-r*o)/Math.sqrt((a*s-r*r)*(a*l-o*o)),2),i},u.pump=function(i){if(null!=i&&null!=i){if(!_.isObject(i))return i;var t=Object.getPrototypeOf(i);if(_.isObject(i)&&t!==Object.prototype&&t!==Array.prototype)return i;if(t===Array.prototype)return i.map(u.pump);var a=/^(\d+)((?:\.\w+)+)$/;if(Object.keys(i).every(function(t){return a.test(t)}))return Object.keys(i).map(function(t){var e=a.exec(t);return{index:Number(e[1]),tail:e[2].substring(1),value:i[t]}}).reduce(function(t,e){var i={};return i[e.index]={},i[e.index][e.tail]=e.value,$.extend(!0,t,u.pump(i))},[]);var r={greedy:/^(\w+)((?:\.\w+)*)$/,nonGreedy:/^(\w+)((?:\.\w+)+)$/};return Object.keys(i).some(function(t){return r.nonGreedy.test(t)})?Object.keys(i).map(function(t){var e=r.greedy.exec(t);return{head:e[1],tail:""!==e[2]?e[2].substring(1):null,value:i[t]}}).reduce(function(t,e){var i={};return null!==e.tail?(i[e.head]={},i[e.head][e.tail]=e.value):i[e.head]=e.value,$.extend(!0,t,u.pump(i))},{}):_.mapValues(i,u.pump)}},u.linearRegressionFormulaStr=function(t,e,i,a,r){t=u.isDecimal(t)?u.decimalRoundToFirstDigit(t):t,e=u.isDecimal(e)?u.decimalRoundToFirstDigit(e):e,i=u.isDecimal(i)?u.decimalRoundToFirstDigit(i):i,a=u.isDecimal(a)?u.decimalRoundToFirstDigit(a):a;return r?"[x = ("+t+" - ("+a+")) / "+i+", y = "+t+"]\n[x = ("+e+" - ("+a+")) / "+i+", y = "+e+"]":"[x = "+t+", y = (("+i+" * "+t+") + ("+a+")]\n[x = "+e+", y = (("+i+" * "+e+") + ("+a+")]"},u.replaceViewStates=function(i,t,s,l){var p=function(t,e){return function i(t,e,a){a=a?a+".":"";e+="";var r=l.getPropertyMeta(a+e);{if(r&&"data"===r.type)return t;if(r&&"viewstate"===r.type){var o=(a+e).split("."),n=o.pop(),o=o.join(".");return s(o,n,t,r)}return!_.isArray(t)&&!_.isObject(t)||t.has&&t.has("_dataSource")&&t.has("_dataType")?t:(a+=e,p=function(t,e){return i(t,e,a)},(h=_.isArray(t)?_.map:_.mapValues)(t,p))}}(t,e,i||"")},h=_.isArray(t)?_.map:_.mapValues;return h(t,p)},u.replaceViewStatesWithValue=function(t,e,i){return u.replaceViewStates(t,e,function(t,e,i,a){return a.value!==i&&console.warn("viewModel value has changed"),a.value},i)},u.replaceViewStatesWithModel=function(t,e,r){return u.replaceViewStates(t,e,function(t,e,i,a){if(i instanceof o.Model&&i.get("_viewType"))return i;e=r.getProperty(t)[e];return _.isUndefined(i)?void 0:(e.get("value")!==i&&(console.warn("viewModel value has changed"),e.set("value",i)),e)},r)},u.alpha=function(t,e){var i=this.hex2RGB(t);return i?"rgba("+i[0]+","+i[1]+","+i[2]+","+e/100+")":new Color(t).alpha(e/100).rgbaString()},u.colorFactory=function(t,e,i){void 0===e&&(e="#4f6aa6"),void 0===i&&(i=80);var a={};return a[t+"Color"]={title:t.replace("Point","").replace("Hover","Hover ").replace("Border","Border ").replace("Background","Background ")+"Color",type:"gradient",default:e,options:{gradient:!1}},a[t+"Opacity"]={title:t.replace("Point","").replace("Hover","Hover ").replace("Border","Border ").replace("Background","Background ")+"Opacity",default:i,minimum:0,maximum:100,type:"number",step:1,format:"range"},a},u.backgroundFactory=function(t){return u.colorFactory(t+"Background")},u.borderFactory=function(t){var e={};return e[t+"BorderWidth"]={title:t.replace("Point","").replace("Hover","Hover ")+" Border Width",type:"number",format:"range",default:2.01,minimum:.01,maximum:10.01},$.extend(!0,{},u.colorFactory(t+"Border"),e)},u.radiusFactory=function(t){var e={};return e[t+"Radius"]={title:t.replace("Point","").replace("Hover","Hover ").replace("Hit","Hit ")+"Radius",type:"number",format:"range",default:0,minimum:0,maximum:10},e},u.sortArrayAcs=function(t){return _.clone(t).sort(function(t,e){return Number(null===t)-Number(null===e)||+(e<t)||-(t<e)})},u.typeFactory=function(t){return{_Type:{type:"string",default:t,options:{hidden:!0}}}},u.TEMPORALFORMATMAP={12:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",13:"YYYY-MM",14:"YYYY-MM-DD",15:"YYYY-MM-DD HH:mm:ss.SSS",16:"YYYY-MM-DD HH:mm:ss.SSSSSSSSS",17:"YYYY-MM-DD HH:mm",18:"YYYY-MM-DD HH:mm:ss",19:"YYYY-MM-DD HH:mm:ss.SSS"},u.hash=function(t){var e=Date.now().valueOf()+t.toString();if(Array.prototype.reduce)return e.split("").reduce(function(t,e){return(t=(t<<5)-t+e.charCodeAt(0))&t},0)+"";var i=0;if(0===e.length)return i+"";for(var a=0;a<e.length;a++){i=(i<<5)-i+e.charCodeAt(a);i&=i}return i+""},u);function u(){}var c,g=(c=o.DeepModel,n(m,c),m.prototype.onAxisLabelPropChanged=function(t,e){var i=this,a=t.changed;_.each(_.keys(a),function(t){a.Labels&&0===a.Labels.Interval&&(i.axisForceResetChart=!0)}),this.trigger("updateChartAxis"),this.axisForceResetChart=!1},m.prototype.onAxisPropChanged=function(t,e){this.trigger("updateChartAxis")},m.prototype.getLabel=function(){return this.get("_Hidden._Label")},m.prototype.getType=function(){return this.get("_Hidden._Type")},m.prototype.isNumerical=function(){return _.includes(["linear","logarithmic"],this.get("_Hidden._Type"))},m.singular=function(t){return t.replace("e","i")},m.plural=function(t){return t.replace("i","e")},m.camelCase=function(t){return t.replace("X","x").replace("Y","y")},m);function m(t,e,i,a){var r=c.call(this,t)||this;r.axisForceResetChart=!1,r.api=e,r.key=i,r.appView=a;a=["change:_Hidden._Type change:DisplayAxis change:Position change:Title change:Range.RuleMin change:Range.RuleMax change:SplitLine"].join("");return r.listenTo(r,a,r.onAxisPropChanged),r.listenTo(r,"change:Labels",r.onAxisLabelPropChanged),r.listenTo(r,"change:Range.UseMinMax",function(t,e){var i=t.changed,a=t.key,i=i.Range;1===_.keys(i).length?(i=i.UseMinMax,a=m.plural(a)+"."+t.collection.findIndex(t)+".Range.UseDataRange",r.api.setProperty(a,i),i===t.get("Range.UseDataRange")&&r.onAxisPropChanged(t,e)):r.onAxisPropChanged(t,e)}),r.listenTo(r,"change:Range.UseDataRange",function(t,e){var i=t.changed;t.key,i.Range;r.onAxisPropChanged(t,e)}),r}var f,x=(f=o.Collection,n(C,f),C.prototype.modelId=function(t){return t._Hidden._AxisId+t._Hidden._Type},C);function C(){var t=null!==f&&f.apply(this,arguments)||this;return t.model=g,t}var b=["Chart1","Chart2","Chart3","Chart4"],S=(A.setDefaultAxisColumns=function(o,n){var s=n[0],l=1<n.length?_.clone(n).splice(1):[s];_.each(b,function(t,e){var i="Charts."+t+".XAxisData",a="Charts."+t+".YAxisData",r=_.get(o,i),t=_.get(o,a),e=l[e]||l[l.length-1];r&&_.includes(n,r)||_.set(o,i,s),t&&_.includes(n,t)||_.set(o,a,e)})},A.quartetAddAxis=function(a,t,e,i){var r,o=e.replace("root.","").split("."),n=o[0];1===o.length&&(o="XAxes"===n?"_PossibleXAxes":"_PossibleYAxes",e=a[e],r=[],_.each(e,function(t,e){var i=n.replace("e","i")+" "+(e+1),t=t._Hidden._AxisId;r.push(i),_.set(a,n+"["+e+"]_Hidden._Index",e),_.set(a,n+"["+e+"]_Hidden._Label",i),t||_.set(a,n+"["+e+"]_Hidden._AxisId",_.uniqueId("axis_"))}),_.set(a,"Charts._Hidden."+o,r)),i(a,t)},A.data=function(i,a,t,r){var o="matrix"===i.Basics.ChartType,n=i.MatrixCols;"root"===t||"Basics.Data"===t||"Basics.ChartType"===t?("root"!==t&&"Basics.ChartType"!==t||(a=A.chartType(i,a,t,r)),i.Basics.Data?i.Basics.Data.getMeta(function(t){var t=_.fromPairs(_.map(t.columns.collection.models,function(t){return[t.get("id"),t.toJSON()]})),e=_.keys(t);i.possibleKeys=e,o?n.length&&_.each(n,function(t){_.includes(e,t.MatrixColId)||(t.MatrixColId="")}):A.setDefaultAxisColumns(i,e),r(i,a)}):(i.possibleKeys=[],r(i,a))):"XAxes"===t||"YAxes"===t?A.quartetAddAxis(i,a,t,r):r()},A.chartType=function(t,e,i,a){return"matrix"===t.Basics.ChartType?(e.properties.Legend.options.hidden=!0,e.properties.XAxes.options.hidden=!0,e.properties.YAxes.options.hidden=!0,e.properties.Charts.options.hidden=!0,e.properties.MatrixCols.options.hidden=!1,e.properties.Style.properties.AxisPadding.options.hidden=!1,e.properties.MatrixXAxes.options.hidden=!1,e.properties.MatrixYAxes.options.hidden=!1):(e.properties.MatrixCols.options.hidden=!0,e.properties.Style.properties.AxisPadding.options.hidden=!0,e.properties.MatrixXAxes.options.hidden=!0,e.properties.MatrixYAxes.options.hidden=!0,e.properties.Legend.options.hidden=!1,e.properties.XAxes.options.hidden=!1,e.properties.YAxes.options.hidden=!1,e.properties.Charts.options.hidden=!1),e},A.matrixColumns=function(t,e,i,a){"root.MatrixCols"===i?(_.each(t,function(t,e){t._Hidden._ColId||(t._Hidden._ColId=_.uniqueId("col_")),t._Hidden._Index=e}),a(t,e)):a()},A);function A(){}var D=["YYYY-MM-DD","YYYY-MMM-DD","YYYY-MMMM-DD","YYYY-MM","YYYY-MMM","YYYY-MMMM","MMM DD","MMM Do","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss","hh:mm:ss","HH:mm:ss","kk:mm:ss","hh:mm:ss.SS","hh:mm","HH:mm","kk:mm","mm:ss","mm:ss.SS"],v=["Verdana","fontawesome","Arial","Helvetica","Times","Courier"],M={Chart1:{PlotColor:"#DB5F5B"},Chart2:{PlotColor:"#5a6d7b"},Chart3:{PlotColor:"#86BEC4"},Chart4:{PlotColor:"#EA9F85"}},O=["linear","category","logarithmic","time"],T="XAxis 1",L="YAxis 1",F='\n<table class="scatter-tooltip" style="{{fontSize}}">\n  <thead>\n    <tr style="padding-right: 10px;">\n      <th>\n        {{xLabel}}\n      </th>\n      <th></th>\n    </tr>\n  </thead>\n  {{#each points}}\n    <tr>\n      <td>\n        {{#if noSvg}}\n            <i class="fa {{iconFa}}" style="color:{{plotColor}}"></i>\n        {{else}}\n            <svg width="12" height="12">\n                <rect width="12" height="12" style="fill: {{plotColor}}"></rect>\n            </svg>\n        {{/if}}\n      </td>\n      <td>\n        {{chartName}}\n        :\n      </td>\n      <td style="padding-right: 10px; text-align: left;">\n        {{layerData}}\n      </td>\n    </tr>\n  {{/each}}\n</table>\n',Y=(R.getComponentDefinition=function(t){var e,i,a={id:13,componentName:"Scatter",componentDescription:"Scatter Plot Matrix and Anscombe's quartet",appKey:"Scatter",ghostViewThumb:null,buildViewThumb:null,appArgs:{quickStart:[{path:"Basics.Data"}],json:{version:"4.6.0",Basics:{Data:"",ChartType:"matrix",LargeDataThreshold:500},Overlay:{Display:!1,TooltipAxisPointerType:"dashed",FillOpacity:80,FontSize:12,FixedPosition:!1,Snap:!0,UseCustomTooltip:!1,CustomTooltip:F},Charts:P.Charts,MatrixCols:[{MatrixColId:"",ColumnTitle:"",Precision:2,HideTrailingZeroes:!1,DateFormat:"YYYY-MM-DD",Prefix:"",Suffix:"",_Hidden:{_ColId:"col_00001",_Index:0}}],MatrixXAxes:R.axisCommonOptions("XAxis",!0),MatrixYAxes:R.axisCommonOptions("YAxis",!0),XAxes:P.XAxes,YAxes:P.YAxes,Legend:P.Legend,Style:{AxisPadding:5,MatrixBrushTool:void 0,advanced:""},possibleKeys:[""],possibleXAxes:[T],possibleYAxes:[L]},schema:{type:"object",title:"Properties",_transform:S.data,properties:{possibleKeys:{type:"readOnlyArray",propertyOrder:1,format:"table",items:{type:"string"},default:["sym"],options:{collapsed:!0,hidden:!0}},possibleXAxes:{type:"readOnlyArray",propertyOrder:1,format:"table",items:{type:"string"},default:[T],options:{collapsed:!0,hidden:!0}},possibleYAxes:{type:"readOnlyArray",propertyOrder:1,format:"table",items:{type:"string"},default:[L],options:{collapsed:!0,hidden:!0}},Basics:{propertyOrder:2,type:"object",title:"Basics",options:{collapsed:!1},properties:{Data:{propertyOrder:1,type:"data",title:"Data Source"},ChartType:{propertyOrder:10,type:"string",title:"Chart Type",default:"matrix",enum:["quartet","matrix"]},LargeDataThreshold:{type:"number",propertyOrder:20,title:"Large Data Threshold",format:"number",default:500}}},Overlay:{propertyOrder:2,type:"object",title:"Overlay",options:{collapsed:!0},properties:{Display:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:!1},TooltipAxisPointerType:{propertyOrder:10,type:"string",title:"Type",default:"cross",enum:["solid","dashed","dotted"]},Snap:{propertyOrder:11,type:"boolean",title:"Snap To Label Point",format:"checkbox",default:!0},FillOpacity:{propertyOrder:12,type:"number",title:"Tooltip Opacity",format:"range",minimum:0,maximum:100,default:80},FontSize:{propertyOrder:25,type:"number",format:"number",title:"Tooltip Font Size",default:12},FixedPosition:{type:"boolean",propertyOrder:200,format:"checkbox",title:"Fixed Position",default:!1},UseCustomTooltip:{type:"boolean",propertyOrder:319,format:"checkbox",title:"Use Custom Tooltip",default:!1},CustomTooltip:{propertyOrder:666,type:"tooltipTemplate",disableTree:!0,title:"Custom tooltip",data:["series","values"],default:F}}},MatrixCols:{type:"array",propertyOrder:5,title:"Data columns",format:"object",uniqueItems:!1,options:{collapsed:!0,hidden:!1,reset:!0},items:{headerTemplate:"Col {{i1}}",type:"object",properties:{MatrixColId:{propertyOrder:1,title:"Column Name",type:"customDropdown",data:"possible_columns",default:"",watch:{possible_columns:"root.possibleKeys"}},ColumnTitle:{propertyOrder:2,type:"string",title:"Column Axis Name",default:""},Precision:{type:"number",propertyOrder:10,title:"Decimal Places",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{propertyOrder:15,type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},DateFormat:{propertyOrder:20,type:"string",title:"Date/Time format",enum:D,default:"YYYY-MM-DD"},Prefix:{type:"string",propertyOrder:21,default:""},Suffix:{type:"string",propertyOrder:22,default:""},_Hidden:{type:"object",options:{hidden:!0},properties:{_ColId:{type:"string",options:{hidden:!0}},_Index:{type:"number",options:{hidden:!0}}}}}},_transform:S.matrixColumns},Charts:{propertyOrder:5,type:"object",title:"Charts",id:"chartsObj",options:{hidden:!0},properties:_.extend(!0,{},R.chartFactory(),{_Hidden:{type:"object",options:{hidden:!0},properties:{_PossibleXAxes:{type:"array",items:{type:"string"},options:{hidden:!0}},_PossibleYAxes:{type:"array",items:{type:"string"},options:{hidden:!0}}}}})},MatrixXAxes:R.matrixAxesFactory("XAxes",8),MatrixYAxes:R.matrixAxesFactory("YAxes",9),XAxes:R.axesFactory("XAxes",10),YAxes:R.axesFactory("YAxes",11),Legend:{propertyOrder:15,type:"object",title:"Legend",options:{collapsed:!0,hidden:!0},properties:{Display:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:void 0},ItemGap:{propertyOrder:5,type:"number",title:"Legend Gap",default:void 0},LegendPosition:{type:"string",title:"Legend Position",default:"top",enum:["top","bottom","left","right"]},SelectedMode:{propertyOrder:20,type:"string",title:"Legend Selection Mode",default:void 0,enum:["single","multiple","disabled"]},UseHtml:{propertyOrder:30,type:"boolean",title:"Use Html Legends",format:"checkbox",default:void 0,options:{hidden:!0}}}},Style:{propertyOrder:100,type:"object",title:"Style",options:{collapsed:!0},properties:{AxisPadding:{propertyOrder:10,type:"number",title:"Matrix Axis Padding",minimum:0,maximum:100,default:5,options:{hidden:!1}},MatrixBrushTool:{propertyOrder:30,type:"boolean",title:"Matrix Enable Brush Tools",format:"checkbox",default:void 0,options:{hidden:!0}},advanced:{type:"css",title:"Advanced CSS",propertyOrder:2,default:""}}}}}}};if(0<_.keys(t.settingsModel.attributes).length)for(i=R.upgrades.indexOf(_.find(R.upgrades,{version:t.settingsModel.get("version")}))+1;i<R.upgrades.length;i+=1)(e=R.upgrades[i]).fn(t.settingsModel),t.settingsModel.set("version",e.version);return a},R.chartsOptions=function(t){return{XAxisID:T,XAxisData:"",YAxisID:L,YAxisData:"",DisplayChart:!0,Legend:{LegendName:"",Icon:"",IconFa:"fa-circle",LegendColor:""},Radius:{FixedRadius:!0,FixedSize:10,RadiusData:"",RadiusScaling:1},PlotStyles:{PlotColor:M[t].PlotColor,PlotShape:"circle"},MarkLine:{DisplayLine:!0,Animation:!1,ForceSpan:!1,LineType:"solid",LineWidth:1,LineColor:"",FormulaPosition:"end",ShowLineFormula:!1,ShowLineTooltip:!0,MarkLineFontSize:12},Crosshair:{Format:"General",Precision:2,HideTrailingZeroes:!1,Interval:0,DateFormat:"YYYY-MM-DD"}}},R.axisCommonOptions=function(t,e){var i={Labels:{LabelFont:"Verdana",LabelFontSize:12,LabelFontStyle:"normal",LabelRotate:e?30:0,LabelColor:"",LabelSize:2},SplitLine:{LineStyle:"solid",LineColor:"",LineOpacity:10},Title:{AxisTitleSize:12,NameColor:"",TitleOffset:20}},t={Position:"XAxis"===t?"bottom":"left",DisplayAxis:!0,Labels:{Format:"General",DisplayLabel:!0,Precision:2,HideTrailingZeroes:!1,Interval:0,DateFormat:"YYYY-MM-DD",Prefix:"",Suffix:""},Range:{UseMinMax:!1,UseDataRange:!1,RuleMin:0,RuleMax:10},Title:{AxisTitleSize:12,NameColor:"",Name:"",TitleOffset:20},_Hidden:{_AxisId:_.uniqueId("axis_"),_Index:0,_Label:"XAxis"===t?T:L,_Type:"linear"}};return e||_.extend(i,t),i},R.axesFactory=function(a,t){var r={items:{headerTemplate:g.singular(a)+" {{ i1 }}",id:"arrItem",title:a,type:"object",oneOf:[]},options:{hidden:!0},propertyOrder:t,type:"array"},o="XAxes"===a?["bottom","top"]:["left","right"];return _.each(O,function(t){var e={_Hidden:{type:"object",options:{hidden:!0},properties:{_AxisId:{type:"string",options:{hidden:!0},default:""},_Index:{type:"number",options:{hidden:!0},default:0},_Label:{type:"string",options:{hidden:!0}},_Type:{type:"string",options:{hidden:!0},default:t}}}},i={title:t,options:{collapsed:!0,linked_oneof_property:{property:"_Hidden._Type",value:t}},properties:_.extend(!0,{DisplayAxis:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:!0},Position:{propertyOrder:2,type:"string",default:o[0],enum:o}},R.rangeFactory(),R.labelFactory(g.singular(a)),R.titleFactory(g.singular(a)),R.splitLineFactory(),e)};r.items.oneOf.push(i)}),r},R.matrixAxesFactory=function(t,e){return{type:"object",propertyOrder:e,title:t,options:{collapsed:!0,hidden:!1},properties:_.extend(!0,R.labelFactory(g.singular(t),!0),R.splitLineFactory(),R.titleFactory())}},R.rangeFactory=function(){return{Range:{type:"object",propertyOrder:4,title:"Range",options:{collapsed:!0},properties:{UseMinMax:{propertyOrder:1,type:"boolean",title:"Use Min/Max",format:"checkbox",default:!1},UseDataRange:{propertyOrder:2,type:"boolean",title:"Use Data Range",format:"checkbox",default:!1},RuleMin:{propertyOrder:3,type:"number",title:"Rule Min",format:"number",default:0,options:{hidden:!1}},RuleMax:{propertyOrder:4,type:"number",title:"Rule Max",format:"number",default:10,options:{hidden:!1}}}}}},R.labelFactory=function(t,e){return{Labels:{propertyOrder:5,type:"object",title:"Labels",options:{collapsed:!0},properties:_.extend({},{LabelFont:{propertyOrder:15,type:"string",title:"Label Font",enum:v,default:"Verdana"},LabelFontSize:{propertyOrder:16,type:"number",title:"Label Size",default:12},LabelFontStyle:{propertyOrder:20,type:"string",title:"Font Style",default:"normal",enum:["normal","bold","oblique","italic"]},LabelRotate:{type:"number",propertyOrder:21,title:"Label Rotation",format:"number",minimum:0,maximum:360,default:0},LabelColor:{propertyOrder:22,type:"gradient",title:"Font Colour",options:{noColor:!0},default:""},LabelSize:{type:"number",propertyOrder:30,title:"Label "+("XAxis"===t?"Height":"Width"),format:"number",minimum:2,maximum:100,default:2,options:{hidden:!0}}},e?{}:{Format:{propertyOrder:2,type:"string",title:"Format",default:"General",enum:["General","Number","Smart Number","Formatted Number","Datetime"]},DisplayLabel:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:!0},Precision:{type:"number",propertyOrder:3,title:"Decimal Places",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{propertyOrder:4,type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},Interval:{type:"number",propertyOrder:9,title:"Label Display Interval",format:"number",default:0,options:{hidden:!0}},DateFormat:{propertyOrder:10,type:"string",title:"Date/Time format",enum:D,default:"YYYY-MM-DD"},Prefix:{type:"string",propertyOrder:11,default:""},Suffix:{type:"string",propertyOrder:12,default:""}})}}},R.titleFactory=function(t){var e={Title:{propertyOrder:5,type:"object",title:"Title",options:{collapsed:!0},properties:{AxisTitleSize:{propertyOrder:5,type:"number",title:"Axis Title Size",default:12},NameColor:{propertyOrder:10,type:"gradient",title:"Name Colour",options:{noColor:!0},default:""},TitleOffset:{propertyOrder:20,title:"Axis Name Offset",default:20,type:"number"}}}};return t&&(e.Title.properties.Name={propertyOrder:1,type:"string",title:"Axis Name",default:" "}),e},R.splitLineFactory=function(){return{SplitLine:{propertyOrder:20,type:"object",title:"Gridlines",options:{collapsed:!0},properties:{LineStyle:{propertyOrder:1,type:"string",title:"Line Style",default:"solid",enum:["solid","dashed","dotted"]},LineColor:{propertyOrder:2,type:"gradient",title:"Line Colour",options:{noColor:!0},default:""},LineOpacity:{propertyOrder:3,type:"number",title:"Line Opacity",format:"range",minimum:0,maximum:100,default:10}}}}},R.chartFactory=function(){for(var t={},e=1;e<5;e+=1){var i="Chart"+e,a={XAxisID:{propertyOrder:1,default:"",title:"X Axis ID",type:"string",enumSource:"possible_axis",watch:{possible_axis:"chartsObj._Hidden._PossibleXAxes"}},XAxisData:{propertyOrder:2,title:"X Axis Data",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleKeys"}},YAxisID:{propertyOrder:3,title:"Y Axis ID",type:"string",enumSource:"possible_axis",watch:{possible_axis:"chartsObj._Hidden._PossibleYAxes"}},YAxisData:{propertyOrder:4,default:"",title:"Y Axis Data",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleKeys"}},DisplayChart:{propertyOrder:5,type:"boolean",title:"Display",format:"checkbox",default:!0},Legend:{propertyOrder:14,type:"object",title:"Legend",options:{collapsed:!0},properties:{LegendName:{propertyOrder:1,type:"string",title:"Legend Name",default:""},Icon:{propertyOrder:5,type:"string",title:"Icon Custom",default:""},IconFa:{title:"Icon ",propertyOrder:10,type:"icon",default:"fa-circle",iconTypes:"fa"},LegendColor:{propertyOrder:20,type:"gradient",title:"Legend Text Colour",options:{noColor:!0},default:""}}},Radius:{propertyOrder:15,type:"object",title:"Radius",options:{collapsed:!0},properties:{FixedRadius:{propertyOrder:1,type:"boolean",title:"Fixed Radius",format:"checkbox",default:!0},FixedSize:{propertyOrder:2,type:"number",title:"Fixed Size",default:12},RadiusData:{propertyOrder:3,default:"",title:"Radius Data",type:"customDropdown",data:"possible_columns",watch:{possible_columns:"root.possibleKeys"}},RadiusScaling:{propertyOrder:4,type:"number",title:"Radius Scaling",default:1}}},PlotStyles:{propertyOrder:16,type:"object",title:"Plot Styles",options:{collapsed:!0},properties:{PlotColor:{type:"gradient",title:"Plot Colour",options:{noColor:!1},default:M[i].PlotColor},PlotShape:{propertyOrder:6,type:"string",title:"Plot Shape",default:"circle",enum:["circle","rect","roundRect","triangle","diamond","pin","arrow","none"]}}},MarkLine:{propertyOrder:16,type:"object",title:"Mark Line",options:{collapsed:!0},properties:{DisplayLine:{propertyOrder:1,type:"boolean",title:"Display",format:"checkbox",default:!0},Animation:{propertyOrder:4,type:"boolean",title:"Animation",format:"checkbox",default:!1},ForceSpan:{propertyOrder:5,type:"boolean",title:"Force Line Grid Span",format:"checkbox",default:!1},LineType:{propertyOrder:6,type:"string",title:"Line Style",default:"solid",enum:["solid","dashed","dotted"]},LineWidth:{propertyOrder:7,type:"number",title:"Line Width",default:1},LineColor:{propertyOrder:8,type:"gradient",title:"Line Colour",options:{noColor:!0},default:""},FormulaPosition:{propertyOrder:9,type:"string",title:"Formula Position",default:"end",enum:["start","middle","end"]},ShowLineFormula:{propertyOrder:10,type:"boolean",title:"Show Line Formula",format:"checkbox",default:!1},ShowLineTooltip:{propertyOrder:12,type:"boolean",title:"Show Line Tooltip",format:"checkbox",default:!0},MarkLineFontSize:{propertyOrder:15,type:"number",title:"Formula/Tooltip Font Size",default:12}}},Crosshair:{propertyOrder:16,type:"object",title:"Crosshair",options:{collapsed:!0},properties:{Format:{propertyOrder:2,type:"string",title:"Format",default:"General",enum:["General","Number","Smart Number","Formatted Number","Datetime"]},Precision:{type:"number",propertyOrder:3,title:"Decimal Places",format:"number",minimum:0,maximum:10,default:2},HideTrailingZeroes:{propertyOrder:4,type:"boolean",title:"Hide Trailing Zeroes",format:"checkbox",default:!1},Interval:{type:"number",propertyOrder:9,title:"Label Display Interval",format:"number",default:0},DateFormat:{propertyOrder:10,type:"string",title:"Date/Time format",enum:D,default:"YYYY-MM-DD"}}}};t[i]={type:"object",propertyOrder:3,title:"Chart "+e,options:{collapsed:!0},properties:_.extend(!0,{},a)}}return t},R.defaults=function(){return R.getComponentDefinition({settingsModel:new o.Model}).appArgs.json},R);function R(){}var P={XAxes:[Y.axisCommonOptions("XAxis")],YAxes:[Y.axisCommonOptions("YAxis")],Charts:{Chart1:Y.chartsOptions("Chart1"),Chart2:Y.chartsOptions("Chart2"),Chart3:Y.chartsOptions("Chart3"),Chart4:Y.chartsOptions("Chart4"),_Hidden:{_PossibleXAxes:[T],_PossibleYAxes:[L]}},Legend:{Display:!0,ItemGap:10,LegendPosition:"top",SelectedMode:"multiple",UseHtml:!1}};Y.upgrades=[{version:"4.6.0",fn:function(e){var i={Legend:P.Legend,XAxes:P.XAxes,YAxes:P.YAxes,Charts:P.Charts};_.each(_.keys(i),function(t){void 0===e.get(t)&&e.set(t,i[t])})}}];var k=(I.THEMECOLORSCHEME={dark:{font:"#fff",inverse:"#000"},light:{font:"#000",inverse:"#fff"}},I.DEFAULTSETTINGS={fontFamilyLegend:"Verdana",fontFamilyLabel:"Verdana",tooltipOpacity:80,pointsColor:"#3d50ff"},I.ICON_LOCATION=require.toUrl("QuickBase").replace("/main","")+"/images/black/",I.ICON_LOCATION_LIGHT=require.toUrl("QuickBase").replace("/main","")+"/images/white/",I);function I(){}var w,N=(w=o.DeepModel,n(H,w),H.prototype.onColumnPropChanged=function(t,e){t.changed;this.trigger("updateMatrixChart",!0)},H);function H(t){t=w.call(this,t)||this;return t.listenTo(t,"change",t.onColumnPropChanged),t}var X,E=(X=o.Collection,n(B,X),B.prototype.modelId=function(t){return t._Hidden._ColId},B);function B(){var t=null!==X&&X.apply(this,arguments)||this;return t.model=N,t}var j,V=(j=o.DeepModel,n(z,j),z.prototype.calculateAxisMinMax=function(n,s){var l={XAxis:{},YAxis:{}};return _.each(z.AXISKEYS,function(t){var e,i,a,r,o=s[t].axisModel;null!==o&&(e=o.get("Range.UseMinMax"),i=o.get("Range.UseDataRange"),r=y.calculateMinMaxOffset(n[t]),a=Number(n[t][0])-r,r=Number(n[t][1])+r,e&&!i?(a=o.get("Range.RuleMin"),r=o.get("Range.RuleMax")):e&&i&&(a=n[t][0],r=n[t][1]),l[t]={min:a,max:r})}),l},z.prototype.onChartsDataChanged=function(t,e){var i=this;_.each(t.get("Charts"),function(t,e){i.chartData[e]&&(i.chartData[e].dataColsSet=!!t.XAxisData&&!!t.YAxisData)}),this.updateChartData()},z.prototype.onAxisPropChanged=function(){this.updateChartData()},z.prototype.onChartsPropChanged=function(t,e){this.updateChartData()},z.prototype.onChartsLegendChanged=function(t,e){var i=this,t=t.changed.Charts;_.each(t,function(t,e){t=t.Legend&&void 0!==t.Legend.LegendName?t.Legend.LegendName:null;null!==t&&(i.chartData[e].name=t)}),this.updateChartData()},z.prototype.onChartsRadiusChanged=function(t,e){this.updateChartData()},z.prototype.onChartsHiddenChanged=function(t,e){var i=this;_.each(z.CHARTKEYS,function(t){var e=i.get("Charts."+t);i.chartData[t].hidden=!e.DisplayChart}),this.forceResetChart=!0,this.updateChartData()},z.prototype.getAxisDataOptions=function(t,e){return null!==this.chartAxis[t][e].data?{data:this.chartAxis[t][e].data}:{}},z.prototype.getAxisMiscOptions=function(t){var e={};return"category"===t.getType()&&(e.boundaryGap=!1),e},z.prototype.prepareAxisOptions=function(){var d=this;_.each(this.chartData,function(p,h){p.dataComplete&&_.each(z.AXISKEYS,function(t,e){var i,a,r,o,n,s=d.chartAxis[h][t].axisModel,l=d.chartAxis[h][z.REVERSEAXISKEYS[t]].axisModel;null!==s&&(i={},a=d.generateAxisNestedOptions(p,s,t,e),r=d.getMinMaxOptions(h,t,s),o=d.getAxisDataOptions(h,t),n=d.getAxisTitleOptions(s,l),e=d.getAxisMiscOptions(s),l={gridId:p.id,id:p.id,show:!p.hidden,type:z.AXISTYPESMAP[s.getType()],position:s.get("Position")},s.get("Labels.Interval")&&(l.interval=s.get("Labels.Interval")),i=_.extend({},l,n,r,o,e),d.chartAxis[h][t].options=_.extend({},i,a))})})},z.prototype.generateAxisFormatter=function(t){return y.getFormatter(t.get("Labels.Format"),t.get("Labels.Precision"),t.get("Labels.HideTrailingZeroes"),t.get("Labels.DateFormat"))},z.prototype.getAxisDataRangeMinMax=function(t,e){var i={},e=this.chartData[t].dataMinMax[e];return i=e.length&&_.isNumber(e[0])&&_.isNumber(e[1])?{min:e[0],max:e[1]}:i},z.prototype.generateAxisNestedOptions=function(i,a,t,e){var r=this,o=i.dataTypes[t],n=i.rawData[e],s=l=k.THEMECOLORSCHEME[this.theme].font,e=a.get("Labels.DisplayLabel")&&a.get("DisplayAxis"),l=a.get("Labels.LabelColor")?a.get("Labels.LabelColor"):l;a.get("SplitLine.LineColor")&&(s=a.get("SplitLine.LineColor"));s={splitLine:{show:!0,lineStyle:{opacity:a.get("SplitLine.LineOpacity")/100,color:s,type:a.get("SplitLine.LineStyle")}}},e={show:e,color:l,rotate:a.get("Labels.LabelRotate"),formatter:function(t,e){return r.getLabelFormatter(i,a,t,n[e],o)},fontFamily:a.get("Labels.LabelFont"),fontSize:a.get("Labels.LabelFontSize"),fontStyle:a.get("Labels.LabelFontStyle")};return this.chartAxis[i.key][t].labelSize=a.get("Labels.LabelSize"),_.extend({},{axisLine:{show:a.get("DisplayAxis"),lineStyle:{color:l},onZero:!1},axisTick:{show:a.get("DisplayAxis"),lineStyle:{color:l}},axisLabel:e},s)},z.prototype.getAxisTitleOptions=function(t,e){var i={},a=k.THEMECOLORSCHEME[this.theme].font,r=t.get("Position"),o=t.get("Title.TitleOffset"),n={left:[0,0,o,0],right:[0,0,o,0],top:[0,0,o,0],bottom:[o,0,0,0]},o=t.get("Title.Name");return o&&(a=t.get("Title.NameColor")?t.get("Title.NameColor"):a,i={name:o,nameLocation:"middle",nameRotate:{left:90,right:270,top:0,bottom:0}[r],nameTextStyle:{padding:n[r],color:a,fontSize:t.get("Title.AxisTitleSize")}}),i},z.prototype.getChartData=function(t){var e=this.chartData[t].data,t=[];return e.length&&e[0].length===e[1].length&&e[2]?t=_.zipWith(e[0],e[1],e[2],function(t,e,i){e=[t,e];return void 0!==i&&_.isNumber(i)&&e.push(i=i<0?0:i),e}):console.log("x and y Axis data has different length"),t},z.prototype.getMarkLine=function(t){var e,i,a,r,o,n,s={};return this.chartData[t].dataComplete&&(e=this.chartData[t].markLine,i=this.get("Charts."+t+".MarkLine.MarkLineFontSize"),a=this.get("Charts."+t+".MarkLine.ShowLineFormula"),r=this.get("Charts."+t+".MarkLine.ShowLineTooltip"),o=this.get("Charts."+t+".MarkLine.FormulaPosition")||"middle",n=this.chartData[t].markLine.formula,s={animation:this.get("Charts."+t+".MarkLine.Animation"),label:{show:a,formatter:n||"",position:o,textStyle:{align:{start:"left",middle:"center",end:"right"}[o],fontSize:i}},lineStyle:{type:this.get("Charts."+t+".MarkLine.LineType"),color:this.get("Charts."+t+".MarkLine.LineColor"),width:this.get("Charts."+t+".MarkLine.LineWidth")},tooltip:{show:r,formatter:n?n.replace("\n","</br>"):"",textStyle:{fontSize:i}},data:[[{coord:e.startXY,symbol:"none"},{coord:e.endXY,symbol:"none"}]]}),s},z.prototype.getMinMaxOptions=function(t,e,i){var a={},r=this.chartAxis[t][e].scales.min,o=this.chartAxis[t][e].scales.max;return i.get("Range.UseMinMax")?i.get("Range.UseDataRange")&&this.dataSource?a=this.getAxisDataRangeMinMax(t,e):(a.min=i.get("Range.RuleMin"),a.max=i.get("Range.RuleMax")):null!==r&&null!==o&&(a.min=r,a.max=o),a},z.prototype.getPlotStyles=function(t){var e={},t=this.get("Charts."+t+".PlotStyles.PlotColor");return e=t?{color:t}:e},z.prototype.getDataAccessor=function(t){var e=this.dataSource,a=e.getPropertyFromColumn(t.toString()),r=e.getColumnType(a);return 12<=r&&r<=19?function(t){var e=_.cloneDeep(t.get(a)),i=_.isNaN(Number(e.i))?null:Number(e.i);return 13===r&&((t=l.tz("2000-01-01","UTC")).add(e.i,"month"),i=t.valueOf()),i}:7==r?function(t){return null!=t.get(a)?Number(t.get(a)):null}:function(t){return t.get(a)}},z.prototype.getLabelFormatter=function(t,e,i,a,r){var o=i,n=e.getType(),s=this.axisFromatters[t.key][e.key],t=e.get("Labels.Prefix"),e=e.get("Labels.Suffix");return"linear"!==n||isNaN(i)?"category"===n?isNaN(Number(i))?l.isMoment(a)&&(o=s(a)):o=s(Number(i)):"time"===n&&(o=s(y.convertTempralToEchart(i,r)),console.log("label",o)):o=s(i),t+o+e},z.prototype.updateAxisModelsRefs=function(){var o=this;this.XAxes.length&&this.YAxes.length?(this.axisModelsSet=!0,_.each(this.chartAxis,function(a,r){_.each(z.AXISKEYS,function(t){var e=o.get("Charts."+r+"."+t+"ID"),i=o[g.plural(t)].find(function(t){return t.getLabel()===e});a[t].axisModel=i||null})}),this.updateChartData()):this.axisModelsSet=!1},z.prototype.removeOverflowData=function(t,e){},z.prototype.updateRadiusData=function(t,e){var i,a,r;t.data.length&&(i=this.dataSource,r=this.get("Charts."+e+".Radius.RadiusData"),a=r?this.getDataAccessor(r):null,e=i.getColumnType(r),r=[],null!==a&&4<=e&&e<=9&&(r=i.getData().map(function(t){return a(t)})),t.data[2]=r)},z.prototype.areChartsValid=function(){return _.every(this.chartData,function(t){return t.dataColsSet})},z.prototype.resolveValidColunNames=function(t,e){t=this.get("Charts."+t+"."+e+"Data"),e=y.getColumnKeysFromAxisString(t,this.dataSource),t=[];return _.isArray(e)&&(t=t.concat(e)),_.uniq(t)},z.prototype.updateChartData=function(t){var g=this,m=this.dataSource,o="";this.isReadyForChartRender=this.settingsOptionsReady&&this.axisModelsSet,this.areChartsValid()&&!this.appView.propertiesChanging&&void 0!==m&&this.isReadyForChartRender&&(void 0!==t&&(this.forceResetChart=t),_.each(this.chartData,function(h,d){var t,a,u={XAxis:[],YAxis:[]},r={XAxis:{},YAxis:{}},e=!1,i=!1,c=g.chartAxis[d];_.each(z.AXISKEYS,function(t,e){var i,a,r,o,n,s,l,p=c[t].axisModel;p&&(g.axisFromatters[d][t]=g.generateAxisFormatter(p),i=g.resolveValidColunNames(d,t)[0],a=p.getType(),r=m.getColumnType(i),n=[],l=[],p=[],null!==(o=i?g.getDataAccessor(i):null)&&(l=m.getData().map(function(t){return o(t)}),p=!(12<=r&&r<=19)||"time"===a?l:_.map(l,function(t){return t.toString()}),"category"===a&&(s=_.uniq(p),p=_.map(p,function(e){return s.findIndex(function(t){return t===e})}),g.chartAxis[d][t].data=s),n=y.calculateDataMinMax(p)),h.data[e]=p,h.rawData[e]=l,u[t]=n,h.dataTypes[t]=r)}),(h.dataMinMax=u).XAxis.length&&u.YAxis.length&&-1===_.concat(u.XAxis,u.YAxis).indexOf(null)?(r=g.calculateAxisMinMax(u,g.chartAxis[d]),t=h.data,a=y.getLinearRegresionLineCoords(t[0],t[1],g.get("Charts."+d+".MarkLine.ForceSpan")?r:u),_.each(z.AXISKEYS,function(t,e){var i=c[t].axisModel,e=y.sortArrayAcs([a.startXY[e],a.endXY[e]]),e={min:e[0],max:e[1]};null===i||i.get("Range.UseDataRange")||(e.min<r[t].min&&(r[t].min=e.min),e.max>r[t].max&&(r[t].max=e.max))}),h.markLine.startXY=a.startXY,h.markLine.endXY=a.endXY,h.markLine.formula=a.formula,g.chartAxis[d].XAxis.scales=e?{min:null,max:null}:r.XAxis,g.chartAxis[d].YAxis.scales=i?{min:null,max:null}:r.YAxis):(g.chartAxis[d].XAxis.scales={min:null,max:null},g.chartAxis[d].YAxis.scales={min:null,max:null},h.markLine={startXY:[],endXY:[]},h.markLine.startXY=[],h.markLine.endXY=[],o="Can't calculate median line and min/max, invalid data set."),g.removeOverflowData(r,h),g.updateRadiusData(h,d),h.dataComplete=!!g.get("Charts."+d+".XAxisData")&&!!g.get("Charts."+d+".YAxisData")}),o&&console.info(o,this.chartData),this.prepareAxisOptions(),this.skipChartUpdate||(this.trigger("chartNameChanged",this.forceResetChart),this.forceResetChart=!1))},z.prototype.getAxisFormatters=function(){return this.axisFromatters},z.prototype.getChartDataObj=function(t){t=_.findKey(this.chartData,{name:t})||t;return this.chartData[t]},z.prototype.getChartLegendNames=function(){return _.mapValues(this.chartData,function(t){return t.name})},z.prototype.getChartLegendIconOptions=function(t,e){var i=this.get("Charts."+t+".Legend.IconFa"),a=k.THEMECOLORSCHEME[this.theme].font,r=this.getTooltipSvgStyles(t),o=e?y.renderSVGIcon(r,12):r.legendIconCustom;"arrow"===o&&(o="");var n="dark"===this.theme?k.ICON_LOCATION_LIGHT:k.ICON_LOCATION,s="image://"+window.location.origin+window.location.pathname,r=o||i;return{iconPath:r=i&&!o&&!e?s+n+(i=-1!==i.indexOf("fa-")?i.substring(3):i)+".png":r,iconColor:this.get("Charts."+t+".PlotStyles.PlotColor")||a,fontColor:this.get("Charts."+t+".Legend.LegendColor")||a,fontSize:"12px"}},z.prototype.getTooltipSvgStyles=function(t){t=_.findKey(this.chartData,{name:t})||t;return{legendIconCustom:this.get("Charts."+t+".Legend.Icon"),legendIcon:this.get("Charts."+t+".Legend.IconFa"),plotColor:this.get("Charts."+t+".PlotStyles.PlotColor")}},z.prototype.getVisbileCharts=function(){return _.filter(this.chartData,function(t){return!t.hidden&&t.dataComplete})},z.prototype.setTheme=function(t){this.theme=t,this.updateChartData()},z.prototype.updateDataSource=function(t){t?(this.dataSource=t,this.updateChartData()):console.log("updateData() call without datasource property")},z.prototype.getAxisOptions=function(e){return _.map(this.chartAxis,function(t){if(t[e]&&t[e].options)return t[e].options})},z.prototype.getGridOptions=function(){var a=[],t={top:2,bottom:-2,left:0,right:0}[this.get("Legend.LegendPosition")],e={top:0,bottom:0,left:4,right:-4}[this.get("Legend.LegendPosition")],i=this.BASEGRIDPROPS.left+e,r=this.BASEGRIDPROPS.top+t,o=this.BASEGRIDPROPS.left,n=this.BASEGRIDPROPS.top,s=this.BASEGRIDPROPS.width,l=this.BASEGRIDPROPS.height,p=this.BASEGRIDPROPS.gap,h=this.BASEGRIDPROPS.span,e=[{left:i+"%",top:r+p+"%",width:s+"%",height:l+"%"},{left:o+i+p+s+"%",top:r+p+"%",width:s+"%",height:l+"%"},{left:i+"%",top:r+n+l+p+"%",width:s+"%",height:l+"%"},{left:o+i+p+s+"%",top:n+r+l+p+"%",width:s+"%",height:l+"%"}],t=this.getVisbileCharts(),d=[[{left:i+"%",top:r+"%",width:h+"%",height:h+"%"}],[{left:i+"%",top:r+"%",width:h+"%",height:l+"%"},{left:i+"%",top:n+r+p+l+"%",width:h+"%",height:l+"%"}],[{left:i+"%",top:r+"%",width:h+"%",height:l+"%"},{left:i+"%",top:r+n+p+l+"%",width:s+"%",height:l+"%"},{left:i+o+p+s+"%",top:r+n+p+l+"%",width:s+"%",height:l+"%"}],e][t.length-1];return _.each(t,function(t,e){var i={};(i=d[e]).id=t.id,a.push(i)}),a},z.prototype.getSeriesOptions=function(){var p=this,h=[],d=[];return this.api.hideErrorMessage(),_.each(this.chartData,function(t,e){var i,a,r={},o=p.get("Charts."+e+".MarkLine.DisplayLine"),n=p.get("Charts."+e+".Radius.FixedRadius"),s=p.get("Charts."+e+".Radius.FixedSize"),l=p.get("Charts."+e+".Radius.RadiusScaling"),s=0<s?s:0;t.dataComplete&&!t.hidden&&(i=t.name||e,-1!==_.indexOf(d,i)&&p.api.showErrorMessage({error:"Chart Legend must be unique "+i,type:"Error"}),d.push(i),a=p.getChartData(e),r={name:i,hoverAnimation:!1,type:"scatter",xAxisId:t.id,yAxisId:t.id,id:t.key,data:a,markLine:o?p.getMarkLine(e):{},itemStyle:p.getPlotStyles(e),symbol:p.get("Charts."+e+".PlotStyles.PlotShape")},a.length>p.appView.largeDataThreshold&&(_.extend(r,{large:!0,largeThreshold:1,progressive:a.length,progressiveThreshold:10}),p.appView.showNotification("Large data threshold is reached",5e3)),(n||t.data[2].length)&&(r=_.extend({},r,{symbolSize:n?s:function(t){return t[2]*l}})),h.push(r))}),h},z.CHARTKEYS=["Chart1","Chart2","Chart3","Chart4"],z.AXISKEYS=["XAxis","YAxis"],z.REVERSEAXISKEYS={XAxis:"YAxis",YAxis:"XAxis"},z.AXISKEYSDATA=["XAxisData","YAxisData"],z.MULTAXISKEYS=["XAxes","YAxes"],z.AXISTYPESMAP={linear:"value",logarithmic:"log",category:"category",time:"time"},z.GRIDIDS=["gr1","gr2","gr3","gr4"],z);function z(t,e,i,a){var r=j.call(this)||this;r.settingsOptionsReady=!1,r.isReadyForChartRender=!1,r.axisModelsSet=!1,r.skipChartUpdate=!1,r.BASEGRIDPROPS={width:38,height:36,span:84,left:7,top:7,gap:1},r.theme="dark",r.forceResetChart=!1,r.chartData={Chart1:{key:"Chart1",name:"",dataTypes:{XAxis:null,YAxis:null},dataColsSet:!1,data:[],rawData:[],gridIx:0,dataComplete:!1,hidden:!1,dataMinMax:{XAxis:[],YAxis:[]},markLine:{startXY:[],endXY:[],formula:""},id:"gr1"},Chart2:{key:"Chart2",name:"",dataTypes:{XAxis:null,YAxis:null},dataColsSet:!1,data:[],rawData:[],gridIx:1,dataComplete:!1,hidden:!1,dataMinMax:{XAxis:[],YAxis:[]},markLine:{startXY:[],endXY:[],formula:""},id:"gr2"},Chart3:{key:"Chart3",name:"",dataTypes:{XAxis:null,YAxis:null},dataColsSet:!1,data:[],rawData:[],gridIx:2,dataComplete:!1,hidden:!1,dataMinMax:{XAxis:[],YAxis:[]},markLine:{startXY:[],endXY:[],formula:""},id:"gr3"},Chart4:{key:"Chart4",name:"",dataTypes:{XAxis:null,YAxis:null},dataColsSet:!1,data:[],rawData:[],gridIx:3,dataComplete:!1,hidden:!1,dataMinMax:{XAxis:[],YAxis:[]},markLine:{startXY:[],endXY:[],formula:""},id:"gr4"}},r.chartAxis={Chart1:{XAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2},YAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2}},Chart2:{XAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2},YAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2}},Chart3:{XAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2},YAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2}},Chart4:{XAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2},YAxis:{axisModel:null,options:{},scales:{min:null,max:null},data:null,labelSize:2}}},r.axisFromatters={Chart1:{XAxis:null,YAxis:null},Chart2:{XAxis:null,YAxis:null},Chart3:{XAxis:null,YAxis:null},Chart4:{XAxis:null,YAxis:null}},r.api=t,r.XAxes=e,r.YAxes=i,r.appView=a;var o=_.map(z.CHARTKEYS,function(t){return"change:Charts."+t+".XAxisData change:Charts."+t+".YAxisData "}).join(""),n=_.map(z.CHARTKEYS,function(t){return"change:Charts."+t+".XAxisID change:Charts."+t+".YAxisID "}).join(""),s=_.map(z.MULTAXISKEYS,function(t){return"change:Charts._Hidden._Possible"+t+" "}).join(""),t=_.map(z.CHARTKEYS,function(t){return"change:Charts."+t+".Radius "}).join(""),e=_.map(z.CHARTKEYS,function(t){return"change:Charts."+t+".MarkLine "}).join(""),i=_.map(z.CHARTKEYS,function(t){return"change:Charts."+t+".PlotStyles "}).join(""),a=_.map(z.CHARTKEYS,function(t){return"change:Charts."+t+".Legend "}).join("");return r.listenTo(r,s,r.updateAxisModelsRefs),r.listenTo(r,n,r.updateAxisModelsRefs),r.listenTo(r.XAxes,"updateChartAxis",r.onAxisPropChanged),r.listenTo(r.YAxes,"updateChartAxis",r.onAxisPropChanged),r.listenTo(r,o,r.onChartsDataChanged),r.listenTo(r,t,r.onChartsRadiusChanged),r.listenTo(r,e,_.bind(function(t,e){r.forceResetChart=!0,r.onChartsPropChanged()},r)),r.listenTo(r,i,r.onChartsPropChanged),r.listenTo(r,a,r.onChartsLegendChanged),r.listenTo(r,_.map(z.CHARTKEYS,function(t){return"change:Charts."+t+".DisplayChart "}).join(""),r.onChartsHiddenChanged),r}var G,K=(G=o.DeepModel,n(U,G),U.prototype.convertValueForFormater=function(t,e,i){e=this.getChartDataObj(e).dataTypes[i],i=t;return i=12<=e&&e<=19?y.convertTempralToEchart(t,e):i},U.prototype.labelFormatter=function(t){if(!t.seriesData.length)return t.value;var e=t.seriesData[0],i=_.find(V.CHARTKEYS,function(t){return-1!==e.seriesId.indexOf(t)}),a=t.value,t=["XAxis","YAxis"][_.indexOf(e.value,a)];return this.getChartAxisFormatters()[i][t=void 0===t?"YAxis":t](this.convertValueForFormater(a,e.seriesName,t))},U.prototype.pushToTemplate=function(t){var e;this.get("Overlay.UseCustomTooltip")?(e=a.compile(this.get("Overlay.CustomTooltip")),this.$tooltipArea.innerHTML=e(t)):this.$tooltipArea.innerHTML=_.unescape(p.tooltip(t))},U.prototype.onOverlayChanged=function(t,e){this.updateOverlay()},U.prototype.setTheme=function(t){this.theme=t,this.updateOverlay()},U.prototype.tooltipFormatter=function(e,t,i){var a,r,o,n,s=this,l=this.getChartAxisFormatters(),p=this.$appEl.outerHeight()-60,h=this.get("Overlay.FontSize"),d={fontSize:"font-size:"+h+"px",maxHeight:"max-height:"+p+"px;",xLabel:"",points:[]},u="";return _.isArray(e)&&e.length?(o=(e=y.filterTooltipArraySeries(e))[0].axisValueLabel,d.xLabel=o,_.each(e,function(e,t){var i=e.dataIndex,a=_.find(V.CHARTKEYS,function(t){return-1!==e.seriesId.indexOf(t)}),r=s.dataSource.getData().at(i),o=s.convertValueForFormater(e.value[1],e.seriesName,"YAxis"),n=s.getChartStyles(e.seriesName),i=y.renderSVGIcon(n,h),i={plotColor:n.plotColor,layerData:e.value[1],layerDataFormatted:l[a].YAxis(o),chartName:e.seriesName,svg:i,noSvg:!i.length,iconFa:n.legendIcon};r&&(i.cols=r.toJSON()),i.svg=y.renderSVGIcon(n,h),d.points[t]=i}),this.pushToTemplate(d),u=this.$tooltipArea.innerHTML):_.isObject(e)?(r=e.dataIndex,a=_.find(V.CHARTKEYS,function(t){return-1!==e.seriesId.indexOf(t)}),n=this.dataSource.getData().at(r),p=this.convertValueForFormater(e.value[1],e.seriesName,"YAxis"),o=this.getChartStyles(e.seriesName),r=y.renderSVGIcon(o,h),o={plotColor:o.plotColor,layerData:e.value[1],layerDataFormatted:l[a].YAxis(p),chartName:e.seriesName,svg:r,noSvg:!r.length,iconFa:o.legendIcon},n&&(o.cols=n.toJSON()),e.name?d.xLabel=e.name:(n=this.convertValueForFormater(e.value[0],e.seriesName,"XAxis"),d.xLabel=l[a].XAxis(n)),d.points=[o],this.pushToTemplate(d),u=this.$tooltipArea.innerHTML):console.info("Unable to generate tooltip, no series data. Check you chart setting"),u},U.prototype.updateOverlay=function(){this.trigger("updateChart")},U.prototype.getAxisPointerOptions=function(){var t={show:!0,snap:this.get("Overlay.Snap"),lineStyle:{type:this.get("Overlay.TooltipAxisPointerType")},label:{show:!0,formatter:_.bind(this.labelFormatter,this),backgroundColor:"rgba(0,0,0,"+this.get("Overlay.FillOpacity")/100+")",textStyle:{color:k.THEMECOLORSCHEME.dark.font}}},e=this.getVisbileCharts(),i=[];return 2===e.length&&(i=[{xAxisId:[e[0].id,e[1].id]}]),(i=3===e.length?[{xAxisId:[e[0].id,e[1].id,e[2].id]},{yAxisId:[e[1].id,e[2].id]}]:i).length?t.link=i:t.link=[{yAxisId:["gr1","gr2"]},{xAxisId:["gr1","gr3"]},{xAxisId:["gr2","gr4"]},{yAxisId:["gr3","gr4"]}],t},U.prototype.getTooltipOptions=function(){var t=this.get("Overlay.FixedPosition"),e="rgba(0,0,0,"+this.get("Overlay.FillOpacity")/100+")",e={show:this.get("Overlay.Display"),backgroundColor:e,formatter:_.bind(this.tooltipFormatter,this),borderColor:"transparent",confine:!0,axisPointer:{crossStyle:{animation:!1}}};return t&&_.extend(e,{position:function(t,e,i,a,r){var o={};return o[["left","right"][+(t[0]<r.viewSize[0]/2)]]=60,o[["top","bottom"][+(t[1]<r.viewSize[1]/2)]]=20,o}}),e},U.prototype.updateDataSource=function(t){t?this.dataSource=t:console.log("updateData() call without datasource property")},U);function U(t,e,i,a,r,o,n){var s=G.call(this)||this;return s.theme="dark",s.skipChartUpdate=!1,s.dataSource=t,s.api=e,s.$appEl=i,s.$tooltipArea=_.first(i.find(".tooltip")),s.getChartAxisFormatters=a,s.getChartDataObj=r,s.getChartStyles=o,s.getVisbileCharts=n,s.listenTo(s,"change:Overlay ",s.onOverlayChanged),s}var W=(q.prototype.onData=function(t,e,i){this.meta=this.mergeChanges(this.meta,t.columns.reset,t.columns.change,t.columns.add,t.columns.remove),0!=this.depth||_.isEqual(t.breakdownColumns,this.breakdownColumns)||(this.breakdownColumns=t.breakdownColumns,this.removeChild()),e.reset&&0<e.reset.length&&this.removeChild(),i&&this.updateError(this,i),this.hasDataFlag=!0,this.updateDatasetColumns(),this.updateChildren()&&this.listener.updateDataSource(this)},q.prototype.getColumnNames=function(){if(this.breakdownColumns&&this.breakdownColumns.length)return[q.BREAKDOWN_ID,this.breakdownColumns[0]].concat(_.difference(_.keys(this.meta),this.breakdownColumns));try{return _.map(this.meta,function(t){return[t.id,t.index]}).sort(function(t,e){return t[1]-e[1]}).map(function(t){return t[0]})}catch(t){return _.keys(this.meta)}},q.prototype.getDataByRowIx=function(t){return this.getData()},q.prototype.updateDatasetColumns=function(){var e=this;_.each(this.getColumnNames(),function(t){e.dataSetColumns[t]=e.getData().pluck(t)})},q.prototype.getDataSetColumns=function(){return this.dataSetColumns},q.prototype.getColumnType=function(t){return this.childDataSource?this.childDataSource.getColumnType(t):t===q.BREAKDOWN_ID?this.meta[this.primaryKey].kdbType:this.meta[t]?this.meta[t].kdbType:11},q.prototype.getData=function(){return this.childDataSource?this.childDataSource.getData():this.source.dataSet&&this.source.dataSet.collection},q.prototype.getKey=function(){return this.source.cid},q.prototype.getPath=function(){return this.source.path},q.prototype.getPrimaryKey=function(){return this.childDataSource?this.childDataSource.getPrimaryKey():this.primaryKey},q.prototype.getPropertyFromColumn=function(t){return t===q.BREAKDOWN_ID?this.getPrimaryKey():t},q.prototype.getSource=function(){return this.source},q.prototype.hasData=function(){return this.childDataSource?this.childDataSource.hasData():this.hasDataFlag},q.prototype.mergeChanges=function(e,t,i,a,r){return t&&(e=_.fromPairs(_.map(t,function(t){return[t.id,t]}))),i&&_.each(i,function(t){return _.extend(e[t.id],t)}),a&&_.each(a,function(t){e[t.id]=t}),r&&_.each(r,function(t){delete e[t.id]}),e},q.prototype.removeChild=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource)},q.sourceKey=function(t){return t.getPath()},q.prototype.subscribe=function(){this.api.subscribe(this.source,this.onData.bind(this))},q.prototype.unsubscribe=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource),this.api.unsubscribe(this.source)},q.prototype.updateSourceSubscribe=function(t){this.unsubscribe(),this.source=t,this.subscribe()},q.prototype.updateDataSource=function(){this.listener.updateDataSource(this)},q.prototype.updateChildren=function(){var t;return!(this.breakdownColumns&&this.breakdownColumns.length&&this.depth<this.breakdownColumns.length-1)||(this.focus.length>this.depth?(this.childDataSource&&this.focus[this.depth]!==this.childDataSource.getSource().id&&this.removeChild(),this.childDataSource||(0!==this.depth&&(this.focus[this.depth-1],this.source.id),(t=this.source.dataSet&&this.source.dataSet.collection.get(this.focus[this.depth]))?(this.childDataSource=new q(t,this,this.api,this.focus,this.depth+1,this.breakdownColumns),this.childDataSource.subscribe()):ot.DEBUG&&console.debug("[DEBUG][DATASOURCE] -> onData missing focus",this.focus[this.depth],arguments))):(this.removeChild(),this.focus.length!==this.depth||!this.hasDataFlag||0!==this.depth&&this.focus[this.depth-1]!=this.source.id||this.listener.updateDataSource(this)),!1)},q.prototype.updateError=function(t,e){this.listener.updateError(this,e)},q.BREAKDOWN_ID="{breakdownId}",q);function q(t,e,i,a,r,o){this.breakdownColumns=[],this.focus=[],this.hasDataFlag=!1,this.meta={},this.primaryKey="",this.dataSetColumns={},this.source=t,this.listener=e,this.api=i,this.depth=r||0,this.breakdownColumns=o||this.breakdownColumns}var Z,J=(Z=o.DeepModel,n(Q,Z),Q.prototype.updateLegend=function(t){var a=this;this.appView.isMatrix||(this.legendOptions={show:this.get("Legend.Display"),itemGap:this.get("Legend.ItemGap"),selectedMode:"disabled"!==this.get("Legend.SelectedMode")&&this.get("Legend.SelectedMode"),position:this.get("Legend.LegendPosition"),data:[]},_.each(this.chartModel.getChartLegendNames(),function(t,e){var e=a.chartModel.getChartLegendIconOptions(e),i={noSvg:-1===e.iconPath.indexOf("svg"),icon:e.iconPath,iconColor:e.iconColor,fontColor:e.fontColor,legendName:t};a.legendOptions.data.push(i)}),this.trigger("updateChart",t))},Q.prototype.useHtml=function(){return this.get("Legend.UseHtml")},Q.prototype.getLegendOptions=function(){return this.legendOptions},Q.prototype.getChartLegendOptions=function(){var a=this,r={show:this.get("Legend.Display"),itemGap:this.get("Legend.ItemGap"),itemWidth:14,itemHeight:14,selectedMode:"disabled"!==this.get("Legend.SelectedMode")&&this.get("Legend.SelectedMode"),textStyle:{fontFamily:k.DEFAULTSETTINGS.fontFamilyLegend},data:[]},t={top:{},bottom:{top:"92%"},left:{top:"1%",left:"1%",orient:"vertical"},right:{top:"1%",right:"1%",orient:"vertical"}}[this.get("Legend.LegendPosition")];return _.extend(r,t),_.each(this.chartModel.getChartLegendNames(),function(t,e){var i=a.chartModel.getChartLegendIconOptions(e,a.useHtml()),e={},e={name:t,icon:i.iconPath,textStyle:{color:i.fontColor}};r.data.push(e)}),r},Q);function Q(t,e){var i=Z.call(this)||this;return i.legendOptions={},i.chartModel=t,i.appView=e,i.listenTo(i,"change:Legend",i.updateLegend),i.listenTo(i.chartModel,"chartNameChanged",i.updateLegend),i}var tt,et=(tt=o.DeepModel,n(it,tt),it.prototype.generateAxisFormatter=function(t,e){var i="General",t=this.chartColumns[t];return 4<e&&e<10?i="Number":11<e&&e<20&&(i="Datetime"),y.getFormatter(i,t.Precision,t.HideTrailingZeroes,t.DateFormat)},it.prototype.pushToTemplate=function(t){this.appView.tooltip=this.api.setTooltip({data:t,text:this.crosshairModel.get("Overlay.UseCustomTooltip")?this.crosshairModel.get("Overlay.CustomTooltip"):p.tooltip(t),anchorEl:this.appView.$el[0]}).updateCSS({backgroundColor:"rgba(0,0,0,"+this.crosshairModel.get("Overlay.FillOpacity")/100+")",fontSize:this.crosshairModel.get("Overlay.FontSize")+"px"})},it.prototype.convertValueForFormater=function(t,e){var i=t;return i=12<=e&&e<=19?y.convertTempralToEchart(t,e):i},it.prototype.extractColsMetadataFromSeriesId=function(t,e,i,a){var r=t.seriesId,o=i?0:1,i=0===r.indexOf("grH")?3:2,i=r.substr(i).split("-").reverse(),e=-1===_.indexOf(t.value,e)||a?o:_.indexOf(t.value,e);return this.chartData.metaData[Number(i[e])]},it.prototype.generateAxisNestedOptions=function(t,e,i,a,r){var o=this,n=this.axisKeyMap[t],s=this.chartData.metaData[a].colId,l=this.chartData.data[a],a=t=k.THEMECOLORSCHEME[this.theme].font,t=this.get(n+".Labels.LabelColor")?this.get(n+".Labels.LabelColor"):t;this.get(n+".SplitLine.LineColor")&&(a=this.get(n+".SplitLine.LineColor"));var a={splitLine:{show:!i,lineStyle:{opacity:this.get(n+".SplitLine.LineOpacity")/100,color:a,type:this.get(n+".SplitLine.LineStyle")}}},p=this.chartColumns[s],h=this.generateAxisFormatter(s,r),s=this.get(n+".Labels.Interval"),n={show:e,color:t,rotate:this.get(n+".Labels.LabelRotate"),fontFamily:this.get(n+".Labels.LabelFont"),fontSize:this.get(n+".Labels.LabelFontSize"),fontStyle:this.get(n+".Labels.LabelFontStyle")};return s&&(n.interval=s),e&&(n.formatter=function(t,e){return o.getAxisLabelFormatter(t,l[e],r,p,h)}),_.extend({},{axisLine:{show:e,lineStyle:{color:t},onZero:!1},axisTick:{alignWithLabel:!1,interval:s||"auto",show:e,inside:!0,lineStyle:{color:t}},axisLabel:n},a)},it.prototype.generateAxisTitleOptions=function(t,e,i){var a="XAxis"===t,r=this.chartData.metaData[a?i:e].colId,i=this.axisKeyMap[t],e=_.isObject(this.chartColumns[r])&&this.chartColumns[r].ColumnTitle?this.chartColumns[r].ColumnTitle:r,t=this.get(i+".Title.NameColor"),r=this.get(i+".Title.TitleOffset"),i={name:e,nameRotate:a?0:90,nameLocation:"middle",nameTextStyle:{padding:a?[r,0,0,0]:[0,0,r,0],fontSize:this.get(i+".Title.AxisTitleSize")}};return t&&(i.nameTextStyle.color=t),i},it.prototype.generateAxisOptions=function(t,e,i,a,r,o,n){var s=!1,l="XAxis"===t?"bottom":"left",p="XAxis"===t?i:e,h=this.chartData.metaData[p].kdbType,d=12<=h&&h<=19?"time":"value",u="gr"+(n?"H":"")+e+"-"+i,a=(s=a?"XAxis"===t?e===o-1&&!n:0===i&&!n:s)&&(e===o-1||0===i),o=y.calculateMinMaxOffset(this.chartData.minMax[p]),h=this.generateAxisNestedOptions(t,s,r,p,h),o={min:Number(this.chartData.minMax[p][0])-o,max:Number(this.chartData.minMax[p][1])+o},a={id:u,gridId:u,splitNumber:4,position:l,type:n?"value":d,scale:!n||"XAxis"===t,axisPointer:{show:!n,lineStyle:{opacity:r?0:1},label:{show:a},triggerTooltip:!r}};r||(a.boundaryGap=[o.min,o.max],_.extend(a,o));o={};return s&&(o=this.generateAxisTitleOptions(t,e,i),_.extend(a,o)),_.extend(a,h)},it.prototype.generateChartOptions=function(t,e,i){for(var a,r=i||0,o=!!i,n=this.chartData.metaData.length,s=0;s<n;s+=1){for(var l=!0,p=0;p<n;p+=1){var h=o?p:s,d=o?s:p,u=o?"yAxisId":"xAxisId",c="gr"+d+"-"+h,g=s===p;l&&(this.chartData.linksOptions[r]=((a={})[u]=[],a),l=!1),this.chartData.linksOptions[r][u].push(c),n<=n-s+p&&(s!==p||!o)||(t.grid.push(this.generateGridOptions(d,h,n)),t.xAxis.push(this.generateAxisOptions("XAxis",d,h,o,g,n)),t.yAxis.push(this.generateAxisOptions("YAxis",d,h,o,g,n)),t.series.push(this.generateSeriesOptions(d,h,g)),e&&g&&(e.grid.push(this.generateGridOptions(d,h,n,!0)),e.xAxis.push(this.generateAxisOptions("XAxis",d,h,o,g,n,!0)),e.yAxis.push(this.generateAxisOptions("YAxis",d,h,o,g,n,!0)),e.series.push(this.generateSeriesOptions(d,h,g,!0))))}r++}return r},it.prototype.generateGridOptions=function(t,e,i,a){var r="gr"+(a?"H":"")+t+"-"+e,o=this.get("Style.AxisPadding"),n=100-o,a=(n-o-1.5)/i-1.5,i=(n-o-10-3)/i-3;return{id:r,left:o/2+o+e*(1.5+a)+"%",top:10+t*(3+i)+"%",width:a+"%",height:i+"%"}},it.prototype.generateSeriesOptions=function(t,e,i,a){var r,o=this.chartData.id+(a?"H":"")+t+"-"+e,n=this.getChartData(e,t);if(n.length){a&&(r=this.chartData.data[e],n=s.histogram(r).customData);i={name:this.chartData.name+(a?"H":"")+t+"-"+e,type:a?"custom":"scatter",xAxisId:o,yAxisId:o,id:o,symbolSize:5,itemStyle:{color:k.DEFAULTSETTINGS.pointsColor,opacity:i&&!a?0:1},data:n};return a&&_.extend(i,{renderItem:function(t,e){var i=e.value(2),a=e.coord([e.value(0),i]),i=e.size([e.value(1)-e.value(0),i]);return{type:"rect",shape:{x:a[0],y:a[1],width:.99*i[0],height:i[1]},style:e.style()}},dimensions:["x0","x1","sampleNum"],encode:{x:[0,1],y:2,tooltip:[0,1,2]}}),n.length>this.appView.largeDataThreshold&&!a&&(this.isLargeData=!0,_.extend(i,{large:!0,largeThreshold:1,progressive:n.length,progressiveThreshold:10}),this.appView.notificationTimeout||this.appView.showNotification("Large data threshold is reached",5e3)),i}},it.prototype.getAxisLabelFormatter=function(t,e,i,a,r){var o=a.Prefix,a=a.Suffix;return o+r(this.convertValueForFormater(t,i))+a},it.prototype.getChartData=function(t,e){var i=this.chartData.data,a=[];if(!i.length)return[];for(var r=0;r<i[0].length;r++){var o=[i[t][r],i[e][r]];a.push(o)}return a},it.prototype.getPointerLabelFormatter=function(t){if(!t.seriesData.length)return t.value;var e=t.seriesData[0],i="custom"===e.componentSubType,t=t.value,i=this.extractColsMetadataFromSeriesId(e,t,!1,i),t=this.convertValueForFormater(t,i.kdbType);return this.generateAxisFormatter(i.colId,i.kdbType)(t)},it.prototype.getDataAccessor=function(t){var e=this.dataSource,a=e.getPropertyFromColumn(t.toString()),r=e.getColumnType(a);return 12<=r&&r<=19?function(t){var e=_.cloneDeep(t.get(a)),i=_.isNaN(Number(e.i))?null:Number(e.i);return 13===r&&((t=l.tz("2000-01-01","UTC")).add(e.i,"month"),i=t.valueOf()),i}:7==r?function(t){return null!=t.get(a)?Number(t.get(a)):null}:function(t){return t.get(a)}},it.prototype.getTooltipFormatter=function(t,e,i){var l=this,a=(this.dataDefFormattersMap,this.$appEl.outerHeight()-60),p=this.crosshairModel.get("Overlay.FontSize"),h={fontSize:"font-size:"+p+"px",maxHeight:"max-height:"+a+"px;",xLabel:"",points:[]};if(_.isArray(t)&&t.length){var r=(t=y.filterTooltipArraySeries(t))[0].axisValueLabel;h.xLabel=r,_.each(t,function(t,e){var i,a,r,o,n=t.dataIndex,s=l.extractColsMetadataFromSeriesId(t);s?(o=s.kdbType,i=l.dataSource.getData().at(n),a=l.convertValueForFormater(t.value[1],o),r=l.getTooltipLegendStyles(),n=y.renderSVGIcon(r,p),o=l.generateAxisFormatter(s.colId,o),n={plotColor:r.plotColor,layerData:t.value[1],layerDataFormatted:o(a),chartName:t.seriesName,svg:n,noSvg:!n.length,iconFa:r.legendIcon},i&&(n.cols=i.toJSON()),n.svg=y.renderSVGIcon(r,p),h.points[e]=n):console.log("Tooltip metaData undefined for id: ",t.seriesId)})}else{if(!_.isObject(t))return console.info("Unable to generate tooltip, no series data. Check you chart setting"),"";var o=t.dataIndex,n=this.extractColsMetadataFromSeriesId(t);if(!n)return void console.log("Tooltip metaData undefined for id: ",t.seriesId);var s=n.kdbType,d=this.dataSource.getData().at(o),a=this.convertValueForFormater(t.value[1],s),r=this.getTooltipLegendStyles(),o=y.renderSVGIcon(r,p),s=this.generateAxisFormatter(n.colId,s),o={plotColor:r.plotColor,layerData:t.value[1],layerDataFormatted:s(a),chartName:t.seriesName,svg:o,noSvg:!o.length,iconFa:r.legendIcon};d&&(o.cols=d.toJSON()),t.name?h.xLabel=t.name:(d=(r=this.extractColsMetadataFromSeriesId(t,t.value[0])).kdbType,t=this.convertValueForFormater(t.value[0],d),d=this.generateAxisFormatter(r.colId,d),h.xLabel=d(t)),h.points=[o],this.pushToTemplate(h)}this.pushToTemplate(h)},it.prototype.getTooltipLegendStyles=function(){return{legendIconCustom:"",legendIcon:"fa-circle",plotColor:k.DEFAULTSETTINGS.pointsColor}},it.prototype.setBrushOptions=function(t){!this.isLargeData&&this.get("Style.MatrixBrushTool")&&(t.brush={brushLink:"all",inBrush:{opacity:1}},t.toolbox={feature:{brush:{title:{rect:"Rectangle selection",polygon:"Polygon selection",lineX:"Horizontal selection",lineY:"Vertical selection",keep:"Keep previous select...",clear:"Clear selection"}}}})},it.prototype.updateColumnsModelsRefs=function(){var i,t,a=this;this.settingsOptionsReady&&this.dataSource&&(this.matrixColsModelsSet=!0,i=[],this.columns=[],this.chartColumns={},this.matrixCols.forEach(function(t){var e=t.get("MatrixColId"),e=y.getColumnKeysFromAxisString(e,a.dataSource);_.isArray(e)&&e.length&&i.push({cid:t.cid,cols:e})}),t=_.sortBy(i,function(t){return t.cols.length}),_.each(t,function(t){var i=t.cid;_.each(t.cols,function(t){var e;-1===a.columns.indexOf(t)&&(e=a.matrixCols.get(i),e=_.pickBy(e.toJSON(),function(t,e){if(!_.includes(["_Hidden","MatrixColId"],e))return{k:t}}),a.columns.push(t),a.chartColumns[t]=e)})}),this.updateChartData())},it.prototype.getAxisPointerOptions=function(){var t={show:!0,snap:this.crosshairModel.get("Overlay.Snap"),lineStyle:{type:this.crosshairModel.get("Overlay.TooltipAxisPointerType")},label:{show:!0,formatter:_.bind(this.getPointerLabelFormatter,this),textStyle:{color:k.THEMECOLORSCHEME[this.theme].inverse}}},e=this.chartData.linksOptions;return e.length&&(t.link=e),t},it.prototype.getTooltipOptions=function(){return{show:this.crosshairModel.get("Overlay.Display"),confine:!0,formatter:_.bind(this.getTooltipFormatter,this)}},it.prototype.updateChartData=function(){var r,t,o=this,n=this.dataSource,e={backgroundColor:"transparent",grid:[],xAxis:[],yAxis:[],series:[],tooltip:this.getTooltipOptions()},i={backgroundColor:"transparent",grid:[],xAxis:[],yAxis:[],series:[],tooltip:this.getTooltipOptions()};this.isReadyForChartRender=this.settingsOptionsReady&&this.matrixColsModelsSet,!this.appView.propertiesChanging&&void 0!==n&&this.isReadyForChartRender&&(this.isLargeData=!1,r=0,_.each(["metaData","data","minMax","linksOptions"],function(t){o.chartData[t]=[]}),_.each(this.columns,function(t){var e=n.getColumnType(t),i=-1!==o.VALIDKDBTYPES.indexOf(e),a=t?o.getDataAccessor(t):null;a&&i?(i=n.getData().map(function(t){return a(t)}),o.chartData.metaData[r]={kdbType:e,colId:t},o.chartData.data[r]=i,o.chartData.minMax[r]=y.calculateDataMinMax(i),r+=1):console.info("!Invalid datatype or column name, properties will be ignored: ",{columnKdbType:e,columnName:t})}),this.chartData.metaData.length&&this.chartData.data.length&&(t=this.generateChartOptions(e),this.generateChartOptions(e,i,t),e.axisPointer=this.getAxisPointerOptions(),this.setBrushOptions(e)),this.chartOptions=e,this.chartHistOptions=i,this.trigger("updateChart",!0))},it.prototype.onColumnPropChanged=function(t){!this.settingsOptionsReady&&this.matrixColsModelsSet&&(this.matrixColsModelsSet=!1),t?this.updateColumnsModelsRefs():this.updateChartData()},it.prototype.getChartOptions=function(t){return t?this.chartHistOptions:this.chartOptions},it.prototype.setTheme=function(t){this.theme=t,this.onColumnPropChanged(!1)},it.prototype.updateDataSource=function(t){t?(this.dataSource=t,this.onColumnPropChanged(!0)):console.log("updateData() call without datasource property")},it);function it(t,e,i,a,r){var o=tt.call(this)||this;return o.settingsOptionsReady=!1,o.isReadyForChartRender=!1,o.columnsCollectionChanged=!1,o.matrixColsModelsSet=!1,o.theme="dark",o.isLargeData=!1,o.chartOptions={},o.chartHistOptions={},o.chartData={key:"gr",name:"Chart-",id:"gr",data:[],metaData:[],minMax:[],linksOptions:[]},o.axisKeyMap={XAxis:"MatrixXAxes",YAxis:"MatrixYAxes"},o.chartColumns={},o.columns=[],o.dataDefFormattersMap={5:y.getFormatter("Number",0,!1,""),6:y.getFormatter("Number",0,!1,""),7:y.getFormatter("Number",0,!1,""),8:y.getFormatter("Number",0,!0,""),9:y.getFormatter("Number",0,!0,""),12:y.getFormatter("Datetime",0,!1,"YYYY-MM-DD hh:mm:ss"),13:y.getFormatter("Datetime",0,!1,"YYYY-MM"),14:y.getFormatter("Datetime",0,!1,"YYYY-MM-DD"),15:y.getFormatter("Datetime",0,!1,"YYYY-MM-DD hh:mm:ss"),16:y.getFormatter("Datetime",0,!1,"HH:mm:ss.SS"),17:y.getFormatter("Datetime",0,!1,"mm:ss"),18:y.getFormatter("Datetime",0,!1,"HH:mm:ss"),19:y.getFormatter("Datetime",0,!1,"HH:mm:ss.SS")},o.VALIDKDBTYPES=[5,6,7,8,9,12,13,14,15,16,17,18,19],o.api=t,o.matrixCols=e,o.crosshairModel=i,o.appView=a,o.$appEl=r,o.$tooltipArea=_.first(r.find(".tooltip")),o.listenTo(o,"change:Style",o.updateChartData),o.listenTo(o,"change:MatrixXAxes change:MatrixYAxes",o.updateChartData),o.listenTo(i,"updateChart",o.updateChartData),o.listenTo(e,"updateMatrixChart",o.onColumnPropChanged),o}var at,rt=d.Tools,ot=(at=o.View,n(nt,at),nt.prototype.initAxis=function(){var t=this,e=new x;return this.listenTo(e,"update",function(){t.chartModel.updateAxisModelsRefs(),t.updateChart()}),e},nt.prototype.intiMatrixColumns=function(){var t=this,e=new E;return this.listenTo(e,"update",function(){t.matrixModel.onColumnPropChanged(!0)}),e},nt.prototype.onSettingsChange=function(t){nt.DEBUG&&console.debug("%c[DEBUG][ECHARTS] -> onSettingsChange ","color: green;",arguments);var e=!!this.isPendingFirstOnSettingsChange;this.isPendingFirstOnSettingsChange&&(this.isPendingFirstOnSettingsChange=!1);var i=y.expandNestedViewStates(t,this.api),i=y.replaceViewStatesWithValue("",i,this.api),i=y.pump(i);this.onSettingsChangeProcessed.call(this,i,t),e&&(this.isReadyForThemeChange=!0,this.isPendingFirstOnSettingsChange=!1,this.setThemeAccordingToDashboardSettings())},nt.prototype.onSettingsChangeProcessed=function(e,t){var i=this,a=!1;1<_.keys(e).length&&(this.matrixModel.settingsOptionsReady=!1,this.chartModel.settingsOptionsReady=!1),e.hasOwnProperty("Basics")&&e.Basics.Data&&this.onSettingsDataChanged.call(this,e.Basics.Data),e.hasOwnProperty("Basics")&&e.Basics.ChartType&&(a=!0,this.onSettingsChartTypeChanged.call(this,e.Basics.ChartType)),_.isObject(e.MatrixCols)&&this.onSettingsMatrixColsChanged.call(this,e.MatrixCols),_.isObject(e.Style)&&this.onSettingsMatrixStylesChanged.call(this,e.Style),["MatrixXAxes","MatrixYAxes"].forEach(function(t){_.isObject(e[t])&&i.onSettingsMatrixAxisChanged.call(i,t,e[t])}),_.isObject(e.Charts)&&this.onSettingsChartChanged.call(this,e.Charts),["XAxes","YAxes"].forEach(function(t){_.isArray(e[t])&&i.onAxisSettingsChanged.call(i,t,e[t])}),_.isObject(e.Legend)&&this.onLegendSettingsChanged.call(this,e.Legend),_.isObject(e.Overlay)&&this.onOverlaySettingsChanged.call(this,e.Overlay),e.hasOwnProperty("Basics")&&e.Basics.LargeDataThreshold&&this.onSettingsLargeDataThresholdChanged.call(this,e.Basics.LargeDataThreshold),this.matrixModel.settingsOptionsReady&&this.chartModel.settingsOptionsReady||!(a||1<_.keys(e).length)||(this[a=this.isMatrix?"matrixModel":"chartModel"].settingsOptionsReady=!0,this.isMatrix&&!this.matrixModel.matrixColsModelsSet?this.matrixModel.onColumnPropChanged(!0):this[a].updateChartData(!0))},nt.prototype.setThemeAccordingToDashboardSettings=function(){this.isReadyForThemeChange&&this.setTheme(this.dashboardViewModel.get("DashboardTheme"))},nt.prototype.onSettingsChartTypeChanged=function(t){var e=this;this.isMatrix="matrix"===t,this.destroyChart(),_.defer(function(){e.dataSource&&e.dataSource.hasData()&&e.updateDataSource(e.dataSource)})},nt.prototype.onSettingsDataChanged=function(t){var i=this;nt.DEBUG&&console.debug("[DEBUG][ECHARTS] -> onSettingsLayersChanged ",arguments);void 0!==this.dataSource&&this.dataSource.getKey()!==t.cid&&this.dataSource.updateSourceSubscribe(t),this.dataSource?this.dataSource.hasData()&&this.updateDataSource(this.dataSource):(this.dataSource=new W(t,this,this.api),this.dataSource.subscribe()),this.listenTo(t,"change:queryStatus",function(t,e){i.updateError(i.dataSource,e)})},nt.prototype.onSettingsChartChanged=function(t){this.chartModel.set({Charts:t})},nt.prototype.onSettingsLargeDataThresholdChanged=function(t){this.largeDataThreshold=t,this.isMatrix?this.matrixModel.updateChartData():this.chartModel.updateChartData(!0)},nt.prototype.onSettingsMatrixAxisChanged=function(t,e){this.matrixModel.set(t,e)},nt.prototype.onSettingsMatrixColsChanged=function(t){var i=this.matrixCols,a=[];_.each(t,function(e){var t=i.find(function(t){return t.get("_Hidden._ColId")===e._Hidden._ColId});(t=t||new N({})).set(e),a.push(t)}),i.set(a)},nt.prototype.onSettingsMatrixStylesChanged=function(t){this.matrixModel.set("Style",t)},nt.prototype.onAxisSettingsChanged=function(i,t){var a=this,r="XAxes"===i?this.xAxes:this.yAxes,e=_.map(r.map("_Hidden"),"_AxisId"),o=[];e.some(_.negate(Boolean))&&console.warn('all existing axes should have an "_AxisId" attribute set'),_.each(t,function(e){var t=r.find(function(t){return t.get("_Hidden._AxisId")===e._Hidden._AxisId});(t=t||new g({},a.api,g.singular(i),a)).set(e),o.push(t)}),r.set(o)},nt.prototype.onLegendSettingsChanged=function(t){t.LegendPosition&&this.chartModel.set({"Legend.LegendPosition":t.LegendPosition}),this.legendModel.set({Legend:t})},nt.prototype.onOverlaySettingsChanged=function(t){this.crosshairModel.set({Overlay:t})},nt.prototype.updateDataSource=function(e){if(this.isMatrix){var i=d.HeuristicHelpers.getScalarColumns(e),a=this.errors[e.getKey()];if(this.matrixModel.updateDataSource(e),0===i.length&&(!a||"Loading"===_.get(a,"type")))return void this.api.showErrorMessage({error:t("Data Source provided is not valid for Scatter Plot"),type:"Warning"});this.options.settingsModel.trigger("transform",i[0],"MatrixCols.0.MatrixColId")}else this.chartModel.updateDataSource(e);this.crosshairModel.updateDataSource(e)},nt.prototype.intitializeChart=function(t){var e,r=this;this.isPendingFirstOnSettingsChange||void 0!==this.dataSource&&!this.dataSource.hasData()||(e=this.$echart.get(0),this.destroyChart(),this.chart=i.init(e),this.chartResize(),_.each(t,function(t){r.chart.setOption(t)}),this.chart.off("showTip",null),this.chart.on("showTip",function(t){var e,i,a;r.tooltip&&_.isNumber(t.x)&&_.isNumber(t.y)&&(e={},r.crosshairModel.get("Overlay.FixedPosition")?(i=r.$el.width()||0,a=r.$el.height()||0,e[["left","right"][+(t.x<i/2)]]=60,e[["top","bottom"][+(t.y<a/2)]]=20):(e.left=t.x+20,e.top=t.y+20),r.tooltip.updatePosition(e))}),this.chart.off("globalout",null),this.chart.on("globalout",function(){r.tooltip&&(r.api.removeTooltip(),delete r.tooltip)}))},nt.prototype.destroyChart=function(){var t=this.$echart.get(0);this.chart&&(this.chart.clear(),this.chart.dispose(t),delete this.chart)},nt.prototype.prepareChart=function(){var t={};return this.isMatrix?[t=this.matrixModel.getChartOptions(),this.matrixModel.getChartOptions(!0)]:(t={backgroundColor:"transparent",tooltip:this.crosshairModel.getTooltipOptions(),axisPointer:this.crosshairModel.getAxisPointerOptions(),grid:this.chartModel.getGridOptions(),xAxis:this.chartModel.getAxisOptions("XAxis"),yAxis:this.chartModel.getAxisOptions("YAxis"),series:this.chartModel.getSeriesOptions()},this.legendModel.useHtml()||_.extend(t,{legend:this.legendModel.getChartLegendOptions()}),[t])},nt.prototype.updateChartWrapper=function(t){this.isMatrix||this.updateChart(t)},nt.prototype.updateChart=function(t){var e=this,i=this.isMatrix?"matrixModel":"chartModel";this.isReadyForThemeChange&&this[i].isReadyForChartRender&&!this.propertiesChanging&&(this.updateLegends(),((i=this.prepareChart())[0].grid&&i[0].grid.length||t)&&(nt.DEBUG&&console.log("%c[DEBUG][ECHARTS] -> grid options: ","color: green;",i),!this.chart||t?this.intitializeChart(i):(this.chartResize(),_.each(i,function(t){e.chart.setOption(t)}))))},nt.prototype.updateLegends=function(){var t=this.legendModel.getLegendOptions();this.$legends.html(),this.$legends.removeClass("top bottom left right hidden"),this.legendModel.useHtml()?(this.$legends.html(p.legend(t.data)),this.$legends.addClass(t.position)):this.$legends.addClass("hidden")},nt.prototype.remove=function(){return clearTimeout(this.notificationTimeout),this.destroyChart(),o.View.prototype.remove.apply(this)},nt.prototype.chartResize=function(){var t,e;this.chart&&(t=this.$el.innerWidth(),e=this.$el.innerHeight(),this.chart.resize({width:t,height:e}))},nt.prototype.onResizeStop=function(){var t=this;_.debounce(function(){t.chartResize()},200)()},nt.prototype.setTheme=function(t){t=t?t.toLowerCase():"dark";this.isReadyForThemeChange=!1,this.chartModel.setTheme(t),this.matrixModel.setTheme(t),this.crosshairModel.setTheme(t),this.isReadyForThemeChange=!0,this.updateChart()},nt.prototype.showNotification=function(t,e){var i=this;e&&!this.notificationTimeout&&(this.notificationTimeout=setTimeout(function(){i.$notifications.hasClass("hidden")||i.stopNotification()},e)),this.$notifications.toggleClass("hidden",!1),this.$notifications.text(t)},nt.prototype.stopNotification=function(){this.notificationTimeout&&(clearTimeout(this.notificationTimeout),this.notificationTimeout=null),this.$notifications.toggleClass("hidden",!0)},nt.prototype.updateError=function(t,e){var a=this,t=t.getKey();e?this.errors[t]=e:this.errors[t]?delete this.errors[t]:this.errors={};function i(t){return"Error"===t?3:"Loading"===t?2:"NoResults"===t?1:0}e=_.reduce(this.errors,function(t,e){e=e.type;return i(e)>i(t)?e:t},"");e&&("NoResults"!=e||_.keys(this.dataSource).length===_.keys(this.errors).length)?(t=_.map(this.errors,function(t,e){var i=t.error,t=a.dataSource;return i?"["+t.getPath()+"]: "+i:null}).filter(function(t){return t}),this.api.showQueryStatus({error:t.join("\n"),type:e})):this.api.hideQueryStatus()},nt.getComponentDefinition=Y.getComponentDefinition,nt.DEBUG=!1,nt);function nt(t){var e=at.call(this,t)||this;return e.largeDataThreshold=100,e.isPendingFirstOnSettingsChange=!0,e.isReadyForThemeChange=!1,e.errors={},e.isMatrix=!0,e.propertiesChanging=!1,e.isMatrix="matrix"===t.settingsModel.get("Basics.ChartType"),e.api=t.api,e.options=t,e.dashboardViewModel=t.dashboardViewModel,e.$el.html(p.app({})),e.$el.addClass("scatter-plot"),e.$echart=e.$el.find(".chart-area"),e.$legends=e.$el.find(".chart-legends-container"),e.$notifications=e.$el.find(".notifications-panel"),e.xAxes=e.initAxis(),e.yAxes=e.initAxis(),e.matrixCols=e.intiMatrixColumns(),e.chartModel=new V(e.api,e.xAxes,e.yAxes,e),e.legendModel=new J(e.chartModel,e),e.crosshairModel=new K(e.dataSource,e.api,e.$el,_.bind(e.chartModel.getAxisFormatters,e.chartModel),_.bind(e.chartModel.getChartDataObj,e.chartModel),_.bind(e.chartModel.getTooltipSvgStyles,e.chartModel),_.bind(e.chartModel.getVisbileCharts,e.chartModel)),e.matrixModel=new et(e.api,e.matrixCols,e.crosshairModel,e,e.$el),e.listenTo(e.chartModel,"updateChart",e.updateChart),e.listenTo(e.matrixModel,"updateChart",e.updateChart),e.listenTo(e.crosshairModel,"updateChart",e.updateChartWrapper),e.listenTo(e.legendModel,"updateChart",e.updateChartWrapper),e}return ot});