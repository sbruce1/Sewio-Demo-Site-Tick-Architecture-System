define(["backbone","Breadcrumbs","Forms","Fuse","Handlebars","moment","purify","rxjs","QuickBase","css!./css/app.css"],function(Backbone,Breadcrumbs,BBForm,Fuse,Handlebars,moment,DOMPurify,rxjs,QuickBase){var __extends=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),a,__spreadArrays=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),a=0,t=0;t<i;t++)for(var o=arguments[t],s=0,r=o.length;s<r;s++,a++)n[a]=o[s];return n},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},T=(A.Accordion=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o;return'<div class="section">\r\n    <div class="heading"><i class="fa fa-caret-right"></i> <input type="checkbox"/>'+e.escapeExpression("function"==typeof(o=null!=(o=i.heading||(null!=t?t.heading:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"heading",hash:{},data:a}):o)+'</div>\r\n    <div class="content"></div>\r\n</div>\r\n'},useData:!0}),A.AnalyticParamItem=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r=e.escapeExpression,l="function";return'<div class="buttonsContainer">\r\n\t<button class="generate-view-state">'+r((i.t||t&&t.t||s).call(o,"Generate Viewstate Path",{name:"t",hash:{},data:a}))+'</button>\r\n\t<div id="'+r(typeof(e=null!=(e=i.radioId||(null!=t?t.radioId:t))?e:s)==l?e.call(o,{name:"radioId",hash:{},data:a}):e)+'">\r\n\t\t<input type="radio" id="'+r(typeof(e=null!=(e=i.radio1Id||(null!=t?t.radio1Id:t))?e:s)==l?e.call(o,{name:"radio1Id",hash:{},data:a}):e)+'" name="'+r(typeof(e=null!=(e=i.radioId||(null!=t?t.radioId:t))?e:s)==l?e.call(o,{name:"radioId",hash:{},data:a}):e)+'" value="viewState"><label for="'+r(typeof(e=null!=(e=i.radio1Id||(null!=t?t.radio1Id:t))?e:s)==l?e.call(o,{name:"radio1Id",hash:{},data:a}):e)+'" class="firstLabel">'+r((i.t||t&&t.t||s).call(o,"Existing Viewstate Path",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t<input type="radio" id="'+r(typeof(e=null!=(e=i.radio2Id||(null!=t?t.radio2Id:t))?e:s)==l?e.call(o,{name:"radio2Id",hash:{},data:a}):e)+'" name="'+r(typeof(e=null!=(e=i.radioId||(null!=t?t.radioId:t))?e:s)==l?e.call(o,{name:"radioId",hash:{},data:a}):e)+'" value="text"><label for="'+r(typeof(e=null!=(e=i.radio2Id||(null!=t?t.radio2Id:t))?e:s)==l?e.call(o,{name:"radio2Id",hash:{},data:a}):e)+'">'+r((i.t||t&&t.t||s).call(o,"Text",{name:"t",hash:{},data:a}))+'</label>\r\n\t</div>\r\n</div>\r\n\r\n<div class="analyticParamErrorDialog" style="display: none;">View state parameter type does not match analytic parameter type.</div>'},useData:!0}),A.AnalyticParamsView=Handlebars.template({1:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'        <div class="parameterItem">\r\n            <div class="label">'+l(typeof(e=null!=(e=i.Name||(null!=t?t.Name:t))?e:s)==r?e.call(o,{name:"Name",hash:{},data:a}):e)+" ("+l(typeof(e=null!=(e=i.Type||(null!=t?t.Type:t))?e:s)==r?e.call(o,{name:"Type",hash:{},data:a}):e)+')</div>\r\n            <input class="value" value="'+l(typeof(e=null!=(e=i.DefaultValue||(null!=t?t.DefaultValue:t))?e:s)==r?e.call(o,{name:"DefaultValue",hash:{},data:a}):e)+'" />\r\n        </div>\r\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="<fieldset>\r\n    <legend>"+e.escapeExpression((i.t||t&&t.t||s).call(o,"Parameters",{name:"t",hash:{},data:a}))+'</legend>\r\n    <div class="parameterList">\r\n',l=null!=(l=i.Parameters||(null!=t?t.Parameters:t))?l:s,a={name:"Parameters",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},l="function"==typeof l?l.call(o,a):l;return null!=(l=!i.Parameters?i.blockHelperMissing.call(t,l,a):l)&&(r+=l),r+"    </div>\r\n</fieldset>\r\n"},useData:!0}),A.BreadcrumbsWrapper=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return""},useData:!0}),A.BulkColumnEditorDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="pnlInfo">\r\n</div>\r\n\r\n\r\n<div class="pnlLeft">\r\n    <ul class="lstColumns">\r\n    </ul>    \r\n</div>\r\n\r\n\r\n\r\n<div class="properties-panel">\r\n    <div class="pnlPropertyEditor"></div>\r\n</div>'},useData:!0}),A.ColorPickerDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<ul>\r\n    <li><a href="#colorPickerSolid">Solid</a></li>\r\n    <li><a href="#colorPickerGradient">Gradient</a></li>\r\n\r\n</ul>\r\n<div id="colorPickerSolid">\r\n    <div class="solid_color"></div>\r\n</div>\r\n<div id="colorPickerGradient">\r\n    <table>\r\n        <tr>\r\n            <td style="width: 185px;">'+e((i.t||t&&t.t||s).call(o,"Type",{name:"t",hash:{},data:a}))+'</td>\r\n            <td>\r\n                <select class="colorPickerType">\r\n                    <option>'+e((i.t||t&&t.t||s).call(o,"linear",{name:"t",hash:{},data:a}))+"</option>\r\n                    <option>"+e((i.t||t&&t.t||s).call(o,"radial",{name:"t",hash:{},data:a}))+'</option>\r\n                </select>\r\n            </td>\r\n            <td>\r\n                <select class="colorPickerDirection">\r\n                    <option>'+e((i.t||t&&t.t||s).call(o,"left",{name:"t",hash:{},data:a}))+"</option>\r\n                    <option>"+e((i.t||t&&t.t||s).call(o,"right",{name:"t",hash:{},data:a}))+"</option>\r\n                    <option>"+e((i.t||t&&t.t||s).call(o,"top",{name:"t",hash:{},data:a}))+"</option>\r\n                    <option>"+e((i.t||t&&t.t||s).call(o,"bottom",{name:"t",hash:{},data:a}))+"</option>\r\n                    <option>"+e((i.t||t&&t.t||s).call(o,"45deg",{name:"t",hash:{},data:a}))+'</option>\r\n                </select>\r\n            </td>\r\n        </tr>\r\n        <tr>\r\n            <td></td>\r\n            <td colspan="3">\r\n                <div class="grad_ex" id="ex1"></div>\r\n            </td>\r\n        </tr>\r\n        \x3c!--<tr><td>'+e((i.t||t&&t.t||s).call(o,"Selected Css",{name:"t",hash:{},data:a}))+'</td><td><input id="cssGradient" class="cssGradient" type="text" placeholder="css" readonly></td></tr>--\x3e\r\n        <tr>\r\n            <td>'+e((i.t||t&&t.t||s).call(o,"Preview",{name:"t",hash:{},data:a}))+'</td>\r\n            <td colspan="3">\r\n                <div class="left"></div>\r\n            </td>\r\n        </tr>\r\n\r\n    </table>\r\n\r\n</div>\r\n'},useData:!0}),A.ColumnsDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="addNewColumn">'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"Add Column",{name:"t",hash:{},data:a}))+"</div>"},useData:!0}),A.ComponentDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o;return'<div class="thumb">\r\n    <img src="'+e.escapeExpression("function"==typeof(o=null!=(o=i.listViewThumb||(null!=t?t.listViewThumb:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"listViewThumb",hash:{},data:a}):o)+'" />\r\n    <div class="file-btn-wrapper">\r\n        <input class="file-input" type="file" />\r\n    </div>\r\n    <button class="upload-btn">\r\n        Upload Icon\r\n    </button>\r\n</div>\r\n<div class="form"></div>'},useData:!0}),A.ComponentListView=Handlebars.template({1:function(e,t,i,n,a){return'        <span class="ui-widget-content">'+e.escapeExpression(e.lambda(t,t))+"</span>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o,s,r=null!=t?t:e.nullContext||{},l=i.helperMissing,c="function",d=e.escapeExpression;return'<div class="icon">'+(null!=(o=typeof(s=null!=(s=i.listViewThumb||(null!=t?t.listViewThumb:t))?s:l)==c?s.call(r,{name:"listViewThumb",hash:{},data:a}):s)?o:"")+'</div>\r\n<div class="name">'+d(typeof(s=null!=(s=i.componentName||(null!=t?t.componentName:t))?s:l)==c?s.call(r,{name:"componentName",hash:{},data:a}):s)+'</div>\r\n<div class="description">'+d((i.t||t&&t.t||l).call(r,null!=t?t.componentDescription:t,{name:"t",hash:{},data:a}))+'</div>\r\n<div class="tags">\r\n'+(null!=(o=i.each.call(r,null!=t?t.tags:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"</div>"},useData:!0}),A.ComponentsPanel=Handlebars.template({1:function(e,t,i,n,a){return'    <a class="add" title="'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"Add a new Widget",{name:"t",hash:{},data:a}))+'"><i class="fa fa-plus fa-fw"></i></a>\r\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="panel-header">\r\n    <div class="pin-button">\r\n        <i class="fa fa-caret-right"></i><i class="fa fa-caret-right"></i>\r\n    </div>\r\n    <div class="search-box">  \r\n        <input type="text" placeholder="search components..."/>\r\n        <div class="fa fa-fw fa-search" />\r\n        <div class="fa fa-times">\r\n        </div>\r\n    </div>\r\n'+(null!=(a=i.unless.call(null!=t?t:e.nullContext||{},null!=t?t.isLite:t,{name:"unless",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?a:"")+'</div>\r\n\r\n<div class="components-list">\r\n</div>\r\n<div class="scroll-up">\r\n    <i class="fa fa-fw fa-caret-up"></i>\r\n</div>\r\n<div class="scroll-down">\r\n    <i class="fa fa-fw fa-caret-down"></i>\r\n</div>\r\n'},useData:!0}),A.ConnectionManagement=Handlebars.template({1:function(e,t,i,n,a){return'\t\t\t\t\t\t<option value="q">'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"kdb",{name:"t",hash:{},data:a}))+"</option>\r\n"},3:function(e,t,i,n,a){return'\t\t\t\t\t\t<option value="q">'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"kdb",{name:"t",hash:{},data:a}))+'</option>\r\n\t\t\t\t\t\t<option value="jdbc:com.mysql.jdbc.Driver">mysql</option>\r\n\t\t\t\t\t\t<option value="jdbc:oracle.jdbc.OracleDriver">oracle</option>\r\n\t\t\t\t\t\t<option value="jdbc:com.microsoft.sqlserver.jdbc.SQLServerDriver">mssql</option>\r\n\t\t\t\t\t\t<option value="daemon">daemon</option>\r\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o,s=null!=t?t:e.nullContext||{},r=i.helperMissing,l="function",c=e.escapeExpression;return'<div class="connectionsTabs" tabindex="0">\r\n\t<ul>\r\n\t\t<li><a href="#'+c(typeof(o=null!=(o=i.singleConnectionsId||(null!=t?t.singleConnectionsId:t))?o:r)==l?o.call(s,{name:"singleConnectionsId",hash:{},data:a}):o)+'">Individual</a></li>\r\n\t\t<li><a href="#'+c(typeof(o=null!=(o=i.groupConnectionsId||(null!=t?t.groupConnectionsId:t))?o:r)==l?o.call(s,{name:"groupConnectionsId",hash:{},data:a}):o)+'">Groups</a></li>\r\n\t\t<li><a href="#'+c(typeof(o=null!=(o=i.serivcesTabId||(null!=t?t.serivcesTabId:t))?o:r)==l?o.call(s,{name:"serivcesTabId",hash:{},data:a}):o)+'">Services</a></li>\r\n\t</ul>\r\n\t<div id="'+c(typeof(o=null!=(o=i.singleConnectionsId||(null!=t?t.singleConnectionsId:t))?o:r)==l?o.call(s,{name:"singleConnectionsId",hash:{},data:a}):o)+'">\r\n\t\t<div class="connectionsList singleConnectionsList">\r\n\t\t\t\x3c!--<div class="row">\r\n\t\t\t\t<div class="newConnectionButton btn">'+c((i.t||t&&t.t||r).call(s,"New Connection",{name:"t",hash:{},data:a}))+'</div>\r\n\t\t\t</div>\r\n\t\t\t<input class="filterBox singleFilter" placeholder="type to filter"/>\r\n\t\t\t<i class="fa fa-search filterIcon"></i>--\x3e\r\n\t\t\t<div class="singleConnectionsListGrid"></div>\r\n\t\t\t\x3c!--<ul></ul>--\x3e\r\n\t\t</div>\r\n\t\t<div class="connectionDetailsPanel">\r\n\t\t\t<div class="title"></div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Name:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="name" type="text" value="" />\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Type:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<select class="type" disabled>\r\n'+(null!=(e=i.if.call(s,null!=t?t.isLite:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a}))?e:"")+'\t\t\t\t</select>\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Host:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="host" type="text" value=""/>\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Port:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="port" type="text" value="" />\r\n\t\t\t</div>\r\n\t\t\t<div class="row databaseRow" style="display: none">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Database:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="database" type="text" value="" />\r\n\t\t\t</div>\r\n\t\t\t<div class="row integratedSecurityRow" style="display: none;">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Integrated Security:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="integratedSecurity" type="checkbox" value="" style="width: auto; margin-top: 5px;" />\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"User:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="user" type="text" value="" />\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Password:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="password" type="password" value="" />\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Confirm Password:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="confirmPassword" type="password" value="" />\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"TLS:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="tls" type="checkbox" value="" />\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div id="'+c(typeof(o=null!=(o=i.groupConnectionsId||(null!=t?t.groupConnectionsId:t))?o:r)==l?o.call(s,{name:"groupConnectionsId",hash:{},data:a}):o)+'">\r\n\t\t<div class="connectionsList groupConnectionsList">\r\n\t\t\t\x3c!--<input class="filterBox groupFilter" placeholder="type to filter"/>\r\n\t\t\t<i class="fa fa-search filterIcon"></i>--\x3e\r\n\t\t\t<div class="groupConnectionListGrid"></div>\r\n\t\t\t\x3c!--<ul></ul>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<div class="newGroupButton btn">'+c((i.t||t&&t.t||r).call(s,"New Group",{name:"t",hash:{},data:a}))+'</div>\r\n\t\t\t</div>\r\n\t\t\t--\x3e\r\n\t\t</div>\r\n\t\t<div class="groupDetailsPanel">\r\n\t\t\t<div class="title"></div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Group Name:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<input class="groupName" type="text" value="" disabled/>\r\n\t\t\t</div>\r\n\t\t\t<div class="row">\r\n\t\t\t\t<label>'+c((i.t||t&&t.t||r).call(s,"Group Type:",{name:"t",hash:{},data:a}))+'</label>\r\n\t\t\t\t<select class="groupType">\r\n\t\t\t\t\t<option value="DEFAULT">'+c((i.t||t&&t.t||r).call(s,"Default",{name:"t",hash:{},data:a}))+'</option>\r\n\t\t\t\t\t<option value="LEADER_CLUSTER">'+c((i.t||t&&t.t||r).call(s,"Leader",{name:"t",hash:{},data:a}))+'</option>\r\n\t\t\t\t\t<option value="COMBINED">'+c((i.t||t&&t.t||r).call(s,"Combined",{name:"t",hash:{},data:a}))+'</option>\r\n\t\t\t\t\t<option value="ROUND_ROBIN">'+c((i.t||t&&t.t||r).call(s,"Round Robin",{name:"t",hash:{},data:a}))+'</option>\r\n\t\t\t\t</select>\r\n\t\t\t</div>\r\n\t\t\t<div class="multipleSelect">\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n\t<div id='+c(typeof(o=null!=(o=i.serivcesTabId||(null!=t?t.serivcesTabId:t))?o:r)==l?o.call(s,{name:"serivcesTabId",hash:{},data:a}):o)+'>\r\n\t\t<div class="connectionsList servisesList">\r\n\t\t\t<div class="servicesListGrid"></div>\r\n\t\t</div>\r\n</div>\r\n\r\n<div class="statusBar"></div>'},useData:!0}),A.ContentPanel=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="content-panel">\r\n\r\n    <div class="panel-header">\r\n\r\n    </div>\r\n\r\n    <div class="document-view-div">\r\n\r\n    </div>\r\n\r\n</div>\r\n'},useData:!0}),A.CssDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="query-editor" spellcheck="false"></div>'},useData:!0}),A.DashboardListView=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<div class="tile-content">\r\n    <span class="dash-name">\r\n        '+l(typeof(e=null!=(e=i.name||(null!=t?t.name:t))?e:s)==r?e.call(o,{name:"name",hash:{},data:a}):e)+'\r\n    </span>\r\n\r\n    <span class="name-error-info"></span>\r\n    \r\n\t<span class="right-side-span">\r\n\t\t<i class="dash-wip-icon fa'+l(typeof(e=null!=(e=i.draftStateIcon||(null!=t?t.draftStateIcon:t))?e:s)==r?e.call(o,{name:"draftStateIcon",hash:{},data:a}):e)+'" style="margin-right: 7px; cursor: pointer;" title="'+l(typeof(e=null!=(e=i.title||(null!=t?t.title:t))?e:s)==r?e.call(o,{name:"title",hash:{},data:a}):e)+'"></i>\r\n\t\t<i class="fa fa-home" style="margin-right: 7px; cursor: pointer;" title="Select as default dashboard for all users"></i>\r\n\t\t<i class="fa fa-star" style="margin-right: 7px; cursor: pointer;"></i>\r\n\t\t<i class="fa fa-star-o" style="margin-right: 7px; cursor: pointer;"></i>\r\n\t\t<span class="dash-date">\r\n\t\t\t'+l(typeof(e=null!=(e=i.documentLocalDate||(null!=t?t.documentLocalDate:t))?e:s)==r?e.call(o,{name:"documentLocalDate",hash:{},data:a}):e)+"\r\n\t\t</span>\r\n\t</span>\r\n</div>"},useData:!0}),A.DashboardNamePrompt=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o;return'<div style="display: table; width: 100%; height: 100%; max-height: 100%; overflow: hidden;">\r\n    <div style="display: table-cell; width: 100%; height: 100%; max-height: 100%; vertical-align: middle; text-align: center;">\r\n        <span style="margin-right: 3px;">\r\n            Name:\r\n        </span>\r\n        <input class="name-input" value="'+e.escapeExpression("function"==typeof(o=null!=(o=i.name||(null!=t?t.name:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"name",hash:{},data:a}):o)+'" />\r\n        <span class="wip-icon">\r\n            <input type="checkbox" id="work-in-progress" class="work-in-progress"/>\r\n            <label for="work-in-progress"></label>\r\n        </span>\r\n        <div class = "wip-tooltip"></div>\r\n        <div class="dash-exist-info">\r\n            Dashboard with this name already exists.\r\n        </div>\r\n    </div>\r\n\r\n</div>\r\n'},useData:!0}),A.DashboardPermission=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<td class="permissionName" title="'+l(typeof(e=null!=(e=i.name||(null!=t?t.name:t))?e:s)==r?e.call(o,{name:"name",hash:{},data:a}):e)+'" colspan="3">'+l(typeof(e=null!=(e=i.name||(null!=t?t.name:t))?e:s)==r?e.call(o,{name:"name",hash:{},data:a}):e)+'</td>\r\n<td class="permissionRead" style="text-align: center;">\r\n\t<input type="checkbox" />\r\n</td>\r\n<td class="permissionWrite" style="text-align: center;">\r\n\t<input type="checkbox" />\r\n</td>'},useData:!0}),A.DashboardPermissions=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="permissions-panel" style="padding:10px;">\r\n\t\t<table>\r\n\t\t\t<thead>\r\n\t\t\t\t<tr><th  colspan="3">'+e((i.t||t&&t.t||s).call(o,"User Group",{name:"t",hash:{},data:a}))+'</th><th class="permissionRead">'+e((i.t||t&&t.t||s).call(o,"Read Access",{name:"t",hash:{},data:a}))+"</th><th permissionWrite>"+e((i.t||t&&t.t||s).call(o,"Write Access",{name:"t",hash:{},data:a}))+"</th></tr>\r\n\t\t\t</thead>\r\n\t\t\t<tbody></tbody>\r\n\t\t</table>\r\n</div>"},useData:!0}),A.DashboardStyles=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r=e.escapeExpression,l="function";return"<table>\r\n    <tr>\r\n        <td>\r\n            <span>"+r((i.t||t&&t.t||s).call(o,"Dashboard Theme",{name:"t",hash:{},data:a}))+'</span>\r\n        </td>\r\n        <td>\r\n            <select class="dashboardTheme">\r\n                <option>'+r((i.t||t&&t.t||s).call(o,"Dark",{name:"t",hash:{},data:a}))+"</option>\r\n                <option>"+r((i.t||t&&t.t||s).call(o,"Light",{name:"t",hash:{},data:a}))+"</option>\r\n            </select>\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <span>"+r((i.t||t&&t.t||s).call(o,"Widgets Spacing",{name:"t",hash:{},data:a}))+'</span>\r\n        </td>\r\n        <td>\r\n            <input class="widgets-spacing" value="'+r(typeof(e=null!=(e=i.widgetsSpacing||(null!=t?t.widgetsSpacing:t))?e:s)==l?e.call(o,{name:"widgetsSpacing",hash:{},data:a}):e)+'" />\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <span>'+r((i.t||t&&t.t||s).call(o,"Border Color",{name:"t",hash:{},data:a}))+'</span>\r\n        </td>\r\n        <td>\r\n            <input class="border-color" value="'+r(typeof(e=null!=(e=i.borderColor||(null!=t?t.borderColor:t))?e:s)==l?e.call(o,{name:"borderColor",hash:{},data:a}):e)+'" />\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <span>'+r((i.t||t&&t.t||s).call(o,"Border Background",{name:"t",hash:{},data:a}))+'</span>\r\n        </td>\r\n        <td>\r\n            <input class="border-background" value="'+r(typeof(e=null!=(e=i.borderBackground||(null!=t?t.borderBackground:t))?e:s)==l?e.call(o,{name:"borderBackground",hash:{},data:a}):e)+'" />\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <span>'+r((i.t||t&&t.t||s).call(o,"Transparent Background",{name:"t",hash:{},data:a}))+'</span>\r\n        </td>\r\n        <td>\r\n            <input type="checkbox" class="border-background-transparent" checked="'+r(typeof(e=null!=(e=i.transparentBackground||(null!=t?t.transparentBackground:t))?e:s)==l?e.call(o,{name:"transparentBackground",hash:{},data:a}):e)+'" />\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <span>'+r((i.t||t&&t.t||s).call(o,"Border Width",{name:"t",hash:{},data:a}))+'</span>\r\n        </td>\r\n        <td>\r\n            <input class="border-width" value="'+r(typeof(e=null!=(e=i.borderWidth||(null!=t?t.borderWidth:t))?e:s)==l?e.call(o,{name:"borderWidth",hash:{},data:a}):e)+'" />\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <span>'+r((i.t||t&&t.t||s).call(o,"Border Rounding",{name:"t",hash:{},data:a}))+'</span>\r\n        </td>\r\n        <td>\r\n            <input class="border-rounding" value="'+r(typeof(e=null!=(e=i.borderRounding||(null!=t?t.borderRounding:t))?e:s)==l?e.call(o,{name:"borderRounding",hash:{},data:a}):e)+'" />\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n        <td>\r\n            <span>'+r((i.t||t&&t.t||s).call(o,"Border Spacing",{name:"t",hash:{},data:a}))+'</span>\r\n        </td>\r\n        <td>\r\n            <input class="border-spacing" value="'+r(typeof(e=null!=(e=i.borderSpacing||(null!=t?t.borderSpacing:t))?e:s)==l?e.call(o,{name:"borderSpacing",hash:{},data:a}):e)+'" />\r\n        </td>\r\n    </tr>\r\n    <tr>\r\n    <td>\r\n            <span>'+r((i.t||t&&t.t||s).call(o,"Worksheet Padding",{name:"t",hash:{},data:a}))+'</span>\r\n        </td>\r\n        <td>\r\n            <input class="worksheet-padding" value="'+r(typeof(e=null!=(e=i.worksheetPadding||(null!=t?t.worksheetPadding:t))?e:s)==l?e.call(o,{name:"worksheetPadding",hash:{},data:a}):e)+'" />\r\n        </td>\r\n    </tr>\r\n</table>'},useData:!0}),A.DataConfigAggregateRow=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<input class="aggregateFnItm" value="'+l(typeof(e=null!=(e=i.aggFn||(null!=t?t.aggFn:t))?e:s)==r?e.call(o,{name:"aggFn",hash:{},data:a}):e)+'" placeholder="Function"/>\r\n<input class="aggregateColItm" value="'+l(typeof(e=null!=(e=i.aggCol||(null!=t?t.aggCol:t))?e:s)==r?e.call(o,{name:"aggCol",hash:{},data:a}):e)+'" placeholder="Column"/>\r\n<input class="aggregateLabelItm" value="'+l(typeof(e=null!=(e=i.aggLabel||(null!=t?t.aggLabel:t))?e:s)==r?e.call(o,{name:"aggLabel",hash:{},data:a}):e)+'" placeholder="Label" />\r\n<div class="deleteRow"></div>\r\n<div class="moveRow rowIcon fa fa-bars"></div>'},useData:!0}),A.DataConfigAnalytic=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="pnlAnalyticsGridWrapper">\r\n    <div class=\'search\'>\r\n        <i class=\'fa fa-search\'></i>\r\n        <input type=\'text\' class=\'searchBox\' />\r\n        <span class="clearSearch fa fa-times" style="display: none"></span>\r\n    </div>\r\n    <div class="pnlAnalyticsTree"></div>\r\n</div>\r\n\r\n<div class="propertiesPanel paramsView"></div>\r\n\r\n<div class="subscription-select"></div>\r\n     '},useData:!0}),A.DataConfigForm=Handlebars.template({1:function(e,t,i,n,a){return'                <label>\r\n                    <input type="radio" name="_dataType" class="builder" value="builder" />'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"Builder",{name:"t",hash:{},data:a}))+"\r\n                </label>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r=e.escapeExpression,l="function";return'<div class="toolbar ui-widget-header ui-corner-all">\r\n\r\n    <button class="newConnectionGroup">'+r((i.t||t&&t.t||s).call(o,"Connection Management",{name:"t",hash:{},data:a}))+'</button>\r\n\r\n    <div class="connection-type-select">\r\n        <select style="width: 80px;">\r\n            <option value="kdb" selected>'+r((i.t||t&&t.t||s).call(o,"kdb",{name:"t",hash:{},data:a}))+'</option>\r\n            <option value="sql">'+r((i.t||t&&t.t||s).call(o,"sql",{name:"t",hash:{},data:a}))+'</option>\r\n        </select>\r\n    </div>\r\n\r\n    <div class="connection-select">\r\n        <select style="width: 192px;"></select>\r\n    </div>\r\n\r\n    <button id="datasource-execute-query" class="run-btn"\r\n        title="'+r((i.t||t&&t.t||s).call(o,"Execute (Ctrl + Enter)",{name:"t",hash:{},data:a}))+'">'+r((i.t||t&&t.t||s).call(o,"Execute",{name:"t",hash:{},data:a}))+'</button>\r\n    <button class="add-parameter-btn" title="'+r((i.t||t&&t.t||s).call(o,"Add a parameter to query string",{name:"t",hash:{},data:a}))+'">'+r((i.t||t&&t.t||s).call(o,"Add Parameter",{name:"t",hash:{},data:a}))+'</button>\r\n</div>\r\n\r\n<div class="data-div">\r\n    <div class="function">\r\n        <fieldset>\r\n            <span>\r\n                <label>\r\n                    <input type="radio" name="_dataType" class="query" value="query" checked />'+r((i.t||t&&t.t||s).call(o,"Query",{name:"t",hash:{},data:a}))+"\r\n                </label>\r\n"+(null!=(e=i.if.call(o,null!=t?t.query_graph:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?e:"")+'                <label class="analyticFieldsetLabel">\r\n                    <input type="radio" name="_dataType" class="analytic" value="analytic" />'+r((i.t||t&&t.t||s).call(o,"Analytic",{name:"t",hash:{},data:a}))+'\r\n                </label>\r\n                <label>\r\n                    <input type="radio" name="_dataType" class="streaming" value="streaming" />'+r((i.t||t&&t.t||s).call(o,"Streaming",{name:"t",hash:{},data:a}))+'\r\n                </label>\r\n                <label>\r\n                    <input type="radio" name="_dataType" class="virtual" value="virtual" />'+r((i.t||t&&t.t||s).call(o,"Virtual",{name:"t",hash:{},data:a}))+'\r\n                </label>\r\n            </span>\r\n\r\n            <div class="legend-right">\r\n                <label class="pivot-label">\r\n                    <input class="pivot-checkbox" type="checkbox" />'+r((i.t||t&&t.t||s).call(o,"Pivot",{name:"t",hash:{},data:a}))+'\r\n                </label>\r\n                <label class="update-label">\r\n                    <input class="update-checkbox" type="checkbox" />'+r((i.t||t&&t.t||s).call(o,"Update",{name:"t",hash:{},data:a}))+'\r\n                </label>\r\n            </div>\r\n            <div class="analytic-form"></div>\r\n            <div class="streaming-form" style="display: none"></div>\r\n            <div class="builder-query-form" style="display: none"></div>\r\n            <div class="query-form" style="display: none"></div>\r\n            <div class="virtual-query-form" style="display: none"></div>\r\n        </fieldset>\r\n    </div>\r\n    <div class="pivot">\r\n        <fieldset>\r\n            <legend>\r\n                <label>'+r((i.t||t&&t.t||s).call(o,"Pivot Query",{name:"t",hash:{},data:a}))+'</label>\r\n            </legend>\r\n            <div class="legend-right">\r\n                <label class="pivot-type-label-server">\r\n                    <input type="radio" name="_pivotType" class="server" value="server" checked />'+r((i.t||t&&t.t||s).call(o,"Server",{name:"t",hash:{},data:a}))+'\r\n                </label>\r\n                <label class="pivot-type-label-client">\r\n                    <input type="radio" name="_pivotType" class="client" value="client" />'+r((i.t||t&&t.t||s).call(o,"Client",{name:"t",hash:{},data:a}))+'\r\n                </label>\r\n            </div>\r\n            <div class="pivot-form"></div>\r\n        </fieldset>\r\n    </div>\r\n    <div class="update">\r\n        <fieldset>\r\n            <legend>\r\n                <label>'+r((i.t||t&&t.t||s).call(o,"Update",{name:"t",hash:{},data:a}))+'</label>\r\n            </legend>\r\n            <div class="legend-right">\r\n                <label class="pivot-type-label-query">\r\n                    <input type="radio" name="_updateType" class="query" value="query" checked />'+r((i.t||t&&t.t||s).call(o,"Query",{name:"t",hash:{},data:a}))+'\r\n                </label>\r\n                <label class="pivot-type-label-analytic">\r\n                    <input type="radio" name="_updateType" class="analytic" value="analytic" />'+r((i.t||t&&t.t||s).call(o,"Analytic",{name:"t",hash:{},data:a}))+'\r\n                </label>\r\n            </div>\r\n            <div class="update-form"></div>\r\n        </fieldset>\r\n    </div>\r\n    <div class="subscription">\r\n    </div>\r\n    <div class="results">\r\n        <div class="stacked-bar-graph"></div>\r\n        <fieldset class="results-div">\r\n            <legend>\r\n                <label>Results:</label>\r\n            </legend>\r\n\r\n            <div class="queryStatus ui-state-header">\r\n                <div class="statusPanel Error ui-state-error">\r\n                    <div class="statusTitle"><i class="fa fa-exclamation-triangle"></i><span>'+r((i.t||t&&t.t||s).call(o,"Error",{name:"t",hash:{},data:a}))+'</span></div>\r\n                    <span class="statusText"></span>\r\n                </div>\r\n                <div class="statusPanel Warning ui-state-warning">\r\n                    <div class="statusTitle"><i class="fa fa-exclamation-circle"></i><span>'+r((i.t||t&&t.t||s).call(o,"Warning",{name:"t",hash:{},data:a}))+'</span></div>\r\n                    <span class="statusText"></span>\r\n                </div>\r\n                <div class="statusPanel Info ui-state-highlight">\r\n                    <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+r((i.t||t&&t.t||s).call(o,"Info",{name:"t",hash:{},data:a}))+'</span></div>\r\n                    <span class="statusText"></span>\r\n                </div>\r\n                <div class="statusPanel Loading ui-state-highlight">\r\n                    <div class="statusTitle"><i class="fa fa-spinner fa-pulse"></i><span>'+r((i.t||t&&t.t||s).call(o,"Loading",{name:"t",hash:{},data:a}))+'</span></div>\r\n                    <span class="statusText"></span>\r\n                </div>\r\n                <div class="statusPanel NoResults ui-state-highlight">\r\n                    <div class="statusTitle"><i class="fa fa-info-circle"></i><span>'+r((i.t||t&&t.t||s).call(o,"No Results",{name:"t",hash:{},data:a}))+'</span></div>\r\n                    <span class="statusText"></span>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="tabs">\r\n                <ul>\r\n                    <li><a href="#'+r(typeof(e=null!=(e=i.tableId||(null!=t?t.tableId:t))?e:s)==l?e.call(o,{name:"tableId",hash:{},data:a}):e)+'"><i class="fa fa-fw fa-table"></i>&nbsp;Results</a></li>\r\n                    <li><a href="#'+r(typeof(e=null!=(e=i.mappingId||(null!=t?t.mappingId:t))?e:s)==l?e.call(o,{name:"mappingId",hash:{},data:a}):e)+'"><i class="fa fa-fw fa-code-fork fa-rotate-90"></i>&nbsp;Mapping</a>\r\n                    </li>\r\n                    <li><a href="#'+r(typeof(e=null!=(e=i.rawId||(null!=t?t.rawId:t))?e:s)==l?e.call(o,{name:"rawId",hash:{},data:a}):e)+'"><i class="fa fa-fw fa-file-text-o"></i>&nbsp;Raw Output</a></li>\r\n                </ul>\r\n                <div id="'+r(typeof(e=null!=(e=i.tableId||(null!=t?t.tableId:t))?e:s)==l?e.call(o,{name:"tableId",hash:{},data:a}):e)+'" class="dataTableTab"></div>\r\n                <div id="'+r(typeof(e=null!=(e=i.mappingId||(null!=t?t.mappingId:t))?e:s)==l?e.call(o,{name:"mappingId",hash:{},data:a}):e)+'"></div>\r\n                <div id="'+r(typeof(e=null!=(e=i.rawId||(null!=t?t.rawId:t))?e:s)==l?e.call(o,{name:"rawId",hash:{},data:a}):e)+'"></div>\r\n            </div>\r\n    </div>\r\n\r\n\r\n    </fieldset>\r\n</div>\r\n</div>\r\n<div class="addParameterDialog" style="display: none;">\r\n    <span style="display: inline-block; width: 150px;">'+r((i.t||t&&t.t||s).call(o,"Parameter name",{name:"t",hash:{},data:a}))+'</span>\r\n    <input class="parameterName" type="text" style="display: inline-block; width: 200px;" />\r\n</div>'},useData:!0}),A.DataConfigForm_Perf=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<div class="stacked-bar-graph-details">\n    <table class="tooltiptext">\n        <tr>\n            <td><i class="fa fa-square iconbar-1"></i></td>\n            <td>Dispatch:</td>\n            <td class="rightTextAlign">'+l(typeof(e=null!=(e=i.subscriptionTime||(null!=t?t.subscriptionTime:t))?e:s)==r?e.call(o,{name:"subscriptionTime",hash:{},data:a}):e)+' ms</td>\n            <td class="rightTextAlign"> '+l((i.toFixed||t&&t.toFixed||s).call(o,null!=t?t.subscriptionPercent:t,2,{name:"toFixed",hash:{},data:a}))+'%</td>\n        </tr>\n        <tr>\n            <td><i class="fa fa-square iconbar-2"></i></td>\n            <td>Server Duration:</td>\n            <td class="rightTextAlign">'+l(typeof(e=null!=(e=i.executionTime||(null!=t?t.executionTime:t))?e:s)==r?e.call(o,{name:"executionTime",hash:{},data:a}):e)+' ms</td>\n            <td class="rightTextAlign"> '+l((i.toFixed||t&&t.toFixed||s).call(o,null!=t?t.executionPercent:t,2,{name:"toFixed",hash:{},data:a}))+'%</td>\n        </tr>\n        <tr>\n            <td><i class="fa fa-square iconbar-3"></i></td>\n            <td>IPC & Deserialize:</td>\n            <td class="rightTextAlign">'+l(typeof(e=null!=(e=i.dataModelTime||(null!=t?t.dataModelTime:t))?e:s)==r?e.call(o,{name:"dataModelTime",hash:{},data:a}):e)+' ms</td>\n            <td class="rightTextAlign"> '+l((i.toFixed||t&&t.toFixed||s).call(o,null!=t?t.dataModelPercent:t,2,{name:"toFixed",hash:{},data:a}))+'%</td>\n        </tr>\n    </table> <span style="width:'+l(typeof(e=null!=(e=i.subscriptionPercent||(null!=t?t.subscriptionPercent:t))?e:s)==r?e.call(o,{name:"subscriptionPercent",hash:{},data:a}):e)+'%" class="bar-1"></span>\n    <span style="width:'+l(typeof(e=null!=(e=i.executionPercent||(null!=t?t.executionPercent:t))?e:s)==r?e.call(o,{name:"executionPercent",hash:{},data:a}):e)+'%" class="bar-2"></span>\n    <span style="width:'+l(typeof(e=null!=(e=i.dataModelPercent||(null!=t?t.dataModelPercent:t))?e:s)==r?e.call(o,{name:"dataModelPercent",hash:{},data:a}):e)+'%" class="bar-3"></span>\n</div>\n<div class="stacked-bar-graph-summary"> Roundtrip: '+l(typeof(e=null!=(e=i.totalTime||(null!=t?t.totalTime:t))?e:s)==r?e.call(o,{name:"totalTime",hash:{},data:a}):e)+" ms</div>"},useData:!0}),A.DataConfigMapping=Handlebars.template({1:function(e,t,i,n,a){return" single-value"},3:function(e,t,i,n,a){return'            <div class="value slick-header-column ui-state-default">Value</div>\n            <div class="view-state bbf-editor slick-header-column ui-state-default">View State</div>\n            <div class="remove"></div>\n'},5:function(e,t,i,n,a){return'            <div class="key slick-header-column ui-state-default">\n                <label>Key<select class="key-select"></select></label>\n            </div>\n            <div class="value slick-header-column ui-state-default">\n                <label>Value<select class="value-select"></select></label>\n            </div>\n            <div class="view-state bbf-editor slick-header-column ui-state-default">View State</div>\n            <div class="remove slick-header-column ui-state-default"></div>\n'},7:function(e,t,i,n,a){return" disabled"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o,s=null!=t?t:e.nullContext||{};return'<div class="mapping-table Datagrid '+e.escapeExpression("function"==typeof(o=null!=(o=i.theme||(null!=t?t.theme:t))?o:i.helperMissing)?o.call(s,{name:"theme",hash:{},data:a}):o)+(null!=(o=i.if.call(s,null!=t?t.singleValue:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'">\n    <div class="table-header">\n        <div class="row slick-header-columns ui-state-default">\n'+(null!=(o=i.if.call(s,null!=t?t.singleValue:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.program(5,a,0),data:a}))?o:"")+'        </div>\n    </div>\n    <div class="table-body"></div>\n</div>\n<div class="toolbar">\n    <button class="reset-mapping" '+(null!=(o=i.if.call(s,null!=t?t.singleValue:t,{name:"if",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a}))?o:"")+'>Reset</button>\n    <button class="add-mapping" '+(null!=(o=i.if.call(s,null!=t?t.singleValue:t,{name:"if",hash:{},fn:e.program(7,a,0),inverse:e.noop,data:a}))?o:"")+">Add</button>\n</div>\n"},useData:!0}),A.DataConfigMappingItem=Handlebars.template({1:function(e,t,i,n,a){var o;return'<div class="slick-cell value">'+e.escapeExpression("function"==typeof(o=null!=(o=i.value||(null!=t?t.value:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"value",hash:{},data:a}):o)+'</div>\n<div class="slick-cell view-state bbf-editor"></div>\n'},3:function(e,t,i,n,a){var o;return'<div class="slick-cell key"><select class="key-select"></select></div>\n<div class="slick-cell value">'+e.escapeExpression("function"==typeof(o=null!=(o=i.value||(null!=t?t.value:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"value",hash:{},data:a}):o)+'</div>\n<div class="slick-cell view-state bbf-editor"></div>\n<div class="slick-cell remove"><button class="remove-mapping">Remove</button></div>\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return null!=(a=i.if.call(null!=t?t:e.nullContext||{},null!=t?t.singleValue:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a}))?a:""},useData:!0}),A.DataConfigPivot=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r=e.escapeExpression,l="function";return'<div class="row tableNameRow">\r\n\t<label>'+r((i.t||t&&t.t||s).call(o,"Table name:",{name:"t",hash:{},data:a}))+'</label>\r\n\t<input class="_table" value="'+r(typeof(e=null!=(e=i._table||(null!=t?t._table:t))?e:s)==l?e.call(o,{name:"_table",hash:{},data:a}):e)+'" />\r\n\t<div class="_pivotQuery"><textarea>'+r(typeof(e=null!=(e=i._pivotQuery||(null!=t?t._pivotQuery:t))?e:s)==l?e.call(o,{name:"_pivotQuery",hash:{},data:a}):e)+'</textarea></div>\r\n\t<div id="'+r(typeof(e=null!=(e=i.radioId||(null!=t?t.radioId:t))?e:s)==l?e.call(o,{name:"radioId",hash:{},data:a}):e)+'" class="pivotSourceToggle">\r\n        <input type="radio" id="'+r(typeof(e=null!=(e=i.radio1Id||(null!=t?t.radio1Id:t))?e:s)==l?e.call(o,{name:"radio1Id",hash:{},data:a}):e)+'" name="'+r(typeof(e=null!=(e=i.radioId||(null!=t?t.radioId:t))?e:s)==l?e.call(o,{name:"radioId",hash:{},data:a}):e)+'" value="tableName" checked="checked"><label for="'+r(typeof(e=null!=(e=i.radio1Id||(null!=t?t.radio1Id:t))?e:s)==l?e.call(o,{name:"radio1Id",hash:{},data:a}):e)+'">Table name</label>\r\n        <input type="radio" id="'+r(typeof(e=null!=(e=i.radio2Id||(null!=t?t.radio2Id:t))?e:s)==l?e.call(o,{name:"radio2Id",hash:{},data:a}):e)+'" name="'+r(typeof(e=null!=(e=i.radioId||(null!=t?t.radioId:t))?e:s)==l?e.call(o,{name:"radioId",hash:{},data:a}):e)+'" value="pivotQuery"><label for="'+r(typeof(e=null!=(e=i.radio2Id||(null!=t?t.radio2Id:t))?e:s)==l?e.call(o,{name:"radio2Id",hash:{},data:a}):e)+'">Query string</label>\r\n    </div>\r\n</div>\r\n<div class="_breakdownCols row">\r\n    <label>'+r((i.t||t&&t.t||s).call(o,"Breakdown Cols:",{name:"t",hash:{},data:a}))+'</label>\r\n    <textarea></textarea>\r\n</div>\r\n<div class="_aggregateCols row">\r\n\t<label>'+r((i.t||t&&t.t||s).call(o,"Aggregate Cols:",{name:"t",hash:{},data:a}))+'</label>\r\n\t<textarea></textarea>\r\n</div>\r\n<div class="_aggregateFns row">\r\n\t<label>'+r((i.t||t&&t.t||s).call(o,"Aggregate Fns:",{name:"t",hash:{},data:a}))+'</label>\r\n\t<textarea></textarea>\r\n</div>\r\n<div class="subscription-select"></div>\r\n\x3c!--<div class="row">\r\n    <label>'+r((i.t||t&&t.t||s).call(o,"From Date:",{name:"t",hash:{},data:a}))+'</label>\r\n    <input class="_from" value="'+r(typeof(e=null!=(e=i._from||(null!=t?t._from:t))?e:s)==l?e.call(o,{name:"_from",hash:{},data:a}):e)+'" data-datadesc="from"/>\r\n</div>\r\n<div class="row">\r\n    <label>'+r((i.t||t&&t.t||s).call(o,"To Date:",{name:"t",hash:{},data:a}))+'</label>\r\n    <input class="_to" value="'+r(typeof(e=null!=(e=i._to||(null!=t?t._to:t))?e:s)==l?e.call(o,{name:"_to",hash:{},data:a}):e)+'" data-datadesc="to" />\r\n</div>\r\n<div class="errorDialog" style="display: none;">Please select either "From Date" or "To Date" to populate.</div>--\x3e\r\n'},useData:!0}),A.DataConfigQuery_Builder=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="graph-container">\n    <div class="graph-content">\n        <div class="accordion">\n            <div class="side-dialog" style="display:none;">\n                <div class="side-dialog-menu">\n                    <span class="menu-item menu-icon"></span>\n                    <span class="menu-item description"></span>\n                    <span class="menu-item close-button"><i class="fa fa-times"></i></span>\n                </div>\n                <div class="side-dialog-content"></div>\n                <div class="side-dialog-buttons">\n                    <span class="save-button">Save</span>\n                </div>\n            </div>\n            <div class="graph"></div>\n        </div>\n    </div>\n    <ul class=\'custom-menu\'></ul>\n\n    <div class="nodeErrorMessage" style="display:none">\n        <div class="errors-title"><i class="fa fa-exclamation-triangle"></i><span>'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"Error:",{name:"t",hash:{},data:a}))+'</span></div>\n        <span class="errors-text"></span>\n    </div>\n\n    <div class="loading">\n        <div class="loadingInner">\n            <i class="fa fa-spinner fa-spin"></i>\n        </div>\n    </div>\n</div>'},useData:!0}),A.DataConfigQuery_Pivot=Handlebars.template({1:function(e,t,i,n,a){return"isViewState"},3:function(e,t,i,n,a){return"checked"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o,s,r=null!=t?t:e.nullContext||{},l=i.helperMissing,c=e.escapeExpression,d="function";return'\r\n<div class="overlay"></div>\r\n<div class="_breakdownCols row"></div>\r\n<div class="_columnLabels row">\r\n    <label>'+c((i.t||t&&t.t||l).call(r,"Column Label:",{name:"t",hash:{},data:a}))+'</label>\r\n    <span class="columnLabelInputHolder">\r\n        \x3c!--<input type="text" class="_columnLabel"/>--\x3e\r\n        <input class="_columnLabel" type="text" />\r\n    </span>\r\n    \x3c!--<textarea></textarea>--\x3e\r\n</div>\r\n<div class="aggregateContainer '+(null!=(o=i.if.call(r,null!=t?t.hasAggregateViewState:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'">\r\n    <div class="label">\r\n        Aggregates:<br />\r\n        <label for="'+c(typeof(s=null!=(s=i.guid||(null!=t?t.guid:t))?s:l)==d?s.call(r,{name:"guid",hash:{},data:a}):s)+'_viewStateCheckbox">'+c((i.t||t&&t.t||l).call(r,"Assign View State",{name:"t",hash:{},data:a}))+'</label>\r\n        <input id="'+c(typeof(s=null!=(s=i.guid||(null!=t?t.guid:t))?s:l)==d?s.call(r,{name:"guid",hash:{},data:a}):s)+'_viewStateCheckbox" type="checkbox" class="viewStateCheckbox" '+(null!=(o=i.if.call(r,null!=t?t.hasAggregateViewState:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+' />\r\n        <span class="resetBtn">Reset</span>\r\n    </div>\r\n    <div>\r\n        <div class="aggregateList">\r\n            <ul style="list-style: none;"></ul>\r\n            <div class="pivotRow newAggregate hidden">\r\n                <input class="aggregateFnItm new" placeholder="Function" />\r\n                <input class="aggregateColItm new" placeholder="Column" />\r\n                <input class="aggregateLabelItm new" placeholder="Label" />\r\n                <div class="addBtn">Add</div>\r\n            </div>\r\n        </div>\r\n        <div class="aggregateViewState"></div>\r\n    </div>\r\n</div>\r\n'},useData:!0}),A.DataConfigQuery_Query=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="query-editor">\r\n\r\n</div>\r\n<div class="params-box" spellcheck="false" resize="false"></div> '},useData:!0}),A.DataConfigQuery_Subscription=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div style="height: 100%;">\r\n<div class="subscription-select"></div>\r\n</div>'},useData:!0}),A.DataConfigQuery_Update=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="overlay"></div>\r\n<div class="update-editor"></div>\r\n<div class="update-analytic-picker">\r\n    <div class="picker"></div>\r\n    <div class="info">\r\n        <p>Update Analytic is Called with Three Parameters</p>\r\n        <ol>\r\n            <li>dgAdd {Dict} - Added Columns</li>\r\n            <li>dgUpd {Dict} - Updated Columns</li>\r\n            <li>dgDel {Dict} - Removed Columns</li>\r\n        </ol>\r\n    </div>\r\n</div>\r\n<a\r\n    class="fa fa-fw fa-info-circle"\r\n    title="'+e((i.t||t&&t.t||s).call(o,"Example shows add, upd and del parameters are passed to the update query as dictionaries",{name:"t",hash:{},data:a}))+"&#13;"+e((i.t||t&&t.t||s).call(o,"Containing all column entries of any rows added, updated or deleted.",{name:"t",hash:{},data:a}))+'"\r\n/>\r\n<div class="update-params-box" spellcheck="false" resize="false"></div>\r\n'},useData:!0}),A.DataConfigQuery_Virtual=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="query-editor"></div>\r\n<div class="params-box" spellcheck="false" resize="false"></div> '},useData:!0}),A.DataDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="tree" />\r\n<div class="form" />\r\n'},useData:!0}),A.DataModelProperties=Handlebars.template({1:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return"        <tr><td>"+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:s)==r?e.call(o,{name:"key",hash:{},data:a}):e)+"</td><td>"+l(typeof(e=null!=(e=i.val||(null!=t?t.val:t))?e:s)==r?e.call(o,{name:"val",hash:{},data:a}):e)+"</td></tr>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o,s=null!=t?t:e.nullContext||{};return"<form>\r\n    <table>\r\n"+(null!=(o=i.each.call(s,t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+'    </table>\r\n    <div>\r\n        <div class="config-btn">'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(s,"Configure",{name:"t",hash:{},data:a}))+"</div>\r\n    </div>\r\n</form>\r\n"},useData:!0}),A.DataParameter=Handlebars.template({1:function(e,t,i,n,a){var o;return'    <input class="name-input col1" value="'+e.escapeExpression("function"==typeof(o=null!=(o=i.name||(null!=t?t.name:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"name",hash:{},data:a}):o)+'" />\r\n'},3:function(e,t,i,n,a){var o;return'    <label class="col1">'+e.escapeExpression("function"==typeof(o=null!=(o=i.name||(null!=t?t.name:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"name",hash:{},data:a}):o)+"</label>\r\n"},5:function(e,t,i,n,a){var o;return'    <div class="remove-item-btn col4" data-id="'+e.escapeExpression("function"==typeof(o=null!=(o=i.id||(null!=t?t.id:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"id",hash:{},data:a}):o)+'">\r\n        Remove Item\r\n    </div>\r\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o,s=null!=t?t:e.nullContext||{},r=i.helperMissing,l=e.escapeExpression;return'<div class="form-control viewstate-control">\r\n'+(null!=(o=i.if.call(s,null!=t?t.editable:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.program(3,a,0),data:a}))?o:"")+'\r\n    <div class="type-dropdown col2">\r\n        <select class="type-select">\r\n            <option>boolean</option>\r\n            <option>byte</option>\r\n            <option>char</option>\r\n            <option>date</option>\r\n            <option>datetime</option>\r\n            <option>dict</option>\r\n            <option>double</option>\r\n            <option>float</option>\r\n            <option>guid</option>\r\n            <option>int</option>\r\n            <option>list</option>\r\n            <option>long</option>\r\n            <option>minute</option>\r\n            <option>month</option>\r\n            <option>second</option>\r\n            <option>short</option>\r\n            <option>string</option>\r\n            <option>symbol</option>\r\n            <option>time</option>\r\n            <option>timespan</option>\r\n            <option>timestamp</option>\r\n        </select>\r\n    </div>\r\n\r\n    <div class="input-div col3">\r\n        \x3c!-- <input class="value-input" type="text" data-schemaformat="number" /> --\x3e\r\n        <span class="value-input bbf-editor"></span>\r\n\r\n        <i class="fa fa-fw watermark fa-eye binding-apply viewstate-apply"></i>\r\n\r\n        <div class="generate-value" title="'+l((i.t||t&&t.t||r).call(s,"Generate View State",{name:"t",hash:{},data:a}))+'">\r\n            <i class="fa fa-fw watermark fa-eye generate-viewstate-icon"></i>\r\n            <i class="fa fa-fw watermark fa-cog generate-viewstate-icon"></i>\r\n        </div>\r\n\r\n        <div class="binding-container">\r\n            <i\r\n                class="fa fa-fw watermark fa-eraser binding-clear"\r\n                title="'+l((i.t||t&&t.t||r).call(s,"Clear View State",{name:"t",hash:{},data:a}))+'"\r\n            ></i>\r\n            <i\r\n                class="fa fa-fw watermark fa-eye binding-icon viewstate-icon"\r\n                title="'+l((i.t||t&&t.t||r).call(s,"Select View State",{name:"t",hash:{},data:a}))+'"\r\n            ></i>\r\n            <input\r\n                class="value-display data-parameter-editor"\r\n                type="text"\r\n                tabindex="-1"\r\n                readonly\r\n            />\r\n        </div>\r\n    </div>\r\n\r\n'+(null!=(o=i.if.call(s,null!=t?t.editable:t,{name:"if",hash:{},fn:e.program(5,a,0),inverse:e.noop,data:a}))?o:"")+'</div>\r\n\r\n<div class="form-control viewstate-control button-row">\r\n    <div class="add-item-btn">\r\n        Add Item\r\n    </div>\r\n</div>\r\n\r\n<div class="list-items" style="margin-bottom: 22px; padding-left: 1em;"></div>\r\n'},useData:!0}),A.DocumentGraph=Handlebars.template({1:function(e,t,i,n,a){return" checked "},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="overlay"></div>\n<a class="close"><i class="fa fa-close"></i></a>\n<div class="mode ui-widget">\n    <label>\n        <input type="checkbox" name="hierarchical" value="hierarchical" '+(null!=(a=i.if.call(null!=t?t:e.nullContext||{},null!=t?t.hierarchical:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?a:"")+'>\n        Hierarchical\n    </label>\n</div>\n<div class="loading">\n    <div class="loadingInner">\n        <i class="fa fa-spinner fa-spin"></i>\n    </div>\n</div>'},useData:!0}),A.DocumentGraphTooltip=Handlebars.template({1:function(e,t,i,n,a){return"<li>"+e.escapeExpression(e.lambda(t,t))+"</li>\n"},3:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<table class="tooltiptext">\n    <tr>\n        <td><i class="fa fa-square iconbar-1"></i></td>\n        <td>Dispatch:</td>\n        <td class="rightTextAlign">'+l(typeof(e=null!=(e=i.subscriptionTime||(null!=t?t.subscriptionTime:t))?e:s)==r?e.call(o,{name:"subscriptionTime",hash:{},data:a}):e)+' ms</td>\n        <td class="rightTextAlign"> '+l((i.toFixed||t&&t.toFixed||s).call(o,null!=t?t.subscriptionPercent:t,2,{name:"toFixed",hash:{},data:a}))+'%</td>\n    </tr>\n    <tr>\n        <td><i class="fa fa-square iconbar-2"></i></td>\n        <td>Server Duration:</td>\n        <td class="rightTextAlign">'+l(typeof(e=null!=(e=i.executionTime||(null!=t?t.executionTime:t))?e:s)==r?e.call(o,{name:"executionTime",hash:{},data:a}):e)+' ms</td>\n        <td class="rightTextAlign"> '+l((i.toFixed||t&&t.toFixed||s).call(o,null!=t?t.executionPercent:t,2,{name:"toFixed",hash:{},data:a}))+'%</td>\n    </tr>\n    <tr>\n        <td><i class="fa fa-square iconbar-3"></i></td>\n        <td>IPC & Deserialize:</td>\n        <td class="rightTextAlign">'+l(typeof(e=null!=(e=i.dataModelTime||(null!=t?t.dataModelTime:t))?e:s)==r?e.call(o,{name:"dataModelTime",hash:{},data:a}):e)+' ms</td>\n        <td class="rightTextAlign"> '+l((i.toFixed||t&&t.toFixed||s).call(o,null!=t?t.dataModelPercent:t,2,{name:"toFixed",hash:{},data:a}))+"%</td>\n    </tr>\n</table>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o,s=null!=t?t:e.nullContext||{},r=i.helperMissing,l="function",c=e.escapeExpression;return'<div class = "document-graph-tooltip">\n'+c(typeof(o=null!=(o=i.executions||(null!=t?t.executions:t))?o:r)==l?o.call(s,{name:"executions",hash:{},data:a}):o)+" <br>\n"+c(typeof(o=null!=(o=i.label||(null!=t?t.label:t))?o:r)==l?o.call(s,{name:"label",hash:{},data:a}):o)+"\n<ul>\n"+(null!=(o=i.each.call(s,null!=t?t.subscribers:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")+"</ul>\n"+(null!=(o=i.if.call(s,null!=t?t.bool:t,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?o:"")+"</div>"},useData:!0}),A.DropDownDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'\r\n<ol class="tp-radio">\r\n</ol>\r\n\r\n<div class="pnlCustom"> \r\n    <p>To create a "wild" column please use * <br /> \r\n        <span>e.g. use <b>bid*</b> for <b>[bid]</b> and <b>[bid_change]</b></span></p>\r\n    <input class="customDropwdownInput" type="text" />\r\n    <button class="customDropwdownSelect">'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"Add Custom Column",{name:"t",hash:{},data:a}))+"</button>\r\n</div>\r\n"},useData:!0}),A.DropDownSelectableDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'\r\n<ol class="tp-selectable">\r\n</ol>\r\n\r\n<div class="pnlCustom"> \r\n    <p>To create a "wild" column please use * <br /> \r\n        <span>e.g. use <b>bid*</b> for <b>[bid]</b> and <b>[bid_change]</b></span></p>\r\n    <input class="customDropwdownInput" type="text" />\r\n    <button class="customDropwdownSelect">'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"Add Custom Column",{name:"t",hash:{},data:a}))+"</button>\r\n</div>\r\n"},useData:!0}),A.DropDownWithEnumSelectableDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'\r\n<ol class="tp-selectable">\r\n</ol>\r\n\r\n<div class="pnlCustom"> \r\n    <p>Add custom geoJson url <br /> \r\n        \r\n    <input class="customDropwdownInput" type="text" />\r\n    <button class="customDropwdownSelect">'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"Use Custom Url",{name:"t",hash:{},data:a}))+"</button>\r\n</div>\r\n"},useData:!0}),A.EditorDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="toolbar ui-widget-header ui-corner-all">\r\n\t<span class="fa-stack fa-lg element-picker" title="'+e((i.t||t&&t.t||s).call(o,"Choose an element",{name:"t",hash:{},data:a}))+'">\r\n\t\t<i class="fa fa-square-o fa-stack-2x"></i>\r\n\t\t<i class="fa fa-mouse-pointer fa-stack-1x"></i>\r\n\t</span>\r\n\t<div class="highlighted-element">'+e((i.t||t&&t.t||s).call(o,"Click the icon to choose an element",{name:"t",hash:{},data:a}))+"</div>\r\n</div>"},useData:!0}),A.ErrorDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="dialog-error" title="'+e((i.t||t&&t.t||s).call(o,"Error",{name:"t",hash:{},data:a}))+'">\r\n    <p>'+e("function"==typeof(t=null!=(t=i.body||(null!=t?t.body:t))?t:s)?t.call(o,{name:"body",hash:{},data:a}):t)+"\r\n    </p>\r\n</div>\r\n"},useData:!0}),A.FailedLoginsNotification=Handlebars.template({1:function(e,t,i,n,a){var o,s=null!=t?t:e.nullContext||{},r=i.helperMissing,l="function",c=e.escapeExpression;return'    <div class="status-'+c(typeof(o=null!=(o=i.status||(null!=t?t.status:t))?o:r)==l?o.call(s,{name:"status",hash:{},data:a}):o)+'">\r\n        <span>'+c(typeof(o=null!=(o=i.time||(null!=t?t.time:t))?o:r)==l?o.call(s,{name:"time",hash:{},data:a}):o)+'</span>\r\n        <span class="info">from:</span>\r\n        <span>'+c(typeof(o=null!=(o=i.machineID||(null!=t?t.machineID:t))?o:r)==l?o.call(s,{name:"machineID",hash:{},data:a}):o)+"</span>\r\n"+(null!=(e=i.if.call(s,null!=t?t.status:t,{name:"if",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a}))?e:"")+'        <span class="info">url:</span>\r\n        <span>'+c(typeof(o=null!=(o=i.url||(null!=t?t.url:t))?o:r)==l?o.call(s,{name:"url",hash:{},data:a}):o)+"</span>\r\n    </div>\r\n"},2:function(e,t,i,n,a){var o;return'        <span class="info">status:</span>\r\n        <span>'+e.escapeExpression("function"==typeof(o=null!=(o=i.status||(null!=t?t.status:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"status",hash:{},data:a}):o)+"</span>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return null!=(a=i.each.call(null!=t?t:e.nullContext||{},null!=t?t.rows:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?a:""},useData:!0}),A.HandlebarHelp=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="handlebars-help">\r\n    <h2 id="getting-started">Getting Started\r\n    </h2>\r\n    <div class="contents">\r\n        <div class="description">\r\n            Creating a template looks like regular HTML, with embedded expressions.\r\n        </div>\r\n         <pre class="sunburst"><span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">div</span><span class="MetaTagAll">&gt;</span></span>My symbol is: <span class="EmbeddedSourceBright">&#123;&#123;sym&#125;&#125;</span><span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">div</span><span class="MetaTagAll">&gt;</span></span>&#x000A;</pre>\r\n        <div class="notes">\r\n            An expression is a <code>&#123;&#123;</code>, some contents, followed by a <code>&#125;&#125;</code>\r\n        </div>\r\n        <div class="notes">\r\n            You can iterate over your data using the each helper. Inside the block, you can use this to reference the element being iterated over.\r\n        </div>\r\n        <pre class="sunburst"><span class="MetaTagAll">&lt;div&gt;</span>My symbols are:&#x000A;<span class="MetaTagAll">&lt;ol&gt;</span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;#each this&#125;&#125;</span>&#x000A;    <span class="MetaTagAll">&lt;li&gt;</span><span class="EmbeddedSourceBright">&#123;&#123;sym&#125;&#125;</span><span class="MetaTagAll">&lt;/li&gt;</span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;/each&#125;&#125;</span>&#x000A;  <span class="MetaTagAll">&lt;/ol&gt;</span>&#x000A;<span class="MetaTagAll">&lt;/div&gt;</span></pre>\r\n    </div>\r\n    <h2 id="basic-blocks">Basic Usage\r\n    </h2>\r\n    <div class="contents">\r\n        <div class="bullet">\r\n            <div class="description">\r\n                The simplest Handlebars expression is a simple identifier:\r\n            </div>\r\n            <pre class="sunburst"><span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span><span class="EmbeddedSourceBright">&#123;&#123;title&#125;&#125;</span><span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span>&#x000A;</pre>\r\n            <div class="notes">\r\n                This expression means "look up the <code>title</code> property in\r\n            the current context". Block helpers may manipulate the current\r\n            context, but they do not change the basic meaning of an expression.\r\n            </div>\r\n        </div>\r\n        <div class="bullet">\r\n            <div class="description">\r\n                Handlebars expressions can also be dot-separated paths.\r\n            </div>\r\n            <pre class="sunburst"><span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span><span class="EmbeddedSourceBright">&#123;&#123;article.title&#125;&#125;</span><span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span>&#x000A;</pre>\r\n            <div class="notes">\r\n                This expression means "look up the <code>article</code> property in\r\n            the current context. Then look up the <code>title</code>\r\n                property in the result".\r\n            </div>\r\n        </div>\r\n        <div class="bullet">\r\n            <div class="description">\r\n                Identifiers may be any unicode character except for the following:\r\n            </div>\r\n            <div class="notes">\r\n                Whitespace\r\n            <code>!</code>\r\n                <code>"</code>\r\n                <code>#</code>\r\n                <code>%</code>\r\n                <code>&</code>\r\n                <code>\'</code>\r\n                <code>(</code>\r\n                <code>)</code>\r\n                <code>*</code>\r\n                <code>+</code>\r\n                <code>,</code>\r\n                <code>.</code>\r\n                <code>/</code>\r\n                <code>;</code>\r\n                <code><</code>\r\n                <code>=</code>\r\n                <code>></code>\r\n                <code>@</code>\r\n                <code>[</code>\r\n                <code>\\</code>\r\n                <code>]</code>\r\n                <code>^</code>\r\n                <code>`</code>\r\n                <code>{</code>\r\n                <code>|\x3c!-- Comment to prevent multiline parsing --\x3e</code>\r\n                <code>}</code>\r\n                <code>~</code>\r\n            </div>\r\n        </div>\r\n        <div class="bullet">\r\n            <div class="description">\r\n                To reference a property that is not a valid identifier, you can\r\n            use segment-literal notation, <code>[</code>:\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;#each articles.[10].[#comments]&#125;&#125;</span>&#x000A;  <span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span><span class="EmbeddedSourceBright">&#123;&#123;subject&#125;&#125;</span><span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span>&#x000A;  <span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">div</span><span class="MetaTagAll">&gt;</span></span>&#x000A;    <span class="EmbeddedSourceBright">&#123;&#123;body&#125;&#125;</span>&#x000A;  <span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">div</span><span class="MetaTagAll">&gt;</span></span>&#x000A;<span class="EmbeddedSourceBright">&#123;&#123;/each&#125;&#125;</span>&#x000A;</pre>\r\n            <div class="notes">\r\n                In the example above, the template will treat the <code>each</code>\r\n                parameter roughly equivalent to this javascript:\r\n            <code>articles[10][\'#comments\']</code>\r\n            </div>\r\n            <div class="notes">\r\n                You may not include a closing <code>]</code> in a path-literal,\r\n            but all other characters are fair game.\r\n            </div>\r\n            <div class="description">\r\n                JavaScript-style strings, <code>"</code> and <code>\'</code>, may also be used vs. <code>[</code>\r\n                pairs.\r\n            </div>\r\n        </div>\r\n        <div class="bullet">\r\n            <div class="description">\r\n                Handlebars HTML-escapes values returned by a <code>&#123;&#123;expression&#125;&#125;</code>.\r\n            If you don\'t want Handlebars to escape a value, use the "triple-stash", <code>&#123;&#123;{</code>\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;{foo&#125;&#125;</span>}&#x000A;</pre>\r\n        </div>\r\n    </div>\r\n    <h2 id="conditionals">The <code>if</code> block helper\r\n    </h2>\r\n    <div class="content">\r\n        <div class="bullet">\r\n            <div class="description">\r\n                You can use the <code>if</code> helper to conditionally render a block. If\r\n              its argument returns <code>false</code>, <code>undefined</code>, <code>null</code>,\r\n              <code>""</code>, <code>0</code>, or <code>[]</code>, Handlebars will not\r\n              render the block.\r\n            </div>\r\n            <pre class="sunburst"><span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">div</span> <span class="MetaTagAll">class</span>=<span class="String"><span class="String">&quot;</span>entry<span class="String">&quot;</span></span><span class="MetaTagAll">&gt;</span></span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;#if author&#125;&#125;</span>&#x000A;    <span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span><span class="EmbeddedSourceBright">&#123;&#123;firstName&#125;&#125;</span> <span class="EmbeddedSourceBright">&#123;&#123;lastName&#125;&#125;</span><span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;/if&#125;&#125;</span>&#x000A;<span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">div</span><span class="MetaTagAll">&gt;</span></span>&#x000A;</pre>\r\n            <div class="notes">\r\n                when used with an empty (<code>{}</code>) context, <code>author</code> will be\r\n              <code>undefined</code>, resulting in:\r\n            </div>\r\n            <pre class="sunburst"><span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">div</span> <span class="MetaTagAll">class</span>=<span class="String"><span class="String">&quot;</span>entry<span class="String">&quot;</span></span><span class="MetaTagAll">&gt;</span></span>&#x000A;<span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">div</span><span class="MetaTagAll">&gt;</span></span>&#x000A;</pre>\r\n        </div>\r\n        <div class="bullet">\r\n            <div class="description">\r\n                When using a block expression, you can specify a template section to\r\n              run if the expression returns a falsy value. The section, marked by\r\n              <code>&#123;&#123;else&#125;&#125;</code> is called an "else section".\r\n            </div>\r\n            <pre class="sunburst"><span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">div</span> <span class="MetaTagAll">class</span>=<span class="String"><span class="String">&quot;</span>entry<span class="String">&quot;</span></span><span class="MetaTagAll">&gt;</span></span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;#if author&#125;&#125;</span>&#x000A;    <span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span><span class="EmbeddedSourceBright">&#123;&#123;firstName&#125;&#125;</span> <span class="EmbeddedSourceBright">&#123;&#123;lastName&#125;&#125;</span><span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;else&#125;&#125;</span>&#x000A;    <span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span>Unknown Author<span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">h1</span><span class="MetaTagAll">&gt;</span></span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;/if&#125;&#125;</span>&#x000A;<span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">div</span><span class="MetaTagAll">&gt;</span></span>&#x000A;</pre>\r\n        </div>\r\n    </div>\r\n    <h2 id="unless">The <code>unless</code> block helper\r\n    </h2>\r\n    <div class="content">\r\n        <div class="bullet">\r\n            <div class="description">\r\n                You can use the <code>unless</code> helper as the inverse of the\r\n              <code>if</code> helper. Its block will be rendered if the expression\r\n              returns a falsy value.\r\n            </div>\r\n            <pre class="sunburst"><span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">div</span> <span class="MetaTagAll">class</span>=<span class="String"><span class="String">&quot;</span>entry<span class="String">&quot;</span></span><span class="MetaTagAll">&gt;</span></span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;#unless license&#125;&#125;</span>&#x000A;  <span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">h3</span> <span class="MetaTagAll">class</span>=<span class="String"><span class="String">&quot;</span>warning<span class="String">&quot;</span></span><span class="MetaTagAll">&gt;</span></span>WARNING: This entry does not have a license!<span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">h3</span><span class="MetaTagAll">&gt;</span></span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;/unless&#125;&#125;</span>&#x000A;<span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">div</span><span class="MetaTagAll">&gt;</span></span>&#x000A;</pre>\r\n            <div class="notes">\r\n                If looking up <code>license</code> under the current context returns a\r\n              falsy value, Handlebars will render the warning. Otherwise, it will render\r\n              nothing.\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <h2 id="iteration">The <code>each</code> block helper\r\n    </h2>\r\n    <div class="content">\r\n        <div class="bullet">\r\n            <div class="description">\r\n                You can iterate over a list using the built-in <code>each</code>\r\n                helper. Inside the block, you can use <code>this</code> to reference\r\n              the element being iterated over.\r\n            </div>\r\n            <pre class="sunburst"><span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">ul</span> <span class="MetaTagAll">class</span>=<span class="String"><span class="String">&quot;</span>people_list<span class="String">&quot;</span></span><span class="MetaTagAll">&gt;</span></span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;#each people&#125;&#125;</span>&#x000A;    <span class="MetaTagInline"><span class="MetaTagInline">&lt;</span><span class="MetaTagInline">li</span><span class="MetaTagInline">&gt;</span></span><span class="EmbeddedSourceBright">&#123;&#123;this&#125;&#125;</span><span class="MetaTagInline"><span class="MetaTagInline">&lt;/</span><span class="MetaTagInline">li</span><span class="MetaTagInline">&gt;</span></span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;/each&#125;&#125;</span>&#x000A;<span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">ul</span><span class="MetaTagAll">&gt;</span></span>&#x000A;</pre>\r\n            <div class="notes">\r\n                when used with this context:\r\n            </div>\r\n            <pre class="sunburst">{&#x000A;  people: [&#x000A;    <span class="String"><span class="String">&quot;</span>Yehuda Katz<span class="String">&quot;</span></span>,&#x000A;    <span class="String"><span class="String">&quot;</span>Alan Johnson<span class="String">&quot;</span></span>,&#x000A;    <span class="String"><span class="String">&quot;</span>Charles Jolley<span class="String">&quot;</span></span>&#x000A;  ]&#x000A;}&#x000A;</pre>\r\n            <div class="notes">\r\n                will result in:\r\n            </div>\r\n            <pre class="sunburst"><span class="Keyword">&lt;</span>ul <span class="Storage">class</span><span class="Keyword">=</span><span class="String"><span class="String">&quot;</span>people_list<span class="String">&quot;</span></span><span class="Keyword">&gt;</span>&#x000A;  <span class="Keyword">&lt;</span>li<span class="Keyword">&gt;</span>Yehuda Katz<span class="Keyword">&lt;</span>/li<span class="Keyword">&gt;</span>&#x000A;  <span class="Keyword">&lt;</span>li<span class="Keyword">&gt;</span>Alan Johnson<span class="Keyword">&lt;</span>/li<span class="Keyword">&gt;</span>&#x000A;  <span class="Keyword">&lt;</span>li<span class="Keyword">&gt;</span>Charles Jolley<span class="Keyword">&lt;</span>/li<span class="Keyword">&gt;</span>&#x000A;<span class="Keyword">&lt;</span>/ul<span class="Keyword">&gt;</span>&#x000A;</pre>\r\n            <div class="notes">\r\n                You can use the <code>this</code> expression in any context to reference\r\n              the current context.\r\n            </div>\r\n        </div>\r\n        <div class="bullet">\r\n            <div class="description">\r\n                You can optionally provide an <code>&#123;&#123;else&#125;&#125;</code> section which will display only when the list is empty.\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;#each paragraphs&#125;&#125;</span>&#x000A;  <span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">p</span><span class="MetaTagAll">&gt;</span></span><span class="EmbeddedSourceBright">&#123;&#123;this&#125;&#125;</span><span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">p</span><span class="MetaTagAll">&gt;</span></span>&#x000A;<span class="EmbeddedSourceBright">&#123;&#123;else&#125;&#125;</span>&#x000A;  <span class="MetaTagAll"><span class="MetaTagAll">&lt;</span><span class="MetaTagAll">p</span> <span class="MetaTagAll">class</span>=<span class="String"><span class="String">&quot;</span>empty<span class="String">&quot;</span></span><span class="MetaTagAll">&gt;</span></span>No content<span class="MetaTagAll"><span class="MetaTagAll">&lt;/</span><span class="MetaTagAll">p</span><span class="MetaTagAll">&gt;</span></span>&#x000A;<span class="EmbeddedSourceBright">&#123;&#123;/each&#125;&#125;</span>&#x000A;</pre>\r\n        </div>\r\n        <div class="bullet">\r\n            <div class="description">\r\n                When looping through items in <code>each</code>, you can optionally reference the current loop index via <code>&#123;&#123;@index&#125;&#125;</code>\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;#each array&#125;&#125;</span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;@index&#125;&#125;</span>: <span class="EmbeddedSourceBright">&#123;&#123;this&#125;&#125;</span>&#x000A;<span class="EmbeddedSourceBright">&#123;&#123;/each&#125;&#125;</span>&#x000A;</pre>\r\n            <div class="notes">\r\n                Additionally for object iteration, <code>&#123;&#123;@key&#125;&#125;</code> references the current key name:\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;#each object&#125;&#125;</span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;@key&#125;&#125;</span>: <span class="EmbeddedSourceBright">&#123;&#123;this&#125;&#125;</span>&#x000A;<span class="EmbeddedSourceBright">&#123;&#123;/each&#125;&#125;</span>&#x000A;</pre>\r\n            <div class="notes">\r\n                The first and last steps of iteration are noted via the <code>@first</code> and <code>@last</code>\r\n                variables when iterating over an array. When iterating over an object only the <code>@first</code>\r\n                is available.\r\n            </div>\r\n            <div class="notes">\r\n                Nested <code>each</code> blocks may access the interation variables via depth based paths.\r\n              To access the parent index, for example, <code>&#123;&#123;@../index&#125;&#125;</code> can be used.\r\n            </div>\r\n        </div>\r\n        <div class="bullet">\r\n            <div class="description">\r\n                The <code>each</code> helper also supports <a href="block_helpers.html#block-params">block parameters</a>, allowing for named references anywhere in the block.\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;#each array as |value key|&#125;&#125;</span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;#each child as |childValue childKey|&#125;&#125;</span>&#x000A;    <span class="EmbeddedSourceBright">&#123;&#123;key&#125;&#125;</span> - <span class="EmbeddedSourceBright">&#123;&#123;childKey&#125;&#125;</span>. <span class="EmbeddedSourceBright">&#123;&#123;childValue&#125;&#125;</span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;/each&#125;&#125;</span>&#x000A;<span class="EmbeddedSourceBright">&#123;&#123;/each&#125;&#125;</span>&#x000A;</pre>\r\n            <div class="notes">\r\n                Will create a <code>key</code> and <code>value</code> variable that children may access without the need for depthed variable references. In the example above, <code>&#123;&#123;key&#125;&#125;</code> is identical to <code>&#123;&#123;@../key&#125;&#125;</code> but in many cases is more readable.\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <h2 id="lookup">The <code>lookup</code> helper\r\n    </h2>\r\n    <div class="contents">\r\n        <div class="bullet">\r\n            <div class="description">\r\n                The <code>lookup</code> helper allows for dynamic parameter resolution using Handlebars\r\n              variables. This is useful for resolving values for array indexes.\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;#each bar&#125;&#125;</span>&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;lookup ../foo @index&#125;&#125;</span>&#x000A;<span class="EmbeddedSourceBright">&#123;&#123;/each&#125;&#125;</span>&#x000A;</pre>\r\n        </div>\r\n    </div>\r\n    <h2 id="log">The <code>log</code> block helper\r\n    </h2>\r\n    <div class="contents">\r\n        <div class="bullet">\r\n            <div class="description">\r\n                The <code>log</code> helper allows for logging of context state while executing\r\n              a template.\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;log &quot;Look at me!&quot;&#125;&#125;</span>&#x000A;</pre>\r\n            <div class="notes">\r\n                Delegates to <code>Handlebars.logger.log</code> which may\r\n              be overriden to perform custom logging.\r\n            </div>\r\n            <div class="notes">\r\n                Any number of arguments may be passed to this method and all will be forwarded to the logger.\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;log &quot;This is logged&quot; foo &quot;And so is this&quot;&#125;&#125;</span>&#x000A;</pre>\r\n            <div class="notes">\r\n                The log level may be set using the <code>level</code> hash parameter. Supported values are <code>debug</code>, <code>info</code>, <code>warn</code>, and <code>error</code>. When omitted, <code>info</code> is the default value,\r\n            </div>\r\n            <pre class="sunburst"><span class="EmbeddedSourceBright">&#123;&#123;log &quot;Log!&quot; level=&quot;error&quot;&#125;&#125;</span>&#x000A;</pre>\r\n            <div class="notes">\r\n                Logging is conditional based on the level and to value set in <code>Handlebars.logger.level</code>, which defaults to <code>info</code>. All log statements at or above the current level will be output.\r\n            </div>\r\n        </div>\r\n    </div>\r\n    \r\n    <h2 id="escaping">Escaping\r\n    </h2>\r\n    <div class="contents">\r\n        <div class="bullet">\r\n            <div class="description">\r\n                Handlebars content may be escaped in one of two ways, inline escapes or raw block helpers.\r\n                Inline escapes created by prefixing a mustache block with <code>\\</code>. Raw blocks are\r\n                created using <code>&#123;&#123;&#123;&#123;</code> mustache braces.\r\n            </div>\r\n            <pre class="sunburst">\\<span class="EmbeddedSourceBright">&#123;&#123;escaped&#125;&#125;</span>&#x000A;<span class="EmbeddedSourceBright">&#123;&#123;&#123;&#123;raw&#125;&#125;</span>&#125;&#125;&#x000A;  <span class="EmbeddedSourceBright">&#123;&#123;escaped&#125;&#125;</span>&#x000A;<span class="EmbeddedSourceBright">&#123;&#123;&#123;&#123;/raw&#125;&#125;</span>&#125;&#125;&#x000A;</pre>\r\n            <div class="notes">\r\n                Raw blocks operate in the same manner as other <a href="/block_helpers.html">block helpers</a>\r\n                with the distinction of the child content is treated as a literal string.\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <h2>More...\r\n    </h2>\r\n    <div class="contents">\r\n        More information can be found on the Handlerbars website <a href="http://http://handlebarsjs.com">here</a>.\r\n    </div>\r\n</div>\r\n'},useData:!0}),A.IconDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="search">\r\n    <input name="q" type="text" size="40" placeholder="Search Icons..." />\r\n    <i class="fa fa-fw fa-search"></i>\r\n</div>\r\n<div class="grid"></div>\r\n'},useData:!0}),A.IconDialogItem=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<a title="'+l(typeof(e=null!=(e=i.icon||(null!=t?t.icon:t))?e:s)==r?e.call(o,{name:"icon",hash:{},data:a}):e)+'"><i class="gridItem '+l(typeof(e=null!=(e=i.type||(null!=t?t.type:t))?e:s)==r?e.call(o,{name:"type",hash:{},data:a}):e)+" "+l(typeof(e=null!=(e=i.subtype||(null!=t?t.subtype:t))?e:s)==r?e.call(o,{name:"subtype",hash:{},data:a}):e)+" "+l(typeof(e=null!=(e=i.type||(null!=t?t.type:t))?e:s)==r?e.call(o,{name:"type",hash:{},data:a}):e)+"-"+l(typeof(e=null!=(e=i.icon||(null!=t?t.icon:t))?e:s)==r?e.call(o,{name:"icon",hash:{},data:a}):e)+'"></i><div class="gridItemName">'+l(typeof(e=null!=(e=i.icon||(null!=t?t.icon:t))?e:s)==r?e.call(o,{name:"icon",hash:{},data:a}):e)+"</div></a>"},useData:!0}),A.IconDialogItemMD=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<a title="'+l(typeof(e=null!=(e=i.icon||(null!=t?t.icon:t))?e:s)==r?e.call(o,{name:"icon",hash:{},data:a}):e)+'"><i class="gridItem fa fa-fw '+l(typeof(e=null!=(e=i.type||(null!=t?t.type:t))?e:s)==r?e.call(o,{name:"type",hash:{},data:a}):e)+"-"+l(typeof(e=null!=(e=i.icon||(null!=t?t.icon:t))?e:s)==r?e.call(o,{name:"icon",hash:{},data:a}):e)+' \'"></i><div class="gridItemName">'+l(typeof(e=null!=(e=i.icon||(null!=t?t.icon:t))?e:s)==r?e.call(o,{name:"icon",hash:{},data:a}):e)+"</div></a>"},useData:!0}),A.JsonDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="json-editor" spellcheck="false"></div>\r\n'},useData:!0}),A.LoadingScreen=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o;return'<div class="loading" style="display: table; width: 100%; height: 100%; opacity: 0.9; pointer-events: none;">\r\n    <div style="display: table-cell; width: 100%; height: 100%; vertical-align: middle; text-align: center;">\r\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" width="64" height="64" fill="#D2D2D2">\r\n            <circle cx="16" cy="3" r="0">\r\n                <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n            </circle>\r\n            <circle transform="rotate(45 16 16)" cx="16" cy="3" r="0">\r\n                <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.125s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n            </circle>\r\n            <circle transform="rotate(90 16 16)" cx="16" cy="3" r="0">\r\n                <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.25s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n            </circle>\r\n            <circle transform="rotate(135 16 16)" cx="16" cy="3" r="0.567031">\r\n                <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.375s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n            </circle>\r\n            <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\r\n                <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n            </circle>\r\n            <circle transform="rotate(225 16 16)" cx="16" cy="3" r="2.88475">\r\n                <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.625s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n            </circle>\r\n            <circle transform="rotate(270 16 16)" cx="16" cy="3" r="2.1029">\r\n                <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.75s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n            </circle>\r\n            <circle transform="rotate(315 16 16)" cx="16" cy="3" r="0.60761">\r\n                <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.875s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n            </circle>\r\n            <circle transform="rotate(180 16 16)" cx="16" cy="3" r="1.82452">\r\n                <animate attributeName="r" values="0;3;0;0" dur="1s" repeatCount="indefinite" begin="0.5s" keySplines="0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8;0.2 0.2 0.4 0.8" calcMode="spline" />\r\n            </circle>\r\n        </svg>\r\n        <div style="color: #D2D2D2; font-weight: bold; margin-top: 7px; font-size: 11px; letter-spacing: 1px;">\r\n            '+e.escapeExpression("function"==typeof(o=null!=(o=i.text||(null!=t?t.text:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"text",hash:{},data:a}):o)+"\r\n        </div>\r\n    </div>\r\n</div>"},useData:!0}),A.LoginHistoryDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="grid-div">\r\n</div>'},useData:!0}),A.MainToolbar=Handlebars.template({1:function(e,t,i,n,a){return'<a class="toolbar-toggler"></a>\r\n'},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r=e.escapeExpression;return'<div class="logo"></div>\r\n\r\n<div class="document-selector" style="display: inline-block;"></div>\r\n\r\n<div class="main">\r\n    <a class="new-dash">'+r((i.t||t&&t.t||s).call(o,"New Dashboard",{name:"t",hash:{},data:a}))+'</a><a class="save-dash">'+r((i.t||t&&t.t||s).call(o,"Save Dashboard",{name:"t",hash:{},data:a}))+'</a><a class="undo-action" title="Undo Action">'+r((i.t||t&&t.t||s).call(o,"Undo Action",{name:"t",hash:{},data:a}))+'</a><a class="redo-action" title="Redo Action">'+r((i.t||t&&t.t||s).call(o,"Redo Action",{name:"t",hash:{},data:a}))+'</a>\r\n</div>\r\n\r\n<div class="content-toggle">\r\n    <input type="checkbox" id="checkbtn"><label for="checkbtn" title="'+r((i.t||t&&t.t||s).call(o,"Toggle Design/Preview view",{name:"t",hash:{},data:a}))+'">\r\n        <span class="design"><i class="fa fa-fw fa-pencil-square-o"></i>'+r((i.t||t&&t.t||s).call(o,"Design",{name:"t",hash:{},data:a}))+'</span>\r\n        <span class="preview"><i class="fa fa-fw fa-desktop"></i>'+r((i.t||t&&t.t||s).call(o,"Preview",{name:"t",hash:{},data:a}))+'</span>\r\n    </label>\r\n</div>\r\n\r\n<div class="connectionStatus"></div>\r\n\r\n<div class="profile">\r\n    <button>\r\n        <i class="fa fa-fw fa-user"></i>\r\n        <span class="user-name-wrap">\r\n            <span class="user-name"></span>\r\n        </span>\r\n    </button>\r\n\r\n    <div class="profile-menu"></div>\r\n</div>\r\n'+(null!=(a=i.if.call(o,null!=t?t.hideToolbar:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?a:"")+"\r\n"},useData:!0}),A.ManageDashWindow=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="manage-documents-toolbar">\r\n    <button class="open">'+e((i.t||t&&t.t||s).call(o,"open",{name:"t",hash:{},data:a}))+'</button>\r\n    <button class="view"> '+e((i.t||t&&t.t||s).call(o,"view on web",{name:"t",hash:{},data:a}))+'</button>\r\n    <button class="delete">'+e((i.t||t&&t.t||s).call(o,"delete",{name:"t",hash:{},data:a}))+'</button>\r\n    <button class="export" title="'+e((i.t||t&&t.t||s).call(o,"Export",{name:"t",hash:{},data:a}))+'">'+e((i.t||t&&t.t||s).call(o,"export",{name:"t",hash:{},data:a}))+'</button>\r\n    <input type="file" id="dashImportFile" name="files" accept=".json,application/xml" style="display: none;" multiple />\r\n    <button class="import">'+e((i.t||t&&t.t||s).call(o,"Import",{name:"t",hash:{},data:a}))+'</button>\r\n    <div class="search-box">\r\n        <i class="fa fa-search"></i>\r\n        <input class="search-input">\r\n        <span class="clearSearch fa fa-times" style="display: none"></span>\r\n    </div>\r\n</div>\r\n\r\n<div class="dash-list-headers">\r\n\r\n    <span class="name-sort" style="margin-left: 11px;">\r\n        '+e((i.t||t&&t.t||s).call(o,"name",{name:"t",hash:{},data:a}))+'\r\n        <i class="fa fa-caret-down"></i>\r\n        <i class="fa fa-caret-up"></i>\r\n    </span>\r\n\r\n    <span class="last-modified-sort" style="float: right; margin-right: 31px;">\r\n        '+e((i.t||t&&t.t||s).call(o,"last modified",{name:"t",hash:{},data:a}))+'\r\n        <i class="fa fa-caret-down"></i>\r\n        <i class="fa fa-caret-up"></i>\r\n    </span>\r\n</div>\r\n\r\n<div class="content-container">\r\n    <div class="dashboards-list">\r\n\r\n    </div>\r\n</div>'},useData:!0}),A.MenuLayoutCheckbox=Handlebars.template({1:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'    <label><input type="checkbox" name="'+l(typeof(e=null!=(e=i.title||(null!=t?t.title:t))?e:s)==r?e.call(o,{name:"title",hash:{},data:a}):e)+'" class="GENERATED->'+l(typeof(e=null!=(e=i.class||(null!=t?t.class:t))?e:s)==r?e.call(o,{name:"class",hash:{},data:a}):e)+'" '+l(typeof(e=null!=(e=i.checked||(null!=t?t.checked:t))?e:s)==r?e.call(o,{name:"checked",hash:{},data:a}):e)+">"+l(typeof(e=null!=(e=i.description||(null!=t?t.description:t))?e:s)==r?e.call(o,{name:"description",hash:{},data:a}):e)+"</label>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return null!=(a=i.each.call(null!=t?t:e.nullContext||{},null!=t?t.checkboxes:t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?a:""},useData:!0}),A.MenuLayoutItem=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<div id="'+l(typeof(e=null!=(e=i.id||(null!=t?t.id:t))?e:s)==r?e.call(o,{name:"id",hash:{},data:a}):e)+'" class="ui-widget-content">\n    <div class="label">'+l(typeof(e=null!=(e=i.label||(null!=t?t.label:t))?e:s)==r?e.call(o,{name:"label",hash:{},data:a}):e)+'</div>\n    <img src="'+l(typeof(e=null!=(e=i.image||(null!=t?t.image:t))?e:s)==r?e.call(o,{name:"image",hash:{},data:a}):e)+'" style="width: 100%">\n    <div class="description">'+l(typeof(e=null!=(e=i.description||(null!=t?t.description:t))?e:s)==r?e.call(o,{name:"description",hash:{},data:a}):e)+"</div>\n</div>"},useData:!0}),A.MenuLayoutList=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o;return'<div class="ui-widget-header title">'+e.escapeExpression("function"==typeof(o=null!=(o=i.text||(null!=t?t.text:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"text",hash:{},data:a}):o)+'</div>\n<div class="ui-widget-content presets"></div>\n<div class="ui-widget-content checkboxes"></div>'},useData:!0}),A.MessageDialog=Handlebars.template({1:function(e,t,i,n,a){var o;return'<label><input type="checkbox" />'+e.escapeExpression("function"==typeof(o=null!=(o=i.check||(null!=t?t.check:t))?o:i.helperMissing)?o.call(null!=t?t:e.nullContext||{},{name:"check",hash:{},data:a}):o)+"</label>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o,s=null!=t?t:e.nullContext||{};return'<div class="msg">'+(null!=(o="function"==typeof(o=null!=(o=i.message||(null!=t?t.message:t))?o:i.helperMissing)?o.call(s,{name:"message",hash:{},data:a}):o)?o:"")+"</div>\r\n"+(null!=(o=i.if.call(s,null!=t?t.check:t,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?o:"")},useData:!0}),A.Notificator=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="panel ui-widget-content">\r\n    <div class="title"></div>\r\n    <div class="items"></div>\r\n    <button class="close-button">\r\n        Close\r\n    </button>\r\n</div>'},useData:!0}),A.PropertiesPanel=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="panel-header">\r\n    <span class="propertySearch">\r\n        <i class="searchIcon fa fa-search"></i>\r\n        <input class="searchInput" placeholder="search properties...">\r\n    </span>\r\n    <i class="fa fa-question-circle dashboardHelp" aria-hidden="true" title="Component Help / Documentation"></i>\r\n    <div class="pin-button">\r\n        <i class="fa fa-caret-right"></i><i class="fa fa-caret-right"></i>\r\n    </div>\r\n    <span class="lblWidgetName">'+e.escapeExpression((i.t||t&&t.t||i.helperMissing).call(null!=t?t:e.nullContext||{},"dashboard",{name:"t",hash:{},data:a}))+'</span>\r\n\r\n</div>\r\n<div class="panel-document">\r\n\r\n</div>\r\n<div class="panel-content">\r\n</div>\r\n\r\n<div class="expand-button">\r\n    <div class="header">\r\n        properties\r\n    </div>\r\n</div>'},useData:!0}),A.PropertiesPanelContent=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="tabs">\r\n  <ul>\r\n    <li><a href="#tabs-1">Nunc tincidunt</a></li>\r\n    <li><a href="#tabs-2">Proin dolor</a></li>\r\n    <li><a href="#tabs-3">Aenean lacinia</a></li>\r\n  </ul>\r\n  <div id="tabs-1">\r\n    <p>Proin elit arcu, rutrum commodo, vehicula tempus, commodo a, risus. Curabitur nec arcu. Donec sollicitudin mi sit amet mauris. Nam elementum quam ullamcorper ante. Etiam aliquet massa et lorem. Mauris dapibus lacus auctor risus. Aenean tempor ullamcorper leo. Vivamus sed magna quis ligula eleifend adipiscing. Duis orci. Aliquam sodales tortor vitae ipsum. Aliquam nulla. Duis aliquam molestie erat. Ut et mauris vel pede varius sollicitudin. Sed ut dolor nec orci tincidunt interdum. Phasellus ipsum. Nunc tristique tempus lectus.</p>\r\n  </div>\r\n  <div id="tabs-2">\r\n    <p>Morbi tincidunt, dui sit amet facilisis feugiat, odio metus gravida ante, ut pharetra massa metus id nunc. Duis scelerisque molestie turpis. Sed fringilla, massa eget luctus malesuada, metus eros molestie lectus, ut tempus eros massa ut dolor. Aenean aliquet fringilla sem. Suspendisse sed ligula in ligula suscipit aliquam. Praesent in eros vestibulum mi adipiscing adipiscing. Morbi facilisis. Curabitur ornare consequat nunc. Aenean vel metus. Ut posuere viverra nulla. Aliquam erat volutpat. Pellentesque convallis. Maecenas feugiat, tellus pellentesque pretium posuere, felis lorem euismod felis, eu ornare leo nisi vel felis. Mauris consectetur tortor et purus.</p>\r\n  </div>\r\n  <div id="tabs-3">\r\n    <p>Mauris eleifend est et turpis. Duis id erat. Suspendisse potenti. Aliquam vulputate, pede vel vehicula accumsan, mi neque rutrum erat, eu congue orci lorem eget lorem. Vestibulum non ante. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Fusce sodales. Quisque eu urna vel enim commodo pellentesque. Praesent eu risus hendrerit ligula tempus pretium. Curabitur lorem enim, pretium nec, feugiat nec, luctus a, lacus.</p>\r\n    <p>Duis cursus. Maecenas ligula eros, blandit nec, pharetra at, semper at, magna. Nullam ac lacus. Nulla facilisi. Praesent viverra justo vitae neque. Praesent blandit adipiscing velit. Suspendisse potenti. Donec mattis, pede vel pharetra blandit, magna ligula faucibus eros, id euismod lacus dolor eget odio. Nam scelerisque. Donec non libero sed nulla mattis commodo. Ut sagittis. Donec nisi lectus, feugiat porttitor, tempor ac, tempor vitae, pede. Aenean vehicula velit eu tellus interdum rutrum. Maecenas commodo. Pellentesque nec elit. Fusce in lacus. Vivamus a libero vitae lectus hendrerit hendrerit.</p>\r\n  </div>\r\n</div>'},useData:!0}),A.PropertiesPanelDocument=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="document-properties">\r\n    <div class="property-editor"></div>\r\n</div>\r\n\r\n<span class="documentGraphBtn">'+e((i.t||t&&t.t||s).call(o,"Document Graph",{name:"t",hash:{},data:a}))+'</span>\r\n<span class="connectionMgmtBtn">'+e((i.t||t&&t.t||s).call(o,"Connections",{name:"t",hash:{},data:a}))+"</span>\r\n"},useData:!0}),A.RichTextEditorDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<div class="toolbar ui-widget-header ui-corner-all" id="htmlxEdit">\r\n</div>\r\n<div class="editor" style="background:'+l(typeof(e=null!=(e=i.background||(null!=t?t.background:t))?e:s)==r?e.call(o,{name:"background",hash:{},data:a}):e)+'">\r\n    <textarea id="'+l(typeof(e=null!=(e=i.uid||(null!=t?t.uid:t))?e:s)==r?e.call(o,{name:"uid",hash:{},data:a}):e)+'"></textarea>\r\n</div>\r\n<div class="code" style="display: none">\r\n</div>\r\n'},useData:!0}),A.ScreenItem=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<div style="display: table; width: 100%; height: 100%;">\r\n    <div style="display: table-cell; width: 100%; height: 100%; vertical-align: middle; text-align: center;">\r\n\r\n        <div class="screen-thumb-wrapper">\r\n            <img class="screen-thumb" src="'+l(typeof(e=null!=(e=i.thumb||(null!=t?t.thumb:t))?e:s)==r?e.call(o,{name:"thumb",hash:{},data:a}):e)+'" />\r\n            <div class="default-thumb">\r\n                <div style="display: table; width: 100%; height: 100%;">\r\n                    <div style="display: table-cell; width: 100%; height: 100%; vertical-align: middle; text-align: center;">\r\n                        <i class="fa fa-pencil-square-o"></i>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n            <div class="remove-screen-btn" title="'+l((i.t||t&&t.t||s).call(o,"Remove Screen",{name:"t",hash:{},data:a}))+'">\r\n                <i class="fa fa-times"></i>\r\n            </div>\r\n\r\n            <div class="make-default-screen-btn">\r\n                <i class="fa fa-star"></i>\r\n            </div>\r\n            <div class="duplicate-screen-btn" title="'+l((i.t||t&&t.t||s).call(o,"Duplicate Screen",{name:"t",hash:{},data:a}))+'">\r\n                <i class="fa fa-copy"></i>\r\n            </div>\r\n\r\n            <a class="camera" title="'+l((i.t||t&&t.t||s).call(o,null!=t?t.Take:t,null!=t?t.Screenshot:t,{name:"t",hash:{},data:a}))+'">\r\n                <i class="fa fa-camera"></i>\r\n            </a>\r\n        </div>\r\n\r\n        <div class="screen-name">\r\n            '+l(typeof(e=null!=(e=i.name||(null!=t?t.name:t))?e:s)==r?e.call(o,{name:"name",hash:{},data:a}):e)+"\r\n        </div>\r\n\r\n    </div>\r\n</div>"},useData:!0}),A.ScreenList=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="screen-list">\r\n        \x3c!--<div class="screen-list-header">'+e((i.t||t&&t.t||s).call(o,"Screens",{name:"t",hash:{},data:a}))+'</div>--\x3e\r\n\r\n    <div class="list-scroll-wrap">\r\n        <ul></ul>\r\n    </div>\r\n\r\n    <div style="text-align: right;">\r\n        <div class="add-screen-button">\r\n            '+e((i.t||t&&t.t||s).call(o,"Add Screen",{name:"t",hash:{},data:a}))+"\r\n        </div>\r\n    </div>\r\n</div>"},useData:!0}),A.SubscriptionSelect=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<fieldset>\r\n    <span>\r\n        <label>Subscription:</label> \r\n        <label class="staticRadio"><input type="radio" name="_subscriptionType" class="static" value="static" checked>'+e((i.t||t&&t.t||s).call(o,"Static",{name:"t",hash:{},data:a}))+'</label>\r\n        <label class="subscriptionRadio"><input type="radio" name="_subscriptionType" class="subscription" value="subscription">'+e((i.t||t&&t.t||s).call(o,"Managed",{name:"t",hash:{},data:a}))+'</label>\r\n        <label class="streamingRadio"><input type="radio" name="_subscriptionType" class="streaming" value="streaming">'+e((i.t||t&&t.t||s).call(o,"Streaming",{name:"t",hash:{},data:a}))+'</label>\r\n        <label class="pollingRadio"><input type="radio" name="_subscriptionType" class="polling" value="polling">'+e((i.t||t&&t.t||s).call(o,"Polling",{name:"t",hash:{},data:a}))+'</label>\r\n    </span>\r\n    <div>\r\n        <span class="subscriptionParamInput">Interval: <span class="subscriptionIntervalContainer bbf-editor"></span>s</span>\r\n        <span class="subscriptionParamInput">Key: <select name="_subscriptionKey" class="subscriptionKey"></select></span>\r\n        <span class="subscriptionParamInput">Force Reset: <input name="_forceReset" class="_forceReset" type="checkbox" /></span>\r\n    </div>\r\n    <div class="legend-right">\r\n        <label class="server-paging" title="'+e((i.t||t&&t.t||s).call(o,"Page and sort results on the server",{name:"t",hash:{},data:a}))+'">\r\n            <input type="checkbox" name="_serverPaging" />'+e((i.t||t&&t.t||s).call(o,"Paged",{name:"t",hash:{},data:a}))+'\r\n        </label>\r\n        <label class="max-rows" title="'+e((i.t||t&&t.t||s).call(o,"Specify the maximum number of row returned",{name:"t",hash:{},data:a}))+'">\r\n            Max rows:\r\n            <input name="_maxRows" class="_maxRows" type="number" min="0" max="10000" step="1" value="2000" />\r\n        </label>\r\n        <label class="page-size" title="'+e((i.t||t&&t.t||s).call(o,"Specify the number of rows per page",{name:"t",hash:{},data:a}))+'">\r\n            Page size:\r\n            <input name="_pageSize" class="_pageSize" type="number" min="0" max="10000" step="1" value="2000" />\r\n        </label>\r\n    </div>\r\n</fieldset>'},useData:!0}),A.TemplateDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<div class="sidebar">\n    <div class="topnav">\n        <i class=\'fa fa-search\'></i>\n        <input type=\'text\' class=\'searchBox\' placeholder="Search ..." />\n        <span class="clearSearch fa fa-times" style="display: none"></span>\n    </div>\n    <div class="tree"></div>\n</div>\n<div class="template-editor">\n    <div class="toolbar ui-widget-header ui-corner-right" id="htmlxEdit">\n    </div>\n    <div class="toolbar ui-widget-header ui-corner-right" id="advanced-toolbar" style="display: none;">\n        <button class="basic-mode" title="Return to Basic editor">Basic mode</button>\n        <select class="gok-handlebarselect"></select>\n        <button class="add-helper" title="Add element">Add Helper</button>\n        <button class="beautify" title="Automatically format code with indents and line breaks">Auto-format</button>\n    </div>\n    <div class="editor" style="background:'+l(typeof(e=null!=(e=i.background||(null!=t?t.background:t))?e:s)==r?e.call(o,{name:"background",hash:{},data:a}):e)+'">\n        <textarea id="'+l(typeof(e=null!=(e=i.uid||(null!=t?t.uid:t))?e:s)==r?e.call(o,{name:"uid",hash:{},data:a}):e)+'"></textarea>\n    </div>\n    <div class="code" style="display: none"></div>\n    <div class="handlebar-errors" style="display:none">\n        <span><i class="fa fa-exclamation-triangle"></i> Template error:</span>\n        <div></div>\n    </div>\n</div>'},useData:!0}),A.TooltipTemplateDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="toolbar ui-widget-header ui-corner-all" >\r\n    <table>\r\n        <tr>\r\n            <td><i class="fa fa-question-circle"></i></td>\r\n            <td style="padding: 0px 5px 0 25px;">\r\n                Value:\r\n            </td>\r\n            <td> <select class="tp-selectable js-example-basic-single"></select></td>\r\n\r\n            <td style="padding: 0px 5px 0 25px;">\r\n                Type:\r\n            </td>\r\n            <td>  \r\n                <div class="typeOfHandle">\r\n                 <input type="radio" id="div" checked="checked"><label for="div"><i class="fa fa-align-justify"></i></label>\r\n                 <input type="radio" id="li"><label for="li"><i class="fa fa-list-ul"></i></label>\r\n                 <input type="radio" id="td"><label for="td"><i class="fa fa-th-list"></i></label>\r\n                 <input type="radio" id="img"><label for="img"><i class="fa fa-picture-o"></i></label>\r\n                </div>\r\n            </td>\r\n            <td style="padding: 0px 5px 0 25px;">\r\n                Colour:\r\n            </td>\r\n            <td>\r\n                <label class="handlebar-colorPicker-tooltip" title="Pick Colour">\r\n                 <div class="handlebar-colorPicker">\r\n                        <i class="fa fa-square" style="color:#000000"></i>\r\n                 </div>\r\n                </label>\r\n            </td>\r\n            <td>\r\n                <label class="tp-selectable-add-tooltip" title="Add element">\r\n                    <div class="tp-selectable-add">\r\n                        <i class="fa fa-plus"></i>\r\n                    </div>\r\n                </label>\r\n            </td>\r\n        </tr>\r\n    </table>\r\n</div>\r\n<div class="code">\r\n    <textarea />\r\n</div>\r\n'},useData:!0}),A.TreeView=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="toolbar ui-widget-header ui-corner-all">\r\n    <button class="new">'+e((i.t||t&&t.t||s).call(o,"New",{name:"t",hash:{},data:a}))+'</button>\r\n    <button class="rename">'+e((i.t||t&&t.t||s).call(o,"Rename",{name:"t",hash:{},data:a}))+'</button>\r\n    <button class="delete">'+e((i.t||t&&t.t||s).call(o,"Delete",{name:"t",hash:{},data:a}))+'</button>\r\n    <div>\r\n        <i class="fa fa-search"></i>\r\n        <input class="search" />\r\n        <span class="clearSearch fa fa-times" style="display: none"></span>\r\n    </div>\r\n</div>\r\n<div class="tree"></div>\r\n'},useData:!0}),A.ViewStateDialog=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="accordian-container" >\r\n    <div class="treeview">\r\n        <div class="tree"/>\r\n    </div>\r\n    <div class="viewstate-editor collapsible" >\r\n        <h3 class="ui-widget-header"><i class="fa fa-fw fa-caret-down"></i>Properties</h3>\r\n        <div class="properties">\r\n        </div>\r\n    </div>\r\n</div>'},useData:!0}),A.VirtualParameter=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression;return'<div class="form-control">\r\n    \r\n    <label class="col1">'+l(typeof(e=null!=(e=i.name||(null!=t?t.name:t))?e:s)==r?e.call(o,{name:"name",hash:{},data:a}):e)+'</label>\r\n\r\n\t<div class="type-radio col2">\r\n        <input id="'+l(typeof(e=null!=(e=i.uniqueId||(null!=t?t.uniqueId:t))?e:s)==r?e.call(o,{name:"uniqueId",hash:{},data:a}):e)+'_datasource" type="radio" name="'+l(typeof(e=null!=(e=i.uniqueId||(null!=t?t.uniqueId:t))?e:s)==r?e.call(o,{name:"uniqueId",hash:{},data:a}):e)+'_parameter-type" value="datasource">\r\n        <label for="'+l(typeof(e=null!=(e=i.uniqueId||(null!=t?t.uniqueId:t))?e:s)==r?e.call(o,{name:"uniqueId",hash:{},data:a}):e)+'_datasource">Data Source</label>\r\n        \r\n        <input id="'+l(typeof(e=null!=(e=i.uniqueId||(null!=t?t.uniqueId:t))?e:s)==r?e.call(o,{name:"uniqueId",hash:{},data:a}):e)+'_viewstate" type="radio" name="'+l(typeof(e=null!=(e=i.uniqueId||(null!=t?t.uniqueId:t))?e:s)==r?e.call(o,{name:"uniqueId",hash:{},data:a}):e)+'_parameter-type" value="viewstate">\r\n        <label for="'+l(typeof(e=null!=(e=i.uniqueId||(null!=t?t.uniqueId:t))?e:s)==r?e.call(o,{name:"uniqueId",hash:{},data:a}):e)+'_viewstate">View State</label>\r\n\r\n        <input id="'+l(typeof(e=null!=(e=i.uniqueId||(null!=t?t.uniqueId:t))?e:s)==r?e.call(o,{name:"uniqueId",hash:{},data:a}):e)+'_text" type="radio" name="'+l(typeof(e=null!=(e=i.uniqueId||(null!=t?t.uniqueId:t))?e:s)==r?e.call(o,{name:"uniqueId",hash:{},data:a}):e)+'_parameter-type" value="text">\r\n        <label for="'+l(typeof(e=null!=(e=i.uniqueId||(null!=t?t.uniqueId:t))?e:s)==r?e.call(o,{name:"uniqueId",hash:{},data:a}):e)+'_text">Text</label>\r\n\t</div>\r\n\r\n\t<div class="input-div col3">\r\n\r\n\t\t<input class="value-input" type="text" value="'+l(typeof(e=null!=(e=i.value||(null!=t?t.value:t))?e:s)==r?e.call(o,{name:"value",hash:{},data:a}):e)+'" />\r\n\r\n\t\t<div class="binding-container">\r\n\t\t\t<i class="fa fa-fw watermark fa-eraser clear-binding"></i>\r\n            <i class="fa fa-fw watermark fa-database binding-icon"></i>\r\n\t\t\t<input class="value-display" type="text" value="'+l(typeof(e=null!=(e=i.value||(null!=t?t.value:t))?e:s)==r?e.call(o,{name:"value",hash:{},data:a}):e)+'" tabindex="-1" readonly />\r\n\t\t</div>\r\n\r\n\t</div>\r\n\r\n</div>'},useData:!0}),A.VirtualQuerySample=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o,s=null!=t?t:e.nullContext||{},r=i.helperMissing,l="function";return"function (source, callback) {\r\n\r\n    // source is an object representing a data source, with the following properties:\r\n    // columns: an array of column names, for example,\r\n    // "+(null!=(e=typeof(o=null!=(o=i.columns||(null!=t?t.columns:t))?o:r)==l?o.call(s,{name:"columns",hash:{},data:a}):o)?e:"")+"\r\n\r\n    // meta: an object mapping column names to their kdb types\r\n    // "+(null!=(e=typeof(o=null!=(o=i.meta||(null!=t?t.meta:t))?o:r)==l?o.call(s,{name:"meta",hash:{},data:a}):o)?e:"")+"\r\n\r\n    // rows: an array of row objects, each one maps columns to values\r\n    // "+(null!=(e=typeof(o=null!=(o=i.rows||(null!=t?t.rows:t))?o:r)==l?o.call(s,{name:"rows",hash:{},data:a}):o)?e:"")+"\r\n\r\n    // you can perform operations on the source, generate values or fetch remote data using javascript\r\n    // when your are done pass an object in the same format as source to the callback function to return your data\r\n    \r\n    callback(source);\r\n\r\n}"},useData:!0}),A.app=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){return'<div class="toolbar editor-ui" />\r\n<div class="breadcrumbs-div" />\r\n<div class="components-panel unpinned" />\r\n<div class="properties-panel doc" contenteditable="false" />\r\n<div class="content-panel Dark components-unpinned" tabindex="0" />\r\n<div class="dialog-panel">\r\n    <div class="document" />\r\n    <div class="environment" />\r\n</div>\r\n<div class="notifications-div">\r\n\r\n</div>'},useData:!0}),A.dashboardDDL=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,e=e.escapeExpression;return'<div class="dashboardDLLForm">\r\n     <fieldset>\r\n         <legend>'+e((i.t||t&&t.t||s).call(o," Select a Dashboard",{name:"t",hash:{},data:a}))+'</legend>\r\n         <span class="fa fa-search"></span>\r\n         <select class="tags"/>\r\n    </fieldset>\r\n    <fieldset class="screenFieldSet">\r\n        <legend>'+e((i.t||t&&t.t||s).call(o," Select a Screen",{name:"t",hash:{},data:a}))+'</legend>\r\n         <select class="tags-screens"/>\r\n    </fieldset>\r\n    </div>'},useData:!0}),A.paramatersDialog=Handlebars.template({1:function(e,t,i,n,a){var o=null!=t?t:e.nullContext||{},s=i.helperMissing,r="function",l=e.escapeExpression,c='<div class="paramItem ',d=null!=(d=i.required||(null!=t?t.required:t))?d:s,p={name:"required",hash:{},fn:e.program(2,a,0),inverse:e.noop,data:a},e=typeof d==r?d.call(o,p):d;return null!=(e=!i.required?i.blockHelperMissing.call(t,e,p):e)&&(c+=e),c+'">\r\n    <span class="paramName" data-id="'+l(typeof(d=null!=(d=i.id||(null!=t?t.id:t))?d:s)==r?d.call(o,{name:"id",hash:{},data:a}):d)+'" style="display: inline-block;width: 150px;font-weight:bold; margin-right: 5px">'+l(typeof(d=null!=(d=i.id||(null!=t?t.id:t))?d:s)==r?d.call(o,{name:"id",hash:{},data:a}):d)+'</span>\r\n    <input type="text" class="value" style="display: inline-block;margin-bottom: 10px; width: 200px;"/>\r\n    <span>'+l(typeof(d=null!=(d=i.type||(null!=t?t.type:t))?d:s)==r?d.call(o,{name:"type",hash:{},data:a}):d)+'</span>\r\n    <div class="paramDesc" data-id="'+l(typeof(d=null!=(d=i.description||(null!=t?t.description:t))?d:s)==r?d.call(o,{name:"description",hash:{},data:a}):d)+'" style="display: none;">'+l(typeof(d=null!=(d=i.description||(null!=t?t.description:t))?d:s)==r?d.call(o,{name:"description",hash:{},data:a}):d)+"</div>\r\n</div>\r\n"},2:function(e,t,i,n,a){return"required"},compiler:[7,">= 4.0.0"],main:function(e,t,i,n,a){var o=null!=(o=i.ParamList||(null!=t?t.ParamList:t))?o:i.helperMissing,a={name:"ParamList",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a},o="function"==typeof o?o.call(null!=t?t:e.nullContext||{},a):o;return null!=(o=!i.ParamList?i.blockHelperMissing.call(t,o,a):o)?o:""},useData:!0}),A);function A(){}var DropzoneView=Backbone.View.extend({initialize:function(e){var t=this;this.documentImporter=e.documentImporter,this.router=e.router,this.$text=$("<p></p>").text("Drop dashboards to import  "),this.$icon=$("<i></i>").addClass("fa fa-upload"),this.$icon.appendTo(this.$text),this.$text.appendTo(this.$el),this.$el.on("dragover",function(e){e.preventDefault(),e.stopPropagation()}),this.$el.on("dragleave",function(e){$(e.fromElement).is("p")||$(e.toElement).is("p")||(t.$el.parent().removeClass("dragging"),e.preventDefault(),e.stopPropagation())}),this.$el.on("drop",function(e){e.stopPropagation(),e.preventDefault();e=_.filter(e.originalEvent.dataTransfer.files,function(e){return _.includes(["application/json","text/xml"],e.type)||""===e.type&&_.endsWith(e.name,".json")});t.documentImporter.importFiles(e,function(e){t.router.navigate(e,{trigger:!0})},function(e){QuickBase.ErrorDialog.ShowError(e,_.noop)}),t.$el.parent().removeClass("dragging")})}}),DRAFT_STATE={iconDraft:{true:" fa-circle-o",false:" fa-check-circle"},textDraft:{true:"Unmark as Draft",false:"Mark as Draft"}},DashboardListView=Backbone.View.extend({$dashName:null,$delete:null,$input:null,$nameErrorInfo:null,$open:null,$preview:null,$starred:null,$starredNot:null,$draftIconButton:null,appModel:null,className:"dashboard-list-view",debouncedUpdateNameAndTags:null,viewModel:null,compareTags:function(e,t){if(!t)return!1;if(e.length!=t.length)return!1;for(var i=0,n=e.length;i<n;i++)if(e[i]instanceof Array&&t[i]instanceof Array){if(!compareTags(e[i],t[i]))return!1}else if(e[i]!=t[i])return!1;return!0},hideInput:function(){var e;this.$input&&(e=this.$input,this.$input=null,e.blur(),e.off(),e.remove())},initialize:function(e){Handlebars.registerHelper("documentLocalDate",function(){var e=this.lastUpdateDate?moment(this.lastUpdateDate):moment();return e.format("DD/MM/YYYY HH:mm:ss")}),this.appModel=e.appModel,this.viewModel=e.viewModel,this.eventBus=e.eventBus,this.debouncedUpdateNameAndTags=_.debounce($.proxy(this.updateNameAndTags,this),500),this.render(),this.initializeEvents(),this.$el.attr("data-id",this.model.id),this.$el.attr("tabindex","0")},initializeEvents:function(){var i=this;this.$open.on("click",$.proxy(this.onOpen,this)),this.$preview.on("click",$.proxy(this.onPreview,this)),this.$delete.on("click",$.proxy(this.onDelete,this)),this.$dashName.on("click",$.proxy(this.onName,this)),this.$draftIconButton.on("click",$.proxy(this.updateDraftStatus,this)),this.listenTo(this.model,"change:name",this.onNameChanged),this.listenTo(this.model,"change:tags",this.onTagsChanged),this.$starred.on("click",function(e){e.stopPropagation(),e.preventDefault(),e=i.model.get("tags"),e=_.without(e,"starred"),i.model.set("tags",e),i.onTagsChanged(),i.debouncedUpdateNameAndTags()}),this.$starredNot.on("click",function(e){e.stopPropagation(),e.preventDefault(),e=i.model.get("tags").concat(["starred"]),i.model.set("tags",e),i.onTagsChanged(),i.debouncedUpdateNameAndTags()}),this.$isDefault.on("click",function(e){var t=i.model.get("tags");e.stopPropagation(),e.preventDefault(),_.includes(i.model.get("tags"),"defaultdash")||(t=i.model.get("tags").concat(["defaultdash"])),i.removeAllDefaultDashTags(),i.model.set({tags:t}),i.debouncedUpdateNameAndTags()}),this.$el.on("dblclick",$.proxy(this.onOpen,this)),this.$el.on("keydown",$.proxy(this.onKeyDown,this)),this.eventBus.on("dialog-resized",this.hideInput.bind(this))},isDraft:function(){return 0===this.model.get("name").indexOf("Draft")},onDelete:function(e){var n=this,t=this.$el.attr("data-id"),t=this.appModel.get("documents").get(t);"FSBL"in window&&t.id===window.finApi.documentId&&(window.finApi.dashRemoving=!0),t.destroy({success:function(e,t,i){console.log("document deleted without any issues",e,t,i);i=n.appModel.get("router").viewModel.get("selectedDocumentId");"FSBL"in window?_.debounce(function(){window.finApi.closeWindow(e.id)},10)():n.appModel.get("router").navigate(i,{trigger:!0})},error:function(e,t,i){console.log("document destroy error!",e,t,i)}})},onExport:function(e){var t=this.$el.attr("data-id"),i=this.appModel.get("documents").get(t),n=e?i.id:i.get("name"),a=this.appModel.get("isLite")?"json":"xml";t===this.viewModel.get("selectedDocumentId")?DashboardListView.exportModel(i,n,a):i.fetch({success:function(e){DashboardListView.exportModel(e,n,a)}.bind(this)})},onKeyDown:function(e){var t;"INPUT"===e.target.nodeName?13===e.keyCode?(e.preventDefault(),e.stopPropagation(),t=this.$input.val(),this.appModel.get("documents").findWhere({name:t})?this.showError.call(this,"Dashboard with this name already exists."):(this.model.set("name",t),this.hideInput(),this.debouncedUpdateNameAndTags())):27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.hideInput()):32===e.keyCode||13===e.keyCode?(e.stopPropagation(),e.preventDefault(),this.trigger("keyboard-selection",this.$el),13===e.keyCode&&this.onOpen()):46===e.keyCode&&this.onDelete()},onName:function(e){e.preventDefault(),e.stopPropagation(),this.showInput()},onNameChanged:function(){this.$dashName.text(this.model.get("name")),this.updateDraftIconState.call(this)},onOpen:function(e){var t;this.trigger("closeDialog"),t=this.$el.attr("data-id"),Backbone.history.fragment===t?Backbone.history.loadUrl(t):this.appModel.get("router").navigate(t,{trigger:!0})},onPreview:function(e){this.$el.attr("data-id");var t=(this.appModel.get("websiteUrl")||"").replace("edit","#")+this.model.id;window.open(t,"_blank")},onTagsChanged:function(){_.includes(this.model.get("tags"),"starred")?(this.$starredNot.hide(),this.$starred.show()):(this.$starred.hide(),this.$starredNot.show()),_.includes(this.model.get("tags"),"defaultdash")?(this.$isDefault.addClass("active"),0<this.$el.siblings().length&&this.$el.siblings().find(".fa-home").removeClass("active")):this.$isDefault.removeClass("active")},render:function(){var e=this.model.get("name"),t=this.isDraft(),i=DRAFT_STATE.iconDraft[t],t=DRAFT_STATE.textDraft[t],t=_.extend({name:e,draftStateIcon:i,title:t},this.model.pick("lastUpdateDate"));this.$el.html(T.DashboardListView(t)),this.$open=this.$el.find(".open-dash"),this.$preview=this.$el.find(".preview-dash"),this.$delete=this.$el.find(".delete-dash"),this.$dashName=this.$el.find(".dash-name"),this.$isDefault=this.$el.find(".fa-home"),this.$starred=this.$el.find(".fa-star"),this.$starredNot=this.$el.find(".fa-star-o"),this.$nameErrorInfo=this.$el.find(".name-error-info"),this.$nameErrorInfo.hide(),this.$draftIconButton=this.$el.find(".dash-wip-icon"),this.onTagsChanged()},updateDraftIconState:function(){var e=this.isDraft();this.$draftIconButton.attr("class","dash-wip-icon fa"+DRAFT_STATE.iconDraft[e]),this.$draftIconButton.attr("title",DRAFT_STATE.textDraft[e])},remove:function(){this.$open.off(),this.$preview.off(),this.$delete.off(),this.$draftIconButton.off(),this.hideInput(),this.$el.off(),this.$el.remove()},removeAllDefaultDashTags:function(){var i=this,e=[];0<(e=this.appModel.get("documents").filter(function(e){return _.includes(e.get("tags"),"defaultdash")})).length&&_.each(e,function(e){var t;e!==i.model&&(t=_.without(e.get("tags"),"defaultdash"),e.fetch({success:function(e){e.set({tags:t},{silent:!0}),e.saveNow()}}))})},updateDraftStatus:function(){var e=this.model.get("name");e&&(e=this.isDraft()?e.substring(6).trim():"Draft: "+e,this.appModel.get("documents").findWhere({name:e})?this.showError.call(this,"Dashboard with this name already exists."):(this.model.set("name",e),this.debouncedUpdateNameAndTags()))},showError:function(e){this.$nameErrorInfo.text(t(e)),this.$nameErrorInfo.fadeIn(function(){$(this).delay(3e3).fadeOut("slow")})},showInput:function(){var t=this,e=this.$dashName.position(),i=this.$el.width()-this.$el.find(".right-side-span").width()-50,n=this.$dashName.height()+4;this.$input=$(document.createElement("input")),this.$input.addClass("name-input"),this.$input.css({left:e.left,top:e.top-4,width:i,height:n}),this.$input.val(this.model.get("name")),this.$input.appendTo(this.$el.find(".tile-content")),this.$input.focus(),this.$input.select(),this.$input.on("keydown",$.proxy(this.onKeyDown,this)),this.$input.on("focusout",function(e){t.hideInput()})},updateNameAndTags:function(){var n=this.model.get("name"),a=$.extend(!0,[],this.model.get("tags")),o=this;this.model.fetch({success:function(t){var e=!1,i=t.get("name");t.get("name")!==n&&(t.set("name",n),e=!0),o.compareTags(t.get("tags"),a)||(t.set("tags",a),e=!0),e&&t.saveNow(function(e){t.set("name",i),o.showError.call(o,e)},function(){var e;"FSBL"in window&&(window.finApi.dashRenamed=i,e=_.map(t.collection.models,function(e){return _.pick(e.toJSON(),["name","id"])}),window.finApi.applyUserConfig(window.finApi.generateConfig(e,!0)))})},error:function(e,t){QuickBase.Log.Error("Error fetching dashboards model",t)}})}},{exportModel:function(e,t,i){function n(e){return e.replace(/&/g,"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;")}var a,o,s=e.toJSONClone(),r=document.createElement("a"),l=(s="xml"===i?(o="data:application/xml;charset=utf-8","<ui>\r\n\t<name>"+e.id+"</name>\r\n\t<displayName>"+n(e.get("name"))+"</displayName>\r\n\t<description>"+n(JSON.stringify(_.pick(s,"creationDate","lastUpdateDate","tags"),null,2))+"</description>\r\n\t<data>"+n(JSON.stringify(s,null,2))+"</data>\r\n</ui>"):(o="data:application/json;charset=utf-8",JSON.stringify(s,null,2)),t+"."+i);window.Blob?(a=new Blob([s],{type:o}),window.navigator.msSaveOrOpenBlob?r.onclick=function(){window.navigator.msSaveOrOpenBlob(a,l)}:void 0!==r.download&&r.setAttribute("href",URL.createObjectURL(a))):r.setAttribute("href",encodeURI(o+","+s)),void 0!==r.download&&r.setAttribute("download",l),document.body.appendChild(r),r.click(),document.body.removeChild(r)}}),MessageDialog=Backbone.View.extend({className:"confirm-dialog",initialize:function(e){var i=this;i.options=e,i.$el.html(T.MessageDialog(e)),i.$dialog=i.$el.dialog(_.extend({appendTo:e.container,title:t("Confirm"),resizable:!0,height:190,width:360,minWidth:300,modal:!0,autoOpen:!0,buttons:[{text:t("OK"),click:$.proxy(i.onOKButtonClick,i),icons:{primary:"fa fa-check"}},{text:t("Cancel"),click:i.close.bind(i),icons:{primary:"fa fa-times"}}],close:function(){i.remove()},open:function(){$('<i class="fa fa-question-circle" />').insertBefore(i.$el.parent().find(".ui-dialog-title"))}},e)),LocalTools.moveDialogOnTop(i.$dialog.parent())},close:function(){this.$el.dialog("close")},onOKButtonClick:function(){this.$dialog.dialog("close")}}),ManageDashWindow=Backbone.View.extend({$closeButton:null,$dashboardsList:null,$dialog:null,$searchInput:null,$sortNameUp:null,$sortNameDown:null,$sortDateUp:null,$sortDateDown:null,searchClear:null,appModel:null,className:"quick-dash window manage-window",filterName:null,filterTags:null,selected:null,sortOrder:null,sortDirection:null,viewModel:null,views:null,initialize:function(e){this.views=[],this.options=e,this.appModel=e.appModel,this.container=e.container,this.viewModel=e.viewModel,this.filterTags=["all"],this.sortOrder="byLatest",this.sortDirection="descending",this.eventBus=_.extend({},Backbone.Events),this.render(),this.initializeEvents(),this.onSelected(null),this.filterNow()},initializeEvents:function(){var t=this;this.$el.on("click",$.proxy(this.onClose,this)),this.listenTo(this.appModel.get("documents"),"sort remove add",this.updateList.bind(this)),this.$searchInput.on("input",t.onSearchInput.bind(t)),this.$searchClear.on("click",t.onClearSearch.bind(t)),this.$searchInput.on("keydown",function(e){27===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.$searchInput.val(""),this.filterName=null,this.updateList())}.bind(this)),this.$el.find(".open").click(function(){t.selected.onOpen()}),this.$el.find(".view").click(function(){t.selected.onPreview()}),this.$el.find(".delete").click(function(){t.selected.onDelete()}),this.$el.find(".export").click(function(e){t.selected.onExport(e.altKey)}),this.$el.find(".import").click(function(e){t.$el.find("#dashImportFile").click()}),this.$el.find("#dashImportFile").change(t.onImportFileChange.bind(t))},addDocuments:function(){var t,i=this,e=this.filterNow();this.views.length&&(_.each(this.views,function(e){e.remove()}),this.views=[]),_.each(e,function(e){(t=new DashboardListView({model:e,appModel:i.appModel,viewModel:i.viewModel,eventBus:i.eventBus})).$el.appendTo(i.$dashboardsList),i.views.push(t),i.listenTo(t,"keyboard-selection",function(e){i.onBeforeSelected(e)}),i.listenTo(t,"closeDialog",i.remove),i.listenTo(t.model,"change:name",function(){i.selected&&i.selected.$el&&i.onBeforeSelected(i.selected.$el)})})},clearFileInput:function(e){try{e.value=null}catch(e){}e.value&&e.parentNode.replaceChild(e.cloneNode(!0),e)},filterNow:function(){var t,e=this.appModel.get("documents").models;return _.includes(this.filterTags,"recent")&&((e=_.sortBy(e,function(e){var t=e.get("lastUpdateDate");return t=t||e.get("creationDate"),new Date(t)})).reverse(),e=_.take(e,10)),_.includes(this.filterTags,"starred")&&(e=_.filter(e,function(e){return _.includes(e.get("tags"),"starred")})),this.filterName&&0<this.filterName.length&&(t=this.filterName.toLowerCase(),e=_.filter(e,function(e){return-1<e.get("name").toLowerCase().indexOf(t)})),"byLatest"===this.sortOrder?e=_.sortBy(e,function(e){var t=e.get("lastUpdateDate");return t=t||e.get("creationDate"),new Date(t)}):"byName"===this.sortOrder&&(e=_.sortBy(e,function(e){return e.get("name").toLowerCase()})),"descending"===this.sortDirection&&e.reverse(),e},onBeforeSelected:function(e){var t;e.addClass("ui-selected").siblings().removeClass("ui-selected"),e.focus(),(t=e.attr("data-id"))&&(e=_.find(this.views,function(e){return e.model.id===t}),this.onSelected(e))},onClearSearch:function(){this.$searchInput.val(""),this.onSearchInput()},onImportFileChange:function(e){var t=this;this.appModel.documentImporter.importFiles(_.filter(e.target.files,function(e){return _.includes(["application/json","text/xml"],e.type)||""===e.type&&_.endsWith(e.name,".json")}),function(){t.clearFileInput(t.$el.find("#dashImportFile")[0])},function(e){t.clearFileInput(t.$el.find("#dashImportFile")[0]),QuickBase.ErrorDialog.ShowError(e,_.noop)})},onSearchInput:function(){this.filterName=this.$searchInput.val(),this.updateList(),this.toggleHideSearch()},onSelected:function(e){this.selected=e,this.$el.find(".open").button("option","disabled",!e),this.$el.find(".view").button("option","disabled",!e||e.isDraft()),this.$el.find(".delete").button("option","disabled",!e),this.$el.find(".export").button("option","disabled",!e)},remove:function(){this.stopListening(),this.$searchClear.off(),this.$searchInput.off(),this.$el.off(),this.removeListElements(),this.trigger("close"),this.$dashboardsList&&this.$dashboardsList.data("uiSelectable")&&this.$dashboardsList.selectable("destroy"),this.$dialog&&this.$dialog.data("uiDialog")&&this.$dialog.dialog("destroy"),Backbone.View.prototype.remove.apply(this,arguments)},removeListElements:function(){this.onSelected(null),_.each(this.views,function(e){e.remove()})},render:function(){var i=this,e=Tools.calcDialogHeight(400,"dataDialog"),n=e<400?"top":"center";this.$el.html(T.ManageDashWindow({radio1:_.uniqueId("radio_"),radio2:_.uniqueId("radio_"),radio3:_.uniqueId("radio_")})),this.$contentContainer=this.$el.find(".content-container"),this.$dashboardsList=this.$el.find(".dashboards-list"),this.$searchInput=this.$el.find(".search-input"),this.$sortNameUp=this.$el.find(".name-sort .fa-caret-up"),this.$sortNameUp.hide(),this.$sortNameDown=this.$el.find(".name-sort .fa-caret-down"),this.$sortNameDown.hide(),this.$sortDateUp=this.$el.find(".last-modified-sort .fa-caret-up"),this.$sortDateUp.hide(),this.$sortDateDown=this.$el.find(".last-modified-sort .fa-caret-down"),this.$searchClear=this.$el.find(".clearSearch"),this.$el.find(".open").button({icons:{primary:"fa fa-play"}}).hide(),this.$el.find(".view").button({icons:{primary:"fa fa-globe"}}),this.$el.find(".delete").button({icons:{primary:"fa fa-trash"}}),this.$el.find(".import").button({icons:{primary:"fa fa-upload"},text:!1}),this.$el.find(".export").button({icons:{primary:"fa fa-download"},text:!1}),this.$dashboardsList.selectable({autoRefresh:!0,filter:">*",cancel:".dash-name,i,.ui-selected,.title-content",selected:function(e,t){i.onBeforeSelected($(t.selected))},unselected:function(){i.onSelected(null)}}),this.$dialog=this.$el.dialog(_.extend({appendTo:this.container,dialogClass:"quick-dash manage-dashboards",title:t("Dashboards"),resizable:!0,height:e,width:750,position:{my:"center",at:n,of:"#appdiv",collision:"fit"},modal:!0,autoOpen:!0,draggable:!0,buttons:[{text:t("Open"),click:function(){i.selected&&i.selected.onOpen()},icons:{primary:"fa fa-play"}},{text:t("Cancel"),click:function(){$(this).dialog("close")},icons:{primary:"fa fa-times"}}],open:function(){$('<i class="fa fa-list-alt" />').insertBefore(i.$el.parent().find(".ui-dialog-title")),i.updateList()},close:function(){i.remove(),Backbone.history.loadUrl()},resize:function(){i.eventBus.trigger("dialog-resized")}},i.options)),"FSBL"in window&&i.$el.parent().css("margin-top",window.finApi.DIALOGS_TOP_MARGIN),this.$el.find(".name-sort").on("click",$.proxy(this.nameSortClicked,this)),this.$el.find(".last-modified-sort").on("click",$.proxy(this.lastModifiedSortClicked,this))},nameSortClicked:function(){"byLatest"===this.sortOrder?(this.sortOrder="byName",this.$sortDateDown.hide(),this.$sortDateUp.hide(),("descending"===this.sortDirection?this.$sortNameDown:this.$sortNameUp).show()):"descending"===this.sortDirection?(this.sortDirection="ascending",this.$sortNameDown.hide(),this.$sortNameUp.show()):(this.sortDirection="descending",this.$sortNameUp.hide(),this.$sortNameDown.show()),this.updateList()},lastModifiedSortClicked:function(){"byName"===this.sortOrder?(this.sortOrder="byLatest",this.$sortNameDown.hide(),this.$sortNameUp.hide(),("descending"===this.sortDirection?this.$sortDateDown:this.$sortDateUp).show()):"descending"===this.sortDirection?(this.sortDirection="ascending",this.$sortDateDown.hide(),this.$sortDateUp.show()):(this.sortDirection="descending",this.$sortDateUp.hide(),this.$sortDateDown.show()),this.updateList()},toggleHideSearch:function(){this.$searchInput&&this.$searchInput.val()?this.$searchClear.show():this.$searchClear.hide()},updateList:function(){this.removeListElements(),this.addDocuments(),this.appModel.get("documents").length<=1?this.$el.find(".manage-documents-toolbar .delete").addClass("disabled"):this.$el.find(".manage-documents-toolbar .delete").removeClass("disabled")}}),LoadingScreen=Backbone.View.extend({className:"quick-dash loadingScreen",loadText:null,initialize:function(e){this.loadText=e.loadingText,this.render()},render:function(){return this.$el.html(T.LoadingScreen({text:this.loadText})),this.$el.hide(),this.$el.fadeIn(),this}}),DashboardNamePrompt=Backbone.View.extend({$closeButton:null,$dialog:null,$nameInput:null,$wip:null,$tooltip:null,$dashExistsInfo:null,appModel:null,create:!1,className:"quick-dash window dashboard-name-prompt",initialize:function(e){var i=this,n=[];this.appModel=e.appModel,this.container=e.container,this.$el.html(T.DashboardNamePrompt(this.model.toJSON())),this.$nameInput=this.$el.find(".name-input"),this.$wip=this.$el.find(".work-in-progress"),this.$tooltip=this.$el.find(".wip-tooltip"),this.$dashExistsInfo=this.$(".dash-exist-info"),this.$dashExistsInfo.hide();function a(e,t,i){return{text:e,click:t,icons:{primary:"fa fa-"+i}}}e.saveAs?n.push(a(t("Save As..."),function(){i.onOk()},"file-o")):(n.push(a(t("New"),function(){i.onOk()},"file-o")),n.push(a(t("Duplicate"),function(){i.onDuplicate()},"files-o"))),n.push(a(t("Cancel"),function(){$(this).dialog("close")},"times")),this.$dialog=this.$el.dialog(_.extend({appendTo:this.container,dialogClass:"quick-dash newdashboard-dialog",title:e.saveAs?t("Save As..."):t("New Dashboard"),resizable:!1,height:150,width:311,modal:!0,autoOpen:!0,draggable:!1,buttons:n,closeOnEscape:!this.forced,open:function(){i.forced&&$(this).parent().find(".ui-dialog-titlebar-close").hide(),$('<i class="fa fa-file-o" />').insertBefore(i.$el.parent().find(".ui-dialog-title")),i.$nameInput.select(),i.$nameInput.focus(),$.cookie("dashboard-work-in-progress")||$.cookie("dashboard-work-in-progress",!1,{expires:90,path:"/"}),String(i.$wip.prop("checked"))!=$.cookie("dashboard-work-in-progress")&&i.updateWIPState(),i.$nameInput.on("keyup",function(e){0===i.$nameInput.val().indexOf("Draft:")?$.cookie("dashboard-work-in-progress",!0,{expires:90,path:"/"}):$.cookie("dashboard-work-in-progress",!1,{expires:90,path:"/"}),i.updateWIPState(),13==e.keyCode&&(e.preventDefault(),e.stopPropagation(),i.onOk.call(i))}),i.$wip.change(function(e){$.cookie("dashboard-work-in-progress",e.target.checked,{expires:90,path:"/"}),i.$tooltip.hide(),i.updateWIPState()}),i.$el.find(".wip-icon").hover(function(){var e="true"===$.cookie("dashboard-work-in-progress")?"Unmark as Draft":"Mark as Draft";i.$tooltip.html(e),i.$tooltip.show()},function(){i.$tooltip.hide()})},close:function(){i.remove()}},e))},onDuplicate:function(){this.duplicate=!0,this.onOk()},onOk:function(){var t=DOMPurify.sanitize(this.$nameInput.val().trim());0<(t=0===t.indexOf("Draft:")?t.substring(6).trim():t).length&&(this.appModel.get("documents").find(function(e){e=e.attributes.name.trim();return e===t||e==="Draft:"+t||e==="Draft: "+t})?this.$dashExistsInfo.fadeIn(function(){$(this).delay(3e3).fadeOut("slow")}):(this.create=!0,this.$dialog.dialog("close")))},remove:function(){this.stopListening(),this.$nameInput.off(),this.$wip.off(),this.$dialog&&this.$dialog.dialog("destroy"),Backbone.View.prototype.remove.apply(this),this.trigger("close",{create:this.create,duplicate:this.duplicate,name:this.$nameInput.val()})},updateWIPState:function(){"true"===$.cookie("dashboard-work-in-progress")?(this.$wip.prop("checked",!0),0!==this.$nameInput.val().indexOf("Draft:")&&this.$nameInput.val("Draft: "+this.$nameInput.val())):(this.$wip.prop("checked",!1),0===this.$nameInput.val().indexOf("Draft:")&&this.$nameInput.val(this.$nameInput.val().substring(6).trim()))}}),Log=QuickBase.Log,LoginHistoryDialog=Backbone.View.extend({$dialog:null,close:function(){this.$dialog.dialog("close")},dataGridStuff:(D7=["pk","time","machineID","status","url"],E7=[11,15,11,11,11],F7=["pk","Time","Machine Id","Status","Url"],G7=["pk"],{generateDatagridConfig:function(e){return this.Datagrid=e,(e=new QuickBase.DocumentDataModel({_subscriptionKey:"pk",_dataType:"copy",_maxRows:1e6})).apply(),e.onExecuteSuccess(this.getResponse(),!0),new Backbone.Model({data:e,columnsConfig:this.getColumnsConfiguration(),datagridConfig:this.datagridConfiguration(),sortColumns:this.sortColumns})},datagridConfiguration:function(){return{Selection:{Mode:"Multi Row"}}},columnsConfiguration:function(){var i;return MAP={1:"Boolean",14:"Date",15:"DateTime",19:"Time"},i=function(e){return MAP[e]||"General"},_.map(D7,function(e,t){return{Field:e,DisplayName:F7[t],Sortable:!0,Hidden:_.includes(G7,D7[t]),Format:i(E7[t])}})},getResponse:function(e){return{rows:e||[],columns:D7,meta:_.zipObject(D7,E7)}},getColumnsConfiguration:function(){var e=this.columnsConfiguration(),t=this;return e=_.map(e,function(e){return _.extend({},t.Datagrid.getColumnSettingsModel(),{DisplayName:e.Field,TextAlign:"left",IsReadonly:!0,MinWidthAbsolute:100},e)})},sortColumns:[{sortCol:"time",sortAsc:!1}]}),getLoginHistory:function(){var t=this;QuickBase.DeltaClientLib.getAPIQueryData("kdb",void 0,".session.getLogins",[{IsKdbParam:!0,i:0,index:0,name:"user",type:"symbol",value:QuickBase.DeltaClientLib.deltaClient.user()},{IsKdbParam:!0,i:1,index:1,name:"clientType",type:"symbol"}],function(e){t.dgSourceModel.onExecuteSuccess(t.dataGridStuff.getResponse(_.map(e.rows,function(e){return _.extend({pk:_.uniqueId()},_.pick(e,"machineID","status","time","url"))})),!0),t.hideLoadingScreen(),t.onResize()},function(e){console.log("getLoginHistory session get logins error",e)},100,!1)},hideLoadingScreen:function(){this.$loadingScreen&&(this.$loadingScreen.fadeOut(function(){$(this).remove()}),this.$loadingScreen=null)},initialize:function(e){var i=this;i.$el.html(T.LoginHistoryDialog()),i.showLoadingScreen(),i.initializeDataGrid(),this.$dialog=this.$el.dialog(_.extend({dialogClass:"quick-base login-history-dialog",title:t("Login History"),resizable:!0,height:302,width:552,modal:!0,autoOpen:!0,draggable:!0,buttons:[{text:t("OK"),click:$.proxy(i.close,i),icons:{primary:"fa fa-check"}}],open:function(){$('<i class="fa fa-history" />').insertBefore(i.$el.parent().find(".ui-dialog-title"))},close:function(){_.isFunction(e.onClose)&&e.onClose(),i.remove()},resize:$.proxy(this.onResize,this)},e))},initializeDataGrid:function(e){var i=this;require(["Datagrid"],function(e){var t=i.dataGridStuff.generateDatagridConfig(e);i.dgSourceModel=t.get("data"),i.dgSource=new e.Master({el:i.$(".grid-div"),model:t}),i.getLoginHistory()})},onResize:function(){this.dgSource&&this.dgSource.onResize()},remove:function(){this.dgSource.off(),this.dgSource.remove(),Backbone.View.prototype.remove.apply(this)},showLoadingScreen:function(e){e=new LoadingScreen({loadingText:e});e.$el.appendTo(this.$el),this.$loadingScreen=e.$el}}),D7,E7,F7,G7,CustomEvents=(d8.prototype.on=function(e,t,i){},d8.prototype.off=function(e,t,i){},d8.prototype.trigger=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i]},d8.prototype.bind=function(e,t,i){},d8.prototype.unbind=function(e,t,i){},d8.prototype.once=function(e,t,i){},d8.prototype.listenTo=function(e,t,i){},d8.prototype.listenToOnce=function(e,t,i){},d8.prototype.stopListening=function(e,t,i){},d8);function d8(){_.extend(this,Backbone.Events)}var ButtonMenu=(F8.prototype.initCombo=function(e){var t=this;this.$cmbCommands=$("<select class='button-menu'></select>"),this.$btn.before(this.$cmbCommands),this.$cmbCommands.select2({minimumResultsForSearch:1e3,theme:"button-menu"}),this.$cmbCommands.on("select2:select",function(){t.isBusy||e(t.$cmbCommands.val())}),this.$cmbCommands.on("select2:open",function(){$("body > .select2-container--button-menu").addClass("select2--environment")})},F8.prototype.showMenu=function(e){var i="<option></option>";_.each(e,function(e,t){i+='<option value="'+t+'">'+e+"</option>"}),this.$cmbCommands.val("").trigger("change"),this.$cmbCommands[0].innerHTML=i,this.$cmbCommands.trigger("change").select2("open")},F8.prototype.initClickAndPress=function(e,t,i){var n=this;e.mousedown(function(){n.longPressTimerId=setTimeout(function(){n.longPressTimerId=null,e.button("option","disabled")||n.showMenu(i())},F8.LONG_PRESS_DURATION)}).on("mouseup mouseout",function(){null===n.longPressTimerId?(n.clickEnabled=!1,_.defer(function(){n.clickEnabled=!0})):(clearTimeout(n.longPressTimerId),n.longPressTimerId=null)}).click(function(){n.clickEnabled&&t.call(n)})},F8.LONG_PRESS_DURATION=500,F8);function F8(e,t,i,n){this.isBusy=!1,this.clickEnabled=!0,this.longPressTimerId=null,this.$btn=e,this.initClickAndPress(e,t,n),this.initCombo(i)}var EditorCommand=function(e){this.title=e=void 0===e?null:e},UndoRedoManager=(W8=CustomEvents,__extends(X8,W8),X8.prototype.initializeEvents=function(){this.listenTo(this.viewModel,"change:commandIndex",this.updateButtonStates)},X8.prototype.onSelect=function(e){e=parseInt(e.replace(/^\D+/g,""),10);this.viewModel.goToCommandIndex(e)},X8.prototype.clear=function(){this.updateButtonStates()},X8.prototype.getButtonMethod=function(e){return e?"enable":"disable"},X8.prototype.getOptions=function(e){var t=this.viewModel.get("commands"),i=this.viewModel.get("commandIndex"),n={};if(e)for(var a=i;0<=a;a--)n["_"+a]=t[a].title;else for(a=i+1;a<t.length;a++)n["_"+a]=t[a].title;return n},X8.prototype.onClickRedo=function(){this.redoCommand(),this.updateButtonStates()},X8.prototype.onClickUndo=function(){this.undoCommand(),this.updateButtonStates()},X8.prototype.redoCommand=function(){this.isBusy||this.$btnRedo.button("option","disabled")||(this.isBusy=!0,this.viewModel.redo(),this.isBusy=!1)},X8.prototype.undoCommand=function(){this.isBusy||this.$btnUndo.button("option","disabled")||(this.isBusy=!0,this.viewModel.undo(),this.isBusy=!1)},X8.prototype.updateButtonStates=function(){var e=this.viewModel.get("commands"),t=this.viewModel.get("commandIndex"),i=!1,n=!1;null!==t&&e.length&&(0<=t&&(n=!0),t!==e.length-1&&(i=!0)),this.$btnRedo.button(this.getButtonMethod(i)).toggle(i),this.$btnUndo.button(this.getButtonMethod(n))},X8),W8;function X8(e){var t=W8.call(this)||this;t.isBusy=!1,t.viewModel=e.viewModel,t.$btnRedo=e.$btnRedo,t.$btnUndo=e.$btnUndo;e=function(e){return{icons:{primary:"fa "+e},text:!1,disabled:!0}};return t.$btnRedo.button(e("fa-repeat")).hide(),t.$btnUndo.button(e("fa-undo")),t.redoBtn=new ButtonMenu(t.$btnRedo,t.onClickRedo.bind(t),t.onSelect.bind(t),function(){return t.getOptions(!1)}),t.undoBtn=new ButtonMenu(t.$btnUndo,t.onClickUndo.bind(t),t.onSelect.bind(t),function(){return t.getOptions(!0)}),t.updateButtonStates(),t.initializeEvents(),t}var MainToolbar=Backbone.View.extend({$profileButton:null,$profileMenu:null,$loadingScreen:null,$newDash:null,$openDash:null,$saveDash:null,$saveDashAs:null,appModel:null,manageDashWindow:null,viewModel:null,documentSelector:null,undoRedoManager:null,initialize:function(e){var i=this;this.options=e,this.appModel=e.appModel,this.dialogContainer=e.dialogContainer,this.viewModel=e.viewModel,this.appModel.set("hideToolbar","FSBL"in window),this.$el.html(T.MainToolbar(this.appModel.toJSON())),this.documentSelector=new QuickBase.DocumentSelector({el:this.$el.find(".document-selector"),appModel:this.appModel,viewModel:e.viewModel,showManage:!0}),this.$newDash=this.$el.find(".new-dash"),this.$newDash.button({icons:{primary:"fa fa-file-o"},text:!1}).click($.proxy(this.onNewDash,this)),this.$saveDash=this.$el.find(".save-dash"),this.$saveDash.button({icons:{primary:"fa fa-floppy-o"},text:!1}),new ButtonMenu(this.$saveDash,this.onSaveDash.bind(this),function(e){"sa"==e?this.onSaveDashAs():"ex"==e&&this.onExportDash()}.bind(this),function(){return{sa:"Save As...",ex:"Export"}}),$("<span />").addClass("save-pending fa fa-asterisk").appendTo(this.$saveDash),$("<span />").addClass("save-in-progress fa fa-spinner fa-pulse").appendTo(this.$saveDash),this.$connectionStatus=this.$el.find(".connectionStatus"),this.appModel.set("undoRedoManager",this.undoRedoManager=new UndoRedoManager({$btnUndo:this.$(".undo-action"),$btnRedo:this.$(".redo-action"),appModel:this.appModel,viewModel:this.viewModel})),this.$el.find(".content-toggle > input").button().click(function(){i.viewModel.set("buildMode",!i.viewModel.get("buildMode"))}),this.$profileButton=this.$el.find(".profile > button"),this.$profileMenu=this.$el.find(".profile > .profile-menu"),this.$profileButton=this.$el.find(".profile > button").button({text:!0,icons:{secondary:"ui-icon-triangle-1-s"}}).click(function(){return i.$profileMenu.toggle(),i.$profileMenu.css("position","absolute"),i.$profileMenu.position({my:"right top",at:"right bottom",of:this}),$(document).on("click",function(){i.$profileMenu.hide()}),!1}),this.$toolbarToggle=this.$el.find(".toolbar-toggler"),this.$toolbarToggle.on("click",function(e){i.appModel.set("hideToolbar",!i.appModel.get("hideToolbar"))}),this.appModel.get("isLite")?this.initProfileMenu():$(QuickBase.DeltaClientLib).one("DeltaClientLogin",$.proxy(this.initProfileMenu,this)),this.listenTo(this.appModel,"change:userName",function(e,t){i.$el.find(".user-name").text(t)}),this.listenTo(this.viewModel,"change:selectedDocumentId",this.onSelectedDocumentIdChanged),this.listenTo(this.documentSelector,"manage",this.openDashManagerWindow);var t=function(){$(QuickBase.DeltaClientLib).one("DeltaClientDisconnect",function(){i.changeConnectionStatus(!1),$(QuickBase.DeltaClientLib).one("DeltaClientConnect",function(){i.changeConnectionStatus(!0),t()})})};t(),$(window).on("keydown",$.proxy(this.onKeyDown,this))},initProfileMenu:function(){this.profileMenu=new QuickBase.ProfileMenu({appModel:this.appModel,dialogContainer:this.dialogContainer,themes:this.options.themes,viewModel:this.viewModel}),this.$profileMenu.html(this.profileMenu.$el),this.listenTo(this.profileMenu,"themeChange",function(){this.trigger("themeChange")}.bind(this)),this.listenTo(this.profileMenu,"login-history",function(){this.onLoginHistory()}.bind(this)),this.$profileMenu.hide()},getNewDashModel:function(e){var t=!0,i="My New Dashboard",n=1,a=this.appModel.get("documents");for(e&&e.name&&(i=e.name);t;)a.some(function(e){e=e.get("name");return(e=0===e.indexOf("Draft:")?e.substring(6).trim():e)===i+" ("+n+")"})?n+=1:(t=!1,i+=" ("+n+")");return(e=$.extend(e||{},{name:i,creationDate:(new Date).toUTCString(),id:null,lastUpdateDate:null}))&&e.screens&&e.screens.each(function(e){e.set("id",QuickBase.Helpers.getGUID())}),new QuickBase.Document(e)},changeConnectionStatus:function(e){var t=this;e?(t.$connectionStatus.html('<span class="fa fa-info-circle"></span>Delta Client has reconnected'),t.$connectionStatus.css({color:"#03B103",display:"inline-block"}),_.delay(function(){t.$connectionStatus.hide()},7e3)):(t.$connectionStatus.html('<span class="fa fa-warning"></span>Delta Client connection has been lost, reconnecting...'),t.$connectionStatus.css({color:"#FF6262",display:"inline-block"}))},getSelectedDoc:function(){var e=this.viewModel.get("selectedDocumentId");return this.appModel.get("documents").get(e)},getViewstate:function(){var e=this.getSelectedDoc().get("viewState").getViewStateList(!0),t={};return _.each(e,function(e){t[e.path]=e.model.get("value")}),t},hideLoadingScreen:function(){this.$loadingScreen&&(this.$loadingScreen.fadeOut(function(){$(this).remove()}),this.$loadingScreen=null)},onDocumentChanged:function(e){this.$saveDash.addClass("changed")},onDocumentSaved:function(){this.$saveDash.removeClass("changed")},onExportDash:function(){var e=this.getSelectedDoc();DashboardListView.exportModel(e,e.get("name"),this.appModel.get("isLite")?"json":"xml")},onKeyDown:function(e){var t=!0;if(!$(".ui-dialog-content:visible").length){if((e.ctrlKey||e.metaKey)&&(QuickBase.DeltaClientLib.clientLoggedIn||this.appModel.get("isLite")))switch(e.keyCode){case 78:this.onNewDash();break;case 79:this.onOpenDash();break;case 83:this.onSaveDash();break;case 89:this.undoRedoManager.redoCommand();break;case 90:this.undoRedoManager.undoCommand();break;default:t=!1}else t=!1;t&&(e.preventDefault(),e.stopPropagation())}},onLoginHistory:function(){new LoginHistoryDialog({appModel:this.appModel})},onNewDash:function(e){var t=e&&e.force,e=this.getNewDashModel();this.saveNewDash(e,t)},onOpenDash:function(){this.openDashManagerWindow()},onResize:function(){this.documentSelector.onResize()},onSaveDash:function(){var e=this.getSelectedDoc(),i=this;e&&(Log.Info("save dash now!",e),i.$saveDash.addClass("saving"),e.saveNow(function(e){var t;i.$saveDash.removeClass("saving"),t=arguments[1]||"No error information returned from the server.",Log.Error("ERROR DIALOG: ",e,arguments),QuickBase.ErrorDialog.ShowError(t)},function(){i.$saveDash.removeClass("saving")}))},onSaveDashAs:function(){var e,t=this.getSelectedDoc();t&&(e=this.getNewDashModel(t.toJSON()),t.set("wasChanged",!1),this.saveNewDash(e,!0))},onSelectedDocumentIdChanged:function(){var e,t,i=this.viewModel.previous("selectedDocumentId"),n=this.viewModel.get("selectedDocumentId");i&&(t=this.appModel.get("documents").get(i))&&(this.stopListening(t,"postCommand",this.onDocumentChanged),this.stopListening(t,"documentSaved",this.onDocumentSaved),this.onDocumentSaved()),n&&(e=this.appModel.get("documents").get(n))&&(this.listenTo(e,"postCommand",this.onDocumentChanged),this.listenTo(e,"documentSaved",this.onDocumentSaved))},openDashManagerWindow:function(){var e=this;this.manageDashWindow||(this.manageDashWindow=new ManageDashWindow({appModel:this.appModel,container:this.dialogContainer,viewModel:this.viewModel}),this.manageDashWindow.on("close",function(){e.manageDashWindow&&(e.manageDashWindow.off(),e.manageDashWindow=null)}))},saveNewDash:function(i,e){var n=this;new DashboardNamePrompt({saveAs:e,appModel:n.appModel,container:n.dialogContainer,model:i}).once("close",function(e){var t;e.create?(e.duplicate&&(t=n.getSelectedDoc(),i=n.getNewDashModel(t.toJSON()),t.set("wasChanged",!1)),i.set("name",e.name),n.$saveDash.addClass("saving"),i.saveNow(function(e,t){Log.Error("error creating dashboard",e),n.$saveDash.removeClass("saving"),MainToolbar.ShowError_unableToCreateNewDashboard(t),n.hideLoadingScreen()},function(e){n.$saveDash.removeClass("saving"),e.set("wasChanged",!1),n.appModel.get("documents").add(e,{at:0}),"FSBL"in window?window.open("#"+e.id):location.hash="#"+e.id,n.hideLoadingScreen()})):n.hideLoadingScreen()})},showLoadingScreen:function(e){var t="FSBL"in window?"#appContainer":"body",e=new LoadingScreen({loadingText:e});e.$el.appendTo($(t)),this.$loadingScreen=e.$el},toggleTitle:function(e){e=e?t("Show Tools panel"):t("Hide Tools panel");this.$el.prop("title",e)},updateStatus:function(e){}},{ShowError_unableToCreateNewDashboard:function(e){QuickBase.ErrorDialog.ShowError("Error: Unable to create new Dashboard")}}),LocalTools=(q9.applyViewStateMethods=function(t,i){Object.getOwnPropertyNames(ViewStateMethods.prototype).forEach(function(e){i.prototype.hasOwnProperty(e)||Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(ViewStateMethods.prototype,e))})},q9.diff=function(a,o){var s={};if(!Object.is(a,o))return o&&"object"==typeof o?(Object.keys(a||{}).concat(Object.keys(o||{})).forEach(function(n){var e;o[n]===a[n]||Object.is(a[n],o[n])||(s[n]=o[n]),Array.isArray(o[n])&&Array.isArray(a[n])?a[n].forEach(function(e,t){var i=q9.diff(a[n][t],o[n][t]);void 0!==i&&(s[n][t]=i)}):"object"!=typeof o[n]||"object"!=typeof a[n]||void 0!==(e=q9.diff(a[n],o[n]))&&(s[n]=e)}),s):o},q9.moveDialogOnTop=function(e){var t=100;_.each($(".dialog-panel").find(".ui-dialog"),function(e){e=$(e).zIndex();t=t<e?e:t}),e.zIndex&&e.zIndex(t+1)},q9.getValue=function(e,t){for(var i=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),n=e;i.length;){var a=i.shift();if(!(a in n))return;n=n[a]}return n},q9.setValue=function(e,t,i){if(e&&t){for(var n=t.split("."),a=e;n.length-1;){var o=n.shift();_.isObject(a[o])||(a[o]={}),a=a[o]}a[n[0]]=i}},q9.typecast=function(e,t){return"boolean"===t?!!e:"number"===t?+e:"integer"===t?Math.floor(+e):""+e},q9);function q9(){}var BaseEditor=(Object.defineProperty(T9.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e,this.rendered&&this.setInputValue()},enumerable:!1,configurable:!0}),T9.prototype.postRender=function(){this.rendered=!0,this.setInputValue()},T9.prototype.preRender=function(){},T9.prototype.remove=function(){$(this.el).remove()},T9.prototype.render=function(){return this.el},T9.prototype.startRender=function(){return this.preRender(),this.render(),this.postRender(),this.el},T9.prototype.hideError=function(){QuickBase.ErrorTooltip.clear(this.errorTooltip)},T9.prototype.onInput=function(e){this.hideError();var t=this.validate(e);t?this.showError(t):this.onChange(this.processInput(e))},T9.prototype.onWatchedFieldChange=function(e,t){},T9.prototype.processInput=function(e){var t=this.schema&&this.schema.type,i=e;switch(t){case"number":case"integer":_.isNaN(Number(e))||(i=Number(e),"integer"===t&&(i=Math.round(i)))}return this.sanitize(i)},T9.prototype.sanitize=function(e){return e},T9.prototype.setInputValue=function(){this.input&&(this.input.value=this.value)},T9.prototype.showError=function(e){this.errorTooltip=QuickBase.ErrorTooltip.show(e,this.el,null)},T9.prototype.validate=function(e){return""},T9.collapsible=!1,T9.labelled=!0,T9);function T9(e,t,i,n){this.canPaste=!1,this.schemaOptions=e.options||{},this.api=i,this.onChange=t,this.options=n||{},this.schema=e,this.el=document.createElement("div")}var CheckBoxEditor=(hj=BaseEditor,__extends(ij,hj),Object.defineProperty(ij.prototype,"value",{get:function(){return this._value},set:function(e){this._value=_.isUndefined(e)?void 0:!!e,this.rendered&&this.setInputValue()},enumerable:!1,configurable:!0}),ij.prototype.render=function(){return this.input=document.createElement("input"),this.input.setAttribute("type","checkbox"),this.input.style.width="auto",this.el.append(this.input),this.el},ij.prototype.postRender=function(){hj.prototype.postRender.call(this),this.input.setAttribute("draggable","true"),this.input.addEventListener("dragstart",function(e){e.preventDefault(),e.stopPropagation()}),rxjs.fromEvent(this.input,"change").pipe(rxjs.operators.map(function(e){return e.target.checked})).subscribe(this.onInput.bind(this))},ij.prototype.setInputValue=function(){this.input&&(this.input.checked=this.value)},ij),hj;function ij(e,t,i,n){return hj.call(this,e,t,i,n)||this}var ClickableStringEditor=(qj=BaseEditor,__extends(rj,qj),rj.prototype.applyBaseState=function(){this.editorClear&&(this.editorClear.onclick=null),this.value?(this.el.classList.add("input-hasvalue"),this.editorClear&&(this.editorClear.onclick=this.onEditorClear.bind(this))):this.el.classList.remove("input-hasvalue")},rj.prototype.render=function(){var e;return qj.prototype.render.call(this),this.input=document.createElement("input"),this.input.setAttribute("readonly","true"),this.input.setAttribute("type","text"),this.el.classList.add("dashboards-control"),this.options.watermark&&(e=document.createElement("i"),this.input.classList.add("wa"),e.className="fa fa-fw watermark fa-"+this.options.watermark,this.el.append(e)),this.options.eraser&&(this.el.classList.add("clickable-control"),this.editorClear=document.createElement("i"),this.editorClear.className="fa fa-fw watermark fa-eraser input-clear",this.el.append(this.editorClear)),this.schema.data&&this.input.setAttribute("data",this.schema.data),this.el.append(this.input),this.el},rj.prototype.postRender=function(){qj.prototype.postRender.call(this),this.input.setAttribute("draggable","true"),this.input.addEventListener("dragstart",function(e){e.preventDefault(),e.stopPropagation()}),this.options.click&&this.input.addEventListener("click",this.options.click.bind(this)),this.options.onFocusOrBlur&&(this.input.addEventListener("focus",this.options.onFocusOrBlur.bind(this)),this.input.addEventListener("blur",this.options.onFocusOrBlur.bind(this)))},rj.prototype.onEditorClear=function(){this.applyBaseState(),this.onInput("")},rj.prototype.sanitize=function(e){return e="string"==typeof e?DOMPurify.sanitize(e,{ADD_ATTR:["target"]}):e},rj.prototype.setInputValue=function(){this.options.eraser&&this.applyBaseState(),this.input.value=this.value},rj),qj;function rj(e,t,i,n){return qj.call(this,e,t,i,n)||this}var ViewStateMethods=(zj.prototype.applyControlState=function(){this.rendered?(this.viewStateApply.onclick=null,this.viewStateClear.onclick=null,this.viewStateIcon.onclick=null,this.viewStateInput.onclick=null,this.viewStateInput.onkeyup=null,this.isViewState?(this.el.classList.add("is-viewstate"),this.el.parentElement&&this.el.parentElement.classList.add("is-viewstate-active"),this.viewStateClear.onclick=this.onViewStateClear.bind(this),this.viewStateIcon.onclick=this.onViewStateClick.bind(this),this.viewStateInput.onclick=this.onViewStateClick.bind(this),this.viewStateInput.onkeyup=this.onViewStateKeyPress.bind(this),this.viewStateInput.removeAttribute("tabindex")):(this.el.classList.remove("is-viewstate"),this.el.parentElement&&this.el.parentElement.classList.remove("is-viewstate-active"),this.viewStateApply.onclick=this.onViewStateApply.bind(this),this.viewStateInput.setAttribute("tabindex","-1")),this.statePending=!1):this.statePending=!0},zj.prototype.determineType=function(e){return e instanceof Backbone.Model?e.get("_viewType")?"viewstate":e.get("_dataType")?"datasource":void 0:"none"},zj.prototype.formatValue=function(e){return e},zj.prototype.getModel=function(){return this.model},zj.prototype.getValue=function(){return this.isViewState?this.model||this.formatValue(""):this.formatValue(this._value)},zj.prototype.remove=function(){this.rendered&&(this.viewStateApply.onclick=null,this.viewStateClear.onclick=null,this.viewStateIcon.onclick=null,this.viewStateInput.onclick=null)},zj.prototype.render=function(){return this.cache={text:"",viewState:""},this.viewStateApply=document.createElement("i"),this.viewStateApply.className="fa fa-fw watermark fa-eye viewstate-apply",this.viewStateClear=document.createElement("i"),this.viewStateClear.className="fa fa-fw watermark fa-eraser viewstate-active viewstate-clear",this.viewStateIcon=document.createElement("i"),this.viewStateIcon.className="fa fa-fw watermark fa-eye viewstate-active viewstate-icon",this.viewStateInput=document.createElement("input"),this.viewStateInput.className="wa viewstate-input",this.viewStateInput.setAttribute("type","text"),this.viewStateInput.setAttribute("tabindex","-1"),this.viewStateInput.readOnly=!0,this.el.append(this.viewStateApply),this.el.append(this.viewStateClear),this.el.append(this.viewStateIcon),this.el.append(this.viewStateInput),this.el.classList.add("dashboards-control"),this.el.classList.add("viewstate-control"),this.isViewState=this.isViewState||!1,this.applyControlState(),this.el},zj.prototype.setInputValue=function(){this.statePending&&this.applyControlState(),this.isViewState?this.viewStateInput.value=this._value?this._value.path:"":this.viewStateInput.value=this.cache.text||""},zj.prototype.setModel=function(e){var t=e?e.path:"";this.model=e,this._value=null,this.isViewState||(this.isViewState=!0,this.applyControlState()),this.rendered&&t!==this.input.value&&this.setInputValue()},zj.prototype.setValue=function(e){var t;this.ignoreModelChanges||("viewstate"===this.determineType(e)?(this.ignoreModelChanges=!0,this.setModel(e),t=e,this.ignoreModelChanges=!1,this._value=t,t=!1===this.isViewState,this.isViewState=!0):(this._value=e,t=!(this.model=null)===this.isViewState,this.isViewState=!1),this.rendered&&this.setInputValue()),t&&this.applyControlState()},zj.prototype.onViewStateApply=function(){this.cache.text=this._value,this.onViewStateClick()},zj.prototype.onViewStateClear=function(){this.isViewState=!1,this.model=null,this.viewStateInput.value="",this.onInput(this.cache.text),this.applyControlState()},zj.prototype.onViewStateKeyPress=function(e){32!==e.keyCode&&13!==e.keyCode||this.onViewStateClick()},zj.prototype.onViewStateClick=function(){var t=this;this.api.showViewStateDialog(this.model?this.model.path:"",function(e){t.isViewState=!0,t.onInput(e),t.applyControlState()})},zj);function zj(){}var ColSelectorEditor=(Kj=ClickableStringEditor,__extends(Lj,Kj),Object.defineProperty(Lj.prototype,"value",{get:function(){return this._value},set:function(e){ViewStateMethods.prototype.setValue.apply(this,arguments)},enumerable:!1,configurable:!0}),Lj.prototype.preRender=function(){var e=this;this.options.watermark="pencil",this.options.click=function(){e.api.showColSelectorDialog(e.watchedValues[e.columnProperty],e.value,e.el,e.isUserDefined,e.onInput.bind(e))}},Lj.prototype.render=function(){return Kj.prototype.render.call(this),ViewStateMethods.prototype.render.apply(this),this.el},Lj.prototype.onWatchedFieldChange=function(e,t){this.watchedValues[t]=e},Lj.prototype.setInputValue=function(){Kj.prototype.setInputValue.call(this),ViewStateMethods.prototype.setInputValue.apply(this)},Lj),Kj;function Lj(e,t,i,n){i=Kj.call(this,e,t,i,n)||this;return i.watchedValues={},LocalTools.applyViewStateMethods(i,Lj),i.columnProperty=e&&e.data?e.data:"possible_columns",i.isUserDefined=!n||!1!==n.isUserDefined,i}var CSSEditor=(Vj=ClickableStringEditor,__extends(Wj,Vj),Wj.prototype.preRender=function(){var e=this;this.schemaOptions.format="textarea",this.options.click=function(){e.api.showCssDialog(e.value,e.onInput.bind(e))}},Wj.prototype.sanitize=function(e){e=(e=e).replace(/>/g,",dash-ancestor");return DOMPurify.sanitize(e).replace(/,dash-ancestor/g,">")},Wj),Vj;function Wj(){return null!==Vj&&Vj.apply(this,arguments)||this}var DataSourceEditor=(_j=ClickableStringEditor,__extends(ak,_j),Object.defineProperty(ak.prototype,"value",{get:function(){if(void 0!==this._value)return this.model||""},set:function(e){!e&&this._value?(this._value="",this.model=""):(this._value,this._value=e,this.setModel(e)),this.rendered&&this.setInputValue()},enumerable:!1,configurable:!0}),ak.prototype.onClick=function(){this.api.showDataDialog(this.model instanceof QuickBase.DocumentDataModel?this.model.path:"",_.bind(function(e){this.onInput(e)},this))},ak.prototype.getModel=function(){return this.model},ak.prototype.preRender=function(){this.options.watermark="database",this.options.eraser=!0,this.options.onFocusOrBlur=this.onFocusOrBlur.bind(this),this.options.click=this.onClick.bind(this)},ak.prototype.setModel=function(e){this.model=e},ak.prototype.onFocusOrBlur=function(e){var t=this;this.input.onkeyup=null,"focus"===e.type&&(this.input.onkeyup=_.bind(function(e){32!==e.keyCode&&13!==e.keyCode||t.onClick()},this))},ak.prototype.onEditorClear=function(){this.applyBaseState(),this.onInput(null)},ak.prototype.setInputValue=function(){this.applyBaseState(),this.value instanceof QuickBase.DocumentDataModel?this.input.value=this.value.path||"":this.input.value=this.value||""},ak),_j;function ak(e,t,i,n){return _j.call(this,e,t,i,n)||this}var DataConnectionEditor=(mk=ClickableStringEditor,__extends(nk,mk),nk.prototype.preRender=function(){var t=this;this.options.watermark="server",this.options.eraser=!0,this.options.click=function(){t.api.showDataConnectionDialog(t.value,function(e){t.onInput(e)})}},nk),mk;function nk(){return null!==mk&&mk.apply(this,arguments)||this}var DefaultEditor=(qk=BaseEditor,__extends(rk,qk),rk),qk;function rk(){return null!==qk&&qk.apply(this,arguments)||this}var DropdownEditor=(sk=BaseEditor,__extends(tk,sk),tk.prototype.preRender=function(){sk.prototype.preRender.call(this),this.getOptions()},tk.prototype.render=function(){return this.input=document.createElement("select"),this.el.append(this.input),this.renderOptions(),this.el.classList.add("select2-wrapper"),this.select2=$(this.input).select2({minimumResultsForSearch:10,theme:"dashboards-properties"}),this.el},tk.prototype.postRender=function(){sk.prototype.postRender.call(this),rxjs.fromEvent(this.select2,"select2:select").pipe(rxjs.operators.map(function(e){return e.params.data.id})).subscribe(this.onInput.bind(this))},tk.prototype.onWatchedFieldChange=function(e,t){this.getOptions(e),this.rendered&&this.renderOptions(),this.defaultPending&&(this.defaultPending=!1,this.rendered&&-1!==this.enumValues.indexOf(this.getStringValue())?this.setInputValue():void 0!==this.enumValues[0]&&this.onChange(this.enumValues[0]))},tk.prototype.setInputValue=function(){this.input.value=this.value||"",this.select2.val(this.value).trigger("change")},tk.prototype.getOptions=function(e){var i,n=this,a=this.schema.options&&this.schema.options.enum_titles||[];this.enumDisplay=[],this.enumOptions=[],this.enumValues=[],e||this.schema.enum?(e=e||this.schema.enum,Array.isArray(e)||(e=[]),i=_.isObject(this.schema.enumSource),e.forEach(function(e,t){n.enumDisplay[t]=i&&_.isObject(e)?e[n.schema.enumSource.title]:""+(a[t]||e),n.enumOptions[t]=i&&_.isObject(e)?e[n.schema.enumSource.value]:""+e,n.enumValues[t]=LocalTools.typecast(i&&_.isObject(e)?e[n.schema.enumSource.value]:""+e,n.schema.type)})):this.schema.enumSource&&(this.enumSource=[],"string"==typeof this.schema.enumSource?this.enumSource=[{source:this.schema.enumSource}]:Array.isArray(this.schema.enumSource)&&this.schema.enumSource.forEach(function(e,t){n.enumSource[t]=e}))},tk.prototype.getStringValue=function(){return this.value?this.value.toString():""},tk.prototype.renderOptions=function(){var n=this;this.input.options.length=0,this.enumOptions.forEach(function(e,t){var i=document.createElement("option");i.value=e,i.text=n.enumDisplay[t],i.value.toString()===n.getStringValue()&&(i.selected=!0),n.input.appendChild(i)}),$(this.input).trigger("change")},tk),sk;function tk(e,t,i,n){n=sk.call(this,e,t,i,n)||this;return n.enumDisplay=[],n.enumOptions=[],n.enumValues=[],n.schema.enumSource&&(n.defaultPending=!0),n}var Gradient=(Ok=ClickableStringEditor,__extends(Pk,Ok),Object.defineProperty(Pk.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e,this.rendered&&this.setInputValue(),this.refreshValue()},enumerable:!1,configurable:!0}),Pk.prototype.preRender=function(){var t=this;this.options.watermark="tint",this.options.eraser=!1,this.options.click=function(e){t.api.showColorPickerDialog(e.target,t)}},Pk.prototype.render=function(){Ok.prototype.render.call(this);var e=!1,t=!1,i=this.value||this.schema.default||"#ffffff";return this.schema.options&&(e=this.schema.options.gradient||!1,t=this.schema.options.noColor||!1),this.input.setAttribute("gradient",String(e)),this.input.setAttribute("noColor",String(t)),this.input.setAttribute("class","gradient"),$(this.input).css("background",i),this.el},Pk.prototype.refreshValue=function(){""===this.value?($(this.input).css("background","#ffffff"),0===$(this.input).next(".fa-times").length&&$(this.input).after('<i class="fa fa-times" style="color:red;" />')):$(this.input).css("background",this.value).next(".fa-times").remove()},Pk),Ok;function Pk(e,t,i,n){return Ok.call(this,e,t,i,n)||this}var GradientViewState=($k=ClickableStringEditor,__extends(_k,$k),Object.defineProperty(_k.prototype,"value",{get:function(){return this._value},set:function(e){ViewStateMethods.prototype.setValue.apply(this,arguments)},enumerable:!1,configurable:!0}),_k.prototype.onClick=function(e){this.api.showColorPickerDialog(e,this)},_k.prototype.preRender=function(){var t=this;this.options.click=function(e){t.onClick(e.target)}},_k.prototype.render=function(){var t=this;$k.prototype.render.call(this),ViewStateMethods.prototype.render.apply(this);var e=!1,i=!1,n=this.schema.default||"#ffffff",a=document.createElement("i");return a.className="fa fa-fw watermark fa-tint",this.el.append(a),this.schema.options&&(e=this.schema.options.gradient||!1,i=this.schema.options.noColor||!1),this.input.setAttribute("gradient",String(e)),this.input.setAttribute("noColor",String(i)),this.input.setAttribute("class","gradient gradient-viewstate"),$(this.input).css("background",n),this.input.addEventListener("keyup",function(e){e.preventDefault(),e.stopPropagation(),32!==e.keyCode&&13!==e.keyCode||t.onClick(e.target)}),this.input.addEventListener("focusin",_.bind(function(e){t.el.classList.add("has-focus")},this)),this.input.addEventListener("blur",_.bind(function(e){t.el.classList.remove("has-focus")},this)),this.el},_k.prototype.refreshValue=function(){var e,t,i=this;this.input&&void 0!==this.value&&!this.isViewState&&(e=this.value&&this.value.get instanceof Function?this.value.get("value"):this.value,_.isString(e)&&0===e.indexOf("#")?(t=QuickBase.Tools.calculateFontContrast(e),$(this.input).css({background:e,color:t}).next(".fa-times").remove()):($(this.input).css("background","#ffffff"),0===$(this.input).next(".fa-times").length&&($(this.input).after('<i class="fa fa-times" style="color:red;" />'),$(this.input).next(".fa-times").on("click",function(){i.onClick(i.input)}))))},_k.prototype.setInputValue=function(){var e;ViewStateMethods.prototype.setInputValue.apply(this),this.input&&void 0!==this.input.value&&(e=this.value,this.value instanceof Backbone.Model&&(e=this.value.get("value")),this.input.value=e),this.refreshValue()},_k),$k;function _k(e,t,i,n){n=$k.call(this,e,t,i,n)||this;return LocalTools.applyViewStateMethods(n,_k),n}var HTMLEditor=(vl=ClickableStringEditor,__extends(wl,vl),Object.defineProperty(wl.prototype,"value",{get:function(){return this._value},set:function(e){ViewStateMethods.prototype.setValue.apply(this,arguments)},enumerable:!1,configurable:!0}),wl.prototype.preRender=function(){var t=this;this.schemaOptions.format="textarea",this.options.eraser=!1,this.options.click=function(){t.api.showHtmlDialog(function(e){t.onInput(e)})}},wl.prototype.render=function(){return vl.prototype.render.call(this),ViewStateMethods.prototype.render.apply(this),this.el},wl.prototype.sanitize=function(e){return e},wl.prototype.setInputValue=function(){vl.prototype.setInputValue.call(this),ViewStateMethods.prototype.setInputValue.apply(this)},wl),vl;function wl(e,t,i,n){n=vl.call(this,e,t,i,n)||this;return LocalTools.applyViewStateMethods(n,wl),n}var HandlebarEditor=(Gl=ClickableStringEditor,__extends(Hl,Gl),Hl.prototype.preRender=function(){var t=this,e=this.schema&&this.schema.options;this.schemaOptions.format="textarea",this.options.eraser=!1,this.options.click=function(){t.api.showTemplateDialog(t.schema,t.value,e,function(e){t.onInput(e)})}},Hl.prototype.sanitize=function(e){return e},Hl),Gl;function Hl(){return null!==Gl&&Gl.apply(this,arguments)||this}var IconEditor=(Ml=ClickableStringEditor,__extends(Nl,Ml),Object.defineProperty(Nl.prototype,"value",{get:function(){return this._value},set:function(e){ViewStateMethods.prototype.setValue.apply(this,arguments)},enumerable:!1,configurable:!0}),Nl.prototype.preRender=function(){var t=this;this.options.watermark="hand-pointer",this.options.click=function(){t.api.showIconDropDownDialog("fa"===t.schema.iconTypes,function(e){t.onInput(e)})}},Nl.prototype.render=function(){return Ml.prototype.render.call(this),ViewStateMethods.prototype.render.apply(this),this.el},Nl.prototype.setInputValue=function(){Ml.prototype.setInputValue.call(this),ViewStateMethods.prototype.setInputValue.apply(this)},Nl),Ml;function Nl(e,t,i,n){n=Ml.call(this,e,t,i,n)||this;return LocalTools.applyViewStateMethods(n,Nl),n}var JSONEditor=(Wl=ClickableStringEditor,__extends(Xl,Wl),Object.defineProperty(Xl.prototype,"value",{get:function(){return this._value},set:function(e){ViewStateMethods.prototype.setValue.apply(this,arguments)},enumerable:!1,configurable:!0}),Xl.prototype.preRender=function(){var t=this;this.schemaOptions.format="json",this.options.click=function(){t.api.showJsonDialog(t,t.value,function(e){t.onInput(e)})}},Xl.prototype.onClick=function(){var t=this;this.api.showJsonDialog(this,this.value,function(e){t.onInput(e)})},Xl.prototype.render=function(){return Wl.prototype.render.call(this),ViewStateMethods.prototype.render.apply(this),this.el},Xl.prototype.sanitize=function(e){return e},Xl.prototype.setInputValue=function(){Wl.prototype.setInputValue.call(this),ViewStateMethods.prototype.setInputValue.apply(this)},Xl),Wl;function Xl(e,t,i,n){n=Wl.call(this,e,t,i,n)||this;return LocalTools.applyViewStateMethods(n,Xl),n}var NavEditor=(hm=BaseEditor,__extends(im,hm),Object.defineProperty(im.prototype,"value",{get:function(){return this._value},set:function(e){ViewStateMethods.prototype.setValue.apply(this,arguments)},enumerable:!1,configurable:!0}),im.prototype.preRender=function(){var t=this;this.dashCollection=new Backbone.Collection,this.screenCollection=new Backbone.Collection,this.dashCollection.comparator="title",this.dashOptions={options:[],titles:[]},this.screenOptions={options:[],titles:[]},t.dashCollection.add(new Backbone.Model({title:"<none>",value:"<none>"})),t.dashCollection.add(new Backbone.Model({title:"<this>",value:"<this>"})),this.api.appModel.get("documents").each(function(e){t.dashCollection.add(new Backbone.Model({title:e.get("name"),value:e.id}))})},im.prototype.render=function(){hm.prototype.render.call(this);var e=document.createElement("div"),t=document.createElement("div");return e.className="dash-input",t.className="screen-input",this.input=this.dashInput=document.createElement("select"),this.screenInput=document.createElement("select"),_.isObject(this.value)||(this.value={}),this.getSelectOptions(this.dashOptions,this.dashCollection),this.setSelectOptions(this.dashInput,this.dashOptions.options,this.dashOptions.titles),$(this.dashInput).trigger("change"),this.value.dashboard||(this.value.dashboard=this.dashOptions.options[0]),this.getScreens(this.value.dashboard.id),this.value.screen||(this.value.screen=this.screenOptions.options[0]),e.appendChild(this.dashInput),t.appendChild(this.screenInput),this.el.appendChild(e),this.el.appendChild(t),this.dashSelect2=this.setupSelect2(this.dashInput),this.screenSelect2=this.setupSelect2(this.screenInput),ViewStateMethods.prototype.render.apply(this),this.el},im.prototype.postRender=function(){var n=this;this.rendered=!0,this.screenCollection.on("reset",function(){var e;n.getSelectOptions(n.screenOptions,n.screenCollection),n.setSelectOptions(n.screenInput,n.screenOptions.options,n.screenOptions.titles),$(n.screenInput).trigger("change"),n.value?n.value.screen?e=n.value.screen:(e=n.screenOptions.options[0],n.value.screen=e):e=n.screenOptions.options[0],$(n.screenInput).val(e).trigger("change")}),this.dashSelect2.on("select2:select",function(e){var t=e.params.data.id,i=Object.assign({},n.value),e=i.screen!==t;i.dashboard=t,e&&n.onInput(i)}),this.screenSelect2.on("select2:select",function(e){var t=e.params.data.id,i=Object.assign({},n.value),e=i.screen!==t;i.screen=t,e&&n.onInput(i)}),ViewStateMethods.prototype.applyControlState.apply(this),this.setInputValue()},im.prototype.getDefault=function(){return{dashboard:"<none>",screen:"<none>"}},im.prototype.setInputValue=function(){var e,t,i,n;this.isViewState?ViewStateMethods.prototype.setInputValue.apply(this):(t=this.options.linked_oneof_property,n=e=void 0,n=(i=this.value)&&"<none>"!==i?(e=this.parseId(i.dashboard),this.parseId(i.screen)):e="<none>",(!_.isObject(this.value)||this.value instanceof Backbone.Model)&&(this.value={}),t&&_.isObject(i)&&i[t.property]&&(this.value[t.property]=i[t.property]),this.value._dashboardsType="navigation",this.setValueDash(e),this.setValueScreen(n))},im.prototype.getScreens=function(e){var t=this,i=!0;"<this>"===e&&(i=!1,e=this.api.viewModel.get("selectedDocumentId"));function n(e){0===e.length&&e.push({title:"<none>",value:"<none>"}),t.screenCollection.reset(e)}var a=this.api.appModel.get("documents").get(e);a&&(e===this.api.viewModel.get("selectedDocumentId")?n(_.map(a.get("screens").models,function(e){return{title:e.get("name"),value:i?e.get("id"):e.get("name")}})):_.isEmpty(a.get("screenDetails"))?a.fetch({success:function(e){n(_.map(e.get("screenDetails"),function(e){return{title:e.label,value:e.value}}))}}):n(_.map(a.get("screenDetails"),function(e){return{title:e.label,value:e.value}})))},im.prototype.getSelectOptions=function(t,e){t.options=[],t.titles=[],e.each(function(e){t.options.push(e.get("value")),t.titles.push(e.get("title"))})},im.prototype.parseId=function(e){return e=_.isObject(e)&&e.id?e.id:e},im.prototype.setSelectOptions=function(n,e,a){n.options.length=0,e.forEach(function(e,t){var i=document.createElement("option");i.value=e,i.text=a[t],n.appendChild(i)}),$(n).trigger("change")},im.prototype.setValueDash=function(e){var t=Object.assign({},this.value),i=t.dashboard===e;(t.dashboard=e)!==$(this.dashInput).val()&&$(this.dashInput).val(e).trigger("change"),i&&this.getScreens(e)},im.prototype.setValueScreen=function(e){(Object.assign({},this.value).screen=e)!==$(this.screenInput).val()&&$(this.screenInput).val(e).trigger("change")},im.prototype.setupSelect2=function(e){e=$(e).select2({minimumResultsForSearch:10,theme:"dashboards-properties"});return e.addClass("property-editor-select"),e},im),hm;function im(e,t,i,n){n=hm.call(this,e,t,i,n)||this;return n.enumDisplay=[],n.enumOptions=[],n.enumValues=[],LocalTools.applyViewStateMethods(n,im),n}var StringEditor=(gn=BaseEditor,__extends(hn,gn),hn.prototype.render=function(){return this.input=document.createElement("input"),this.input.setAttribute("type",this.inputType),this.options.readonly&&this.input.setAttribute("readonly","true"),this.el.append(this.input),this.el},hn.prototype.postRender=function(){gn.prototype.postRender.call(this),rxjs.fromEvent(this.input,"change").pipe(rxjs.operators.map(function(e){return e.target.value})).subscribe(this.onInput.bind(this)),this.input.setAttribute("draggable","true"),this.input.addEventListener("dragstart",function(e){e.preventDefault(),e.stopPropagation()})},hn.prototype.sanitize=function(e){var t;return"string"==typeof e&&(t=DOMPurify.sanitize(e,{ADD_ATTR:["target"]}),e=(new DOMParser).parseFromString("<!doctype html><body>"+t,"text/html").body.textContent),e},hn.prototype.setInputValue=function(){this.input&&void 0!==this.input.value&&(this.input.value=void 0!==this.value?this.value:"")},hn),gn;function hn(e,t,i,n){n=gn.call(this,e,t,i,n)||this;return n.inputType="text",n}var NumberEditor=(un=StringEditor,__extends(vn,un),vn),un;function vn(e,t,i,n){n=un.call(this,e,t,i,n)||this;return n.inputType="number",n}var ViewStateEditor=(Bn=ClickableStringEditor,__extends(Cn,Bn),Object.defineProperty(Cn.prototype,"value",{get:function(){return this.model||""},set:function(e){!e&&this._value?(this._value="",this.model=""):(this._value,this._value=e,this.setModel(e)),this.rendered&&this.setInputValue()},enumerable:!1,configurable:!0}),Cn.prototype.onClick=function(){this.api.showViewStateDialog(this.model instanceof QuickBase.DocumentViewModel?this.model.path:"",_.bind(function(e){this.onInput(e)},this))},Cn.prototype.getModel=function(){return this.model},Cn.prototype.preRender=function(){this.options.watermark="eye",this.options.eraser=!0,this.options.onFocusOrBlur=this.onFocusOrBlur.bind(this),this.options.click=this.onClick.bind(this)},Cn.prototype.setModel=function(e){this.model=e},Cn.prototype.onFocusOrBlur=function(e){var t=this;this.input.onkeyup=null,"focus"===e.type&&(this.input.onkeyup=_.bind(function(e){32!==e.keyCode&&13!==e.keyCode||t.onClick()},this))},Cn.prototype.setInputValue=function(){this.applyBaseState(),this.input.value=this.value&&this.value.path||""},Cn),Bn;function Cn(e,t,i,n){return Bn.call(this,e,t,i,n)||this}var CheckBoxViewStateEditor=(On=CheckBoxEditor,__extends(Pn,On),Object.defineProperty(Pn.prototype,"value",{get:function(){return this._value},set:function(e){e instanceof Backbone.Model||(e=!!e),ViewStateMethods.prototype.setValue.call(this,e)},enumerable:!1,configurable:!0}),Pn.prototype.render=function(){return On.prototype.render.call(this),ViewStateMethods.prototype.render.apply(this),this.el},Pn.prototype.setInputValue=function(){ViewStateMethods.prototype.setInputValue.apply(this),On.prototype.setInputValue.call(this)},Pn),On;function Pn(e,t,i,n){n=On.call(this,e,t,i,n)||this;return LocalTools.applyViewStateMethods(n,Pn),n}var DropDownViewStateEditor=(Wn=DropdownEditor,__extends(Xn,Wn),Object.defineProperty(Xn.prototype,"value",{get:function(){return this._value},set:function(e){ViewStateMethods.prototype.setValue.apply(this,arguments)},enumerable:!1,configurable:!0}),Xn.prototype.render=function(){return Wn.prototype.render.call(this),ViewStateMethods.prototype.render.apply(this),this.el},Xn.prototype.setInputValue=function(){ViewStateMethods.prototype.setInputValue.apply(this),Wn.prototype.setInputValue.call(this)},Xn.prototype.getStringValue=function(){var e=this.value||"";return(e=e instanceof Backbone.Model?e.get("value"):e).toString()},Xn),Wn;function Xn(e,t,i,n){n=Wn.call(this,e,t,i,n)||this;return LocalTools.applyViewStateMethods(n,Xn),n}var StringViewStateEditor=(eo=StringEditor,__extends(fo,eo),Object.defineProperty(fo.prototype,"value",{get:function(){return this._value},set:function(e){ViewStateMethods.prototype.setValue.apply(this,arguments)},enumerable:!1,configurable:!0}),fo.prototype.onClick=function(){this.api.showViewStateDialog(this.model instanceof QuickBase.DocumentViewModel?this.model.path:"",_.bind(function(e){this.onInput(e)},this))},fo.prototype.render=function(){return eo.prototype.render.call(this),ViewStateMethods.prototype.render.apply(this),this.el},fo.prototype.setInputValue=function(){ViewStateMethods.prototype.setInputValue.apply(this),eo.prototype.setInputValue.call(this)},fo),eo;function fo(e,t,i,n){n=eo.call(this,e,t,i,n)||this;return LocalTools.applyViewStateMethods(n,fo),n}var NumberViewStateEditor=(no=StringViewStateEditor,__extends(oo,no),oo.prototype.validate=function(e){return null!==this.schema.min&&e<this.schema.min?"Number must be greater than "+this.schema.min:this.schema.max&&e>this.schema.max?"Number must be less than "+this.schema.max:""},oo.prototype.onInput=function(e){no.prototype.onInput.call(this,e=""===e?null:e)},oo),no;function oo(e,t,i,n){n=no.call(this,e,t,i,n)||this;return n.inputType="number",n}var STANDARD={boolean:CheckBoxEditor,booleanViewState:CheckBoxViewStateEditor,customDropdown:ColSelectorEditor,css:CSSEditor,data:DataSourceEditor,dataConnection:DataConnectionEditor,gradient:Gradient,gradientViewState:GradientViewState,default:DefaultEditor,dropdown:DropdownEditor,dropdownViewState:DropDownViewStateEditor,handlebar:HandlebarEditor,html:HTMLEditor,icon:IconEditor,json:JSONEditor,nav:NavEditor,number:NumberEditor,numberViewState:NumberViewStateEditor,integer:NumberEditor,integerViewState:NumberViewStateEditor,string:StringEditor,stringViewState:StringViewStateEditor,tooltip:HandlebarEditor,tooltipTemplate:HandlebarEditor,viewstate:ViewStateEditor},VIEWSTATE={boolean:CheckBoxViewStateEditor,gradient:GradientViewState,dropdown:DropDownViewStateEditor,number:NumberViewStateEditor,integer:NumberViewStateEditor,string:StringViewStateEditor},Editors=(wo.get=function(e){var t=wo.EDITORS;return e.enum||e.enumSource?t.dropdown:t[e.type]||t.default},wo.setViewStateEditors=function(e){wo.EDITORS=(wo.viewStateEditors=e)?Object.assign({},STANDARD,VIEWSTATE):STANDARD},wo.viewStateEditors=!0,wo);function wo(){}[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty("append")||Object.defineProperty(e,"append",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),i=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;i.appendChild(t?e:document.createTextNode(String(e)))}),this.appendChild(i)}})}),[Element.prototype,Document.prototype,DocumentFragment.prototype].forEach(function(e){e.hasOwnProperty("prepend")||Object.defineProperty(e,"prepend",{configurable:!0,enumerable:!0,writable:!0,value:function(){var e=Array.prototype.slice.call(arguments),i=document.createDocumentFragment();e.forEach(function(e){var t=e instanceof Node;i.appendChild(t?e:document.createTextNode(String(e)))}),this.insertBefore(i,this.firstChild)}})}),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var ItemContainer=(Object.defineProperty(Po.prototype,"expanded",{get:function(){return this._expanded},set:function(e){this._expanded=e},enumerable:!1,configurable:!0}),Object.defineProperty(Po.prototype,"path",{get:function(){return this._path},set:function(e){this._path!==e&&(this._path=e,this.updatePaths(),this.watch())},enumerable:!1,configurable:!0}),Object.defineProperty(Po.prototype,"schema",{get:function(){return this._schema},set:function(e){var t=this._schema;this._schema=e,this.value=this.getDefault(),_.isEqual(this._schema,t)||((t=this.rendered&&!_.isEqual(_.omit(t,["hidden","options.hidden"]),_.omit(e,["hidden","options.hidden"])))&&this.editor&&this.editor.remove(),this.editor=this.initEditor(e),t&&this.el.append(this.renderEditor()),this._schema.type&&this.el.setAttribute("data-type",this.schema.type)),this.rendered&&(this.isHidden()?this.hide():this.unhide())},enumerable:!1,configurable:!0}),Object.defineProperty(Po.prototype,"value",{get:function(){return this._value},set:function(e){this._value=e,this.editor&&(this.editor.value=e),this.emit(),this.determineEmpty(e)&&"data"!==this.schema.type?this.el.classList.add("undefined"):this.el.classList.remove("undefined")},enumerable:!1,configurable:!0}),Po.prototype.addListener=function(e){return this.listener||(this.listener=new rxjs.BehaviorSubject(this.value)),this.listener.subscribe(e)},Po.prototype.expand=function(e){var t=_.isBoolean(e)?this.path+"._self":this.path;this.root.expand(e,t)},Po.prototype.filter=function(e){if(e){if(new Fuse([this.getTitle()],{threshold:.4}).search(e).length)return this.el.classList.remove("filtered"),this.label&&(this.label.innerHTML=this.highlightText(this.getTitle(),e)),!0;this.el.classList.add("filtered")}else this.label&&(this.label.innerHTML=this.label.innerText),this.el.classList.remove("filtered")},Po.prototype.getDefault=function(){if(void 0!==this.schema.default)return this.schema.default;if(this.schema.enum)return this.schema.enum[0];var e=this.schema.type||this.schema.oneOf;if("string"==typeof(e=(e=(e=e&&Array.isArray(e)?e[0]:e)&&"object"==typeof e?e.type:e)&&Array.isArray(e)?e[0]:e)){if("number"===e)return 0;if("boolean"===e)return!1;if("integer"===e)return 0;if("string"===e||"customDropdown"===e)return"";if("object"===e)return{};if("array"===e||"actions"===e||"popups"===e)return[]}return null},Po.prototype.hide=function(){this.el.classList.add("hidden")},Po.prototype.initEditor=function(e,t){var i=this,t=new(Editors.get(e))(e,function(e){i.setValueByPath(e,i.path)},this.root.api,t||{});return t.value=this.value,t},Po.prototype.onClick=function(){this.editor&&this.editor.onClick&&this.editor.onClick()},Po.prototype.paste=function(e){for(var t,i=_.get(this,"schema.properties")||_.get(this,"schema.items"),n=Object.keys(i),i=Object.keys(e),a=this.value,o=_.intersection(n,i).filter(function(e){return"ComponentName"!==e}),s=0;s<o.length;s++)a[o[s]]!==e[o[s]]&&("advanced"===o[s]&&(t=e[o[s]].substring(e[o[s]].indexOf("data-widgetid=")+15,e[o[s]].indexOf("data-widgetid=")+51),e[o[s]]=e[o[s]].split(t).join(this.root.api.getWidget().id)),a[o[s]]=e[o[s]]);this.setValueByPath(a,this.path)},Po.prototype.postRender=function(){this.rendered=!0,this.updatePaths(),this.watch()},Po.prototype.remove=function(){var t=this;this.editor&&this.editor.remove(),this.el.innerHTML="",this.schema.watch&&Object.keys(this.schema.watch).forEach(function(e){t.watchSubscriptions[e]&&(t.watchSubscriptions[e].unsubscribe(),delete t.watchSubscriptions[e])}),this.listener&&this.listener.unsubscribe(),this.rendered=!1,this.expand(null)},Po.prototype.render=function(){return this.schema.headerTemplate&&(this.headerTemplate=Handlebars.compile(this.schema.headerTemplate)),this.schema&&this.schema.options&&this.schema.options.custom_class_name&&this.el.classList.add(this.schema.options.custom_class_name),this.editor&&(this.labelled&&void 0!==this.schema.type&&(this.label=this.renderLabel(),this.el.append(this.label)),this.el.append(this.renderEditor())),this.el},Po.prototype.renderLabel=function(){var e=document.createElement("div"),t=this.getLabelText();return e.textContent=t,e.className="label",e.setAttribute("title",t),e},Po.prototype.unhide=function(){this.el.classList.remove("hidden")},Po.prototype.updatePaths=function(){var t;this.el.setAttribute("data-schemapath",this.path),this.key=this.path.split(".").pop(),this.path&&this.editor&&this.editor.input&&(t="",_.each(this.path.split("."),function(e){t+="root"!==e?"["+e+"]":e}),$(this.editor.input).attr("name",t))},Po.prototype.determineEmpty=function(e){return void 0===e},Po.prototype.emit=function(){this.listener&&this.listener.next(this.value)},Po.prototype.getTitle=function(){return this.schema.title||this.key},Po.prototype.highlightText=function(e,t){t=new RegExp("("+t+")","gi");return e.replace(t,"<mark>$1</mark>")},Po.prototype.isHidden=function(){return _.get(this.schema,"hidden")||_.get(this.schema,"options.hidden")},Po.prototype.renderEditor=function(){var e=this.editor.startRender();return e.classList.add("editor"),e},Po.prototype.setValueByPath=function(e,t){return this.root.setValueByPath(e,t)},Po.prototype.watch=function(){var i=this;this.schema.watch&&Object.keys(this.schema.watch).forEach(function(t){i.watchSubscriptions[t]&&i.watchSubscriptions[t].unsubscribe(),i.watchSubscriptions[t]=i.root.addListener(i.schema.watch[t],function(e){i.editor&&i.editor.onWatchedFieldChange(e,t)},i.path)})},Po.prototype.getLabelText=function(){var e=this.options.custom,t=this.path.substr(this.path.lastIndexOf(".")+1),i=this.schema.title;return e||i||t},Po);function Po(e,t,i,n){this.el=document.createElement("div"),this.el.classList.add("container"),this.options=n||{},this.root=i,this._path=t,this.watchSubscriptions={},this.defaultExpanded=!e.options||!e.options.collapsed;t=this.defaultExpanded;_.isEmpty(n.expanded)&&!_.isBoolean(n.expanded)||(t=n.expanded),this.expanded=_.isObject(t)?t:{_self:t},this.schema=e,this.schemaOptions=e.options||{},this.labelled=!!_.isUndefined(n.labelled)||n.labelled,this.updatePaths(),this.root.register(this)}var CollapsibleContainer=(Pp=ItemContainer,__extends(Qp,Pp),Object.defineProperty(Qp.prototype,"expanded",{get:function(){return this._expanded},set:function(e){var t={};_.isNil(e)||(t=_.omit(e,"_self"),this._expanded=e),this._expanded._self?(this.el.classList.add("expanded"),this.setCaret(),this.rendered?this.renderChildren():this.pendingRenderChildren=!0):(this.el.classList.remove("expanded"),this.setCaret()),this.getChildren().forEach(function(e){e.expanded=t[e.key]})},enumerable:!1,configurable:!0}),Object.defineProperty(Qp.prototype,"schema",{get:function(){return this._schema},set:function(e){var i=this;this._schema=e,this.children={},_.each(this.schema.properties,function(e,t){i.initChild(t)}),this._value=this.getDefault(),_.each(this.schema.properties,function(e,t){i._value[t]=i.children[t].getDefault()}),this.schema.type&&this.el.setAttribute("data-type",this.schema.type),this.rendered&&(this.isHidden()?this.hide():this.unhide())},enumerable:!1,configurable:!0}),Object.defineProperty(Qp.prototype,"value",{set:function(e){this._value=e,this.setTitle(),this.emit()},enumerable:!1,configurable:!0}),Qp.prototype.filter=function(i){var n=this;if(!i)return this.rendered&&(this.getChildren().forEach(function(e){e.filter(null)}),this.el.classList.remove("filtered"),this.expand(this.defaultExpanded),this.titleText.innerHTML=this.titleText.innerText),!0;var a=!1;return new Fuse([this.getTitle()],{threshold:.4}).search(i).length&&(a=!0,this.rendered&&(this.titleText.innerHTML=this.highlightText(this.titleText.innerText,i))),this.getChildren().forEach(function(e,t){e.filter(i)&&(a=!0,n.rendered&&!e.rendered&&(n.renderChild(e,t),e.expand&&e.expand(!0),e.filter(i)))}),this.rendered&&(a?(this.renderChildren(),this.el.classList.remove("filtered"),this.expand(!0)):(this.el.classList.add("filtered"),this.expand(!1))),a},Qp.prototype.getDefault=function(){var t=this;if(void 0!==this.schema.default)return this.schema.default;var i={};return this.children&&Object.keys(this.children).forEach(function(e){i[e]=t.children[e].getDefault()}),i},Qp.prototype.hide=function(){Pp.prototype.hide.call(this),this.hideChildren()},Qp.prototype.postRender=function(){var n=this;Pp.prototype.postRender.call(this),this.title.onblur=function(){return n.root.onFocus(null)},this.title.onfocus=function(){return n.root.onFocus(n.path)},this.title.onmouseover=function(){return n.root.setCopyPasteIcons()},this.canCollapse?(this.caret=document.createElement("i"),this.title.prepend(this.caret),this.setCaret(),this.el.classList.add("collapsible"),rxjs.fromEvent(this.title,"click").pipe(rxjs.operators.filter(function(e){var t=/MSIE|Trident/.test(window.navigator.userAgent),i=e.target;return t&&(t=e.clientX,e=e.clientY,i=document.elementFromPoint(t,e)),i===n.title||i===n.titleText||i===n.caret}),rxjs.operators.scan(function(e,t){return t.stopPropagation(),!n.expanded._self},this.expanded._self),rxjs.operators.startWith(this.expanded)).subscribe(this.expand.bind(this))):this.expand(!0),this.pendingRenderChildren&&(this.renderChildren(),this.pendingRenderChildren=!1)},Qp.prototype.reloadHeaderTemplates=function(){this.getChildren().forEach(function(e){_.has(e,"header_template")&&e.editor&&e.editor.onWatchedFieldChange&&e.editor.onWatchedFieldChange()})},Qp.prototype.remove=function(){this.getChildren().forEach(function(e){return e.remove()}),Pp.prototype.remove.call(this)},Qp.prototype.render=function(){return Pp.prototype.render.call(this),this.childrenEl=document.createElement("div"),this.childrenEl.classList.add("editor"),this.inline?this.el.classList.add("inline"):(this.renderTitle(),this.setTitle(),this.el.prepend(this.childrenEl),this.el.prepend(this.title),!/\d/.test(this.path)&&this.root.api.viewModel.get("selectedWidgetId")&&this.renderCopyPasteIcons()),this.el},Qp.prototype.setCopyState=function(e){e?this.el.classList.add("copied"):this.el.classList.remove("copied")},Qp.prototype.unhide=function(){Pp.prototype.unhide.call(this),this.expanded._self&&this.unhideChildren()},Qp.prototype.updatePaths=function(){Pp.prototype.updatePaths.call(this),this.setTitle()},Qp.prototype.appendChild=function(e,t){this.childrenEl.insertBefore(e.el,this.childrenEl.children[t]||null)},Qp.prototype.getChildren=function(){var t=this;return this.children instanceof Object?Object.keys(this.children).sort(this.sortIndexes.bind(this)).map(function(e){return t.children[e]}):this.children||[]},Qp.prototype.getChildSchema=function(e){return this.schema.properties[e]},Qp.prototype.getTitle=function(){var e=this.el.getAttribute("data-i"),t=this.schema.title||this.key;return t&&e&&(t+=" "+(Number(e)+1)),t},Qp.prototype.hideChildren=function(){this.getChildren().forEach(function(e){return e.hide()})},Qp.prototype.initChild=function(e){this.children[e]=this.root.initItem(this.getChildSchema(e),(this.path?this.path+".":"")+e,{expanded:this.expanded[e]})},Qp.prototype.removeChild=function(e){var t=this.children[e];t&&(t.remove(),delete this.children[e],this.childrenEl.contains(t.el)&&this.childrenEl.removeChild(t.el))},Qp.prototype.renderChild=function(e,t){e.render(),this.appendChild(e,t),e.postRender(),e.isHidden()&&e.hide()},Qp.prototype.renderCopyPasteIcons=function(){var e=this;this.copyPaste=document.createElement("span"),this.copyPaste.id="copyPaste",this.copyPaste.contentEditable="false",this.copyIcon=document.createElement("BUTTON"),this.copyIcon.id="copy",this.copyIcon.className="fa fa-copy",this.copyIcon.title="Copy property section to clipboard",this.pasteIcon=document.createElement("BUTTON"),this.pasteIcon.id="paste",this.pasteIcon.className="fa fa-paste",this.pasteIcon.title="Paste property section from clipboard",this.copyPaste.appendChild(this.copyIcon),this.copyPaste.appendChild(this.pasteIcon),this.title.append(this.copyPaste),this.copyIcon.onclick=function(){e.root.onFocus(e.path),e.root.startCopy()},this.pasteIcon.onclick=function(){e.root.onFocus(e.path),e.root.startPaste()}},Qp.prototype.renderTitle=function(){this.title=document.createElement(this.canCollapse?"button":"div"),this.titleText=document.createElement("span"),this.title.append(this.titleText),this.title.className="title",this.titleText.className="title-text",this.titleText.contentEditable="false",this.el.classList.add("titled")},Qp.prototype.setTitle=function(){this.titleText?this.titleText.textContent=this.generateTitle():this.title&&(this.title.textContent=this.generateTitle())},Qp.prototype.unhideChildren=function(){var i=this;this.getChildren().forEach(function(e,t){e.isHidden()||(e.rendered||i.renderChild(e,t),e.unhide())})},Qp.prototype.generateTitle=function(){return this.headerTemplate?this.headerTemplate({key:this.key,i:this.key,i0:Number(this.key),i1:Number(this.key)+1,self:this.unpackHandlebarsValues(),title:this.getTitle()}):this.getTitle()},Qp.prototype.renderChildren=function(){var i=this;this.getChildren().forEach(function(e,t){e.rendered||i.renderChild(e,t)})},Qp.prototype.setCaret=function(){this.caret&&(this.expanded._self?this.caret.className="caret fa fa-caret-down":this.caret.className="caret fa fa-caret-right")},Qp.prototype.sortIndexes=function(e,t){var i=this.children[e],n=this.children[t];return e&&t?(Number.isInteger(i.schema.propertyOrder)?i.schema.propertyOrder:1e3)-(Number.isInteger(n.schema.propertyOrder)?n.schema.propertyOrder:1e3):0},Qp.prototype.unpackHandlebarsValues=function(){return this.value instanceof Object?_.mapValues(this.value,function(e){return e instanceof Backbone.Model?e.get("value"):e}):this.value},Qp),Pp;function Qp(e,t,i,n){i=Pp.call(this,e,t,i,n)||this;return i.canPaste=!0,i.canCollapse=!e.options||!e.options.disable_collapse,i.labelled=!_.isUndefined(n.labelled)&&n.labelled,e.options&&e.options.inline&&(i.inline=!0,i.canCollapse=!1),i}var ArrayContainer=(_q=CollapsibleContainer,__extends(ar,_q),Object.defineProperty(ar.prototype,"schema",{get:function(){return this._schema},set:function(e){var t=this;this._schema=e,this.getChildren().forEach(function(e){t.removeChild(e)}),this.children=[],this._value=this.getDefault(),this.schema.type&&this.el.setAttribute("data-type",this.schema.type),this.rendered&&(this.isHidden()?this.hide():this.unhide())},enumerable:!1,configurable:!0}),Object.defineProperty(ar.prototype,"value",{get:function(){if(void 0!==this._value)return this.children.map(function(e){return e.value})},set:function(e){var i=this;if(this._value=e,Array.isArray(e)){e.forEach(function(e,t){i.children[t]||i.initChild(t),i.rendered&&!i.children[t].rendered&&i.renderChild(i.children[t],t),i.children[t].value=e});for(var t=this.children.length-1;t>e.length-1;t--)this.removeChild(this.children[t])}this.emit(),this.determineEmpty(e)?this.el.classList.add("undefined"):this.el.classList.remove("undefined")},enumerable:!1,configurable:!0}),ar.prototype.onClick=function(){0===this.value.length&&this.addRow(0)},ar.prototype.paste=function(e){var t,i=this,n=this.value;e instanceof Array?_.each(e,function(e){var t=i.children.length;i.addRow(t),n.push(_.extend(i.children[t].getDefault(),e))}):e instanceof Object&&(t=this.children.length,this.addRow(t),n.push(_.extend(this.children[t].getDefault(),e))),this.setValueByPath(n,this.path)},ar.prototype.render=function(){return _q.prototype.render.call(this),this.bulkEditor&&(this.btnBulkEdit=document.createElement("i"),this.btnBulkEdit.className="bulkEditor fa fa-pencil-square-o",this.copyPaste?this.title.insertBefore(this.btnBulkEdit,this.copyPaste):this.title.append(this.btnBulkEdit)),this.reset&&(this.btnReset=document.createElement("i"),this.btnReset.className="btnReset fa fa-refresh",this.copyPaste?this.title.insertBefore(this.btnReset,this.copyPaste):this.title.append(this.btnReset)),this.endOfList=document.createElement("button"),this.endOfList.classList.add("end-of-list"),this.el.append(this.endOfList),this.canAdd&&(this.endOfList.classList.add("add-item"),this.endOfList.innerHTML="+ "+(this.schema.items&&this.schema.items.title?this.schema.items.title:"Item")),this.canDrag&&(this.dragContainer=this.childrenEl,this.placeholder=document.createElement("div"),this.placeholder.classList.add("placeholder"),this.el.append(this.placeholder)),this.el},ar.prototype.postRender=function(){var i=this;_q.prototype.postRender.call(this),this.bulkEditor&&this.btnBulkEdit.addEventListener("click",function(){i.root.api.showBulkColumnEditor(i)}),this.reset&&this.btnReset.addEventListener("click",this.onResetClick.bind(this)),this.canAdd&&this.endOfList.addEventListener("click",function(){var e=i.children.length,t=i.value.slice();i.addRow(e),i.renderChild(i.children[e],i.children.length-1),t[e]=i.children[e].value,i.setValueByPath(t,i.path)}),this.canDrag&&this.endOfList.addEventListener("dragenter",function(e){i.fromElement&&(i.dragContainer.append(i.fromElement),i.setPlaceholder(i.fromElement))})},ar.prototype.updatePaths=function(){var i=this;_q.prototype.updatePaths.call(this),this.getChildren().forEach(function(e,t){e.path=(i.path?i.path+".":"")+t,e.el.setAttribute("data-i",t)})},ar.prototype.addDragListeners=function(e){function i(e){for(var t=0;null!==(e=e.previousSibling);)t++;return t}var n=this;e.setAttribute("draggable",!0),e.addEventListener("dragstart",function(e){var t=e.target;e.stopPropagation(),n.fromElement=t,n.fromIndex=i(t),n.el.classList.add("moving")}),e.addEventListener("dragenter",function(e){e.stopPropagation(),n.fromElement&&(n.dragContainer.insertBefore(n.fromElement,e.currentTarget),n.setPlaceholder(n.fromElement))}),e.addEventListener("dragend",function(e){var t=i(e.currentTarget);e.stopPropagation(),n.el.classList.remove("moving"),n.setPlaceholder(null),n.children.splice(t,0,n.children.splice(n.fromIndex,1)[0]),n.updatePaths(),n.setValueByPath(n.value,n.path),n.expand(n.expanded),n.fromElement=null})},ar.prototype.addRow=function(e){this.children[e]||this.initChild(e)},ar.prototype.getChildSchema=function(){return this.schema.items||{type:"string"}},ar.prototype.removeChild=function(e){var t=this.children.indexOf(e);e.remove(),this.rendered&&this.childrenEl.removeChild(e.el),this.children.splice(t,1)},ar.prototype.renderChild=function(e,t){var i,n=this;_q.prototype.renderChild.call(this,e,t),e.el.setAttribute("data-i",t),e.expanded=this.expanded[t],this.canRemove&&((i=document.createElement("i")).className="remove fa fa-trash",i.onclick=function(){event.stopPropagation(),event.preventDefault(),n.children.splice(Number(i.parentElement.getAttribute("data-i")),1),i.parentElement.parentElement.removeChild(i.parentElement),n.updatePaths(),n.setValueByPath(n.value,n.path),n.expand(n.expanded)},e.el.append(i)),this.canDrag&&this.addDragListeners(e.el)},ar.prototype.onResetClick=function(){this.setValueByPath(["reset",Date.now()],"root.notificationEvent")},ar.prototype.setPlaceholder=function(e){e?(e=e.getBoundingClientRect(),this.placeholder.classList.add("active"),this.placeholder.style.marginLeft=this.fromElement.offsetLeft+"px",this.placeholder.style.width=e.width+"px",this.placeholder.style.height=e.height+"px",this.placeholder.style.top=e.top-36+"px"):this.placeholder.classList.remove("active")},ar),_q;function ar(e,t,i,n){n=_q.call(this,e,t,i,n)||this;return n.bulkEditor=!!e.options&&e.options.bulkEditor,n.canAdd=!e.options||!e.options.disable_array_add,n.canDrag=!e.options||!e.options.disable_array_reorder,n.canRemove=!e.options||!e.options.disable_array_delete,n.reset=!!e.options&&e.options.reset,n}var ActionsContainer=(Wr=ArrayContainer,__extends(Xr,Wr),Xr.prototype.extendSchema=function(){var t={};_.each(["map","nav","query","url"],_.bind(function(e){t[e]={_Type:{default:e,type:"string",options:{hidden:!0}}},this.originalSchema&&this.originalSchema.fields&&_.extend(t[e],this.originalSchema.fields[e])},this)),_.extend(this.originalSchema,{options:{custom_class_name:"actions-array"},items:{title:"Action",headerTemplate:"Action {{ i1 }}",options:{keep_oneof_values:!1},oneOf:[{type:"object",title:"View State Mapping",uniqueItems:!1,options:{no_title:!0,custom_class_name:"mapping-object",linked_oneof_property:{property:"_Type",value:"map"}},properties:_.extend({Current:{propertyOrder:10,default:"",type:"string",options:{custom_class_name:"mapping-current"}},Target:{default:"",propertyOrder:11,type:"string",options:{custom_class_name:"mapping-target"}}},t.map)},{type:"object",title:"Open Dashboard/Screen",options:{linked_oneof_property:{property:"_Type",value:"nav"}},properties:_.extend({SelectDashboardScreen:{type:"nav",title:"Select Dashboard/Screen",default:{dashboard:"<none>",screen:"<none>"}},Target:{type:"string",enum:["_self","_blank"],options:{enum_titles:["This Window","New Window"]}}},t.nav)},{type:"object",title:"Run Query",options:{linked_oneof_property:{property:"_Type",value:"query"}},properties:_.extend({DataSource:{type:"data"}},t.query)},{type:"object",title:"Open Url",options:{linked_oneof_property:{property:"_Type",value:"url"}},properties:_.extend({Url:{type:"string"},Target:{type:"string",enum:["_self","_blank"],options:{enum_titles:["This Window","New Window"]}}},t.url)}]}});var i=this.originalSchema.excludedFields;i&&_.remove(this.originalSchema.items.oneOf,function(e){return _.includes(i,e.options.linked_oneof_property.value)}),this.schema=this.originalSchema,_.extend(this.schemaOptions,this.schema.options)},Xr),Wr;function Xr(e,t,i,n){n=Wr.call(this,e,t,i,n)||this;return n.originalSchema=_.cloneDeep(e),n.extendSchema(),n}var BackboneContainer=(fs=CollapsibleContainer,__extends(gs,fs),gs.prototype.remove=function(){this.instance&&(this.instance.remove(),this.instance=null),fs.prototype.remove.call(this)},gs.prototype.render=function(){var i=this;return fs.prototype.render.call(this),this.instance=new this.view(Object.assign({el:this.childrenEl},_.reduce(this.parameters,function(e,t){return e[t]=i.root.api.getParameter(t),e},{}))),this.el},gs.prototype.hideChildren=function(){this.instance&&this.instance.$el.hide()},gs.prototype.unhideChildren=function(){this.instance&&this.instance.$el.show()},gs),fs;function gs(e,t,i,n){n=fs.call(this,e,t,i,n)||this;return n.parameters=e.options.parameters,n.view=e.options.view,n}var ObjectContainer=(ps=CollapsibleContainer,__extends(qs,ps),Object.defineProperty(qs.prototype,"schema",{get:function(){var t=this,i=this._schema;return Object.keys(this.children).forEach(function(e){i.properties[e]=t.children[e].schema}),i},set:function(e){var i=this;this._schema=e,this.getChildren().forEach(function(e){i.removeChild(e.key)}),this.children={},_.each(this.schema.properties,function(e,t){i.initChild(t)}),this._value=this.getDefault(),_.each(this.schema.properties,function(e,t){i._value[t]=i.children[t].getDefault()}),this.schema.type&&this.el.setAttribute("data-type",this.schema.type),this.rendered&&(this.isHidden()?this.hide():this.unhide())},enumerable:!1,configurable:!0}),Object.defineProperty(qs.prototype,"value",{get:function(){var t=this,i={};if(void 0!==this._value)return Object.keys(this.children).forEach(function(e){void 0!==t.children[e].value&&(i[e]=t.children[e].value)}),i},set:function(t){var i=this;this._value=t,this.determineEmpty(t)?this.el.classList.add("undefined"):(this.el.classList.remove("undefined"),_.isEmpty(t)||Object.keys(this.children).forEach(function(e){i.children[e].value=t[e]})),this.setTitle()},enumerable:!1,configurable:!0}),qs.prototype.updatePaths=function(){var t=this;ps.prototype.updatePaths.call(this),this.getChildren().forEach(function(e){e.path=(t.path?t.path+".":"")+e.key})},qs),ps;function qs(e,t,i,n){return ps.call(this,e,t,i,n)||this}var OneOfContainer=(Ns=ItemContainer,__extends(Os,Ns),Object.defineProperty(Os.prototype,"expanded",{get:function(){return this._expanded},set:function(e){_.isNil(e)||(this._expanded=e,this.childItem&&((this.childItem.expanded=e)&&e._self?this.el.classList.add("child-expanded"):this.el.classList.remove("child-expanded")))},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"schema",{get:function(){return this._schema},set:function(e){this.childItem&&this.childItem.remove(),this._schema=e,this._value=this.getDefault(),this.schema.type&&this.el.setAttribute("data-type",this.schema.type)},enumerable:!1,configurable:!0}),Object.defineProperty(Os.prototype,"value",{get:function(){return this.childItem?this.childItem.value:this._value},set:function(e){var t=this.determineEditor(e);t!==this.selectedEditor&&(this.selectedEditor=t,this.switchEditor(e),this.rendered&&this.renderChildItem()),this._value=e,this.childItem&&(this.childItem.value=this._value),this.emit(),this.determineEmpty(e)?this.el.classList.add("undefined"):this.el.classList.remove("undefined")},enumerable:!1,configurable:!0}),Os.prototype.filter=function(e){if(this.childItem){var t=this.childItem.rendered,i=this.childItem.filter(e);return i?(this.el.classList.remove("filtered"),t||this.renderChildItem()):this.el.classList.add("filtered"),i}return Ns.prototype.filter.call(this,e)},Os.prototype.getDefault=function(){return this.childItem?this.childItem.getDefault():Ns.prototype.getDefault.call(this)},Os.prototype.hide=function(){Ns.prototype.hide.call(this),this.childItem&&this.childItem.hide()},Os.prototype.postRender=function(){Ns.prototype.postRender.call(this),this.select2=$(this.input).select2({minimumResultsForSearch:10,theme:"dashboards-properties"}),this.select2El=this.el.getElementsByClassName("select2-container")[0],rxjs.fromEvent(this.select2,"select2:select").pipe(rxjs.operators.map(function(e){return e.params.data.id})).subscribe(this.onSelectEditor.bind(this))},Os.prototype.remove=function(){this.childItem&&this.childItem.remove(),Ns.prototype.remove.call(this)},Os.prototype.render=function(){return this.input=document.createElement("select"),this.el.append(this.input),this.renderOptions(),this.switchEditor(this.value),this.renderChildItem(),this.el.classList.add("select2-wrapper"),this.el.classList.add("oneOf"),this.updatePaths(),this.watch(),this.el},Os.prototype.switchEditor=function(e){this.select2El&&this.el.append(this.select2El),this.childItem&&this.childItem.remove(),this.initChild();var t=this.childItem.getDefault();e&&_.mergeWith(t,e,function(e,t,i,n){void 0===t&&_.set(n,i,void 0)}),this._value=t,void 0===(this.childItem.value=t)?this.el.classList.add("undefined"):this.el.classList.remove("undefined")},Os.prototype.unhide=function(){Ns.prototype.unhide.call(this),this.childItem&&this.childItem.unhide()},Os.prototype.updatePaths=function(){Ns.prototype.updatePaths.call(this),this.childItem&&(this.childItem.path=this.path,this.childItem.el.setAttribute("data-i",this.el.getAttribute("data-i")))},Os.prototype.renderChildItem=function(){this.select2&&this.select2.val(this.selectedEditor).trigger("change"),this.rendered=!0;var e=this.childItem.render();return this.el.append(e),this.childItem.postRender(),_.defer(function(){this.select2El&&(this.inline?this.childItem.el.insertBefore(this.select2El,this.childItem.editor):this.childItem.title&&this.childItem.title.append(this.select2El))}.bind(this)),this.el},Os.prototype.determineEditor=function(r){var l=0;return this.schema.oneOf.some(function(e,t){if(e.options&&e.options.linked_oneof_property){for(var i=e.options.linked_oneof_property,n=i.property.split("."),a=r,o=void 0,s=!1;a&&(o=n.shift());)n.length?a=a[o]:s=a[o]===i.value;if(s)return l=t,!0}}),l},Os.prototype.initChild=function(){this.childItem=this.root.initItem(this.schema.oneOf[this.selectedEditor||0],this.path,{expanded:this.expanded,labelled:this.inline,label:this.schema.title})},Os.prototype.onSelectEditor=function(e){var t=this.editors[e].linkedProperty,i=this.value;t&&LocalTools.setValue(i,t.property,t.value);e=this.determineEditor(i);e!==this.selectedEditor&&(this.selectedEditor=e,this.switchEditor(this.keepValues?i:null),this.renderChildItem());i=this.value;t&&LocalTools.setValue(i,t.property,t.value),this.setValueByPath(i,this.path),this.childItem.expanded=this.expanded},Os.prototype.renderOptions=function(){var i=this;this.input.options.length=0,Object.keys(this.editors).forEach(function(e){var t=document.createElement("option");t.value=e,t.text=i.editors[e].title,Number(t.value)===i.selectedEditor&&(t.selected=!0),i.input.append(t)}),$(this.input).trigger("change")},Os.labelled=!1,Os),Ns;function Os(e,t,i,n){var a=Ns.call(this,e,t,i,n)||this;return a.editors={},a.inline=a.schema.options&&a.schema.options.inline,a.keepValues=!a.schema.options||void 0===a.schema.options.keep_oneof_values||a.schema.options.keep_oneof_values,a.schema.oneOf.forEach(function(t,e){["headerTemplate","type"].forEach(function(e){!t[e]&&a.schema[e]&&(t[e]=a.schema[e])}),["collapsed","custom_class_name","disable_collapse","inline","title"].forEach(function(e){t.options&&!t.options.hasOwnProperty(e)&&a.schema.options&&a.schema.options[e]&&(t.options[e]=a.schema.options[e])}),t.headerTemplate||(t.headerTemplate=a.schema.title||a.key||"Item","array"===t.type&&(t.headerTemplate+=" {{ i1 }}")),a.editors[e]={linkedProperty:t.options?t.options.linked_oneof_property:null,title:t.title}}),a.selectedEditor=0,a.switchEditor(),a}var PopupsContainer=(Ct=ArrayContainer,__extends(Dt,Ct),Dt.prototype.renderChild=function(e,t){var i,n=this;Ct.prototype.renderChild.call(this,e,t),this.schemaOptions.editPopupButton&&((i=document.createElement("i")).className="fa fa-pencil editPopup",i.setAttribute("title","Edit Popup"),i.addEventListener("click",function(){event.preventDefault(),event.stopPropagation(),n.root.api.showPopupEditor(e.value.id)}),this.children[t].el.appendChild(i))},Dt),Ct;function Dt(){return null!==Ct&&Ct.apply(this,arguments)||this}var TableContainer=(It=ArrayContainer,__extends(Jt,It),Jt.prototype.render=function(){return It.prototype.render.call(this),this.table=document.createElement("table"),this.tableBody=document.createElement("tbody"),this.table.append(this.tableBody),this.childrenEl.prepend(this.table),this.canDrag&&(this.dragContainer=this.tableBody),this.el},Jt.prototype.updatePaths=function(){if(It.prototype.updatePaths.call(this),this.rendered)for(var e=this.tableBody.children,t=0;t<e.length;t++)e[t].setAttribute("data-i",t.toString())},Jt.prototype.removeChild=function(e){var t=this.children.indexOf(e);e.remove(),this.children.splice(t,1),!this.rendered||(t=this.tableBody.querySelector("[data-i='"+t+"']"))&&this.tableBody.removeChild(t)},Jt.prototype.renderChild=function(i,e){var t,n,a=this,o=[],s=document.createElement("tr");this.tableHeader||this.renderTableHeader(i.schema),i.render().setAttribute("data-i",e),s.setAttribute("data-i",e),i.children?Object.keys(i.children).filter(function(e){return!(i.children[e].schemaOptions&&i.children[e].schemaOptions.hidden)}).forEach(function(e){var t=i.children[e],e=document.createElement("td");e.classList.add("container"),e.setAttribute("data-type",t.schema.type),t.rendered||(t.render(),e.append(t.editor.el),s.append(e),o.push(t))}):((t=document.createElement("td")).classList.add("container"),t.setAttribute("data-type",i.schema.type),t.append(i.editor.el),s.append(t)),this.canRemove&&(t=document.createElement("td"),n=document.createElement("i"),e=document.createElement("span"),n.classList.add("remove","fa","fa-trash"),n.onclick=function(e){e.stopPropagation(),e.preventDefault(),a.children.splice(Number(s.getAttribute("data-i")),1),s.remove(),a.updatePaths(),a.setValueByPath(a.value,a.path),a.children.length||(a.tableHeader.remove(),a.tableHeader=null)},e.append(n),t.classList.add("container"),t.classList.add("remove-icon"),t.append(e),s.append(t)),this.tableBody.append(s),i.pendingRenderChildren=!1,i.postRender(),o.forEach(function(e){return e.postRender()}),this.canDrag&&this.addDragListeners(s)},Jt.prototype.renderTableHeader=function(e){var t=e.properties||{},i=[],n=document.createElement("tr");Object.keys(t).forEach(function(e){t[e].options&&t[e].options.hidden||i.push(t[e].title||e)}),this.tableHeader=document.createElement("thead"),this.tableHeader.append(n),i.forEach(function(e){var t=document.createElement("th");t.innerHTML=e,n.append(t)}),this.canRemove&&((e=document.createElement("th")).className="remove",n.append(e)),this.table.prepend(this.tableHeader)},Jt),It;function Jt(e,t,i,n){n=It.call(this,e,t,i,n)||this;return n.el.setAttribute("data-format","table"),n}var CONTAINERS={actions:ActionsContainer,array:ArrayContainer,backbone:BackboneContainer,object:ObjectContainer,oneOf:OneOfContainer,popups:PopupsContainer,table:TableContainer},Containers=(qu.get=function(e){return e.oneOf?CONTAINERS.oneOf:"array"===e.type&&"table"===e.format?CONTAINERS.table:CONTAINERS[e.type]||ItemContainer},qu),ChangeType,su;function qu(){}su=ChangeType=ChangeType||{},su[su.Expanded=0]="Expanded",su[su.Value=1]="Value";var PropertyEditor=(tu.prototype.addListener=function(e,t,i){i=this.getItemByPath(e,i);return i?i.addListener(t):null},tu.prototype.canPaste=function(e){e=this.itemsById[e];return!!e&&e.canPaste},tu.prototype.copy=function(){return this.copiedItem&&this.copiedItem.setCopyState(!1),this.copiedItem=this.itemsById[this.getFocusedPath()],this.copiedItem?(this.copiedItem.setCopyState(!0),this.copiedItem.value):null},tu.prototype.expand=function(e,t){var i=_.cloneDeep(this.expanded);null===e?_.unset(i,this.trimPath(t)):"root"===t?_.extend(i,e):LocalTools.setValue(i,this.trimPath(t),e),_.isEqual(i,this.expanded)||(this.expanded=i,this.debouncedApplyExpanded())},tu.prototype.filter=function(e){e&&2<e.length?this.item.filter(e):e||this.item.filter(null)},tu.prototype.focusItemByPath=function(e){this.getItemByPath(e).onClick()},tu.prototype.getItemByPath=function(e,t){t=this.getNodes(e,t);return t[t.length-1]},tu.prototype.getExpanded=function(){return this.item.expanded},tu.prototype.getFocusedPath=function(){return this.focusedPath},tu.prototype.getSchema=function(){return this.item.schema},tu.prototype.getValue=function(){return this.item.value},tu.prototype.initItem=function(e,t,i){return new(Containers.get(e))(e,t,this,i||{})},tu.prototype.onChange=function(e){this.subject.closed||this.subject.next(e)},tu.prototype.onFocus=function(e){QuickBase.ErrorTooltip.clearAll(!1),this.focusedPath=e||""},tu.prototype.pasteProperties=function(i,n){var t=this,e=this.itemsById[n];this.copiedItem&&this.copiedItem.setCopyState(!1),e&&rxjs.concat.apply(rxjs,this.getModifiers("paste",n).map(function(e){return rxjs.Observable.create(function(t){e.fn(i,n,function(e){t.next(e),t.complete()})})})).pipe(rxjs.operators.timeout(1e4)).subscribe({next:function(e){i=e},error:function(e){t.setEditorState(!0),console.error(e)},complete:function(){e.paste(i),t.setEditorState(!0),t.onChange(ChangeType.Value)}})},tu.prototype.register=function(e){var t=e.schema&&e.schema.id?e.schema.id+"."+e.key:e.path;this.itemsById[t]=e},tu.prototype.reloadHeaderTemplates=function(){this.item.reloadHeaderTemplates()},tu.prototype.remove=function(){this.item.remove(),QuickBase.ErrorTooltip.clearAll(!1),this.el.innerHTML="",this.subject.unsubscribe()},tu.prototype.setExpanded=function(e){this.expand(e,"root")},tu.prototype.setSchema=function(e){this.item.schema=e},tu.prototype.setValue=function(e){this.item.value=e},tu.prototype.setValueByPath=function(e,t){var i=this,n=e;this.setEditorState(!1),this.transform(e,t).subscribe({next:function(e){n=e},error:function(e){i.setEditorState(!0),console.error(e)},complete:function(){i.item.value=n,i.setEditorState(!0),i.onChange(ChangeType.Value)}})},tu.prototype.subscribe=function(e){this.subject.subscribe(e)},tu.prototype.startCopy=function(){$(window).trigger($.Event("keydown",{ctrlKey:!0,keyCode:67}))},tu.prototype.startPaste=function(){$(window).trigger($.Event("keydown",{ctrlKey:!0,keyCode:86}))},tu.prototype.setCopyPasteIcons=function(){this.setCopyIcon(!0),this.setPasteIcon(!0)},tu.prototype.setCopyIcon=function(e){e?this.item.el.classList.add("clipboardCopy"):this.item.el.classList.remove("clipboardCopy")},tu.prototype.setPasteIcon=function(e){e?this.item.el.classList.add("clipboardPaste"):this.item.el.classList.remove("clipboardPaste")},tu.prototype.applyExpanded=function(){this.item.expanded=this.expanded,this.onChange(ChangeType.Expanded)},tu.prototype.getAbsolutePath=function(e,t){var i=e.split(".");if("root"===i[0])return e;var n,a=this.getNodes(t);return(n=!(n=a[a.map(function(e){return e.schema.id||e.key}).indexOf(i[0])])?(e=a[a.length-1].children)?e[i[0]]:null:n)||1<a.length&&(n=(a=a[a.length-2].children)?a[i[0]]:null),t&&n?(i.shift(),__spreadArrays([n.path],i).join(".")):""},tu.prototype.getMask=function(){var e=document.createElement("div"),t=document.createElement("i");return e.className="mask",t.className="mask-icon fa fa-spinner fa-pulse",e.append(t),e},tu.prototype.getNodes=function(e,t){var t=this.getAbsolutePath(e,t),i=this.item,n=[i],t=t.split(".");return t.shift(),t.forEach(function(e){(i=i&&("object"===(i=i.schema.oneOf?i.childItem||i.children[i.selectedEditor]:i).schema.type||"array"===i.schema.type?i.children[e]:i))&&n.push(i)}),n},tu.prototype.getModifiers=function(t,e){var i=[];return this.getNodes(e).forEach(function(e){e.schema["_"+t]&&"function"==typeof e.schema["_"+t]&&i.push({fn:e.schema["_"+t],path:e.path})}),i.reverse()},tu.prototype.transform=function(i,o){var s,r=this,e=this.trimPath(o);return"root"===e?s=i:(s=this.item.value,LocalTools.setValue(s,e,i)),rxjs.concat.apply(rxjs,this.getModifiers("transform",o).map(function(e){var n=r.getItemByPath(e.path),t=n.path,a="root"===t?s:n.value;return o!==n.path&&(t=o.replace(n.path+".",""),LocalTools.setValue(a,t,i)),rxjs.Observable.create(function(i){e.fn(a,_.cloneDeep(n.schema),t,function(e,t){t&&(n.schema=t),_.isUndefined(e)||("root"===n.path?s=e:LocalTools.setValue(s,n.path.substring(5),e),i.next(s)),i.complete()})})})).pipe(rxjs.operators.startWith(s),rxjs.operators.timeout(1e4))},tu.prototype.trimPath=function(e){return"root."===e.substring(0,5)?e.substring(5):e},tu.prototype.registerHandlebarsHelpers=function(){Handlebars.registerHelper("valueProp",function(e){return"string"==typeof e?e:"object"==typeof e&&new Handlebars.SafeString(e.get("value"))})},tu.prototype.setEditorState=function(e){e?this.el.classList.remove("loading"):this.el.classList.add("loading")},tu.ChangeType=ChangeType,tu);function tu(e,t,i,n,a,o){this.el=n,this.el.classList.add("property-editor"),this.registerHandlebarsHelpers(),this.itemsById={},this.expanded=i||{},this.listeners={},this.debouncedApplyExpanded=_.debounce(this.applyExpanded.bind(this),50),this.api=a,this.schema=e,Editors.setViewStateEditors(o),this.subject=new rxjs.Subject(""),this.item=this.initItem(e,"root",{expanded:this.expanded}),this.el.append(this.item.render()),this.item.postRender(),this.el.append(this.getMask()),this.setValueByPath(t,"root")}!function(){var r=jQuery;r.widget("ui.dialogExtend",{version:"2.0.0",modes:{},options:{closable:!0,dblclick:!1,titlebar:!1,icons:{close:"ui-icon-closethick",restore:"ui-icon-newwin"},load:null,beforeRestore:null,restore:null},_create:function(){return this._state="normal",r(this.element[0]).data("ui-dialog")||r.error("jQuery.dialogExtend Error : Only jQuery UI Dialog element is accepted"),this._verifyOptions(),this._initStyles(),this._initButtons(),this._initTitleBar(),this._setState("normal"),this._on("load",function(e){return console.log("test",e)}),this._trigger("load")},_setState:function(e){return r(this.element[0]).removeClass("ui-dialog-"+this._state).addClass("ui-dialog-"+e),this._state=e},_verifyOptions:function(){var e,t,i;for(e in!this.options.dblclick||this.options.dblclick in this.modes||(r.error("jQuery.dialogExtend Error : Invalid <dblclick> value '"+this.options.dblclick+"'"),this.options.dblclick=!1),this.options.titlebar&&"none"!==(t=this.options.titlebar)&&"transparent"!==t&&(r.error("jQuery.dialogExtend Error : Invalid <titlebar> value '"+this.options.titlebar+"'"),this.options.titlebar=!1),i=[],this.modes)this["_verifyOptions_"+e]?i.push(this["_verifyOptions_"+e]()):i.push(void 0);return i},_initStyles:function(){var e,t;for(e in r(".dialog-extend-css").length||r('<style class="dialog-extend-css" type="text/css">.ui-dialog .ui-dialog-titlebar-buttonpane>a { float: right; }.ui-dialog .ui-dialog-titlebar-restore { width: 19px; height: 18px; }.ui-dialog .ui-dialog-titlebar-restore span { display: block; margin: 1px; }.ui-dialog .ui-dialog-titlebar-restore:hover,.ui-dialog .ui-dialog-titlebar-restore:focus { padding: 0; }.ui-dialog .ui-dialog-titlebar ::selection { background-color: transparent; }</style>').appendTo("body"),t=[],this.modes)t.push(this["_initStyles_"+e]());return t},_initButtons:function(){var e,t,i,n=this,a=r(this.element[0]).dialog("widget").find(".ui-dialog-titlebar"),o=r('<div class="ui-dialog-titlebar-buttonpane"></div>').appendTo(a);for(t in o.css({position:"absolute",top:"50%",right:"0.3em","margin-top":"-10px",height:"18px"}),a.find(".ui-dialog-titlebar-close").css({position:"relative",float:"right",top:"auto",right:"auto",margin:0}).find(".ui-icon").removeClass("ui-icon-closethick").addClass(this.options.icons.close).end().appendTo(o).end(),o.append('<a class="ui-dialog-titlebar-restore ui-corner-all ui-state-default" href="#"><span class="ui-icon '+this.options.icons.restore+'" title="restore">restore</span></a>').find(".ui-dialog-titlebar-restore").attr("role","button").mouseover(function(){return r(this).addClass("ui-state-hover")}).mouseout(function(){return r(this).removeClass("ui-state-hover")}).focus(function(){return r(this).addClass("ui-state-focus")}).blur(function(){return r(this).removeClass("ui-state-focus")}).end().find(".ui-dialog-titlebar-close").toggle(this.options.closable).end().find(".ui-dialog-titlebar-restore").hide().click(function(e){return e.preventDefault(),n.restore()}).end(),i=this.modes)e=i[t],this._initModuleButton(t,e);return a.dblclick(function(e){if(n.options.dblclick)return"normal"!==n._state?n.restore():n[n.options.dblclick]()}).select(function(){return!1})},_initModuleButton:function(t,e){var i=this;return r(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-buttonpane").append('<a class="ui-dialog-titlebar-'+t+' ui-corner-all ui-state-default" href="#" title="'+t+'"><span class="ui-icon '+this.options.icons[t]+'">'+t+"</span></a>").find(".ui-dialog-titlebar-"+t).attr("role","button").mouseover(function(){return r(this).addClass("ui-state-hover")}).mouseout(function(){return r(this).removeClass("ui-state-hover")}).focus(function(){return r(this).addClass("ui-state-focus")}).blur(function(){return r(this).removeClass("ui-state-focus")}).end().find(".ui-dialog-titlebar-"+t).toggle(this.options[e.option]).click(function(e){return e.preventDefault(),i[t]()}).end()},_initTitleBar:function(){var e;switch(this.options.titlebar){case!1:return 0;case"none":return r(this.element[0]).dialog("option","draggable")&&(e=r("<div />").addClass("ui-dialog-draggable-handle").css("cursor","move").height(5),r(this.element[0]).dialog("widget").prepend(e).draggable("option","handle",e)),r(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").find(".ui-dialog-title").html("&nbsp;").end().css({"background-color":"transparent","background-image":"none",border:0,position:"absolute",right:0,top:0,"z-index":9999}).end();case"transparent":return r(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").css({"background-color":"transparent","background-image":"none",border:0});default:return r.error("jQuery.dialogExtend Error : Invalid <titlebar> value '"+this.options.titlebar+"'")}},state:function(){return this._state},restore:function(){return this._trigger("beforeRestore"),this._restore(),this._toggleButtons(),this._trigger("restore")},_restore:function(){if("normal"!==this._state)return this["_restore_"+this._state](),this._setState("normal"),r(this.element[0]).dialog("widget").focus()},_saveSnapshot:function(){if("normal"===this._state)return this.original_config_resizable=r(this.element[0]).dialog("option","resizable"),this.original_config_draggable=r(this.element[0]).dialog("option","draggable"),this.original_size_height=r(this.element[0]).dialog("widget").outerHeight(),this.original_size_width=r(this.element[0]).dialog("option","width"),this.original_size_maxHeight=r(this.element[0]).dialog("option","maxHeight"),this.original_position_mode=r(this.element[0]).dialog("widget").css("position"),this.original_position_left=r(this.element[0]).dialog("widget").offset().left-r("body").scrollLeft(),this.original_position_top=r(this.element[0]).dialog("widget").offset().top-r("body").scrollTop(),this.original_titlebar_wrap=r(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").css("white-space")},_loadSnapshot:function(){return{config:{resizable:this.original_config_resizable,draggable:this.original_config_draggable},size:{height:this.original_size_height,width:this.original_size_width,maxHeight:this.original_size_maxHeight},position:{mode:this.original_position_mode,left:this.original_position_left,top:this.original_position_top},titlebar:{wrap:this.original_titlebar_wrap}}},_toggleButtons:function(e){var t,i,n,a,o,s=e||this._state;for(i in r(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-restore").toggle("normal"!==s).css({right:"1.4em"}).end(),n=this.modes)t=n[i],r(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-"+i).toggle(s!==t.state&&this.options[t.option]);for(i in o=[],a=this.modes)(t=a[i]).state===s?o.push(r(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-restore").insertAfter(r(this.element[0]).dialog("widget").find(".ui-dialog-titlebar-"+i)).end()):o.push(void 0);return o}})}.call(this),function(){var i=jQuery;i.extend(!0,i.ui.dialogExtend.prototype,{modes:{collapse:{option:"collapsable",state:"collapsed"}},options:{collapsable:!1,icons:{collapse:"ui-icon-triangle-1-s"},beforeCollapse:null,collapse:null},collapse:function(){var e,t=i(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").height()+15;return this._trigger("beforeCollapse"),"normal"!==this._state&&this._restore(),this._saveSnapshot(),e=i(this.element[0]).dialog("widget").position(),i(this.element[0]).dialog("option",{resizable:!1,height:t,maxHeight:t,position:[e.left-i(document).scrollLeft(),e.top-i(document).scrollTop()]}).on("dialogclose",this._collapse_restore).hide().dialog("widget").find(".ui-dialog-buttonpane:visible").hide().end().find(".ui-dialog-titlebar").css("white-space","nowrap").end().find(".ui-dialog-content"),this._setState("collapsed"),this._toggleButtons(),this._trigger("collapse")},_restore_collapsed:function(){var e=this._loadSnapshot();return i(this.element[0]).show().dialog("widget").find(".ui-dialog-buttonpane:hidden").show().end().find(".ui-dialog-titlebar").css("white-space",e.titlebar.wrap).end().find(".ui-dialog-content").dialog("option",{resizable:e.config.resizable,height:e.size.height,maxHeight:e.size.maxHeight}).off("dialogclose",this._collapse_restore)},_initStyles_collapse:function(){if(!i(".dialog-extend-collapse-css").length)return i('<style class="dialog-extend-collapse-css" type="text/css">.ui-dialog .ui-dialog-titlebar-collapse { width: 19px; height: 18px; }.ui-dialog .ui-dialog-titlebar-collapse span { display: block; margin: 1px; }.ui-dialog .ui-dialog-titlebar-collapse:hover,.ui-dialog .ui-dialog-titlebar-collapse:focus { padding: 0; }</style>').appendTo("body")},_collapse_restore:function(){return i(this).dialogExtend("restore")}})}.call(this),function(){var i=jQuery;i.extend(!0,i.ui.dialogExtend.prototype,{modes:{maximize:{option:"maximizable",state:"maximized"}},options:{maximizable:!1,icons:{maximize:"ui-icon-extlink"},beforeMaximize:null,maximize:null},maximize:function(){var e=i(window).height()-11,t=i(window).width()-11;return this._trigger("beforeMaximize"),"normal"!==this._state&&this._restore(),this._saveSnapshot(),i(this.element[0]).dialog("option","draggable")&&i(this.element[0]).dialog("widget").draggable("option","handle",null).find(".ui-dialog-draggable-handle").css("cursor","text").end(),i(this.element[0]).dialog("widget").css("position","fixed").find(".ui-dialog-content").show().dialog("widget").find(".ui-dialog-buttonpane").show().end().find(".ui-dialog-content").dialog("option",{resizable:!1,draggable:!1,height:e,width:t,position:{my:"left top",at:"left top",of:window}}),this._setState("maximized"),this._toggleButtons(),this._trigger("maximize")},_restore_maximized:function(){var e=this._loadSnapshot();if(i(this.element[0]).dialog("widget").css("position",e.position.mode).find(".ui-dialog-titlebar").css("white-space",e.titlebar.wrap).end().find(".ui-dialog-content").dialog("option",{resizable:e.config.resizable,draggable:e.config.draggable,height:e.size.height,width:e.size.width,maxHeight:e.size.maxHeight,position:{my:"left top",at:"left+"+e.position.left+" top+"+e.position.top,of:window}}),i(this.element[0]).dialog("option","draggable"))return i(this.element[0]).dialog("widget").draggable("option","handle",i(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle").length?i(this.element[0]).dialog("widget").find(".ui-dialog-draggable-handle"):".ui-dialog-titlebar").find(".ui-dialog-draggable-handle").css("cursor","move")},_initStyles_maximize:function(){if(!i(".dialog-extend-maximize-css").length)return i('<style class="dialog-extend-maximize-css" type="text/css">.ui-dialog .ui-dialog-titlebar-maximize { width: 19px; height: 18px; }.ui-dialog .ui-dialog-titlebar-maximize span { display: block; margin: 1px; }.ui-dialog .ui-dialog-titlebar-maximize:hover,.ui-dialog .ui-dialog-titlebar-maximize:focus { padding: 0; }</style>').appendTo("body")}})}.call(this),function(){var i=jQuery;i.extend(!0,i.ui.dialogExtend.prototype,{modes:{minimize:{option:"minimizable",state:"minimized"}},options:{minimizable:!1,minimizeLocation:"left",icons:{minimize:"ui-icon-minus"},beforeMinimize:null,minimize:null},minimize:function(){var e,t;return this._trigger("beforeMinimize"),"normal"!==this._state&&this._restore(),i("#dialog-extend-fixed-container").length?t=i("#dialog-extend-fixed-container"):(t=i('<div id="dialog-extend-fixed-container"></div>').appendTo("body")).css({position:"fixed",bottom:1,left:1,right:1,"z-index":9999}),this._toggleButtons("minimized"),e=i(this.element[0]).dialog("widget").clone().children().remove().end(),i(this.element[0]).dialog("widget").find(".ui-dialog-titlebar").clone(!0,!0).appendTo(e),e.css({float:this.options.minimizeLocation,margin:1}),t.append(e),i(this.element[0]).data("dialog-extend-minimize-controls",e),i(this.element[0]).dialog("option","draggable")&&e.removeClass("ui-draggable"),e.css({height:"auto",width:200,position:"static"}),i(this.element[0]).on("dialogbeforeclose",this._minimize_restoreOnClose).dialog("widget").hide(),this._setState("minimized"),this._trigger("minimize")},_restore_minimized:function(){return i(this.element[0]).dialog("widget").show(),i(this.element[0]).off("dialogbeforeclose",this._minimize_restoreOnClose),i(this.element[0]).data("dialog-extend-minimize-controls").remove(),i(this.element[0]).removeData("dialog-extend-minimize-controls")},_initStyles_minimize:function(){if(!i(".dialog-extend-minimize-css").length)return i('<style class="dialog-extend-minimize-css" type="text/css">.ui-dialog .ui-dialog-titlebar-minimize { width: 19px; height: 18px; }.ui-dialog .ui-dialog-titlebar-minimize span { display: block; margin: 1px; }.ui-dialog .ui-dialog-titlebar-minimize:hover,.ui-dialog .ui-dialog-titlebar-minimize:focus { padding: 0; }</style>').appendTo("body")},_verifyOptions_minimize:function(){var e;if(!this.options.minimizeLocation||"left"!==(e=this.options.minimizeLocation)&&"right"!==e)return i.error("jQuery.dialogExtend Error : Invalid <minimizeLocation> value '"+this.options.minimizeLocation+"'"),this.options.minimizeLocation="left"},_minimize_restoreOnClose:function(){return i(this).dialogExtend("restore")}})}.call(this);var BulkColumnEditorDialog=Backbone.View.extend({className:"dlgBulkColumnEditorDialog",initialize:function(e){var i=this;this.editor=(e=e||{}).editor,i.$el.html(T.BulkColumnEditorDialog()),i.initControls(),i.initRenderedDialogOnce=_.once(i.initRenderedDialog),this.$dialog=i.$el.dialog(_.extend({appendTo:e.container,title:t("Multi Column Editor "),dialogClass:"quick-dash",resizable:!0,height:540,width:600,minWidth:600,modal:!0,autoOpen:!1,buttons:[{text:t("Apply"),disabled:!0,click:$.proxy(i.applyChanges,i),icons:{primary:"fa fa-check-square-o"}},{text:t("Close"),click:$.proxy(i.onCloseButtonClick,i),icons:{primary:"fa fa-times"}}],open:function(){i.initRenderedDialogOnce()}},e))},applyChanges:function(){var e=this,i=e.bulkEditor.value,n=e.editor.getValue(),a=!1,o=$.map(e.$lstProperties.find("> .ui-selected"),function(e){return $(e).data("schemapath").replace("root.","")});_.each(e.$lstColumns.find(">li"),function(e,t){$(e).is(".ui-selected")&&_.each(o,function(e){i[t][e]!==n[e]&&(i[t][e]=n[e],a=!0)})}),a&&e.bulkEditor.setValueByPath(i,e.bulkEditor.path)},initControls:function(){this.$pnlPropertyEditor=this.$(".pnlPropertyEditor"),this.$propertiesPanel=this.$(".properties-panel"),this.$lstColumns=this.$(".lstColumns"),this.$pnlInfo=this.$(".pnlInfo")},initRenderedDialog:function(){$('<i class="fa fa-columns" />').insertBefore(this.$el.parent().find(".ui-dialog-title")),this.$btnApply=this.$el.next().find("button:nth-of-type(1)")},checkSelectableStatuses:function(){var e=!0,t=this.$lstColumns.find(">.ui-selected").length,i=this.$lstProperties?this.$lstProperties.find(">.ui-selected").length:0;0===t&&0===i?this.$pnlInfo.html("Use the mouse to select items, individually or in a group.<br/> Hold down the CTRL key to make multiple non-adjacent selections."):0===t?this.$pnlInfo.html(i+(1===i?" property":" properties")+" selected. Please select columns to format.<br/>Hold down the CTRL key to make multiple non-adjacent selections."):0==i?this.$pnlInfo.html(t+(1===t?" column":" columns")+" selected. Please select properties to be changed.<br/>Hold down the CTRL key to make multiple non-adjacent selections."):(this.$pnlInfo.html("Click 'Apply' to change format for selected columns.<br/>Changes ("+i+(1===i?" property":" properties")+") will be applied to "+t+(1===t?" column.":" columns.")),e=!1),this.$btnApply.button({disabled:e})},onCloseButtonClick:function(){this.$el.dialog("close")},open:function(){this.$propertiesPanel.removeClass("kx-light"),"kx-light"===$.cookie("dashboard-theme")&&this.$propertiesPanel.addClass("kx-light"),this.$el.dialog("open"),this.checkSelectableStatuses()},remove:function(){self.$lstColumns.is(":ui-selectable")&&self.$lstColumns.selectable("destroy"),this.$dialog.dialog("destroy"),Backbone.View.prototype.remove.call(this)},setEditor:function(e){var t,i=this;i.bulkEditor=e,i.$lstColumns.is(":ui-selectable")&&i.$lstColumns.selectable("destroy"),i.$lstColumns.empty(),t=i.bulkEditor.value,i.$lstColumns.append(_.map(t,function(e){var t=document.createElement("li");return t.textContent=_.get(e.DisplayName,"attributes.value",e.DisplayName)||_.get(e.Field,"attributes.value",e.Field),t})),i.$lstColumns.selectable({stop:function(){i.checkSelectableStatuses()}}),(t=_.cloneDeep(i.bulkEditor.getChildSchema())).headerTemplate=null,t.title="Properties",t.options.disable_collapse=!0,t.options.collapsed=!1,t.properties=_.omit(t.properties,"Field","DisplayName"),i.$pnlPropertyEditor.empty(),i.editor=new PropertyEditor(t,null,null,i.$pnlPropertyEditor[0],e.root.api),i.$lstProperties=i.$pnlPropertyEditor.find("> .container > .editor"),i.$lstProperties.selectable({filter:">.container",stop:function(){i.checkSelectableStatuses()}})}}),nx,rx,vx,yx,Hx,Lx,Mx,Ox,Px,Rx,Sx,Xx,Yx,Zx,$x,_x,ay,cy,dy,ey,gy,sx;function zx(e,t){e=ey(e),rx(t).data("colorpicker").fields.eq(1).val(e.r).end().eq(2).val(e.g).end().eq(3).val(e.b).end()}function Ax(e,t){rx(t).data("colorpicker").fields.eq(4).val(e.h).end().eq(5).val(e.s).end().eq(6).val(e.b).end()}function Bx(e,t){rx(t).data("colorpicker").fields.eq(0).val(gy(e)).end()}function Cx(e,t){rx(t).data("colorpicker").selector.css("backgroundColor","#"+gy({h:e.h,s:100,b:100})),rx(t).data("colorpicker").selectorIndic.css({left:parseInt(200*e.s/100,10),top:parseInt(200*(100-e.b)/100,10)})}function Dx(e,t){rx(t).data("colorpicker").hue.css("top",parseInt(200-200*e.h/360,10))}function Ex(e,t){rx(t).data("colorpicker").currentColor.css("backgroundColor","#"+gy(e))}function Fx(e,t){rx(t).data("colorpicker").newColor.css("backgroundColor","#"+gy(e))}function Gx(e){if(e=e.charCode||e.keyCode||-1,vx<e&&e<=90||32==e)return!1;!0===rx(this).parent().parent().data("colorpicker").livePreview&&Hx.apply(this)}function Ix(e){rx(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus")}function Jx(){vx=0<this.parentNode.className.indexOf("_hex")?70:65,rx(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),rx(this).parent().addClass("colorpicker_focus")}function Kx(e){var t=rx(this).parent().find("input").focus(),t={el:rx(this).parent().addClass("colorpicker_slider"),max:0<this.parentNode.className.indexOf("_hsb_h")?360:0<this.parentNode.className.indexOf("_hsb")?100:255,y:e.pageY,field:t,val:parseInt(t.val(),10),preview:rx(this).parent().parent().data("colorpicker").livePreview};rx(document).bind("mouseup",t,Mx),rx(document).bind("mousemove",t,Lx)}function Nx(e){var t={cal:rx(this).parent(),y:rx(this).offset().top};t.preview=t.cal.data("colorpicker").livePreview,rx(document).bind("mouseup",t,Px),rx(document).bind("mousemove",t,Ox)}function Qx(e){var t={cal:rx(this).parent(),pos:rx(this).offset()};t.preview=t.cal.data("colorpicker").livePreview,rx(document).bind("mouseup",t,Sx),rx(document).bind("mousemove",t,Rx)}function Tx(e){rx(this).addClass("colorpicker_focus")}function Ux(e){rx(this).removeClass("colorpicker_focus")}function Vx(e){var t=rx(this).parent(),i=t.data("colorpicker").color;t.data("colorpicker").origColor=i,Ex(i,t.get(0)),t.data("colorpicker").onSubmit(i,gy(i),ey(i),t.data("colorpicker").el)}function Wx(e){var t=rx("#"+rx(this).data("colorpickerId"));t.data("colorpicker").onBeforeShow.apply(this,[t.get(0)]);var i=rx(this).offset(),n=Zx(),a=i.top+this.offsetHeight,i=i.left;return a+176>n.t+n.h&&(a-=this.offsetHeight+176),i+356>n.l+n.w&&(i-=356),t.css({left:i+"px",top:a+"px"}),0!=t.data("colorpicker").onShow.apply(this,[t.get(0)])&&t.show(),rx(document).bind("mousedown",{cal:t},Xx),!1}function hy(){var e=rx(this).parent(),t=e.data("colorpicker").origColor;e.data("colorpicker").color=t,zx(t,e.get(0)),Bx(t,e.get(0)),Ax(t,e.get(0)),Cx(t,e.get(0)),Dx(t,e.get(0)),Fx(t,e.get(0))}function ctrlPtComparator(e,t){return e.position-t.position}function bind(e,t){return"function"==typeof e.bind?e.bind(t):function(){e.apply(t,arguments)}}nx=jQuery,nx.fn.extend({collapsiblePanel:function(){nx(this).each(function(){var e=nx(this).find(".ui-expander").first(),t=nx(this).find(".ui-widget-header").first(),i=nx(this).find(".ui-widget-content").first();i.is(":visible")?e.removeClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-e"):e.removeClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-s"),t.click(function(){i.slideToggle(500,function(){console.log(i.is(":visible")),i.is(":visible")?e.removeClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-e"):e.removeClass("ui-icon-triangle-1-e ui-icon-triangle-1-s").addClass("ui-icon-triangle-1-s")})})})}}),rx=jQuery,yx={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!(vx=65)},Hx=function(e){var t,i=rx(this).parent().parent();0<this.parentNode.className.indexOf("_hex")?i.data("colorpicker").color=t=cy(ay(this.value)):0<this.parentNode.className.indexOf("_hsb")?i.data("colorpicker").color=t=$x({h:parseInt(i.data("colorpicker").fields.eq(4).val(),10),s:parseInt(i.data("colorpicker").fields.eq(5).val(),10),b:parseInt(i.data("colorpicker").fields.eq(6).val(),10)}):i.data("colorpicker").color=t=dy(_x({r:parseInt(i.data("colorpicker").fields.eq(1).val(),10),g:parseInt(i.data("colorpicker").fields.eq(2).val(),10),b:parseInt(i.data("colorpicker").fields.eq(3).val(),10)})),e&&(zx(t,i.get(0)),Bx(t,i.get(0)),Ax(t,i.get(0))),Cx(t,i.get(0)),Dx(t,i.get(0)),Fx(t,i.get(0)),i.data("colorpicker").onChange.apply(i,[t,gy(t),ey(t)])},Lx=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10)))),e.data.preview&&Hx.apply(e.data.field.get(0),[!0]),!1},Mx=function(e){return Hx.apply(e.data.field.get(0),[!0]),e.data.el.removeClass("colorpicker_slider").find("input").focus(),rx(document).unbind("mouseup",Mx),rx(document).unbind("mousemove",Lx),!1},Ox=function(e){return Hx.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(200-Math.max(0,Math.min(200,e.pageY-e.data.y)))/200,10)).get(0),[e.data.preview]),!1},Px=function(e){return Ox(e),zx(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),Bx(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),rx(document).unbind("mouseup",Px),rx(document).unbind("mousemove",Ox),!1},Rx=function(e){return Hx.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(200-Math.max(0,Math.min(200,e.pageY-e.data.pos.top)))/200,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(200,e.pageX-e.data.pos.left))/200,10)).get(0),[e.data.preview]),!1},Sx=function(e){return Rx(e),zx(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),Bx(e.data.cal.data("colorpicker").color,e.data.cal.get(0)),rx(document).unbind("mouseup",Sx),rx(document).unbind("mousemove",Rx),!1},Xx=function(e){Yx(e.data.cal.get(0),e.target,e.data.cal.get(0))||(0!=e.data.cal.data("colorpicker").onHide.apply(this,[e.data.cal.get(0)])&&e.data.cal.hide(),rx(document).unbind("mousedown",Xx))},Yx=function(e,t,i){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(var n=t.parentNode;n&&n!=i;){if(n==e)return!0;n=n.parentNode}return!1},Zx=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement:document.body).scrollLeft,t:window.pageYOffset||(e?document.documentElement:document.body).scrollTop,w:window.innerWidth||(e?document.documentElement:document.body).clientWidth,h:window.innerHeight||(e?document.documentElement:document.body).clientHeight}},$x=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},_x=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},ay=function(e){var t=6-e.length;if(0<t){for(var i=[],n=0;n<t;n++)i.push("0");i.push(e),e=i.join("")}return e},cy=function(e){return dy((e=e,{r:(e=parseInt(-1<e.indexOf("#")?e.substring(1):e,16))>>16,g:(65280&e)>>8,b:255&e}))},dy=function(e){var t={h:0,s:0,b:0},i=Math.min(e.r,e.g,e.b),n=Math.max(e.r,e.g,e.b),i=n-i;return t.b=n,t.s=0!=n?255*i/n:0,0!=t.s?e.r==n?t.h=(e.g-e.b)/i:e.g==n?t.h=2+(e.b-e.r)/i:t.h=4+(e.r-e.g)/i:t.h=-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},ey=function(e){var t={},i=Math.round(e.h),n=Math.round(255*e.s/100),a=Math.round(255*e.b/100);return 0==n?t.r=t.g=t.b=a:(a=i%60*((e=a)-(n=(255-n)*a/255))/60,(i=360==i?0:i)<60?(t.r=e,t.b=n,t.g=n+a):i<120?(t.g=e,t.b=n,t.r=e-a):i<180?(t.g=e,t.r=n,t.b=n+a):i<240?(t.b=e,t.r=n,t.g=e-a):i<300?(t.b=e,t.g=n,t.r=n+a):i<360?(t.r=e,t.g=n,t.b=e-a):(t.r=0,t.g=0,t.b=0)),{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},gy=function(e){return e=ey(e),i=[e.r.toString(16),e.g.toString(16),e.b.toString(16)],rx.each(i,function(e,t){1==t.length&&(i[e]="0"+t)}),i.join("");var i},sx={init:function(i){if("string"==typeof(i=rx.extend({},yx,i||{})).color)i.color=cy(i.color);else if(null!=i.color.r&&null!=i.color.g&&null!=i.color.b)i.color=dy(i.color);else{if(null==i.color.h||null==i.color.s||null==i.color.b)return this;i.color=$x(i.color)}return this.each(function(){var e,t;rx(this).data("colorpickerId")||((e=rx.extend({},i)).origColor=i.color,t="collorpicker_"+parseInt(1e3*Math.random()),rx(this).data("colorpickerId",t),t=rx('<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>').attr("id",t),e.flat?t.appendTo(this).show():t.appendTo(document.body),e.fields=t.find("input").bind("keyup",Gx).bind("change",Hx).bind("blur",Ix).bind("focus",Jx),t.find("span").bind("mousedown",Kx).end().find(">div.colorpicker_current_color").bind("click",hy),e.selector=t.find("div.colorpicker_color").bind("mousedown",Qx),e.selectorIndic=e.selector.find("div div"),e.el=this,e.hue=t.find("div.colorpicker_hue div"),t.find("div.colorpicker_hue").bind("mousedown",Nx),e.newColor=t.find("div.colorpicker_new_color"),e.currentColor=t.find("div.colorpicker_current_color"),t.data("colorpicker",e),t.find("div.colorpicker_submit").bind("mouseenter",Tx).bind("mouseleave",Ux).bind("click",Vx),zx(e.color,t.get(0)),Ax(e.color,t.get(0)),Bx(e.color,t.get(0)),Dx(e.color,t.get(0)),Cx(e.color,t.get(0)),Ex(e.color,t.get(0)),Fx(e.color,t.get(0)),e.flat?t.css({position:"relative",display:"block"}):rx(this).bind(e.eventName,Wx))})},showPicker:function(){return this.each(function(){rx(this).data("colorpickerId")&&Wx.apply(this)})},hidePicker:function(){return this.each(function(){rx(this).data("colorpickerId")&&rx("#"+rx(this).data("colorpickerId")).hide()})},setColor:function(t){if("string"==typeof t)t=cy(t);else if(null!=t.r&&null!=t.g&&null!=t.b)t=dy(t);else{if(null==t.h||null==t.s||null==t.b)return this;t=$x(t)}return this.each(function(){var e;rx(this).data("colorpickerId")&&((e=rx("#"+rx(this).data("colorpickerId"))).data("colorpicker").color=t,e.data("colorpicker").origColor=t,zx(t,e.get(0)),Ax(t,e.get(0)),Bx(t,e.get(0)),Dx(t,e.get(0)),Cx(t,e.get(0)),Ex(t,e.get(0)),Fx(t,e.get(0)))})}},rx.fn.extend({ColorPicker:sx.init,ColorPickerHide:sx.hidePicker,ColorPickerShow:sx.showPicker,ColorPickerSetColor:sx.setColor}),$.event.special.destroyed||($.event.special.destroyed={remove:function(e){e.handler&&e.handler()}});var browserPrefix="",agent=window.navigator.userAgent;function GradientSelection(e,t){this.$el=e,this.$el.css("position","relative"),this.opts=t;var i=$("<canvas class='gradientPicker-preview'></canvas>");this.$el.append(i);e=i[0];e.width=e.clientWidth,e.height=e.clientHeight,this.g2d=e.getContext("2d");e=$("<div class='gradientPicker-ctrlPts'></div>");this.$el.append(e),this.$ctrlPtContainer=e,this.updatePreview=bind(this.updatePreview,this),this.controlPoints=[],this.ctrlPtConfig=new ControlPtConfig(this.$el,t);for(var n=0;n<t.controlPoints.length;++n){var a=this.createCtrlPt(t.controlPoints[n]);this.controlPoints.push(a)}this.docClicked=bind(this.docClicked,this),this.destroyed=bind(this.destroyed,this),$(document).bind("click",this.docClicked),this.$el.bind("destroyed",this.destroyed),this.previewClicked=bind(this.previewClicked,this),i.click(this.previewClicked),this.updatePreview()}function ControlPoint(e,t,i,n,a){var o;this.$el=$("<div class='gradientPicker-ctrlPt'></div>"),e.append(this.$el),this.$parentEl=e,this.configView=a,"string"==typeof t?(t=t.split(" "),this.position=parseFloat(t[1])/100,this.color=t[0]):(this.position=t.position,this.color=t.color),this.listener=n,this.outerWidth=this.$el.outerWidth(),this.$el.css("background-color",this.color),"horizontal"==i?(o=(e.width()-this.$el.outerWidth())*this.position,this.$el.css("left",o)):(o=(e.height()-this.$el.outerHeight())*this.position,this.$el.css("top",o)),this.drag=bind(this.drag,this),this.stop=bind(this.stop,this),this.clicked=bind(this.clicked,this),this.colorChanged=bind(this.colorChanged,this),this.$el.draggable({axis:"horizontal"==i?"x":"y",drag:this.drag,stop:this.stop,containment:e}),this.$el.css("position","absolute"),this.$el.click(this.clicked)}function ControlPtConfig(e,t){var i=this;this.$el=$('<div class="gradientPicker-ptConfig" style="visibility: hidden"></div>'),e.append(this.$el);var n=$('<div class="color-chooser"></div>');this.$el.append(n);e=$("<div class='gradientPicker-close'></div>");this.$el.append(e),this.$txtPerc=$("<input class='gradientPicker-locationPerc' type='text'/>").appendTo(this.$el),this.$txtPerc.spinner({min:0,max:100,numberFormat:"n",spin:function(e,t){_.defer(function(){i.onValueChange()})}}),this.$txtPerc.on("input",$.proxy(i.onValueChange,i)),this.$txtPerc.parent().click(function(e){e.stopPropagation()}),this.colorChanged=bind(this.colorChanged,this),this.removeClicked=bind(this.removeClicked,this),n.ColorPicker({onChange:this.colorChanged}),this.$cpicker=n,this.opts=t,this.visible=!1,e.click(this.removeClicked)}browserPrefix=0<=agent.indexOf("WebKit")?"-webkit-":0<=agent.indexOf("Mozilla")?"-moz-":0<=agent.indexOf("Microsoft")?"-ms-":"",GradientSelection.prototype={docClicked:function(){this.ctrlPtConfig.hide()},createCtrlPt:function(e){return new ControlPoint(this.$ctrlPtContainer,e,this.opts.orientation,this,this.ctrlPtConfig)},destroyed:function(){$(document).unbind("click",this.docClicked)},updateOptions:function(e){$.extend(this.opts,e),this.updatePreview()},updatePreview:function(){var e,t=[];if(this.controlPoints.sort(ctrlPtComparator),"horizontal"==this.opts.orientation)for(var i=this.g2d.createLinearGradient(0,0,this.g2d.canvas.width,0),n=0;n<this.controlPoints.length;++n){var a=this.controlPoints[n];i.addColorStop(a.position,a.color),t.push({position:a.position,color:a.color})}this.g2d.fillStyle=i,this.g2d.fillRect(0,0,this.g2d.canvas.width,this.g2d.canvas.height),this.opts.generateStyles&&(e=this._generatePreviewStyles()),this.opts.change(t,e)},removeControlPoint:function(e){var t=this.controlPoints.indexOf(e);-1!=t&&(this.controlPoints.splice(t,1),e.$el.remove())},previewClicked:function(e){var t=$(e.target).offset(),i=e.pageX-t.left,t=e.pageY-t.top,t=this.g2d.getImageData(i,t,1,1),t="rgb("+t.data[0]+","+t.data[1]+","+t.data[2]+")",t=this.createCtrlPt({position:i/this.g2d.canvas.width,color:t});this.controlPoints.push(t),this.controlPoints.sort(ctrlPtComparator)},_generatePreviewStyles:function(){for(var e=this.opts.type+"-gradient("+("linear"==this.opts.type?this.opts.fillDirection+", ":""),t=!0,i=0;i<this.controlPoints.length;++i){var n=this.controlPoints[i];t?t=!1:e+=", ",e+=n.color+" "+(100*n.position|0)+"%"}return[e+=")",browserPrefix+e]}},ControlPoint.prototype={drag:function(e,t){t=t.position.left;this.position=t/(this.$parentEl.width()-this.outerWidth),this.listener.updatePreview()},stop:function(e,t){this.listener.updatePreview(),this.configView.show(this.$el.position(),this.color,this)},clicked:function(e){return this.configView.show(this.$el.position(),this.color,this),e.stopPropagation(),!1},colorChanged:function(e){this.color=e,this.$el.css("background-color",this.color),this.listener.updatePreview()},removeClicked:function(){this.listener.removeControlPoint(this),this.listener.updatePreview()}},ControlPtConfig.prototype={onValueChange:function(){var e=this,t=e.$txtPerc.spinner("value"),t=parseInt(t)/100;$.isNumeric(t)&&(e.listener.position=t,t=(e.listener.$parentEl.width()-e.listener.$el.outerWidth())*e.listener.position,e.listener.$el.css("left",t),e.listener.listener.updatePreview())},show:function(e,t,i){var n=Math.round(100*i.position);this.visible=!0,this.listener=i,this.$txtPerc.spinner("value",n),this.$el.css("visibility","visible"),this.$cpicker.ColorPickerSetColor(t),this.$cpicker.css("background-color",t),"horizontal"===this.opts.orientation?this.$el.css("left",e.left):this.$el.css("top",e.top)},hide:function(){this.visible&&(this.$el.css("visibility","hidden"),this.visible=!1)},colorChanged:function(e,t,i){this.listener.colorChanged(t="#"+t),this.$cpicker.css("background-color",t)},removeClicked:function(){this.listener.removeClicked(),this.hide()}};var methods={init:function(i){i=$.extend({controlPoints:["#FFF 0%","#000 100%"],orientation:"horizontal",type:"linear",fillDirection:"left",generateStyles:!0,change:function(){}},i),this.each(function(){var e=$(this),t=new GradientSelection(e,i);e.data("gradientPicker-sel",t)})},update:function(t){this.each(function(){var e=$(this).data("gradientPicker-sel");null!=e&&e.updateOptions(t)})}};$.fn.gradientPicker=function(e,t){"string"==typeof e&&"init"!==e?methods[e].call(this,t):methods.init.call(this,t=e)};var ColorPickerDialog=Backbone.View.extend({initialize:function(e){var i=this,n=[];i.options=e,i.showGradient="true"===e.values,i.noColor="true"===e.noColor,i.path=void 0===i.options.path?"none":i.options.path,i.$el.html(T.ColorPickerDialog()),i.$el.tabs({activate:function(){1===i.$el.tabs("option","active")?(i.loadGradient(),i.gradient=!0):i.gradient=!1}}),i.showGradient?i.height=333:i.height=293,n.push({text:"OK",click:$.proxy(i.onOKButtonClick,i),type:"submit"}),i.noColor&&n.push({text:"No Color",click:$.proxy(i.onNoColorClick,i),type:"submit"}),n.push({text:"Cancel",click:$.proxy(i.onCancelButtonClick,i),type:"submit"}),i.$el.dialog(_.extend({appendTo:e.container,dialogClass:"quick-dash color-picker-dialog",title:t("Select Background Color ..."),resizable:!0,height:i.height,width:458,minWidth:i.height,modal:!0,autoOpen:!0,buttons:n,close:function(){},open:function(){i.initColorPicker(),i.initOverlayClick(),i.$el.dialog("option",{position:{my:"left top",at:"left bottom",collision:"flip flip",of:$(i.options.target)}}),i.showGradient?i.$el.find(".ui-tabs-nav").show():i.$el.find(".ui-tabs-nav").hide()}},e))},colorChanged:function(){},cssToControlPoint:function(e){var t=[],i=e.split("(");return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(this.path)||"none"===e||i.length<2?t=["black 0%","grey 50%","black 100%"]:(0<=i[0].indexOf("linear")?this.$el.find(".colorPickerType").val("linear"):this.$el.find(".colorPickerType").val("radial"),this.$el.find(".colorPickerType").selectmenu("refresh"),_.each(i[1].split(","),function(e){0<=_.indexOf(e,"%")&&t.push(e.toString().trim().replace(")",""))})),t},initColorPicker:function(){var e=this,t=this.$el.find(".solid_color"),i="ff00ff";/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(this.path)&&(i=this.path.replace("#","")),t.ColorPicker({flat:!0,onChange:function(){e.colorChanged()}}),this.$el.find(".colorpicker_hex").change(function(){e.colorChanged()}),this.$el.find(".colorpicker_color div").dblclick(function(){e.onOKButtonClick()}),this.$cpicker=t,this.$cpicker.ColorPickerSetColor(i),this.$cpicker.css("background-color",i)},initGradient:function(){var i,n=this,a=n.$el.find(".left"),o=n.$el.find(".cssGradient"),e=n.$el.find(".colorPickerType"),t=n.$el.find(".colorPickerDirection");n.$el.find(".grad_ex").html(""),n.$el.find("#ex1").gradientPicker({change:function(e,t){for(i=0;i<t.length;i+=1)a.css("background-image",t[i]),o.val(t[i]),n.path=t[i],n.colorChanged()},fillDirection:t.val(),type:e.val(),controlPoints:n.cssToControlPoint(n.path)}),n.setFillDirection(n.path)},initOverlayClick:function(){var e=this;$(this.$el.parent().parent().find(".ui-widget-overlay")).on("click",function(){e.onCancelButtonClick(),$(e.$el.parent().parent().find(".ui-widget-overlay")).off("click")})},loadGradient:function(){var t=this,e=t.$el.find(".colorPickerType"),i=t.$el.find(".colorPickerDirection");e.selectmenu({width:90}).on("selectmenuchange",function(){var e=t.$el.find(".colorPickerDirection").next(".ui-selectmenu-button");"linear"===$(this).val()?e.show():e.hide(),t.initGradient()}),i.selectmenu({width:90}).on("selectmenuchange",function(){t.initGradient()}),t.setFillDirection(t.path),t.initGradient()},onCancelButtonClick:function(){this.$el.dialog("close"),this.remove()},onNoColorClick:function(){var e=this.options.selectCallback;e&&e(""),this.$el.dialog("close"),this.remove()},onOKButtonClick:function(){var e=this.options.selectCallback;this.gradient||(this.path="#"+this.$cpicker.find(".colorpicker_hex input").val()),e&&e(this.path),this.$el.dialog("close"),this.remove()},onSelectButtonClick:function(){this.options.model.tooltips=this.result,this.options.editor.setValue(this.options.model),this.onCancelButtonClick()},setFillDirection:function(e){var i="left",t=e.split("(");!/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(this.path)&&"none"!==e&&1<t.length?_.each(t[1].split(","),function(e,t){-1===_.indexOf(e,"%")&&0===t&&(i=e.toString().trim())}):this.cssControls="linear-gradient("+i+", black 0%, grey 50%, black 100%)",this.$el.find(".colorPickerDirection").val(i),this.$el.find(".colorPickerDirection").selectmenu("refresh")}}),ColSelectorDialog=Backbone.View.extend({className:"dropdown-dialog",initialize:function(e){var i=this;i.options=e,i.path=void 0,this.$el.html(T.DropDownSelectableDialog()),this.$el.find(".pnlCustom").toggle(this.options.isUserDefined),this.options.isUserDefined&&this.$el.find(".customDropwdownInput").val(e.selected||""),i.$el.dialog(_.extend({appendTo:this.options.container,dialogClass:"quick-dash dd-Panel",title:t("Please select a column"),resizable:!0,width:280,modal:!0,autoOpen:!0,close:function(){i.remove()},open:function(){var t="";i.$el.closest(".ui-dialog").siblings(".ui-widget-overlay:last").on("click",function(){i.closeDialog()}),_.each(i.options.values,function(e){e===i.options.selected?(t=t+'<li class="ui-widget-content ui-selected">'+e+"</li>",i.result=e):t=t+'<li class="ui-widget-content">'+e+"</li>"}),_.indexOf(i.options.values,i.options.selected)<0&&i.options.selected&&(t=t+'<li class="ui-widget-content ui-selected">'+i.options.selected+"</li>"),i.$el.find(".tp-selectable").append(t),i.initSelect(),i.$el.find(".customDropwdownSelect").button().click(_.bind(i.onCustomColumnAdded,i)),i.$el.find(".customDropwdownInput").on("keydown",function(e){13===e.keyCode&&i.onCustomColumnAdded()}),i.$el.dialog("option",{position:{my:"left top",at:"left bottom",collision:"flip flip",of:$(i.options.target)}})}},this.options))},initSelect:function(){var t=this;t.$el.find(".tp-selectable").selectable({selected:function(){t.$el.find(".ui-selected",this).addClass("ui-selected").siblings().removeClass("ui-selected"),t.$el.find(".ui-selected",this).each(function(){t.result=this.textContent;var e=t.options.selectCallback;e&&e(this.textContent)}),t.closeDialog()}})},closeDialog:function(){this.$el.closest(".ui-dialog").siblings(".ui-widget-overlay:last").off("click"),this.$el.dialog("close")},onCustomColumnAdded:function(){var e=this.$el.find(".customDropwdownInput"),t=e.val(),i=this.options.selectCallback;t?(i&&i(t),this.closeDialog()):e.effect("highlight").focus()},onCancelButtonClick:function(){this.closeDialog()},onSelectButtonClick:function(){this.options.model.tooltips=this.result,this.onCancelButtonClick()},remove:function(){this.$(".tp-selectable").data("uiSelectable")&&this.$(".tp-selectable").selectable("destroy"),this.$(".customDropwdownSelect").data("uiButton")&&this.$(".customDropwdownSelect").off().button("destroy"),this.$(".customDropwdownInput").off(),this.$el.data("uiDialog")&&this.$el.dialog("destroy"),Backbone.View.prototype.remove.apply(this,arguments)}}),DomOutline=function(e){var s={},r={opts:{namespace:(e=e||{}).namespace||"DomOutline",borderWidth:e.borderWidth||2,filter:e.filter||!1,onClick:e.onClick||!1,onHover:e.onHover||!1,parentElement:e.parentElement||!1},keyCodes:{BACKSPACE:8,ESC:27,DELETE:46},active:!1,initialized:!1,elements:{}};function t(){var e,t;!0!==r.initialized&&(t="."+r.opts.namespace+" {    background: #09c;    position: absolute;    z-index: 1000000;}."+r.opts.namespace+"_label {    background: #09c;    border-radius: 2px;    color: #fff;    font: bold 12px/12px Helvetica, sans-serif;    padding: 4px 6px;    position: absolute;    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.25);    z-index: 1000001;}",e=t,(t=document.createElement("style")).type="text/css",t.setAttribute("class",r.opts.namespace),document.getElementsByTagName("head")[0].appendChild(t),t.styleSheet?t.styleSheet.cssText=e:t.innerHTML=e,r.initialized=!0)}function i(e){var t,i,n,a,o=jQuery(e.target);o.attr("class")&&-1!==o.attr("class").indexOf(r.opts.namespace)||r.opts.filter&&!o.is(r.opts.filter)||r.opts.parentElement&&!o.is(r.opts.parentElement)&&!o.parents(r.opts.parentElement).length||(s.element=e.target,s.clickHandler=_.once(function(){r.opts.parentElement&&!jQuery(s.element).is(r.opts.parentElement)&&!jQuery(s.element).parents(r.opts.parentElement).length||(s.stop(),r.opts.onClick(s.element))}),t=r.opts.borderWidth,r.elements.window||(r.elements.window=jQuery(window)),a=r.elements.window.scrollTop(),n=(i=s.element.getBoundingClientRect()).top+a,o=s.element,i.width,i.height,e=o.tagName.toLowerCase(),o.id&&(e+="#"+o.id),$(o).attr("class")&&(e+=("."+jQuery.trim($(o).attr("class")).replace(/ /g,".")).replace(/\.\.+/g,".")),o=e,e=Math.max(0,n-20-t,a),a=Math.max(0,i.left-t),r.elements.label.css({top:e,left:a}).text(o),r.elements.top.css({top:Math.max(0,n-t),left:i.left-t,width:i.width+t,height:t}),r.elements.bottom.css({top:n+i.height,left:i.left-t,width:i.width+t,height:t}),r.elements.left.css({top:n-t,left:Math.max(0,i.left-t),width:t,height:i.height+t}),r.elements.right.css({top:n-t,left:i.left+i.width,width:t,height:i.height+2*t}),r.elements.clickBlocker.css({top:n,left:i.left,width:i.width,height:i.height}),r.opts.onHover&&r.opts.onHover(o),jQuery(s.element).off("mousedown."+r.opts.namespace),jQuery("body").off("mouseup."+r.opts.namespace),jQuery(s.element).on("mousedown."+r.opts.namespace,function(e){jQuery(s.element).off("mousedown."+r.opts.namespace),r.elements.clickBlocker.show(),jQuery("body").on("mouseup."+r.opts.namespace,function(e){return jQuery("body").off("mouseup."+r.opts.namespace),r.elements.clickBlocker.hide(),!(r.opts.filter&&!jQuery(e.target).is(r.opts.filter))&&void s.clickHandler()})}))}function n(e){return e.keyCode!==r.keyCodes.ESC&&e.keyCode!==r.keyCodes.BACKSPACE&&e.keyCode!==r.keyCodes.DELETE||s.stop(),!1}return s.start=function(){t(),!0!==r.active&&(r.active=!0,r.elements.label=jQuery("<div></div>").addClass(r.opts.namespace+"_label").appendTo("body"),r.elements.top=jQuery("<div></div>").addClass(r.opts.namespace).appendTo("body"),r.elements.bottom=jQuery("<div></div>").addClass(r.opts.namespace).appendTo("body"),r.elements.left=jQuery("<div></div>").addClass(r.opts.namespace).appendTo("body"),r.elements.right=jQuery("<div></div>").addClass(r.opts.namespace).appendTo("body"),r.elements.clickBlocker=jQuery("<div></div>").addClass(r.opts.namespace).appendTo("body").hide().css("background","none"),jQuery("body").on("mousemove."+r.opts.namespace,i),jQuery("body").on("keyup."+r.opts.namespace,n),r.opts.onClick&&setTimeout(function(){},50))},s.stop=function(){r.active=!1,jQuery.each(r.elements,function(e,t){t.remove()}),jQuery("body").off("mousemove."+r.opts.namespace).off("mousedown."+r.opts.namespace).off("mouseup."+r.opts.namespace).off("keyup."+r.opts.namespace).off("click."+r.opts.namespace)},s};jQuery.fn.extend({getPath:function(e,t,i,n,a,o){if(e=e||"html",this.is(e=void 0===(a=void 0===a?"":a)?"html":e))return e+a;if(this.is(n))return this.parent().getPath(e,t,i,n,a.substring(a.indexOf(">")+1),!0);var s,r=this.get(0).nodeName.toLowerCase(),l=this.attr("id"),c=this.attr("class");return t&&(s=this.data(t)),l&&_.every(i.id,function(e){return 0!==l.indexOf(e)})&&!i.ignoreIds&&(r+="#"+l),void 0!==c&&""!==c&&(c=c.split(/[\s\n]+/),(c=_.reject(c,function(t){return _.some(i.class,function(e){return 0===t.indexOf(e)})})).length&&(r+="."+c.join("."))),void 0!==s?(r="[data-"+t+'="'+s+'"]')+a:o?this.parent().getPath(e,t,i,n,a,o):this.parent().getPath(e,t,i,n," > "+r+a,o)}});var CssDialog=Backbone.View.extend({DIALOG_HEIGHT:540,DIALOG_HEIGHT_INSPECTING:0,INSPECTING_PROP:"isInspecting",IGNORE_ID_WIDGET_KEYS:["TreeView"],className:"css-dialog",dataView:null,propertiesView:null,initialize:function(i){var e,n=this;n.applyCallback=i.applyCallback,n.viewModel=i.viewModel,n.isPropertiesCollapsed=!1,e=n.viewModel.get("selectedWidget")?'[data-widgetid="'+n.viewModel.get("selectedWidgetId")+'"]':"div.worksheet",n.path=void 0,n.$el.html(T.CssDialog()),n.$elementPicker=n.$el.find(".element-picker"),n.$highlightedElement=n.$el.find(".highlighted-element"),n.domOutline=new DomOutline({namespace:"DomOutline",onClick:function(e){var t;n.stopInspecting(),e&&(t=(t=$(e).parents("div[data-componentid]")).length&&-1!==n.IGNORE_ID_WIDGET_KEYS.indexOf(t.attr("data-componentid")),e=$(e).getPath(".content-panel","widgetid",{id:["date_","graphHeader_","graphing_","upload","slickgrid_"],class:["active","component-build-view","has-tools","hover","mouseDown","nv-chart-","selected","slickgrid_","ui-sortable","ui-state-","ui-widget","grid-stack-instance-"],ignoreIds:t},".app-div"),n.viewModel.get("selectedWidgetView")&&_.isFunction(n.viewModel.attributes.selectedWidgetView.app.getCssPrefix)&&(e=n.viewModel.attributes.selectedWidgetView.app.getCssPrefix()+e),t=n.editor.getValue(),n.editor.setValue(e=t+(t?"\n\n":"")+e+" {\n    \n}"),e&&(e=e.split("\n").length-1,n.editor.setPosition({column:4,lineNumber:e}),n.editor.revealLine(1+e)),n.editor.focus())},onHover:function(e){n.$highlightedElement.text(e)},parentElement:i.parentElement||e}),n.$dialog=n.$el.dialog({appendTo:i.container,title:t("Advanced CSS"),resizable:!0,height:n.DIALOG_HEIGHT,width:800,minWidth:354,modal:!1,autoOpen:!0,buttons:[{text:t("Element Selector"),click:$.proxy(n.toggleInspecting,n),icons:{primary:"fa fa-mouse-pointer"}},{text:t("Apply"),click:$.proxy(n.onApplyButtonClick,n),icons:{primary:"fa fa-check"}},{text:t("Close"),click:function(){n.$el.dialog("close")},icons:{}}],beforeClose:function(){i.beforeClose&&i.beforeClose()},close:function(){n.stopInspecting(),n.remove(),i.close&&i.close()},open:function(){$('<i class="fa fa-css3" />').insertBefore(n.$el.parent().find(".ui-dialog-title")),MonacoHelpers.require({language:"css"},function(e){var t=e.monaco,e=n.$el.find(".query-editor")[0];n.editor=t.editor.create(e,_.assign({},MonacoHelpers.DEFAULT_OPTIONS(),{value:i.styles,language:"css",peekWidgetDefaultFocus:!0}))})}}),n.initializeEvents()},initializeEvents:function(){this.listenTo(this.viewModel,"change:"+this.INSPECTING_PROP,this.onViewInspectingChange),this.listenTo(this.viewModel,"change:buildMode",this.remove),this.$elementPicker.on("click",$.proxy(this.toggleInspecting,this))},onApplyButtonClick:function(){this.applyCallback(this.editor.getValue())},onViewInspectingChange:function(){var e=this.viewModel.get(this.INSPECTING_PROP);this.$el.toggleClass("inspecting",e),this.setDialogCompact(e),e?(this.domOutline.start(),this.viewModel.get("selectedWidgetView")&&_.isFunction(this.viewModel.attributes.selectedWidgetView.app.startInspecting)&&this.viewModel.attributes.selectedWidgetView.app.startInspecting()):(this.domOutline.stop(),this.$highlightedElement.text(""),this.viewModel.get("selectedWidgetView")&&_.isFunction(this.viewModel.attributes.selectedWidgetView.app.stopInspecting)&&this.viewModel.attributes.selectedWidgetView.app.stopInspecting())},onResize:function(){MonacoHelpers.adjustAfterResize(this.editor)},remove:function(){$(".DomOutline_label").remove(),$(".DomOutline").remove(),Backbone.View.prototype.remove.call(this)},setDialogCompact:function(e){this.$el.dialog("option","height",e?this.DIALOG_HEIGHT_INSPECTING:this.DIALOG_HEIGHT)},stopInspecting:function(){this.viewModel.set(this.INSPECTING_PROP,!1)},toggleInspecting:function(){this.viewModel.set(this.INSPECTING_PROP,!this.viewModel.get(this.INSPECTING_PROP))}}),DataModelPropertiesView=Backbone.View.extend({initialize:function(e){var t=this,i=[];t.model&&_.each(_.filter(_.keys(t.model.attributes),function(e){return 0===e.indexOf("_")}),function(e){i.push({key:e,val:t.model.get(e)})}),t.$el.html(T.DataModelProperties(i)),t.$el.find(".config-btn").button({icons:{primary:"fa fa-cog fa-fw"}}).click(function(e){e.preventDefault(),e.stopPropagation(),t.trigger("configure")})}}),AccordionView=Backbone.View.extend({className:"accordion",HEADING_HEIGHT:28,initialize:function(e){var t=this;t.onUpdate=e.onUpdate,this.sections=e.sections||[{heading:"Section 1",weight:2,isExpanded:!0,$el:$("<div>yooo1</div>")},{heading:"Section 2",weight:1,isExpanded:!0,$el:$("<div>yooo2</div>")}],this.$el.addClass("accordion"),_.each(this.sections,function(e,t){e.$el&&(e.$heading=e.$el.find(e.$heading),e.$content=e.$el.find(e.$content))}),this.debouncedRemoveAnimate=_.debounce(function(){t.$el.removeClass("animate"),t.onUpdate&&t.onUpdate(t.sections)},300),t.updateLayout(!1)},adjustWeights:function(e,i){var n=this.sum(_.map(e,function(e){return e.weight})),a=this.sum(i);_.each(e,function(e,t){e.weight=n*(i[t]/a)})},onSectionResize:function(e,t,i){for(var n,a,o=this,s=0,r=e.$el.height(),l=r-i.originalSize.height,c=[e],d=[r],p=o.sections.indexOf(e)+1;p<o.sections.length&&(!(n=o.sections[p]).isExpanded||n.fixed||n.hidden||(a=Math.max(o.HEADING_HEIGHT,n.startHeight-(l-s)),s+=Math.min(n.startHeight-o.HEADING_HEIGHT,l-s),n.$el.height(a+"px"),c.push(n),d.push(a),s!==l));p+=1);o.adjustWeights(c,d)},resize:function(){this.updateLayout(!1)},sum:function(e){return _.reduce(e,function(e,t){return e+t},0)},updateLayout:function(e){var i,t,n,a=this,o=a.$el.height();a.$el.toggleClass("animate",e),t=_.filter(a.sections,function(e){return e.isExpanded&&!e.hidden}),visibleHeaders=_.filter(a.sections,function(e){return!e.hidden&&!e.isExpanded}),o-=visibleHeaders.length*a.HEADING_HEIGHT,o-=this.sum(_.map(_.filter(t,function(e){return e.isExpanded&&e.fixed}),function(e){return e.fixed})),t=this.sum(_.map(t,function(e){return e.fixed?0:e.weight})),i=o/t,_.each(a.sections,function(e,t){e.$el.toggleClass("expanded",e.isExpanded),e.isExpanded&&!e.hidden?(n=e.fixed||e.weight*i,e.$el.height(n)):e.$el.height(0),e.resize&&!e.hidden&&e.resize(),e.hidden?e.$el.hide():(e.$el.show(),e.isExpanded&&!e.fixed&&!e.hidden&&t<a.sections.length-1&&_.some(a.sections.slice(t+1),function(e){return e.isExpanded&&!e.fixed})?e.resizeable=e.$el.resizable({handles:"s",resize:$.proxy(a.onSectionResize,a,e),start:function(){_.each(a.sections,function(e){e.startHeight=e.$el.height()}),e.$el.resizable("option","maxHeight",a.$el.height()-(a.sections.length-1)*a.HEADING_HEIGHT)},stop:function(){a.updateLayout()}}):e.resizeable&&(e.$el.resizable("destroy"),delete e.resizeable))}),e?this.debouncedRemoveAnimate():a.onUpdate&&a.onUpdate(a.sections)}}),lE;jQuery.fn.caret=function(e){var t=this[0],i="true"===t.contentEditable;if(0!=arguments.length)return-1==e&&(e=this[i?"text":"val"]().length),window.getSelection?i?(t.focus(),window.getSelection().collapse(t.firstChild,e)):t.setSelectionRange(e,e):document.body.createTextRange&&(i?((a=document.body.createTextRange()).moveToElementText(t),a.moveStart("character",e),a.collapse(!0)):(a=t.createTextRange()).move("character",e),a.select()),i||t.focus(),e;if(window.getSelection)return i?(t.focus(),(o=(n=window.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(t),o.setEnd(n.endContainer,n.endOffset),o.toString().length):t.selectionStart;if(document.selection){if(t.focus(),i){var n=document.selection.createRange();return(o=document.body.createTextRange()).moveToElementText(t),o.setEndPoint("EndToEnd",n),o.text.length}var e=0,a=t.createTextRange(),o=(o=document.selection.createRange().duplicate()).getBookmark();for(a.moveToBookmark(o);0!==a.moveStart("character",-1);)e++;return e}return t.selectionStart||0},lE=jQuery,lE.fn.tagEditorInput=function(){var t=" ",i=lE(this),n=parseInt(i.css("fontSize")),a=lE("<span/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"});return a.insertAfter(i),i.bind("keyup keydown focus",function(){var e;t!==(t=i.val())&&(a.html(t.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),(e=(e=a.width()+n)<20?20:e)!=i.width()&&i.width(e))})},lE.fn.tagEditor=function(n,a,o){function g(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var m,f=lE.extend({},lE.fn.tagEditor.defaults,n);if(f.dregex=new RegExp("["+f.delimiter.replace("-","-")+"]","g"),"string"!=typeof n)return window.getSelection&&lE(document).off("keydown.tag-editor").on("keydown.tag-editor",function(e){if(8==e.which||46==e.which||e.ctrlKey&&88==e.which){try{var t=getSelection(),n=lE(t.getRangeAt(0).commonAncestorContainer)}catch(e){n=0}if(n&&n.hasClass("tag-editor")){var a=[],o=t.toString().split(n.prev().data("options").dregex);for(i=0;i<o.length;i++){var s=lE.trim(o[i]);s&&a.push(s)}return lE(".tag-editor-tag",n).each(function(){~lE.inArray(lE(this).html(),a)&&lE(this).closest("li").find(".tag-editor-delete").click()}),!1}}}),this.each(function(){var l=lE(this),c=[],d=lE("<ul "+(f.clickDelete?'oncontextmenu="return false;" ':"")+'class="tag-editor"></ul>').insertAfter(l);l.addClass("tag-editor-hidden-src").data("options",f).on("focus.tag-editor",function(){d.click()}),d.append('<li style="width:1px">&nbsp;</li>');var t,i,p='<li><div class="tag-editor-spacer">&nbsp;'+f.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>';function a(){!f.placeholder||c.length||lE(".deleted, .placeholder, input",d).length||d.append('<li class="placeholder"><div>'+f.placeholder+"</div></li>")}function u(e){var t=c.toString();c=lE(".tag-editor-tag:not(.deleted)",d).map(function(e,t){t=lE.trim(lE(this).hasClass("active")?lE(this).find("input").val():lE(t).text());if(t)return t}).get(),d.data("tags",c),l.val(c.join(f.delimiter[0])),e||t!=c.toString()&&f.onChange(l,d,c),a()}function o(e){for(var t,i=e.closest("li"),n=e.val().replace(/ +/," ").split(f.dregex),a=e.data("old_tag"),o=c.slice(0),s=!1,r=0;r<n.length;r++)if(h=lE.trim(n[r]).slice(0,f.maxLength),f.forceLowercase&&(h=h.toLowerCase()),t=f.beforeTagSave(l,d,o,a,h),h=t||h,!1!==t&&h&&(f.removeDuplicates&&~lE.inArray(h,o)&&lE(".tag-editor-tag",d).each(function(){lE(this).html()==h&&lE(this).closest("li").remove()}),o.push(h),i.before('<li><div class="tag-editor-spacer">&nbsp;'+f.delimiter[0]+'</div><div class="tag-editor-tag">'+g(h)+'</div><div class="tag-editor-delete"><i></i></div></li>'),f.maxTags&&o.length>=f.maxTags)){s=!0;break}e.attr("maxlength",f.maxLength).removeData("old_tag").val(""),s?e.blur():e.focus(),u()}d.click(function(n,a){var o,s,r=99999;if(!window.getSelection||""==getSelection())return f.maxTags&&d.data("tags").length>=f.maxTags?(d.find("input").blur(),!1):(m=!0,lE("input:focus",d).blur(),m&&(m=!0,lE(".placeholder",d).remove(),a&&a.length?s="before":lE(".tag-editor-tag",d).each(function(){var e=lE(this),t=e.offset(),i=t.left,t=t.top;n.pageY>=t&&n.pageY<=t+e.height()&&(o=n.pageX<i?(s="before",i-n.pageX):(s="after",n.pageX-i-e.width()))<r&&(r=o,a=e)}),("before"==s?lE(p).insertBefore(a.closest("li")):"after"==s?lE(p).insertAfter(a.closest("li")):lE(p).appendTo(d)).find(".tag-editor-tag").click()),!1)}),d.on("click",".tag-editor-delete",function(e){if(lE(this).prev().hasClass("active"))return lE(this).closest("li").find("input").caret(-1),!1;var t=lE(this).closest("li"),i=t.find(".tag-editor-tag");return!1===f.beforeTagDelete(l,d,c,i.html())||(i.addClass("deleted").animate({width:0},f.animateDelete,function(){t.remove(),a()}),u()),!1}),f.clickDelete&&d.on("mousedown",".tag-editor-tag",function(e){if(e.ctrlKey||1<e.which){var t=lE(this).closest("li"),e=t.find(".tag-editor-tag");return!1===f.beforeTagDelete(l,d,c,e.html())?!1:(e.addClass("deleted").animate({width:0},f.animateDelete,function(){t.remove(),a()}),u(),!1)}}),d.on("click",".tag-editor-tag",function(e){return f.clickDelete&&(e.ctrlKey||1<e.which)||lE(this).hasClass("active")||(t=lE(this).html(),i=Math.abs((lE(this).offset().left-e.pageX)/lE(this).width()),e=parseInt(t.length*i),(i=lE(this).html('<input type="text" maxlength="'+f.maxLength+'" value="'+t+'">').addClass("active").find("input")).data("old_tag",t).tagEditorInput().focus().caret(e),f.autocomplete&&(e=lE.extend({},f.autocomplete),n="select"in e?f.autocomplete.select:"",e.select=function(e,t){n&&n(e,t),setTimeout(function(){d.trigger("click",[lE(".active",d).find("input").closest("li").next("li").find(".tag-editor-tag")])},20)},i.autocomplete(e))),!1;var t,i,n}),d.on("blur","input",function(e){e.stopPropagation();var t=lE(this),i=t.data("old_tag"),n=lE.trim(t.val().replace(/ +/," ").replace(f.dregex,f.delimiter[0]));if(n){if(0<=n.indexOf(f.delimiter[0]))return void o(t);if(n!=i)if(f.forceLowercase&&(n=n.toLowerCase()),cb_val=f.beforeTagSave(l,d,c,i,n),n=cb_val||n,!1===cb_val){if(i)return t.val(i).focus(),m=!1,void u();try{t.closest("li").remove()}catch(e){}i&&u()}else f.removeDuplicates&&lE(".tag-editor-tag:not(.active)",d).each(function(){lE(this).html()==n&&lE(this).closest("li").remove()})}else{if(i&&!1===f.beforeTagDelete(l,d,c,i))return t.val(i).focus(),m=!1,void u();try{t.closest("li").remove()}catch(e){}i&&u()}t.parent().html(g(n)).removeClass("active"),n!=i&&u(),a()}),d.on("paste","input",function(e){lE(this).removeAttr("maxlength"),t=lE(this),setTimeout(function(){o(t)},30)}),d.on("keypress","input",function(e){0<=f.delimiter.indexOf(String.fromCharCode(e.which))&&(i=lE(this),setTimeout(function(){o(i)},20))}),d.on("keydown","input",function(e){var t,i,n=lE(this);if((37==e.which||!f.autocomplete&&38==e.which)&&!n.caret()||8==e.which&&!n.val())return(t=n.closest("li").prev("li").find(".tag-editor-tag")).length?t.click().find("input").caret(-1):!n.val()||f.maxTags&&d.data("tags").length>=f.maxTags||lE(p).insertBefore(n.closest("li")).find(".tag-editor-tag").click(),!1;if((39==e.which||!f.autocomplete&&40==e.which)&&n.caret()==n.val().length)return(i=n.closest("li").next("li").find(".tag-editor-tag")).length?i.click().find("input").caret(0):n.val()&&d.click(),!1;if(9==e.which){if(e.shiftKey){if((t=n.closest("li").prev("li").find(".tag-editor-tag")).length)t.click().find("input").caret(0);else{if(!n.val()||f.maxTags&&d.data("tags").length>=f.maxTags)return l.attr("disabled","disabled"),void setTimeout(function(){l.removeAttr("disabled")},30);lE(p).insertBefore(n.closest("li")).find(".tag-editor-tag").click()}return!1}if((i=n.closest("li").next("li").find(".tag-editor-tag")).length)i.click().find("input").caret(0);else{if(!n.val())return;d.click()}return!1}if(!(46!=e.which||lE.trim(n.val())&&n.caret()!=n.val().length))return(i=n.closest("li").next("li").find(".tag-editor-tag")).length?i.click().find("input").caret(0):n.val()&&d.click(),!1;if(13==e.which)return d.trigger("click",[n.closest("li").next("li").find(".tag-editor-tag")]),!1;if(36!=e.which||n.caret()){if(35==e.which&&n.caret()==n.val().length)d.find(".tag-editor-tag").last().click();else if(27==e.which)return n.val(n.data("old_tag")?n.data("old_tag"):"").blur(),!1}else d.find(".tag-editor-tag").first().click()});for(var e=f.initialTags.length?f.initialTags:l.val().split(f.dregex),n=0;n<e.length&&!(f.maxTags&&n>=f.maxTags);n++){var h=lE.trim(e[n].replace(/ +/," "));h&&(f.forceLowercase&&(h=h.toLowerCase()),c.push(h),d.append('<li><div class="tag-editor-spacer">&nbsp;'+f.delimiter[0]+'</div><div class="tag-editor-tag">'+g(h)+'</div><div class="tag-editor-delete"><i></i></div></li>'))}u(!0),f.sortable&&lE.fn.sortable&&d.sortable({distance:5,cancel:".tag-editor-spacer, input",helper:"clone",update:function(){u()}})});var s=[];return this.each(function(){var e=lE(this),t=e.data("options"),i=e.next(".tag-editor");if("getTags"==n)s.push({field:e[0],editor:i,tags:i.data("tags")});else if("addTag"==n){if(t.maxTags&&i.data("tags").length>=t.maxTags)return!1;lE('<li><div class="tag-editor-spacer">&nbsp;'+t.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>').appendTo(i).find(".tag-editor-tag").html('<input type="text" maxlength="'+t.maxLength+'">').addClass("active").find("input").val(a).blur(),o?lE(".placeholder",i).remove():i.click()}else"removeTag"==n?(lE(".tag-editor-tag",i).filter(function(){return lE(this).html()==a}).closest("li").find(".tag-editor-delete").click(),o||i.click()):"destroy"==n&&e.removeClass("tag-editor-hidden-src").removeData("options").off("focus.tag-editor").next(".tag-editor").remove()}),"getTags"==n?s:this},lE.fn.tagEditor.defaults={initialTags:[],maxTags:0,maxLength:50,delimiter:",;",placeholder:"",forceLowercase:!0,removeDuplicates:!0,clickDelete:!1,animateDelete:175,sortable:!0,autocomplete:null,onChange:function(){},beforeTagSave:function(){},beforeTagDelete:function(){}};var PropertiesTagView=Backbone.View.extend({tagName:"textarea",className:"tagEditor",preventModelUpdate:!1,visibleTagsList:[],initialize:function(e){this.options=e,this.$el.addClass(this.className),this.render(),this.initializeEvents()},initializeEvents:function(){this.listenTo(this.model,"change:"+this.options.property,this.render)},addMultipleTags:function(e){var t=this;_.each(e,function(e){t.$el.tagEditor("addTag",e)})},onTagsChanged:function(e,t,i){this.preventModelUpdate||(this.stopListening(),this.visibleTagsList=i,this.model.set(this.options.property,i),this.initializeEvents())},render:function(){var e=this.model.get(this.options.property),t=(this.options.placeholder,this.options.removeDuplicates||!1);this.$el.tagEditor("destroy"),this.$el.val(""),this.$el.tagEditor({initialTags:e,forceLowercase:!1,animateDelete:0,sortable:!0,removeDuplicates:t,delimiter:" |",onChange:$.proxy(this.onTagsChanged,this),autocomplete:this.options.autocomplete||null})},refreshTags:function(e){0<this.visibleTagsList.length&&(this.preventModelUpdate=!0,this.removeAllTags(),this.addMultipleTags(e),this.visibleTagsList=e,this.preventModelUpdate=!1)},removeAllTags:function(){var t=this;_.each(_.uniq(t.visibleTagsList),function(e){t.$el.tagEditor("removeTag",e)})}}),DataConfigAggregateRow=Backbone.View.extend({tagName:"li",className:"pivotRow",AGGREGATE_FNS:["count","sum","avg","max","min","first","last"],events:{"change input":"onValueChange"},initialize:function(e){this.options=e,this.render()},checkAggregateFn:function(e){return-1<this.AGGREGATE_FNS.indexOf(e)||-1<e.indexOf(";")},handleInvalidEntry:function(e){$(e).addClass("invalidEntry"),_.delay(function(){$(e).removeClass("invalidEntry")},3e3)},onValueChange:function(e){var t=$.trim(this.$el.find(".aggregateColItm").val()),i=this.model.get("_aggregateCols"),n=$.trim(this.$el.find(".aggregateFnItm").val()),a=this.model.get("_aggregateFns"),o=this.model.get("_aggregateLabels"),s=$.trim(this.$el.find(".aggregateLabelItm").val());-1===o.indexOf(s)||""===s||$(e.currentTarget).hasClass("aggregateColItm")||$(e.currentTarget).hasClass("aggregateFnItm")?($(e.currentTarget).hasClass("aggregateFnItm")&&!this.checkAggregateFn(n)&&this.handleInvalidEntry(e.currentTarget),i[i=this.$el.index()]=t,a[i]=n,o[i]=s,this.model.trigger("change:_aggregateCols")):this.handleInvalidEntry(e.currentTarget)},removeModelDetails:function(){var e=this.$el.index();-1<e&&(this.model.get("_aggregateCols").splice(e,1),this.model.get("_aggregateFns").splice(e,1),this.model.get("_aggregateLabels").splice(e,1),this.model.trigger("change:_aggregateCols"),this.remove())},render:function(){this.$el.html(T.DataConfigAggregateRow(this.options.aggregateDetails)),this.$el.find(".deleteRow").button({icons:{primary:"fa fa-trash"},text:!1}).click($.proxy(this.removeModelDetails,this))}}),TreeView=(nG=Backbone.View,__extends(oG,nG),oG.prototype.updateTheme=function(){var e=$("#appdiv .toolbar").hasClass("kx-light")?"kx-light":"kx-darkroom",t=$(document).find(".vakata-context.jstree-contextmenu");t&&(t.removeClass("kx-light kx-darkroom"),t.addClass(e))},oG.prototype.initializeEvents=function(){var s=this,e=_.debounce(function(){s.onSearchInputKeyUp()},250);s.$createButton.click($.proxy(s.onCreateClick,s)),s.$renameButton.click($.proxy(s.onRenameClick,s)),s.$deleteButton.click($.proxy(s.onDeleteClick,s)),s.$searchInput.keyup(e),s.$clearSearch.click($.proxy(s.onClearSearchClick,s)),s.$tree.on("contextmenu.jstree",function(e){var t;e.target==s.$tree[0]&&(e.preventDefault(),$(document).one("context_show.vakata.jstree",function(e,t){$(t.element).addClass("jstree-contextmenu jstree-default-contextmenu")}),t={create:{label:"New",submenu:{create_node:{label:s.nodeLabel,action:function(e){return s.onCreateNode(e,"node")}},create_group:{separator_after:!0,label:"Group",action:function(e){return s.onCreateNode(e,"group")}}}},ccp:{label:"Edit",submenu:{paste:{label:"Paste",_disabled:_.isEmpty($.jstree.core.prototype.get_buffer().node),action:function(e){return s.$tree.jstree("paste","#")}}}}},$.vakata.context.show($(this),{x:e.pageX,y:e.pageY},t),s.updateTheme())}),s.$tree.on("show_contextmenu.jstree",$.proxy(s.updateTheme,s)),this.$tree.on("ready.jstree",function(e,o){var t,i,n;s.$tree.jstree("deselect_all"),s.$tree.on("copy_node.jstree",function(e,t){var i,n,a=t.node.text;t.parent===o.old_parent&&(n=a,a+=" copy"),i=oG.calculateParentPath(t),t=oG.calculatePath({node:t.instance._model.data[t.old_parent],instance:t.instance},t.old_parent),s.onTreeNodeCopy(i,t,a,n)}),s.$tree.on("create_node.jstree",function(e,t){var i="group"===t.node.original.type,n=oG.calculateParentPath(t),a=t.instance._model.data[t.node.id].text;i?s.onTreeGroupCreate(n,a):s.onTreeNodeCreate(n,a,t.node.original),s.$tree.jstree("deselect_all",!0),s.$tree.jstree("select_node",t.node.id,!0),s.trigger("select_property",i?"":n?n+"/"+a:a,!0)}),s.$tree.on("delete_node.jstree",function(e,t){var i=oG.calculateParentPath(t),t=t.instance._model.data[t.node.id].text;s.onTreeNodeDelete(i,t)}),s.$tree.on("move_node.jstree",function(e,t){var i=t.node.text,n=oG.calculateParentPath(t),a=oG.calculatePath({node:t.instance._model.data[t.old_parent],instance:t.instance},t.old_parent);s.onTreeNodeMove(n,a,i),s.pending&&s.pending.id===t.node.id&&s.setPending(t.node),_.includes(s.$tree.jstree("get_selected"),t.node.id)&&"node"===t.node.type&&(s.selectionChanged=!1,s.trigger("select_property",oG.calculatePath(t,t.node.id)))}),s.$tree.on("rename_node.jstree",function(e,t){var i=oG.calculateParentPath(t);s.onTreeNodeRename(t.node.id,i,t.old,t.text),_.includes(s.$tree.jstree("get_selected"),t.node.id)&&(s.$tree.jstree("deselect_all"),s.$tree.jstree("select_node",t.node.id)),s.setPending(s.pending)}),s.$tree.on("search.jstree",function(e,t,i){0===t.nodes.length&&s.$tree.jstree(!0).hide_all(!1)}),s.initialSelection&&(i=s.model.getByPath(s.initialSelection),n=o.instance._model.data,i&&(t=_.find(n,function(e){return e.data===i.cid}))&&(s.$tree.jstree("select_node",t),s.selectedNode=t,s.$renameButton.button("option","disabled",!1),s.$deleteButton.button("option","disabled",!1),s.trigger("select_property",s.initialSelection),s.$el.find("#"+t.id)[0].scrollIntoView())),s.$tree.on("changed.jstree",$.proxy(s.onTreeItemSelectionChanged,s))})},oG.prototype.convertJSTreeModelToJSON=function(t,e){var i=this,e=t[e],n={};return e.type&&"node"===e.type?e.original.value||"":(_.each(e.children,function(e){n[t[e].text]=i.convertJSTreeModelToJSON(t,e)}),n)},oG.prototype.convertModelToJSTreeModel=function(i){var n,a=this,o=[];return _.each(_.keys(i),function(e){var t=i[e];t instanceof Backbone.Model&&!t.has("_dataType")&&!t.has("_viewType")?o.push({data:t.cid,text:e,type:"group",children:a.convertModelToJSTreeModel(t.attributes)}):(n={data:t.cid,text:e,type:_.isFunction(a.determineTypeFn)?a.determineTypeFn(t):"node",value:t||""},_.includes(a.disabledNodes,t.path)&&(n.state={disabled:!0}),o.push(n))}),o},oG.prototype.getModelFromPath=function(e,t){var i,n=t.indexOf("/");return 0<t.length?-1!==n?(i=e.get(t.substring(0,n)),this.getModelFromPath(i,t.substring(n+1))):e.get(t):e},oG.prototype.getTreeReference=function(){return this.$el.find(".tree").jstree(!0)},oG.prototype.onSearchInputKeyUp=function(){var e=this.$searchInput.val();this.$clearSearch.toggle(!_.isEmpty(e)),this.debouncedSearch(e)},oG.prototype.onClearSearchClick=function(){this.$searchInput.val("").trigger("keyup")},oG.prototype.onCreateClick=function(){if(!this.pending){var e=this.getTreeReference(),t=e.get_selected();return(t=t.length?t[0]:null)&&"group"!==e._model.data[t].type&&(t=e._model.data[t].parent),(t=e.create_node(t||null,{type:"node"}))&&e.edit(t),!0}this.renderAreYouSure(this.onCreateClick.bind(this))},oG.prototype.onCreateNode=function(e,t){var i;this.pending?this.renderAreYouSure(this.onCreateNode.bind(this,e,t)):((e=(i=$.jstree.reference(e.reference)).get_node(e.reference)||null)&&"group"!==e.type&&(e=i.get_node(e.parent)||null),i.create_node(e,{type:t},"last",function(e){_.defer(function(){i.edit(e)})}))},oG.prototype.onRenameClick=function(){var e=this.getTreeReference(),t=e.get_selected();return!!t.length&&(t=t[0],e.edit(t),!0)},oG.prototype.onDeleteClick=function(){var e=this.getTreeReference(),t=e.get_selected();return!!t.length&&(e.delete_node(t),!0)},oG.prototype.onTreeItemSelectionChanged=function(e,t){var i="";"select_node"===t.action&&("group"!==t.instance._model.data[t.node.id].type&&(i=oG.calculatePath(t,t.node.id)),this.$renameButton.button("option","disabled",0===i.length),this.$deleteButton.button("option","disabled",0===i.length),this.selectionChanged=!this.selectedNode||this.selectedNode&&this.selectedNode.id!==t.node.id,this.lastSelectedNode=this.selectedNode||t.node,this.selectedNode=t.node,this.trigger("select_property",i))},oG.prototype.onTreeNodeCreate=function(e,t,i){e=this.getModelFromPath(this.model,e);e.set(t,this.newNodeFn(i)),e.trigger("materialChange")},oG.prototype.onTreeGroupCreate=function(e,t){e=this.getModelFromPath(this.model,e);e.set(t,this.newGroupFn()),e.trigger("materialChange")},oG.prototype.onTreeNodeCopy=function(e,t,i,n){var a=this,o=this.getModelFromPath(this.model,e),n=this.getModelFromPath(this.model,t).get(n||i).clone();o.set(i,n),o.trigger("materialChange"),this.setPathFn(n,e?e+"/"+i:i),_.defer(function(){a.trigger("select_property",e?e+"/"+i:i)})},oG.prototype.onTreeNodeDelete=function(e,t){e=this.getModelFromPath(this.model,e);e.unset(t),e.trigger("materialChange"),this.trigger("select_property")},oG.prototype.onTreeNodeMove=function(e,t,i){var n=this.getModelFromPath(this.model,e),a=this.getModelFromPath(this.model,t),t=a.get(i);a.unset(i),n.set(i,t),n.trigger("materialChange"),this.setPathFn(t,e?e+"/"+i:i)},oG.prototype.onTreeNodeRename=function(e,t,i,n){var a=this,o=this.getModelFromPath(this.model,t),t=o.get(i);QuickBase.ErrorTooltip.clear(this.$errorTooltip),n===_.unescape(n)&&/^[\w&.\- ]+$/.test(n)?(o.unset(i),t&&(o.set(n,t),o.trigger("materialChange"),this.setPathFn(t,o.path?o.path+"/"+n:n))):(this.$errorTooltip=QuickBase.ErrorTooltip.show("Invalid name (a-Z 0-9 _-. allowed)",this.$el.find("#"+e+"_anchor"),!0),_.delay(function(){QuickBase.ErrorTooltip.clear(a.$errorTooltip,!0)},5e3),this.$tree.jstree("rename_node",e,i))},oG.prototype.jstreeSearch=function(e){this.$tree.jstree(!0).show_all(!1),this.$tree.jstree().search(e)},oG.prototype.renderAreYouSure=function(e){var t=this;this.areYouSureDialog=new QuickBase.AreYouSureDialog({saveCb:function(){t.saveCb(),t.setPending(),t.selectionChanged=null,e()},onClose:function(){t.areYouSureDialog.remove(),delete t.areYouSureDialog},noSaveCb:function(){t.noSaveCb(),t.setPending(),t.selectionChanged=null,e()},dashChanged:!0,message:this.areYouSureMessage||"There are unsaved changes to the selected item"})},oG.prototype.setPending=function(e){var t,i,n=e||this.pending,a=!!e;n&&((i=(t=this.$tree.jstree())._model.data[n.id].li_attr.class)?(i=i.split(" "),a&&!_.includes(i,"save-pending")?i.push("save-pending"):a||_.remove(i,function(e){return"save-pending"===e})):a&&(i=["save-pending"]),t.get_node(n,!0).toggleClass("save-pending",a),i&&(t._model.data[n.id].li_attr.class=i.join(" "))),this.pending=e||null},oG.prototype.showTargetExistsError=function(e){var t=this;QuickBase.ErrorTooltip.clear(this.$errorTooltip),this.$errorTooltip=QuickBase.ErrorTooltip.show("Target already exists",this.$el.find("#"+e.obj),!0),_.delay(function(){QuickBase.ErrorTooltip.clear(t.$errorTooltip,!0)},5e3)},oG.prototype.updateNodeValue=function(e,t,i){e=e.substring(0,e.lastIndexOf("/")),e=this.getModelFromPath(this.model,e);t.original.value=i,e.set(t.text,i)},oG.calculatePath=function(t,e){return _.map([e].concat(t.node.parents.slice(0,-1)),function(e){return t.instance._model.data[e].text}).reverse().join("/")},oG.calculateParentPath=function(t){return _.map(t.node.parents.slice(0,-1),function(e){return t.instance._model.data[e].text}).reverse().join("/")},oG),nG;function oG(e){var t=nG.call(this,_.extend({},e,{className:"dataView"}))||this;return t.contextMenuFn=e.contextMenuFn,t.determineTypeFn=e.determineTypeFn,t.disabledNodes=e.disabledNodes,t.initialSelection=e.selected,t.newGroupFn=e.newGroupFn,t.newNodeFn=e.newNodeFn,t.nodeLabel=e.nodeLabel||"Node",t.nodeTypes=e.nodeTypes||{},t.setPathFn=e.setPathFn,t.saveCb=e.saveCb,t.noSaveCb=e.noSaveCb,t.areYouSureMessage=e.areYouSureMessage,t.$el.addClass("dataView"),t.$el.html(T.TreeView()),t.$createButton=t.$el.find(".new").button({icons:{primary:"fa fa-square-o"}}),t.$renameButton=t.$el.find(".rename").button({icons:{primary:"fa fa-pencil-square-o"},disabled:!0}),t.$deleteButton=t.$el.find(".delete").button({icons:{primary:"fa fa-trash-o"},disabled:!0}),t.$searchInput=t.$el.find(".search"),t.$clearSearch=t.$el.find(".clearSearch"),t.debouncedSearch=_.debounce(_.bind(t.jstreeSearch,t),250),require(["jstree"],function(){var r=t;t.$tree=t.$el.find(".tree").jstree({core:{data:t.convertModelToJSTreeModel(_.omit(t.model.attributes,".settings")),error:function(e){var t,i,n,a,o,s=JSON.parse(e.data);switch(e.id){case"unique_01":_.defer(function(){this.edit(s.obj)}.bind(this)),QuickBase.ErrorTooltip.clear(r.$errorTooltip),r.$errorTooltip=QuickBase.ErrorTooltip.show("Name already exists",r.$el.find("#"+s.obj),!0),_.delay(function(){QuickBase.ErrorTooltip.clear(r.$errorTooltip,!0)},5e3);break;case"core_01":case"types_02":case"unique_02":if(n=this.get_json(s.obj),"core_01"===e.id&&"group"===n.type)break;if(i="unique_02"===e.id?oG.calculatePath({node:this.get_node(s.par),instance:this},s.par):oG.calculateParentPath({node:this.get_node(s.par),instance:this}),t=r.getModelFromPath(r.model,i),"types_02"===e.id&&"move_node"===s.chk&&t.get(n.text)){r.showTargetExistsError(s);break}for(a=n.text;t.get(n.text);)n.text+=" copy";delete n.id,delete n.a_attr,delete n.li_attr,o="unique_02"===e.id?s.par:this.get_node(s.par).parent,"move_node"!==s.chk?(this.create_node("#"===o?null:o,n),r.onTreeNodeCopy(i,oG.calculateParentPath({node:this.get_node(s.obj),instance:this}),n.text,a)):(this.move_node(this.get_node(s.obj),this.get_node(o)),r.onTreeNodeMove(i,oG.calculateParentPath({node:this.get_node(s.obj),instance:this}),n.text));break;case"core_03":case"unique_03":r.showTargetExistsError(s)}},check_callback:function(e,t,i,n,a){t=this.get_node(t);return"move_node"!==e||t.parent!==this.get_node(i).id},themes:{dots:!0}},sort:function(e,t){var i=(this.get_type(e)||"").match(/^[a-z]+/)[0],n=(this.get_type(t)||"").match(/^[a-z]+/)[0];return i===n?this.get_text(e)>this.get_text(t)?1:-1:n<=i?1:-1},contextmenu:{items:function(e){if(!r.pending||!r.selectionChanged){var t=$.jstree.defaults.contextmenu.items(),e=this.get_type(e);return delete t.create.action,t.create.label="New",t.create.submenu={create_node:{label:r.nodeLabel,action:function(e){return r.onCreateNode(e,"node")}},create_group:{separator_after:!0,label:"Group",action:function(e){return r.onCreateNode(e,"group")}}},_.isFunction(r.contextMenuFn)&&_.extend(t,r.contextMenuFn(e)),t}}},search:{show_only_matches:!0,show_only_matches_children:!0},types:_.extend({node:{valid_children:[],icon:"fa fa-fw fa-file-text"},group:{icon:"fa fa-fw fa-folder"}},t.nodeTypes),unique:{duplicate:function(e,t){return e+" "+t}},plugins:["contextmenu","dnd","search","stackedicon","state","types","wholerow","unique","sort"]}),t.initializeEvents()}),t}var ViewStateDialog=Backbone.View.extend({className:"view-state-dialog",initialize:function(i){var a=this,e=parseInt(a.getCookie("dashboard-viewStateDialog-size").split(",")[1])+90||560;a.isPropertiesCollapsed=!1;var n=Tools.calcDialogHeight(e,"viewStateDialog"),e=parseInt(a.getCookie("dashboard-viewStateDialog-size").split(",")[0])||480;e>window.innerWidth?e=window.innerWidth-300:n>window.innerHeight?n=window.innerHeight-200:e>innerWidth&&n>innerHeight&&(e=window.innerWidth-300,n=window.innerHeight-200),a.cancelCallback=i.cancelCallback,a.dialogContainer=i.dialogContainer,a.disabledNodes=i.disabledNodes,a.docDataModel=i.docDataModel,a.selectCallback=i.selectCallback,a.path=void 0,a.$el.html(T.ViewStateDialog()),a.$tree=a.$el.find("> .tree"),a.$collapsible=a.$el.find(".accordian-container > .collapsible"),a.$header=a.$collapsible.find("> h3"),a.$icon=a.$header.find("i"),a.$collapsibleContent=a.$collapsible.find("> .properties"),a.$el.dialog(_.extend({appendTo:i.dialogContainer,title:t("Select View State... "),dialogClass:"quick-dash viewstate-dialog",resizable:!0,height:n,width:e,minWidth:480,position:{my:"center",at:"center",of:"#appdiv",collision:"fit"},modal:!0,autoOpen:!0,buttons:[{text:t("Select Item"),click:$.proxy(a.onSelectButtonClick,a),disabled:!0,icons:{primary:"fa fa-check"}},{text:t("Cancel"),click:$.proxy(a.onCancelButtonClick,a),icons:{primary:"fa fa-times"}}],close:function(){a.cancelCallback&&a.cancelCallback(),a.setCookie("dashboard-viewStateDialog-position",a.el.parentElement.style.left+","+a.el.parentElement.style.top,90),a.setCookie("dashboard-viewStateDialog-weights",a.accordion.sections[0].weight+","+a.accordion.sections[1].weight,90),a.removeDialog(),QuickBase.ErrorTooltip.clearAll()},open:function(){$('<i class="fa fa-eye" />').insertBefore(a.$el.parent().find(".ui-dialog-title"));var e=a.getCookie("dashboard-viewStateDialog-weights").split(",");a.dataView=new TreeView({el:a.$el.find(".tree"),disabledNodes:a.disabledNodes,model:a.model,nodeLabel:"View State",nodeTypes:{node:{icon:"fa fa-fw fa-eye",valid_children:[]}},selected:i.path,newGroupFn:function(){return new QuickBase.DocumentViewModel},newNodeFn:function(){return new QuickBase.DocumentViewModel({_viewType:!0,_default:""})},setPathFn:function(e,t){var i,n=e.path;t!==n&&(e.path=t,i=new RegExp("^"+n),e.getViewStateList().forEach(function(e){e=e.model;e.path&&(e.path=e.path.replace(i,t))}),a.docDataModel.getTreeList().forEach(function(e){e.updateParameterPath("vs",n,t)}))}}),a.sections=[{$el:a.$el.find(".treeview"),$content:a.$tree,isExpanded:!0,hidden:!1,minHeight:15,weight:isNaN(parseFloat(e[0]))?1:parseFloat(e[0])},{$el:a.$collapsible,heading:a.$header,isExpanded:!0,hidden:!1,weight:isNaN(parseFloat(e[1]))?2:parseFloat(e[1])}],a.accordion=new AccordionView({el:a.$el,sections:a.sections}),a.$header.click(function(){a.isPropertiesCollapsed=!a.isPropertiesCollapsed,a.$collapsibleContent.toggle(!a.isPropertiesCollapsed),a.isPropertiesCollapsed?(a.$el.find(".tree.jstree")[0].style.position="relative",a.$el.find(".tree.jstree")[0].style.top="0px",a.accordion.sections[1].fixed=28):(a.$el.find(".tree.jstree")[0].style.position="absolute",a.$el.find(".tree.jstree")[0].style.top="2.5em",a.accordion.sections[1].fixed=0),a.accordion.updateLayout()}),a.dataView.on("select_property",$.proxy(a.onTreeViewSelectProperty,a)),"FSBL"in window&&a.$el.parent().css("margin-top",window.finApi.DIALOGS_TOP_MARGIN),a.$el.parent().find(".ui-dialog-buttonpane > div > button:last-child").focus()},resizeStart:function(){},resizeStop:function(){a.accordion.updateLayout(),a.setCookie("dashboard-viewStateDialog-size",a.$el.width()+","+a.$el.height(),90)}},i)),a.getCookie("dashboard-viewStateDialog-position")&&(a.$el[0].parentElement.style.left=a.getCookie("dashboard-viewStateDialog-position").split(",")[0],a.$el[0].parentElement.style.top=a.getCookie("dashboard-viewStateDialog-position").split(",")[1])},setCookie:function(e,t,i){var n=new Date;n.setTime(n.getTime()+24*i*60*60*1e3);n="expires="+n.toUTCString();document.cookie=e+"="+encodeURIComponent(t)+";"+n+";path=/"},getCookie:function(e){for(var t=e+"=",i=decodeURIComponent(document.cookie).split(";"),n=0;n<i.length;n++){for(var a=i[n];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return""},onCancelButtonClick:function(){this.cancelCallback&&this.cancelCallback(),QuickBase.ErrorTooltip.clearAll(),this.$el.dialog("close"),this.remove()},onSelectButtonClick:function(){this.selectCallback&&this.selectCallback(this.path),this.onCancelButtonClick()},onTreeViewSelectProperty:function(e){this.path=e,this.$el.next().find("button:first").button({disabled:void 0===e}),this.updateProperties(e)},remove:function(){this.removeProperties(),Backbone.View.prototype.remove.call(this)},removeDialog:function(){this.$el.dialog&&this.$el.dialog("destroy"),Backbone.View.prototype.remove.call(this)},removeProperties:function(){this.form&&(this.form.remove(),this.form=null)},sayNoToSubmit:function(){return!1},updateProperties:function(t){var e,a=this,o=!1,s=a.model.getByPath(t);a.removeProperties(),s&&(s.get("value")||(o=!0),s.has("value")||s.set("value","",{silent:!0}),s.has("_default")||s.set("_default","",{silent:!0}),"dict"===s.get("_type")&&(s.schema.value.type="ThreeColumnDict",delete s.schema._default),_.includes(["date","datetime","time","timestamp","minute","second"],s.get("_type"))&&s.schema?(s.schema._default=BBForm.RTTI.getByName(s.get("_type")+"Rolling").editor,s.schema._default.options.editorModel=new Backbone.Model,s.get("_rolling")?s.schema._default.options.editorModel.set("rolling",!0):s.schema._default.options.editorModel.set("rolling",!1),this.listenTo(s.schema._default.options.editorModel,"change:rolling",function(e,t){s.set("_rolling",t),this.stopListening(s,"change:_default"),s.get("_rolling")&&(this.listenTo(s,"change:_default",function(){s.set("value",QuickBase.Helpers.convertRollingToDate(s.get("_default"),s.get("_type")))}),s.trigger("change:_default"))}),this.stopListening(s,"change:_default"),s.get("_rolling")&&this.listenTo(s,"change:_default",function(){s.set("value",QuickBase.Helpers.convertRollingToDate(s.get("_default"),s.get("_type")))})):s.unset("_rolling"),"list"!==s.get("_type")||s.get("_listtype")||s.set("_listtype","symbol"),s.schema._type.width="off",a.form=new BBForm({model:s,openViewStateDialog:function(e,t){new ViewStateDialog({dialogContainer:a.dialogContainer,disabledNodes:_.map(_.filter(a.model.attributes,function(e){return"dict"===e.get("_type")}),"path"),docDataModel:a.docDataModel,model:a.model,path:e,selectCallback:function(e){e=a.model.getByPath(e);t(e)}})},theme:"environment",viewStates:a.model.getViewStateList()}).render(),a.form.on("changeList",function(e,t){s.set("_default",e.getValue()._default),s.set("value",e.getValue().value)}),a.form.$el.on("submit",a.sayNoToSubmit),_.includes(["dict","list"],s.get("_type"))&&(e=$("<span />").addClass("fa fa-undo reset-to-default").prop("title","Reset to Default"),a.form.$el.find(".field-value label").append(e),e.click(function(){s.forceRender=!0,s.set("value",_.clone(s.get("_default"))),s.forceRender=!1})),a.$collapsibleContent.append(a.form.el),a.$collapsibleContent.scrollTop=0,a.form.fields._type&&s.schema&&s.schema._type&&a.form.fields._type.editor.setOptions(s.schema._type.options),a.debouncedUpdate=_.debounce(function(){var i,e,n;a.form&&(s.get("_type")!==a.form.getValue()._type?(s.set("_type",a.form.getValue()._type),a.removeProperties(),s.unset("value",{silent:!0}),s.unset("_default",{silent:!0}),s.updateSchema(),a.updateProperties(t),s.set("value",a.form.getValue().value),s.set("_default",a.form.getValue()._default)):(i=a.form.getValue(),e=a.form.validate({appendToBody:!0,onLeft:!1}),"dict"!==i._type||i._default||(i._default={},_.each(i.value,function(e,t){i._default[t]=e._default,i.value[t]=e.value})),e?(n=_.keys(e),_.each(i,function(e,t){_.includes(n,t)||s.set(t,e)})):s.set(i),o&&(s.get("_rolling")?s.set("value",QuickBase.Helpers.convertRollingToDate(s.get("_default"),s.get("_type"))):s.set("value",_.isDate(s.get("_default"))?s.get("_default").toISOString():_.clone(s.get("_default"))))))},300),a.listenTo(a.form,"change",a.debouncedUpdate),a.listenTo(a.form,"_default:blur value:focus",function(){o=!1}))}}),DataConfigQuery_Pivot=Backbone.View.extend({AGGREGATE_FNS:["count","sum","avg","max","min","first","last"],AGGREGATE_COLS_PROP:"_aggregateCols",AGGREGATE_FNS_PROP:"_aggregateFns",AGGREGATE_LABELS_PROP:"_aggregateLabels",BREAKDOWN_PROP:"_breakdownCols",initialize:function(e){var t=this;t.options=e,t.$el.html(T.DataConfigQuery_Pivot(_.extend({guid:_.uniqueId("pivot_"),hasAggregateViewState:t.model.get(t.AGGREGATE_COLS_PROP)instanceof Backbone.Model},this.model.toJSON()))),t.$el.find("._columnLabel").change(function(){t.model.set("_columnLabel",$(this).val())}),t.$el.find("._columnLabel").val(t.model.get("_columnLabel")||""),t.$aggregateContainer=t.$el.find(".aggregateContainer"),t.$aggregateList=t.$aggregateContainer.find(".aggregateList"),t.$aggregateViewStateCheckBox=t.$aggregateContainer.find(".viewStateCheckbox"),t.switchCache={},t.upgradeModel(),t.initPivotOptions(),t.initializeAggregateEvents(),t.updateLayout(),t.$aggregateViewStateCheckBox.is(":checked")?(t.aggregateViewStateCache=!0,t.aggregateColsCache=t.model.get(t.AGGREGATE_COLS_PROP),t.aggregateFnCache=t.model.get(t.AGGREGATE_FNS_PROP),t.aggregateLabelsCache=t.model.get(t.AGGREGATE_LABELS_PROP)):(t.aggregateViewStateCache=!1,t.aggregateColsCache=$.extend(!0,[],t.model.get(t.AGGREGATE_COLS_PROP)),t.aggregateFnCache=$.extend(!0,[],t.model.get(t.AGGREGATE_FNS_PROP)),t.aggregateLabelsCache=$.extend(!0,[],t.model.get(t.AGGREGATE_LABELS_PROP))),t.initializeEvents()},initializeEvents:function(){this.listenTo(this.model,"change:_aggregateCols",this.onAggregateDetailsChange),this.listenTo(this.model,"change:_columnLabel",this.displayColumnLabel)},addAggregateRow:function(e,t,i){i=new DataConfigAggregateRow({model:this.model,aggregateDetails:{aggCol:e,aggFn:t||"avg",aggLabel:i||""}});this.$aggregateList.find("ul").append(i.$el)},checkNewAggregateEntry:function(e,t,i){return(-1<this.AGGREGATE_FNS.indexOf(t)||-1<t.indexOf(";"))&&0<e.length&&0<t.length},displayColumnLabel:function(){this.$el.find("._columnLabel").val(this.model.get("_columnLabel"))},initializeAggregateEvents:function(){function t(){e=i.$el.find(".newAggregate .aggregateColItm").val(),newAggregateFn=i.$el.find(".newAggregate .aggregateFnItm").val(),newAggregateLabel=i.$el.find(".newAggregate .aggregateLabelItm").val(),i.model.get(i.AGGREGATE_COLS_PROP).push(e),i.model.get(i.AGGREGATE_FNS_PROP).push(newAggregateFn),i.model.get(i.AGGREGATE_LABELS_PROP).push(newAggregateLabel),i.$el.find(".newAggregate").toggleClass("hidden"),i.$el.find(".newAggregate .aggregateFnItm, .newAggregate .aggregateColItm, .newAggregate .aggregateLabelItm").val(""),i.$el.find(".newAggregate .aggregateFnItm").focus(),i.checkNewAggregateEntry(e,newAggregateFn,newAggregateLabel)||(i.$el.find(".newAggregate input").addClass("invalidEntry"),_.delay(function(){i.$el.find(".newAggregate input").removeClass("invalidEntry")},3e3)),i.model.trigger("change:_aggregateCols")}var e,i=this;i.$aggregateAddBtn=i.$el.find(".newAggregate .addBtn"),i.$aggregateCancelBtn=i.$el.find(".newAggregate .cancelBtn"),i.$aggregateResetBtn=i.$el.find(".resetBtn"),i.$aggregateSaveBtn=i.$el.find(".newAggregate .saveBtn"),i.$aggregateAddBtn.button({icons:{primary:"fa fa-plus"},text:!1}).click(t),i.$aggregateResetBtn.button({icons:{primary:"fa fa-repeat"},text:!1}).click($.proxy(i.resetAggregateCols,i)),i.$aggregateViewStateCheckBox.button({icons:{primary:"fa fa-eye"},text:!1}).click($.proxy(i.onViewStateCheckBoxClick,i)),i.$el.find(".newAggregate input").on("keydown",function(e){13===e.which&&t()}),i.initializeAggregateViewstate()},initializeAggregateViewstate:function(){var i=this,e={};e[i.AGGREGATE_COLS_PROP]={title:"Columns:",type:"ViewState"},e[i.AGGREGATE_FNS_PROP]={title:"Functions:",type:"ViewState"},e[i.AGGREGATE_LABELS_PROP]={title:"Labels:",type:"ViewState"},this.aggregateViewStateForm=new BBForm({model:i.model,openViewStateDialog:function(e,t){new ViewStateDialog({dialogContainer:i.options.dialogContainer,docDataModel:i.options.docDataModel,model:i.options.docViewModel,path:e,selectCallback:function(e){e=i.options.docViewModel.getByPath(e);t(e)}})},placeholder:"Type aggregate column name and hit enter",removeDuplicates:!0,schema:e}).render(),this.aggregateViewStateForm.on("change",function(){i.aggregateViewStateForm.commit()}),i.$el.find(".aggregateViewState").append(i.aggregateViewStateForm.el)},initPivotOptions:function(){var i=this;this.model.schema={},this.model.schema[this.BREAKDOWN_PROP]="ListViewState",this.breakdownPanel=new BBForm({model:this.model,openViewStateDialog:function(e,t){new ViewStateDialog({dialogContainer:i.options.dialogContainer,docDataModel:i.options.docDataModel,model:i.options.docViewModel,path:e,selectCallback:function(e){e=i.options.docViewModel.getByPath(e);t(e)}})},placeholder:"Type breakdown column name and hit enter",removeDuplicates:!0}).render(),this.breakdownPanel.on("change",function(){i.breakdownPanel.commit()}),this.breakdownPanel.on("changeList",function(e){i.model.set(i.BREAKDOWN_PROP,e.getValue()[i.BREAKDOWN_PROP])}),this.$el.find("."+this.BREAKDOWN_PROP).append(this.breakdownPanel.el),this.populateAggregateDetails()},onAggregateDetailsChange:function(e){e&&e.forceRender&&this.breakdownPanel&&this.aggregateViewStateForm?(e=this.model.get(this.AGGREGATE_COLS_PROP)instanceof Backbone.Model,this.breakdownPanel.off(),this.breakdownPanel.remove(),this.aggregateViewStateForm.off(),this.aggregateViewStateForm.remove(),this.$aggregateViewStateCheckBox.prop("checked",e),this.initPivotOptions(),this.initializeAggregateViewstate(),this.updateLayout()):this.populateAggregateDetails()},onViewStateCheckBoxClick:function(){var n=this;_.each([n.AGGREGATE_COLS_PROP,n.AGGREGATE_FNS_PROP,n.AGGREGATE_LABELS_PROP],function(e){var t=n.model.get(e),i=(i=n.switchCache[e])||(n.$aggregateViewStateCheckBox.is(":checked")?"":[]);n.model.set(e,i),n.switchCache[e]=t}),this.updateLayout()},populateAggregateDetails:function(){var a=this;a.model.get(a.AGGREGATE_COLS_PROP);a.$aggregateViewStateCheckBox.is(":checked")||(a.$aggregateList.find("li").remove(),0<a.model.get(a.AGGREGATE_COLS_PROP).length?a.$aggregateList.find("ul").addClass("populated-list"):a.$aggregateList.find("ul").removeClass("populated-list"),_.each(a.model.get(a.AGGREGATE_COLS_PROP),function(e,t){var i=a.model.get(a.AGGREGATE_FNS_PROP)||[],n=a.model.get(a.AGGREGATE_LABELS_PROP)||[];i[t]||(i[t]="avg"),n[t]||(n[t]=""),a.addAggregateRow(e,i[t],n[t])}),a.$aggregateList.find("ul").sortable({handle:".moveRow",placeholder:"ui-state-highlight",scrollSensitivity:5,scrollSpeed:5,axis:"y",stop:function(){a.model.set({_aggregateCols:[],_aggregateFns:[],_aggregateLabels:[]},{silent:!0}),_.each(a.$aggregateList.find("li"),function(e){a.model.get(a.AGGREGATE_COLS_PROP).push($(e).find(".aggregateColItm").val()),a.model.get(a.AGGREGATE_FNS_PROP).push($(e).find(".aggregateFnItm").val()),a.model.get(a.AGGREGATE_LABELS_PROP).push($(e).find(".aggregateLabelItm").val())}),a.model.trigger("change:_aggregateCols")}}))},refreshPivotDetails:function(){},remove:function(){this.$aggregateAddBtn.off(),this.$aggregateResetBtn.off(),this.$aggregateViewStateCheckBox.off(),Backbone.View.prototype.remove.call(this)},resetAggregateCols:function(){this.$aggregateViewStateCheckBox.prop("checked",this.aggregateViewStateCache),this.model.set(this.AGGREGATE_COLS_PROP,this.aggregateColsCache),this.model.set(this.AGGREGATE_FNS_PROP,this.aggregateFnCache),this.model.set(this.AGGREGATE_LABELS_PROP,this.aggregateLabelsCache),this.populateAggregateDetails(),this.updateLayout()},updateLayout:function(){this.$aggregateViewStateCheckBox.is(":checked")?this.$aggregateContainer.addClass("isViewState"):this.$aggregateContainer.removeClass("isViewState")},upgradeModel:function(){var e;this.model.has(this.AGGREGATE_LABELS_PROP)||(e=this.model.get(this.AGGREGATE_COLS_PROP),this.model.set(this.AGGREGATE_LABELS_PROP,_.map(e instanceof Backbone.Model?e.get("value"):e,function(){return""})))}}),qFunctionKeywordsOutsideSheet="aj0|wj1",qFunctionKeywords="abs|aj|acos|all|and|any|asc|asin|asof|atan|attr|avg|avgs|bin|binr|by|ceiling|cols|cor|cos|count|cov|cross|csv|cut|delete|deltas|desc|dev|differ|distinct|div|do|dsave|each|ej|ema|enlist|eval|except|exec|exit|exp|fby|fills|first|flip|floor|fkeys|from|get|getenv|group|gtime|hclose|hcount|hdel|hopen|hsym|iasc|idesc|if|ij|in|insert|inter|inv|key|keys|last|ljf|like|lj|load|log|lower|lsq|ltime|ltrim|mavg|max|maxs|mcount|md5|mdev|med|meta|min|mins|mmax|mmin|mmu|mod|msum|neg|next|not|null|or|over|parse|peach|pj|prd|prds|prev|prior|rand|rank|ratios|raze|read0|read1|reciprocal|reval|reverse|rload|rotate|rsave|rtrim|save|scan|scov|sdev|svar|select|set|setenv|show|signum|sin|sqrt|ss|ssr|string|sublist|sum|sums|sv|system|tables|tan|til|trim|type|uj|ungroup|union|update|upper|upsert|value|var|view|views|vs|wavg|where|while|within|wj|wsum|ww|xasc|xbar|xcol|xcols|xdesc|xexp|xgroup|xkey|xlog|xprev|xrank",helperFunctionKeywords="asBoolean|asByte|asChar|asDate|asDatetime|asFloat|asGUID|asInt|asList|asLong|asMinute|asMonth|asReal|asSecond|asShort|asString|asSymbol|asTime|asTimespan|asTimestamp|asType|catch|INFINITY|isAtom|isBoolean|isByte|isChar|isCompound|isDate|isDatetime|isDict|isDictionary|isEmpty|isEnum|isFloat|isFunction|isGeneral|isGUID|isInfinity|isInt|isKeyedTable|isLinked|isList|isLong|isMinute|isMonth|isNull|isNumber|isReal|isSecond|isShort|isString|isSymbol|isTable|isTime|isTimespan|isTimestamp|isType|isVector|NULL|parseBoolean|parseByte|parseChar|parseDate|parseDatetime|parseFloat|parseGUID|parseInt|parseLong|parseMinute|parseMonth|parseReal|parseSecond|parseShort|parseSymbol|parseTime|parseTimespan|parseTimestamp|parseType|typeOf|typeSymbol|until|xor",illegalQKeywords="Mlim|Q7|access|accp|adict|arch|assign|badtail|branch|cast|char|conn|constants|domain|elim|glim|globals|length|limit|locals|loop|mismatch|mq|noamend|nosocket|noupdate|nyi|os|par|params|part|pl|pwuid|splay|srv|stack|step|stop|stype|sys|threadview|unmappable|upd|user|utf8|vd1|wha|wsfull|wsm",illegalQKeywordsRegex=new RegExp("^("+illegalQKeywords+")\\b"),StringStream=(OK.prototype.eol=function(){return this.pos>=this.string.length},OK.prototype.sol=function(){return this.pos==this.lineStart},OK.prototype.peek=function(){return this.string.charAt(this.pos)||void 0},OK.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},OK.prototype.eat=function(e){var t=this.string.charAt(this.pos),e="string"==typeof e?t==e:t&&(e.test?e.test(t):e(t));if(e)return++this.pos,t},OK.prototype.eatWhile=function(e){for(var t=this.pos;this.eat(e););return this.pos>t},OK.prototype.eatSpace=function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},OK.prototype.skipToEnd=function(){this.pos=this.string.length},OK.prototype.skipTo=function(e){e=this.string.indexOf(e,this.pos);if(-1<e)return this.pos=e,!0},OK.prototype.backUp=function(e){this.pos-=e},OK.prototype.column=function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=countColumn(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},OK.prototype.indentation=function(){return countColumn(this.string,null,this.tabSize)-(this.lineStart?countColumn(this.string,this.lineStart,this.tabSize):0)},OK.prototype.match=function(e,t,i){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&0<n.index?null:(n&&!1!==t&&(this.pos+=n[0].length),n)}n=function(e){return i?e.toLowerCase():e};if(n(this.string.substr(this.pos,e.length))==n(e))return!1!==t&&(this.pos+=e.length),!0},OK.prototype.current=function(){return this.string.slice(this.start,this.pos)},OK.prototype.hideFirstChars=function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}},OK.prototype.lookAhead=function(e){var t=this.lineOracle;return t&&t.lookAhead(e)},OK.prototype.baseToken=function(){var e=this.lineOracle;return e&&e.baseToken(this.pos)},OK);function OK(e,t,i){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0,this.lineOracle=i}function countColumn(e,t,i,n,a){null==t&&-1==(t=e.search(/[^\s\u00a0]/))&&(t=e.length);for(var o=n||0,s=a||0;;){var r=e.indexOf("\t",o);if(r<0||t<=r)return s+(t-o);s+=r-o,s+=i-s%i,o=r+1}}var State=(tL.prototype.clone=function(){return new tL(this)},tL.prototype.equals=function(e){return e===this},tL);function tL(e){var t=e.mode,i=e.prevToken,n=e.braceDepth,a=e.qukeMixed,e=e.depth;this.mode=t,this.prevToken=i,this.braceDepth=n,this.qukeMixed=a,this.depth=e}var tokenFunction=function(t,e){function o(e,t){return t.mode!==G.afterCloseBracket&&e.match(H,!0,!1)?(t.mode=G.afterVarNumSym,m(t,"number")):(t.mode=G.afterPunctuation,m(t,"keyword"))}function n(e,t,i){return e.match(O,!0,!1),t.mode=G.afterVarNumSym,m(t,i)}function s(e,t){for(;;){if(e.eat('"'))return t.mode=G.afterPunctuation,m(t,"string");if(e.eol())return t.mode=G.unclosedString,m(t,"string");if(e.eat("\\")){if(!e.eat(A))return e.next(),m(t,"error-invalidEscape")}else e.next()}}function r(e,t){return e.eat(_)?e.match(T,!0,!1):e.eat(":")&&e.match($,!0,!1),t.mode=G.afterVarNumSym,m(t,"symbol")}function l(e,t){var i=e.match(B,!0,!1);return t.mode=G.afterVarNumSym,S.test(i[0])?m(t,"error-datetime"):j.test(i[0])?m(t,"keyword"):k.test(i[0])?m(t,"error-illegalKeyword"):e.eat(".")?n(e,t,"variable"):a&&i[0].match(D)?m(t,"cell"):m(t,"variable")}function c(e,t){return e.match(E,!0)?(e.skipToEnd(),m(t,"toDo")):(e.skipToEnd(),m(t,"comment"))}function d(e,t){return e.eol()||e.match(I)?(e.eatSpace(),t.mode=G.commentTilEnd,e.skipToEnd(),m(t,"error-multilineComment")):0<t.depth?(t.mode=G.afterPunctuation,m(t,"error-unindentedToken")):(t=t,((e=e).match(M,!0,!1)?function(e,t){return e.eat(" ")||e.eol()?m(t,"command"):i(e,t)}:i)(e,t))}function i(e,t){return e.skipToEnd(),m(t,"command")}function p(e,t){return e.match(b,!1,!1)?n(e,t,"keyword"):e.match(L,!0,!1)?m(t,"error-reservedInContext"):e.match(x,!1,!1)?n(e,t,"variable"):e.match(R,!0,!1)?(t.mode=G.afterVarNumSym,m(t,"number")):(t.mode=G.afterPunctuation,m(t,"keyword"))}function u(e,t){return e.eatWhile(":"),t.mode=G.afterPunctuation,m(t,"keyword")}function h(e){return e.depth--,e.mode=G.afterCloseBracket,null}function g(e){return e.depth++,e.mode=G.afterOpenBracket,null}function m(e,t){return e.prevToken=t}var a=!!e.isSpreadsheet,f=/^[\[({]/,v=/^[\])}]/,b=/^[a-zA-Z](\.|$|(?![a-zA-Z0-9_]))/,y=/^[~!@#$%^&*:<>,\?|+=_-]/,w=/^[012]:/,C=/^(&&|\|\||(<>|[<>]=):|[~!@#$%\^&*\-_+\\,?]=)/,k=new RegExp("^("+illegalQKeywords+")\\b"),S=/^(asDatetime|parseDatetime)$/,x=/^[a-zA-Z]/,_=/^[a-zA-Z0-9.]/,$=/^[a-zA-Z0-9._/:]*/,T=/^[a-zA-Z0-9._]*(:[a-zA-Z0-9._/:]*)?/,D=/^[a-zA-Z][a-zA-Z]?[1-9][0-9]*\b/,M=/^([abBcCdefgopPsStTuvwWxz]|ts)\b/,E=/^\/*\s*@?TODO\b/i,P=/^k\)/,A=/^([\\\/nrt"0-7])/,I=/^\s+$/,B=/^[a-zA-Z0-9_]*/,O=/^[a-zA-Z0-9_]*(\.[a-zA-Z0-9_]+)*\.?/,L=new RegExp("^[a-zA-Z0-9_]+\\.("+qFunctionKeywords+"|"+helperFunctionKeywords+")(\\.[a-zA-Z0-9_]+)*\\.?\\b"),R=/^([0-9]+(f|e(-?[0-9]+e?)?)?|(f|e(-?[0-9]+e?)?))/,V="[10]+b",N="0x[\\da-fA-Fa-f]*",z=["0[nNwW][hjemdzuvtifpgn]?",V,N,"\\d{4}\\.\\d{2}([ptnm]|\\.\\d{2}([DPtdp](\\d{2}(:\\d{2}(:\\d{2}(\\.\\d{0,9})?)?)?)[pn]?|[pnd]?))","\\d{2}:\\d{2}(:\\d{2}(\\.\\d{0,9})?)?[ptnvu]?|\\d{2}[ptnvu]","\\d{1,6}D(\\d{1,2}(:\\d{2}(:\\d{2}(\\.\\d{0,9}|\\.?)?)?)?)?[np]?","\\d{1,6}P\\d{2}:\\d{2}([np]|:\\d{2}([np]|\\.[np]|\\.\\d{0,9}[np]|\\.\\d{3,9}[np]?))","(\\d+(\\.\\d*)?|\\d*\\.\\d+)(e[+-]?\\d+)[ef]?|(\\d+\\.\\d*|\\d*\\.\\d+)[ef]?|\\d+[eihjf]?"].join("|"),F=new RegExp("^("+V+"|"+N+"|"+z+")"),H=new RegExp("^("+z+")"),j=new RegExp("^("+qFunctionKeywords+"|"+helperFunctionKeywords+(a?"":"|"+qFunctionKeywordsOutsideSheet)+")\\b"),G={SOL:0,afterSpace:1,afterVarNumSym:2,afterPunctuation:3,unclosedString:4,multilineComment:5,commentTilEnd:6,afterOpenBracket:7,afterCloseBracket:8};return{startState:function(){return new State({mode:G.SOL,prevToken:null,braceDepth:0,qukeMixed:!!e.qukeMixed,depth:0})},indent:function(e){return t.indentUnit*e.depth},token:function(e,t){if(e.sol()&&t.mode!==G.commentTilEnd&&t.mode!==G.multilineComment&&t.mode!==G.unclosedString&&(t.mode=G.SOL,t.prevToken="SOL"),t.mode===G.unclosedString)return e.eat("\\")?m(t,"error-SOLBackslashInString"):s(e,t);if(t.mode===G.SOL){if(e.eatSpace())return t.mode=G.afterSpace,null;if(e.eat("/"))return a=t,(n=e).eol()||n.match(I)?(n.eatSpace(),a.mode=G.multilineComment,m(a,"error-multilineComment")):c(n,a);if(!t.qukeMixed&&0<t.depth&&")"!==e.peek()&&"]"!==e.peek()&&"}"!==e.peek())return e.next(),m(t,"error-unindentedToken");if(e.match(P,!1,!1))return i=t,e.skipToEnd(),m(i,"command");if(e.match(x,!1,!1))return l(e,t);if(e.eat(";"))return t.mode=G.afterPunctuation,null;if(e.eat("\\"))return d(e,t);if(e.eat("`"))return r(e,t);if(e.eat("."))return p(e,t);if(e.eat('"'))return s(e,t);if(e.eat("'"))return u(e,t);if(e.eat("-"))return o(e,t);if(e.match(C,!0,!1))return t.mode=G.afterPunctuation,m(t,"error");if(e.eat(y))return t.mode=G.afterPunctuation,m(t,"keyword");if(e.eat(f))return g(t);if(e.eat(v))return h(t),m(t,"error-unindentedToken");if(e.match(w,!0,!1))return t.mode=G.afterPunctuation,m(t,"keyword");if(e.match(F,!0,!1))return t.mode=G.afterVarNumSym,m(t,"number")}else if(t.mode===G.afterSpace){if(e.eatSpace(),e.match(x,!1,!1))return l(e,t);if(e.eat(";"))return t.mode=G.afterPunctuation,null;if(e.eat("/"))return c(e,t);if(e.eat("`"))return r(e,t);if(e.eat("."))return p(e,t);if(e.eat('"'))return s(e,t);if("\\"===e.peek()&&"SOL"===t.prevToken)return e.next(),m(t,"error-indentedCommand");if(e.eat(/['\\]/))return u(e,t);if(e.eat("-"))return o(e,t);if(e.match(C,!0,!1))return t.mode=G.afterPunctuation,m(t,"error");if(e.eat(y))return t.mode=G.afterPunctuation,m(t,"keyword");if(e.eat(f))return g(t);if(e.eat(v))return h(t);if(e.match(w,!0,!1))return t.mode=G.afterPunctuation,m(t,"keyword");if(e.match(F,!0,!1))return t.mode=G.afterVarNumSym,m(t,"number")}else if(t.mode===G.afterVarNumSym){if(e.eatSpace())return t.mode=G.afterSpace,null;if(e.eat(";"))return t.mode=G.afterPunctuation,null;if(e.eat("`"))return r(e,t);if(e.eat('"'))return s(e,t);if(e.eat(/['/\\]/))return u(e,t);if(e.match(C,!0,!1))return t.mode=G.afterPunctuation,m(t,"error");if(e.eat(y))return t.mode=G.afterPunctuation,m(t,"keyword");if(e.eat(f))return g(t);if(e.eat(v))return h(t);if(e.match(/^[Tz]/))return t.mode=G.afterPunctuation,m(t,"error-datetime")}else if(t.mode===G.afterPunctuation||t.mode===G.afterOpenBracket||t.mode===G.afterCloseBracket){if(e.eatSpace())return t.mode=G.afterSpace,null;if(e.match(x,!1,!1))return l(e,t);if(e.eat(";"))return t.mode=G.afterPunctuation,null;if(e.eat("`"))return r(e,t);if(e.eat("."))return p(e,t);if(e.eat('"'))return s(e,t);if(e.eat(/['/\\]/))return u(e,t);if(e.eat("-"))return o(e,t);if(e.match(C,!0,!1))return t.mode=G.afterPunctuation,m(t,"error");if(e.eat(y))return t.mode=G.afterPunctuation,m(t,"keyword");if(e.eat(f))return g(t);if(e.eat(v))return h(t);if(e.match(w,!0,!1))return t.mode=G.afterPunctuation,m(t,"keyword");if(e.match(F,!0,!1))return t.mode=G.afterVarNumSym,m(t,"number")}else{if(t.mode===G.commentTilEnd)return e.skipToEnd(),m(t,"comment");if(t.mode===G.multilineComment)return i=t,(t=e).eat("\\")&&(t.eol()||t.match(I))?(t.eatSpace(),i.mode=G.SOL):t.skipToEnd(),m(i,"error-multilineComment")}var i,n,a;return e.next()}}},tokenizer=tokenFunction({},{name:"q",isSpreadsheet:"false"}),MonacoHelpers=(oN.DEFAULT_OPTIONS=function(){return{automaticLayout:!0,theme:"kx-light"!==$.cookie("dashboard-theme")?"vs-dark":"vs",contextmenu:!0,autoIndent:!0,fixedOverflowWidgets:!0,fontSize:12,lineDecorationsWidth:0,lineNumbersMinChars:2,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on",dragAndDrop:!1}},oN.adjustAfterResize=function(e){e&&e._domElement&&e.updateOptions({minimap:{enabled:800<e._domElement.clientWidth}})},oN.require=function(e,n){var t=e.language;require(oN.MONACO_PATH,function(i){switch(t){case"handlebars":oN.registerHandlebarFormatting(function(){oN.registerHandlebarIntellisense(function(e){var t=e.docs,e=e.disposable;n({monaco:i,docs:t,disposable:e})})});break;case"javascript":oN.registerLodashIntellisense(function(e){n({monaco:i,unload:e})});break;case"q":oN.registerQLanguage(),oN.fetchAutoCompleteItems(function(e){n({monaco:i,autocompleteItems:e})});break;default:n({monaco:i})}})},oN.fetchAutoCompleteItems=function(t){$.ajax("../modules/vendor/types/q.json").then(function(e){e=e.autocompleteItems;t(e)})},oN.registerHandlebarFormatting=function(e){require(["polyfill"],function(){require(["beautify-html"],function(i){monaco.languages.registerDocumentFormattingEditProvider("handlebars",{provideDocumentFormattingEdits:function(e){var t=e.getValue(),t=i.html_beautify(t);return[{range:e.getFullModelRange(),text:t}]}}),e()})})},oN.registerLodashIntellisense=function(t){monaco.languages.typescript.javascriptDefaults.setCompilerOptions({target:monaco.languages.typescript.ScriptTarget.ES5,allowNonTsExtensions:!0}),$.ajax("../modules/vendor/types/lodash.d.ts").then(function(e){t(monaco.languages.typescript.javascriptDefaults.addExtraLib(e))})},oN.registerHandlebarIntellisense=function(t){$.ajax("../modules/vendor/types/handlebarhelpersdocs.json").then(function(a){var o=function(e){for(var t=0,i=[];;){var n=e.substring(t),a=n.indexOf("{{");if(t>e.length||a<0)break;n=n.indexOf("}}");i.push([a+t,n+t]),t=n+t+2}return i},e=monaco.languages.registerHoverProvider("handlebars",{provideHover:function(e,t){var i=t.lineNumber,t=t.column;return function(e,t){var i=t.lineNumber,n=t.column,t=o(e).find(function(e){return n>=e[0]&&n<=e[1]});if(t&&e.match(/{{#?([A-Za-z]+)/)){e=e.match(/{{#?([A-Za-z]+)/)[1];return{range:{startLineNumber:i,startColumn:t[0]+1,endColumn:t[1]+3,endLineNumber:i},contents:a[e]?[{value:a[e].comment.replace(/(\/\*\*|\*\/|\*)/g,"").replace(/\n/g,"  \n").replace(/(```handlebars|```)/g,"`")}]:[]}}}(e.getLineContent(i),{lineNumber:i,column:t})}});t({docs:a,disposable:e})})},oN.getScopeFromStyle=function(e){switch(e){case null:return"default";case"error-multilineComment":return"comment.block";case"symbol":return"symbol";case"error-unindentedToken":return"invalid";default:return e}},oN.registerQLanguage=function(){monaco.languages.register({id:"q"}),monaco.editor.defineTheme("q-theme",{base:"vs-dark",inherit:!0,rules:[{background:"#161616",foreground:"#aaaaaa"},{token:"number",background:"#ce3595",foreground:"#ce3595"},{token:"keyword",background:"#161616",foreground:"#bd9c39"},{token:"string",background:"#161616",foreground:"#78abd2"},{token:"variable",background:"#161616",foreground:"#bdbdbd"},{token:"symbol",background:"#161616",foreground:"#8e7bbb"}],colors:{"editor.background":"#161616","editorLineNumber.foreground":"#8d8d8d"}}),monaco.editor.defineTheme("q-theme-light",{base:"vs",inherit:!0,rules:[{background:"#ffffff",foreground:"#09026f"},{token:"number",background:"#ffffff",foreground:"#0000ef"},{token:"keyword",background:"#ffffff",foreground:"#996900"},{token:"comment",background:"#ffffff",foreground:"#109900"},{token:"string",background:"#ffffff",foreground:"#006b99"},{token:"variable",background:"#ffffff",foreground:"#09026f"},{token:"symbol",background:"#ffffff",foreground:"#845df4"}],colors:{"editor.background":"#ffffff","editorLineNumber.foreground":"#09026f"}}),monaco.languages.setTokensProvider("q",{getInitialState:function(){return tokenizer.startState()},tokenize:function(e,t){for(var i=new StringStream(e),n=[];!i.eol();){var a=tokenizer.token(i,t);n.push({scopes:oN.getScopeFromStyle(a),startIndex:i.start}),i.start=i.pos}return{endState:t,tokens:n}}}),monaco.languages.setLanguageConfiguration("q",{brackets:[["{","}"],["[","]"],["(",")"]],autoClosingPairs:[],indentationRules:{decreaseIndentPattern:void 0,increaseIndentPattern:/[{(\[]/},onEnterRules:[{beforeText:/^[^\[]*[})\]]/,action:{indentAction:3}}]})},oN.MONACO_PATH=["vs/editor/editor.main"],oN);function oN(){}Handlebars.registerHelper("type-cast",function(e,t){return e.toLowerCase()});var DataParameter=(nO=Backbone.View,__extends(oO,nO),oO.prototype.addParam=function(e,t,i,n,a,o,s){var r=this,s=new Backbone.Model({id:_.uniqueId("param_"),name:e,type:t,value:i,required:n,description:a,editable:!0,isViewState:s});this.listenTo(s,"change",this.updateValue);s=new oO(s,this.dataModel,this.docViewModel,this.vsCallback);this.listenTo(s,"paramRemoved",this.onParamRemoved),this.listenTo(s,"ValueChanged",function(){return r.updateValue()}),s.$el.appendTo(this.$listItems),this.parameters.push(s),o||this.updateValue()},oO.prototype.initializeEvents=function(){var e=this;this.listenTo(this.model,"change:type",this.onTypeChanged),this.listenTo(this.model,"change:name",function(){e.updateValue()}),this.$viewStateApply.on("click",this.showViewStateDialog.bind(this)),this.$viewStateDisplay.on("click",this.showViewStateDialog.bind(this)),this.$viewStateClear.on("click",this.onViewStateClear.bind(this)),this.$generateValue.on("click",this.generateViewState.bind(this)),this.$typeSelect.on("change",this.onTypeChange.bind(this)),this.$nameInput.on("change",this.onNameChange.bind(this))},oO.prototype.applyControlState=function(){this.model.get("isViewState")?this.$form.addClass("is-bound"):this.$form.removeClass("is-bound")},oO.prototype.disableListEditing=function(){this.$buttonRow.hide(),this.$listItems.hide()},oO.prototype.enableListEditing=function(){"dict"===this.model.get("type")&&(this.$buttonRow.show(),this.$listItems.show())},oO.prototype.getPath=function(){var e=this.dataModel.path;return e.substring(e.lastIndexOf("/")+1)+"/"+this.model.get("name")},oO.prototype.getInputValue=function(){var e=this.valueInput.getValue()||"";return _.isString(e)?e.replace("&lt;","<").replace("&gt;",">"):e},oO.prototype.generateViewState=function(){var i,n=this,a=this.docViewModel;this.viewStateName=this.getPath();var o=this.viewStateName.split("/")||[];return o.forEach(function(e,t){t===o.length-1?(a.has(e)||(i=new QuickBase.DocumentViewModel({_viewType:!0,_type:n.model.get("type").toLowerCase(),_default:n.model.get("value"),value:n.model.get("value")},null,null),a.set(e,i)),n.selectGeneratedViewState(n.viewStateName)):(a.has(e)||(t=new QuickBase.DocumentViewModel({},null,null),a.set(e,t)),a=a.getByPath(e))}),i},oO.prototype.onAddItemClicked=function(){this.addParam("parameter0","symbol","",!1,"")},oO.prototype.onNameChange=function(){var e=this.$nameInput.val();this.model.set({name:e})},oO.prototype.onParamRemoved=function(e){this.parameters=_.without(this.parameters,e),this.updateValue()},oO.prototype.onRemoveClick=function(){this.trigger("paramRemoved",this),this.remove()},oO.prototype.onSelectViewState=function(e){var t=this.docViewModel.getByPath(e);t?t&&t.has("_type")&&(this.model.set("type",t.get("_type")),this.model.set("isViewState",!0),this.model.set("value","<%"+e+"%>"),this.$viewStateInput.val(e),this.$viewStateDisplay.val(e),this.applyControlState(),this.disableListEditing(),this.trigger("ValueChanged")):this.onViewStateClear()},oO.prototype.onTypeChange=function(){var e=this.$typeSelect.val();"dict"===e?this.model.set({value:{},type:e}):this.model.set({type:e})},oO.prototype.onTypeChanged=function(){var t,e,i=this.model.get("type"),n=this;_.each(this.parameters,function(e){e.remove()}),this.parameters=[],this.$el.attr("data-type",i),this.$typeSelect.val(i).trigger("change"),"dict"===i?(this.enableListEditing(),this.removeValueInput(),"string"==typeof(e=n.model.get("value")||this.originalValue)?(i=e.split(""),_.each(i,function(e){6==(t=e.split("")).length&&n.addParam(t[0],t[1],t[2],t[3],t[4])})):"object"==typeof e&&_.each(e,function(t,e){try{n.addParam(t.name,t.type,t.value,!1,"",void 0,0===t.value.indexOf("<%"))}catch(e){console.error("Param error ",t)}})):(this.disableListEditing(),this.renderInput()),this.trigger("ValueChanged")},oO.prototype.onViewStateClear=function(){this.model.set("isViewState",!1),this.model.set("value",null),this.$viewStateInput.val(""),this.applyControlState(),this.$generateValue.removeClass("disabled"),this.enableListEditing(),this.trigger("ValueChanged")},oO.prototype.onValueInput=function(){this.model.set({value:this.getInputValue(),isViewState:!1}),this.trigger("ValueChanged")},oO.prototype.remove=function(){return _.each(this.parameters,function(e){e.remove()}),this.parameters=[],Backbone.View.prototype.remove.apply(this)},oO.prototype.removeValueInput=function(){this.valueInput&&(this.stopListening(this.valueInput),this.valueInput.remove(),this.valueInput=null)},oO.prototype.renderInput=function(){var e,t,i=this;this.removeValueInput(),this.$valueInput.empty(),(e=this.model.get("type"))&&(t=BBForm.RTTI.getByName(e),e=BBForm.editors[t.editor.type],this.valueInput=new e({id:_.uniqueId("valueInput_"),key:"value",model:this.model,schema:{editorClass:"data-parameter-editor",options:t.editor.options,validators:t.editor.validators}}).render(),this.$valueInput.append(this.valueInput.el),this.model.get("isViewState")||this.model.get("value")===this.getInputValue()||this.onValueInput()),this.listenTo(this.valueInput,"change changeList",function(){var e=i.valueInput.validate();e?i.setError(e.message):(i.setError(null),i.onValueInput())})},oO.prototype.sayNoToSubmit=function(){return!1},oO.prototype.selectGeneratedViewState=function(e){this.onSelectViewState(e),this.$generateValue.addClass("disabled")},oO.prototype.setError=function(e){e&&this.valueInput?(this.valueInput.$el.addClass("error"),this.$errorTooltip&&BBForm.ErrorTooltip.clear(this.$errorTooltip),this.$errorTooltip=BBForm.ErrorTooltip.show(e,this.$valueInput)):(this.valueInput.$el.removeClass("error"),BBForm.ErrorTooltip.clear(this.$errorTooltip))},oO.prototype.showViewStateDialog=function(){var t=this;this.vsCallback({beforeClose:function(){},close:function(){},cancelCallback:function(e){},path:this.$viewStateInput.val(),selectCallback:function(e){return t.onSelectViewState(e)}})},oO.prototype.updateValue=function(){var t;"dict"===this.model.get("type")&&(t={},_.each(this.parameters,function(e){t[e.model.get("name")]={type:e.model.get("type"),IsKdbParam:!0,isViewState:e.model.get("isViewState"),name:e.model.get("name"),value:e.model.get("value")}}),this.model.set({value:t})),this.trigger("ValueChanged")},oO),nO;function oO(e,t,i,n,a){var o=nO.call(this,{className:"data-parameter",model:e})||this;return o.parameters=[],o.viewStateName="",o.originalValue=o.model.get("value"),o.model.set({type:o.model.get("type").toLowerCase()},{silent:!0}),o.model=e,o.docViewModel=i,o.dataModel=t,o.vsCallback=n,o.$el.html(T.DataParameter(o.model.toJSON())),o.$form=o.$(".form-control"),o.$viewStateApply=o.$(".viewstate-apply"),o.$viewStateClear=o.$(".binding-clear"),o.$viewStateContainer=o.$(".binding-container"),o.$viewStateInput=o.$("input:not(.name-input)").attr("type","text"),o.$viewStateDisplay=o.$(".value-display"),o.$valueInput=o.$(".value-input"),o.$generateValue=o.$(".generate-value"),o.$typeSelect=o.$(".type-select"),o.$typeSelect.val(o.model.get("type")),o.$addItemBtn=o.$(".add-item-btn"),o.$listItems=o.$(".list-items"),o.$buttonRow=o.$(".button-row"),o.$nameInput=o.$(".name-input"),o.$removeItemBtn=o.$(".remove-item-btn"),o.$addItemBtn.button({icons:{primary:"fa fa-plus"},text:!1}).click($.proxy(o.onAddItemClicked,o)),0<o.$removeItemBtn.length&&o.$removeItemBtn.button({icons:{primary:"fa fa-minus"},text:!1}).click($.proxy(o.onRemoveClick,o)),a&&a.length&&o.$typeSelect.find("option").filter(function(e,t){return!_.includes(a,t.text)}).remove(),o.$typeSelect.select2({theme:"dashboards",width:"100%"}),o.$typeSelect.on("select2:open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")}),o.model.get("isViewState")&&o.model.get("value")?o.onSelectViewState(o.model.get("value").split("%")[1]):"dict"!==o.model.get("type")&&o.valueInput&&o.valueInput.setValue(o.model.get("value")),o.onTypeChanged(),_.defer(function(){o.viewStateName=o.getPath(),o.initializeEvents()}),o}var KdbTableCompletionProvider=(wP.prototype.provideCompletionItems=function(e,t,i,n){if(t.column<=1)return{suggestions:[]};try{var a=e.getLineContent(t.lineNumber).substring(0,t.column),o=a.lastIndexOf(" "),s=a.substring(o).trim(),r=new RegExp(_.escapeRegExp(s));return{suggestions:this.possibleTokens.filter(function(e){return!(t.column<=1)&&e.match(r)}).map(function(e){return{label:e,insertText:e,kind:monaco.languages.CompletionItemKind.Variable,range:{startLineNumber:t.lineNumber,startColumn:t.column-s.length,endLineNumber:t.lineNumber,endColumn:t.column+e.length-s.length}}})}}catch(e){return{suggestions:[]}}},wP);function wP(e){this.possibleTokens=e}var KdbFunctionCompletionProvider=(KP.prototype.provideCompletionItems=function(e,t,i,n){if(t.column<=1)return{suggestions:[]};try{var a=e.getLineContent(t.lineNumber).substring(0,t.column),o=a.lastIndexOf(" "),s=a.substring(o).trim(),r=new RegExp(_.escapeRegExp(a.substring(o).trim()));return{suggestions:this.possibleFns.filter(function(e){return!(t.column<=1)&&e.label.match(r)}).map(function(e){return{label:e.label,detail:e.detail,insertText:e.insertText,kind:monaco.languages.CompletionItemKind.Function,range:{startLineNumber:t.lineNumber,startColumn:t.column-s.length,endLineNumber:t.lineNumber,endColumn:t.column+e.insertText.length-s.length}}})}}catch(e){return{suggestions:[]}}},KP);function KP(e){this.possibleFns=e}var DataConfigQuery_Query=(YP=Backbone.View,__extends(ZP,YP),ZP.prototype.focusEditor=function(){this.editor&&this.editor.focus()},ZP.prototype.initializeEvents=function(){this.listenTo(this.params,"add reset remove",this.onParamsChanged),this.listenTo(this.model,"change:_queryParams",this.onModelParamsChange),this.listenTo(this.model,"change:_queryString",this.onModelTextChange),this.listenTo(this.model,"change:_connection",this.onModelConnectionChange),this.listenTo(this.model,"change:_dataSource",this.onModelDataSourceChange),this.debounceEditorChange=_.debounce($.proxy(this.onEditorTextChange,this),100),this.editor.onDidChangeModelContent(this.debounceEditorChange)},ZP.prototype.onModelDataSourceChange=function(){this.editor&&monaco.editor.setModelLanguage(this.editor.getModel(),"kdb"==this.model.get("_dataSource")?"q":"sql")},ZP.prototype.getTables=function(i){var e=this.model.get("_connection");QuickBase.DeltaClientLib.getQueryData(void 0,e,'raze (raze k!{@[{ {".",(string y),".",string x}[;x] each tables[`$".",string x] };x;{`}]} each k: key `; tables `.)',void 0,function(e){var t=e.rows;i(Object.keys(t[0]).map(function(e){return t[0][e]}))},function(){i([])})},ZP.prototype.getText=function(){return this.lastText},ZP.prototype.onEditorTextChange=function(){this.linter&&this.editor&&"kdb"===this.model.get("_dataSource")&&this.linter.postMessage({code:this.editor.getValue(),version:this.editor.getModel().getVersionId()}),this.lastText=this.editor.getValue(),this.model.set({_queryString:this.lastText}),this.updateParams()},ZP.prototype.onModelConnectionChange=function(){this.appModel.get("isLite")&&this.registerFnAutocomplete(),this.registerTableAutocomplete()},ZP.prototype.onModelParamsChange=function(){this.params.reset(this.model.get("_queryParams")||[])},ZP.prototype.onModelTextChange=function(e,t){(t=this.isTableUpdateDialog&&0===t.length?"{[add;upd;del]  }":t)!==this.lastText&&(this.lastText=t,this.editor.setValue(t))},ZP.prototype.onParamsChanged=function(){var n=this;_.each(n.paramViews,function(e){n.stopListening(e.model),e.remove()}),n.paramViews=[],n.params.each(function(t,e){try{"sql"===n.model.get("_dataSource")&&t.set("ShowRemoveButton",!0),t.set("index",e);var i=new DataParameter(t,n.model,n.docViewModel,function(e){new ViewStateDialog(_.extend({dialogContainer:n.dialogContainer,docDataModel:n.docDataModel,model:n.docViewModel},e))});n.listenTo(i.model,"change",n.updateModelParams),i.on("resizeEvent",function(e){_.delay(function(){},e)}),n.paramViews.push(i),n.$paramsBox.append(i.$el)}catch(e){console.error("Parameter editor error ",t)}}),n.querySection&&(n.querySection.params=n.params),0<n.paramViews.length?n.$paramsBox.show():n.$paramsBox.hide(),n.onResize()},ZP.prototype.onResize=function(){0<this.params.length?this.$el.find(".query-editor").css("bottom",this.$el.find(".params-box").height()+"px"):this.$el.find(".query-editor").css("bottom",0),this.editor&&monaco.editor.setTheme("kx-light"!==$.cookie("dashboard-theme")?"q-theme":"q-theme-light"),MonacoHelpers.adjustAfterResize(this.editor)},ZP.prototype.registerFnAutocomplete=function(){var a=this;MonacoHelpers.require({language:"q"},function(e){var t,i=e.monaco,n=e.autocompleteItems;a.fnAutocomplete&&(a.fnAutocomplete.dispose(),delete a.fnAutocomplete),a.appModel.get("isLite")?(t=function(e){e=e.rows.map(function(e){return e.parameters=e.parameters.rows,e}).sort(function(e,t){return e.name.localeCompare(t.name)}),e=n.concat(e.map(function(e){return{label:e.name,detail:e.description||e.name+"["+_.filter(e.parameters,function(e){return e.name}).map(function(e){return e.name}).join(";")+"]"}})).map(function(e){return __assign(__assign({},e),{insertText:e.label})});a.fnAutocomplete=i.languages.registerCompletionItemProvider("q",new KdbFunctionCompletionProvider(e))},QuickBase.DeltaClientLib.runAnalytic(".api.getFunctions",a.model.get("_connection"),[],t,function(){QuickBase.DeltaClientLib.getQueryData("q",a.model.get("_connection"),DataConfigAnalytic.LITE_FN_LIST,[],t,function(){})})):QuickBase.DeltaClientLib.getDeltaAnalytics(function(e){e=n.concat(e.map(function(e){return{label:e.name,detail:e.description}})).map(function(e){return __assign(__assign({},e),{insertText:e.label})});a.fnAutocomplete=i.languages.registerCompletionItemProvider("q",new KdbFunctionCompletionProvider(e))})})},ZP.prototype.registerTableAutocomplete=function(){var i=this;MonacoHelpers.require({language:"q"},function(e){var t=e.monaco;e.autocompleteItems;i.tableAutocomplete&&(i.tableAutocomplete.dispose(),delete i.fnAutocomplete),i.getTables(function(e){i.tableAutocomplete&&i.tableAutocomplete.dispose(),i.tableAutocomplete=t.languages.registerCompletionItemProvider("q",new KdbTableCompletionProvider(e))})})},ZP.prototype.remove=function(){return this.editor&&(this.editor=null),this.fnAutocomplete&&this.fnAutocomplete.dispose(),this.tableAutocomplete&&this.tableAutocomplete.dispose(),Backbone.View.prototype.remove.call(this)},ZP.prototype.updateModelParams=function(){this.stopListening(this.model,"change:_queryParams"),this.model.set("_queryParams",this.params.toJSON()),this.listenTo(this.model,"change:_queryParams",this.onModelParamsChange)},ZP.prototype.updateParams=function(){var n,e,t,a=this,o=!1,s=[];a.isTableUpdateDialog||("kdb"!==a.model.get("_dataSource")&&"deltaclient"!==a.model.get("_dataSource")||(e=a.deltaParameterRx.exec(a.model.get("_queryString")),t=_.map(a.model.get("_queryString").match(a.inlineParameterRx),function(e){return e.substring(2,e.length-2)}),0<(t=(e?e[1].split(";"):[]).concat(t)).length?(o=t.length!==a.params.length,_.each(t,function(e,t){var i=a.params.findWhere({name:e});i?(s.push(i),o=o||i.get("index")===t,i.set({index:t},{silent:!0})):(n=new Backbone.Model({name:e,index:t,type:"symbol",value:"",IsKdbParam:!0}),s.push(n),o=!0)})):a.params.reset([]),o&&a.params.reset(s)),a.updateModelParams())},ZP),YP;function ZP(i){var a=YP.call(this,i)||this;return a.tagName="div",a.deltaParameterRx=/^{\[([a-z0-9A-Z\;\w\/ ]+?)\]/,a.inlineParameterRx=/<%[^<>%]+%>/g,a.params=new Backbone.Collection,a.docDataModel=i.docDataModel,a.docViewModel=i.docViewModel,a.appModel=i.appModel,a.dialogContainer=i.dialogContainer,a.isTableUpdateDialog=i.isTableUpdateDialog,a.$el.html(T.DataConfigQuery_Query(a.model.toJSON())),a.$paramsBox=a.$el.find(".params-box"),a.lastText=a.model.get("_queryString"),Worker&&(a.linter=new Worker(requirejs.toUrl("qlinter")+".js")),MonacoHelpers.require({language:"q"},function(e){var n=e.monaco;a.editor||(e=a.$el.find(".query-editor")[0],a.editor=n.editor.create(e,_.assign({},MonacoHelpers.DEFAULT_OPTIONS(),{value:a.lastText,language:"kdb"===a.model.get("_dataSource")?"q":"sql",theme:"kx-light"!==$.cookie("dashboard-theme")?"q-theme":"q-theme-light",fontFamily:'"Lucida Console", Monaco, monospace',fontSize:"12px",wordWrap:!0,tabSize:2,readOnly:!i.appModel.get("CanExecuteQueries")})),a.editor.addAction({id:"Execute",label:"Execute Data Source",keybindings:[n.KeyMod.chord(n.KeyMod.CtrlCmd|n.KeyCode.Enter)],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(e){var t=e.getModel().getValueInRange(e.getSelection());return a.deltaParameterRx.exec(t)?i.execute(t):t?i.execute("{["+a.params.map(function(e){return e.get("name")}).join(";")+"] "+t+"}"):i.execute(e.getValue()),null}}),a.editor.addAction({id:"Help-Menu",label:"Help",keybindings:[n.KeyMod.CtrlCmd|n.KeyCode.F10,n.KeyMod.chord(n.KeyMod.CtrlCmd|n.KeyCode.KEY_Q)],precondition:null,keybindingContext:null,contextMenuGroupId:"navigation",contextMenuOrder:1.5,run:function(e){var t=e.getModel().getValueInRange(e.getSelection()),e="https://code.kx.com/v2/ref/";return window.open(t?e+t:e,"_blank"),null}}),document.activeElement instanceof HTMLInputElement||a.editor.focus(),a.linter&&a.linter.addEventListener("message",function(e){var t=e.data,i=t.markers,e=t.version,t=a.editor.getModel();t&&t.getVersionId()===e&&"kdb"===a.model.get("_dataSource")?n.editor.setModelMarkers(t,"lint",i):t&&n.editor.setModelMarkers(t,"lint",[])}),a.registerFnAutocomplete(),a.registerTableAutocomplete()),a.onModelParamsChange(),a.updateParams(),a.onParamsChanged(),a.onEditorTextChange(),a.initializeEvents()}),a}var DataConfigQuery_Update=(lR=Backbone.View,__extends(mR,lR),mR.prototype.initializeEvents=function(){this.listenTo(this.params,"add reset remove",this.onParamsChanged),this.listenTo(this.model,"change:_updateQueryParams",this.onModelParamsChange),this.listenTo(this.model,"change:_updateQueryString",this.refreshQueryEditor),this.listenTo(this.model,"change:_updateType",this.onUpdateTypeChange)},mR.prototype.onUpdateTypeChange=function(){"analytic"===this.model.get("_updateType")?(this.$el.find(".update-editor").hide(),this.$el.find(".fa-info-circle").hide(),this.$el.find(".update-analytic-picker").show(),this.$paramsBox.hide(),this.datagridAppWrapper&&this.datagridAppWrapper.onResize()):(this.$paramsBox.show(),this.$el.find(".update-editor").show(),this.$el.find(".fa-info-circle").show(),this.$el.find(".update-analytic-picker").hide())},mR.prototype.onModelParamsChange=function(){this.params.reset(this.model.get("_updateQueryParams")||[])},mR.prototype.initializeAnalyticPicker=function(){var a=this;require(["Datagrid"],function(e){var t,i,n="Dark";"kx-light"===$.cookie("dashboard-theme")&&(n="Light"),t=a.model.get("_updateAnalytic"),(i=new QuickBase.DocumentDataModel({_subscriptionKey:"name",_dataType:"copy",_maxRows:1e5},null,null,null)).apply(),a.selectedUpdateAnalytic=new QuickBase.DocumentViewModel({_default:t,_viewType:!0,_type:"symbol",value:t},null),a.listenTo(a.selectedUpdateAnalytic,"change:value",function(e,t){t&&a.model.set("_updateAnalytic",t)}),e=e.getSettingsModel({Basics:{Data:i,Filtering:"Column Filters",ShowPagingControl:!1,EnableGrouping:!1},ColumnsConfiguration:[e.getColumnSettingsModel({Field:"name",TextAlign:"left"})],Selection:{Mode:"Single Row",RowSelectionColumn:"name",SelectedValue:a.selectedUpdateAnalytic,FollowSelectedValue:!0},FileExport:{ShowExportCsvButton:!1,ShowExportExcelButton:!1},Style:{FontSize:"11px",RowHeight:20,HeaderRowHeight:20}}),a.datagridAppWrapper=new QuickBase.AppView({el:a.$el.find(".update-analytic-picker .picker")[0],key:"Datagrid",settings:e,dashboardViewModel:new Backbone.Model({DashboardTheme:n}),dashboardAppModel:new Backbone.Model,docViewModel:a.options.docViewModel,deltaClient:QuickBase.DeltaClientLib.deltaClient,callback:function(){QuickBase.DeltaClientLib.getDeltaAnalytics(function(e){e.sort(function(e,t){return e.name.localeCompare(t.name)}).filter(function(e){return 3===e.parameters.length}),i.onExecuteSuccess({columns:["name"],meta:{name:11},rows:e},!0)})}})},function(e){QuickBase.Log.Error(t("DataConfigAnalytic.js: Datagrid initialization error")+e)})},mR.prototype.onResize=function(){0<this.params.length?this.$el.find(".update-editor").css("bottom",this.$el.find(".update-params-box").height()+"px"):this.$el.find(".update-editor").css("bottom",0),this.updateEditor&&(MonacoHelpers.adjustAfterResize(this.updateEditor),monaco.editor.setTheme("kx-light"!==$.cookie("dashboard-theme")?"vs-dark":"vs"),this.datagridAppWrapper&&this.datagridAppWrapper.onResize())},mR.prototype.initializeCodeMirror=function(){var i=this,n=this;MonacoHelpers.require({language:"q"},function(e){var t=e.monaco;i.updateEditor||(e=i.$el.find(".update-editor")[0],i.updateEditor=t.editor.create(e,_.assign({},MonacoHelpers.DEFAULT_OPTIONS(),{language:"q"}))),i.updateEditor.setValue(n.lastUpdateText),i.debounceUpdateEditorChange=_.debounce(function(){return n.onUpdateEditorTextChange()},100),i.updateEditor.onDidChangeModelContent(i.debounceUpdateEditorChange),i.onModelParamsChange(),i.updateParams(),i.onParamsChanged(),i.onUpdateEditorTextChange()})},mR.prototype.refreshQueryEditor=function(){this.updateEditor&&this.updateEditor.getValue()!==this.model.get("_updateQueryString")&&this.updateEditor.setValue(this.model.get("_updateQueryString"))},mR.prototype.onParamsChanged=function(){var a=this;_.each(this.paramViews,function(e){a.stopListening(e.model),e.remove()}),this.paramViews=[],this.params.each(function(i,e){try{"sql"===a.model.get("_dataSource")&&i.set("ShowRemoveButton",!0),i.set("index",e);var n=new DataParameter(i,a.model,a.docViewModel,function(e){new ViewStateDialog(_.extend({dialogContainer:a.dialogContainer,docDataModel:a.docDataModel,model:a.docViewModel},e))});a.listenTo(n.model,"change",a.updateModelParams.bind(a)),n.on("resizeEvent",function(e){_.delay(function(){},e)}),a.paramViews.push(n),a.$paramsBox.append(n.$el)}catch(e){QuickBase.Log.Error(t("Parameter editor error ")+i.toJSON())}}),0<this.paramViews.length?this.$paramsBox.show():this.$paramsBox.hide(),this.onResize()},mR.prototype.onUpdateEditorTextChange=function(){this.model.set({_updateQueryString:this.updateEditor.getValue()}),this.updateParams()},mR.prototype.updateModelParams=function(){this.stopListening(this.model,"change:_updateQueryParams"),this.model.set("_updateQueryParams",this.params.toJSON()),this.listenTo(this.model,"change:_updateQueryParams",this.onModelParamsChange.bind(this))},mR.prototype.updateParams=function(){var n,a=this,o=!1,s=[],e=this.deltaParameterRx.exec(this.model.get("_updateQueryString")),t=_.map(this.model.get("_updateQueryString").match(this.inlineParameterRx),function(e){return e.substring(2,e.length-2)}),t=(e?e[1].split(";"):[]).concat(t);3<t.length?(t=t.slice(3),o=t.length!==this.params.length,_.each(t,function(e,t){var i=a.params.findWhere({name:e});i?(s.push(i),o=o||i.get("index")===t,i.set({index:t},{silent:!0})):(n=new Backbone.Model({name:e,index:t,type:"symbol",value:"",IsKdbParam:!0}),s.push(n),o=!0)})):this.params.reset([]),o&&this.params.reset(s),this.updateModelParams()},mR),lR;function mR(e){var t=lR.call(this,e)||this;return t.deltaParameterRx=/^{\[([a-z0-9A-Z\;\w\/ ]+?)\]/,t.inlineParameterRx=/<%[^<>%]+%>/g,t.lastUpdateText=t.model.get("_updateQueryString"),t.options=e,t.params=new Backbone.Collection,t.docDataModel=e.docDataModel,t.docViewModel=e.docViewModel,t.dialogContainer=e.dialogContainer,t.lastUpdateText||(t.lastUpdateText=["{[dgAdd;dgUpd;dgDel]","  / this sample requires keyed table","  / always use unique key (id), 'Force Reset': checked","","  /testTable:: `id xkey ([] id:`int$();name:`symbol$();note1:`symbol$());","  /`testTable upsert(0i;`dummy;`);","  /testTable","","    availablePK: 1 + exec max id from testTable;","","    $[((count dgUpd)>0);`testTable upsert flip dgUpd;];","    $[((count dgDel)>0);delete from `testTable where id in (dgDel[`id]);];","","    /generate unique ids for new items","    addedCount: count dgAdd[`id];","    dgAdd[`id]:(availablePK + til addedCount);","    $[((count dgAdd)>0);`testTable upsert flip dgAdd;];","}"].join("\n"),t.model.set("_updateQueryString",t.lastUpdateText,{silent:!0})),t.$el.html(T.DataConfigQuery_Update({})),t.$paramsBox=t.$el.find(".update-params-box"),t.onUpdateTypeChange(),t.initializeCodeMirror(),t.initializeAnalyticPicker(),t.initializeEvents(),t.onUpdateTypeChange(),t.refreshQueryEditor(),t}var DataDialog=Backbone.View.extend({appModel:null,cookieKey:"dashboard-datadialog-settings",className:"data-dialog",dataView:null,propertiesView:null,isModelChanged:!1,areYouSureDialog:null,areYouSureMessage:"There are unsaved changes to this data source.",DOCUMENT_DEFAULTS:function(e){return _.extend({_autoExec:!0,_columns:[],_subscriptionKey:"",_dataSource:"kdb",_dataType:this.appModel.get("CanExecuteQueries")?"query":"analytic",_serverPaging:!1,_subscriptionType:"static",_subscriptionInterval:3,_maxRows:2e3,_layout:[{weight:2,isExpanded:!0},{weight:1,isExpanded:!1},{weight:1,isExpanded:!1},{weight:1,isExpanded:!0},{weight:2,isExpanded:!1}],_mappings:{},_pageSize:2e3,_pagingNum:0,_pagingType:"NONE",_query_connection:"",_queryParams:[],_isStreamingSubscription:!1,_selectedAnalytic:"",_analyticParams:{},_analyticParameters:{},_streamingParameters:{},_table:"",_pivotSource:"query",_pivotType:"",_pivotQuery:"",_aggregateFns:[],_aggregateCols:[],_aggregateLabels:[],_breakdownCols:[],_columnLabel:"",_aggFn:"avg",_topX:"",_from:"",_to:"",_ordering:"",_queryString:"",_hasUpdateQuery:!1,_updateQueryString:"",_updateQueryParams:[],_virtualParams:[],_virtualQueryString:"",_analyticString:"",_builderParams:[],_queryBuilderParams:[],_graphJSON:""},e)},initialize:function(e){var a=this;this.debounceUpdateCookie=_.debounce(this.updateCookie,100);var i=JSON.parse($.cookie(this.cookieKey)||"{}"),n=Tools.calcDialogHeight(i.height||750,"dataDialog");n>window.innerHeight&&(n=window.innerHeight-200);var o=i.width>window.innerWidth?window.innerWidth-300:i.width,s=n<750?"top":"center";this.appModel=e.appModel,this.docViewModel=e.docViewModel,this.dialogContainer=e.dialogContainer,this.disabledNodes=e.disabledNodes,this.initialTab=e.initialTab,this.selectCallback=e.selectCallback,this.isPropertiesCollapsed=!1,this.path=void 0,this.$el.html(T.DataDialog()),this.$tree=this.$el.find("> .tree"),this.$collapsible=this.$el.find("> .collapsible"),this.$header=this.$collapsible.find("> h3"),this.$icon=this.$header.find("i"),this.$collapsibleContent=this.$collapsible.find("> .properties"),this.resizeConfigDialogDebounced=_.debounce(_.bind(this.resizeConfigDialog,this),100),this.$dialog=this.$el.dialog(_.extend({appendTo:e.dialogContainer,title:t("Data "),dialogClass:"quick-dash datasource-dialog",resizable:!0,height:n,width:o,minWidth:800,position:{my:"center",at:s,of:"#appdiv",collision:"fit"},modal:!0,autoOpen:!0,buttons:[{text:t("Select Item"),disabled:!0,click:$.proxy(a.onSelectButtonClick,a),icons:{primary:"fa fa-check"}},{text:t("Apply"),disabled:!0,click:$.proxy(a.onSaveButtonClick,a),icons:{primary:"fa fa-check-square-o"}},{text:t("Close"),click:$.proxy(a.onCancelButtonClick,a),icons:{primary:"fa fa-times"}}],open:function(){$('<i class="fa fa-database" />').insertBefore(a.$el.parent().find(".ui-dialog-title")),_.isUndefined(i.left)||_.isUndefined(i.top)||(a.el.parentElement.style.left=i.left+"px",a.el.parentElement.style.top=i.top+"px"),a.updateLayout(),a.$header.click(function(){a.isPropertiesCollapsed=!a.isPropertiesCollapsed,a.updateLayout()}),a.dataView=new TreeView({areYouSureMessage:this.areYouSureMessage,el:a.$el.find("> .tree"),model:a.model,disabledNodes:a.disabledNodes,nodeLabel:"Data Source",nodeTypes:{node:{icon:"fa fa-fw fa-database",valid_children:[]},node_mapped:{icon:"fa fa-fw fa-database",a_attr:{class:"mapped"},valid_children:[]},virtual_node:{icon:"fa fa-calculator",valid_children:[]},virtual_node_mapped:{icon:"fa fa-calculator",a_attr:{class:"mapped"},valid_children:[]}},selected:e.path,contextMenuFn:function(e){var t={};return"node"!==e&&"node_mapped"!==e||(t.create_virtual_node={label:"Add Virtual Data Source",action:function(e){var t=$.jstree.reference(e.reference),i=t.get_node(e.reference),e=t.get_path(i,"/");t.create_node(i.parent,{source:e,type:"virtual_node"},"last",function(e){_.defer(function(){t.edit(e)})})}}),t},determineTypeFn:function(e){return e&&e.get?e.isMapping()?"virtual"===e.get("_dataType")?"virtual_node_mapped":"node_mapped":"virtual"===e.get("_dataType")?"virtual_node":"node":"node"},newGroupFn:function(){return new QuickBase.DocumentDataModel({},a.root,"",a.docViewModel,!0)},newNodeFn:function(e){var t=DataConfigForm.filterAttributes(a.DOCUMENT_DEFAULTS());return e&&"virtual_node"===e.type&&(t._dataType="virtual",e.source&&(t._virtualParams=[{type:"datasource",name:"source",value:e.source}],t._virtualQueryString=a.generateSampleVirtualQuery(e.source))),a.editModel&&a.editModel.get("_connection")&&(t._connection=a.editModel.get("_connection")),new QuickBase.DocumentDataModel(t,a.model?a.model.root:null,"",a.docViewModel,!1)},setPathFn:function(e,t){var i,n=e.path;t!==n&&(e.path=t,i=new RegExp("^"+n),e.getTreeList().forEach(function(e){e.path&&(e.path=e.path.replace(i,t))}),a.model.getTreeList().forEach(function(e){"virtual"===e.get("type")&&e.updateParameterPath("ds",n,t)}))},saveCb:function(){a.onSaveButtonClick()},noSaveCb:function(){a.isModelChanged=!1,a.setSaveEnabled(a.isModelChanged)}}),a.initHorizontalResize(),a.dataView.on("select_property",$.proxy(a.onTreeViewSelectProperty,a)),"FSBL"in window&&a.$el.parent().css("margin-top",window.finApi.DIALOGS_TOP_MARGIN),a.$el.parent().find(".ui-dialog-buttonpane > div > button:last-child").focus()},close:function(){a.remove()},drag:function(){a.debounceUpdateCookie()},resize:function(){a.onHorizontalResize(),a.debounceUpdateCookie(),a.resizeConfigDialogDebounced()}},this.options)).dialogExtend({maximizable:!0,maximize:function(){a.configDialog&&_.defer(function(){a.configDialog.onResize()}),a.onHorizontalResize(),_.defer(function(){a.initHorizontalResize()}),a.debounceUpdateCookie()},restore:function(){a.configDialog&&a.configDialog.onResize(),a.onHorizontalResize(),_.defer(function(){a.initHorizontalResize()}),a.debounceUpdateCookie()}}),i.isMaximized&&this.$dialog.dialogExtend("maximize"),this.resizeEvent=function(){a.maximizedResize()},window.addEventListener("resize",this.resizeEvent)},maximizedResize:function(){"maximized"===this.$dialog.dialogExtend("state")&&this.$dialog.dialogExtend("maximize")},updateCookie:function(){var e,t,i,n,a,o;this.el.parentElement&&(o=(e="maximized"===this.$dialog.dialogExtend("state"))?(i=(t=JSON.parse($.cookie(this.cookieKey)||"{}")).left,n=t.top,a=t.width,t.height):(i=(o=this.el.parentElement.style).left,n=o.top,a=o.width,o.height),$.cookie(this.cookieKey,JSON.stringify({left:parseInt(i),top:parseInt(n),width:parseInt(a),height:parseInt(o),isMaximized:e}),{expires:90}))},generateSampleVirtualQuery:function(e){var t,i=this.model.getByPath(e),n=["sym","bid","ask"],a={sym:11,bid:9,ask:9},e=[{sym:"AUD/CAD",bid:1.0052,ask:1.0055},{sym:"EUR/USD",bid:1.3945,ask:1.3941},{sym:"GBP/USD",bid:1.5896,ask:1.59}];return i&&i.dataSet&&i.dataSet.columns&&!i.dataSet.columns.isEmpty()&&(t=QuickBase.DocumentDataModel.convertMetaToDeltaClientColumnSpec(i.dataSet.columns.toJSON()))&&(n=t.columns.slice(0,3),a=_.pick(t.meta,n),e=_.map(i.dataSet.collection.toJSON().slice(0,3),function(e){return _.pick(e,n)})),T.VirtualQuerySample({columns:JSON.stringify(n,null,2).replace(/\n/g,"\n\t//"),meta:JSON.stringify(a,null,2).replace(/\n/g,"\n\t//"),rows:JSON.stringify(e,null,2).replace(/\n/g,"\n\t//")})},initHorizontalResize:function(){try{this.dataView.$el.resizable("destroy")}catch(e){}this.dataView.$el.resizable({handles:"e",minWidth:220,maxWidth:400}).on("resize",$.proxy(this.onHorizontalResize,this))},onCancelButtonClick:function(){function e(){t.$el.dialog("close"),t.remove()}var t=this;this.isModelChanged?this.areYouSureDialog=new QuickBase.AreYouSureDialog({saveCb:function(){t.onSaveButtonClick(),e()},onClose:function(){t.areYouSureDialog.remove(),delete t.areYouSureDialog},noSaveCb:function(){e()},dashChanged:!0,message:this.areYouSureMessage}):e()},onHorizontalResize:function(){var e=this.$el.width();this.$el.find("> .form").css({width:e-this.$el.find("> .tree").width()+7+"px",left:"auto"}),this.resizeConfigDialogDebounced()},onModelCopyChanged:function(e){!this.isModelChanged&&_.find(_.keys(e.changed),function(e){return 0===e.indexOf("_")&&"_layout"!==e})&&(this.isModelChanged=!0,this.dataView.setPending(this.dataView.selectedNode),this.setSaveEnabled(this.isModelChanged))},onSaveButtonClick:function(){var e,t=this;t.editModel&&((e=t.model.getByPath(t.path)).clear({silent:!0}),e.set(DataConfigForm.filterAttributes(t.editModel.attributes)),Log.Info("Saved",e.attributes),e.apply(),e.start(),t.deferSaveID=_.defer(function(){t.isModelChanged=!1,t.dataView.selectionChanged=null,t.dataView.setPending(),t.setSaveEnabled(t.isModelChanged)}))},onSelectButtonClick:function(){var e;this.selectCallback&&((e=this.model.getByPath(this.path))?(e.path=this.path,this.selectCallback(e)):this.selectCallback({path:this.path})),this.onCancelButtonClick()},onTreeViewSelectProperty:function(e,o){function t(e){s.path=e;var t,i,n=s.model.getByPath(e),a=n&&n.has("_dataType");s.$el.next().find("button:first").button({disabled:!a}),a?(Log.Info("Select model: ",n.attributes),"copy"===n.get("_dataType")&&n.set("_dataType","query",{silent:!0}),s.configDialog?(s.configDialog.$el.show(),s.configDialog.stopListening(s.configDialog.model,"change:"+s.configDialog.SUBCRIPTION_PROPERTY),s.editModel.forceRender=!0,t=n.get("_dataType"),i="streaming"===n.get("_subscriptionType"),a="streaming"===s.editModel.get("_subscriptionType"),s.editModel.set($.extend(!0,l,n.attributes)),s.editModel.get("_dataType")===t&&a!=i&&(s.$el.find("input:radio[name=_dataType]").val([i?"streaming":t]),s.editModel.trigger("change:_dataType",s.editModel,n.get("_dataType"))),s.editModel.forceRender=!1,s.configDialog.clearData(),"builder"===s.editModel.get("_dataType")&&s.configDialog.dataConfigBuilder&&s.configDialog.dataConfigBuilder.settingsModel.set({"Basics.JSON":s.editModel.get("_graphJSON"),"Basics.Selected":s.editModel.get("_selectedNode")}),s.editModel.builderNeedsRender=!0,s.configDialog.listenTo(s.configDialog.model,"change:"+s.configDialog.SUBCRIPTION_PROPERTY,s.configDialog.onModelSubscriptionTypeChange)):(s.editModel=new QuickBase.DocumentDataModel($.extend(!0,{},l,n.attributes),n.root,n.path,n.viewState,!0,_.mapKeys(n.virtualSubscriptions,function(e,t){return t+"#edit"})),s.configDialog=new DataConfigForm({el:s.$el.find("> .form").get(0),dataDialogView:s,docDataModel:s.model,docViewModel:s.docViewModel,dialogContainer:s.dialogContainer,initialTab:s.initialTab,model:s.editModel,appModel:s.appModel}),s.listenTo(s.editModel,"change",s.onModelCopyChanged),s.listenTo(s.editModel,"isValid",function(e){(this.isModelChanged=e)&&this.dataView.setPending(this.dataView.selectedNode),this.setSaveEnabled(e),this.setSelectEnabled(e)})),s.configDialog.updateQueryRadio(!0),s.editModel.path=e,s.configDialog.onResize()):s.configDialog&&s.configDialog.$el.hide(),r.isModelChanged=!1,r.dataView.selectionChanged=null,r.dataView.setPending(),r.setSaveEnabled(r.isModelChanged),o||_.delay(function(){r.configDialog.focusEditor()},100)}var s=this,r=this,l=$.extend(!0,{},this.DOCUMENT_DEFAULTS());this.areYouSureDialog||(!_.isUndefined(e)&&this.isModelChanged&&this.dataView.pending&&this.dataView.selectionChanged?this.areYouSureDialog=new QuickBase.AreYouSureDialog({saveCb:function(){s.dataView.setPending(),r.onSaveButtonClick(),t(e)},onClose:function(){s.areYouSureDialog.isCancel&&(r.dataView.$tree.jstree("deselect_node",r.dataView.selectedNode),r.dataView.$tree.jstree("select_node",r.dataView.lastSelectedNode)),s.areYouSureDialog.remove(),delete s.areYouSureDialog},noSaveCb:function(){s.dataView.setPending(),t(e)},dashChanged:!0,message:"There are unsaved changes to this data source."}):_.isUndefined(e)||!1!==this.dataView.selectionChanged?t(e):this.path=e)},remove:function(){this.editModel&&(this.stopListening(this.editModel),this.editModel=null),this.configDialog&&(this.configDialog.remove(),this.configDialog=null),window.clearTimeout(this.deferSaveID),window.removeEventListener("resize",this.resizeEvent),QuickBase.ErrorTooltip.clearAll(),Backbone.View.prototype.remove.call(this)},resizeConfigDialog:function(){this.configDialog&&this.configDialog.onResize()},updateProperties:function(e){var t=this;t.propertiesView&&t.propertiesView.remove(),e&&(t.propertiesView=new DataModelPropertiesView({model:t.model.getByPath(e)}),t.listenTo(t.propertiesView,"configure",function(){t.onConfigureClick(e)}),t.$collapsibleContent.append(t.propertiesView.el))},updateLayout:function(){var e=this.$header.outerHeight(!0),e=this.isPropertiesCollapsed?e:this.$collapsibleContent.outerHeight(!0)+e;this.$collapsible.css("height",e+"px"),this.$tree.css("bottom",e+"px"),this.isPropertiesCollapsed?(this.$icon.removeClass("fa-caret-down"),this.$icon.addClass("fa-caret-right")):(this.$icon.removeClass("fa-caret-right"),this.$icon.addClass("fa-caret-down"))},setSaveEnabled:function(e){this.configDialog&&this.configDialog.$connectionSelect[0].value&&this.$el.next().find("button:nth-of-type(2)").button({disabled:!e})},setSelectEnabled:function(e){this.$el.next().find("button:nth-of-type(1)").button({disabled:!e})}},{singleton:null}),VirtualParameter=Backbone.View.extend({BINDABLE_TYPES:["datasource","viewstate"],className:"data-parameter",errorDialog:null,initialize:function(e){var t=this;this.appModel=e.appModel,this.docDataModel=e.docDataModel,this.docViewModel=e.docViewModel,this.dialogContainer=e.dialogContainer,this.paramModel=e.paramModel,this.render(),_.includes(this.BINDABLE_TYPES,this.model.get("type"))?this.onBindingSelected(this.model.get("value")):this.$valueInput.val(this.model.get("value")),this.onTypeChanged(),_.defer(function(){t.initializeEvents()})},initializeEvents:function(){this.listenTo(this.model,"change:type",this.onTypeChanged),this.$bindingContainer.on("click",$.proxy(this.onShowBindingDialog,this)),this.$clearBinding.on("click",$.proxy(this.onClearBinding,this)),this.$selectBinding.on("click",$.proxy(this.onShowBindingDialog,this)),this.$valueInput.on("change",$.proxy(this.onValueInput,this)),this.$typeRadio.find("input[type=radio]").change(_.bind(this.onTypeRadioChange,this))},applyControlState:function(){_.includes(this.BINDABLE_TYPES,this.model.get("type"))?this.$form.addClass("is-bound"):this.$form.removeClass("is-bound")},getPath:function(){var e=this.paramModel.path;return e.substring(e.lastIndexOf("/")+1)+"/"+this.model.get("name")},onClearBinding:function(){this.model.set("value",null),this.$viewStateInput.val(""),this.$viewStateDisplay.val(""),this.applyControlState()},onBindingSelected:function(e){switch(this.stopListening(this.boundModel,"change"),this.model.get("type")){case"datasource":this.boundModel=this.docDataModel.getByPath(e);break;case"viewstate":this.boundModel=this.docViewModel.getByPath(e),this.listenTo(this.boundModel,"change:value",this.onBoundModelChange)}this.model.set("value",e),this.$valueInput.val(e),this.$valueDisplay.val(e),this.applyControlState()},onBoundModelChange:function(){this.trigger("change")},onTypeRadioChange:function(){var e=this.$typeRadio.find(":radio:checked").val();this.model.set({type:e}),this.onShowBindingDialog()},onTypeChanged:function(){var e=this.model.get("type");switch(this.$bindingIcon.removeClass("fa-eye fa-database"),e){case"datasource":this.$bindingIcon.addClass("fa-database");break;case"viewstate":this.$bindingIcon.addClass("fa-eye")}this.applyControlState()},onValueInput:function(){var e=this.$valueInput.val();this.model.set({value:e,isViewState:!1})},render:function(){var e=_.uniqueId("virtualParam_");this.$el.html(T.VirtualParameter(_.extend({uniqueId:e},this.model.toJSON()))),this.$bindingContainer=this.$(".binding-container"),this.$bindingIcon=this.$(".binding-icon"),this.$clearBinding=this.$(".binding-clear"),this.$form=this.$el.find(".form-control"),this.$selectBinding=this.$(".binding-apply"),this.$valueDisplay=this.$el.find(".value-display"),this.$valueInput=this.$el.find(".value-input"),this.$typeRadio=this.$el.find(".type-radio"),this.$typeRadio.val(this.model.get("type")),this.$typeButtonDatasource=this.$typeRadio.find("#"+e+"_datasource"),this.$typeButtonText=this.$typeRadio.find("#"+e+"_text"),this.$typeButtonViewstate=this.$typeRadio.find("#"+e+"_viewstate"),this.$typeRadio.find(":radio[value="+this.model.get("type")+"]").prop("checked",!0),this.$typeRadio.buttonset(),this.$typeButtonDatasource.button({icons:{primary:"fa fa-database"},text:!1}),this.$typeButtonText.button({icons:{primary:"fa fa-font"},text:!1}),this.$typeButtonViewstate.button({icons:{primary:"fa fa-eye"},text:!1})},remove:function(){this.$bindingContainer.off(),this.$clearBinding.off(),this.$selectBinding.off(),this.$valueInput.off(),Backbone.View.prototype.remove.apply(this)},onShowBindingDialog:function(){var e,t=this,i={dialogContainer:t.dialogContainer,path:t.model.get("value")};switch(t.model.get("type")){case"datasource":e=DataDialog,_.extend(i,{appModel:t.appModel,disabledNodes:[t.paramModel.path],docViewModel:t.docViewModel,model:t.docDataModel,selectCallback:function(e){e&&t.onBindingSelected(e.path)}});break;case"viewstate":e=ViewStateDialog,_.extend(i,{model:t.docViewModel,selectCallback:function(e){t.onBindingSelected(e)}})}e&&new e(i)}}),DataConfigQuery_Virtual=Backbone.View.extend({tagName:"div",params:null,$paramsBox:null,$queryEditor:null,lastText:null,initialize:function(e){var t=this;t.appModel=e.appModel,t.docDataModel=e.docDataModel,t.docViewModel=e.docViewModel,t.dialogContainer=e.dialogContainer,t.params=new Backbone.Collection,t.render(),t.initializeMonaco()},initializeMonaco:function(){var n=this;this.lastText=this.model.get("_virtualQueryString"),MonacoHelpers.require({language:"javascript"},function(e){var t=e.monaco,i=e.unload,e=n.$el.find(".query-editor")[0];n.unregisterTypes=i,n.editor=t.editor.create(e,_.assign({},MonacoHelpers.DEFAULT_OPTIONS(),{language:"javascript"})),n.onModelParamsChange(),n.onParamsChanged(),n.initializeEvents(),n.editor.setValue(n.lastText)})},initializeEvents:function(){this.listenTo(this.params,"add reset remove",this.onParamsChanged),this.listenTo(this.model,"change:_virtualParams",this.onModelParamsChange),this.listenTo(this.model,"change:_virtualQueryString",this.onModelTextChange),this.debounceEditorChange=_.debounce($.proxy(this.onEditorTextChange,this),100),this.editor.onDidChangeModelContent(this.debounceEditorChange)},focusEditor:function(){this.editor&&(this.editor.setPosition({lineNumber:2,column:1}),this.editor.focus())},onEditorTextChange:function(){this.lastText=this.editor.getValue(),this.model.set("_virtualQueryString",this.lastText),this.updateParams()},onModelParamsChange:function(){this.params.reset(this.model.get("_virtualParams")||[])},onModelTextChange:function(e,t){t!==this.lastText&&(this.lastText=t,this.editor.setValue(t))},onParamsChanged:function(){var i=this;_.each(i.paramViews,function(e){i.stopListening(e.model),e.remove()}),i.paramViews=[],i.params.each(function(e){var t=new VirtualParameter({appModel:i.appModel,dialogContainer:i.dialogContainer,docDataModel:i.docDataModel,docViewModel:i.docViewModel,model:e,paramModel:i.model});i.listenTo(e,"change",i.updateDataModelParams),i.paramViews.push(t),i.$paramsBox.append(t.$el)}),0<i.paramViews.length?i.$paramsBox.show():i.$paramsBox.hide(),i.onResize()},onResize:function(){0<this.params.length?this.$queryEditor.css("bottom",this.$paramsBox.height()+"px"):this.$queryEditor.css("bottom",0),MonacoHelpers.adjustAfterResize(this.editor)},remove:function(){this.editor&&(this.editor=null),this.unregisterTypes(),Backbone.View.prototype.remove.call(this)},render:function(){this.$el.html(T.DataConfigQuery_Virtual(this.model.toJSON())),this.$paramsBox=this.$el.find(".params-box"),this.$queryEditor=this.$el.find(".query-editor")},updateDataModelParams:function(){this.stopListening(this.model,"change:_virtualParams"),this.model.set("_virtualParams",this.params.toJSON()),this.listenTo(this.model,"change:_virtualParams",this.onModelParamsChange)},updateParams:function(){var n=this,a=[],o=!1,e=QuickBase.DocumentDataModel.VIRTUAL_QUERY_REGEX.exec(n.model.get("_virtualQueryString"));e&&6===e.length?(e=e[2].split(","),o=e.length!==n.params.length,_.each(e,function(e,t){var i;e=e.trim(),(i=n.params.findWhere({name:e}))?(i.get("index")!==t&&(o=!0,i.set({index:t},{silent:!0})),a.push(i)):(a.push(new Backbone.Model({name:e,index:t,type:"datasource",value:""})),o=!0)})):console.warn("Virtual Query: Function Declaration Invalid. Function call must have at least one source & callback."),o&&n.params.reset(a),n.updateDataModelParams()}}),DataConfigQuery_Builder=Backbone.View.extend({className:"data-config-builder",$isStreamingSub:null,$parametersPanel:null,selectedAnalyticParams:[],subscriptionSelect:null,analyticDetailsObj:{},height:0,width:0,initialize:function(e){this.options=e,this.render()},onChange_queryBuilderParams:function(){0<this.model.get("_queryBuilderParams").length&&this.$el.closest(".data-div").siblings(".toolbar").find("#datasource-execute-query").click()},onModelColumnsChange:function(){var e,t=this.queryBuilderWrapper.app.selectedNode;t&&this.model.get("_selectedNode")===t.id&&((e=JSON.parse(this.settingsModel.get("Basics.JSON"))).nodes[t.id].subscription={cols:this.model.get("_columns"),key:this.model.get("_subscriptionKey")},this.setJsonProperty(JSON.stringify(e)))},onResize:function(){this.queryBuilderWrapper&&this.$el.is(":visible")&&(this.height!==this.$el.height()||this.width!==this.$el.width())&&(this.queryBuilderWrapper.onResize(),this.height=this.$el.height(),this.width=this.$el.width())},remove:function(){this.$parametersPanel&&(this.$parametersPanel.remove(),delete this.$parametersPanel),this.queryBuilderWrapper&&this.queryBuilderWrapper.remove(),Backbone.View.prototype.remove.call(this)},render:function(){var s=this;s.queryBuilderWrapper&&s.queryBuilderWrapper.app.sideDialog;if(!1===s.model.builderNeedsRender)return!1;s.model.builderNeedsRender=!1,s.$el.html(T.DataConfigQuery_Builder()),require(["QueryBuilder"],function(e){var t=s.model.get("_selectedNode")||"result",i=s.model.get("_graphJSON")||"";s.settingsModel=e.getSettingsModel({Basics:{Data:"",Connection:s.model.get("_connection"),Direction:"Left-Right",DialogPlacement:"Left",AutoSave:!0,ReadOnly:!1,Selected:t,JSON:i,qIPC:"",UseViewStates:!0,Theme:"Dark"},Bindings:[],Style:{advanced:"",LevelSeparation:220,NodeSpacing:150}}),s.listenTo(s.settingsModel,"change:Basics.JSON",function(e,t){var i=s.queryBuilderWrapper.app,n=s.model.get("_graphJSON"),i=i.selectedNode;if(n!==t){if(i&&_.includes(["data","function","stream","filter","groupBy","join"],i.group)){n=JSON.parse(n).nodes[i.id];if(_.includes(["data","function","stream"],i.group)&&("string"==typeof i.data&&i.data!==n.data||"object"==typeof i.data&&i.data.name!==n.data.name)||"filter"===i.group&&!_.isEqual(i.data.select,n.data.select)||"groupBy"===i.group&&!_.isEqual(i.data.groupBy,n.data.groupBy)||"join"===i.group&&!_.isEqual(i.data,n.data)){s.options.subscriptionSelect.reset();var a=JSON.parse(t),o=function(e){delete e.subscription,"result"!==e.id&&o(a.nodes[a.edges[e.id]])};o(a.nodes[i.id]);i=JSON.stringify(a);return s.model.set("_graphJSON",i),void s.setJsonProperty(i)}}s.model.set("_graphJSON",t)}else s.resetSubscription(s.model.get("_selectedNode"))}),s.listenTo(s.settingsModel,"change:Basics.Selected",function(e,t){s.model.get("_selectedNode")!==t&&s.resetSubscription(t),s.model.set("_selectedNode",t)}),s.listenTo(s.model,"change:_connection",function(e,t){var i,n;"builder"===s.model.get("_dataType")&&(n=(i=s.queryBuilderWrapper.app).selectedNode,i.api.setProperty("Basics.Connection",t),-1<n.id.indexOf("data")&&i.doCommand(n.group))}),s.listenTo(s.model,"change:_subscriptionKey",function(e,t){var i,n,a;"builder"===s.model.get("_dataType")&&s.model.get("_graphJSON")&&(i=s.queryBuilderWrapper.app,(a=(a=(n=JSON.parse(s.model.get("_graphJSON"))).nodes)[s.model.get("_selectedNode")||_.keys(a)[1]])&&a.subscription&&a.subscription.key!==t&&i.selectedNode&&i.selectedNode.id===s.model.get("_selectedNode")&&(a.subscription.key=t,s.setJsonProperty(JSON.stringify(n))))}),s.queryBuilderWrapper=new QuickBase.AppView({el:s.$el.find(".graph-container")[0],key:"QueryBuilder",settings:s.settingsModel,dashboardViewModel:new Backbone.Model({DashboardTheme:"Dark"}),dashboardAppModel:s.options.appModel,docDataModel:s.options.model,docViewModel:s.options.docViewModel,deltaClient:QuickBase.DeltaClientLib,callback:function(){this.app.setViewModel(s.options.docViewModel,s.options.model,function(e){e.path=e.path?e.path.toString():null,new ViewStateDialog(_.extend({dialogContainer:s.options.dialogContainer,docDataModel:s.options.docDataModel,model:s.options.docViewModel},e))})}})})},resetSubscription:function(e){var t=JSON.parse(this.model.get("_graphJSON")).nodes,t=t[e||_.keys(t)[1]];t&&t.subscription?(this.model.set("_subscriptionKey",t.subscription.key),this.options.subscriptionSelect.updateSubscriptionKeyMenu(t.subscription.cols)):this.options.subscriptionSelect.reset()},setJsonProperty:function(e){var t=this.queryBuilderWrapper.app;t.isSaving=!0,t.api.setProperty("Basics.JSON",e)}}),AnalyticParamsView=(OU=Backbone.View,__extends(PU,OU),PU.prototype.getParams=function(){var i=[];return _.each(this.parameterArray,function(e,t){i.push(e.model.toJSON())}),i},PU.prototype.onParamItemChanged=function(){this.trigger("ParamItemChanged")},PU.prototype.refreshParameterList=function(){var i,n=this;n.parameterArray=[],n.$parameterList.html(""),this.model.get("Parameters").length?_.each(this.model.get("Parameters"),function(e){i=new DataParameter(new Backbone.Model(_.extend({},e)),n.options.analyticModel,n.options.docViewModel,function(e){new ViewStateDialog(_.extend({dialogContainer:n.options.dialogContainer,docDataModel:n.options.docDataModel,model:n.options.docViewModel},e))},n.options.possibleTypes),n.listenTo(i,"ValueChanged",n.onParamItemChanged),n.parameterArray.push(i),n.$parameterList.append(i.$el)}):n.$parameterList.append($("<div />").addClass("noParameters").text(t("No Parameters")))},PU.prototype.render=function(){return this.$el.html(T.AnalyticParamsView(this.model.toJSON())),this.$parameterList=this.$el.find(".parameterList"),this},PU),OU;function PU(e){var t=OU.call(this,e)||this;return t.$parameterList=null,t.parameterArray=[],t.options=e,t.render(),t.listenTo(t.model,"change",t.refreshParameterList),t.refreshParameterList(),t}var SubscriptionSelect=Backbone.View.extend({className:"row data-source-row",hasStreamingNode:!1,isLite:!1,DATA_TYPE_PROP:"_dataType",DATA_SOURCE_PROP:"_dataSource",COLUMNS_PROPERTY:"_columns",SUBCRIPTION_PROPERTY:"_subscriptionType",INTERVAL_PROPERTY:"_subscriptionInterval",SUBSCRIPTION_KEY_PROPERTY:"_subscriptionKey",FORCE_RESET_PROPERTY:"_forceReset",$subscriptionSelect:null,$maxRowsInput:null,$subscriptionCheckedRadio:null,$polling:null,$static:null,$streaming:null,$subscription:null,initialize:function(i){var e,t=this;this.isLite=i.isLite,this.subscriptionKey=_.uniqueId("subscriptionSelect_"),this.$el.html(T.SubscriptionSelect()),this.$subscriptionSelect=this.$el.find("input[name='"+this.SUBCRIPTION_PROPERTY+"']"),this.$subscriptionKey=this.$el.find("select[name='"+this.SUBSCRIPTION_KEY_PROPERTY+"']"),this.$intervalSelectContainer=this.$el.find(".subscriptionIntervalContainer"),this.$forceResetCheck=this.$el.find("."+this.FORCE_RESET_PROPERTY),this.$streaming=this.$el.find(".streamingRadio"),this.$subscription=this.$el.find(".subscriptionRadio"),this.$static=this.$el.find(".staticRadio"),this.$polling=this.$el.find(".pollingRadio"),this.debouncedUpdateSubscriptionKeyMenu=_.debounce(this.updateSubscriptionKeyMenu,100),this.onModelColumnsChange(),this.listenTo(this.model,"change:"+this.COLUMNS_PROPERTY,this.onModelColumnsChange),this.onModelDataTypeChange(),this.listenTo(this.model,"change:"+this.DATA_TYPE_PROP+" change:"+this.DATA_SOURCE_PROP,this.onModelDataTypeChange),this.onModelSubscriptionChange(),this.listenTo(this.model,"change:"+this.SUBCRIPTION_PROPERTY,this.onModelSubscriptionChange),this.$subscriptionSelect.change($.proxy(this.onInputSubscriptionChange,this)),this.onModelGraphChange(),this.listenTo(this.model,"change:_graphJSON",this.onModelGraphChange),e=new Backbone.Form.editors.NumberViewState({key:this.INTERVAL_PROPERTY,model:this.model,openViewStateDialog:function(e,t){new ViewStateDialog({dialogContainer:i.dialogContainer,docDataModel:i.docDataModel,model:i.docViewModel,path:e,selectCallback:function(e){e=i.docViewModel.getByPath(e);t(e)}})},schema:{editorAttrs:{max:3600,min:.5,step:.1}}}).render(),this.$intervalSelectContainer.append(e.el),e.on("change",function(){t.model.set(t.INTERVAL_PROPERTY,e.getValue())}),this.onModelSubscriptionKeyChange(),this.listenTo(this.model,"change:"+this.SUBSCRIPTION_KEY_PROPERTY,this.onModelSubscriptionKeyChange),this.$subscriptionKey.change($.proxy(this.onInputSubscriptionKeyChange,this)),this.onModelForceResetChange(),this.listenTo(this.model,"change:"+this.FORCE_RESET_PROPERTY,this.onModelForceResetChange),this.$forceResetCheck.change($.proxy(this.onInputForceResetChange,this))},appendOption:function(e,t){this.$subscriptionKey.append($("<option>",{value:e,text:t}))},enableStreamingOnly:function(e){this.$static.toggle(!e),this.$polling.toggle(!e),this.$subscription.toggle(!this.isLite&&!e),this.$streaming.toggle(e);var t=this.model.get(this.SUBCRIPTION_PROPERTY);({static:this.$static,polling:this.$polling,subscription:this.$subscription,streaming:this.$streaming})[e?"streaming":"streaming"===t?"static":t].find("input").prop("checked",!0).trigger("change")},onInputForceResetChange:function(e){this.model.set(this.FORCE_RESET_PROPERTY,$(e.currentTarget).is(":checked"))},onInputSubscriptionKeyChange:function(e){this.model.set(this.SUBSCRIPTION_KEY_PROPERTY,$(e.currentTarget).val()),Log.Info("Subscription Key Change "+this.SUBSCRIPTION_KEY_PROPERTY,$(e.currentTarget).val())},onInputSubscriptionChange:function(e){e=$(e.currentTarget).val();e&&this.model.set(this.SUBCRIPTION_PROPERTY,e)},onModelColumnsChange:function(){this.updateSubscriptionKeyMenu(this.model.get(this.COLUMNS_PROPERTY))},onModelDataTypeChange:function(){var e=this.model.get(this.DATA_TYPE_PROP),t=this.model.get(this.DATA_SOURCE_PROP),i=this.$el.closest(".subscription").siblings(".function").find("input:checked");"analytic"===e?this.enableStreamingOnly(!i.hasClass("analytic")&&"streaming"===this.model.get("_subscriptionType")||i.hasClass("streaming")):"builder"===e?this.enableStreamingOnly(this.hasStreamingNode):(this.$static.show(),this.$polling.show(),this.$streaming.toggle(this.isLite?"builder"===e&&this.hasStreamingNode||"streaming"===e:"analytic"===e&&"sql"!==t),this.$subscription.toggle(!this.isLite&&"sql"!==t&&"virtual"!==e),e=this.$el.find("input:checked")[0],-1===this.$el.find("input:visible").toArray().indexOf(e)&&this.$static.find("input").prop("checked",!0).trigger("change"))},onModelGraphChange:function(){var e;"builder"===this.model.get(this.DATA_TYPE_PROP)&&(e=this.model.get("_graphJSON"),this.hasStreamingNode=!_.isEmpty(e)&&_.some(JSON.parse(e).nodes,function(e){return"stream"===e.group}),this.enableStreamingOnly(this.hasStreamingNode))},onModelSubscriptionKeyChange:function(){"polling"!==this.model.get(this.SUBSCRIPTION_KEY_PROPERTY)&&"subscription"!==this.model.get(this.SUBSCRIPTION_KEY_PROPERTY)||this.debouncedUpdateSubscriptionKeyMenu()},onModelForceResetChange:function(){this.$forceResetCheck.prop("checked",!0===this.model.get(this.FORCE_RESET_PROPERTY))},onModelSubscriptionChange:function(){var e,t=this.$el.find("."+this.model.get(this.SUBCRIPTION_PROPERTY));this.$subscriptionCheckedRadio&&t!==this.$subscriptionCheckedRadio&&this.$subscriptionCheckedRadio.removeAttr("checked"),_.defer(function(){t.prop("checked",!0)}),"static"===(this.$subscriptionCheckedRadio=t).val()?this.$intervalSelectContainer.parent().hide():(e="streaming"===t.val()?"none":"inline-block",this.$intervalSelectContainer.parent().css("display",e),this.debouncedUpdateSubscriptionKeyMenu())},remove:function(){this.model.unsubscribe(this.subscriptionKey),Backbone.View.prototype.remove.call(this)},resetOptions:function(){this.$subscriptionKey.find("option").remove(),this.appendOption("","Row Num")},reset:function(){this.model.set(this.SUBSCRIPTION_KEY_PROPERTY,""),this.resetOptions()},updateSubscriptionKeyMenu:function(e){var t=this;e&&(t.resetOptions(),0<e.length?_.each(e,function(e){t.$subscriptionKey.append($("<option>",{value:e,text:e}))}):t.model.get(t.SUBSCRIPTION_KEY_PROPERTY)&&t.$subscriptionKey.append($("<option>",{value:t.model.get(t.SUBSCRIPTION_KEY_PROPERTY),text:t.model.get(t.SUBSCRIPTION_KEY_PROPERTY)}))),t.model.get(t.SUBSCRIPTION_KEY_PROPERTY)?t.$subscriptionKey.val(t.model.get(t.SUBSCRIPTION_KEY_PROPERTY)):t.model.set(t.SUBSCRIPTION_KEY_PROPERTY,t.$subscriptionKey.val())}}),DataConfigAnalytic=(AV=Backbone.View,__extends(BV,AV),BV.prototype.onModelConnectionChange=function(){this.options.appModel.get("isLite")&&this.updateLite()},BV.prototype.createJsTreeJSON=function(e,t,i){return{id:e,text:t,state:{selected:e===this.selectedAnalytic},children:[],type:i}},BV.prototype.getParams=function(){var e,t=this.parametersPanel.getParams();return this.ignoreParamsChanges=!0,this.model.set(((e={_analyticParams:t})[this.getParametersProperty()]=t,e)),this.ignoreParamsChanges=!1,t},BV.prototype.generateAnalyticParametersObject=function(e){var o=this;this.selectedAnalyticParams=[];var s=this.getParametersProperty();this.isStreaming()&&this.options.appModel.get("isLite")&&this.selectedAnalytic&&0===e.length&&e.push({name:"x",type:"Symbol"}),e.forEach(function(e){var t,i=null,n=null,a=_.find(o.model.get(s),{name:e.name});a&&(t=_.find(o.model.get(s),function(e){return e.id===a.id}))&&(n=t.value,i=t.type),o.selectedAnalyticParams.push({id:e.name,name:e.name,type:i||o.modifyParameterType(e.type),description:e.description||"",required:e.required||!1,value:n||e.value,isViewState:!(!a||!a.isViewState)})}),this.parametersPanel&&(this.parametersPanel.model.set({Parameters:this.selectedAnalyticParams}),this.getParams())},BV.prototype.getParametersProperty=function(){return this.isStreaming()?"_streamingParameters":"_analyticParameters"},BV.prototype.isStreaming=function(){return"streaming"===this.model.get("_subscriptionType")},BV.prototype.jstreeSearch=function(e){this.$tree.jstree(!0).show_all(!1),this.$tree.jstree().search(e)},BV.prototype.modifyParameterType=function(e){var t={Character:"Char",Integer:"Int"}[e];return t||e},BV.prototype.onModelAnalyticChange=function(){this.selectedAnalytic=this.model.get("_selectedAnalytic"),this.updateAnalyticUI(),this.model.forceRender&&(this.$tree.jstree("deselect_node",this.$tree.jstree("get_selected")[0]),this.$tree.jstree("select_node",this.selectedAnalytic),this.debouncedScrollToSelection())},BV.prototype.onModelAnalyticParamsChange=function(){this.ignoreParamsChanges||this.model.hasChanged("_selectedAnalytic")||this.updateAnalyticUI()},BV.prototype.onResize=function(){},BV.prototype.remove=function(){return this.parametersPanel&&(this.parametersPanel.remove(),delete this.parametersPanel),Backbone.View.prototype.remove.call(this)},BV.prototype.renderTree=function(e){var c,d=this,i=this,n=[];i.options.appModel.get("isLite")?(c={},_.each(e,function(a,e){var o=_.filter(e.split("."),function(e){return""!==e}),s=1===o.length&&e==="."+o[0],r=1<o.length||s?".":"",l=n;_.each(o,function(e,t){var i=r+e,n=t<o.length-1;n?(void 0===(t=c[i])&&(t=c[i]=d.createJsTreeJSON(i,(n||s?".":"")+e,n?"namespace":a),l.push(t)),l=t.children,r=i+"."):l.push(d.createJsTreeJSON(i,e,a))})})):_.each(e,function(e,t){var i=n.push(d.createJsTreeJSON(t,t,e?"namespace":d.analytics[t].streaming?"streaming":"analytic"));e&&_.each(e,function(e){n[i-1].children.push(d.createJsTreeJSON(e,e,d.analytics[e].streaming?"streaming":"analytic"))})}),require(["jstree"],function(){d.$tree&&d.$tree.jstree("destroy"),d.$tree.jstree({core:{data:n,multiple:!1},conditionalselect:function(e,t){return 0===e.children.length},types:{table:{icon:"fa fa-table"},analytic:{icon:"fa fa-line-chart"},namespace:{icon:"fa fa-folder"},streaming:{icon:i.options.appModel.get("isLite")?"fa fa-table streaming-icon":"fa fa-line-chart streaming-icon"}},search:{show_only_matches:!0,show_only_matches_children:!0},plugins:["conditionalselect","types","search","wholerow"]}),d.$tree.on("select_node.jstree",function(e,t){t&&(i.model.get("_selectedAnalytic")!==t.node.id&&i.options.subscriptionSelect.reset(),i.model.set("_selectedAnalytic",t.node.id))}),d.$tree.on("deselect_node.jstree",function(e,t){i.model.forceRender||i.model.set("_selectedAnalytic","")}),d.$tree.on("search.jstree",function(e,t,i){0===t.nodes.length&&d.$tree.jstree(!0).hide_all(!1)}),d.$tree.one("ready.jstree",d.scrollToSelection.bind(d))})},BV.prototype.scrollToSelection=function(){var e=this.selectedAnalytic;e&&(e=e.replace(/\./g,"\\."),(e=this.$tree.find("#"+e)[0])&&(this.$tree[0].scrollTop=e.offsetTop-this.$tree[0].offsetTop))},BV.prototype.standardSort=function(e){return e.sort(function(e,t){return e.localeCompare(t)})},BV.prototype.updateDelta=function(){var a=this;QuickBase.DeltaClientLib.getDeltaAnalytics(function(e){var t=_.reduce(e,function(t,i,e){return a.isStreaming()&&!i.streaming||!a.isStreaming()&&i.streaming||(0<i.groups.length?_.each(i.groups,function(e){t[e]||(t[e]=[]),t[e].push(i.name),a.analytics[i.name]=i}):(t[i.name]=!1,a.analytics[i.name]=i)),t},{}),i={},n={};_.each(a.standardSort(_.keys(t)),function(e){t[e]?i[e]=a.standardSort(t[e]):n[e]=t[e]});e=_.extend(i,n);a.renderTree(e),a.updateAnalyticUI()})},BV.prototype.updateLite=function(){function e(e){n.analytics={},o&&_.every(e.meta,function(e){return 11==e})&&e.rows[0]?_.values(e.rows[0]).sort(function(e,t){return e.localeCompare(t)}).forEach(function(e){0!==e.indexOf("01000000")&&(n.analytics[e]={name:e,parameters:[],type:"streaming"})}):e.rows.sort(function(e,t){return e.name.localeCompare(t.name)}).forEach(function(e){o===(1==e.streaming)&&(n.analytics[e.name]={name:e.name,parameters:e.parameters?_.filter(e.parameters.rows,function(e){return!!e.name}):[],type:e.streaming?"streaming":"analytic"})}),n.renderTree(_.fromPairs(_.keys(n.analytics).map(function(e){return[e,n.analytics[e].type]}))),n.updateAnalyticUI()}function t(e){n.analytics={},n.renderTree({}),n.updateAnalyticUI()}function i(){QuickBase.DashClient.getQueryData("q",a,BV.LITE_FN_LIST,[],e,t)}var n=this,a=this.model.get("_connection"),o=this.isStreaming();try{o?QuickBase.DashClient.getQueryData("q",a,".u.t",[],e,i):QuickBase.DashClient.runAnalytic(".api.getFunctions",a,[],e,i)}catch(e){t()}},BV.prototype.updateAnalyticUI=function(){var e=this.analytics[this.selectedAnalytic];"analytic"===this.model.get("_dataType")&&e&&this.generateAnalyticParametersObject(e&&e.parameters||[])},BV.LITE_FN_LIST='kys: raze (raze k!{@[{ {".",(string y),".",string x}[;x] each key[`$".",string x] };x;{`}]} each k: (key `) except `j`q`Q`h`o`u; string key `.); select name,parameters:{flip `name`type!(x 1;`Symbol)} each parameters from ({`name`parameters!((`$x);(value (value x))) } each exec name from ({ `name`t!(x;type value x) } each kys) where (not (name like "*.")) and t=100h)',BV),AV;function BV(e){var t=AV.call(this,e)||this;t.ignoreParamsChanges=!1,t.selectedAnalytic="",t.selectedAnalyticParams=[],t.subscriptionSelect=null,t.analytics={},t.options=e,t.$el.addClass("data-config-analtyic"),t.$el.attr("id",t.options.analyticGuid),t.$el.html(T.DataConfigAnalytic()),t.$tree=t.$el.find(".pnlAnalyticsTree"),t.$search=t.$el.find(".searchBox"),t.$clearSearch=t.$el.find(".clearSearch"),t.selectedAnalytic=t.model.get("_selectedAnalytic"),t.parametersPanel=new AnalyticParamsView({el:t.$el.find(".paramsView"),dialogContainer:t.options.dialogContainer,docDataModel:t.options.docDataModel,docViewModel:t.options.docViewModel,model:new Backbone.Model({Parameters:[]}),analyticModel:t.model,possibleTypes:t.options.appModel.get("isLite")&&t.isStreaming()?["symbol","list"]:[]}),t.listenTo(t.parametersPanel,"ParamItemChanged",t.getParams),t.options.appModel.get("isLite")?t.updateLite():t.updateDelta();var i=_.debounce(t.jstreeSearch.bind(t),250);return t.debouncedScrollToSelection=_.debounce(t.scrollToSelection,100),t.$search.keyup(function(e){e=e.target.value;e?t.$clearSearch.show():t.$clearSearch.hide(),i(e)}),t.$clearSearch.click(function(e){t.$search.val("").trigger("keyup")}),t.model.set(t.getParametersProperty(),t.model.get("_analyticParams")),t.listenTo(t.model,"change:_selectedAnalytic",t.onModelAnalyticChange),t.listenTo(t.model,"change:"+t.getParametersProperty(),t.onModelAnalyticParamsChange),t.listenTo(t.model,"change:_connection",t.onModelConnectionChange),t}var DataConfigMappingItem=(jX=Backbone.View,__extends(kX,jX),kX.prototype.initializeEvents=function(){this.listenTo(this.model,"destroy",this.remove),this.listenTo(this.model,"change:key",this.onModelMappingKeyChange),this.listenTo(this.model,"change:value",this.onModelMappingValueChange),this.$removeMapping.click(this.onRemoveMapping.bind(this)),this.$keySelect.on("select2:select",function(e){this.model.set("key",e.params.data.id)}.bind(this)),this.$keySelect.on("select2:open",this.setSelectClasses)},kX.prototype.onModelMappingKeyChange=function(){this.model.set("value",this.dataMapper.getValue(this.model.get("key")))},kX.prototype.onModelMappingValueChange=function(){this.$value.text(this.model.get("value"))},kX.prototype.onRemoveMapping=function(){this.model.destroy()},kX.prototype.onResize=function(){},kX.prototype.remove=function(){return Backbone.View.prototype.remove.call(this)},kX.prototype.render=function(){return this.$el.html(T.DataConfigMappingItem(this.model.toJSON())),this.$keySelect=this.$el.find(".key-select"),this.$removeMapping=this.$el.find(".remove-mapping"),this.$value=this.$el.find(".value"),this.$viewState=this.$el.find(".view-state"),this.$keySelect.select2({tags:!0,theme:"dashboards",width:"100%"}),this.$removeMapping.button({icons:{primary:"fa fa-minus"},text:!1}),this.viewStateEditor=new Backbone.Form.editors.ViewState({id:_.uniqueId("date_"),key:"viewstate",model:this.model,openViewStateDialog:this.openViewStateDialog}).render(),this.viewStateEditor.on("change",function(){this.model.set("viewstate",this.viewStateEditor.getValue())}.bind(this)),this.setSelectOptions(),this.$viewState.append(this.viewStateEditor.el),this},kX.prototype.setSelectOptions=function(){var e=_.union([this.model.get("key")],this.dataMapper.getPossibleKeys());this.$keySelect.empty(),_.each(e,function(e){this.$keySelect.append(new Option(e,e,!0,!0))}.bind(this)),this.$keySelect.val(this.model.get("key")).trigger("change")},kX),jX;function kX(e){var t=jX.call(this,_.extend(e,{tagName:"div"}))||this;return t.tagName="tr",t.dataMapper=e.dataMapper,t.openViewStateDialog=e.openViewStateDialog,t.setSelectClasses=e.setSelectClasses,t.render(),t.initializeEvents(),t.onModelMappingKeyChange(),t}var DataConfigMapping=(qX=Backbone.View,__extends(rX,qX),rX.prototype.initializeEvents=function(){this.listenTo(this.dataMapper,"key-change",this.onModelMappingKeyChange),this.listenTo(this.dataMapper,"mappings-change",this.renderMappings),this.listenTo(this.dataMapper,"on-data",this.onData),this.listenTo(this.dataMapper,"value-change",this.onModelMappingValueChange),this.$keySelect.on("select2:select",function(e){this.model.set("key",e.params.data.id)}.bind(this)),this.$valueSelect.on("select2:select",function(e){this.model.set("value",e.params.data.id)}.bind(this)),this.$keySelect.on("select2:open",this.setSelectClasses),this.$valueSelect.on("select2:open",this.setSelectClasses),this.$addMapping.click(_.bind(this.dataMapper.addMapping,this.dataMapper)),this.$resetMapping.click(_.bind(this.dataMapper.resetMappings,this.dataMapper))},rX.prototype.onData=function(){this.setSelectOptions(),this.renderMappings()},rX.prototype.onModelMappingKeyChange=function(){this.$keySelect.val(this.model.get("key")).trigger("change"),_.each(this.mappingViews,function(e){e.setSelectOptions()}.bind(this))},rX.prototype.onModelMappingValueChange=function(){this.$valueSelect.val(this.model.get("value")).trigger("change")},rX.prototype.onResize=function(){this.setScrollClasses()},rX.prototype.openViewStateDialog=function(e,t){new ViewStateDialog({dialogContainer:this.dialogContainer,docDataModel:this.docDataModel,model:this.docViewModel,path:e,selectCallback:function(e){e=this.docViewModel.getByPath(e);t(e)}.bind(this)}),$(".viewstate-dialog").css("z-index",102)},rX.prototype.remove=function(){return this.$keySelect.data("select2")&&this.$keySelect.select2("destroy"),this.$valueSelect.data("select2")&&this.$valueSelect.select2("destroy"),this.dataMapper.setSubscription(!1),Backbone.View.prototype.remove.call(this)},rX.prototype.removeMapping=function(e){this.dataMapper.removeMapping(e)},rX.prototype.render=function(e){return this.$el.html(T.DataConfigMapping({theme:"kx-light"!==$.cookie("dashboard-theme")?"Dark":"Light",singleValue:e})),this.$addMapping=this.$el.find(".add-mapping"),this.$mappings=this.$el.find(".table-body"),this.$mappingTable=this.$el.find(".mapping-table"),this.$keySelect=this.$el.find(".key-select"),this.$resetMapping=this.$el.find(".reset-mapping"),this.$valueSelect=this.$el.find(".value-select"),this.$addMapping.button({icons:{primary:"fa fa-plus"},text:!1}),this.$resetMapping.button({icons:{primary:"fa fa-undo"},text:!1}),this.$keySelect.select2({theme:"dashboards",width:"100%"}),this.$valueSelect.select2({theme:"dashboards",width:"100%"}),this.renderMappings(),this},rX.prototype.renderMappings=function(){_.each(this.mappingViews,function(e){this.stopListening(e.model),e.remove()}.bind(this)),this.mappingViews=[],this.dataMapper.mappings.each(function(e,t){t=new DataConfigMappingItem({className:"slick-row "+(t%2==0?"even":"odd"),dataMapper:this.dataMapper,model:e,openViewStateDialog:this.openViewStateDialog.bind(this),setSelectClasses:this.setSelectClasses.bind(this)});this.listenTo(e,"destroy",this.removeMapping),this.mappingViews.push(t),this.$mappings.append(t.$el)}.bind(this)),this.setScrollClasses()},rX.prototype.setScrollClasses=function(){this.$mappingTable.toggleClass("has-scrollbar",this.$mappings.get(0).scrollHeight>this.$mappings.height())},rX.prototype.setSelectClasses=function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")},rX.prototype.setSelectOptions=function(){var e=_.union([this.model.get("key"),this.model.get("value")],this.dataMapper.getColumns());this.$keySelect.empty(),this.$valueSelect.empty(),_.each(e,function(e,t){this.$keySelect.append(new Option(e,e,0===t,this.model.get("key")===e)),this.$valueSelect.append(new Option(e,e,0===t,this.model.get("value")===e))}.bind(this)),this.$keySelect.trigger("change"),this.$valueSelect.trigger("change")},rX),qX;function rX(e){var t=qX.call(this,e)||this;return t.tagName="div",t.dataMapper=e.dataMapper,t.docDataModel=e.docDataModel,t.docViewModel=e.docViewModel,t.model=t.dataMapper.model,t.mappings=t.dataMapper.mappings,t.viewModel=new Backbone.Model,t.render(),t.setSelectOptions(),t.initializeEvents(),t.onModelMappingKeyChange(),t.onModelMappingValueChange(),require(["Datagrid"]),t}var ConnectionManagement=(KX=Backbone.View,__extends(LX,KX),LX.prototype.openDialog=function(){var e,t,i;this.positionDialog(),this.$dialog.dialog("open"),this.launchObject&&(i=t=e=void 0,(e=this.connections.get(this.launchObject))?(this.currentConnection=this.launchObject,i="connection",t=0):(e=this.connectionGroups.get(this.launchObject))?(this.currentGroup=this.launchObject,i="group",t=1):(e=this.services.get(this.launchObject))&&(this.currentServices=this.launchObject,i="services",t=2),e&&void 0!==t&&(this.$el.find(".connectionsTabs").tabs({active:t}),this.launchObject="",this.setSelectedRows(),this.loadConnectionDetails(i,e.id)))},LX.prototype.remove=function(){return this.$el.dialog("close"),this.multiselectDatagridWrapper.remove(),this.groupDatagridAppWrapper&&this.groupDatagridAppWrapper.remove(),this.datagridAppWrapper.remove(),this.trigger("onRemove"),Backbone.View.prototype.remove.call(this)},LX.prototype.setDOMObjects=function(){this.$statusBar=this.$el.find(".statusBar"),this.$connectionDetailsPanel=this.$el.find(".connectionDetailsPanel"),this.$groupDetailsPanel=this.$el.find(".groupDetailsPanel")},LX.prototype.setSelectedRows=function(){this.datagridAppWrapper.app&&this.datagridAppWrapper.app.grid&&this.selectedConnection.set("value",this.currentConnection),this.connectionGroups&&this.datagridAppWrapper.app&&this.groupDatagridAppWrapper.app.grid&&this.selectedGroup.set("value",this.currentGroup),this.services&&this.serviceDatagridAppWrapper&&this.serviceDatagridAppWrapper.app&&this.serviceDatagridAppWrapper.app.grid&&this.selectedServices.set("value",this.currentServices)},LX.prototype.disableNewDuplicateEditButtons=function(){$(this.$editButtons[0]).button("disable"),$(this.$editButtons[1]).button("disable"),$(this.$editButtons[2]).button("disable")},LX.prototype.enableNewDuplicateEditButtons=function(){$(this.$editButtons[0]).button("enable"),$(this.$editButtons[1]).button("enable"),$(this.$editButtons[2]).button("enable")},LX.prototype.getTheme=function(){return"kx-light"===$.cookie("dashboard-theme")?"Light":"Dark"},LX.prototype.onBtnNewClick=function(){switch(this.disableNewDuplicateEditButtons(),this.currentTab){case"Individual":return this.setTitle("Connection Management: New Connection"),this.isCreatingSingle=!0,this.$connectionDetailsPanel.show(),this.$groupDetailsPanel.hide(),this.enableInputs("connection"),this.$el.find(".saveConnectionBtn").show(),void this.$el.find(".cancelBtn").show();case"Groups":return this.setTitle("Connection Management: New Connection Group"),this.isCreatingGroup=!0,this.$groupDetailsPanel.show(),this.$connectionDetailsPanel.hide(),this.multiSelection.set("value",[]),this.enableInputs("group"),this.$el.find(".saveGroupBtn").show(),this.$el.find(".cancelBtn").show(),void this.$el.find(".groupName").prop("disabled","")}},LX.prototype.onBtnDeleteClick=function(){switch(this.currentTab){case"Individual":return void this.deleteConnectionConfirm(this.deleteConnection.bind(this),this.$connectionDetailsPanel.find(".title")[0].innerText);case"Groups":return void this.deleteConnectionConfirm(this.deleteGroup.bind(this),this.$groupDetailsPanel.find(".title")[0].innerText)}},LX.prototype.onBtnSaveClick=function(){this.enableNewDuplicateEditButtons(),this.$el.find(".groupName").prop("disabled","disabled"),this.isCreatingSingle||this.isCreatingGroup?"Individual"===this.currentTab?(this.createConnection(),this.isCreatingSingle=!1):(this.createGroup(),this.isCreatingGroup=!1):"Individual"===this.currentTab?this.editConnection():this.editGroup()},LX.prototype.onBtnDuplicateClick=function(){switch(this.currentTab){case"Individual":return void this.createConnection(!0);case"Groups":return void this.createGroup(!0)}},LX.prototype.createConnection=function(e){var i,n,a=this,o=this.$connectionDetailsPanel.find(".name").val()+(e?" (Copy)":""),s=this.$connectionDetailsPanel.find(".password").val();s===this.$connectionDetailsPanel.find(".confirmPassword").val()?(i=(n=this.getHostPortDriver()).host,e=n.port,n=n.driver,this.connections.create({name:o,host:i,port:e,user:this.$connectionDetailsPanel.find(".user").val(),password:s,type:this.$connectionDetailsPanel.find(".type option:selected").val(),driver:n,tls:this.$el.find(".tls").is(":checked")?"on":"off"},{success:function(){a.isCreatingSingle=!1,a.currentConnection=o,a.populateConnectionsList(),a.populateConnectionGroupsList(),a.showMessageAndRefresh("Connection created successfully")},error:function(e){return a.showError(t("Error creating connection."),e)}})):this.showError("Password and password confirmation don't match.","")},LX.prototype.getHostPortDriver=function(){var e=this.$connectionDetailsPanel.find(".type option:selected").val(),t=this.$connectionDetailsPanel.find(".database").val(),i=this.$connectionDetailsPanel.find(".host").val(),n=this.$connectionDetailsPanel.find(".port").val(),a=this.$connectionDetailsPanel.find(".driver").val();switch(e){case"jdbc:com.mysql.jdbc.Driver":i="jdbc:mysql://"+i+":"+n+"/"+t+"?socketTimeout=35000",n=0,a="";case"jdbc:oracle.jdbc.OracleDriver":i="jdbc:oracle:thin:@"+i+":"+n+":"+t,n=0,a="";case"jdbc:com.microsoft.sqlserver.jdbc.SQLServerDriver":i="jdbc:sqlserver://"+i+":"+n+";databaseName="+t+";",n=0,a="",this.$el.find(".integratedSecurity").is(":checked")&&(i+="integratedSecurity=true;");case"daemon":n=0}return{host:i,port:n,driver:a}},LX.prototype.createGroup=function(e){for(var i=this,n=e?this.$el.find(".groupName").val()+" (copy)":this.$el.find(".groupName").val(),a=this.multiSelection.get("value"),o=[],e=this.$el.find(".groupType").val(),s=0;s<a.length;s+=1)o.push("primary");new QuickBase.ConnectionGroup({name:n,type:e,connections:a,connectionsType:o}).sync("create",this.connectionGroups,{success:function(e){i.currentGroup=n,i.isCreatingGroup=!1,i.populateConnectionGroupsList(),i.showMessageAndRefresh("Connection group created successfully"),Log.Info("success",e)},error:function(e){return i.showError(t("Error creating connection group."),e)}})},LX.prototype.createStatusBar=function(){var e=(1e6*Math.random()).toFixed()+"-statusBar",t=document.createElement("div");t.classList.add("statusBar"),t.classList.add(e),this.$el[0].parentElement.appendChild(t),this.$statusBar=$("."+e)},LX.prototype.deleteConnectionConfirm=function(e,i){QuickBase.ConfirmDialog.ShowConfirm({callback:function(){e&&e(i)},renderTemplate:function(){return t("Are you sure you want to delete connection/Group?")},container:this.$el})},LX.prototype.deleteConnection=function(e){var i=this;this.connections.get(e).destroy({success:function(e){i.populateConnectionsList(),i.populateConnectionGroupsList(),i.showMessageAndRefresh("Connection deleted successfully"),Log.Info("success",e)},error:function(e){return i.showError(t("Error deleting connection."),e)}})},LX.prototype.deleteGroup=function(e){var i=this;this.connectionGroups.get(e).destroy({success:function(e){i.populateConnectionGroupsList(),i.showMessageAndRefresh("Connection group deleted successfully"),Log.Info("success",e)},error:function(e){i.showError(t("error creating connection group."),e)}})},LX.prototype.editConnection=function(){var e,i,n,a,o=this,s=this.$connectionDetailsPanel.find(".password").val();s===this.$connectionDetailsPanel.find(".confirmPassword").val()?(e=(a=this.getHostPortDriver()).host,i=a.port,n=a.driver,a=this.currentConnection,this.currentConnection=this.$el.find("input.name").val(),this.connections.get(a).save({name:a,originalName:this.currentConnection,host:e,port:i,user:this.$el.find("input.user").val(),password:s,type:this.$el.find(".type option:selected").val(),driver:n,tls:this.$el.find(".tls").is(":checked")?"on":"off"},{success:function(){o.populateConnectionsList(),o.populateConnectionGroupsList(),o.setSelectedRows(),o.showMessageAndRefresh("Connection edited successfully")},error:function(e){return o.showError(t("Error editing connection."),e)}})):this.showError("Password and password confirmation don't match.","")},LX.prototype.editGroup=function(){var i=this,e=this.multiSelection.get("value"),e={name:this.$el.find(".groupName").val(),originalName:this.currentGroup,connections:e,type:this.$el.find(".groupType").val()};this.connectionGroups.get(e.originalName).save(e,{success:function(){i.populateConnectionGroupsList(),i.showMessageAndRefresh("Connection edited successfully")},error:function(e){return i.showError(t("Error editing connection group."),e)}})},LX.prototype.enableInputs=function(e){"connection"===e?(this.$connectionDetailsPanel.find(".title").text(t("New Connection")),this.$connectionDetailsPanel.find("input").removeAttr("readonly"),this.$connectionDetailsPanel.find("input").val(""),this.$connectionDetailsPanel.find("select").removeAttr("disabled"),this.$connectionDetailsPanel.find(".tls").removeAttr("disabled")):"group"===e&&(this.$groupDetailsPanel.find(".title").text(t("New Group")),this.$groupDetailsPanel.find("input").removeAttr("readonly").val(""),this.$groupDetailsPanel.find("select").removeAttr("disabled"),this.$el.find(".multipleSelect").show())},LX.prototype.initializeDialogDisplay=function(){var i=this;this.connectionGroups?(this.populateConnectionGroupsList(),this.$el.find(".connectionsTabs").tabs({active:0,activate:function(e,t){i.currentTab=t.newTab[0].innerText,i.$editButtons.each(function(e,t){$(t).button("enable")}),"Groups"===i.currentTab?(i.$groupDetailsPanel.show(),i.groupDatagridAppWrapper.app.onResize(),i.multiselectDatagridWrapper.app.onResize(),i.setTitle("Connection Management: "+i.currentGroup),i.isCreatingGroup&&(i.disableNewDuplicateEditButtons.call(i),i.setTitle("Connection Management: New Connection Group"))):0===i.currentTab.localeCompare("Services")?(i.setTitle("Connection Management"),i.$editButtons.each(function(e,t){$(t).button("disable")}),i.serviceDatagridAppWrapper.app.onResize()):(i.$connectionDetailsPanel.show(),i.setTitle("Connection Management: "+i.currentConnection),i.datagridAppWrapper.app.onResize(),i.isCreatingSingle&&(i.disableNewDuplicateEditButtons(),i.setTitle("Connection Management: New Connection")))}})):(this.$el.find(".connectionsTabs > ul").hide(),this.$el.find(".connectionsList").css("top","-8px"),this.populateConnectionsList())},LX.prototype.loadConnectionDetails=function(e,t){var i;"group"===e?(i=this.connectionGroups.get(t)||this.connectionGroups.first(),this.$el.find(".groupDetailsPanel").show(),this.currentGroup=i?i.get("name"):null):(i=this.connections.get(t)||this.connections.first(),this.$connectionDetailsPanel.show(),i&&this.onTypeChange(i.get("type")),this.currentConnection=i?i.get("name"):null),i&&this.populateDetailsPanel(e,i.attributes)},LX.prototype.onTypeChange=function(e){_.includes(["q","daemon"],e)?(this.$el.find(".databaseRow").hide(),this.$el.find(".integratedSecurityRow").hide()):(this.$el.find(".databaseRow").show(),"jdbc:com.microsoft.sqlserver.jdbc.SQLServerDriver"===e&&this.$el.find(".integratedSecurityRow").show())},LX.prototype.parseJdbcHost=function(e,t){var i,n,a,o,s,r=e.host,l=!1,e="database";"jdbc:com.mysql.jdbc.Driver"===this.$el.find(".type").val()?(i="jdbc:mysql://",s="mysql"):"jdbc:oracle.jdbc.OracleDriver"===this.$el.find(".type").val()?(i="jdbc:oracle:thin:@",s="oracle"):"jdbc:com.microsoft.sqlserver.jdbc.SQLServerDriver"===this.$el.find(".type").val()&&(i="jdbc:sqlserver://",s="mssql"),"mssql"!==s?(n=(r=r.substring(i.length)).split(":")[0],a=r.split(":")[1].split("/")[0],"mysql"===s?o=r.split(":")[1].split("/")[1].split("?")[0]:(o=r.split(":")[2],e="SID")):(n=(r=r.substring(i.length)).split(":")[0],a=r.split(":")[1].split(";")[0],o=r.split(":")[1].split("=")[1],2<r.split(":").length&&(l=-1<r.split(":")[2].indexOf("true"))),t.find(".integratedSecurity").prop("checked",l),t.find(".databaseRow label").text(e+":"),t.find(".host").val(n),t.find(".port").val(a),t.find(".database").val(o)},LX.prototype.populateConnectionsList=function(){var n=this,a=this.$el.find(".singleConnectionsList ul");require(["Datagrid"],function(e){var i=new QuickBase.DocumentDataModel({_subscriptionKey:"name",_dataType:"copy",_maxRows:1e5},null,null,n.docViewModel);i.apply(),n.selectedConnection=new QuickBase.DocumentViewModel({_default:n.currentConnection,_viewType:!0,_type:"symbol",value:n.currentConnection},{}),n.selectedConnection.path="dg_connection",n.listenTo(n.selectedConnection,"change:value",function(e,t){n.enableNewDuplicateEditButtons(),n.isCreatingSingle=!1,t&&(n.loadConnectionDetails("connection",t),n.currentConnection=t)});e=e.getSettingsModel({Basics:{Data:i,Filtering:"Column Filters",ShowPagingControl:!1,EnableGrouping:!1},ColumnsConfiguration:[e.getColumnSettingsModel({Field:"name",TextAlign:"left"})],Selection:{Mode:"Single Row",RowSelectionColumn:"name",SelectedValue:n.selectedConnection,FollowSelectedValue:!0},FileExport:{ShowExportCsvButton:!1,ShowExportExcelButton:!1},Style:{FontSize:"11px",RowHeight:20,HeaderRowHeight:20}});n.datagridAppWrapper=new QuickBase.AppView({el:n.$el.find(".singleConnectionsListGrid")[0],key:"Datagrid",settings:e,dashboardViewModel:new Backbone.Model({DashboardTheme:n.getTheme()}),dashboardAppModel:new Backbone.Model,docViewModel:n.docViewModel,deltaClient:null,callback:function(){n.connections.fetch({success:function(e){var t=e.map(function(e){return e.get("name")}).map(function(e){return'<li data-type="connection" data-value="'+_.escape(e)+'"><span class="conn_title">'+e+'</span><span class="deleteItem fa fa-trash-o"></li>'}).join("\n");a.html(""),a.append(t),i.onExecuteSuccess({class:"",columns:["name"],meta:{name:11},rows:e.map(function(e){return e.attributes})},!0),$(".ui-state-default.slick-headerrow-column.l0.r0 input")[0].setAttribute("placeholder","search connections..."),n.populateMultiSelect()},error:function(e){return alert(e)}})}})},function(e){console.log("DataConfigAnalytic.js: Datagrid initialization error",e)})},LX.prototype.populateConnectionGroupsList=function(){var n=this,a=this.$el.find(".groupConnectionsList ul");this.connectionGroups&&require(["Datagrid"],function(e){var i=new QuickBase.DocumentDataModel({_subscriptionKey:"name",_dataType:"copy",_maxRows:1e5},null,null,null);i.apply(),n.selectedGroup=new QuickBase.DocumentViewModel({_default:n.currentGroup,_viewType:!0,_type:"symbol",value:n.currentGroup},{}),n.selectedGroup.path="dg_group",n.listenTo(n.selectedGroup,"change:value",function(e,t){n.enableNewDuplicateEditButtons.call(n),n.$el.find(".groupName").prop("disabled","disabled"),n.isCreatingGroup=!1,t&&(n.loadConnectionDetails("group",t),n.currentGroup=t)});e=e.getSettingsModel({Basics:{Data:i,Filtering:"Column Filters",ShowPagingControl:!1,EnableGrouping:!1},ColumnsConfiguration:[e.getColumnSettingsModel({Field:"name",TextAlign:"left"})],Selection:{Mode:"Single Row",RowSelectionColumn:"name",SelectedValue:n.selectedGroup,FollowSelectedValue:!0},FileExport:{ShowExportCsvButton:!1,ShowExportExcelButton:!1},Style:{FontSize:"11px",RowHeight:20,HeaderRowHeight:20}});n.groupDatagridAppWrapper=new QuickBase.AppView({el:n.$el.find(".groupConnectionListGrid")[0],key:"Datagrid",settings:e,dashboardViewModel:new Backbone.Model({DashboardTheme:n.getTheme()}),dashboardAppModel:new Backbone.Model,docViewModel:n.docViewModel,deltaClient:null,callback:function(){n.connectionGroups.fetch({success:function(e){var t=e.map(function(e){return'<li data-type="group" data-value="'+_.escape(e.get("name"))+'"><span class="conn_title">'+e.get("name")+":</span> ("+e.get("connections").join(", ")+') <span class="deleteItem fa fa-trash-o"></span></li>'}).join("\n");a.html(t),i.onExecuteSuccess({class:"",columns:["name"],meta:{name:11},rows:e.map(function(e){return e.attributes})},!0),n.populateConnectionsList()}})}})},function(e){console.log("DataConfigAnalytic.js: Datagrid initialization error",e)})},LX.prototype.populateDetailsPanel=function(e,t){var i=this.$groupDetailsPanel,n=this.$connectionDetailsPanel;switch(this.setTitle("Connection Management: "+this.currentTab=="Groups"?this.currentGroup:this.currentConnection),e){case"group":i.find(".title").text(t.name),i.find(".groupName").val(t.name),i.find(".groupType").val(t.type),i.find(".multipleSelect select").val(t.connections),this.multiSelection.set("value",t.connections);break;case"connection":if(t.confirmPassword="",n.find(".title").text(t.name),_.each(_.keys(t),function(e){"type"===e&&"deltaclient"===t[e]&&(t[e]="q"),"tls"===e?n.find("."+e).prop("checked","on"===t[e]):n.find("."+e).val(t[e])}),"q"!==t.type&&"daemon"!==t.type)try{this.parseJdbcHost(t,n)}catch(e){console.error("Failed to Parse Jdbc Host: ",e)}n.find(".saveConnectionBtn").hide()}},LX.prototype.populateMultiSelect=function(){var i=this;require(["Datagrid"],function(e){var t=new QuickBase.DocumentDataModel({_subscriptionKey:"name",_dataType:"copy",_maxRows:1e5},null,null,null);t.apply(),i.multiSelection=new QuickBase.DocumentViewModel({_default:[],_viewType:!0,_type:"list",value:[]},{}),i.multiSelection.path="dg_multiselect";e=e.getSettingsModel({Basics:{Data:t,Filtering:"Column Filters",ShowPagingControl:!1,EnableGrouping:!1},ColumnsConfiguration:[e.getColumnSettingsModel({Field:"name",TextAlign:"left"})],Selection:{Mode:"Multi Row",CheckboxAlignment:"left",RowSelectionColumn:"name",SelectedValue:i.multiSelection,FollowSelectedValue:!0},FileExport:{ShowExportCsvButton:!1,ShowExportExcelButton:!1},Style:{FontSize:"11px",RowHeight:20,HeaderRowHeight:20}});i.multiselectDatagridWrapper=new QuickBase.AppView({el:i.$groupDetailsPanel.find(".multipleSelect")[0],key:"Datagrid",settings:e,dashboardViewModel:new Backbone.Model({DashboardTheme:i.getTheme()}),dashboardAppModel:new Backbone.Model,docViewModel:i.docViewModel,deltaClient:QuickBase.DeltaClientLib.deltaClient,callback:function(){i.connections.fetch({success:function(e){t.onExecuteSuccess({class:"",columns:["name"],meta:{name:11},rows:e.map(function(e){return e.attributes})},!0),i.setSelectedRows(),i.loadConnectionDetails("connection",i.currentConnection),i.connectionGroups&&i.loadConnectionDetails("group",i.currentGroup),i.services?i.populateServicesList():i.launchObject&&i.openDialog()},error:function(e){alert(e)}})}})},function(e){console.log("DataConfigAnalytic.js: Datagrid initialization error",e)})},LX.prototype.populateServicesList=function(){var i=this;require(["Datagrid"],function(e){var t=new QuickBase.DocumentDataModel({_subscriptionKey:"name",_dataType:"copy",_maxRows:1e5},null,null,null);i.selectedServices=new QuickBase.DocumentViewModel({_default:i.currentServices,_viewType:!0,_type:"symbol",value:i.currentServices},null),i.selectedServices.path="dg_services",t.apply();e=e.getSettingsModel({Basics:{Data:t,Filtering:"Column Filters",ShowPagingControl:!1,EnableGrouping:!1},ColumnsConfiguration:[e.getColumnSettingsModel({Field:"name",TextAlign:"left"})],Selection:{Mode:"Single Row",RowSelectionColumn:"name",SelectedValue:i.selectedServices,FollowSelectedValue:!0},FileExport:{ShowExportCsvButton:!1,ShowExportExcelButton:!1},Style:{FontSize:"11px",RowHeight:20,HeaderRowHeight:20}});i.serviceDatagridAppWrapper=new QuickBase.AppView({el:i.$el.find(".servicesListGrid")[0],key:"Datagrid",settings:e,dashboardViewModel:new Backbone.Model({DashboardTheme:i.getTheme()}),dashboardAppModel:new Backbone.Model,docViewModel:i.docViewModel,deltaClient:null,callback:function(){i.services.fetch({success:function(e){t.onExecuteSuccess({class:"",columns:["name"],meta:{name:11},rows:e.map(function(e){return e.attributes})},!0)}})}})})},LX.prototype.positionDialog=function(){var e=QuickBase.Tools.calcDialogHeight(400,"dataDialog"),t=e<400?"top":"center";"FSBL"in window&&this.$dialog.parent().css("margin-top",window.finApi.DIALOGS_TOP_MARGIN),this.$dialog.dialog("option","height",e),this.$dialog.dialog("option","position",{my:"center",at:t,of:"#appdiv",collision:"fit"})},LX.prototype.setTitle=function(e){this.$dialog.parent().find(".ui-dialog-title").text(e)},LX.prototype.showError=function(e,i){var n=this;"string"==typeof i?this.$statusBar.text(e+" "+t("Error")+': "'+i+'"'):this.$statusBar.text(e),this.$statusBar.css({opacity:1,"background-color":"#ED3054"}),_.delay(function(){return n.$statusBar.css("opacity",0)},3500),_.delay(function(){n.$statusBar.css({"background-color":"#62BA62"})},4e3)},LX.prototype.showMessageAndRefresh=function(e){var i=this;this.trigger("RefreshConnectionList"),this.$statusBar.text(t(e)),this.$statusBar.css({opacity:1}),_.delay(function(){return i.$statusBar.css({opacity:0})},3500)},LX),KX;function LX(e){var i=KX.call(this,_.extend(e,{className:"connectionManagementPanel"}))||this;i.currentTab="Individual",i.currentConnection="",i.currentGroup="",i.currentServices="",i.isCreatingGroup=!1,i.isCreatingSingle=!1,i.connections=e.appModel.get("connections"),i.connectionGroups=e.appModel.get("connectionGroups"),i.services=e.appModel.get("services"),i.docViewModel=e.docViewModel,i.launchObject=e.launchObject;var n={singleConnectionsId:_.uniqueId("connectionsTab_"),groupConnectionsId:_.uniqueId("connectionsTab_"),serivcesTabId:_.uniqueId("connectionsTab_"),isLite:e.appModel.get("isLite")};return i.$el.html(T.ConnectionManagement(n)),i.setDOMObjects(),i.$dialog=i.$el.dialog({appendTo:e.container,dialogClass:"quick-dash new-connection-panel",modal:!0,resizable:!1,title:"Connection Management",height:400,width:600,create:function(){i.$editButtons=$(i).parent().find(".ui-dialog-buttonset").children(),i.$editButtons=i.$editButtons.slice(0,i.$editButtons.length-1),i.initializeDialogDisplay()},close:function(){i.remove()},buttons:[{text:t("New"),click:i.onBtnNewClick.bind(i),icons:{primary:"fa fa-plus"}},{text:t("Duplicate"),click:i.onBtnDuplicateClick.bind(i),icons:{primary:"fa fa-copy"}},{text:t("Delete"),click:i.onBtnDeleteClick.bind(i),icons:{primary:"fa fa-trash-o"}},{text:t("Save"),click:i.onBtnSaveClick.bind(i),icons:{primary:"fa fa-floppy-o"}},{text:t("Close"),click:i.remove.bind(i),icons:{primary:"fa fa-times"}}]}),i.positionDialog(),i.createStatusBar(),i.$el.find(".type").change(function(e){i.onTypeChange(i.$el.find(".type").val())}),i}var DataConfigForm=Backbone.View.extend({$dataDiv:null,$rawDataView:null,$resultsDiv:null,$queryStatus:null,$connectionsCombobox:null,$connectionTypeSelect:null,$connectionSelect:null,dataTable:null,$parametersBtn:null,$newConnectionGroupBtn:null,$addParameterButton:null,parameterDialog:null,guidObject:null,appModel:null,dataModel:null,data:{},className:"data-config-dialog",connectionManagementPanel:null,DATA_SOURCE_PROP:"_dataSource",DATA_TYPE_PROP:"_dataType",LAYOUT_PROP:"_layout",MAXROWS_PROP:"_maxRows",PAGESIZE_PROP:"_pageSize",PAGINGTYPE_PROP:"_pagingType",PIVOT_TYPE_PROP:"_pivotType",QUERY_STR_PROP:"_queryString",CONNECTION_PROP:"_connection",SERVER_PAGING_PROP:"_serverPaging",SUBCRIPTION_PROPERTY:"_subscriptionType",HAS_UPDATE_PROP:"_hasUpdateQuery",UPDATE_TYPE_PROP:"_updateType",subscriptionSz:34,hasSubscribed:!1,initialize:function(e){var t=this;t.appModel=e.appModel,t.connections=t.appModel.get("connections"),t.connectionGroups=t.appModel.get("connectionGroups"),t.services=t.appModel.get("services"),t.docDataModel=e.docDataModel,t.docViewModel=e.docViewModel,t.dataDialogView=e.dataDialogView,t.dataConnectionMiniMode=e.dataConnectionMiniMode,t.dialogContainer=e.dialogContainer,t.subscriptionKey=_.uniqueId("queryEditor_"),t.dataGridSubscriptionKey=_.uniqueId("queryEditor_DataGrid_"),t.columnInfo=new Backbone.Collection,t.domIds={tableId:_.uniqueId("dc_"),mappingId:_.uniqueId("dc_"),rawId:_.uniqueId("dc_"),objectId:_.uniqueId("dc_")},t.model.set("isSourceDataDialog",!0),t.$el.addClass(this.className),t.$el.html(T.DataConfigForm(_.extend(t.domIds,{query_graph:t.appModel.get("isLite")&&(t.appModel.get("query_graph")||!t.appModel.attributes.hasOwnProperty("query_graph"))||!t.appModel.get("isLite")&&"true"===QuickBase.DeltaClientLib.getDashboardProperty("query_graph")}))),t.$queryRadio=t.$el.find("input.query").parent(),t.debounceUpdateForm=_.debounce(t.updateForm,100),t.$connectionTypeSelect=t.$el.find(".connection-type-select select"),t.$connectionSelect=t.$el.find(".connection-select select"),t.$newConnectionGroupBtn=t.$el.find(".newConnectionGroup"),t.$connectionTypeSubscription=t.$el.find(".connection-subscription select"),t.$executeButton=t.$el.find(".run-btn"),t.$dataTypeRadio=t.$el.find("input:radio[name=_dataType]"),t.$functionFieldset=t.$el.find("fieldset.function"),t.$addParameterButton=t.$el.find(".add-parameter-btn"),t.$dataDiv=t.$el.find(".data-div"),t.$mappingDiv=this.$el.find("#"+t.domIds.mappingId),t.$resultsDiv=t.$el.find(".results-div"),t.$rawDataOutput=this.$el.find("#"+t.domIds.rawId),t.$queryStatus=t.$el.find(".queryStatus"),t.$tabs=t.$el.find(".tabs"),t.$pivotCheckbox=t.$el.find(".pivot-checkbox"),t.$updateCheckbox=t.$el.find(".update-checkbox"),t.$pivotTypeRadio=t.$el.find("input:radio[name=_pivotType]"),t.$subscription=t.$el.find(".subscription"),t.$updateTypeRadio=t.$el.find("input:radio[name=_updateType]"),t.$pivotLabel=t.$el.find(".pivot-label"),t.$updateLabel=t.$el.find(".update-label"),t.throttleStop=_.throttle(function(){t.model.stop(),t.throttleStop.flush()},5e3,{leading:!1}),t.$newConnectionGroupBtn.button({icons:{primary:"fa fa-cogs"},text:!1}).click($.proxy(t.openConnectionManagement,t)),t.$executeButton.button({icons:{primary:"fa fa-play"}}).click($.proxy(t.onExecuteButtonClick,t)),t.$addParameterButton.button({icons:{primary:"fa fa-plus"}}).click($.proxy(t.openParameterDialog,t)),t.model.get("_dataSource")&&"deltaclient"!==t.model.get("_dataSource")||t.model.set({_dataSource:"kdb"},{silent:!0}),t.$connectionTypeSelect.select2({dropdownAutoWidth:!1,minimumResultsForSearch:5,theme:"dashboards"}),t.$connectionTypeSelect.val(t.model.get("_dataSource")).trigger("change"),t.$connectionTypeSelect.on("select2:open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")}),this.subscriptionSelect=new SubscriptionSelect({el:t.$subscription,model:this.model,dialogContainer:this.dialogContainer,docDataModel:this.docDataModel,docViewModel:this.docViewModel,isLite:this.appModel.get("isLite")}),t.$maxRowsInput=t.$el.find("input."+t.MAXROWS_PROP),t.$pageSizeInput=t.$el.find("input."+t.PAGESIZE_PROP),t.$serverPagingCheck=t.$el.find('input[name="'+t.SERVER_PAGING_PROP+'"]'),navigator.userAgent.toLowerCase().match(/trident|firefox/)&&(t.subscriptionSz=20,t.$el.find(".data-div > div").css("min-height","20px")),t.$tabs.tabs({activate:$.proxy(t.onTabActivate,t)}),t.sections=[{$el:t.$el.find(".function"),$heading:"> legend",$content:"> fieldset > div",weight:2,isExpanded:!0,resize:function(){t.dataConfigQuery&&t.dataConfigQuery.onResize(),t.dataConfigAnalytic&&t.dataConfigAnalytic.$el.is(":visible")&&t.dataConfigAnalytic.onResize(),t.dataConfigUpdate&&t.dataConfigUpdate.$el.is(":visible")&&t.dataConfigUpdate.onResize(),t.dataConfigVirtual&&t.dataConfigVirtual.onResize()}},{$el:t.$el.find(".pivot"),$heading:"> legend",$content:"> fieldset > div",weight:1,isExpanded:!0,hidden:!0},{$el:t.$el.find(".update"),$heading:"> legend",$content:"> fieldset > div",weight:1,isExpanded:!1,hidden:!0},{$el:t.$subscription,$heading:"> legend",$content:"> fieldset > div",weight:0,fixed:80,isExpanded:!1},{$el:t.$el.find(".results"),$heading:"> legend",$content:"> fieldset > div",weight:2,isExpanded:!1,hidden:!0,resize:function(){t.resizeDatatable(),t.mappingView&&t.mappingView.onResize()}}],t.accordion=new AccordionView({el:t.$dataDiv.get(0),sections:t.sections,onUpdate:$.proxy(t.onAccordionUpdate,t)}),t.onModelDataSourceChange(),t.onModelDataTypeChange(),t.onModelHasUpdateChange(),t.onModelPivotTypeChange(),t.onModelSubscriptionTypeChange(),t.onModelMaxRowsChange(),t.onModelPageSizeChange(),t.onModelServerPagingChange(),t.onModelLayoutChange(),t.initializeEvents(),t.model.execute=$.noop,t.dataConnectionMiniMode&&t.$el.addClass("dataConnectionMiniMode"),e.initialTab&&(t.sections[4].hidden=!1,t.sections[4].isExpanded=!0,t.onAccordionUpdate(),t.$tabs.tabs("option","active",e.initialTab),t.onTabActivate()),"sql"===t.model.get("_dataSource")?(t.$pivotLabel.hide(),t.$updateLabel.hide(),t.model.set(t.DATA_TYPE_PROP,"query"),t.$dataTypeRadio.parentsUntil("fieldset").hide()):(t.$pivotLabel.show(),t.$updateLabel.show(),t.$dataTypeRadio.parentsUntil("fieldset").show())},initializeEvents:function(){var i=this;i.listenTo(i.model,"change:"+this.CONNECTION_PROP,i.onModelConnectionChanged),i.$dataTypeRadio.change(function(){var e=i.$el.find('input:radio[name="_dataType"]:checked').val(),t=i.model.get(i.DATA_TYPE_PROP);i.model.set(i.DATA_TYPE_PROP,"streaming"===e?"analytic":e),t===i.model.get(i.DATA_TYPE_PROP)&&i.model.trigger("change:_dataType",i.model,e)}),i.$updateTypeRadio.change(function(){i.model.set(i.UPDATE_TYPE_PROP,this.value)}),i.model.get("_updateType")||i.model.set("_updateType","query",{silent:!0}),this.$updateTypeRadio.val([i.model.get("_updateType")]),i.$pivotCheckbox.change(function(){var e="query"===i.model.get(i.DATA_TYPE_PROP)?"server":"client";i.model.set(i.PIVOT_TYPE_PROP,this.checked?e:"")}),i.$updateCheckbox.change(function(){i.model.set(i.HAS_UPDATE_PROP,this.checked)}),i.$connectionTypeSelect.on("select2:select",function(){i.model.set("_dataSource",i.$connectionTypeSelect.val())}),i.$pivotTypeRadio.change(function(){i.model.set(i.PIVOT_TYPE_PROP,i.$el.find('input:radio[name="_pivotType"]:checked').val())}),i.listenTo(i.model,"change:_dataSource",function(){"sql"===i.model.get("_dataSource")?(i.$pivotLabel.hide(),i.$updateLabel.hide(),i.model.set(i.DATA_TYPE_PROP,"query"),i.$dataTypeRadio.parentsUntil("fieldset").hide()):(i.$pivotLabel.show(),i.$updateLabel.show(),i.$dataTypeRadio.parentsUntil("fieldset").show())}),i.listenTo(i.model,"change:"+i.DATA_TYPE_PROP,i.onModelDataTypeChange),i.listenTo(i.model,"change:"+i.HAS_UPDATE_PROP,i.onModelHasUpdateChange),i.listenTo(i.model,"change:"+i.UPDATE_TYPE_PROP,i.onUpdateTypeChange),i.listenTo(i.model,"change:"+i.PIVOT_TYPE_PROP,i.onModelPivotTypeChange),i.listenTo(i.model,"change:"+i.SUBCRIPTION_PROPERTY,i.onModelSubscriptionTypeChange),i.$maxRowsInput.on("input",_.debounce($.proxy(i.onInputMaxRowsChange,i),50)),i.listenTo(i.model,"change:"+i.MAXROWS_PROP,i.onModelMaxRowsChange),i.$pageSizeInput.on("input",_.debounce($.proxy(i.onInputPageSizeChange,i),50)),i.listenTo(i.model,"change:"+i.PAGESIZE_PROP,i.onModelPageSizeChange),i.$serverPagingCheck.on("change",$.proxy(i.onInputServerPagingChange,i)),i.listenTo(i.model,"change:"+i.SERVER_PAGING_PROP,i.onModelServerPagingChange),i.listenTo(i.model,"change:"+this.DATA_TYPE_PROP,i.validateUI),i.listenTo(i.model,"change:_breakdownCols",i.validateUI),i.listenTo(i.model,"change:_aggregateCols",i.validateUI),i.listenTo(i.model,"change:"+this.DATA_SOURCE_PROP,i.onModelDataSourceChange),i.listenTo(i.model,"change:"+i.LAYOUT_PROP,i.onModelLayoutChange),i.listenTo(i.model,"data",i.onModelData)},addDataTable:function(){var a=this;a.loadingDatagridModule?console.log("Datagrid module is already being loaded!"):a.dataTableDisplay?("builder"===a.model.get("_dataType")&&(a.dataTableDisplay.regenerateColumnsConfiguration=!0,a.dataTableDisplay.viewModel.set("ColumnsConfiguration",[])),a.dataTableDisplay.$el.show()):(a.loadingDatagridModule=!0,require(["Datagrid"],function(e){var n,t="Dark";a.loadingDatagridModule=!1,"kx-light"===$.cookie("dashboard-theme")&&(t="Light"),n=e.getSettingsModel({Basics:{Data:a.model,Filtering:"disabled",ShowPagingControl:!1,EnableGrouping:!1},FileExport:{ShowExportCsvButton:!1,ShowExportExcelButton:!1}}),a.dataTableDisplay=new e({dashboardViewModel:new Backbone.Model({DashboardTheme:t}),dataConfigDialogMode:!0,viewModel:new QuickBase.DocumentViewModel,dataModel:a.model,settingsModel:n,api:{showQueryStatus:$.proxy(a.showQueryStatus,a),hideQueryStatus:$.proxy(a.hideQueryStatus,a),subscribe:$.proxy(a.onDataGridSubscribe,a),unsubscribe:$.proxy(a.onDataGridUnsubscribe,a),page:$.proxy(a.onDataGridPage,a),getProperty:function(e){return n.get(e)},setProperty:function(e,t){var i={};n.set(e,t),i[e]=t,a.dataTableDisplay&&a.dataTableDisplay.onSettingsChange(i)},doActions:$.noop,loadSetting:$.noop,saveSetting:$.noop}}),a.$el.find(".dataTableTab").append(a.dataTableDisplay.el),a.dataTableDisplay.onSettingsChange(n.toFlat())},function(e){console.log("ComponentView:loadApp require error",e)}),_.delay(function(){a.loadingDatagridModule=!1},2e3))},addParameterFromDialog:function(e){this.dataConfigQuery&&this.dataConfigQuery.addParameterFromDialog(e)},clearData:function(){this.dataTableDisplay&&this.dataTableDisplay.$el.hide(),this.mappingView&&this.$mappingDiv.hide(),this.$rawDataOutput.text("")},execute:function(e){var t,i,n;this.clearData(),!this.isBlank()&&this.validateUI()&&(this.showUIMask(),(t=e&&"query"===this.model.get(this.DATA_TYPE_PROP))&&(i=this.model.get(this.QUERY_STR_PROP),n=this.model.get(this.PIVOT_TYPE_PROP),this.model.set(this.QUERY_STR_PROP,e,{silent:!0}),this.model.set(this.PIVOT_TYPE_PROP,"",{silent:!0})),this.throttleStop.flush(),this.hasSubscribed?(this.model.apply(),this.model.execute()):(this.model.subscribe(this.subscriptionKey,this),this.hasSubscribed=!0),this.model.dataMapper&&this.model.dataMapper.setSubscription(!0),t&&(this.model.set(this.QUERY_STR_PROP,i,{silent:!0}),this.model.set(this.PIVOT_TYPE_PROP,n,{silent:!0})))},verifyPermission:function(){return!!this.$connectionSelect[0].value||(console.warn("No Selected Connection. Do you have permission for the connection you're trying to run?"),!1)},focusEditor:function(){var e=this.model.get(this.DATA_TYPE_PROP);"query"===e&&this.dataConfigQuery?this.dataConfigQuery.focusEditor():"virtual"===e&&this.dataConfigVirtual&&this.dataConfigVirtual.focusEditor()},hasStreamingNode:function(){var e=this.model.get("_graphJSON");return!_.isEmpty(e)&&_.some(JSON.parse(e).nodes,function(e){return"stream"===e.group})},hideQueryStatus:function(e){this.$queryStatus.hide()},hideUIMask:function(){this.uiMaskCallback&&this.uiMaskCallback()},isBlank:function(){switch(this.model.get(this.DATA_TYPE_PROP)){case"query":case"pivot":return!this.model.get(this.QUERY_STR_PROP);default:return!1}},onAccordionUpdate:function(e){e=_.map(e,function(e){return _.pick(e,"isExpanded","weight")});_.isEqual(this.model.get("_layout"),e)||this.model.set("_layout",e)},onCancelButtonClick:function(){this.$el.dialog("close"),this.remove()},onData:function(e,t,i,n){var a=this.$tabs.tabs("option","active");switch(this.sections[4].hidden=!1,this.sections[4].isExpanded=!0,this.onAccordionUpdate(),this.hideUIMask(),this.data=t,this.meta=e,this.updateColumnsProperty(e.columns),i?this.$el.find(".stacked-bar-graph").empty():n&&(this.renderPerformanceGrid(n),Log.logPerformanceMetrics(this.model.path,n)),this.addDataTable(t),this.throttleStop(),this.model.execute=_.noop,a){case 1:this.updateMappingView();break;case 2:this.updateRawView({meta:e,data:t})}},onExecuteButtonClick:function(){this.verifyPermission()&&this.execute()},onInputMaxRowsChange:function(){this.model.set(this.MAXROWS_PROP,this.$maxRowsInput.val())},onInputPageSizeChange:function(){this.model.set(this.PAGESIZE_PROP,this.$pageSizeInput.val())},onInputServerPagingChange:function(){this.model.set(this.SERVER_PAGING_PROP,this.$serverPagingCheck.prop("checked"))},onModelConnectionChanged:function(){this.$connectionSelect.isLoaded&&this.$connectionSelect.val(this.model.get(this.CONNECTION_PROP)).trigger("change")},onModelLayoutChange:function(){var i=this,e=i.model.get(i.LAYOUT_PROP);_.each(e,function(e,t){_.extend(i.sections[t],e)}),i.sections[3].isExpanded=!0,this.accordion.updateLayout(!1)},onModelDataSourceChange:function(){"deltaclient"===this.model.get("_dataSource")&&this.model.set({_dataSource:"kdb"},{silent:!0}),this.sections[4].hidden=!0,this.$connectionTypeSelect.val(this.model.get("_dataSource")).trigger("change"),"sql"===this.model.get("_dataSource")?(this.$el.find(".configFieldsetLabels").hide(),this.$el.find(".configFieldsetLabels .query").click()):this.$el.find(".configFieldsetLabels").show(),this.dataConfigQuery,this.updateParameterButton(),this.populateConnectionsGroupList()},updateQueryRadio:function(e){this.$queryRadio.show(),e&&(this.originalDataType=this.model.get(this.DATA_TYPE_PROP)),this.appModel.get("CanExecuteQueries")||"query"===this.model.get(this.DATA_TYPE_PROP)||"query"===this.originalDataType||this.$queryRadio.hide()},onModelDataTypeChange:function(){var e={};if("pivot"===this.model.get(this.DATA_TYPE_PROP))return e[this.DATA_TYPE_PROP]="query",e[this.PIVOT_TYPE_PROP]="server",void this.model.set(e);"server"===this.model.get(this.PIVOT_TYPE_PROP)&&"query"!==this.model.get(this.DATA_TYPE_PROP)&&"builder"!==this.model.get(this.DATA_TYPE_PROP)&&this.model.set(this.PIVOT_TYPE_PROP,"client"),_.includes(["analytic","streaming","virtual","builder"],this.model.get(this.DATA_TYPE_PROP))?this.$el.find(".query-form").hide():this.$el.find(".query-form").show(),this.updateParameterButton(),this.updateQueryButtons(),this.updatePivotButton(),this.updateResultsButtons(),this.debounceUpdateForm()},onModelHasUpdateChange:function(){this.debounceUpdateForm()},onModelPivotTypeChange:function(){"server"===this.model.get(this.PIVOT_TYPE_PROP)&&"query"!==this.model.get(this.DATA_TYPE_PROP)&&"builder"!==this.model.get(this.DATA_TYPE_PROP)&&this.model.set(this.PIVOT_TYPE_PROP,"client"),this.debounceUpdateForm()},onModelSubscriptionTypeChange:function(){this.validateUI()&&this.model.stop&&this.model.stop(),this.debounceUpdateForm()},onModelMaxRowsChange:function(){this.$maxRowsInput.val(this.model.get(this.MAXROWS_PROP))},onModelPageSizeChange:function(){this.$pageSizeInput.val(this.model.get(this.PAGESIZE_PROP))},onModelServerPagingChange:function(){var e=this.model.get(this.SERVER_PAGING_PROP),e=void 0===e||(e||!1);"virtual"!==this.model.get(this.DATA_TYPE_PROP)&&(this.$serverPagingCheck.prop("checked",e),this.$maxRowsInput.parent().toggle(!e),this.$pageSizeInput.parent().toggle(e))},onResize:function(e,t){this.accordion.resize(),this.resizeDatatable()},onDataGridPage:function(e,t){if(!e||!e.subscribe||!e.unsubscribe)return!1;t=_.pick(t,"_pagingType","_pagingNum","_pageSize","_pageSort"),e.set(t)},onDataGridSubscribe:function(e,t){return!!(e&&e.subscribe&&e.unsubscribe)&&(this.dataGridSubscription?(this.dataGridSubscription.callback=t,!1):(this.dataGridSubscription={source:e,onData:t},this.dataGridSubscription.key="queryEditor_DataGrid",void e.subscribe(this.dataGridSubscription.key,this.dataGridSubscription)))},onDataGridUnsubscribe:function(e){if(!(e instanceof QuickBase.DocumentDataModel))return!1;this.dataGridSubscription&&(e.unsubscribe(this.dataGridSubscription.key),delete this.dataGridSubscription)},onTabActivate:function(){switch(this.$tabs.tabs("option","active")){case 0:this.resizeDatatable();break;case 1:this.updateMappingView();break;case 2:this.updateRawView(this.data)}},openConnectionManagement:function(){this.connectionManagementPanel=new ConnectionManagement({container:this.dialogContainer,launchObject:this.$connectionSelect.val(),docViewModel:this.docViewModel,appModel:this.appModel}),this.listenTo(this.connectionManagementPanel,"RefreshConnectionList",$.proxy(this.refreshConnectionsSelect,this)),this.listenToOnce(this.connectionManagementPanel,"onRemove",$.proxy(function(){this.stopListening(this.connectionManagementPanel),this.connectionManagementPanel=null},this))},openParameterDialog:function(){var t=this;t.parameterDialog?t.parameterDialog.dialog("open"):(t.parameterDialog=this.$el.find(".addParameterDialog").dialog({appendTo:t.dialogContainer,dialogClass:"quick-dash",modal:!0,width:300,title:"Add parameter to SQL query",buttons:{Add:function(){t.addParameterFromDialog($(this).find("input").val()),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),t.parameterDialog.find("input").on("keydown",function(e){13===e.which&&(t.addParameterFromDialog(t.parameterDialog.find("input").val()),t.parameterDialog.dialog("close"))}))},populateConnectionsList:function(t){var i,n,a,o=this,s="q",r=null,l=null;"kdb"===o.model.get("_dataSource")?s="q":"sql"===o.model.get("_dataSource")&&(s="jdbc:com.mysql.jdbc.Driver",r="jdbc:oracle.jdbc.OracleDriver",l="jdbc:com.microsoft.sqlserver.jdbc.SQLServerDriver"),o.appModel.get("connections").fetch({success:function(e){e=e.map(function(e){return e.attributes}),_.isUndefined(o.model.get(o.CONNECTION_PROP))&&e[0]&&o.model.set(o.CONNECTION_PROP,e[0].name,{silent:!0}),a=_.filter(e,function(e){return"DC"!==e.name&&e.type===s}),r&&(a=$.merge(a,_.filter(e,{type:r}))),l&&(a=$.merge(a,_.filter(e,{type:l}))),n=_.reduce(a,function(e,t){return e+'<option value="'+_.escape(t.name)+'"'+(t.name===o.model.get(o.CONNECTION_PROP)?" selected>":">")+t.name+"</option>"},""),o.$connectionSelect.append('<optgroup label="-Single Connections-">'),o.$connectionSelect.append(n),o.$connectionSelect.append("</optgroup>"),i=o.model.get(o.CONNECTION_PROP);e=_.find(e.concat(t||[]),{name:i});o.dataConnectionMiniMode?o.$connectionSelect.val(i).trigger("change"):e?o.$connectionSelect.val(e.name).trigger("change"):0<a.length?o.$connectionSelect.val(a[0].name).trigger("change"):o.$executeButton.button("option","disabled",!0),o.$connectionSelect.isLoaded=!0,o.populateServicesList()}})},populateConnectionsGroupList:function(){var i=this,e=0;this.connectionGroups?(i.$connectionSelect.empty(),"kdb"===i.model.get("_dataSource")?i.connectionGroups.fetch({success:function(e){var t;e=e.map(function(e){return e.attributes}),_.isUndefined(i.model.get(i.CONNECTION_PROP))&&e[0]&&i.model.set(i.CONNECTION_PROP,e[0].name,{silent:!0}),t=_.reduce(e,function(e,t){return e+'<option value="'+_.escape(t.name)+'"'+(t.name===i.model.get(i.CONNECTION_PROP)?" selected>":">")+t.name+"</option>"},""),i.$connectionSelect.html('<optgroup label="-Connection Groups-">'+t+"</optgroup>"),i.populateConnectionsList(e)},error:function(){_.delay(function(){e<3&&(e+=1,i.populateConnectionsGroupList())},1e3)}}):i.populateConnectionsList()):this.populateConnectionsList([])},populateServicesList:function(){var i=this;this.appModel.get("isLite")?i.setSelectedConnection():i.appModel.get("services").fetch({success:function(e){optionsHeader='<optgroup label="-Services-">',optionsfooter="</optgroup>",optionsHtml=e.reduce(function(e,t){return e+'<option value="'+_.escape(t.get("name"))+'"'+(t.get("name")===i.model.get(i.CONNECTION_PROP)?" selected>":">")+t.get("name")+"</option>"},""),i.$connectionSelect.append(optionsHeader),i.$connectionSelect.append(optionsHtml),i.$connectionSelect.append(optionsfooter),i.$executeButton.button("option","disabled")&&0<e.length&&(i.$executeButton.button("option","disabled",!1),i.$connectionSelect.val(e.models[0].get("name")).trigger("change")),i.setSelectedConnection()},error:function(e,t){QuickBase.Log.Error("Failed to fetch Services",t[0]),i.setSelectedConnection()}})},refreshConnectionsSelect:function(){this.$connectionSelect.html(""),this.$connectionSelect.empty(),this.populateConnectionsGroupList()},remove:function(){this.removeDataTable(),this.model.unsubscribe(this.subscriptionKey),this.hasSubscribed=!1,this.stopListening(this.model),this.model.destroy(),this.dataConfigQuery&&(this.dataConfigQuery.remove(),delete this.dataConfigQuery),this.dataConfigAnalytic&&(this.dataConfigAnalytic.remove(),delete this.dataConfigAnalytic),this.dataConfigStreaming&&(this.dataConfigStreaming.remove(),delete this.dataConfigStreaming),this.dataConfigPivot&&(this.dataConfigPivot.remove(),delete this.dataConfigPivot),this.dataConfigUpdate&&(this.dataConfigUpdate.remove(),delete this.dataConfigUpdate),this.dataConfigBuilder&&(this.dataConfigBuilder.remove(),delete this.dataConfigBuilder),Backbone.View.prototype.remove.call(this)},removeDataTable:function(){this.dataTableDisplay&&(this.dataTableDisplay.remove(),this.dataTableDisplay=null)},renderPerformanceGrid:function(e){var t=e.performance,i=t.onAgentNotify-t.apply,n=t.serverStart?t.serverStart-t.apply:0,a=t.serverStart&&t.serverEnd?t.serverEnd-t.serverStart:i,o=t.serverEnd?t.onAgentNotify-t.serverEnd:0,s=n/i,e=a/i,t=o/i;this.$el.find(".stacked-bar-graph").html(T.DataConfigForm_Perf({totalTime:i.toFixed(0),subscriptionPercent:100*s,executionPercent:100*e,dataModelPercent:100*t,subscriptionTime:n.toFixed(0),executionTime:a.toFixed(0),dataModelTime:o.toFixed(0)}))},resizeDatatable:function(){this.dataTableDisplay&&this.dataTableDisplay.onResize(),this.dataConfigBuilder&&this.dataConfigBuilder.onResize()},setSelectedConnection:function(){var e=this;e.$connectionSelect.select2({theme:"dashboards"}),e.$connectionSelect.on("select2:select",function(){e.model.set(e.CONNECTION_PROP,e.$connectionSelect.val())}),e.$connectionSelect.on("select2:open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")}),e.onModelConnectionChanged()},showUIMask:function(){var e=this;e.$uiMask||(e.$uiMask=$('<div class="ui-widget-overlay" style="z-index: 1111; display: none; opacity: 0.7; position: absolute;"></div>').appendTo(".data-dialog"),e.$uiMask.append(new LoadingScreen({loadingText:"Please wait, executing query"}).$el),e.uiMaskCallback=function(){e.$uiMask.stop(!0,!0).fadeOut(200),clearTimeout(e.uiMaskTimeout)}),e.$uiMask.fadeIn(1e3),clearTimeout(e.uiMaskTimeout),e.uiMaskTimeout=setTimeout(function(){e.showQueryStatus({message:"Request timed out, no response within 10 seconds",type:"Error"}),e.sections[4].isExpanded=!0,e.sections[4].hidden=!1,e.onAccordionUpdate(),e.model.stop&&e.model.stop(),e.uiMaskCallback()},1e4)},showQueryStatus:function(e){var t=this,i=e.message||e.error||"",n=e.type||"Error",e="NoResults"===n?"No Results":n;0===i.indexOf("0.0")&&(i=i.substring(4)),t.$queryStatus.removeClass("Error Warning Info Loading NoResults").addClass(n),t.$queryStatus.find(".statusTitle span").text(e+(i?": ":"")),t.$queryStatus.find(".statusText").html(i),t.$queryStatus.show(),t.fadeTimer&&clearTimeout(t.fadeTimer),"Info"===n&&(t.fadeTimer=_.delay(function(){t.$queryStatus.fadeOut("slow")},3e3))},updateForm:function(){var e,t,i,n=this.model.get(this.DATA_TYPE_PROP),a=this.model.get(this.PIVOT_TYPE_PROP),o=!!a,s="streaming"===this.model.get("_subscriptionType"),r=this.model.get(this.HAS_UPDATE_PROP);this.$dataTypeRadio.val(["analytic"===n&&s?"streaming":n]),this.$pivotTypeRadio.val([a]),o?this.$pivotCheckbox.prop("checked",!0):this.$pivotCheckbox.removeProp("checked"),this.$el.find('input:radio[name="_pivotType"].server').prop("disabled","query"!==this.model.get(this.DATA_TYPE_PROP)&&"builder"!==this.model.get(this.DATA_TYPE_PROP)),this.$pivotCheckbox.prop("disabled",!_.includes(["query","analytic","streaming","virtual","builder"],n)||r),this.sections[1].isExpanded=o,this.sections[1].hidden=!o,r?this.$updateCheckbox.prop("checked",!0):this.$updateCheckbox.removeProp("checked"),this.$updateCheckbox.prop("disabled",!_.includes(["query","analytic","streaming"],n)||o),this.sections[2].isExpanded=r,this.sections[2].hidden=!r,this.sections[3].isExpanded="static"!==this.model.get(this.SUBCRIPTION_PROPERTY)||r||"virtual"===this.model.get(this.DATA_TYPE_PROP),this.sections[3].isExpanded?(this.sections[3].fixed=80,this.sections[3].$el.find("fieldset").toggleClass("hide-border-color",!1)):(this.sections[3].fixed=this.subscriptionSz,this.sections[3].$el.find("fieldset").toggleClass("hide-border-color",!0)),"static"!==this.model.get(this.SUBCRIPTION_PROPERTY)||r||"virtual"===this.model.get(this.DATA_TYPE_PROP)||this.model.set("_subscriptionKey",""),this.onAccordionUpdate(),_.each([this.dataConfigAnalytic,this.dataConfigStreaming,this.dataConfigQuery,this.dataConfigPivot,this.dataConfigUpdate,this.dataConfigVirtual,this.dataConfigBuilder],function(e){e&&e.$el.hide()}),this.dataConnectionMiniMode||("analytic"!==n||s?"analytic"===n&&s?(this.dataConfigStreaming=this.updateFormComponent(this.dataConfigStreaming,DataConfigAnalytic,this.$el.find(".streaming-form").get(0)),(e=this.dataConfigStreaming.$tree.jstree("get_selected"))instanceof Array&&0<e.length&&this.model.set("_selectedAnalytic",e[0]),this.model.set("_analyticParams",this.model.get("_streamingParameters")),t=-1!=["static","polling"].indexOf(this.model.get(this.SUBCRIPTION_PROPERTY))&&!o&&!this.appModel.get("isLite"),i=this.model.get(this.SERVER_PAGING_PROP),this.$maxRowsInput.parent().toggle(!t||!i),this.$pageSizeInput.parent().toggle(t&&i),this.$serverPagingCheck.parent().toggle(t),this.dataConfigStreaming.onResize()):"query"===n?(this.dataConfigQuery=this.updateFormComponent(this.dataConfigQuery,DataConfigQuery_Query,this.$el.find(".query-form").get(0)),t=-1!=["static","polling"].indexOf(this.model.get(this.SUBCRIPTION_PROPERTY))&&!o&&!this.appModel.get("isLite"),i=this.model.get(this.SERVER_PAGING_PROP),this.$maxRowsInput.parent().toggle(!t||!i),this.$pageSizeInput.parent().toggle(t&&i),this.$serverPagingCheck.parent().toggle(t),this.stopListening(this.dataConfigQuery,"execute",this.execute),this.listenTo(this.dataConfigQuery,"execute",this.execute),this.dataConfigQuery.onResize()):"virtual"===n?(""===this.model.get("_virtualQueryString")&&this.model.set("_virtualQueryString",this.dataDialogView.generateSampleVirtualQuery(this.model.path)),this.dataConfigVirtual=this.updateFormComponent(this.dataConfigVirtual,DataConfigQuery_Virtual,this.$el.find(".virtual-query-form").get(0)),this.stopListening(this.dataConfigVirtual,"execute",this.execute),this.listenTo(this.dataConfigVirtual,"execute",this.execute),this.dataConfigVirtual.onResize()):"builder"===n&&(this.dataConfigBuilder=this.updateFormComponent(this.dataConfigBuilder,DataConfigQuery_Builder,this.$el.find(".builder-query-form").get(0)),t=-1!=["static","polling"].indexOf(this.model.get(this.SUBCRIPTION_PROPERTY))&&!o&&!this.appModel.get("isLite"),i=this.model.get(this.SERVER_PAGING_PROP),this.$maxRowsInput.parent().toggle(!t||!i),this.$pageSizeInput.parent().toggle(t&&i),this.$serverPagingCheck.parent().toggle(t),this.stopListening(this.dataConfigVirtual,"execute",this.execute),this.listenTo(this.dataConfigVirtual,"execute",this.execute),this.dataConfigBuilder.onResize()):(this.dataConfigAnalytic=this.updateFormComponent(this.dataConfigAnalytic,DataConfigAnalytic,this.$el.find(".analytic-form").get(0)),(e=this.dataConfigAnalytic.$tree.jstree("get_selected"))instanceof Array&&0<e.length&&this.model.set("_selectedAnalytic",e[0]),this.model.set("_analyticParams",this.model.get("_analyticParameters")),t=-1!=["static","polling"].indexOf(this.model.get(this.SUBCRIPTION_PROPERTY))&&!o&&!this.appModel.get("isLite"),i=this.model.get(this.SERVER_PAGING_PROP),this.$maxRowsInput.parent().toggle(!t||!i),this.$pageSizeInput.parent().toggle(t&&i),this.$serverPagingCheck.parent().toggle(t),this.dataConfigAnalytic.onResize()),o?this.dataConfigPivot=this.updateFormComponent(this.dataConfigPivot,DataConfigQuery_Pivot,this.$el.find(".pivot-form").get(0)):r&&(this.dataConfigUpdate=this.updateFormComponent(this.dataConfigUpdate,DataConfigQuery_Update,this.$el.find(".update-form").get(0)))),this.updateQueryRadio()},updateFormComponent:function(e,t,i){return e?("builder"===this.model.get("_dataType")&&e.render(),e.$el.show()):(["builder","analytic"].includes(this.model.get("_dataType"))?this.$el.find(".query-form").toggle(!1):this.$el.find(".query-form").toggle($(i).hasClass("query-form")||$(i).hasClass("update-form")||$(i).hasClass("pivot-form")),(e=new t({model:this.model,docDataModel:this.docDataModel,docViewModel:this.docViewModel,el:i,dialogContainer:this.dialogContainer,appModel:this.appModel,execute:this.execute.bind(this),subscriptionSelect:this.subscriptionSelect})).$el.show()),e},updateQueryStatus:function(e,t){t?(this.showQueryStatus(t),"Error"===t.type&&(this.hideUIMask(),this.model.stop(),this.$rawDataOutput.text(""))):this.hideQueryStatus()},updateColumnsProperty:function(t){t.reset?this.columnInfo.reset(t.reset):(this.columnInfo.remove(_.map(t.remove,function(e){return e.id})),this.columnInfo.add(t.add),this.columnInfo.add(t.change,{merge:!0})),_.some(["add","remove","reset","change"],function(e){return void 0!==t[e]})&&(this.model.set("_columns",this.columnInfo.map(function(e){return e.id}),{silent:!0}),this.subscriptionSelect.onModelColumnsChange(),"builder"===this.model.get("_dataType")&&this.dataConfigBuilder.onModelColumnsChange())},updateResultsButtons:function(){var e=this.model.get(this.SERVER_PAGING_PROP),t="virtual"===this.model.get(this.DATA_TYPE_PROP);this.$maxRowsInput.parent().toggle(!t&&!e),this.$pageSizeInput.parent().toggle(!t&&e),this.$serverPagingCheck.parent().toggle(!t)},reduceData:function(){var i,n=this.data.rows?this.data.rows.length:0;return 20<n?(i={},_.each(this.data,function(e,t){i[t]=e}),i.rows=[],_.each(this.data.rows,function(e,t){t<10||n-10<t?i.rows.push(e):10===i.rows.length&&i.rows.push(".. .. .. ..")}),i):this.data},updateMappingView:function(){var e,t;this.mappingView&&(e=this.$mappingDiv.parent(),t=this.$mappingDiv.prop("class"),this.mappingView.remove(),this.$mappingDiv=$("<div />"),this.$mappingDiv.prop("id",this.domIds.mappingId),this.$mappingDiv.prop("class",t),e.append(this.$mappingDiv)),this.model.dataMapper||this.model.apply(),this.mappingView=new DataConfigMapping({el:this.$mappingDiv,dataMapper:this.model.dataMapper,dialogContainer:this.dialogContainer,docDataModel:this.docDataModel,docViewModel:this.docViewModel})},updateParameterButton:function(){"deltaclient"===this.model.get(this.DATA_SOURCE_PROP)&&this.model.set({_dataSource:"kdb"},{silent:!0}),"sql"===this.model.get(this.DATA_SOURCE_PROP)&&"query"===this.model.get(this.DATA_SOURCE_PROP)?this.$addParameterButton.show():this.$addParameterButton.hide()},updatePivotButton:function(){_.includes(["streaming"],this.model.get(this.DATA_TYPE_PROP))?(this.$pivotLabel.hide(),this.model.set(this.PIVOT_TYPE_PROP,"")):this.$pivotLabel.show()},updateRawView:function(){var e=_.isString(this.data)?this.data:JSON.stringify(this.meta)+JSON.stringify(this.reduceData());this.$rawDataOutput.text(e)},updateQueryButtons:function(){_.includes(["virtual","streaming"],this.model.get(this.DATA_TYPE_PROP))?this.$updateLabel.hide():this.$updateLabel.show()},validateUI:function(){var e=!0,t="";return"pivot"===this.model.get("_dataType")&&(this.model.get("_breakdownCols").length<1||0===this.model.get("_aggregateCols").length)&&(e=!1,t="Please ensure breakdown columns and aggregate columns are populated."),e?this.hideQueryStatus():this.showQueryStatus({type:"Error",message:t}),this.model.trigger("isValid",e),e}},{filterAttributes:function(e){var t={query:["_queryString","_queryParams","_subscriptionKey","_hasUpdateQuery","_updateQueryParams","_updateQueryString","_updateType","_updateAnalytic"],analytic:["_selectedAnalytic","_analyticParams","_analyticParameters","_streamingParameters","_subscriptionKey","_isStreamingSubscription","_hasUpdateQuery","_updateQueryString","_updateType","_updateAnalytic"],pivot:["_aggregateCols","_aggregateFns","_aggregateLabels","_breakdownCols","_columnLabel","_pivotSource","_pivotType","_table","_queryString","_queryParams","_aggFn","_topX","_ordering","_from","_to"],virtual:["_subscriptionKey","_virtualParams","_virtualQueryString"],builder:["_selectedAnalytic","_analyticParams","_builderParams","_subscriptionKey","_isStreamingSubscription","_graphJSON","_subscriptionKey","_selectedNode"]},i=["_autoExec","_columns","_dataType","_dataSource","_connection","_mappings","_maxRows","_forceReset","_subscriptionType","_subscriptionInterval","_layout"],i=_.union(i,t[e._dataType]);return"query"!=e._dataType&&"analytic"!=e._dataType&&"builder"!=e._dataType||-1==["static","polling"].indexOf(e._subscriptionType)||e._pivotType||(i=i.concat(["_pageSize","_serverPaging"])),e._pivotType&&(i=_.union(i,t.pivot)),_.pick(e,i)}}),DataConnectionDialog=Backbone.View.extend({className:"dataConnection-dialog",isModelChanged:!1,initialize:function(e){var i=this;i.options=e,i.appModel=i.options.appModel,i.path=i.options.path,this.$dialog=i.$el.dialog(_.extend({appendTo:e.container,title:t("Data Connection "),dialogClass:"quick-dash dlgDataConnection",resizable:!0,height:125,width:250,modal:!0,autoOpen:!0,buttons:[{text:t("Apply"),disabled:!0,click:$.proxy(i.onSelectButtonClick,i),icons:{primary:"fa fa-check"}},{text:t("Close"),click:$.proxy(i.onCancelButtonClick,i),icons:{primary:"fa fa-times"}}],open:function(){i.changeApplyButtonStatus(),$('<i class="fa fa-server" />').insertBefore(i.$el.parent().find(".ui-dialog-title")),i.model=new(Backbone.Model.extend({apply:$.noop,getChildren:$.noop,subscribe:$.noop}))({_connection:i.path,_dataType:"query"}),i.model.on("change:_connection",function(){var e=i.model.get("_connection");e&&(0<=e.indexOf("--Connection Groups--")||0<=e.indexOf("--Single Connections--"))&&(e=""),i.path=e,i.changeApplyButtonStatus()}),i.configDialog=new DataConfigForm({dataConnectionMiniMode:!0,docViewModel:i.options.docViewModel,dialogContainer:i.options.dialogContainer,model:i.model,appModel:i.appModel}),i.$el.append(i.configDialog.$el),_.delay(function(){i.configDialog.$el.find(".toolbar").css("position","relative"),_.delay(function(){i.configDialog.$el.find(".toolbar").css("position","absolute"),_.delay(function(){i.configDialog.$el.find(".toolbar").css("position","relative")},10)},500)},200)},close:function(){i.remove()}},e))},changeApplyButtonStatus:function(){this.$el.next().find("button:nth-of-type(1)").button({disabled:!this.path})},onCancelButtonClick:function(){this.$el.dialog("close")},onSelectButtonClick:function(){var e=this.options.selectCallback;e&&e(this.path),this.onCancelButtonClick()},remove:function(){this.model&&this.model.off(),this.$dialog.dialog("destroy"),Backbone.View.prototype.remove.apply(this,arguments)}},{singleton:null}),MenuLayoutCheckbox=Backbone.View.extend({className:"menuLayoutCheckbox",initialize:function(e){this.add_keyword="ADD",this.delimiter_keyword="->",this.remove_keyword="REMOVE",this.codeEditor=e.codeEditor,this.componentModel=e.componentModel,this.id=e.id,this.menuLayout=this.setLayout(e.menuLayout),this.parseHTML=e.parseHTML,this.setDefaults=e.setDefaults,this.widgetId=e.widgetId,this.setDefaultsOptions(),this.render()},applyLayout:function(){var t=this,i=this,e=this.menuLayout.classes.filter(function(e){return"checked"===e.checked});0<e.length&&_.each(e,function(e){i.applyOption(t.add_keyword+t.delimiter_keyword+e.class)})},applyOption:function(e){var t,i=e.split(this.delimiter_keyword),n="",a=this.menuLayout.classes.filter(function(e){return e.class===i[1]}),o=this.parseExtractCSS(),s=this.parseHTML();i[0]===this.add_keyword?$(s[1]).addClass(i[1]):i[0]===this.remove_keyword&&$(s[1]).removeClass(i[1]),e=(e=(e="\x3c!--".concat($(s[0])[0].data).concat("--\x3e")).concat($(s[1])[0].outerHTML)).concat("\x3c!--").concat($(s[2])[0].data).concat("--\x3e"),this.processHTML(e),t=i[0]===this.add_keyword?(n=decodeURI(a[0].css),(t=(t=(t=o[1].concat("\n")).concat(o[2])).concat(n)).concat(o[3])):(n=decodeURI(a[0].css),a=this.componentModel.get("Style.advanced"),(t=this.replaceDataWidgetId(a,'data-widgetid=""')).replace(n,"")),this.processCSS(t)},initialiseCheckboxEvents:function(){var t=this,e=this.$el.find('input[type="checkbox"]');_.each(e,function(e){$(e).off("change"),$(e).on("change",function(){var e=(e=$(this).attr("class")).replace("GENERATED->","");this.checked?t.applyOption(t.add_keyword+t.delimiter_keyword+e):t.applyOption(t.remove_keyword+t.delimiter_keyword+e)})})},inspectHTML:function(){var t,e=this.parseHTML();!e||(e=$(e[1]).attr("class"))&&(t=e.split(" "),this.menuLayout.classes.map(function(e){t.includes(e.class)?e.checked="checked":e.checked=""}),this.applyLayout())},parseExtractCSS:function(){return/(.*\[START\].*)[\s\S](.*[\s\S]*\})(.*[\s\S]\/\*.*\*\/)/.exec(this.componentModel.get("Style.advanced"))},processCSS:function(e){var t=this.replaceDataWidgetId(e,'data-widgetid="'+this.widgetId+'"'),e=this.componentModel.get("Style.advanced"),e=/(.*[\s\S]*(\/\*.*START\])).*[\s\S]*(\/\*.*END\] \*\/)(.*[\s\S]*)/.exec(e);e&&(t=e[1].replace(e[2],"")+t,t+=e[4]),this.componentModel.set("Style.advanced",t)},processHTML:function(e){var t=this.codeEditor.getValue(),t=/(.*[\s\S]*(\<\!.*START\])).*[\s\S]*(\<\!.*END\]--\>)(.*[\s\S]*)/.exec(t),e=t?(t[1]=t[1].replace(t[2],""),t[1]+e+t[4]):e;this.codeEditor.setValue(e)},replaceDataWidgetId:function(e,t){return e.replace(/data-widgetid=".*"/g,t)},render:function(){this.inspectHTML(),this.$el.html(T.MenuLayoutCheckbox({checkboxes:this.menuLayout.classes})),this.initialiseCheckboxEvents()},setDefaultsOptions:function(){var t=this;this.menuLayout.classes.map(function(e){!0===e.default&&t.setDefaults?e.checked="checked":e.checked=""}),this.applyLayout()},setLayout:function(e){var t=this;return e.filter(function(e){return e.id===t.id})[0]}}),MenuLayoutItem=Backbone.View.extend({className:"menuLayoutItem ui-widget-content",initialize:function(e){this.codeEditor=e.codeEditor,this.componentModel=e.componentModel,this.menuLayout=e.menuLayout,this.onPresetSelected=e.onPresetSelected,this.parseHTML=e.parseHTML,this.widgetId=e.widgetId,this.render()},applyId:function(e,t){return $(t[1]).attr("id",e),result="\x3c!--".concat($(t[0])[0].data).concat("--\x3e"),result=result.concat($(t[1])[0].outerHTML),result=result.concat("\x3c!--").concat($(t[2])[0].data).concat("--\x3e"),result},applyLayout:function(e){this.previouslySelected(e)||(this.processCSS(),this.processHTML(e))},encodeId:function(e){return btoa(e)},previouslySelected:function(e){var t=this.codeEditor.getValue(),t=this.parseHTML(t);return t?$(t[1]).attr("id")===e:null},processCSS:function(){var e=decodeURI(this.menuLayout.css),t=this.componentModel.get("Style.advanced"),t=/(.*[\s\S]*(\/\*.*START\])).*[\s\S]*(\/\*.*END\] \*\/)(.*[\s\S]*)/.exec(t),e=e.replace(/data-widgetid=""/g,'data-widgetid="'+this.widgetId+'"');t&&(e=t[1].replace(t[2],"")+e,e+=t[4]),this.componentModel.set("Style.advanced",e)},processHTML:function(e){var t=this.codeEditor.getValue(),i=decodeURI(this.menuLayout.html),t=/(.*[\s\S]*(\<\!.*START\])).*[\s\S]*(\<\!.*END\]--\>)(.*[\s\S]*)/.exec(t),i=this.parseHTML(i);i=this.applyId(e,i),i=t?(t[1]=t[1].replace(t[2],""),t[1]+i+t[4]):i,this.codeEditor.setValue(i)},render:function(){var t=this;this.$el.html(T.MenuLayoutItem({description:this.menuLayout.description,id:this.menuLayout.id,image:this.menuLayout.image,label:this.menuLayout.label})),this.$el.on("click",function(){var e=t.encodeId(t.menuLayout.id);t.applyLayout(e),t.onPresetSelected(e)}),this.$el.on({mouseenter:function(){t.$el.addClass("ui-state-hover")},mouseleave:function(){t.$el.removeClass("ui-state-hover")}})}}),MenuLayoutList=Backbone.View.extend({className:"menuLayoutList ui-widget-content",initialize:function(e){this.codeEditor=e.codeEditor,this.menuCheckbox,this.options=e,this.render()},addMenuLayoutCheckbox:function(e,t){e=this.decodeId(e);this.menuCheckbox&&this.menuCheckbox.remove(),this.menuCheckbox=new MenuLayoutCheckbox({codeEditor:this.options.codeEditor,componentModel:this.options.componentModel,id:e,menuLayout:this.options.menuLayout,parseHTML:this.parseHTML.bind(this),setDefaults:t,widgetId:this.options.widgetId}),this.menuCheckbox.$el.appendTo(this.$el.find(".checkboxes"))},addMenuLayoutItem:function(){var t=this;_.each(this.options.menuLayout,function(e){new MenuLayoutItem({codeEditor:t.options.codeEditor,componentModel:t.options.componentModel,menuLayout:e,onPresetSelected:t.onPresetSelected.bind(t),parseHTML:t.parseHTML.bind(t),widgetId:t.options.widgetId}).$el.appendTo(t.$el.find(".presets"))})},decodeId:function(e){return atob(e)},findId:function(){var e=this.parseHTML();return!!e&&$(e[1]).attr("id")},onPresetSelected:function(e){this.addMenuLayoutCheckbox(e,!0)},parseHTML:function(e){e=e||this.codeEditor.getValue(),e=/.*[\s\S]*(\<\!.*START\].*-->.*[\s\S]*)/.exec(e);return e?this.stripHTML($.parseHTML(e[1])):null},render:function(){this.$el.html(T.MenuLayoutList({text:"Sample Layout Presets"})),this.addMenuLayoutItem();var e=this.findId();e&&this.addMenuLayoutCheckbox(e,!1)},stripHTML:function(e){for(var t=[],i=0;i<e.length;i++)"\n"!=e[i].data&&"\r\n"!=e[i].data&&t.push(e[i]);return t}}),bkExtend=function(){var e,t=arguments;for(e in(t=1==t.length?[this,t[0]]:t)[1])t[0][e]=t[1][e];return t[0]};function bkClass(){}bkClass.prototype.construct=function(){},bkClass.extend=function(e){function t(){if(arguments[0]!==bkClass)return this.construct.apply(this,arguments)}var i=new this(bkClass);return bkExtend(i,e),t.prototype=i,t.extend=this.extend,t};var bkElement=bkClass.extend({construct:function(e,t){return e=$BK(e="string"==typeof e?(t||document).createElement(e):e)},appendTo:function(e){return e.appendChild(this),this},appendBefore:function(e){return e.parentNode.insertBefore(this,e),this},addEvent:function(e,t){return bkLib.addEvent(this,e,t),this},setContent:function(e){return this.innerHTML=e,this},pos:function(){var e=curtop=0;obj=this;if(obj.offsetParent)for(;e+=obj.offsetLeft,curtop+=obj.offsetTop,obj=obj.offsetParent;);var t=!window.opera&&parseInt(this.getStyle("border-width")||this.style.border)||0;return[e+t,curtop+t+this.offsetHeight]},noSelect:function(){return bkLib.noSelect(this),this},parentTag:function(e){var t=this;do{if(t&&t.nodeName&&t.nodeName.toUpperCase()==e)return t}while(t=t.parentNode);return!1},hasClass:function(e){return this.className.match(new RegExp("(\\s|^)nicEdit-"+e+"(\\s|$)"))},addClass:function(e){return this.hasClass(e)||(this.className+=" nicEdit-"+e),this},removeClass:function(e){return this.hasClass(e)&&(this.className=this.className.replace(new RegExp("(\\s|^)nicEdit-"+e+"(\\s|$)")," ")),this},setStyle:function(e){var t,i=this.style;for(t in e)switch(t){case"float":i.cssFloat=i.styleFloat=e[t];break;case"opacity":i.opacity=e[t],i.filter="alpha(opacity="+Math.round(100*e[t])+")";break;case"className":this.className=e[t];break;default:i[t]=e[t]}return this},getStyle:function(e,t){t=t||document.defaultView;if(1==this.nodeType)return t&&t.getComputedStyle?t.getComputedStyle(this,null).getPropertyValue(e):this.currentStyle[bkLib.camelize(e)]},remove:function(){return this.parentNode.removeChild(this),this},setAttributes:function(e){for(var t in e)this[t]=e[t];return this}}),bkLib={isMSIE:-1!=navigator.appVersion.indexOf("MSIE"),addEvent:function(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)},toArray:function(e){for(var t=e.length,i=new Array(t);t--;)i[t]=e[t];return i},noSelect:function(e){e.setAttribute&&"input"!=e.nodeName.toLowerCase()&&"textarea"!=e.nodeName.toLowerCase()&&e.setAttribute("unselectable","on");for(var t=0;t<e.childNodes.length;t++)bkLib.noSelect(e.childNodes[t])},camelize:function(e){return e.replace(/\-(.)/g,function(e,t){return t.toUpperCase()})},inArray:function(e,t){return null!=bkLib.search(e,t)},search:function(e,t){for(var i=0;i<e.length;i++)if(e[i]==t)return i;return null},cancelEvent:function(e){return(e=e||window.event).preventDefault&&e.stopPropagation&&(e.preventDefault(),e.stopPropagation()),!1},domLoad:[],domLoaded:function(){if(!arguments.callee.done)for(arguments.callee.done=!0,i=0;i<bkLib.domLoad.length;i++)bkLib.domLoad[i]()},onDomLoaded:function(e){this.domLoad.push(e),document.addEventListener?document.addEventListener("DOMContentLoaded",bkLib.domLoaded,null):bkLib.isMSIE&&(document.write("<style>.nicEdit-main p { margin: 0; }</style><script id=__ie_onload defer "+("https:"==location.protocol?"src='javascript:void(0)'":"src=//0")+"><\/script>"),$BK("__ie_onload").onreadystatechange=function(){"complete"==this.readyState&&bkLib.domLoaded()}),window.onload=bkLib.domLoaded}};function $BK(e){return(e="string"==typeof e?document.getElementById(e):e)&&!e.appendTo?bkExtend(e,bkElement.prototype):e}var bkEvent={addEvent:function(e,t){return t&&(this.eventList=this.eventList||{},this.eventList[e]=this.eventList[e]||[],this.eventList[e].push(t)),this},fireEvent:function(){var e=bkLib.toArray(arguments),t=e.shift();if(this.eventList&&this.eventList[t])for(var i=0;i<this.eventList[t].length;i++)this.eventList[t][i].apply(this,e)}};function __(e){return e}Function.prototype.closure=function(){var e=this,t=bkLib.toArray(arguments),i=t.shift();return function(){if(void 0!==bkLib)return e.apply(i,t.concat(bkLib.toArray(arguments)))}},Function.prototype.closureListener=function(){var i=this,n=bkLib.toArray(arguments),a=n.shift();return function(e){var t;return t=(e=e||window.event).target||e.srcElement,i.apply(a,[e,t].concat(n))}};var nicEditorConfig=bkClass.extend({buttons:{bold:{name:__("Click to Bold"),command:"Bold",tags:["B","STRONG"],css:{"font-weight":"bold"},key:"b",content:'<i class="fa fa-fw fa-bold" />'},italic:{name:__("Click to Italic"),command:"Italic",tags:["EM","I"],css:{"font-style":"italic"},key:"i",content:'<i class="fa fa-fw fa-italic" />'},underline:{name:__("Click to Underline"),command:"Underline",tags:["U"],css:{"text-decoration":"underline"},key:"u",content:'<i class="fa fa-fw fa-underline" />'},left:{name:__("Left Align"),command:"justifyleft",noActive:!0,content:'<i class="fa fa-fw fa-align-left" />'},center:{name:__("Center Align"),command:"justifycenter",noActive:!0,content:'<i class="fa fa-fw fa-align-center" />'},right:{name:__("Right Align"),command:"justifyright",noActive:!0,content:'<i class="fa fa-fw fa-align-right" />'},justify:{name:__("Justify Align"),command:"justifyfull",noActive:!0,content:'<i class="fa fa-fw fa-align-justify" />'},ol:{name:__("Insert Ordered List"),command:"insertorderedlist",tags:["OL"],content:'<i class="fa fa-fw fa-list-ol" />'},ul:{name:__("Insert Unordered List"),command:"insertunorderedlist",tags:["UL"],content:'<i class="fa fa-fw fa-list-ul" />'},subscript:{name:__("Click to Subscript"),command:"subscript",tags:["SUB"],content:'<i class="fa fa-fw fa-subscript" />'},superscript:{name:__("Click to Superscript"),command:"superscript",tags:["SUP"],content:'<i class="fa fa-fw fa-superscript" />'},strikethrough:{name:__("Click to Strike Through"),command:"strikeThrough",css:{"text-decoration":"line-through"},content:'<i class="fa fa-fw fa-align-justify" />'},removeformat:{name:__("Remove Formatting"),command:"removeformat",noActive:!0},indent:{name:__("Indent Text"),command:"indent",noActive:!0,content:'<i class="fa fa-fw fa-indent" />'},outdent:{name:__("Remove Indent"),command:"outdent",noActive:!0,content:'<i class="fa fa-fw fa-flip-horizontal fa-indent" />'},hr:{name:__("Horizontal Rule"),command:"insertHorizontalRule",noActive:!0}},buttonList:["save","bold","italic","underline","left","center","right","justify","ol","ul","fontSize","fontFamily","fontFormat","indent","outdent","image","upload","link","unlink","forecolor","html","beautify"],iconList:{bgcolor:1,forecolor:2,bold:3,center:4,hr:5,indent:6,italic:7,justify:8,left:9,ol:10,outdent:11,removeformat:12,right:13,save:24,strikethrough:15,subscript:16,superscript:17,ul:18,underline:19,image:20,link:21,unlink:22,close:23,arrow:25,html:26,beautify:27}}),nicEditors={nicPlugins:[],editors:[],registerPlugin:function(e,t){this.nicPlugins.push({p:e,o:t})},allTextAreas:function(e){for(var t=document.getElementsByTagName("textarea"),i=0;i<t.length;i++)nicEditors.editors.push(new nicEditor(e).panelInstance(t[i]));return nicEditors.editors},findEditor:function(e){for(var t=nicEditors.editors,i=0;i<t.length;i++)if(t[i].instanceById(e))return t[i].instanceById(e)}},nicEditor=bkClass.extend({construct:function(e){this.options=new nicEditorConfig,bkExtend(this.options,e),this.nicInstances=new Array,this.loadedPlugins=new Array;for(var t=nicEditors.nicPlugins,i=0;i<t.length;i++)this.loadedPlugins.push(new t[i].p(this,t[i].o));nicEditors.editors.push(this),bkLib.addEvent(document.body,"mousedown",this.selectCheck.closureListener(this))},panelInstance:function(e,t){e=this.checkReplace($BK(e));var i=new bkElement("DIV").appendBefore(e);return this.setPanel(i),this.addInstance(e,t)},checkReplace:function(e){var t=nicEditors.findEditor(e);return t&&(t.removeInstance(e),t.removePanel()),e},addInstance:function(e,t){return t=new((e=this.checkReplace($BK(e))).contentEditable||window.opera?nicEditorInstance:nicEditorIFrameInstance)(e,t,this),this.nicInstances.push(t),this},removeInstance:function(e){e=$BK(e);for(var t=this.nicInstances,i=0;i<t.length;i++)t[i].e==e&&(t[i].remove(),this.nicInstances.splice(i,1))},removePanel:function(e){this.nicPanel&&(this.nicPanel.remove(),this.nicPanel=null)},instanceById:function(e){e=$BK(e);for(var t=this.nicInstances,i=0;i<t.length;i++)if(t[i].e==e)return t[i]},setPanel:function(e){return this.nicPanel=new nicEditorPanel($BK(e),this.options,this),this.fireEvent("panel",this.nicPanel),this},nicCommand:function(e,t){this.selectedInstance&&this.selectedInstance.nicCommand(e,t)},getIcon:function(e,t){this.options.iconList[e],t.iconFiles&&t.iconFiles[e];return{}},selectCheck:function(e,t){do{if(t.className&&"function"==typeof t.className.indexOf&&-1!=t.className.indexOf("nicEdit"))return!1}while(t=t.parentNode);return this.fireEvent("blur",this.selectedInstance,t),this.lastSelectedInstance=this.selectedInstance,this.selectedInstance=null,!1}}),nicEditor=nicEditor.extend(bkEvent),nicEditorInstance=bkClass.extend({isSelected:!1,construct:function(e,t,i){this.ne=i,this.elm=this.e=e,this.options=t||{},newX=parseInt(e.getStyle("width"))||e.clientWidth,newY=parseInt(e.getStyle("height"))||e.clientHeight,this.initialHeight=newY-8;var n="textarea"==e.nodeName.toLowerCase();(n||this.options.hasPanel)&&((i={border:"1px solid #ccc",borderTop:0,overflowY:"auto",overflowX:"hidden"})[(t=bkLib.isMSIE&&!(void 0!==document.body.style.maxHeight&&"CSS1Compat"==document.compatMode))?"height":"maxHeight"]=this.ne.options.maxHeight?this.ne.options.maxHeight+"px":null,this.editorContain=new bkElement("DIV").setStyle(i).appendBefore(e),i=new bkElement("DIV").setStyle({margin:"4px",minHeight:newY+"px"}).addClass("main").appendTo(this.editorContain),e.setStyle({display:"none"}),i.innerHTML=e.innerHTML,n&&(i.setContent(e.value),(e=(this.copyElm=e).parentTag("FORM"))&&bkLib.addEvent(e,"submit",this.saveContent.closure(this))),i.setStyle(t?{height:newY+"px"}:{overflow:"hidden"}),this.elm=i),this.ne.addEvent("blur",this.blur.closure(this)),this.init(),this.blur()},init:function(){this.elm.setAttribute("contentEditable","true"),""==this.getContent()&&this.setContent("<br />"),this.instanceDoc=document.defaultView,this.elm.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keypress",this.keyDown.closureListener(this)).addEvent("focus",this.selected.closure(this)).addEvent("blur",this.blur.closure(this)).addEvent("keyup",this.selected.closure(this)),this.ne.fireEvent("add",this)},remove:function(){this.saveContent(),(this.copyElm||this.options.hasPanel)&&(this.editorContain.remove(),this.e.setStyle({display:"block"}),this.ne.removePanel()),this.disable(),this.ne.fireEvent("remove",this)},disable:function(){this.elm.setAttribute("contentEditable","false")},getSel:function(){return window.getSelection?window.getSelection():document.selection},getRng:function(){var e=this.getSel();if(e&&0!==e.rangeCount)return 0<e.rangeCount?e.getRangeAt(0):e.createRange()},selRng:function(e,t){window.getSelection?(t.removeAllRanges(),t.addRange(e)):e.select()},selElm:function(){var e=this.getRng();if(e){if(e.startContainer){var t=e.startContainer;if(1==e.cloneContents().childNodes.length)for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes[i].ownerDocument.createRange();if(n.selectNode(t.childNodes[i]),1!=e.compareBoundaryPoints(Range.START_TO_START,n)&&-1!=e.compareBoundaryPoints(Range.END_TO_END,n))return $BK(t.childNodes[i])}return $BK(t)}return $BK("Control"==this.getSel().type?e.item(0):e.parentElement())}},saveRng:function(){this.savedRange=this.getRng(),this.savedSel=this.getSel()},restoreRng:function(){this.savedRange&&this.selRng(this.savedRange,this.savedSel)},keyDown:function(e,t){e.ctrlKey&&this.ne.fireEvent("key",this,e)},selected:function(e,t){return(t=t||this.selElm)||(t=this.selElm()),e.ctrlKey||((e=this.ne.selectedInstance)!=this&&(e&&this.ne.fireEvent("blur",e,t),(this.ne.selectedInstance=this).ne.fireEvent("focus",e,t)),this.ne.fireEvent("selected",e,t),this.isFocused=!0,this.elm.addClass("selected")),!1},blur:function(){this.isFocused=!1,this.elm.removeClass("selected")},saveContent:function(){(this.copyElm||this.options.hasPanel)&&(this.ne.fireEvent("save",this),this.copyElm?this.copyElm.value=this.getContent():this.e.innerHTML=this.getContent())},getElm:function(){return this.elm},getContent:function(){return this.content=this.getElm().innerHTML,this.ne.fireEvent("get",this),this.content},setContent:function(e){this.content=e,this.ne.fireEvent("set",this),this.elm.innerHTML=this.content},nicCommand:function(e,t){document.execCommand(e,!1,t)}}),nicEditorIFrameInstance=nicEditorInstance.extend({savedStyles:[],init:function(){var e=this.elm.innerHTML.replace(/^\s+|\s+$/g,"");this.elm.innerHTML="",this.initialContent=e=e||"<br />",this.elmFrame=new bkElement("iframe").setAttributes({src:"javascript:;",frameBorder:0,allowTransparency:"true",scrolling:"no"}).setStyle({height:"100px",width:"100%"}).addClass("frame").appendTo(this.elm),this.copyElm&&this.elmFrame.setStyle({width:this.elm.offsetWidth-4+"px"});for(itm in["font-size","font-family","font-weight","color"])this.savedStyles[bkLib.camelize(itm)]=this.elm.getStyle(itm);setTimeout(this.initFrame.closure(this),50)},disable:function(){this.elm.innerHTML=this.getContent()},initFrame:function(){var e=$BK(this.elmFrame.contentWindow.document);e.designMode="on",e.open();var t=this.ne.options.externalCSS;e.write("<html><head>"+(t?'<link href="'+t+'" rel="stylesheet" type="text/css" />':"")+'</head><body id="nicEditContent" style="margin: 0 !important; background-color: transparent !important;">'+this.initialContent+"</body></html>"),e.close(),this.frameDoc=e,this.frameWin=$BK(this.elmFrame.contentWindow),this.frameContent=$BK(this.frameWin.document.body).setStyle(this.savedStyles),this.instanceDoc=this.frameWin.document.defaultView,this.heightUpdate(),this.frameDoc.addEvent("mousedown",this.selected.closureListener(this)).addEvent("keyup",this.heightUpdate.closureListener(this)).addEvent("keydown",this.keyDown.closureListener(this)).addEvent("keyup",this.selected.closure(this)),this.ne.fireEvent("add",this)},getElm:function(){return this.frameContent},setContent:function(e){this.content=e,this.ne.fireEvent("set",this),this.frameContent.innerHTML=this.content,this.heightUpdate()},getSel:function(){return this.frameWin?this.frameWin.getSelection():this.frameDoc.selection},heightUpdate:function(){this.elmFrame.style.height=Math.max(this.frameContent.offsetHeight,this.initialHeight)+"px"},nicCommand:function(e,t){this.frameDoc.execCommand(e,!1,t),setTimeout(this.heightUpdate.closure(this),100)}}),nicEditorPanel=bkClass.extend({construct:function(e,t,i){this.elm=e,this.options=t,this.ne=i,this.panelButtons=new Array,this.buttonList=bkExtend([],this.ne.options.buttonList),this.panelContain=new bkElement("DIV").addClass("panelContain"),this.panelElm=new bkElement("DIV").addClass("panel").appendTo(this.panelContain),this.panelContain.appendTo(e);var n=this.ne.options;for(button in n.buttons)this.addButton(button,n,!0);this.reorder(),e.noSelect()},addButton:function(buttonName,options,noOrder){var button=options.buttons[buttonName],type=button.type?eval("(typeof("+button.type+') == "undefined") ? null : '+button.type+";"):nicEditorButton,hasButton=bkLib.inArray(this.buttonList,buttonName);type&&(hasButton||this.ne.options.fullPanel)&&(this.panelButtons.push(new type(this.panelElm,buttonName,options,this.ne)),hasButton||this.buttonList.push(buttonName))},findButton:function(e){for(var t=0;t<this.panelButtons.length;t++)if(this.panelButtons[t].name==e)return this.panelButtons[t]},reorder:function(){for(var e=this.buttonList,t=0;t<e.length;t++){var i=this.findButton(e[t]);i&&this.panelElm.appendChild(i.margin)}},remove:function(){this.elm.remove()}}),nicEditorButton=bkClass.extend({construct:function(e,t,i,n){this.options=i.buttons[t],this.name=t,this.ne=n,this.elm=e,this.margin=new bkElement("DIV").setStyle({float:"left",margin:"1px"}).appendTo(e),this.contain=new bkElement("DIV").setStyle({width:"24px",height:"24px"}).addClass("buttonContain").appendTo(this.margin),this.border=new bkElement("DIV").setStyle({}).appendTo(this.contain),this.options.content?(this.button=new bkElement("DIV").appendTo(this.border).setStyle({width:"22px",height:"22px",overflow:"hidden",zoom:1,cursor:"pointer"}).addClass("button"),this.button.innerHTML=this.options.content):this.button=new bkElement("DIV").setStyle({width:"22px",height:"22px",overflow:"hidden",zoom:1,cursor:"pointer"}).addClass("button").setStyle(this.ne.getIcon(t,i)).appendTo(this.border),this.button.addEvent("mouseover",this.hoverOn.closure(this)).addEvent("mouseout",this.hoverOff.closure(this)).addEvent("mousedown",this.mouseClick.closure(this)).noSelect(),window.opera||(this.button.onmousedown=this.button.onclick=bkLib.cancelEvent),n.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this)).addEvent("key",this.key.closure(this)),this.disable(),this.init()},init:function(){},hide:function(){this.contain.setStyle({display:"none"})},updateState:function(){this.isDisabled?this.setBg():this.isHover?this.setBg("hover"):this.isActive?this.setBg("active"):this.setBg()},setBg:function(e){this.border.removeClass("button-active").removeClass("button-hover").addClass("button-"+e)},checkNodes:function(e){var t=e;do{if(this.options.tags&&bkLib.inArray(this.options.tags,t.nodeName))return this.activate(),!0}while(t=t.parentNode&&"nicEdit"!=t.className);for(t=$BK(e);3==t.nodeType;)t=$BK(t.parentNode);if(this.options.css)for(itm in this.options.css)if(t.getStyle(itm,this.ne.selectedInstance.instanceDoc)==this.options.css[itm])return this.activate(),!0;return this.deactivate(),!1},activate:function(){this.isDisabled||(this.isActive=!0,this.updateState(),this.ne.fireEvent("buttonActivate",this))},deactivate:function(){this.isActive=!1,this.updateState(),this.isDisabled||this.ne.fireEvent("buttonDeactivate",this)},enable:function(e,t){this.isDisabled=!1,this.contain.setStyle({opacity:1}).addClass("buttonEnabled"),this.updateState(),this.checkNodes(t)},disable:function(e,t){this.isDisabled=!0,this.contain.setStyle({opacity:.6}).removeClass("buttonEnabled"),this.updateState()},toggleActive:function(){this.isActive?this.deactivate():this.activate()},hoverOn:function(){this.isDisabled||(this.isHover=!0,this.updateState(),this.ne.fireEvent("buttonOver",this))},hoverOff:function(){this.isHover=!1,this.updateState(),this.ne.fireEvent("buttonOut",this)},mouseClick:function(){this.options.command&&(this.ne.nicCommand(this.options.command,this.options.commandArgs),this.options.noActive||this.toggleActive()),this.ne.fireEvent("buttonClick",this)},key:function(e,t){this.options.key&&t.ctrlKey&&String.fromCharCode(t.keyCode||t.charCode).toLowerCase()==this.options.key&&(this.mouseClick(),t.preventDefault&&t.preventDefault())}}),nicPlugin=bkClass.extend({construct:function(e,t){this.options=t,this.ne=e,this.ne.addEvent("panel",this.loadPanel.closure(this)),this.init()},loadPanel:function(e){for(var t in this.options.buttons)e.addButton(t,this.options);e.reorder()},init:function(){}}),nicPaneOptions={},nicEditorPane=bkClass.extend({construct:function(e,t,i,n){this.ne=t,this.elm=e,this.pos=e.pos(),this.contain=new bkElement("div").setStyle({zIndex:"99999",overflow:"hidden",position:"absolute",left:this.pos[0]+"px",top:this.pos[1]+"px"}),this.pane=new bkElement("div").setStyle({fontSize:"12px",border:"1px solid #ccc",overflow:"hidden",padding:"4px",textAlign:"left",backgroundColor:"#ffffc9"}).addClass("pane").setStyle(i).appendTo(this.contain),n&&!n.options.noClose&&(this.close=new bkElement("div").setStyle({float:"right",height:"16px",width:"16px",cursor:"pointer"}).setStyle(this.ne.getIcon("close",nicPaneOptions)).addEvent("mousedown",n.removePane.closure(this)).appendTo(this.pane)),this.contain.noSelect().appendTo(document.body),this.position(),this.init()},init:function(){},position:function(){var e;!this.ne.nicPanel||(e=(e=this.ne.nicPanel.elm).pos()[0]+parseInt(e.getStyle("width"))-(parseInt(this.pane.getStyle("width"))+8))<this.pos[0]&&this.contain.setStyle({left:e+"px"})},toggle:function(){this.isVisible=!this.isVisible,this.contain.setStyle({display:this.isVisible?"block":"none"})},remove:function(){this.contain&&(this.contain.remove(),this.contain=null)},append:function(e){e.appendTo(this.pane)},setContent:function(e){this.pane.setContent(e)}}),nicEditorAdvancedButton=nicEditorButton.extend({init:function(){this.ne.addEvent("selected",this.removePane.closure(this)).addEvent("blur",this.removePane.closure(this))},mouseClick:function(){this.isDisabled||(this.pane&&this.pane.pane?this.removePane():(this.pane=new nicEditorPane(this.contain,this.ne,{width:this.width||"270px",backgroundColor:"#303030",color:"#fff"},this),this.addPane(),this.ne.selectedInstance.saveRng()))},addForm:function(e,t){var i=this;for(itm in this.form=new bkElement("form").addEvent("submit",this.submit.closureListener(this)),$(this.pane.pane).addClass("quick-dash rich-text-editor-dialog"),this.pane.append(this.form),this.inputs={},e){var n=e[itm],a="",a=(a=t?t.getAttribute(itm):a)||(n.value||""),o=e[itm].type;if("title"==o)new bkElement("div").setContent(n.txt).setStyle({fontSize:"14px",fontWeight:"bold",padding:"0px",margin:"2px 0"}).appendTo(this.form);else{var s=new bkElement("div").setStyle({overflow:"hidden",clear:"both"}).appendTo(this.form);switch(n.txt&&new bkElement("label").setAttributes({for:itm}).setContent(n.txt).setStyle({margin:"2px 4px",fontSize:"13px",width:"50px",lineHeight:"20px",textAlign:"right",float:"left"}).appendTo(s),o){case"text":this.inputs[itm]=new bkElement("input").setAttributes({id:itm,value:a,type:"text"}).setStyle({margin:"2px 0",fontSize:"13px",float:"left",height:"20px",border:"none",overflow:"hidden"}).setStyle(n.style).appendTo(s);break;case"select":for(opt in this.inputs[itm]=new bkElement("select").setAttributes({id:itm}).setStyle({border:"none",float:"left",margin:"2px 0"}).appendTo(s),n.options)new bkElement("option").setAttributes({value:opt,selected:opt==a?"selected":""}).setContent(n.options[opt]).appendTo(this.inputs[itm]);break;case"content":this.inputs[itm]=new bkElement("textarea").setAttributes({id:itm}).setStyle({border:"1px solid #ccc",float:"left"}).setStyle(n.style).appendTo(s),this.inputs[itm].value=a;break;case"imageupload":var r=$('<div><input class="file-input" type="file"  accept="image/*" style="display: none;"/><div class="upload-btn" style="height: 25px;">Upload Image</div><span class="file-name"></span></div>');this.inputs[itm]=new bkElement(r).appendTo(s),r.find(".upload-btn").button({icons:{primary:"fa fa-upload"},text:!0}).click(function(){r.find(".file-input").click()}),r.find(".file-input").on("change",function(e){var t;0<e.target.files.length&&((t=new FileReader).onload=function(e){i.imgSrc=e.target.result,r.find(".file-name").text(r.find(".file-input").val().replace(/C:\\fakepath\\/i,""))},t.readAsDataURL(e.target.files[0]))})}}}new bkElement("input").setAttributes({type:"submit"}).appendTo(this.form),this.form.onsubmit=bkLib.cancelEvent},submit:function(){},findElm:function(e,t,i){for(var n=this.ne.selectedInstance.getElm().getElementsByTagName(e),a=0;a<n.length;a++)if(n[a].getAttribute(t)==i)return $BK(n[a])},removePane:function(){this.pane&&(this.pane.remove(),this.pane=null,this.ne.selectedInstance.restoreRng())}}),nicButtonTips=bkClass.extend({construct:function(e){(this.ne=e).addEvent("buttonOver",this.show.closure(this)).addEvent("buttonOut",this.hide.closure(this))},show:function(e){this.timer=setTimeout(this.create.closure(this,e),400)},create:function(e){this.timer=null,this.pane||(this.pane=new nicEditorPane(e.button,this.ne,{fontSize:"12px",marginTop:"5px"}),this.pane.setContent(e.options.name))},hide:function(e){this.timer&&clearTimeout(this.timer),this.pane&&(this.pane=this.pane.remove())}});nicEditors.registerPlugin(nicButtonTips);var nicSelectOptions={buttons:{fontSize:{name:__("Select Font Size"),type:"nicEditorFontSizeSelect",command:"fontsize"},fontFamily:{name:__("Select Font Family"),type:"nicEditorFontFamilySelect",command:"fontname"},fontFormat:{name:__("Select Font Format"),type:"nicEditorFontFormatSelect",command:"formatBlock"}}},nicEditorSelect=bkClass.extend({construct:function(e,t,i,n){this.options=i.buttons[t],this.elm=e,this.ne=n,this.name=t,this.selOptions=new Array,this.margin=new bkElement("div").setStyle({float:"left",margin:"1px 1px 0 1px"}).appendTo(this.elm),this.contain=new bkElement("div").setStyle({width:"90px",padding:"4px",height:"16px",cursor:"pointer",overflow:"hidden"}).addClass("selectContain").addEvent("click",this.toggle.closure(this)).appendTo(this.margin),this.items=new bkElement("div").setStyle({overflow:"hidden",zoom:1,border:"transparent",paddingLeft:"3px"}).appendTo(this.contain),this.control=new bkElement("i").setStyle({overflow:"hidden",marginTop:"3px",float:"right",height:"18px",width:"16px"}).addClass("selectControl fa fa-fw fa-caret-down").appendTo(this.items),this.txt=new bkElement("div").setStyle({overflow:"hidden",float:"left",width:"66px",height:"14px",marginTop:"1px",fontFamily:"sans-serif",textAlign:"center",fontSize:"12px"}).addClass("selectTxt").appendTo(this.items),window.opera||(this.contain.onmousedown=this.control.onmousedown=this.txt.onmousedown=bkLib.cancelEvent),this.margin.noSelect(),this.ne.addEvent("selected",this.enable.closure(this)).addEvent("blur",this.disable.closure(this)),this.disable(),this.init()},disable:function(){this.isDisabled=!0,this.close(),this.contain.setStyle({opacity:.6})},enable:function(e){this.isDisabled=!1,this.close(),this.contain.setStyle({opacity:1})},setDisplay:function(e){this.txt.setContent(e)},toggle:function(){this.isDisabled||(this.pane?this.close():this.open())},open:function(){this.pane=new nicEditorPane(this.items,this.ne,{width:"88px",padding:"0px",borderTop:0,borderLeft:"1px solid #ccc",borderRight:"1px solid #ccc",borderBottom:"0px",backgroundColor:"#fff"});for(var e=0;e<this.selOptions.length;e++){var t=this.selOptions[e],i=new bkElement("div").setStyle({overflow:"hidden",borderBottom:"1px solid #ccc",width:"88px",textAlign:"left",cursor:"pointer"}),n=new bkElement("div").setStyle({padding:"0px 4px"}).setContent(t[1]).appendTo(i).noSelect();n.addEvent("click",this.update.closure(this,t[0])).addEvent("mouseover",this.over.closure(this,n)).addEvent("mouseout",this.out.closure(this,n)).setAttributes("id",t[0]),this.pane.append(i),window.opera||(n.onmousedown=bkLib.cancelEvent)}},close:function(){this.pane&&(this.pane=this.pane.remove())},over:function(e){e.setStyle({backgroundColor:"#ccc"})},out:function(e){e.setStyle({backgroundColor:"#fff"})},add:function(e,t){this.selOptions.push(new Array(e,t))},update:function(e){this.ne.nicCommand(this.options.command,e),this.close()}}),nicEditorFontSizeSelect=nicEditorSelect.extend({sel:{1:"1&nbsp;(8pt)",2:"2&nbsp;(10pt)",3:"3&nbsp;(12pt)",4:"4&nbsp;(14pt)",5:"5&nbsp;(18pt)",6:"6&nbsp;(24pt)"},init:function(){for(itm in this.setDisplay("Font&nbsp;Size..."),this.sel)this.add(itm,'<font size="'+itm+'">'+this.sel[itm]+"</font>")}}),nicEditorFontFamilySelect=nicEditorSelect.extend({sel:{arial:"Arial","comic sans ms":"Comic Sans","courier new":"Courier New",georgia:"Georgia",helvetica:"Helvetica",impact:"Impact","times new roman":"Times","trebuchet ms":"Trebuchet",verdana:"Verdana"},init:function(){for(itm in this.setDisplay("Font&nbsp;Family..."),this.sel)this.add(itm,'<font face="'+itm+'">'+this.sel[itm]+"</font>")}}),nicEditorFontFormatSelect=nicEditorSelect.extend({sel:{p:"Paragraph",pre:"Pre",h6:"Heading&nbsp;6",h5:"Heading&nbsp;5",h4:"Heading&nbsp;4",h3:"Heading&nbsp;3",h2:"Heading&nbsp;2",h1:"Heading&nbsp;1"},init:function(){for(itm in this.setDisplay("Font&nbsp;Format..."),this.sel){var e=itm.toUpperCase();this.add("<"+e+">","<"+itm+' style="padding: 0px; margin: 0px;">'+this.sel[itm]+"</"+e+">")}}});nicEditors.registerPlugin(nicPlugin,nicSelectOptions);var nicLinkOptions={buttons:{link:{name:"Add Link",type:"nicLinkButton",tags:["A"],content:'<i class="fa fa-fw fa-link"/>'},unlink:{name:"Remove Link",command:"unlink",noActive:!0,content:'<i class="fa fa-fw fa-unlink"/>'}}},nicLinkButton=nicEditorAdvancedButton.extend({addPane:function(){this.ln=this.ne.selectedInstance.selElm().parentTag("A"),this.addForm({"":{type:"title",txt:"Add/Edit Link"},href:{type:"text",txt:"URL",value:"http://",style:{width:"150px"}},title:{type:"text",txt:"Title"},target:{type:"select",txt:"Open In",options:{"":"Current Window",_blank:"New Window"},style:{width:"100px"}}},this.ln)},submit:function(e){var t=this.inputs.href.value;if("http://"==t||""==t)return alert("You must enter a URL to Create a Link"),!1;this.removePane(),this.ln||(this.ne.nicCommand("createlink",t="javascript:nicTemp();"),this.ln=this.findElm("A","href",t)),this.ln&&this.ln.setAttributes({href:this.inputs.href.value,title:this.inputs.title.value,target:this.inputs.target.options[this.inputs.target.selectedIndex].value})}});nicEditors.registerPlugin(nicPlugin,nicLinkOptions);var nicColorOptions={buttons:{forecolor:{name:__("Change Text Color"),type:"nicEditorColorButton",noClose:!0,content:'<i class="fa fa-fw fa-font" />'},bgcolor:{name:__("Change Background Color"),type:"nicEditorBgColorButton",noClose:!0,content:'<i class="fa fa-fa fa-eyedropper"></i>'}}},nicEditorColorButton=nicEditorAdvancedButton.extend({addPane:function(){var e,t={0:"00",1:"33",2:"66",3:"99",4:"CC",5:"FF"},i=new bkElement("DIV").setStyle({width:"270px"});for(e in t)for(var n in t)for(var a in t){var o="#"+t[e]+t[a]+t[n],s=new bkElement("DIV").setStyle({cursor:"pointer",height:"15px",float:"left"}).appendTo(i),a=new bkElement("DIV").setStyle({border:"2px solid "+o}).appendTo(s),a=new bkElement("DIV").setStyle({backgroundColor:o,overflow:"hidden",width:"11px",height:"11px"}).addEvent("click",this.colorSelect.closure(this,o)).addEvent("mouseover",this.on.closure(this,a)).addEvent("mouseout",this.off.closure(this,a,o)).appendTo(a);window.opera||(s.onmousedown=a.onmousedown=bkLib.cancelEvent)}this.pane.append(i.noSelect())},colorSelect:function(e){this.ne.nicCommand("foreColor",e),this.removePane()},on:function(e){e.setStyle({border:"2px solid #000"})},off:function(e,t){e.setStyle({border:"2px solid "+t})}}),nicEditorBgColorButton=nicEditorColorButton.extend({colorSelect:function(e){this.ne.nicCommand("hiliteColor",e),this.removePane()}});nicEditors.registerPlugin(nicPlugin,nicColorOptions);var nicImageOptions={buttons:{image:{name:"Add Image",type:"nicImageButton",tags:["IMG"],content:'<i class="fa fa-fw fa-picture-o" />'}}},nicImageButton=nicEditorAdvancedButton.extend({addPane:function(){this.im=this.ne.selectedInstance.selElm().parentTag("IMG"),this.addForm({"":{type:"title",txt:"Add/Edit Image"},width:{type:"text",txt:"Width",value:"",style:{width:"100px"}},height:{type:"text",txt:"Height",value:"",style:{width:"100px"}},alt:{type:"text",txt:"Alt Text",style:{width:"100px"}},align:{type:"select",txt:"Align",options:{none:"Default",left:"Left",right:"Right"}},imageupload:{type:"imageupload",txt:"Source",style:{width:"100px",height:"25px;"}}},this.im)},submit:function(e){var t;if(this.removePane(),this.im||(this.ne.nicCommand("insertImage",t="javascript:nicImTemp();"),this.im=this.findElm("IMG","src",t)),this.im){if(this.imgSrc)this.im.setAttributes({src:this.imgSrc,alt:this.inputs.alt.value,align:this.inputs.align.value});else if("javascript:nicImTemp();"!==this.im.src.length)this.im.setAttributes({alt:this.inputs.alt.value,align:this.inputs.align.value});else if(!this.imgSrc||0==this.imgSrc.length)return alert("You must upload an image to insert"),!1;0<this.inputs.width.value&&this.im.setAttributes({width:this.inputs.width.value}),0<this.inputs.height.value&&this.im.setAttributes({height:this.inputs.height.value}),this.imgSrc=null}}});nicEditors.registerPlugin(nicPlugin,nicImageOptions);var nicSaveOptions={buttons:{save:{name:__("Save this content"),type:"nicEditorSaveButton"}}},nicEditorSaveButton=nicEditorButton.extend({init:function(){this.ne.options.onSave||this.margin.setStyle({display:"none"})},mouseClick:function(){var e=this.ne.options.onSave,t=this.ne.selectedInstance;e(t.getContent(),t.elm.id,t)}});nicEditors.registerPlugin(nicPlugin,nicSaveOptions);var nicHTMLOptions={buttons:{html:{name:__("Edit raw HTML"),type:"nicEditorHTMLButton",content:'<i class="fa fa-fw fa-code" />'}}},nicEditorHTMLButton=nicEditorButton.extend({init:function(){var e;this.ne.options.onCode||this.margin.setStyle({display:"none"}),this.ne.options.htmlButtonDesc&&(this.button.innerHTML=this.options.content=this.ne.options.htmlButtonDesc,e={fontFamily:"sans-serif",textAlign:"center",fontSize:"12px",width:"Basic mode"===this.options.content?"80px":"120px"},this.button.setStyle(_.extend({},e,{marginTop:"3px"})),this.contain.setStyle(e))},disable:function(){this.isDisabled||this.contain.setStyle({opacity:1})},mouseClick:function(){(0,this.ne.options.onCode)(this)}});nicEditors.registerPlugin(nicPlugin,nicHTMLOptions);var nicBeautifyOptions={buttons:{beautify:{name:__("Beautify HTML"),type:"beautifyButton",content:'<i class="fa fa-bath"></i>'}}},beautifyButton=nicEditorButton.extend({init:function(){this.ne.options.onBeautify||this.margin.setStyle({display:"none"})},disable:function(){this.contain.setStyle({opacity:1})},mouseClick:function(){(0,this.ne.options.onBeautify)(this)}});nicEditors.registerPlugin(nicPlugin,nicBeautifyOptions);var TemplateDialog=(Pda=Backbone.View,__extends(Qda,Pda),Qda.prototype.onResize=function(){MonacoHelpers.adjustAfterResize(this.editor)},Qda.prototype.remove=function(){return this.unregisterHandlebarIntellisense&&this.unregisterHandlebarIntellisense.dispose(),this.editor&&(this.editor=null),this.editor=this.$beautify=this.$dialog=this.$selectable=this.options=null,Backbone.View.prototype.remove.call(this)},Qda.prototype.checkForAdvancedHelpers=function(e){Qda.NONEACH_HELPER_RX.test(e)?this.$basicMode.hide():this.$basicMode.show()},Qda.prototype.checkForErrors=function(e){try{Handlebars.compile(e)({}),this.$error.hide()}catch(e){this.$error.show(),this.$error.find("div")[0].innerText=e.message}},Qda.prototype.descriptify=function(e){return e=e&&(e=e.replace(/<script class="handlebars-helpers" type="handlebars-helpers">/gi,"")).replace(/<\/script>/gi,"")},Qda.prototype.initHorizontalResize=function(){try{this.$sidebar.resizable("destroy")}catch(e){}this.$sidebar.resizable({handles:"e",minWidth:220,maxWidth:300}).on("resize",this.onHorizontalResize.bind(this))},Qda.prototype.insertItem=function(e){function a(e,t){return e.replace(Qda.VS_HBAR_RX,"{{"+_.repeat("../",t)+"$1}}")}var o=this,s=e.parents[e.parents.length-2],r=[],l=new RegExp("{{\\s*#each\\s*"+s.substring(1)+"\\s*}}");if(this.isInCodeMode){var t=this.descriptify(this.wrapInHandlebars(e.id)),e=this.codeEditor.getModel().findMatches(Qda.EACH_HELPERS_RX.source,!0,!0,!1,null,!0),n=this.codeEditor.getPosition();_.each(e,function(e,t){var i=e.range.getEndPosition();n.lineNumber<i.lineNumber||n.lineNumber===i.lineNumber&&n.column<i.column||(Qda.EACH_END_RX.test(e.matches[0])?r.pop():r.push(l.test(e.matches[0])))}),_.every(r,function(e){return!e})&&_.includes(s,"@")?t="{{#each "+s.substring(1)+"}}<div>"+t+"</div>{{/each}}":r.length&&!_.includes(s,"@")&&(t=a(t,r.length)),this.codeEditor.trigger("keyboard","type",{text:t})}else{var c=this.editorField;if(c&&this.pendingContent){var d,p=nicEditors.findEditor(this.INSTANCE_ID),t=p.savedRange.endOffset+this.pendingContent.length-(c.data?c.data.length:0);c.nodeValue?c.nodeValue=this.pendingContent:0===(g=this.editorRng.endOffset)?c.prepend(this.pendingContent):(m=c.childNodes[g-1])?m.before(this.pendingContent):c.append(this.pendingContent),this.debouncedUpdateSidebar(p.elm.innerText),_.each(Array.from(p.elm.childNodes),function(e){if(e instanceof HTMLElement&&"SCRIPT"===e.tagName)Qda.EACH_END_RX.test(e.innerText)?r.pop():l.test(e.innerText)?r.push(!0):Qda.EACH_START_RX.test(e.innerText)&&r.push(!1);else if(e===c||_.includes(Array.from(e.childNodes),c)||_.includes(Array.from(c.childNodes),e)){if(r.length&&!_.includes(s,"@"))return void(3===c.nodeType?c.nodeValue=a(c.nodeValue,r.length):c.innerText=a(c.innerText,r.length));if(_.includes(s,"@")&&_.every(r,function(e){return!e})){var t=void 0,i=void 0,n="";return e instanceof HTMLElement?i=(t=e).outerHTML:(t=d,i="<div>"+_.trim(e.textContent)+"</div>",n="\n"),i=o.scriptify(n+"{{#each "+s.substring(1)+"}}"+a(i,1+r.length)+"{{/each}}"),t?(t.insertAdjacentHTML("afterend",i),c=t.nextSibling.nextSibling,n&&(c=c.nextSibling)):(p.elm.insertAdjacentHTML("afterbegin",i),c=p.elm.childNodes[2]),3===c.childNodes[0].nodeType&&(c=c.childNodes[0]),void p.elm.removeChild(e)}}e instanceof HTMLElement&&(d=e)});for(var i=c,u=c,h=[];i!==p.elm;)i=u.parentNode,h.push(Array.prototype.indexOf.call(i.childNodes,u)),u=i;var g=_.some(i.childNodes,function(e){return"handlebars-helpers"===e.type}),m=document.createRange();if(h.length){for(var f=g?i.childNodes:_.filter(i.childNodes,function(e){return"handlebars-helpers"!==e.type}),i=f=!g&&f.length!==i.childNodes.length?f[0].childNodes:f,v=h.length-1;0<=v;v--)i=(c=i[h[v]]).childNodes;t=1<c.childNodes.length?c.childNodes.length:t}else{f=_.find(c.childNodes,function(e){return"handlebars-helpers"!==e.type});f&&(c=f.childNodes.length?f.childNodes[0]:f)}c.data&&c.data!==this.pendingContent&&(t+=c.data.length-this.pendingContent.length),m.setStart(c,t),m.setEnd(c,t),p.selRng(m,p.getSel()),this.pendingContent="",this.editorField=null,this.editorRng=null}}},Qda.prototype.onHorizontalResize=function(){var e=this.$sidebar.width();this.$textEditor.css({width:"calc(100% - "+e+"px)",left:e+"px"})},Qda.prototype.jstreeSearch=function(e){this.$tree.jstree("show_all"),this.$tree.jstree().search(e)},Qda.prototype.initCodeEditor=function(n){var a=this;MonacoHelpers.require({language:"handlebars"},function(e){var t=e.monaco,i=e.docs,e=e.disposable;a.docs=i,a.unregisterHandlebarIntellisense=e;e=a.$el.find(".code")[0];a.codeEditor||(a.codeEditor=t.editor.create(e,{language:"handlebars",automaticLayout:!0,theme:"kx-light"!==$.cookie("dashboard-theme")?"vs-dark":"vs",contextmenu:!1,fixedOverflowWidgets:!0,fontSize:12,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on",dragAndDrop:!1})),a.codeEditor.getAction("editor.action.formatDocument").run();e=n||a.editor.instanceById(a.INSTANCE_ID).getContent();a.checkForAdvancedHelpers(e),a.codeEditor.setValue(a.descriptify(e)),a.codeEditor.getModel().onDidChangeContent(function(){var e=a.codeEditor.getModel().getValue();a.disableTree||a.debouncedUpdateSidebar(e),a.debouncedCheckForErrors(e),a.debouncedCheckForAdvancedHelpers(e)})})},Qda.prototype.initHandlebarHelperPicker=function(){var t=this,e=["each","eq","gt","lt","if","toFixed","addCommas","toPrecision"],e=e.concat(Object.keys(_.omit(Handlebars.helpers,["blockHelperMissing","t","helperMissing","valueProps","lookup","log","type-cast","unless"].concat(e))).sort());_.each(e,function(e){t.$el.find(".gok-handlebarselect").append("<option value="+e+">"+e+"</option>")}),this.$helperSelect=this.$el.find(".gok-handlebarselect").select2({minimumResultsForSearch:5,theme:"dashboards",width:"100px"}),this.$el.find(".add-helper").button({icons:{primary:"fa fa-plus"}}).click(function(){var e=t.$helperSelect.val(),e=t.getHandlebarHelperShell(e);t.codeEditor.setValue(t.codeEditor.getValue()+"\n"+e)})},Qda.prototype.getHandlebarHelperShell=function(e){var t=this.docs[e];if(!t||!t.comment)return"{{"+e+"}}";var i=t.comment.match(/```handlebars\n((.|\n)+)(```)/);return i&&i[0]?i[0].replace(/ \* /g,"").replace("```handlebars","").replace("```","").trim():t.comment.match(/\@block/)?"{{#"+e+"}} {{/"+e+"}}":"{{"+e+"}}"},Qda.prototype.onButtonClick=function(){var e=this.isInCodeMode?this.codeEditor.getValue():this.editor.instanceById(this.INSTANCE_ID).getContent();e=this.descriptify(e),this.options.allowUnsafeContent||(e=this.options.sanitizeTemplate?this.options.sanitizeTemplate(e):DOMPurify.sanitize(e,{ADD_ATTR:["target"]})),this.options.applyCallback&&this.options.applyCallback(e)},Qda.prototype.renderPreview=function(e){this.$preview.empty(),this.$preview.append("<div>"+e+"</div>")},Qda.prototype.requiresBrackets=function(e){return Qda.VSRx.test(e)||/\s/.test(e)},Qda.prototype.scriptify=function(e){return e=e.replace(Qda.EACH_HELPERS_RX,function(e){return'<script class="handlebars-helpers" type="handlebars-helpers">'+e+"<\/script>"})},Qda.prototype.trimVSChars=function(e){return Qda.VSRx.test(e)?e.substring(1,e.length-1):e},Qda.prototype.updateSidebar=function(i){var n=this,a=[];_.each([/{{2,3}(#?\w+\s+)?\s*([\w\.]+)[^{}]*}{2,3}/gm,/{{2,3}[^{}]*\[(\$[\w\s\.]+\$)\][^{}]*}{2,3}/gm],function(e){for(;null!==(t=e.exec(i));){var t=n.$tree.jstree().get_node(t[2]||t[1]);t&&("activeKey"!==t.type&&(t.oldType=t.type,n.$tree.jstree().set_type(t,"activeKey")),a.push(t))}});var e=_.remove(this.activeKeys,function(e){return!_.includes(a,e)});_.each(e,function(e){return n.$tree.jstree().set_type(e,e.oldType)}),this.activeKeys=a},Qda.prototype.updateTheme=function(){var e=$("#appdiv .toolbar").hasClass("kx-light")?"kx-light":"kx-darkroom",t=$(document).find(".vakata-context.jstree-contextmenu");t&&(t.removeClass("kx-light kx-darkroom"),t.addClass(e))},Qda.prototype.wrapInHandlebars=function(e){return this.requiresBrackets(e)?"{{["+e+"]}}":"{{"+e+"}}"},Qda.DIALOG_HEIGHT=540,Qda.VSRx=/\$[^$]*\$/i,Qda.BLOCK_HELPERS_RX=/{{(\s*#|\s*\/)[^}]*}}/gi,Qda.EACH_HELPERS_RX=/{{(\s*#|\s*\/)each[^}]*}}/gi,Qda.EACH_START_RX=/{{\s*#each\s*(\w*)\s*}}/,Qda.EACH_END_RX=/{{\/\s*each\s*}}/,Qda.NONEACH_HELPER_RX=/{{(\s*#|\s*\/)(?!each)[^{}]*}}/i,Qda.VS_HBAR_RX=/{{(?:..\/)*(\[\$([\w\.])+\$\])}}/g,Qda),Pda;function Qda(e){var s=Pda.call(this,_.extend({},e,{className:"template-dialog"}))||this;s.INSTANCE_ID="ffsEdit",s.options=e,s.keys=e.keys,s.valueData=e.valueData,s.docViewModel=e.docViewModel,s.disableTree=e.disableTree,s.$el.html(T.TemplateDialog({uid:s.INSTANCE_ID,background:e.background})),s.$textEditor=s.$el.find(".template-editor"),s.$editor=s.$el.find(".editor"),s.$code=s.$el.find(".code"),s.$error=s.$el.find(".handlebar-errors"),s.$tree=s.$el.find(".tree"),s.$search=s.$el.find(".topnav"),s.$clearSearch=s.$el.find(".clearSearch"),s.$sidebar=s.$el.find(".sidebar"),s.$basicMode=s.$el.find(".basic-mode"),s.$addHelper=s.$el.find(".add-helper"),s.$beautify=s.$el.find(".beautify"),s.$basicToolbar=s.$el.find("#htmlxEdit"),s.$advancedToolbar=s.$el.find("#advanced-toolbar"),s.disableTree&&(s.$textEditor.addClass("full-width"),s.$sidebar.hide()),s.debouncedUpdateSidebar=_.debounce(s.updateSidebar.bind(s),200),s.debouncedCheckForAdvancedHelpers=_.debounce(s.checkForAdvancedHelpers.bind(s),200),s.debouncedCheckForErrors=_.debounce(s.checkForErrors.bind(s),200);var i=_.debounce(s.jstreeSearch.bind(s),250);return s.$search.keyup(function(e){e=e.target.value;e?s.$clearSearch.show():s.$clearSearch.hide(),i(e)}),s.$clearSearch.click(function(){s.$search.find("input").val("").trigger("keyup")}),s.$basicMode.button({icons:{primary:"fa fa-arrow-left"}}).click(function(){s.htmlButton.ne.options.onCode()}),s.$beautify.button({icons:{primary:"fa fa-bath"}}).click(function(){s.codeEditor.getAction("editor.action.formatDocument").run()}),$.ui.dialog.prototype._focusTabbable=$.noop.bind(s),s.$dialog=s.$el.dialog({appendTo:e.container,dialogClass:"template-editor-dialog",title:"Template Editor",resizable:!0,height:Qda.DIALOG_HEIGHT,width:850,minWidth:710,modal:!0,autoOpen:!0,buttons:[{text:t("OK"),click:function(){s.onButtonClick(),s.$el.dialog("close")},icons:{primary:"fa fa-check"}},{text:t("Apply"),click:s.onButtonClick.bind(s),icons:{primary:"fa fa-check-square-o"}},{text:t("Cancel"),click:function(){s.$el.dialog("close")},icons:{primary:"fa fa-times"}}],close:function(){s.remove()},open:function(){$('<i class="fa fa-code" />').insertBefore(s.$el.parent().find(".ui-dialog-title"));function e(e){s.$basicToolbar.toggle(),s.$advancedToolbar.toggle(),s.$editor.toggle(),s.$code.toggle(),s.isInCodeMode=!s.isInCodeMode,s.isInCodeMode?s.initCodeEditor(e):(s.options.allowUnsafeContent||(e=s.options.sanitizeTemplate?s.options.sanitizeTemplate(e):DOMPurify.sanitize(e,{ADD_ATTR:["target"]})),s.editor.instanceById(s.INSTANCE_ID).setContent(s.scriptify(e)),$(s.editor.instanceById(s.INSTANCE_ID).elm).focus())}var c,t,i,n,a,o={buttonList:["bold","italic","underline","left","center","right","justify","ol","ul","indent","outdent","forecolor","fontSize","html"],htmlButtonDesc:'<i class="fa fa-fw fa-code"></i> Advanced mode',onCode:function(){e(s.codeEditor&&s.isInCodeMode?s.codeEditor.getValue():null)}};s.editor=new nicEditor(o),s.editor.setPanel("htmlxEdit"),s.editor.addInstance(s.INSTANCE_ID),Qda.NONEACH_HELPER_RX.test(s.options.text)?e(s.options.text):(i=s.scriptify(s.options.text),s.editor.instanceById(s.INSTANCE_ID).setContent(i),s.debouncedCheckForErrors(i),$(s.editor.instanceById(s.INSTANCE_ID).elm).focus()),s.htmlButton=_.find(s.editor.nicPanel.panelButtons,function(e){return"html"===e.name}),s.disableTree||(c=function(e,r,l){return void 0===r&&(r=!1),void 0===l&&(l=""),_.map(e,function(e,t){var i,n,a=_.some(e.attributes,function(e){return e instanceof QuickBase.DocumentViewModel}),o=!a&&e instanceof QuickBase.DocumentViewModel,s=a||!o&&e instanceof Object;return s?(i=t,n=l+(r?t+".":""),n=c(a?_.omit(e.attributes,".settings"):e,!0,n)):i=o?"$"+l+t+"$":l+e,{id:i,text:t,state:{selected:!1},children:s?n:[],type:s?"folder":o?"viewstate":"key"}})},t=s.keys.length?c({columns:_.keyBy(s.keys)}):[],o=c({viewstates:s.docViewModel}),i=_.reduce(s.valueData,function(e,t,i){return e[i="array"===t.type?"@"+i:i]=t.items,e},{}),i=_.isEmpty(s.valueData)?[]:c(i),n=_.union(t,i,o),a=function(e){return _.map(e.sort(function(e,t){return Math.min(1,t.children.length)-Math.min(1,e.children.length)||s.trimVSChars(e.id).localeCompare(s.trimVSChars(t.id))}),function(e){return _.reduce(e,function(e,t,i){return"children"===i&&t.length?e[i]=a(t):e[i]=t,e},{})})},n.length&&(require(["jstree"],function(){s.$tree.jstree({core:{data:a(n),multiple:!1},conditionalselect:function(e){return 0===e.children.length},contextmenu:{items:function(t){return"folder"===t.type?{}:{add:{label:"Add to editor",action:function(e){s.pendingContent||(s.$tree.jstree().deselect_node(t),s.$tree.jstree().select_node(t)),s.insertItem(t)}}}}},types:{activeKey:{icon:"fa fa-check-circle"},key:{icon:"fa fa-circle"},viewstate:{icon:"fa fa-eye"},folder:{icon:"fa fa-folder"}},search:{show_only_matches:!0,show_only_matches_children:!0},dnd:{is_draggable:function(e,t){return t.preventDefault(),!1}},plugins:["conditionalselect","contextmenu","search","types","dnd"]}),s.$tree.on("show_contextmenu.jstree",s.updateTheme.bind(s)),s.$tree.on("search.jstree",function(e,t){0===t.nodes.length&&s.$tree.jstree("hide_all")}),s.$tree.on("dblclick.jstree",function(e){var t=s.$tree.jstree().get_selected()[0],t=s.$tree.jstree().get_node(t);!t||t.a_attr.id!==e.target.id&&t.a_attr.id!==e.target.parentNode.id||s.insertItem(t)}),s.$tree.on("select_node.jstree",function(e,t){var i,n,a,o;s.isInCodeMode||(i=t.selected[0],n=nicEditors.findEditor(s.INSTANCE_ID),a="",$(n.elm).focus(),o=n.getRng(),t=n.selElm()||n.elm,n.saveRng(),i&&(a=s.wrapInHandlebars(i),t.nodeValue?s.pendingContent=t.nodeValue.substring(0,o.startOffset)+a+t.nodeValue.substring(o.endOffset,t.nodeValue.length):s.pendingContent=a,s.editorField=t,s.editorRng=o))}),s.$tree.on("ready.jstree",function(){s.updateSidebar(s.options.text);var e=s.$tree.jstree("get_json");0<e.length&&s.$tree.jstree("open_node",e[0])})}),s.initHorizontalResize())),s.editor.instanceById(s.INSTANCE_ID).elm.addEventListener("input",function(e){s.disableTree||s.debouncedUpdateSidebar(e.target.innerText),s.debouncedCheckForErrors(e.target.innerHTML)}),s.initHandlebarHelperPicker()}}),s}var fontAwesome={"Web Application Icons":["adjust","anchor","archive","area-chart","arrows","arrows-h","arrows-v","asterisk","at","automobile","balance-scale","ban","bank","bar-chart","bar-chart-o","barcode","bars","battery-0","battery-1","battery-2","battery-3","battery-4","battery-empty","battery-full","battery-half","battery-quarter","battery-three-quarters","bed","beer","bell","bell-o","bell-slash","bell-slash-o","bicycle","binoculars","birthday-cake","bluetooth","bluetooth-b","bolt","bomb","book","bookmark","bookmark-o","briefcase","bug","building","building-o","bullhorn","bullseye","bus","cab","calculator","calendar","calendar-check-o","calendar-minus-o","calendar-o","calendar-plus-o","calendar-times-o","camera","camera-retro","car","caret-square-o-down","caret-square-o-left","caret-square-o-right","caret-square-o-up","cart-arrow-down","cart-plus","cc","certificate","check","check-circle","check-circle-o","check-square","check-square-o","child","circle","circle-o","circle-o-notch","circle-thin","clock-o","clone","close","cloud","cloud-download","cloud-upload","code","code-fork","coffee","cog","cogs","comment","comment-o","commenting","commenting-o","comments","comments-o","compass","copyright","creative-commons","credit-card","credit-card-alt","crop","crosshairs","cube","cubes","cutlery","dashboard","database","desktop","diamond","dot-circle-o","download","edit","ellipsis-h","ellipsis-v","envelope","envelope-o","envelope-square","eraser","exchange","exclamation","exclamation-circle","exclamation-triangle","external-link","external-link-square","eye","eye-slash","eyedropper","fax","feed","female","fighter-jet","file-archive-o","file-audio-o","file-code-o","file-excel-o","file-image-o","file-movie-o","file-pdf-o","file-photo-o","file-picture-o","file-powerpoint-o","file-sound-o","file-video-o","file-word-o","file-zip-o","film","filter","fire","fire-extinguisher","flag","flag-checkered","flag-o","flash","flask","folder","folder-o","folder-open","folder-open-o","frown-o","futbol-o","gamepad","gavel","gear","gears","gift","glass","globe","graduation-cap","group","hand-grab-o","hand-lizard-o","hand-paper-o","hand-peace-o","hand-pointer-o","hand-rock-o","hand-scissors-o","hand-spock-o","hand-stop-o","hashtag","hdd-o","headphones","heart","heart-o","heartbeat","history","home","hotel","hourglass","hourglass-1","hourglass-2","hourglass-3","hourglass-end","hourglass-half","hourglass-o","hourglass-start","i-cursor","image","inbox","industry","info","info-circle","institution","key","keyboard-o","language","laptop","leaf","legal","lemon-o","level-down","level-up","life-bouy","life-buoy","life-ring","life-saver","lightbulb-o","line-chart","location-arrow","lock","magic","magnet","mail-forward","mail-reply","mail-reply-all","male","map","map-marker","map-o","map-pin","map-signs","meh-o","microphone","microphone-slash","minus","minus-circle","minus-square","minus-square-o","mobile","mobile-phone","money","moon-o","mortar-board","motorcycle","mouse-pointer","music","navicon","newspaper-o","object-group","object-ungroup","paint-brush","paper-plane","paper-plane-o","paw","pencil","pencil-square","pencil-square-o","percent","phone","phone-square","photo","picture-o","pie-chart","plane","plug","plus","plus-circle","plus-square","plus-square-o","power-off","print","puzzle-piece","qrcode","question","question-circle","quote-left","quote-right","random","recycle","refresh","registered","remove","reorder","reply","reply-all","retweet","road","rocket","rss","rss-square","search","search-minus","search-plus","send","send-o","server","share","share-alt","share-alt-square","share-square","share-square-o","shield","ship","shopping-bag","shopping-basket","shopping-cart","sign-in","sign-out","signal","sitemap","sliders","smile-o","soccer-ball-o","sort","sort-alpha-asc","sort-alpha-desc","sort-amount-asc","sort-amount-desc","sort-asc","sort-desc","sort-down","sort-numeric-asc","sort-numeric-desc","sort-up","space-shuttle","spinner","spoon","square","square-o","star","star-half","star-half-empty","star-half-full","star-half-o","star-o","sticky-note","sticky-note-o","street-view","suitcase","sun-o","support","tablet","tachometer","tag","tags","tasks","taxi","television","terminal","thumb-tack","thumbs-down","thumbs-o-down","thumbs-o-up","thumbs-up","ticket","times","times-circle","times-circle-o","tint","toggle-down","toggle-left","toggle-off","toggle-on","toggle-right","toggle-up","trademark","trash","trash-o","tree","trophy","truck","tty","tv","umbrella","university","unlock","unlock-alt","unsorted","upload","user","user-plus","user-secret","user-times","users","video-camera","volume-down","volume-off","volume-up","warning","wheelchair","wifi","wrench"],"Hand Icons":["hand-grab-o","hand-lizard-o","hand-o-down","hand-o-left","hand-o-right","hand-o-up","hand-paper-o","hand-peace-o","hand-pointer-o","hand-rock-o","hand-scissors-o","hand-spock-o","hand-stop-o","thumbs-down","thumbs-o-down","thumbs-o-up","thumbs-up"],"Transportation Icons":["ambulance","automobile","bicycle","bus","cab","car","fighter-jet","motorcycle","plane","rocket","ship","space-shuttle","subway","taxi","train","truck","wheelchair"],"Gender Icons":["genderless","intersex","mars","mars-double","mars-stroke","mars-stroke-h","mars-stroke-v","mercury","neuter","transgender","transgender-alt","venus","venus-double","venus-mars"],"File Type Icons":["file","file-archive-o","file-audio-o","file-code-o","file-excel-o","file-image-o","file-movie-o","file-o","file-pdf-o","file-photo-o","file-picture-o","file-powerpoint-o","file-sound-o","file-text","file-text-o","file-video-o","file-word-o","file-zip-o"],"Spinner Icons":["info-circle","circle-o-notch","cog","gear","refresh","spinner"],"Form Control Icons":["check-square","check-square-o","circle","circle-o","dot-circle-o","minus-square","minus-square-o","plus-square","plus-square-o","square","square-o"],"Payment Icons":["cc-amex","cc-diners-club","cc-discover","cc-jcb","cc-mastercard","cc-paypal","cc-stripe","cc-visa","credit-card","credit-card-alt","google-wallet","paypal"],"Chart Icons":["area-chart","bar-chart","bar-chart-o","line-chart","pie-chart"],"Currency Icons":["bitcoin","btc","cny","dollar","eur","euro","gbp","gg","gg-circle","ils","inr","jpy","krw","money","rmb","rouble","rub","ruble","rupee","shekel","sheqel","try","turkish-lira","usd","won","yen"],"Text Editor Icons":["align-center","align-justify","align-left","align-right","bold","chain","chain-broken","clipboard","columns","copy","cut","dedent","eraser","file","file-o","file-text","file-text-o","files-o","floppy-o","font","header","indent","italic","link","list","list-alt","list-ol","list-ul","outdent","paperclip","paragraph","paste","repeat","rotate-left","rotate-right","save","scissors","strikethrough","subscript","superscript","table","text-height","text-width","th","th-large","th-list","underline","undo","unlink"],"Directional Icons":["angle-double-down","angle-double-left","angle-double-right","angle-double-up","angle-down","angle-left","angle-right","angle-up","arrow-circle-down","arrow-circle-left","arrow-circle-o-down","arrow-circle-o-left","arrow-circle-o-right","arrow-circle-o-up","arrow-circle-right","arrow-circle-up","arrow-down","arrow-left","arrow-right","arrow-up","arrows","arrows-alt","arrows-h","arrows-v","caret-down","caret-left","caret-right","caret-square-o-down","caret-square-o-left","caret-square-o-right","caret-square-o-up","caret-up","chevron-circle-down","chevron-circle-left","chevron-circle-right","chevron-circle-up","chevron-down","chevron-left","chevron-right","chevron-up","exchange","hand-o-down","hand-o-left","hand-o-right","hand-o-up","long-arrow-down","long-arrow-left","long-arrow-right","long-arrow-up","toggle-down","toggle-left","toggle-right","toggle-up"],"Video Player Icons":["arrows-alt","backward","compress","eject","expand","fast-backward","fast-forward","forward","pause","pause-circle","pause-circle-o","play","play-circle","play-circle-o","random","step-backward","step-forward","stop","stop-circle","stop-circle-o","youtube-play"],"Brand Icons":["warning","500px","adn","amazon","android","angellist","apple","behance","behance-square","bitbucket","bitbucket-square","bitcoin","black-tie","bluetooth","bluetooth-b","btc","buysellads","cc-amex","cc-diners-club","cc-discover","cc-jcb","cc-mastercard","cc-paypal","cc-stripe","cc-visa","chrome","codepen","codiepie","connectdevelop","contao","css3","dashcube","delicious","deviantart","digg","dribbble","dropbox","drupal","edge","empire","expeditedssl","facebook","facebook-f","facebook-official","facebook-square","firefox","flickr","fonticons","fort-awesome","forumbee","foursquare","ge","get-pocket","gg","gg-circle","git","git-square","github","github-alt","github-square","gittip","google","google-plus","google-plus-square","google-wallet","gratipay","hacker-news","houzz","html5","instagram","internet-explorer","ioxhost","joomla","jsfiddle","lastfm","lastfm-square","leanpub","linkedin","linkedin-square","linux","maxcdn","meanpath","medium","mixcloud","modx","odnoklassniki","odnoklassniki-square","opencart","openid","opera","optin-monster","pagelines","paypal","pied-piper","pied-piper-alt","pinterest","pinterest-p","pinterest-square","product-hunt","qq","ra","rebel","reddit","reddit-alien","reddit-square","renren","safari","scribd","sellsy","share-alt","share-alt-square","shirtsinbulk","simplybuilt","skyatlas","skype","slack","slideshare","soundcloud","spotify","stack-exchange","stack-overflow","steam","steam-square","stumbleupon","stumbleupon-circle","tencent-weibo","trello","tripadvisor","tumblr","tumblr-square","twitch","twitter","twitter-square","usb","viacoin","vimeo","vimeo-square","vine","vk","wechat","weibo","weixin","whatsapp","wikipedia-w","windows","wordpress","xing","xing-square","y-combinator","y-combinator-square","yahoo","yc","yc-square","yelp","youtube","youtube-play","youtube-square"],"Medical Icons":["ambulance","h-square","heart","heart-o","heartbeat","hospital-o","medkit","plus-square","stethoscope","user-md","wheelchair"]},googleFont={Action:["3d-rotation","accessibility","account-balance","account-balance-wallet","account-box","account-circle","add-shopping-cart","alarm","alarm-add","alarm-off","alarm-on","all-out","android","announcement","aspect-ratio","assessment","assignment","assignment-ind","assignment-late","assignment-return","assignment-returned","assignment-turned-in","autorenew","backup","book","bookmark","bookmark-border","bug-report","build","cached","camera-enhance","card-giftcard","card-membership","card-travel","change-history","check-circle","chrome-reader-mode","class","code","compare-arrows","copyright","credit-card","dashboard","date-range","delete","delete-forever","description","dns","done","done-all","donut-large","donut-small","eject","euro-symbol","event","event-seat","exit-to-app","explore","extension","face","favorite","favorite-border","feedback","find-in-page","find-replace","fingerprint","flight-land","flight-takeoff","flip-to-back","flip-to-front","g-translate","gavel","get-app","gif","grade","group-work","help","help-outline","highlight-off","history","home","hourglass-empty","hourglass-full","http","https","important-devices","info","info-outline","input","invert-colors","label","label-outline","language","launch","lightbulb-outline","line-style","line-weight","list","lock","lock-open","lock-outline","loyalty","markunread-mailbox","motorcycle","note-add","offline-pin","opacity","open-in-browser","open-in-new","open-with","pan-tool","pageview","payment","perm-camera-mic","perm-contact-calendar","perm-data-setting","perm-device-information","perm-identity","perm-media","perm-phone-msg","perm-scan-wifi","pets","picture-in-picture","play-for-work","polymer","power-settings-new","print","query-builder","question-answer","receipt","record-voice-over","redeem","reorder","report-problem","restore","restore-page","room","rounded-corner","rowing","schedule","search","settings","settings-applications","settings-backup-restore","settings-bluetooth","settings-brightness","settings-cell","settings-ethernet","settings-input-antenna","settings-input-component","settings-input-composite","settings-input-hdmi","settings-input-svideo","settings-overscan","settings-phone","settings-power","settings-remote","settings-voice","shop","shop-two","shopping-basket","shopping-cart","speaker-notes","spellcheck","stars","store","subject","supervisor-account","swap-horiz","swap-vert","swap-vertical-circle","system-update-alt","tab","tab-unselected","theaters","thumb-down","thumb-up","thumbs-up-down","toc","today","toll","touch-app","track-changes","translate","trending-down","trending-flat","trending-up","turned-in","turned-in-not","verified-user","view-agenda","view-array","view-carousel","view-column","view-day","view-headline","view-list","view-module","view-quilt","view-stream","view-week","visibility","visibility-off","work","youtube-searched-for","zoom-in","zoom-out"],Alert:["add-alert","error","error-outline","warning"],AV:["add-to-queue","airplay","album","art-track","av-timer","branding-watermark","call-to-action","closed-caption","equalizer","explicit","fast-forward","fast-rewind","featured-play-list","featured-video","fiber-dvr","fiber-manual-record","fiber-new","fiber-pin","fiber-smart-record","forward-10","forward-30","forward-5","games","hd","hearing","high-quality","library-add","library-books","library-music","loop","mic","mic-none","mic-off","movie","new-releases","not-interested","note","pause","pause-circle-filled","pause-circle-outline","play-arrow","play-circle-filled","play-circle-outline","playlist-add","queue","queue-music","radio","recent-actors","remove-from-queue","repeat","repeat-one","replay","replay-10","replay-30","replay-5","shuffle","skip-next","skip-previous","slow-motion-video","snooze","sort-by-alpha","stop","subscriptions","subtitles","surround-sound","video-call","video-label","video-library","videocam","videocam-off","volume-down","volume-mute","volume-off","volume-up","web"],Communication:["business","call","call-end","call-made","call-merge","call-missed","call-received","call-split","chat","chat-bubble","chat-bubble-outline","clear-all","comment","contact-mail","contact-phone","contacts","dialer-sip","dialpad","email","forum","import-export","invert-colors-off","live-help","location-off","location-on","message","no-sim","phone","phonelink-erase","phonelink-lock","phonelink-ring","phonelink-setup","portable-wifi-off","present-to-all","ring-volume","rss-feed","screen-share","speaker-phone","stay-current-landscape","stay-current-portrait","stay-primary-landscape","stay-primary-portrait","stop-screen-share","swap-calls","textsms","voicemail","vpn-key"],Content:["add","add-box","add-circle","add-circle-outline","archive","backspace","block","clear","content-copy","content-cut","content-paste","create","delete-sweep","drafts","filter-list","flag","font-download","forward","gesture","inbox","link","low-priority","mail","markunread","redo","remove","remove-circle","remove-circle-outline","reply","reply-all","report","save","select-all","send","sort","text-format","unarchive","undo","weekend"],Device:["access-alarm","access-alarms","access-time","add-alarm","airplanemode-active","airplanemode-inactive","battery-alert","battery-charging-full","battery-full","battery-std","battery-unknown","bluetooth","bluetooth-connected","bluetooth-disabled","bluetooth-searching","brightness-auto","brightness-high","brightness-low","brightness-medium","data-usage","developer-mode","devices","dvr","gps-fixed","gps-not-fixed","gps-off","graphic-eq","location-disabled","location-searching","network-cell","network-wifi","nfc","screen-lock-landscape","screen-lock-portrait","screen-lock-rotation","screen-rotation","sd-storage","settings-system-daydream","signal-cellular-4-bar","signal-cellular-connected-no-internet-4-bar","signal-cellular-no-sim","signal-cellular-null","signal-cellular-off","signal-wifi-4-bar","signal-wifi-4-bar-lock","signal-wifi-off","storage","usb","wallpaper","widgets","wifi-lock","wifi-tethering"],Editor:["attach-file","attach-money","border-all","border-bottom","border-clear","border-color","border-horizontal","border-inner","border-left","border-outer","border-right","border-style","border-top","border-vertical","bubble-chart","format-align-center","format-align-justify","format-align-left","format-align-right","format-bold","format-clear","format-color-fill","format-color-reset","format-color-text","format-indent-decrease","format-indent-increase","format-italic","format-line-spacing","format-list-bulleted","format-list-numbered","format-paint","format-quote","format-size","format-strikethrough","format-textdirection-l-to-r","format-textdirection-r-to-l","format-underlined","functions","insert-chart","insert-comment","insert-drive-file","insert-emoticon","insert-invitation","insert-link","insert-photo","linear_scale","merge-type","mode-comment","mode-edit","monetization-on","money-off","multiline-chart","pie-chart","pie-chart-outlined","publish","show-chart","space-bar","strikethrough-s","text-fields","title","vertical-align-bottom","vertical-align-center","vertical-align-top","wrap-text"],File:["attachment","cloud","cloud-circle","cloud-done","cloud-download","cloud-off","cloud-queue","cloud-upload","file-download","file-upload","folder","folder-open","folder-shared"],Hardware:["cast","cast-connected","computer","desktop-mac","desktop-windows","developer-board","device-hub","devices-other","dock","gamepad","headset","headset-mic","keyboard","keyboard-arrow-down","keyboard-arrow-left","keyboard-arrow-right","keyboard-arrow-up","keyboard-backspace","keyboard-capslock","keyboard-hide","keyboard-return","keyboard-tab","keyboard-voice","laptop","laptop-chromebook","laptop-mac","laptop-windows","memory","mouse","phone-android","phone-iphone","phonelink","phonelink-off","power-input","router","scanner","security","sim-card","smartphone","speaker","speaker-group","tablet","tablet-android","tablet-mac","toys","tv","videogame-asset","watch"],Image:["add-to-photos","adjust","assistant","assistant-photo","audiotrack","blur-circular","blur-linear","blur-off","blur-on","brightness-1","brightness-2","brightness-3","brightness-4","brightness-5","brightness-6","brightness-7","broken-image","brush","burst-mode","camera","camera-alt","camera-front","camera-rear","camera-roll","center-focus-strong","center-focus-weak","collections","collections-bookmark","color-lens","colorize","compare","control-point","control-point-duplicate","crop","crop-16-9","crop-3-2","crop-5-4","crop-7-5","crop-din","crop-free","crop-landscape","crop-original","crop-portrait","crop-square","dehaze","details","edit","exposure","exposure-neg-1","exposure-neg-2","exposure-plus-1","exposure-plus-2","exposure-zero","filter","filter-1","filter-2","filter-3","filter-4","filter-5","filter-6","filter-7","filter-8","filter-9","filter-9-plus","filter-b-and-w","filter-center-focus","filter-drama","filter-frames","filter-hdr","filter-none","filter-tilt-shift","filter-vintage","flare","flash-auto","flash-off","flash-on","flip","gradient","grain","grid-off","grid-on","hdr-off","hdr-on","hdr-strong","hdr-weak","healing","image","image-aspect-ratio","iso","landscape","leak-add","leak-remove","lens","linked-camera","looks","looks-3","looks-4","looks-5","looks-6","looks-one","looks-two","loupe","monochrome-photos","movie-creation","music-note","nature","nature-people","navigate-before","navigate-next","palette","panorama","panorama-fish-eye","panorama-horizontal","panorama-vertical","panorama-wide-angle","photo","photo-album","photo-camera","photo-library","photo-size-select-actual","photo-size-select-large","photo-size-select-small","picture-as-pdf","portrait","remove-red-eye","rotate-90-degrees-ccw","rotate-left","rotate-right","slideshow","straighten","style","switch-camera","switch-video","tag-faces","texture","timelapse","timer","timer-10","timer-3","timer-off","tonality","transform","tune","view-comfy","view-compact","vignette","wb-auto","wb-cloudy","wb-incandescent","wb-iridescent","wb-sunny"],Maps:["beenhere","directions","directions-bike","directions-boat","directions-bus","directions-car","directions-railway","directions-run","directions-subway","directions-transit","directions-walk","edit-location","ev-station","flight","hotel","layers","layers-clear","local-activity","local-airport","local-atm","local-bar","local-cafe","local-car-wash","local-convenience-store","local-dining","local-drink","local-florist","local-gas-station","local-grocery-store","local-hospital","local-hotel","local-laundry-service","local-library","local-mall","local-movies","local-offer","local-parking","local-pharmacy","local-phone","local-pizza","local-play","local-post-office","local-printshop","local-see","local-shipping","local-taxi","map","my-location","navigation","person-pin","pin-drop","place","rate-review","restaurant","restaurant-menu","satellite","store-mall-directory","streetview","subway","terrain","traffic","train","tram","transfer-within-a-station","zoom-out-map"],Navigation:["apps","arrow-back","arrow-drop-down","arrow-drop-down-circle","arrow-drop-up","arrow-forward","cancel","check","chevron-left","chevron-right","close","expand-less","expand-more","first-page","fullscreen","fullscreen-exit","last-page","menu","more-horiz","more-vert","refresh"],Notification:["adb","airline-seat-flat","airline-seat-flat-angled","airline-seat-individual-suite","airline-seat-legroom-extra","airline-seat-legroom-normal","airline-seat-legroom-reduced","airline-seat-recline-extra","airline-seat-recline-normal","bluetooth-audio","confirmation-number","disc-full","do-not-disturb","do-not-disturb-alt","do-not-disturb-off","do-not-disturb-on","drive-eta","event-available","event-busy","event-note","folder-special","live-tv","mms","more","network-locked","ondemand-video","personal-video","phone-bluetooth-speaker","phone-forwarded","phone-in-talk","phone-locked","phone-missed","phone-paused","power","priority-high","sd-card","sim-card-alert","sms","sms-failed","sync","sync-disabled","sync-problem","system-update","tap-and-play","time-to-leave","vibration","voice-chat","vpn-lock","wc","wifi"],Social:["cake","domain","group","group-add","location-city","mood","mood-bad","notifications","notifications-active","notifications-none","notifications-off","notifications-paused","pages","party-mode","people","people-outline","person","person-add","person-outline","plus-one","poll","public","school","sentiment-dissatisfied","sentiment-neutral","sentiment-satisfied","sentiment-very-dissatisfied","share","whatshot"],Toggle:["check-box","check-box-outline-blank","indeterminate-check-box","radio-button-checked","radio-button-unchecked","star","star-border","star-half"]},IconDropDownDialog=Backbone.View.extend({className:"icon-dialog",initialize:function(e){var s=this;s.options=e,s.path=void 0,s.search="",s.animationTimeElapsed=0,s.columns=6,s.minimumWidgetSize={w:170,h:40},s.isFAOnly=e.isFAOnly,s.panelInfos=[],s.debouncedLayout=_.debounce(s.updateLayout,100),s.debouncedAnimLayout=_.debounce(function(){s.updateLayout(!0)},170),s.throttleLayout=_.throttle(s.updateLayout,100),s.ANIMATION_TIME=300,s.renderFrameCounter=0,s.$el.dialog(_.extend({appendTo:e.container,dialogClass:"quick-dash dd-Panel",title:t("Please select an image ..."),resizable:!0,height:600,width:950,minWidth:400,modal:!0,autoOpen:!0,close:function(){_.isFunction(s.options.closing)&&s.options.closing(),s.remove()},open:function(){$('<i class="fa fa-image" />').insertBefore(s.$el.parent().find(".ui-dialog-title")),s.$el.html(T.IconDialog()),s.$grid=s.$el.find(".grid"),s.$searchInput=s.$el.find(".search input");var a={row:0,column:0,position:null,size:null,targetPosition:null,targetSize:null,visible:!0},e="Web Application Icons",t=_.clone(fontAwesome);t[e]=_.clone(t[e]),t[e].splice(0,0,"blank");var t=[t],o=[{type:"fa",subtype:"fa-fw"}];s.isFAOnly||(t.push(googleFont),o.push({type:"mi",subtype:""})),_.each(t,function(e,n){_.each(e,function(e,t){var i=_.extend({heading:!0,$el:$("<h3>"+t+"</h3>")},a);s.panelInfos.push(i),s.$grid.append(i.$el),_.each(e,function(e){i=_.extend({icon:e,$el:$(T.IconDialogItem(_.extend({icon:e},o[n])))},a),s.panelInfos.push(i),s.$grid.append(i.$el)})})}),s.$el.find(".grid > a").on("click",function(e){var t=s.options.selectCallback;t&&t("fa-blank"==(e=$(e.target||e.toElement).find("i").attr("class").split(" ").pop())?"":e),s.$el.dialog("close")}),s.$searchInput.on("input",function(){s.search=$(this).val(),s.debouncedAnimLayout()}),s.updateLayout(!1),_.defer(function(){s.$searchInput.focus()})},resize:function(){s.debouncedLayout(!1)}},e))},onCancelButtonClick:function(){this.$el.dialog("close")},onSelectButtonClick:function(){this.options.model.tooltips=this.result,this.options.editor.setValue(this.options.model),this.onCancelButtonClick()},remove:function(){_.each(this.panelInfos,function(e){e.$el.off(),e.$el.remove(),e.$el=null}),this.panelInfos=[],Backbone.View.prototype.remove.call(this)},renderFrame:function(){var n,e=new Date,t=e-this.lastFrame,i=this;this.lastFrame=e,this.animationTimeElapsed+=t,this.renderFrameCounter+=1,this.animationTimeElapsed>=this.ANIMATION_TIME?(1<this.renderFrameCounter&&console.log("FPS: "+this.renderFrameCounter/this.ANIMATION_TIME*1e3),this.renderFrameCounter=0,_.each(i.panelInfos,function(e){e!==this.draggingPanelInfo&&(e.$el.css({top:e.targetY+"px",left:e.targetX.toFixed(3)+"%"}),e.X=e.targetX,e.Y=e.targetY)})):(n=this.animationTimeElapsed/this.ANIMATION_TIME,_.each(i.panelInfos,function(e){var t,i;e!==this.draggingPanelInfo&&(t=e.X+(e.targetX-e.X)*n,i=e.Y+(e.targetY-e.Y)*n,e.$el.css({top:i+"px",left:t.toFixed(3)+"%"}))}),window.requestAnimationFrame(function(){i.renderFrame()}))},setRowsAndColumns:function(){var e,t,i,n=0;if(0!==this.panelInfos.length)for(this.columns=Math.max(1,Math.floor(this.$grid.width()/this.minimumWidgetSize.w)),this.rows=Math.ceil(this.panelInfos.length/this.columns),i=0;;i+=1){for(e=0;e<this.columns&&n!==this.panelInfos.length;e+=1)if((t=this.panelInfos[n]).visible=""===this.search||t.icon&&0<=t.icon.indexOf(this.search),t.visible){if(t.heading&&0!==e&&(e=0,i+=1),t.column=e,t.row=i,n+=1,t.heading)break}else--e,n+=1;if(n===this.panelInfos.length)break}},updateLayout:function(e){var t=this,i=e?{"transition-property":"top, left","transition-duration":"0.3s"}:{"transition-property":"none"};t.setRowsAndColumns(),_.each(t.panelInfos,function(e){e.$el.css(_.extend({top:e.row*t.minimumWidgetSize.h+"px",left:(e.column*(100/t.columns)).toFixed(3)+"%",width:e.heading?"99%":(100/t.columns).toFixed(3)+"%",display:e.visible?"block":"none"},i))})}}),JsonDialog=(c5a=Backbone.View,__extends(d5a,c5a),d5a.prototype.disposeEditor=function(){this.editor&&(this.editor.dispose(),this.editor=null),this.editorModel&&(this.editorModel.dispose(),this.editorModel=null),this.jsonDefaults&&this.defaultDiagnostics&&(this.jsonDefaults.setDiagnosticsOptions(this.defaultDiagnostics),this.jsonDefaults=null,this.defaultDiagnostics=null)},d5a.prototype.initEditor=function(){var a=this;MonacoHelpers.require({language:"json"},function(e){var t=e.monaco,i=(e.docs,e.disposable,"internal://server/"+_.uniqueId("jsonModelURI")),n=t.Uri.parse(i),e=a.options.value;a.editorModel=t.editor.createModel(e,"json",n);n=_.result(a.options.editorOptions,"jsonSchema");n&&(a.jsonDefaults=t.languages.json.jsonDefaults,a.defaultDiagnostics=a.jsonDefaults.diagnosticsOptions,t.languages.json.jsonDefaults.setDiagnosticsOptions({validate:!0,schemas:[{fileMatch:[i],schema:n}]})),a.editor=t.editor.create(a.$el.find(".json-editor")[0],_.assign({},MonacoHelpers.DEFAULT_OPTIONS(),{model:a.editorModel}))})},d5a.prototype.onApplyButtonClick=function(){var e=this.editor.getValue();this.options.applyCallback&&this.options.applyCallback(e)},d5a.prototype.remove=function(){return this.disposeEditor(),Backbone.View.prototype.remove.call(this)},d5a),c5a;function d5a(e){var t=c5a.call(this,_.extend({},e,{className:"json-dialog"}))||this;return t.DIALOG_HEIGHT=540,t.options=e,t.$el.html(T.JsonDialog({})),t.$dialog=t.$el.dialog({appendTo:t.options.container,closeOnEscape:!0,title:"Json Editor",resizable:!0,height:t.DIALOG_HEIGHT,width:800,minWidth:710,modal:!0,autoOpen:!0,buttons:[{text:"Apply",click:t.onApplyButtonClick.bind(t),icons:{primary:"fa fa-check"}},{text:"Close",click:function(){t.$el.dialog("close")},icons:{primary:"fa fa-times"}}],close:function(){t.remove()},open:function(){t.$el.parent().find(".ui-dialog-title").before('<i class="fa fa-code" />').append($("<span>",{style:"font-weight:normal; padding-left:2em",text:"hit CTRL + SPACE to activate IntelliSense"})),t.initEditor()}}),t}var RichTextEditorDialog=Backbone.View.extend({DIALOG_HEIGHT:540,INSTANCE_ID:"ffsEdit",appModel:null,className:"rich-text-editor-dialog",dataView:null,propertiesView:null,isInCodeMode:!1,initialize:function(e){var i=this;i.options=e,i.$el.html(T.RichTextEditorDialog({uid:i.INSTANCE_ID,background:e.background})),i.$editor=i.$el.find(".editor"),i.$code=i.$el.find(".code"),$.ui.dialog.prototype._focusTabbable=$.noop,i.$dialog=i.$el.dialog({appendTo:e.container,dialogClass:"rich-text-dialog",title:t("Text Editor"),resizable:!0,height:i.DIALOG_HEIGHT,width:800,minWidth:710,modal:!0,autoOpen:!0,buttons:[{text:t("Apply"),click:$.proxy(i.onApplyButtonClick,i),icons:{primary:"fa fa-check"}},{text:t("Close"),click:function(){i.$el.dialog("close")},icons:{primary:"fa fa-times"}}],close:function(){i.remove()},open:function(){$('<i class="fa fa-font" />').insertBefore(i.$el.parent().find(".ui-dialog-title")),i.editor=new nicEditor({onBeautify:function(){i.isInCodeMode&&i.codeEditor.getAction("editor.action.formatDocument").run()},onCode:function(){var e;i.$editor.toggle(),i.$code.toggle(),i.isInCodeMode=!i.isInCodeMode,i.isInCodeMode?i.initCodeEditor():(e=i.codeEditor.getValue(),i.options.allowUnsafeContent||(e=DOMPurify.sanitize(e,{ADD_ATTR:["target"]})),i.editor.instanceById(i.INSTANCE_ID).setContent(e))}}),i.editor.setPanel("htmlxEdit"),i.editor.addInstance(i.INSTANCE_ID),i.editor.instanceById(i.INSTANCE_ID).setContent(i.options.text),$(i.editor.instanceById(i.INSTANCE_ID).elm).focus()}})},initCodeEditor:function(){var i=this;MonacoHelpers.require({language:"html"},function(e){var t=e.monaco,e=i.$el.find(".code")[0];i.codeEditor||(i.codeEditor=t.editor.create(e,{language:"html",automaticLayout:!0,theme:"kx-light"!==$.cookie("dashboard-theme")?"vs-dark":"vs",contextmenu:!1,fixedOverflowWidgets:!0,fontSize:12,minimap:{enabled:!1},scrollBeyondLastLine:!1,wordWrap:"on",dragAndDrop:!1})),i.codeEditor.getAction("editor.action.formatDocument").run(),i.codeEditor.setValue(i.editor.instanceById(i.INSTANCE_ID).getContent())})},onApplyButtonClick:function(){var e=this.isInCodeMode?this.codeEditor.getValue():this.editor.instanceById(this.INSTANCE_ID).getContent();this.options.allowUnsafeContent||(e=DOMPurify.sanitize(e,{ADD_ATTR:["target"]})),this.options.applyCallback&&this.options.applyCallback(e),this.$dialog.dialog("close")},remove:function(){this.editor&&(this.editor.removeInstance(this.INSTANCE_ID),this.editor=null),this.codeEditor&&(this.codeEditor=null),Backbone.View.prototype.remove.call(this)}}),PropertiesPanelApi=(y5a=CustomEvents,__extends(z5a,y5a),z5a.prototype.sanitizeTemplate=function(e){var t=["target"],i="dashreplace-",n=["style","table","thead","tbody","tfoot","tr","th","td","comment"];if(this.componentModel&&!0===this.componentModel.get("Basics.AllowUnsafeContent"))return e;s=e;var a,o,s,e=/(\<.*\[START\].*--\>.*[\s\S]*).*(\<.*\[END\]--\>)/g.exec(s);e&&(a=e[1],o=e[2],s=(s=s.replace(e[1],"<comment>")).replace(e[2],"</comment>")),_.each(n,function(e){e=new RegExp("(</?)("+e+")(/>)?","g");s=s.replace(e,"$1"+i+"$2$3")});var r=/".*?"/g,l=/{{.+?}}/g,c=/(dashreplace[0-9]+=)?{{.+?}}/g,d="dashreplace",p=0;s=s.replace(/<.+?>/g,function(e){return e.replace(r,function(e){return e.replace(l,function(e){return d+p+++"="+e})}).replace(c,function(e,t){return t?e:d+p+++'="'+e+'"'})});var t=t.concat(_.times(p,function(e){return d+e})),e=function(e){return DOMPurify.sanitize(e,{ADD_TAGS:_.map(n,function(e){return i+e}),ADD_ATTR:t})},u=e(e(s));return _.each(n,function(e){e=new RegExp("(</?)"+i+"("+e+")(/>)?","g");u=u.replace(e,"$1$2$3")}),u=(u=a&&o?(u=u.replace("<comment>",a)).replace("</comment>",o):u).replace(/(dashreplace[0-9]+=)"({{.+?}})"/g,function(e,t,i){return i}).replace(/(dashreplace[0-9]+=)({{.+?}})/g,function(e,t,i){return i})},z5a.prototype.getParameter=function(e){return"model"===e?this.appModel.get("documents").get(this.viewModel.get("selectedDocumentId")):this[e]},z5a.prototype.getWidget=function(){return this.widgetModel},z5a.prototype.setWidget=function(e){this.widgetModel=e,this.componentModel=e.get("component").get("options")},z5a.prototype.setDocument=function(e){e&&(this.docViewModel=e.get("viewState"),this.docDataModel=e.get("data"))},z5a.prototype.showBulkColumnEditor=function(e){this.dlgBulkColumnEditor=this.dlgBulkColumnEditor||new BulkColumnEditorDialog({container:this.dialogContainer}),this.dlgBulkColumnEditor.setEditor(e),this.dlgBulkColumnEditor.open()},z5a.prototype.showColorPickerDialog=function(t,i){new ColorPickerDialog({container:this.dialogContainer,values:t.getAttribute("gradient"),noColor:t.getAttribute("noColor"),target:t,editor:i,path:$(t).val(),selected:t.value,selectCallback:function(e){$(t).val()===e||(i.value=e,i.onInput(e.slice()),$(t).val(e))}})},z5a.prototype.showColSelectorDialog=function(e,t,i,n,a){new ColSelectorDialog({container:this.dialogContainer,values:e||[],target:i,isUserDefined:!!n,selected:t,selectCallback:a})},z5a.prototype.showCssDialog=function(e,t){this.cssDialog&&(this.cssDialog.remove(),this.cssDialog=null),this.cssDialog=new CssDialog({applyCallback:t,container:this.dialogContainer,viewModel:this.viewModel,styles:e}),this.listenTo(this.cssDialog,"startInspecting",function(){this.trigger("startInspecting")}),this.listenTo(this.cssDialog,"stopInspecting",function(){this.trigger("stopInspecting")})},z5a.prototype.showDataConnectionDialog=function(e,t){new DataConnectionDialog({appModel:this.appModel,docViewModel:this.docViewModel,container:this.dialogContainer,path:e,selectCallback:t})},z5a.prototype.showDataDialog=function(e,t,i){this.docDataModel=this.docDataModel||this.appModel.get("documents").get(this.viewModel.get("selectedDocumentId")).get("data"),this.docDataModel.cid!==this.appModel.get("documents").get(this.viewModel.get("selectedDocumentId")).get("data").cid&&(this.docDataModel=this.appModel.get("documents").get(this.viewModel.get("selectedDocumentId")).get("data")),new DataDialog({appModel:this.appModel,dialogContainer:this.dialogContainer,docViewModel:this.docViewModel,model:this.docDataModel,initialTab:i,path:e,isTableEditProperties:!1,selectCallback:t})},z5a.prototype.showTemplateDialog=function(e,t,i,n){var a=this;this.htmlDialog&&(this.htmlDialog.remove(),this.htmlDialog=null);var o=[],s="possibleColumns";this.componentModel&&!e.disableTree?("string"==typeof e.columnsFieldName?s=e.columnsFieldName:e.columnsFieldName instanceof Array&&_.each(e.columnsFieldName,function(e){o=_.union(o,a.componentModel.get(e))}),this.componentModel.get(s)?o=this.componentModel.get(s):"ChartJS"===this.componentModel.parent.get("key")&&_.each(this.componentModel.get("Layers"),function(e){o=_.union(o,e.Basics.Data.dataSet.columns.models.map(function(e){return e.get("id")}))}),"ChartGL"===this.componentModel.parent.get("key")&&_.each(this.componentModel.get("Layers"),function(e){o=_.without(_.union(o,e.possibleColorColumns),"None")}),o=_.filter(o,function(e){return!_.isEmpty(e)}),e.templateItems&&("ChartGL"===this.componentModel.parent.get("key")||"ChartJS"===this.componentModel.parent.get("key")||"PieJS"===this.componentModel.parent.get("key")||"Chart3D"===this.componentModel.parent.get("key")?_.each(e.templateItems,function(e){var t="cols";"ChartGL"===a.componentModel.parent.get("key")&&(t="data"),e.items[t]=_.keyBy(o)}):"Datagrid"!==this.componentModel.parent.get("key")&&"Datatable"!==this.componentModel.parent.get("key")||_.each(e.templateItems,function(e){_.extend(e.items,_.keyBy(o))}),o=[])):e.disableTree&&(o=[],delete e.templateItems);var r=this.componentModel?this.componentModel.get("format").tileTransparentBackground?"transparent":this.componentModel.get("format").tileBackgroundColor:"#ffffff",s=this.componentModel&&!0===this.componentModel.get("Basics.AllowUnsafeContent");this.htmlDialog=new TemplateDialog({docViewModel:this.docViewModel,container:this.dialogContainer,keys:o,valueData:e.templateItems,disableTree:e.disableTree,text:t,background:r,allowUnsafeContent:s,sanitizeTemplate:this.sanitizeTemplate.bind(this),applyCallback:n})},z5a.prototype.showHtmlDialog=function(e){this.htmlDialog&&(this.htmlDialog.remove(),this.htmlDialog=null),this.htmlDialog=new RichTextEditorDialog({container:this.dialogContainer,text:this.componentModel.get("Basics").HtmlText,background:this.componentModel.get("format").tileTransparentBackground?"transparent":this.componentModel.get("format").tileBackgroundColor,allowUnsafeContent:!0===this.componentModel.get("Basics.AllowUnsafeContent"),applyCallback:e})},z5a.prototype.showIconDropDownDialog=function(e,t){var i=this;this.iconDialogLoading||(this.iconDialogLoading=!0,new IconDropDownDialog({container:this.dialogContainer,isFAOnly:e,selectCallback:t,closing:function(){return i.iconDialogLoading=!1}}))},z5a.prototype.showJsonDialog=function(e,t,i){new JsonDialog({editorOptions:e.schema.options,container:this.dialogContainer,value:t,applyCallback:i})},z5a.prototype.showPopupEditor=function(e){this.trigger("showPopupEditor",e)},z5a.prototype.showViewStateDialog=function(i,n){var a=this;new ViewStateDialog({dialogContainer:this.dialogContainer,docDataModel:this.docDataModel,model:this.docViewModel,path:i,selectCallback:function(e){var t;e!==i&&(t=a.docViewModel.getByPath(e))&&_.isFunction(n)&&n(t)}})},z5a),y5a;function z5a(e){var t=y5a.call(this)||this;return t.appModel=e.appModel,t.dialogContainer=e.dialogContainer,t.docDataModel=e.docDataModel,t.docViewModel=e.docViewModel,t.viewModel=e.viewModel,t}var CopyPasteHelpers=(hga.getComponentViewStates=function(e){var i=[],n=function(t){t&&(t instanceof QuickBase.Component?(t.get("components").each(function(e){n(e)}),t.get("widgets").each(function(e){n(e.get("component"))}),n(t.get("options"))):_.isArray(t)?_.each(t,function(e){n(e)}):t.attributes?t.path?t.get("_dataSource")||_.includes(i,t.path)||(i.push(t.path),"dict"===t.get("_type")&&_.each(t.get("_default"),function(e){e instanceof QuickBase.DocumentViewModel&&i.push(e.path)})):n(t.attributes):!_.isObject(t)||t instanceof Backbone.View||("viewstate"===t._dashboardsType?_.includes(i,t.value)||i.push(t.value):_.each(_.keys(t),function(e){n(t[e])})))};return n(e),i},hga.mergeViewStates=function(e,o){var s;e&&o&&(_.each(e,function(e,t){if(!o.get("viewState").getByPath(t)){var i=t.split("/"),n=null;if(i.length<=1)s=i[0],n=new QuickBase.DocumentViewModel(e,null);else{for(var n=o.get("viewState"),a=0;a<i.length-1;a+=1)n.set(i[a],n.get(i[a])||new QuickBase.DocumentViewModel(null,null)),n=n.get(i[a]),s=0===a?i[a]:i.slice(0,a).join("/"),n.path=s;s=i.join("/"),e=new QuickBase.DocumentViewModel(e,null),n.set(i[i.length-1],e),e.path=s}o.get("viewState").getByPath(s)||(n.path=s,o.get("viewState").set(s,n))}}),o.get("viewState").postInitialize())},hga.getMappingDataSources=function(i,e){var n=[];return e.get("data").getTreeList().forEach(function(t){t.get("_mappings")&&_.each(t.get("_mappings").mappings,function(e){_.includes(i,e.value)&&(n[t.path]=t.toJSON())})}),n},hga.mergeDataSources=function(e,r){var l,r=r;e&&(l=r.get("data"),_.each(e,function(e,t){for(var i,n=_.filter(t.split("/"),function(e){return e&&0<e.length}),a=l,o="",s=0;s<n.length;s+=1)o+=0===s?"":"/",o+=n[s],i=new QuickBase.DocumentDataModel(s!==n.length-1?{}:e,l,o,r.get("viewState"),s!==n.length-1),a=r.get("data").getByPath(o)?r.get("data").getByPath(o):(a.set(n[s],i),i.viewState=r.attributes.viewState,i)}))},hga.getComponentDataSources=function(e,i,n){var a,o={},s={},r=function(e){return e._cpKey||(_.isObject(e)||_.isArray(e))&&(Object.defineProperty(e,"_cpKey",{enumerable:!1,writable:!0}),e._cpKey=_.uniqueId("_cpKey_")),e._cpKey||null},l=function(t){t&&((a=r(t))&&s[a]||(a&&(s[a]=!0),_.isArray(t)?_.each(t,function(e){l(e)}):t.attributes?(t.attributes._dataType&&_.includes(["analytic","pivot","query","virtual","builder"],t.attributes._dataType)&&(_.each(t.getViewStateDict(),function(e){_.includes(i,e.path)||(i.push(e.path),"dict"===e.get("_type")&&_.each(e.get("_default"),function(e){e instanceof QuickBase.DocumentViewModel&&i.push(e.path)}))}),"virtual"===t.attributes._dataType&&_.each(t.get("_virtualParams"),function(e){var t;"datasource"===e.type&&(t=n.get("data").getByPath(e.value))&&(_.each(t.getViewStateDict(),function(e){_.includes(i,e.path)||i.push(e.path)}),o[e.value]=t.toJSON())}),o[t.path]=t.toJSON()),l(t.attributes)):!_.isObject(t)||t instanceof Backbone.View||("data"===t._dashboardsType?o[t.value]||l(n.get("data").getByPath(t.value)):_.each(_.keys(t),function(e){l(t[e])}))))};return l(e),o},hga);function hga(e){}!function(b){"use strict";var s=0,e='<div class="ui-colorpicker ui-colorpicker-dialog ui-dialog ui-widget ui-widget-content ui-corner-all" style="display: none;"></div>',t='<div class="ui-colorpicker ui-colorpicker-inline ui-dialog ui-widget ui-widget-content ui-corner-all"></div>',i='<div class="ui-colorpicker ui-colorpicker-inline"></div>',r=function(e){var t=Math.round(e).toString(16);if(t.length===1)t="0"+t;return t.toLowerCase()},o=function(e){var t,i;i=/^#?([a-fA-F0-9]{1,6})$/.exec(e);if(i){t=parseInt(i[1],16);return new b.colorpicker.Color((t>>16&255)/255,(t>>8&255)/255,(t&255)/255)}return new b.colorpicker.Color},l=function(e,t){var i,n,a,o,s,r,l,c,d,p,u,h,g,m;e.sort(function(e,t){if(e.pos[1]===t.pos[1])return e.pos[0]-t.pos[0];return e.pos[1]-t.pos[1]});o=0;s=0;b.each(e,function(e,t){o=Math.max(o,t.pos[0]+t.pos[2]);s=Math.max(s,t.pos[1]+t.pos[3])});i=[];for(n=0;n<o;++n)i.push([]);l=[];r=[];b.each(e,function(e,t){for(n=0;n<t.pos[2];n+=1)r[t.pos[0]+n]=true;for(a=0;a<t.pos[3];a+=1)l[t.pos[1]+a]=true});p="";d=e[c=0];for(a=0;a<s;++a){p+="<tr>";n=0;while(n<o)if(typeof d!=="undefined"&&n===d.pos[0]&&a===d.pos[1]){p+=t(d,n,a);for(h=0;h<d.pos[3];h+=1)for(u=0;u<d.pos[2];u+=1)i[n+u][a+h]=true;n+=d.pos[2];d=e[++c]}else{g=0;m=false;while(n<o&&i[n][a]===undefined&&(d===undefined||a<d.pos[1]||a===d.pos[1]&&n<d.pos[0])){if(r[n]===true)g+=1;m=true;n+=1}if(g>0)p+='<td colspan="'+g+'"></td>';else if(!m)n+=1}p+="</tr>"}return'<table cellspacing="0" cellpadding="0" border="0"><tbody>'+p+"</tbody></table>"};b.colorpicker=new function(){this.regional={"":{ok:"OK",cancel:"Cancel",none:"None",button:"Color",title:"Pick a color",transparent:"Transparent",hsvH:"H",hsvS:"S",hsvV:"V",rgbR:"R",rgbG:"G",rgbB:"B",labL:"L",labA:"a",labB:"b",hslH:"H",hslS:"S",hslL:"L",cmykC:"C",cmykM:"M",cmykY:"Y",cmykK:"K",alphaA:"A"}};this.swatchesNames={html:"HTML"};this.swatches={html:[{name:"black",r:0,g:0,b:0},{name:"dimgray",r:.4117647058823529,g:.4117647058823529,b:.4117647058823529},{name:"gray",r:.5019607843137255,g:.5019607843137255,b:.5019607843137255},{name:"darkgray",r:.6627450980392157,g:.6627450980392157,b:.6627450980392157},{name:"silver",r:.7529411764705882,g:.7529411764705882,b:.7529411764705882},{name:"lightgrey",r:.8274509803921568,g:.8274509803921568,b:.8274509803921568},{name:"gainsboro",r:.8627450980392157,g:.8627450980392157,b:.8627450980392157},{name:"whitesmoke",r:.9607843137254902,g:.9607843137254902,b:.9607843137254902},{name:"white",r:1,g:1,b:1},{name:"rosybrown",r:.7372549019607844,g:.5607843137254902,b:.5607843137254902},{name:"indianred",r:.803921568627451,g:.3607843137254902,b:.3607843137254902},{name:"brown",r:.6470588235294118,g:.16470588235294117,b:.16470588235294117},{name:"firebrick",r:.6980392156862745,g:.13333333333333333,b:.13333333333333333},{name:"lightcoral",r:.9411764705882353,g:.5019607843137255,b:.5019607843137255},{name:"maroon",r:.5019607843137255,g:0,b:0},{name:"darkred",r:.5450980392156862,g:0,b:0},{name:"red",r:1,g:0,b:0},{name:"snow",r:1,g:.9803921568627451,b:.9803921568627451},{name:"salmon",r:.9803921568627451,g:.5019607843137255,b:.4470588235294118},{name:"mistyrose",r:1,g:.8941176470588236,b:.8823529411764706},{name:"tomato",r:1,g:.38823529411764707,b:.2784313725490196},{name:"darksalmon",r:.9137254901960784,g:.5882352941176471,b:.47843137254901963},{name:"orangered",r:1,g:.27058823529411763,b:0},{name:"coral",r:1,g:.4980392156862745,b:.3137254901960784},{name:"lightsalmon",r:1,g:.6274509803921569,b:.47843137254901963},{name:"sienna",r:.6274509803921569,g:.3215686274509804,b:.17647058823529413},{name:"seashell",r:1,g:.9607843137254902,b:.9333333333333333},{name:"chocolate",r:.8235294117647058,g:.4117647058823529,b:.11764705882352941},{name:"saddlebrown",r:.5450980392156862,g:.27058823529411763,b:.07450980392156863},{name:"sandybrown",r:.9568627450980393,g:.6431372549019608,b:.3764705882352941},{name:"peachpuff",r:1,g:.8549019607843137,b:.7254901960784313},{name:"peru",r:.803921568627451,g:.5215686274509804,b:.24705882352941178},{name:"linen",r:.9803921568627451,g:.9411764705882353,b:.9019607843137255},{name:"darkorange",r:1,g:.5490196078431373,b:0},{name:"bisque",r:1,g:.8941176470588236,b:.7686274509803922},{name:"burlywood",r:.8705882352941177,g:.7215686274509804,b:.5294117647058824},{name:"tan",r:.8235294117647058,g:.7058823529411765,b:.5490196078431373},{name:"antiquewhite",r:.9803921568627451,g:.9215686274509803,b:.8431372549019608},{name:"navajowhite",r:1,g:.8705882352941177,b:.6784313725490196},{name:"blanchedalmond",r:1,g:.9215686274509803,b:.803921568627451},{name:"papayawhip",r:1,g:.9372549019607843,b:.8352941176470589},{name:"orange",r:1,g:.6470588235294118,b:0},{name:"moccasin",r:1,g:.8941176470588236,b:.7098039215686275},{name:"wheat",r:.9607843137254902,g:.8705882352941177,b:.7019607843137254},{name:"oldlace",r:.9921568627450981,g:.9607843137254902,b:.9019607843137255},{name:"floralwhite",r:1,g:.9803921568627451,b:.9411764705882353},{name:"goldenrod",r:.8549019607843137,g:.6470588235294118,b:.12549019607843137},{name:"darkgoldenrod",r:.7215686274509804,g:.5254901960784314,b:.043137254901960784},{name:"cornsilk",r:1,g:.9725490196078431,b:.8627450980392157},{name:"gold",r:1,g:.8431372549019608,b:0},{name:"palegoldenrod",r:.9333333333333333,g:.9098039215686274,b:.6666666666666666},{name:"khaki",r:.9411764705882353,g:.9019607843137255,b:.5490196078431373},{name:"lemonchiffon",r:1,g:.9803921568627451,b:.803921568627451},{name:"darkkhaki",r:.7411764705882353,g:.7176470588235294,b:.4196078431372549},{name:"beige",r:.9607843137254902,g:.9607843137254902,b:.8627450980392157},{name:"lightgoldenrodyellow",r:.9803921568627451,g:.9803921568627451,b:.8235294117647058},{name:"olive",r:.5019607843137255,g:.5019607843137255,b:0},{name:"yellow",r:1,g:1,b:0},{name:"lightyellow",r:1,g:1,b:.8784313725490196},{name:"ivory",r:1,g:1,b:.9411764705882353},{name:"olivedrab",r:.4196078431372549,g:.5568627450980392,b:.13725490196078433},{name:"yellowgreen",r:.6039215686274509,g:.803921568627451,b:.19607843137254902},{name:"darkolivegreen",r:.3333333333333333,g:.4196078431372549,b:.1843137254901961},{name:"greenyellow",r:.6784313725490196,g:1,b:.1843137254901961},{name:"lawngreen",r:.48627450980392156,g:.9882352941176471,b:0},{name:"chartreuse",r:.4980392156862745,g:1,b:0},{name:"darkseagreen",r:.5607843137254902,g:.7372549019607844,b:.5607843137254902},{name:"forestgreen",r:.13333333333333333,g:.5450980392156862,b:.13333333333333333},{name:"limegreen",r:.19607843137254902,g:.803921568627451,b:.19607843137254902},{name:"lightgreen",r:.5647058823529412,g:.9333333333333333,b:.5647058823529412},{name:"palegreen",r:.596078431372549,g:.984313725490196,b:.596078431372549},{name:"darkgreen",r:0,g:.39215686274509803,b:0},{name:"green",r:0,g:.5019607843137255,b:0},{name:"lime",r:0,g:1,b:0},{name:"honeydew",r:.9411764705882353,g:1,b:.9411764705882353},{name:"mediumseagreen",r:.23529411764705882,g:.7019607843137254,b:.44313725490196076},{name:"seagreen",r:.1803921568627451,g:.5450980392156862,b:.3411764705882353},{name:"springgreen",r:0,g:1,b:.4980392156862745},{name:"mintcream",r:.9607843137254902,g:1,b:.9803921568627451},{name:"mediumspringgreen",r:0,g:.9803921568627451,b:.6039215686274509},{name:"mediumaquamarine",r:.4,g:.803921568627451,b:.6666666666666666},{name:"aquamarine",r:.4980392156862745,g:1,b:.8313725490196079},{name:"turquoise",r:.25098039215686274,g:.8784313725490196,b:.8156862745098039},{name:"lightseagreen",r:.12549019607843137,g:.6980392156862745,b:.6666666666666666},{name:"mediumturquoise",r:.2823529411764706,g:.8196078431372549,b:.8},{name:"darkslategray",r:.1843137254901961,g:.30980392156862746,b:.30980392156862746},{name:"paleturquoise",r:.6862745098039216,g:.9333333333333333,b:.9333333333333333},{name:"teal",r:0,g:.5019607843137255,b:.5019607843137255},{name:"darkcyan",r:0,g:.5450980392156862,b:.5450980392156862},{name:"darkturquoise",r:0,g:.807843137254902,b:.8196078431372549},{name:"aqua",r:0,g:1,b:1},{name:"cyan",r:0,g:1,b:1},{name:"lightcyan",r:.8784313725490196,g:1,b:1},{name:"azure",r:.9411764705882353,g:1,b:1},{name:"cadetblue",r:.37254901960784315,g:.6196078431372549,b:.6274509803921569},{name:"powderblue",r:.6901960784313725,g:.8784313725490196,b:.9019607843137255},{name:"lightblue",r:.6784313725490196,g:.8470588235294118,b:.9019607843137255},{name:"deepskyblue",r:0,g:.7490196078431373,b:1},{name:"skyblue",r:.5294117647058824,g:.807843137254902,b:.9215686274509803},{name:"lightskyblue",r:.5294117647058824,g:.807843137254902,b:.9803921568627451},{name:"steelblue",r:.27450980392156865,g:.5098039215686274,b:.7058823529411765},{name:"aliceblue",r:.9411764705882353,g:.9725490196078431,b:1},{name:"dodgerblue",r:.11764705882352941,g:.5647058823529412,b:1},{name:"slategray",r:.4392156862745098,g:.5019607843137255,b:.5647058823529412},{name:"lightslategray",r:.4666666666666667,g:.5333333333333333,b:.6},{name:"lightsteelblue",r:.6901960784313725,g:.7686274509803922,b:.8705882352941177},{name:"cornflowerblue",r:.39215686274509803,g:.5843137254901961,b:.9294117647058824},{name:"royalblue",r:.2549019607843137,g:.4117647058823529,b:.8823529411764706},{name:"midnightblue",r:.09803921568627451,g:.09803921568627451,b:.4392156862745098},{name:"lavender",r:.9019607843137255,g:.9019607843137255,b:.9803921568627451},{name:"navy",r:0,g:0,b:.5019607843137255},{name:"darkblue",r:0,g:0,b:.5450980392156862},{name:"mediumblue",r:0,g:0,b:.803921568627451},{name:"blue",r:0,g:0,b:1},{name:"ghostwhite",r:.9725490196078431,g:.9725490196078431,b:1},{name:"darkslateblue",r:.2823529411764706,g:.23921568627450981,b:.5450980392156862},{name:"slateblue",r:.41568627450980394,g:.35294117647058826,b:.803921568627451},{name:"mediumslateblue",r:.4823529411764706,g:.40784313725490196,b:.9333333333333333},{name:"mediumpurple",r:.5764705882352941,g:.4392156862745098,b:.8588235294117647},{name:"blueviolet",r:.5411764705882353,g:.16862745098039217,b:.8862745098039215},{name:"indigo",r:.29411764705882354,g:0,b:.5098039215686274},{name:"darkorchid",r:.6,g:.19607843137254902,b:.8},{name:"darkviolet",r:.5803921568627451,g:0,b:.8274509803921568},{name:"mediumorchid",r:.7294117647058823,g:.3333333333333333,b:.8274509803921568},{name:"thistle",r:.8470588235294118,g:.7490196078431373,b:.8470588235294118},{name:"plum",r:.8666666666666667,g:.6274509803921569,b:.8666666666666667},{name:"violet",r:.9333333333333333,g:.5098039215686274,b:.9333333333333333},{name:"purple",r:.5019607843137255,g:0,b:.5019607843137255},{name:"darkmagenta",r:.5450980392156862,g:0,b:.5450980392156862},{name:"magenta",r:1,g:0,b:1},{name:"fuchsia",r:1,g:0,b:1},{name:"orchid",r:.8549019607843137,g:.4392156862745098,b:.8392156862745098},{name:"mediumvioletred",r:.7803921568627451,g:.08235294117647059,b:.5215686274509804},{name:"deeppink",r:1,g:.0784313725490196,b:.5764705882352941},{name:"hotpink",r:1,g:.4117647058823529,b:.7058823529411765},{name:"palevioletred",r:.8588235294117647,g:.4392156862745098,b:.5764705882352941},{name:"lavenderblush",r:1,g:.9411764705882353,b:.9607843137254902},{name:"crimson",r:.8627450980392157,g:.0784313725490196,b:.23529411764705882},{name:"pink",r:1,g:.7529411764705882,b:.796078431372549},{name:"lightpink",r:1,g:.7137254901960784,b:.7568627450980392}]};this.writers={"#HEX":function(e,t){return t._formatColor("#rxgxbx",e)},"#HEX3":function(e,t){var i=b.colorpicker.writers.HEX3(e);return i===false?false:"#"+i},HEX:function(e,t){return t._formatColor("rxgxbx",e)},HEX3:function(e,t){var i=e.getRGB(),n=Math.round(i.r*255),a=Math.round(i.g*255),o=Math.round(i.b*255);if(n>>>4===(n&=15)&&a>>>4===(a&=15)&&o>>>4===(o&=15))return n.toString(16)+a.toString(16)+o.toString(16);return false},"#HEXA":function(e,t){return t._formatColor("#rxgxbxax",e)},"#HEXA4":function(e,t){var i=b.colorpicker.writers.HEXA4(e,t);return i===false?false:"#"+i},HEXA:function(e,t){return t._formatColor("rxgxbxax",e)},HEXA4:function(e,t){var i=Math.round(e.getAlpha()*255);if(i>>>4===(i&=15))return b.colorpicker.writers.HEX3(e,t)+i.toString(16);return false},RGB:function(e,t){return e.getAlpha()>=1?t._formatColor("rgb(rd,gd,bd)",e):false},RGBA:function(e,t){return t._formatColor("rgba(rd,gd,bd,af)",e)},"RGB%":function(e,t){return e.getAlpha()>=1?t._formatColor("rgb(rp%,gp%,bp%)",e):false},"RGBA%":function(e,t){return t._formatColor("rgba(rp%,gp%,bp%,af)",e)},HSL:function(e,t){return e.getAlpha()>=1?t._formatColor("hsl(hd,sd,vd)",e):false},HSLA:function(e,t){return t._formatColor("hsla(hd,sd,vd,af)",e)},"HSL%":function(e,t){return e.getAlpha()>=1?t._formatColor("hsl(hp%,sp%,vp%)",e):false},"HSLA%":function(e,t){return t._formatColor("hsla(hp%,sp%,vp%,af)",e)},NAME:function(e,t){return t._closestName(e)},EXACT:function(e,t){return t._exactName(e)}};this.parsers={"":function(e){if(e==="")return new b.colorpicker.Color},NAME:function(e,t){var i=t._getSwatch(b.trim(e));if(i)return new b.colorpicker.Color(i.r,i.g,i.b)},RGBA:function(e){var t=/^rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(e);if(t)return new b.colorpicker.Color(t[1]/255,t[2]/255,t[3]/255,parseFloat(t[4]))},"RGBA%":function(e){var t=/^rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(e);if(t)return new b.colorpicker.Color(t[1]/100,t[2]/100,t[3]/100,t[4]/100)},HSLA:function(e){var t=/^hsla?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(e);if(t)return(new b.colorpicker.Color).setHSL(t[1]/255,t[2]/255,t[3]/255).setAlpha(parseFloat(t[4]))},"HSLA%":function(e){var t=/^hsla?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)$/.exec(e);if(t)return(new b.colorpicker.Color).setHSL(t[1]/100,t[2]/100,t[3]/100).setAlpha(t[4]/100)},"#HEX":function(e){var t=/^#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(e);if(t)return new b.colorpicker.Color(parseInt(t[1],16)/255,parseInt(t[2],16)/255,parseInt(t[3],16)/255)},"#HEX3":function(e){var t=/^#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(e);if(t)return new b.colorpicker.Color(parseInt(String(t[1])+t[1],16)/255,parseInt(String(t[2])+t[2],16)/255,parseInt(String(t[3])+t[3],16)/255)},HEX:function(e){var t=/^([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(e);if(t)return new b.colorpicker.Color(parseInt(t[1],16)/255,parseInt(t[2],16)/255,parseInt(t[3],16)/255)},HEX3:function(e){var t=/^([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(e);if(t)return new b.colorpicker.Color(parseInt(String(t[1])+t[1],16)/255,parseInt(String(t[2])+t[2],16)/255,parseInt(String(t[3])+t[3],16)/255)},"#HEXA":function(e){var t=/^#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(e);if(t)return new b.colorpicker.Color(parseInt(t[1],16)/255,parseInt(t[2],16)/255,parseInt(t[3],16)/255,parseInt(t[4],16)/255)},"#HEXA4":function(e){var t=/^#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(e);if(t)return new b.colorpicker.Color(parseInt(String(t[1])+t[1],16)/255,parseInt(String(t[2])+t[2],16)/255,parseInt(String(t[3])+t[3],16)/255,parseInt(String(t[4])+t[4],16)/255)},HEXA:function(e){var t=/^([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})$/.exec(e);if(t)return new b.colorpicker.Color(parseInt(t[1],16)/255,parseInt(t[2],16)/255,parseInt(t[3],16)/255,parseInt(t[4],16)/255)},HEXA4:function(e){var t=/^([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])$/.exec(e);if(t)return new b.colorpicker.Color(parseInt(String(t[1])+t[1],16)/255,parseInt(String(t[2])+t[2],16)/255,parseInt(String(t[3])+t[3],16)/255,parseInt(String(t[4])+t[4],16)/255)}};this.partslists={full:["header","map","bar","hex","hsv","rgb","alpha","lab","cmyk","preview","swatches","footer"],popup:["map","bar","hex","hsv","rgb","alpha","preview","footer"],draggable:["header","map","bar","hex","hsv","rgb","alpha","preview","footer"],inline:["map","bar","hex","hsv","rgb","alpha","preview"]};this.limits={websafe:function(e){e.limit(6)},nibble:function(e){e.limit(16)},binary:function(e){e.limit(2)},name:function(e,t){var i=t._getSwatch(t._closestName(e));e.setRGB(i.r,i.g,i.b)}};this.parts={header:function(i){var e=this,n=null,a=function(){var e=i.options.title||i._getRegional("title"),t='<span class="ui-dialog-title">'+e+"</span>";if(!i.inline&&i.options.showCloseButton)t+='<a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button">'+'<span class="ui-icon ui-icon-closethick">close</span></a>';return'<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+t+"</div>"};this.init=function(){n=b(a()).prependTo(i.dialog);var e=b(".ui-dialog-titlebar-close",n);i._hoverable(e);i._focusable(e);e.click(function(e){e.preventDefault();i.close(i.options.revert)});if(!i.inline&&i.options.draggable){var t={handle:n};if(i.options.containment)t.containment=i.options.containment;i.dialog.draggable(t)}}},map:function(a){var o=this,s=null,r,l,c,d={},p,u,h,e;p=function(e){if(!a.opened)return;var t=d.p.offset(),i=e.pageX-t.left,n=e.pageY-t.top;if(i>=0&&i<l&&n>=0&&n<c){e.stopImmediatePropagation();e.preventDefault();s.unbind("mousedown",p);b(document).bind("mouseup",u);b(document).bind("mousemove",h);h(e)}};u=function(e){e.stopImmediatePropagation();e.preventDefault();b(document).unbind("mouseup",u);b(document).unbind("mousemove",h);s.bind("mousedown",p);a._callback("stop")};h=function(e){e.stopImmediatePropagation();e.preventDefault();if(e.pageX===o.x&&e.pageY===o.y)return;o.x=e.pageX;o.y=e.pageY;var t=d.p.offset(),i=e.pageX-t.left,n=e.pageY-t.top;i=Math.max(0,Math.min(i/l,1));n=Math.max(0,Math.min(n/c,1));switch(a.mode){case"h":a.color.setHSV(null,i,1-n);break;case"s":case"a":a.color.setHSV(i,null,1-n);break;case"v":a.color.setHSV(i,1-n,null);break;case"r":a.color.setRGB(null,1-n,i);break;case"g":a.color.setRGB(1-n,null,i);break;case"b":a.color.setRGB(i,1-n,null);break}a._change(false)};e=function(){var e='<div class="ui-colorpicker-map ui-colorpicker-map-'+(a.options.part.map.size||256)+' ui-colorpicker-border">'+'<span class="ui-colorpicker-map-layer-1">&nbsp;</span>'+'<span class="ui-colorpicker-map-layer-2">&nbsp;</span>'+(a.options.alpha?'<span class="ui-colorpicker-map-layer-alpha">&nbsp;</span>':"")+'<span class="ui-colorpicker-map-layer-pointer"><span class="ui-colorpicker-map-pointer"></span></span></div>';return e};this.init=function(){s=b(e()).appendTo(b(".ui-colorpicker-map-container",a.dialog));s.bind("mousedown",p);d[1]=b(".ui-colorpicker-map-layer-1",s);d[2]=b(".ui-colorpicker-map-layer-2",s);d.a=b(".ui-colorpicker-map-layer-alpha",s);d.p=b(".ui-colorpicker-map-layer-pointer",s);l=d.p.width();c=d.p.height();r=b(".ui-colorpicker-map-pointer",s)};this.update=function(){var e=(a.options.part.map.size||256)*65/64;switch(a.mode){case"h":d[1].css({"background-position":"0 0",opacity:""}).show();d[2].hide();break;case"s":case"a":d[1].css({"background-position":"0 "+-e+"px",opacity:""}).show();d[2].css({"background-position":"0 "+-e*2+"px",opacity:""}).show();break;case"v":s.css("background-color","black");d[1].css({"background-position":"0 "+-e*3+"px",opacity:""}).show();d[2].hide();break;case"r":d[1].css({"background-position":"0 "+-e*4+"px",opacity:""}).show();d[2].css({"background-position":"0 "+-e*5+"px",opacity:""}).show();break;case"g":d[1].css({"background-position":"0 "+-e*6+"px",opacity:""}).show();d[2].css({"background-position":"0 "+-e*7+"px",opacity:""}).show();break;case"b":d[1].css({"background-position":"0 "+-e*8+"px",opacity:""}).show();d[2].css({"background-position":"0 "+-e*9+"px",opacity:""}).show();break}o.repaint()};this.repaint=function(){var e=0,t=0;switch(a.mode){case"h":var i=a.color.getHSV();e=i.s*l;t=(1-i.v)*l;s.css("background-color",a.color.copy().setHSV(null,1,1).toCSS());break;case"s":case"a":var i=a.color.getHSV();e=i.h*l;t=(1-i.v)*l;d[2].css("opacity",1-i.s);break;case"v":var i=a.color.getHSV();e=i.h*l;t=(1-i.s)*l;d[1].css("opacity",i.v);break;case"r":var n=a.color.getRGB();e=n.b*l;t=(1-n.g)*l;d[2].css("opacity",n.r);break;case"g":var n=a.color.getRGB();e=n.b*l;t=(1-n.r)*l;d[2].css("opacity",n.g);break;case"b":var n=a.color.getRGB();e=n.r*l;t=(1-n.g)*l;d[2].css("opacity",n.b);break}if(a.options.alpha)d.a.css("opacity",1-a.color.getAlpha());r.css({left:e-7,top:t-7})}},bar:function(a){var n=this,o=null,s,r,l,c={},d,p,u,e;d=function(e){if(!a.opened)return;var t=c.p.offset(),i=e.pageX-t.left,n=e.pageY-t.top;if(i>=0&&i<r&&n>=0&&n<l){e.stopImmediatePropagation();e.preventDefault();o.unbind("mousedown",d);b(document).bind("mouseup",p);b(document).bind("mousemove",u);u(e)}};p=function(e){e.stopImmediatePropagation();e.preventDefault();b(document).unbind("mouseup",p);b(document).unbind("mousemove",u);o.bind("mousedown",d);a._callback("stop")};u=function(e){e.stopImmediatePropagation();e.preventDefault();if(e.pageY===n.y)return;n.y=e.pageY;var t=c.p.offset(),i=e.pageY-t.top;i=Math.max(0,Math.min(i/l,1));switch(a.mode){case"h":a.color.setHSV(1-i,null,null);break;case"s":a.color.setHSV(null,1-i,null);break;case"v":a.color.setHSV(null,null,1-i);break;case"r":a.color.setRGB(1-i,null,null);break;case"g":a.color.setRGB(null,1-i,null);break;case"b":a.color.setRGB(null,null,1-i);break;case"a":a.color.setAlpha(1-i);break}a._change(false)};e=function(){var e='<div class="ui-colorpicker-bar ui-colorpicker-bar-'+(a.options.part.bar.size||256)+'  ui-colorpicker-border">'+'<span class="ui-colorpicker-bar-layer-1">&nbsp;</span>'+'<span class="ui-colorpicker-bar-layer-2">&nbsp;</span>'+'<span class="ui-colorpicker-bar-layer-3">&nbsp;</span>'+'<span class="ui-colorpicker-bar-layer-4">&nbsp;</span>';if(a.options.alpha)e+='<span class="ui-colorpicker-bar-layer-alpha">&nbsp;</span>'+'<span class="ui-colorpicker-bar-layer-alphabar">&nbsp;</span>';e+='<span class="ui-colorpicker-bar-layer-pointer"><span class="ui-colorpicker-bar-pointer"></span></span></div>';return e};this.init=function(){o=b(e()).appendTo(b(".ui-colorpicker-bar-container",a.dialog));o.bind("mousedown",d);c[1]=b(".ui-colorpicker-bar-layer-1",o);c[2]=b(".ui-colorpicker-bar-layer-2",o);c[3]=b(".ui-colorpicker-bar-layer-3",o);c[4]=b(".ui-colorpicker-bar-layer-4",o);c.a=b(".ui-colorpicker-bar-layer-alpha",o);c.ab=b(".ui-colorpicker-bar-layer-alphabar",o);c.p=b(".ui-colorpicker-bar-layer-pointer",o);r=c.p.width();l=c.p.height();s=b(".ui-colorpicker-bar-pointer",o)};this.update=function(){var e=(a.options.part.bar.size||256)*65/64;switch(a.mode){case"h":case"s":case"v":case"r":case"g":case"b":c.a.show();c.ab.hide();break;case"a":c.a.hide();c.ab.show();break}switch(a.mode){case"h":c[1].css({"background-position":"0 0",opacity:""}).show();c[2].hide();c[3].hide();c[4].hide();break;case"s":c[1].css({"background-position":"0 "+-e+"px",opacity:""}).show();c[2].css({"background-position":"0 "+-e*2+"px",opacity:""}).show();c[3].hide();c[4].hide();break;case"v":c[1].css({"background-position":"0 "+-e*2+"px",opacity:""}).show();c[2].hide();c[3].hide();c[4].hide();break;case"r":c[1].css({"background-position":"0 "+-e*6+"px",opacity:""}).show();c[2].css({"background-position":"0 "+-e*5+"px",opacity:""}).show();c[3].css({"background-position":"0 "+-e*3+"px",opacity:""}).show();c[4].css({"background-position":"0 "+-e*4+"px",opacity:""}).show();break;case"g":c[1].css({"background-position":"0 "+-e*10+"px",opacity:""}).show();c[2].css({"background-position":"0 "+-e*9+"px",opacity:""}).show();c[3].css({"background-position":"0 "+-e*7+"px",opacity:""}).show();c[4].css({"background-position":"0 "+-e*8+"px",opacity:""}).show();break;case"b":c[1].css({"background-position":"0 "+-e*14+"px",opacity:""}).show();c[2].css({"background-position":"0 "+-e*13+"px",opacity:""}).show();c[3].css({"background-position":"0 "+-e*11+"px",opacity:""}).show();c[4].css({"background-position":"0 "+-e*12+"px",opacity:""}).show();break;case"a":c[1].hide();c[2].hide();c[3].hide();c[4].hide();break}n.repaint()};this.repaint=function(){var e=0;switch(a.mode){case"h":e=(1-a.color.getHSV().h)*l;break;case"s":var t=a.color.getHSV();e=(1-t.s)*l;c[2].css("opacity",1-t.v);o.css("background-color",a.color.copy().setHSV(null,1,null).toCSS());break;case"v":e=(1-a.color.getHSV().v)*l;o.css("background-color",a.color.copy().setHSV(null,null,1).toCSS());break;case"r":var i=a.color.getRGB();e=(1-i.r)*l;c[2].css("opacity",Math.max(0,i.b-i.g));c[3].css("opacity",Math.max(0,i.g-i.b));c[4].css("opacity",Math.min(i.b,i.g));break;case"g":var i=a.color.getRGB();e=(1-i.g)*l;c[2].css("opacity",Math.max(0,i.b-i.r));c[3].css("opacity",Math.max(0,i.r-i.b));c[4].css("opacity",Math.min(i.r,i.b));break;case"b":var i=a.color.getRGB();e=(1-i.b)*l;c[2].css("opacity",Math.max(0,i.r-i.g));c[3].css("opacity",Math.max(0,i.g-i.r));c[4].css("opacity",Math.min(i.r,i.g));break;case"a":e=(1-a.color.getAlpha())*l;o.css("background-color",a.color.copy().toCSS());break}if(a.mode!=="a")c.a.css("opacity",1-a.color.getAlpha());s.css("top",e-3)}},preview:function(e){var t=this,i=null,n,a,o,s,r,l;l=function(){return'<div class="ui-colorpicker-preview ui-colorpicker-border">'+'<div class="ui-colorpicker-preview-initial"><div class="ui-colorpicker-preview-initial-alpha"></div></div>'+'<div class="ui-colorpicker-preview-current"><div class="ui-colorpicker-preview-current-alpha"></div></div>'+"</div>"};this.init=function(){i=b(l()).appendTo(b(".ui-colorpicker-preview-container",e.dialog));b(".ui-colorpicker-preview-initial",i).click(function(){e.color=e.currentColor.copy();e._change()});a=b(".ui-colorpicker-preview-initial",i);o=b(".ui-colorpicker-preview-initial-alpha",i);s=b(".ui-colorpicker-preview-current",i);r=b(".ui-colorpicker-preview-current-alpha",i);n=b(".ui-colorpicker-preview-initial-alpha, .ui-colorpicker-preview-current-alpha",i)};this.update=function(){n[e.options.alpha?"show":"hide"]();this.repaint()};this.repaint=function(){a.css("background-color",e.currentColor.set?e.currentColor.toCSS():"").attr("title",e.currentColor.set?e.currentColor.toCSS():"");o.css("opacity",1-e.currentColor.getAlpha());s.css("background-color",e.color.set?e.color.toCSS():"").attr("title",e.color.set?e.color.toCSS():"");r.css("opacity",1-e.color.getAlpha())}},hsv:function(t){var e=this,i=null,n={},a;a=function(){var e="";if(t.options.hsv)e+='<div class="ui-colorpicker-hsv-h"><input class="ui-colorpicker-mode" type="radio" value="h"/><label>'+t._getRegional("hsvH")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="360" size="10"/><span class="ui-colorpicker-unit">&deg;</span></div>'+'<div class="ui-colorpicker-hsv-s"><input class="ui-colorpicker-mode" type="radio" value="s"/><label>'+t._getRegional("hsvS")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div>'+'<div class="ui-colorpicker-hsv-v"><input class="ui-colorpicker-mode" type="radio" value="v"/><label>'+t._getRegional("hsvV")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100" size="10"/><span class="ui-colorpicker-unit">%</span></div>';return'<div class="ui-colorpicker-hsv">'+e+"</div>"};this.init=function(){i=b(a()).appendTo(b(".ui-colorpicker-hsv-container",t.dialog));b(".ui-colorpicker-mode",i).click(function(){t.mode=b(this).val();t._updateAllParts()});n.h=b(".ui-colorpicker-hsv-h .ui-colorpicker-number",i);n.s=b(".ui-colorpicker-hsv-s .ui-colorpicker-number",i);n.v=b(".ui-colorpicker-hsv-v .ui-colorpicker-number",i);b(".ui-colorpicker-number",i).bind("change keyup",function(){t.color.setHSV(n.h.val()/360,n.s.val()/100,n.v.val()/100);t._change()})};this.repaint=function(){var e=t.color.getHSV();n.h.val(Math.round(e.h*360));n.s.val(Math.round(e.s*100));n.v.val(Math.round(e.v*100))};this.update=function(){b(".ui-colorpicker-mode",i).each(function(){var e=b(this);e.attr("checked",e.val()===t.mode)});this.repaint()}},rgb:function(t){var e=this,i=null,n={},a;a=function(){var e="";if(t.options.rgb)e+='<div class="ui-colorpicker-rgb-r"><input class="ui-colorpicker-mode" type="radio" value="r"/><label>'+t._getRegional("rgbR")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div>'+'<div class="ui-colorpicker-rgb-g"><input class="ui-colorpicker-mode" type="radio" value="g"/><label>'+t._getRegional("rgbG")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div>'+'<div class="ui-colorpicker-rgb-b"><input class="ui-colorpicker-mode" type="radio" value="b"/><label>'+t._getRegional("rgbB")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="255"/></div>';return'<div class="ui-colorpicker-rgb">'+e+"</div>"};this.init=function(){i=b(a()).appendTo(b(".ui-colorpicker-rgb-container",t.dialog));b(".ui-colorpicker-mode",i).click(function(){t.mode=b(this).val();t._updateAllParts()});n.r=b(".ui-colorpicker-rgb-r .ui-colorpicker-number",i);n.g=b(".ui-colorpicker-rgb-g .ui-colorpicker-number",i);n.b=b(".ui-colorpicker-rgb-b .ui-colorpicker-number",i);b(".ui-colorpicker-number",i).bind("change keyup",function(){var e=b(".ui-colorpicker-rgb-r .ui-colorpicker-number",i).val();t.color.setRGB(n.r.val()/255,n.g.val()/255,n.b.val()/255);t._change()})};this.repaint=function(){var e=t.color.getRGB();n.r.val(Math.round(e.r*255));n.g.val(Math.round(e.g*255));n.b.val(Math.round(e.b*255))};this.update=function(){b(".ui-colorpicker-mode",i).each(function(){var e=b(this);e.attr("checked",e.val()===t.mode)});this.repaint()}},lab:function(t){var e=this,i=null,n={},a=function(){var e="";if(t.options.hsv)e+='<div class="ui-colorpicker-lab-l"><label>'+t._getRegional("labL")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/></div>'+'<div class="ui-colorpicker-lab-a"><label>'+t._getRegional("labA")+'</label><input class="ui-colorpicker-number" type="number" min="-128" max="127"/></div>'+'<div class="ui-colorpicker-lab-b"><label>'+t._getRegional("labB")+'</label><input class="ui-colorpicker-number" type="number" min="-128" max="127"/></div>';return'<div class="ui-colorpicker-lab">'+e+"</div>"};this.init=function(){var e=0;i=b(a()).appendTo(b(".ui-colorpicker-lab-container",t.dialog));n.l=b(".ui-colorpicker-lab-l .ui-colorpicker-number",i);n.a=b(".ui-colorpicker-lab-a .ui-colorpicker-number",i);n.b=b(".ui-colorpicker-lab-b .ui-colorpicker-number",i);b(".ui-colorpicker-number",i).bind("change keyup",function(e){t.color.setLAB(parseInt(n.l.val(),10)/100,(parseInt(n.a.val(),10)+128)/255,(parseInt(n.b.val(),10)+128)/255);t._change()})};this.repaint=function(){var e=t.color.getLAB();n.l.val(Math.round(e.l*100));n.a.val(Math.round(e.a*255)-128);n.b.val(Math.round(e.b*255)-128)};this.update=this.repaint},cmyk:function(t){var e=this,i=null,n={},a=function(){var e="";if(t.options.hsv)e+='<div class="ui-colorpicker-cmyk-c"><label>'+t._getRegional("cmykC")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'+'<div class="ui-colorpicker-cmyk-m"><label>'+t._getRegional("cmykM")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'+'<div class="ui-colorpicker-cmyk-y"><label>'+t._getRegional("cmykY")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>'+'<div class="ui-colorpicker-cmyk-k"><label>'+t._getRegional("cmykK")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>';return'<div class="ui-colorpicker-cmyk">'+e+"</div>"};this.init=function(){i=b(a()).appendTo(b(".ui-colorpicker-cmyk-container",t.dialog));n.c=b(".ui-colorpicker-cmyk-c .ui-colorpicker-number",i);n.m=b(".ui-colorpicker-cmyk-m .ui-colorpicker-number",i);n.y=b(".ui-colorpicker-cmyk-y .ui-colorpicker-number",i);n.k=b(".ui-colorpicker-cmyk-k .ui-colorpicker-number",i);b(".ui-colorpicker-number",i).bind("change keyup",function(e){t.color.setCMYK(parseInt(n.c.val(),10)/100,parseInt(n.m.val(),10)/100,parseInt(n.y.val(),10)/100,parseInt(n.k.val(),10)/100);t._change()})};this.repaint=function(){var e=t.color.getCMYK();n.c.val(Math.round(e.c*100));n.m.val(Math.round(e.m*100));n.y.val(Math.round(e.y*100));n.k.val(Math.round(e.k*100))};this.update=this.repaint},alpha:function(t){var e=this,i=null,n,a=function(){var e="";if(t.options.alpha)e+='<div class="ui-colorpicker-a"><input class="ui-colorpicker-mode" name="mode" type="radio" value="a"/><label>'+t._getRegional("alphaA")+'</label><input class="ui-colorpicker-number" type="number" min="0" max="100"/><span class="ui-colorpicker-unit">%</span></div>';return'<div class="ui-colorpicker-alpha">'+e+"</div>"};this.init=function(){i=b(a()).appendTo(b(".ui-colorpicker-alpha-container",t.dialog));b(".ui-colorpicker-mode",i).click(function(){t.mode=b(this).val();t._updateAllParts()});n=b(".ui-colorpicker-a .ui-colorpicker-number",i);b(".ui-colorpicker-number",i).bind("change keyup",function(){t.color.setAlpha(n.val()/100);t._change()})};this.update=function(){b(".ui-colorpicker-mode",i).each(function(){b(this).attr("checked",b(this).val()===t.mode)});this.repaint()};this.repaint=function(){n.val(Math.round(t.color.getAlpha()*100))}},hex:function(t){var e=this,i=null,n={},a;a=function(){var e="";if(t.options.alpha)e+='<input class="ui-colorpicker-hex-alpha" type="text" maxlength="2" size="2"/>';e+='<input class="ui-colorpicker-hex-input" type="text" maxlength="6" size="6"/>';return'<div class="ui-colorpicker-hex"><label>#</label>'+e+"</div>"};this.init=function(){i=b(a()).appendTo(b(".ui-colorpicker-hex-container",t.dialog));n.color=b(".ui-colorpicker-hex-input",i);n.alpha=b(".ui-colorpicker-hex-alpha",i);n.color.bind("change keydown keyup",function(e,t,i){if(/[^a-fA-F0-9]/.test(n.color.val()))n.color.val(n.color.val().replace(/[^a-fA-F0-9]/,""))});n.color.bind("change keyup",function(){t.color=o(n.color.val()).setAlpha(t.color.getAlpha());t._change()});n.alpha.bind("change keydown keyup",function(){if(/[^a-fA-F0-9]/.test(n.alpha))n.alpha.val(n.alpha.val().replace(/[^a-fA-F0-9]/,""))});n.alpha.bind("change keyup",function(){t.color.setAlpha(parseInt(n.alpha.val(),16)/255);t._change()})};this.repaint=function(){if(!n.color.is(":focus"))n.color.val(t.color.toHex(true));if(!n.alpha.is(":focus"))n.alpha.val(r(t.color.getAlpha()*255))};this.update=this.repaint},swatches:function(t){var e=this,i=function(){var a="";t._eachSwatch(function(e,t){var i=new b.colorpicker.Color(t.r,t.g,t.b),n=i.toCSS();a+='<div class="ui-colorpicker-swatch" style="background-color:'+n+'" title="'+e+'"></div>'});return'<div class="ui-colorpicker-swatches ui-colorpicker-border" style="width:'+t.options.swatchesWidth+'px">'+a+"</div>"};this.init=function(){var e=b(i());b(".ui-colorpicker-swatches-container",t.dialog).html(e);b(".ui-colorpicker-swatch",e).click(function(){t.color=t._parseColor(b(this).css("background-color"))||new b.colorpicker.Color;t._change()})}},footer:function(t){var e=this,i=null,n="ui-colorpicker-special-transparent-"+s,a="ui-colorpicker-special-none-"+s,o=function(){var e="";if(t.options.alpha||!t.inline&&t.options.showNoneButton){e+='<div class="ui-colorpicker-buttonset">';if(t.options.alpha)e+='<input type="radio" name="ui-colorpicker-special" id="'+n+'" class="ui-colorpicker-special-transparent"/><label for="'+n+'">'+t._getRegional("transparent")+"</label>";if(!t.inline&&t.options.showNoneButton)e+='<input type="radio" name="ui-colorpicker-special" id="'+a+'" class="ui-colorpicker-special-none"><label for="'+a+'">'+t._getRegional("none")+"</label>";e+="</div>"}if(!t.inline){e+='<div class="ui-dialog-buttonset">';if(t.options.showCancelButton)e+='<button class="ui-colorpicker-cancel">'+t._getRegional("cancel")+"</button>";e+='<button class="ui-colorpicker-ok">'+t._getRegional("ok")+"</button>";e+="</div>"}return'<div class="ui-dialog-buttonpane ui-widget-content">'+e+"</div>"};this.init=function(){i=b(o()).appendTo(t.dialog);b(".ui-colorpicker-ok",i).button().click(function(){t.close()});b(".ui-colorpicker-cancel",i).button().click(function(){t.close(true)});b(".ui-colorpicker-buttonset",i).buttonset();b(".ui-colorpicker-special-color",i).click(function(){t._change()});b("#"+a,i).click(function(){t.color.set=false;t._change()});b("#"+n,i).click(function(){t.color.setAlpha(0);t._change()})};this.repaint=function(){if(!t.color.set)b(".ui-colorpicker-special-none",i).attr("checked",true).button("refresh");else if(t.color.getAlpha()===0)b(".ui-colorpicker-special-transparent",i).attr("checked",true).button("refresh");else b("input",i).attr("checked",false).button("refresh");b(".ui-colorpicker-cancel",i).button(t.changed?"enable":"disable")};this.update=function(){}}};this.Color=function(){var a={rgb:{r:0,g:0,b:0},hsv:{h:0,s:0,v:0},hsl:{h:0,s:0,l:0},lab:{l:0,a:0,b:0},cmyk:{c:0,m:0,y:0,k:1}},t=1,o=[.9504285,1,1.0889],e=arguments,s=function(e){if(isNaN(e)||e===null)return 0;if(typeof e=="string")e=parseInt(e,10);return Math.max(0,Math.min(e,1))},i=function(e){var e=Math.round(e),t="0123456789abcdef",i=e%16,n=(e-i)/16,a=t.charAt(n)+t.charAt(i);return a},n=function(e){var t=e.r>.04045?Math.pow((e.r+.055)/1.055,2.4):e.r/12.92,i=e.g>.04045?Math.pow((e.g+.055)/1.055,2.4):e.g/12.92,n=e.b>.04045?Math.pow((e.b+.055)/1.055,2.4):e.b/12.92;return{x:t*.4124+i*.3576+n*.1805,y:t*.2126+i*.7152+n*.0722,z:t*.0193+i*.1192+n*.9505}},r=function(e){var t={r:e.x*3.2406+e.y*-1.5372+e.z*-.4986,g:e.x*-.9689+e.y*1.8758+e.z*.0415,b:e.x*.0557+e.y*-.204+e.z*1.057};t.r=t.r>.0031308?1.055*Math.pow(t.r,1/2.4)-.055:12.92*t.r;t.g=t.g>.0031308?1.055*Math.pow(t.g,1/2.4)-.055:12.92*t.g;t.b=t.b>.0031308?1.055*Math.pow(t.b,1/2.4)-.055:12.92*t.b;return t},l=function(e){var t=Math.min(e.r,e.g,e.b),i=Math.max(e.r,e.g,e.b),n=i-t,a,o,s,r={h:0,s:0,v:i};if(n===0){r.h=0;r.s=0}else{r.s=n/i;a=((i-e.r)/6+n/2)/n;o=((i-e.g)/6+n/2)/n;s=((i-e.b)/6+n/2)/n;if(e.r===i)r.h=s-o;else if(e.g===i)r.h=1/3+a-s;else if(e.b===i)r.h=2/3+o-a;if(r.h<0)r.h+=1;else if(r.h>1)r.h-=1}return r},c=function(e){var t={r:0,g:0,b:0},i,n,a,o,s;if(e.s===0)t.r=t.g=t.b=e.v;else{i=e.h===1?0:e.h*6;n=Math.floor(i);a=e.v*(1-e.s);o=e.v*(1-e.s*(i-n));s=e.v*(1-e.s*(1-(i-n)));if(n===0){t.r=e.v;t.g=s;t.b=a}else if(n===1){t.r=o;t.g=e.v;t.b=a}else if(n===2){t.r=a;t.g=e.v;t.b=s}else if(n===3){t.r=a;t.g=o;t.b=e.v}else if(n===4){t.r=s;t.g=a;t.b=e.v}else{t.r=e.v;t.g=a;t.b=o}}return t},d=function(e){var t=Math.min(e.r,e.g,e.b),i=Math.max(e.r,e.g,e.b),n=i-t,a,o,s,r={h:0,s:0,l:(i+t)/2};if(n===0){r.h=0;r.s=0}else{r.s=r.l<.5?n/(i+t):n/(2-i-t);a=((i-e.r)/6+n/2)/n;o=((i-e.g)/6+n/2)/n;s=((i-e.b)/6+n/2)/n;if(e.r===i)r.h=s-o;else if(e.g===i)r.h=1/3+a-s;else if(e.b===i)r.h=2/3+o-a;if(r.h<0)r.h+=1;else if(r.h>1)r.h-=1}return r},p=function(e){var t,i,n=function(e,t,i){if(i<0)i+=1;if(i>1)i-=1;if(6*i<1)return e+(t-e)*6*i;if(2*i<1)return t;if(3*i<2)return e+(t-e)*(2/3-i)*6;return e};if(e.s===0)return{r:e.l,g:e.l,b:e.l};i=e.l<.5?e.l*(1+e.s):e.l+e.s-e.s*e.l;t=2*e.l-i;return{r:n(t,i,e.h+1/3),g:n(t,i,e.h),b:n(t,i,e.h-1/3)}},u=function(e){var t=e.x/o[0],i=e.y/o[1],n=e.z/o[2];t=t>.008856?Math.pow(t,1/3):7.787*t+16/116;i=i>.008856?Math.pow(i,1/3):7.787*i+16/116;n=n>.008856?Math.pow(n,1/3):7.787*n+16/116;return{l:(116*i-16)/100,a:(500*(t-i)+128)/255,b:(200*(i-n)+128)/255}},h=function(e){var t={l:e.l*100,a:e.a*255-128,b:e.b*255-128},i={x:0,y:(t.l+16)/116,z:0};i.x=t.a/500+i.y;i.z=i.y-t.b/200;i.x=Math.pow(i.x,3)>.008856?Math.pow(i.x,3):(i.x-16/116)/7.787;i.y=Math.pow(i.y,3)>.008856?Math.pow(i.y,3):(i.y-16/116)/7.787;i.z=Math.pow(i.z,3)>.008856?Math.pow(i.z,3):(i.z-16/116)/7.787;i.x*=o[0];i.y*=o[1];i.z*=o[2];return i},g=function(e){return{c:1-e.r,m:1-e.g,y:1-e.b}},m=function(e){return{r:1-e.c,g:1-e.m,b:1-e.y}},f=function(e){var t=1;if(e.c<t)t=e.c;if(e.m<t)t=e.m;if(e.y<t)t=e.y;if(t===1)return{c:0,m:0,y:0,k:1};return{c:(e.c-t)/(1-t),m:(e.m-t)/(1-t),y:(e.y-t)/(1-t),k:t}},v=function(e){return{c:e.c*(1-e.k)+e.k,m:e.m*(1-e.k)+e.k,y:e.y*(1-e.k)+e.k}};this.set=false;this.setAlpha=function(e){if(e!==null)t=s(e);this.set=true;return this};this.getAlpha=function(){return t};this.setRGB=function(e,t,i){a={rgb:this.getRGB()};if(e!==null)a.rgb.r=s(e);if(t!==null)a.rgb.g=s(t);if(i!==null)a.rgb.b=s(i);this.set=true;return this};this.setHSV=function(e,t,i){a={hsv:this.getHSV()};if(e!==null)a.hsv.h=s(e);if(t!==null)a.hsv.s=s(t);if(i!==null)a.hsv.v=s(i);this.set=true;return this};this.setHSL=function(e,t,i){a={hsl:this.getHSL()};if(e!==null)a.hsl.h=s(e);if(t!==null)a.hsl.s=s(t);if(i!==null)a.hsl.l=s(i);this.set=true;return this};this.setLAB=function(e,t,i){a={lab:this.getLAB()};if(e!==null)a.lab.l=s(e);if(t!==null)a.lab.a=s(t);if(i!==null)a.lab.b=s(i);this.set=true;return this};this.setCMYK=function(e,t,i,n){a={cmyk:this.getCMYK()};if(e!==null)a.cmyk.c=s(e);if(t!==null)a.cmyk.m=s(t);if(i!==null)a.cmyk.y=s(i);if(n!==null)a.cmyk.k=s(n);this.set=true;return this};this.getRGB=function(){if(!a.rgb){a.rgb=a.lab?r(h(a.lab)):a.hsv?c(a.hsv):a.hsl?p(a.hsl):a.cmyk?m(v(a.cmyk)):{r:0,g:0,b:0};a.rgb.r=s(a.rgb.r);a.rgb.g=s(a.rgb.g);a.rgb.b=s(a.rgb.b)}return b.extend({},a.rgb)};this.getHSV=function(){if(!a.hsv){a.hsv=a.lab?l(this.getRGB()):a.rgb?l(a.rgb):a.hsl?l(this.getRGB()):a.cmyk?l(this.getRGB()):{h:0,s:0,v:0};a.hsv.h=s(a.hsv.h);a.hsv.s=s(a.hsv.s);a.hsv.v=s(a.hsv.v)}return b.extend({},a.hsv)};this.getHSL=function(){if(!a.hsl){a.hsl=a.rgb?d(a.rgb):a.hsv?d(this.getRGB()):a.cmyk?d(this.getRGB()):a.hsv?d(this.getRGB()):{h:0,s:0,l:0};a.hsl.h=s(a.hsl.h);a.hsl.s=s(a.hsl.s);a.hsl.l=s(a.hsl.l)}return b.extend({},a.hsl)};this.getCMYK=function(){if(!a.cmyk){a.cmyk=a.rgb?f(g(a.rgb)):a.hsv?f(g(this.getRGB())):a.hsl?f(g(this.getRGB())):a.lab?f(g(this.getRGB())):{c:0,m:0,y:0,k:1};a.cmyk.c=s(a.cmyk.c);a.cmyk.m=s(a.cmyk.m);a.cmyk.y=s(a.cmyk.y);a.cmyk.k=s(a.cmyk.k)}return b.extend({},a.cmyk)};this.getLAB=function(){if(!a.lab){a.lab=a.rgb?u(n(a.rgb)):a.hsv?u(n(this.getRGB())):a.hsl?u(n(this.getRGB())):a.cmyk?u(n(this.getRGB())):{l:0,a:0,b:0};a.lab.l=s(a.lab.l);a.lab.a=s(a.lab.a);a.lab.b=s(a.lab.b)}return b.extend({},a.lab)};this.getChannels=function(){return{r:this.getRGB().r,g:this.getRGB().g,b:this.getRGB().b,a:this.getAlpha(),h:this.getHSV().h,s:this.getHSV().s,v:this.getHSV().v,c:this.getCMYK().c,m:this.getCMYK().m,y:this.getCMYK().y,k:this.getCMYK().k,L:this.getLAB().l,A:this.getLAB().a,B:this.getLAB().b}};this.getSpaces=function(){return b.extend(true,{},a)};this.distance=function(e){var t="lab",i="get"+t.toUpperCase(),n=this[i](),a=e[i](),o=0,s;for(s in n)o+=Math.pow(n[s]-a[s],2);return o};this.equals=function(e){if(e){var t=this.getRGB(),i=e.getRGB();return this.set===e.set&&this.getAlpha()===e.getAlpha()&&t.r===i.r&&t.g===i.g&&t.b===i.b}return false};this.limit=function(e){e-=1;var t=this.getRGB();this.setRGB(Math.round(t.r*e)/e,Math.round(t.g*e)/e,Math.round(t.b*e)/e)};this.toHex=function(){var e=this.getRGB();return i(e.r*255)+i(e.g*255)+i(e.b*255)};this.toCSS=function(){return"#"+this.toHex()};this.copy=function(){var e=new b.colorpicker.Color(this.getSpaces(),this.getAlpha());e.set=this.set;return e};if(e.length===2){a=e[0];this.setAlpha(e[1]===0?0:e[1]||1);this.set=true}if(e.length>2){this.setRGB(e[0],e[1],e[2]);this.setAlpha(e[3]===0?0:e[3]||1);this.set=true}}},b.widget("vanderlee.colorpicker",{options:{alpha:false,altAlpha:true,altField:"",altOnChange:true,altProperties:"background-color",autoOpen:false,buttonClass:null,buttonColorize:false,buttonImage:"images/ui-colorpicker.png",buttonImageOnly:false,buttonText:null,closeOnEscape:true,closeOnOutside:true,color:"#00FF00",colorFormat:"HEX",draggable:true,containment:null,duration:"fast",hideOn:"button",hsv:true,inline:true,inlineFrame:true,layout:{map:[0,0,1,5],bar:[1,0,1,5],preview:[2,0,1,1],hsv:[2,1,1,1],rgb:[2,2,1,1],alpha:[2,3,1,1],hex:[2,4,1,1],lab:[3,1,1,1],cmyk:[3,2,1,2],swatches:[4,0,1,5]},limit:"",modal:false,mode:"h",okOnEnter:false,parts:"",part:{map:{size:256},bar:{size:256}},position:null,regional:"",revert:false,rgb:true,showAnim:"fadeIn",showCancelButton:true,showNoneButton:false,showCloseButton:true,showOn:"focus click alt",showOptions:{},swatches:null,swatchesWidth:84,title:null,cancel:null,close:null,init:null,ok:null,open:null,select:null,stop:null},_create:function(){var t=this,e;++s;t.widgetEventPrefix="colorpicker";t.opened=false;t.generated=false;t.inline=false;t.changed=false;t.dialog=null;t.button=null;t.image=null;t.overlay=null;t.events={window_resize:null,document_keydown:null,document_click_html:null};t.mode=t.options.mode;if(t.element.is("input")||t.options.inline===false){t._setColor(t.element.is("input")?t.element.val():t.options.color);t._callback("init");if(/\bfocus|all|both\b/.test(t.options.showOn))t.element.bind("focus",function(){t.open()});if(/\bfocus|all|both\b/.test(t.options.hideOn))t.element.bind("focusout",function(e){t.close()});if(/\bclick|all|both\b/.test(t.options.showOn))t.element.bind("click",function(e){if(t.opened&&/\bclick|all|both\b/.test(t.options.hideOn))t.close();else t.open()});if(/\bbutton|all|both\b/.test(t.options.showOn)){if(t.options.buttonImage!==""){e=t.options.buttonText||t._getRegional("button");t.image=b("<img/>").attr({src:t.options.buttonImage,alt:e,title:e});if(t.options.buttonClass)t.image.attr("class",t.options.buttonClass);t._setImageBackground()}if(t.options.buttonImageOnly&&t.image)t.button=t.image;else{t.button=b('<button type="button"></button>').html(t.image||t.options.buttonText).button();t.image=t.image?b("img",t.button).first():null}t.button.insertAfter(t.element).click(function(){if(t.opened&&/\bbutton|all|both\b/.test(t.options.hideOn))t.close();else t.open()})}if(/\balt|all|both\b/.test(t.options.showOn))b(t.options.altField).bind("click",function(){if(t.opened&&/\balt|all|both\b/.test(t.options.hideOn))t.close();else t.open()});if(t.options.autoOpen)t.open()}else{t.inline=true;t._generate();t.opened=true}return this},_setOption:function(e,t){switch(e){case"disabled":if(t)this.dialog.addClass("ui-colorpicker-disabled");else this.dialog.removeClass("ui-colorpicker-disabled");break;case"swatches":this.options.swatches=t;this.parts.swatches.init();break}b.Widget.prototype._setOption.apply(this,arguments)},_setImageBackground:function(){if(this.image&&this.options.buttonColorize)this.image.css("background-color",this.color.set?this._formatColor("RGBA",this.color):"")},_setAltField:function(){if(this.options.altOnChange&&this.options.altField&&this.options.altProperties){var e,t,i=this.options.altProperties.split(",");for(e=0;e<=i.length;++e){t=b.trim(i[e]);switch(t){case"color":case"fill":case"stroke":case"background-color":case"backgroundColor":case"outline-color":case"border-color":b(this.options.altField).css(t,this.color.set?this.color.toCSS():"");break}}if(this.options.altAlpha)b(this.options.altField).css("opacity",this.color.set?this.color.getAlpha():"")}},_setColor:function(e){this.color=this._parseColor(e)||new b.colorpicker.Color;this.currentColor=this.color.copy();this._setImageBackground();this._setAltField()},setColor:function(e){this._setColor(e);this._change()},getColor:function(e){return this._formatColor(e||this.options.colorFormat,this.color)},_generateInline:function(){var e=this;b(e.element).html(e.options.inlineFrame?t:i);e.dialog=b(".ui-colorpicker",e.element)},_generatePopup:function(){var n=this;n.dialog=b(e).appendTo("body");if(n.events.document_click_html===null)b(document).delegate("html","touchstart click",n.events.document_click_html=function(e){if(!n.opened||e.target===n.element[0]||n.overlay)return;if(n.dialog.is(e.target)||n.dialog.has(e.target).length>0){n.element.blur();return}var t,i=b(e.target).parents();i.push(e.target);for(t=0;t<=i.length;++t){if(n.button!==null&&i[t]===n.button[0])return;if(/\balt|all|both\b/.test(n.options.showOn)&&b(n.options.altField).is(i[t]))return}if(!n.options.closeOnOutside)return;n.close(n.options.revert)});if(n.events.document_keydown===null)b(document).bind("keydown",n.events.document_keydown=function(e){if(n.opened&&e.keyCode===27&&n.options.closeOnEscape)n.close(n.options.revert);if(n.opened&&e.keyCode===13&&n.options.okOnEnter)n.close()});n.element.keydown(function(e){if(e.keyCode===9)n.close()}).keyup(function(e){var t=n._parseColor(n.element.val());if(t&&!n.color.equals(t)){n.color=t;n._change()}})},_generate:function(){var i=this,e,t,n,a,o,s;i._setColor(i.inline||!i.element.is("input")?i.options.color:i.element.val());i[i.inline?"_generateInline":"_generatePopup"]();if(typeof i.options.parts==="string")if(b.colorpicker.partslists[i.options.parts])n=b.colorpicker.partslists[i.options.parts];else n=b.colorpicker.partslists[i.inline?"inline":"popup"];else n=i.options.parts;i.parts={};b.each(n,function(e,t){if(b.colorpicker.parts[t])i.parts[t]=new b.colorpicker.parts[t](i)});if(!i.generated){a=[];b.each(i.options.layout,function(e,t){if(i.parts[e])a.push({part:e,pos:t})});o=b(l(a,function(e,t,i){s=["ui-colorpicker-"+e.part+"-container"];if(t>0)s.push("ui-colorpicker-padding-left");if(i>0)s.push("ui-colorpicker-padding-top");return'<td  class="'+s.join(" ")+'"'+(e.pos[2]>1?' colspan="'+e.pos[2]+'"':"")+(e.pos[3]>1?' rowspan="'+e.pos[3]+'"':"")+' valign="top"></td>'})).appendTo(i.dialog);if(i.options.inlineFrame)o.addClass("ui-dialog-content ui-widget-content");i._initAllParts();i._updateAllParts();i.generated=true}},_effectGeneric:function(e,t,i,n,a){var o=this;if(b.effects&&b.effects[o.options.showAnim])e[t](o.options.showAnim,o.options.showOptions,o.options.duration,a);else{e[o.options.showAnim==="slideDown"?i:o.options.showAnim==="fadeIn"?n:t](o.options.showAnim?o.options.duration:null,a);if(!o.options.showAnim||!o.options.duration)a()}},_effectShow:function(e,t){this._effectGeneric(e,"show","slideDown","fadeIn",t)},_effectHide:function(e,t){this._effectGeneric(e,"hide","slideUp","fadeOut",t)},open:function(){var e=this,t,i,n,a,o,s,r,l,c,d;if(!e.opened){e._generate();if(e.element.is(":hidden"))c=b("<div/>").insertBefore(e.element);else c=e.element;if(e.element.is(":hidden"))c.remove();l=0;b(e.element[0]).parents().each(function(){var e=b(this).css("z-index");if((typeof e==="number"||typeof e==="string")&&e!==""&&!isNaN(e)){if(e>l){l=parseInt(e,10);return false}}else b(this).siblings().each(function(){var e=b(this).css("z-index");if((typeof e==="number"||typeof e==="string")&&e!==""&&!isNaN(e))if(e>l)l=parseInt(e,10)})});l+=2;e.dialog.css("z-index",l);if(e.options.modal){e.overlay=b('<div class="ui-widget-overlay"></div>').appendTo("body").css("z-index",l-1);if(e.events.window_resize!==null)b(window).unbind("resize",e.events.window_resize);e.events.window_resize=function(){if(e.overlay){e.overlay.width(b(document).width());e.overlay.height(b(document).height())}},b(window).bind("resize",e.events.window_resize);e.events.window_resize()}e._effectShow(this.dialog);if(e.options.position){d=b.extend({},e.options.position);if(d.of==="element")d.of=c}else d={my:"left top",at:"left bottom",of:c,collision:"flip"};e.dialog.position(d);e.opened=true;e._callback("open",true);b(function(){e._repaintAllParts()})}},close:function(e){var t=this;if(!t.opened)return;if(e){t.color=t.currentColor.copy();t._change();t._callback("cancel",true)}else{t.currentColor=t.color.copy();t._callback("ok",true)}t.changed=false;if(t.overlay){b(window).unbind("resize",t.events.window_resize);t.overlay.remove()}t._effectHide(t.dialog,function(){t.dialog.remove();t.dialog=null;t.generated=false;t.opened=false;t._callback("close",true)})},destroy:function(){if(that.events.document_click_html!==null)b(document).undelegate("html","touchstart click",that.events.document_click_html);if(that.events.document_keydown!==null)b(document).unbind("keydown",that.events.document_keydown);if(that.events.resizeOverlay!==null)b(window).unbind("resize",that.events.resizeOverlay);this.element.unbind();if(this.overlay)this.overlay.remove();if(this.dialog!==null)this.dialog.remove();if(this.image!==null)this.image.remove();if(this.button!==null)this.button.remove()},_callback:function(e,t){var i=this,n,a;if(i.color.set){n={formatted:i._formatColor(i.options.colorFormat,i.color),colorPicker:i};a=i.color.getLAB();a.a=a.a*2-1;a.b=a.b*2-1;if(t===true){n.a=i.color.getAlpha();n.rgb=i.color.getRGB();n.hsv=i.color.getHSV();n.cmyk=i.color.getCMYK();n.hsl=i.color.getHSL();n.lab=a}return i._trigger(e,null,n)}else return i._trigger(e,null,{formatted:"",colorPicker:i})},_initAllParts:function(){b.each(this.parts,function(e,t){if(t.init)t.init()})},_updateAllParts:function(){b.each(this.parts,function(e,t){if(t.update)t.update()})},_repaintAllParts:function(){b.each(this.parts,function(e,t){if(t.repaint)t.repaint()})},_change:function(e){this.changed=true;e=typeof e!=="undefined"?!!e:true;if(this.color.set&&this.options.limit&&b.colorpicker.limits[this.options.limit])b.colorpicker.limits[this.options.limit](this.color,this);if(!this.inline){if(!this.color.set){if(this.element.val()!=="")this.element.val("").change()}else if(!this.color.equals(this._parseColor(this.element.val())))this.element.val(this._formatColor(this.options.colorFormat,this.color)).change();this._setImageBackground();this._setAltField()}this.options.color=this.color.set?this.color.toCSS():"";if(this.opened)this._repaintAllParts();this._callback("select");if(e)this._callback("stop")},_hoverable:function(e){e.hover(function(){e.addClass("ui-state-hover")},function(){e.removeClass("ui-state-hover")})},_focusable:function(e){e.focus(function(){e.addClass("ui-state-focus")}).blur(function(){e.removeClass("ui-state-focus")})},_getRegional:function(e){return b.colorpicker.regional[this.options.regional][e]!==undefined?b.colorpicker.regional[this.options.regional][e]:b.colorpicker.regional[""][e]},_getSwatches:function(){if(typeof this.options.swatches==="string")return b.colorpicker.swatches[this.options.swatches];if(b.isPlainObject(this.options.swatches))return this.options.swatches;return b.colorpicker.swatches.html},_eachSwatch:function(i){var n=this._getSwatches(),a;b.each(n,function(e,t){a=b.isArray(n)?t.name:e;return i(a,t)})},_getSwatch:function(i){var n=false;this._eachSwatch(function(e,t){if(e.toLowerCase()==i.toLowerCase()){n=t;return false}});return n},_parseFormat:function(e,t){var i=this,n={x:function(){return"([0-9a-fA-F]{2})"},d:function(){return"([12]?[0-9]{1,2})"},f:function(){return"([0-9]*\\.?[0-9]*)"},p:function(){return"([0-9]*\\.?[0-9]*)"}},a={x:function(e){return parseInt(e,16)},d:function(e){return e/255},f:function(e){return e},p:function(e){return e*.01}},o={r:"setRGB",g:"setRGB",b:"setRGB",h:"setHSV",s:"setHSV",v:"setHSV",c:"setCMYK",m:"setCMYK",y:"setCMYK",k:"setCMYK",L:"setLAB",A:"setLAB",B:"setLAB"},s={setRGB:["r","g","b"],setHSV:["h","s","v"],setCMYK:["c","m","y","k"],setLAB:["L","A","B"]},r=[],l=[],c=null,d,p;p=e.replace(/[()\\^$.|?*+[\]]/g,function(e){return"\\"+e});p=p.replace(/\\?[argbhsvcmykLAB][xdfp]/g,function(e){if(e.match(/^\\/))return e.slice(1);var t=e.charAt(0),i=e.charAt(1);r.push(t);l.push(a[i]);if(o[t])c=o[t];return n[i]()});if(c){var u=t.match(new RegExp(p));if(u){var h=[],g;u.shift();b.each(s[c],function(e,t){g=b.inArray(t,r);h[e]=l[g](u[g])});d=new b.colorpicker.Color;d[c].apply(d,h)}}return d},_parseColor:function(i){var n=this,a;var e=b.isArray(n.options.colorFormat)?n.options.colorFormat:[n.options.colorFormat];b.each(e,function(e,t){if(b.colorpicker.parsers[t])a=b.colorpicker.parsers[t](i,n);else a=n._parseFormat(t,i);if(a)return false});if(!a)b.each(b.colorpicker.parsers,function(e,t){a=t(i,n);if(a)return false});if(a)return a;return false},_exactName:function(i){var n=false;this._eachSwatch(function(e,t){if(i.equals(new b.colorpicker.Color(t.r,t.g,t.b))){n=e;return false}});return n},_closestName:function(i){var e=i.getRGB(),n=null,a=false,o;this._eachSwatch(function(e,t){o=i.distance(new b.colorpicker.Color(t.r,t.g,t.b));if(o<n||n===null){a=e;if(o<=1e-20)return false;n=o}});return a},_formatColor:function(e,i){var n=this,a=null,o={x:function(e){return r(e*255)},d:function(e){return Math.round(e*255)},f:function(e){return e},p:function(e){return e*100}},s=i.getChannels();if(!b.isArray(e))e=[e];b.each(e,function(e,t){if(b.colorpicker.writers[t]){a=b.colorpicker.writers[t](i,n);return a===false}else{a=t.replace(/\\?[argbhsvcmykLAB][xdfp]/g,function(e){if(e.match(/^\\/))return e.slice(1);return o[e.charAt(1)](s[e.charAt(0)])});return false}});return a}}),b.vanderlee.colorpicker}(jQuery);var ScreenItem=Backbone.View.extend({$defaultThumb:null,$input:null,$thumbImage:null,$removeScreenButton:null,$makeDefaultScreenButton:null,$screenName:null,appModel:null,className:"screen-item",screensCollection:null,tagName:"li",viewModel:null,initialize:function(e){this.appModel=e.appModel,this.viewModel=e.viewModel,this.screensCollection=e.screensCollection,this.render(),this.initializeEvents(),this.onThumbChanged(),this.onScreensCollectionChanged(),this.onIsDefaultChanged()},initializeEvents:function(){this.listenTo(this.model,"change:thumb",this.onThumbChanged),this.listenTo(this.model,"change:name",this.onNameChanged),this.listenTo(this.model,"change:isDefault",this.onIsDefaultChanged),this.$el.find(".camera").on("click",$.proxy(this.onCameraClick,this)),this.$el.click($.proxy(this.onItemSelected,this)),this.$duplicateScreenButton.on("click",$.proxy(this.onDuplicateScreenButtonClicked,this)),this.$makeDefaultScreenButton.on("click",$.proxy(this.onMakeDefaultScreenButtonClicked,this)),this.$removeScreenButton.on("click",$.proxy(this.onRemoveScreenButtonClicked,this)),this.$screenName.on("click",$.proxy(this.showInput,this)),this.listenTo(this.screensCollection,"reset add remove",this.onScreensCollectionChanged)},hideInput:function(){this.$input&&(this.$input.off(),this.$input.remove(),this.$input=null)},navigateToScreen:function(e){var t=this.viewModel.get("selectedDocumentId");this.appModel.get("router").navigate(t+"/"+e,{trigger:!0})},onCameraClick:function(){this.trigger("cameraClick",this)},onDuplicateScreenButtonClicked:function(e){var t,i=this.model.clone(),n=1,a=!0;for(e.preventDefault(),e.stopPropagation(),(e=(t=i.get("name")).match(/^(.+ copy)( \(\d+\))?$/))?t=e[1]:t+=" copy";a;)this.screensCollection.some(function(e){return e.get("name")===(1<n?t+" ("+n+")":t)})?n+=1:(a=!1,1<n&&(t+=" ("+n+")"));i.set({name:t,isDefault:!1}),this.screensCollection.commandAdd(i),this.navigateToScreen(i.id)},onIsDefaultChanged:function(){this.model.get("isDefault")?(this.$makeDefaultScreenButton.addClass("is-default"),this.$makeDefaultScreenButton.attr("title",t("Default Screen"))):(this.$makeDefaultScreenButton.removeClass("is-default"),this.$makeDefaultScreenButton.attr("title",t("Set as Default Screen")))},onItemSelected:function(){this.navigateToScreen(this.model.id)},onNameChanged:function(){this.$screenName.text(this.model.get("name"))},onMakeDefaultScreenButtonClicked:function(e){var t,i=[];this.model.get("isDefault")||(i.push({id:this.model.id,isDefault:!0}),(t=this.screensCollection.find(function(e){return e.get("isDefault")&&e.id!==this.model.id}.bind(this)))&&i.push({id:t.id,isDefault:!1}),this.screensCollection.commandSet(i))},onRemoveScreenButtonClicked:function(e){e.preventDefault(),e.stopPropagation(),1<this.screensCollection.length&&this.screensCollection.commandRemove(this.model)},onScreensCollectionChanged:function(){this.screensCollection.length<=1?this.$removeScreenButton.addClass("last-one"):this.$removeScreenButton.removeClass("last-one")},onThumbChanged:function(){this.model.get("thumb")?(this.$thumbImage.attr("src",this.model.get("thumb")),this.$defaultThumb.hide(),this.$thumbImage.show()):(this.$thumbImage.hide(),this.$defaultThumb.show())},render:function(){this.$el.html(T.ScreenItem(this.model.toJSON())),this.$defaultThumb=this.$el.find(".default-thumb"),this.$duplicateScreenButton=this.$el.find(".duplicate-screen-btn"),this.$makeDefaultScreenButton=this.$el.find(".make-default-screen-btn"),this.$removeScreenButton=this.$el.find(".remove-screen-btn"),this.$screenName=this.$el.find(".screen-name"),this.$thumbImage=this.$el.find(".screen-thumb")},showInput:function(e){var t,i,n=this;e&&(e.preventDefault(),e.stopPropagation()),t=this.$screenName.position(),i=this.$screenName.width(),e=this.$screenName.height(),this.$input=$(document.createElement("input")),this.$input.addClass("name-input"),this.$input.css({left:t.left+parseInt(this.$screenName.css("padding-left"),10),top:t.top+parseInt(this.$screenName.css("padding-top"),10),width:i,height:e}),this.$input.val(this.model.get("name")),this.$input.appendTo(this.$screenName.parent()),this.$input.focus(),this.$input.select(),this.$input.on("keydown",function(e){13===e.keyCode?(n.model.commandSet({name:n.$input.val()}),n.hideInput(),e.preventDefault(),e.stopPropagation()):27===e.keyCode&&(n.hideInput(),e.preventDefault(),e.stopPropagation())}),this.$input.on("focusout",function(e){n.hideInput()})},remove:function(){this.$el.find("fa-camera").off(),this.$el.off(),this.$duplicateScreenButton.off(),this.$makeDefaultScreenButton.off(),this.$removeScreenButton.off(),this.$screenName.off(),Backbone.View.prototype.remove.call(this)}}),ScreenList=Backbone.View.extend({$addScreenButton:null,$list:null,$listScrollWrap:null,$screenList:null,$screenListHeader:null,addScreenButton:null,appModel:null,viewModel:null,selectedScreen:null,screens:null,addScreenItem:function(e,t){e=new ScreenItem({model:e,screensCollection:this.model.get("screens"),appModel:this.appModel,viewModel:this.viewModel});return!_.isUndefined(t)&&t<this.screens.length?0===t?e.$el.prependTo(this.$list):e.$el.insertBefore(this.$list.find("li").eq(t)):e.$el.appendTo(this.$list),this.listenTo(e,"cameraClick",this.onScreenCameraClick),this.screens.push(e),e},initialize:function(e){this.appModel=e.appModel,this.viewModel=e.viewModel,this.screens=[],this.render(),this.initializeEvents()},initializeEvents:function(){this.listenTo(this.model.get("screens"),"add",this.onScreenAdded),this.listenTo(this.model.get("screens"),"remove",this.onScreenRemoved),this.listenTo(this.viewModel,"change:selectedScreenId",$.proxy(this.onScreenSelected,this))},onAddScreenButtonClick:function(e){for(var t,i=this.model,n=this.model.get("screens"),a=0,o=!1;!o;)t="Screen "+(a+=1),n.some(function(e){return e.get("name")===t})||(o=!0);i=new QuickBase.Screen({name:t,colCount:i.get("colCount"),floatable:i.get("floatable"),relativeHeight:i.get("relativeHeight"),rowCount:i.get("rowCount"),rowHeight:i.get("rowHeight")},{},n),n.commandAdd(i),e.preventDefault()},onResize:function(){},onScreenAdded:function(e,t,i){this.addScreenItem(e,i.at),Log.Info("screen added",e)},onScreenCameraClick:function(e){this.viewModel.trigger("screenshot")},onScreenRemoved:function(e){this.removeScreenItem(e),Log.Info("screen removed",e),this.viewModel.get("selectedScreenId")===e.id&&(e=this.model.get("screens").first(),this.viewModel.set("selectedScreenId",e.id))},onScreenSelected:function(){var e,t=this.viewModel.get("selectedScreenId");this.selectedScreen&&this.selectedScreen.$el.removeClass("selected"),(e=_.find(this.screens,function(e){return e.model.id===t}))&&(this.selectedScreen=e,this.selectedScreen.$el.addClass("selected"))},removeScreenItem:function(t){var e=_.find(this.screens,function(e){return e.model===t});e?(this.screens=_.without(this.screens,e),e.remove()):Log.Info("screen not found")},render:function(){var t=this;return this.$el.html(T.ScreenList()),this.$list=this.$el.find("ul"),this.$listScrollWrap=this.$el.find(".list-scroll-wrap"),this.$screenList=this.$el.find(".screen-list"),this.$screenListHeader=this.$el.find(".screen-list-header"),this.$addScreenButton=this.$el.find(".add-screen-button"),this.$addScreenButton.button({icons:{primary:"fa fa-plus"}}).click($.proxy(this.onAddScreenButtonClick,this)),this.viewModel.get("selectedScreenId"),this.model.get("screens").each(function(e){t.addScreenItem(e)}),0<this.model.get("screens").length&&this.onScreenSelected(),this},remove:function(){this.stopListening(),this.$el.remove()}}),DashboardPermission=Backbone.View.extend({className:"permision-row",tagName:"tr",initialize:function(e){var t=this;t.$el.html(T.DashboardPermission(e.details)),e.details.read?t.$el.find(".permissionRead input").prop("checked","checked"):t.$el.find(".permissionRead input").removeProp("checked"),e.details.write?t.$el.find(".permissionWrite input").prop("checked","checked"):t.$el.find(".permissionWrite input").removeProp("checked"),t.$el.find(".permissionWrite input").on("change",function(){!0===t.$el.find(".permissionWrite input").prop("checked")&&t.$el.find(".permissionRead input").prop("checked",!0),t.trigger("ApplyChanges")}),t.$el.find(".permissionRead input").on("change",function(){!1===t.$el.find(".permissionRead input").prop("checked")&&t.$el.find(".permissionWrite input").removeProp("checked",!0),t.trigger("ApplyChanges")}),t.$el.css({height:"25px;"})}}),DashboardPermissions=Backbone.View.extend({$permissionsList:null,$permissionsTable:null,initialize:function(e){var i=this;i.$el.html(T.DashboardPermissions()),i.$permissionsList=i.$el.find(".permissions-list"),i.$permissionsTable=i.$el.find("table tbody"),i.model.get("permissionEntity")&&i.model.get("permissionEntity").permissions&&_.each(i.model.get("permissionEntity").permissions,function(e,t){e={name:t,read:e[0],write:e[1]},e=new DashboardPermission({details:e});e.on("ApplyChanges",$.proxy(i.applyChanges,i)),i.$permissionsTable.append(e.$el)})},applyChanges:function(){var n={};_.each(this.$el.find("tr"),function(e){var t=$(e).find("td.permissionName").text(),i=$(e).find("td.permissionRead input").prop("checked"),e=$(e).find("td.permissionWrite input").prop("checked");0<t.length&&(n[t]=[i,e])}),this.model.get("permissionEntity").permissions=n},openDialog:function(){var i=this;i.$dialog.dialog("open"),i.$permissionsTable.find("tr").remove(),i.model.get("permissionEntity")&&i.model.get("permissionEntity").permissions&&_.each(i.model.get("permissionEntity").permissions,function(e,t){e={name:t,read:e[0],write:e[1]},e=new DashboardPermission({details:e});i.$permissionsTable.append(e.$el)})},updatePermissions:function(e){var i=this;_.each(e,function(e,t){i.model.get("permissionEntity").permissions[t]=e})}}),DashbordDefinition=(Ina={type:"object",title:"Properties",_transform:function(e,t,i,n){_.set(t,"properties.Basics.properties.RowCount.options.hidden",!_.get(e,"Basics.FillHeight")),_.set(t,"properties.Basics.properties.RowHeight.options.hidden",!!_.get(e,"Basics.FillHeight")),n(void 0,t)},properties:{Basics:{type:"object",title:"Basics",options:{collapsed:!1},properties:{Name:{title:"Name",type:"string",propertyOrder:10,readOnly:!0,default:""},Link:{title:"Link",type:"string",options:{readonly:!0},propertyOrder:15,default:""},EnableShareDashboard:{title:'Enable "Share Dashboard"',type:"boolean",propertyOrder:20,format:"checkbox",default:!1},SaveViewerState:{title:"Save Viewer State",type:"string",propertyOrder:22,enum:["disabled","enabled","enabled_auto"],default:"Enabled",options:{enum_titles:["Disabled","Enabled","Enabled (Autosave)"]}},UnsavedViewerPrompt:{title:"Unsaved Viewer Prompt",type:"boolean",propertyOrder:25,format:"checkbox",default:!1},FillHeight:{title:"Fill Height",type:"boolean",propertyOrder:30,format:"checkbox",default:!0},Floatable:{title:"Floatable",type:"boolean",propertyOrder:35,format:"checkbox",default:!1},ColCount:{title:"Column Count",type:"number",propertyOrder:40,minimum:1,default:12},RowHeight:{title:"Row Height",type:"number",propertyOrder:45,default:25,options:{hidden:!0}},RowCount:{title:"Row Count",type:"number",propertyOrder:50,minimum:1,default:24}}},Style:{type:"object",title:"Style",options:{collapsed:!0},properties:{DashboardTheme:{title:"Dashboard Theme",type:"string",enum:["Dark","Light"],default:"Dark"},ThemeSwitchable:{title:"Theme Switchable",type:"boolean",format:"checkbox",default:!0},WidgetsSpacing:{title:"Widgets Spacing",type:"number",minimum:0,default:0},WidgetShadow:{title:"Widget Shadow",type:"boolean",format:"checkbox",default:!1},BackgroundColor:{title:"Background Color",options:{noColor:!1},type:"gradient",default:"#000000"},TransparentBackground:{title:"Transparent Background",type:"boolean",format:"checkbox",default:!0},BorderSize:{title:"Border Size",type:"number",minimum:0,default:0},BorderColor:{title:"Border Color",options:{noColor:!1},type:"gradient",default:"#000000"},BorderRounding:{title:"Border Rounding",type:"number",minimum:0,default:0},BorderSpacing:{title:"Border Spacing",type:"number",minimum:0,default:0},WorksheetPadding:{title:"Worksheet Padding",type:"number",minimum:0,default:10},ShowDataLoadingIndicators:{title:"Show Data Loading Indicators",type:"boolean",format:"checkbox",default:!0},AdvancedCss:{type:"css",title:"Advanced CSS",default:""},cssClasses:{type:"string",title:"CSS Classes",default:""}}},Popups:{type:"popups",title:"Popups",options:{collapsed:!0,editPopupButton:!0},items:{type:"object",id:"id",options:{collapsed:!0},title:"Popup",headerTemplate:"{{#if self.dialogTitle}}{{valueProp self.dialogTitle }}{{else}}Popup {{ i1 }}{{/if}}",properties:{visible:{type:"booleanViewState",title:"Visible",format:"checkbox",default:!1},dialogTitle:{type:"stringViewState",title:"Dialog Title",default:""},dialogHeight:{type:"numberViewState",format:"number",title:"Dialog Height",default:0},dialogWidth:{type:"numberViewState",format:"number",title:"Dialog Width",default:0},modal:{type:"booleanViewState",title:"Modal",format:"checkbox",default:!1},resizable:{type:"booleanViewState",title:"Resizable",format:"checkbox",default:!1},Actions:{type:"actions",title:"Actions on Close",excludedFields:["url","nav","query"],fields:{map:{Current:{propertyOrder:10,default:"",type:"stringViewState",options:{custom_class_name:"mapping-current"}},Target:{default:"",propertyOrder:11,type:"stringViewState",options:{custom_class_name:"mapping-target"}}}}},id:{type:"stringViewState",title:"id",options:{hidden:!0},default:""}}}},Shortcuts:{type:"array",title:"Shortcuts",options:{collapsed:!0},items:{type:"object",id:"id",options:{collapsed:!0},title:"Shortcut",headerTemplate:"{{#if self.dialogTitle}}{{valueProp self.dialogTitle }}{{else}}Shortcut {{ i1 }}{{/if}}",properties:{Data:{type:"data",title:"Data Source",default:"",format:"data"},Key:{type:"string",title:"Key",default:""}}}}}},Hna=_.reduce(["Basics","Style"],function(e,t){return e[t]=_.mapValues(Ina.properties[t].properties,"default"),e},{}),Jna={name:"Basics.Name",saveViewerState:"Basics.SaveViewerState",enableShareDashboard:"Basics.EnableShareDashboard",unsavedViewerPrompt:"Basics.UnsavedViewerPrompt",relativeHeight:"Basics.FillHeight",floatable:"Basics.Floatable",colCount:"Basics.ColCount",rowHeight:"Basics.RowHeight",rowCount:"Basics.RowCount",dashboardTheme:"Style.DashboardTheme",themeSwitchable:"Style.ThemeSwitchable",widgetsSpacing:"Style.WidgetsSpacing",borderShadow:"Style.WidgetShadow",borderBackground:"Style.BackgroundColor",transparentBackground:"Style.TransparentBackground",borderWidth:"Style.BorderSize",borderColor:"Style.BorderColor",borderRounding:"Style.BorderRounding",borderSpacing:"Style.BorderSpacing",worksheetPadding:"Style.WorksheetPadding",showLoadingIndicators:"Style.ShowDataLoadingIndicators",advancedCss:"Style.AdvancedCss",cssClasses:"Style.cssClasses"},{createConfigFromDashboardModel:function(n){var a=$.extend(!0,{},Hna);return n&&_.each(Jna,function(e,t){var i=n.get(t);_.includes(["borderBackground","borderColor"],t)&&_.isString(i)&&i.indexOf("#")<0&&(i="#"+i),_.set(a,e,i)}),a},createModelConfig:function(i){return _.mapValues(Jna,function(e,t){e=_.get(i,e);return e=_.includes(["borderBackground","borderColor"],t)&&_.isString(e)?e.replace("#",""):e})},SCHEMA:Ina}),Hna,Ina,Jna,DocumentGraphVisual=(aoa.prototype.determineDataSourceType=function(e){if(e.get("_viewType"))return"vs";return"virtual"===e.get("_dataType")?e.isMapping()?"vdsm":e.agent.subscriberCount()?"vdsa":"vds":e.isMapping()?"dsm":e.agent.subscriberCount()?"dsa":"ds"},aoa.prototype.displayGraph=function(r){var l=this,c=this;require(["vis"],function(e){var t=l.getTheme(),i="kx-light"===t?"black":"white",n=function(e){return _.extend({group:c.determineDataSourceType(e.model),borderWidthSelected:1,color:{border:"#999",highlight:{background:"#FFFF7A",border:"#1795D3"}},font:{color:"kx-light"===t?"black":"white",face:"FontAwesome, Arial",multi:"markdown",size:12},labelHighlightBold:!1,shape:"box",shapeProperties:{borderRadius:3}},e)}.bind(l);l.data={nodes:new e.DataSet(_.map(l.nodes,function(e){return n(e)})),edges:new e.DataSet(_.reduce(l.edges,function(e,t,i){return e.concat(_.map(t,function(e){return{id:i+"->"+e,labelHighlightBold:!1,width:1,selectionWidth:function(e){return e},shadow:!1,from:i,to:e,arrows:{to:!0}}}))},[]))},_.each(l.data.nodes._data,function(e,t){var i=c.data.nodes._data[t],n=i.model.attributes?i.model.attributes._subscriptionType:"";c.nodeSettings.push({id:t,counter:"streaming"===n?i.model.getExecutionRate().toFixed():1,metrics:i.model.performance?c.getPerformanceSummary(i):"",color:"#2bac76",strokeStyle:"#2bac76"}),i.model.agent&&i.model.agent.subscriberCount()&&c.data.nodes.update({id:t,title:c.getNodeDescription(i)})});var a={groups:{vs:{shape:"icon",icon:{face:"FontAwesome",code:"",size:30,color:i}},ds:{shape:"icon",icon:{face:"FontAwesome",code:"",size:30,color:i}},dsa:{shape:"icon",icon:{face:"FontAwesome",code:"",size:30,color:i}},dsm:{shape:"icon",icon:{face:"FontAwesome",code:"",size:30,color:"#48c2fa"}},vds:{shape:"icon",icon:{face:"FontAwesome",code:"",size:30,color:i}},vdsa:{shape:"icon",icon:{face:"FontAwesome",code:"",size:30,color:i}},vdsm:{shape:"icon",icon:{face:"FontAwesome",code:"",size:30,color:"#48c2fa"}}},layout:{improvedLayout:!0},interaction:{dragNodes:!0,selectConnectedEdges:!1},physics:!0};l.$graph=$('<div class="document-graph" />'),l.$graph.addClass(t),l.$graph.html(T.DocumentGraph({hierarchical:l.hierarchical})),$(r).append(l.$graph),l.$close=l.$graph.find(".close"),l.$mode=l.$graph.find(".mode input"),l.$overlay=l.$graph.find(".overlay");var o=l.$graph.find(".loading"),s=function(){a.layout.hierarchical=!!this.hierarchical&&{enabled:!0,nodeSpacing:400,treeSpacing:200,blockShifting:!0,edgeMinimization:!0,parentCentralization:!0,levelSeparation:150,direction:"UD",sortMethod:"directed"},o.show(),this.network=new e.Network(this.$overlay[0],this.data,a),this.network.on("doubleClick",function(e){var t;e.nodes[0]&&(t=e.nodes[0].split(":")[0],e=e.nodes[0].split(":")[1],_.includes(["ds","dsa","vds"],t)?c.onDataSourceSelect(e):_.includes(["dsm","vdsm","vdsa"],t)?c.onDataSourceSelect(e,null,1):"vs"===t&&c.onViewStateSelect(e))}),this.network.on("afterDrawing",function(){o.hide(),c.drawGraph(t)})}.bind(l);l.$close.click(l.remove.bind(l)),l.$mode.change(function(e){l.hierarchical=l.$mode.is(":checked"),l.network.destroy(),s()}),s()})},aoa.prototype.remove=function(){this.$close&&this.$close.off(),this.$mode&&this.$mode.off(),this.$graph&&this.$graph.remove(),this.network&&this.network.destroy(),this.documentGraph.unsubscribeAll(),_.isFunction(this.onClose)&&this.onClose()},aoa.prototype.drawGraph=function(b){var y=this;_.each(y.data.nodes._data,function(e,t){var i=y.data.nodes._data[t].model,n=i.path,a=y.$graph.find("canvas")[0].getContext("2d");a.font="12px Arial";var o=y.network.getPositions([t]),s="kx-light"===b?"white":"black";if(!_.isEmpty(y.nodeSettings)){var r=_.find(y.nodeSettings,{id:t}),l=r.metrics,c=-1!==t.indexOf("vds")||-1!==t.indexOf("vs")?10:13,d=-1!==t.indexOf("vds")?13:-1!==t.indexOf("vs")?5:10,p=i.attributes?i.attributes._subscriptionType:"",u="streaming"===p||r.counter<100?r.counter:"99+";if(a.lineWidth=3,a.beginPath(),a.arc(o[t].x+c,o[t].y-d,5,0,2*Math.PI),i.agent&&i.agent.subscriberCount()||n in y.activeViewStateToSubscriptions?(a.fillStyle=r.color,a.strokeStyle=r.strokeStyle):(a.fillStyle="kx-light"===b?"white":"#282828",a.strokeStyle="#999999"),a.fill(),a.stroke(),i.agent&&i.agent.subscriberCount()||n in y.activeViewStateToSubscriptions){r=o[t].x+c-6,n=o[t].y+6,c="streaming"===p?a.measureText(u+"pm").width:Math.max(12,a.measureText(u).width+4);if(a.beginPath(),a.fillStyle="#c9675b",a.save(),a.translate(r,n),a.moveTo(c/2,0),a.arcTo(c,0,c,12,Math.min(6,5)),a.arcTo(c,12,0,12,Math.min(c/2,5)),a.arcTo(0,12,0,0,Math.min(6,5)),a.arcTo(0,0,5,0,Math.min(c/2,5)),a.lineTo(c/2,0),a.restore(),a.fill(),a.fillStyle="white",a.textAlign="left","streaming"===p&&(a.font="7px Arial",a.fillText(" pm",r+a.measureText(u).width+8,n+7.7)),a.font="10px Arial",a.fillText(u,3+r,n+7),i.performance&&!isNaN(l.totalTime)){a.fillStyle=s;for(var h=o[t].x-20,g=o[t].y+35,m=["#e37466","#7bb6be","#fcba02"],f=[100*l.subscriptionPercent,100*l.executionPercent,100*l.dataModelPercent],v=0;v<m.length;v++)a.beginPath(),a.fillStyle=m[v],a.rect(h,g,f[v]/2.5,5),a.closePath(),a.fill(),h+=f[v]/2.5}}}})},aoa.prototype.getNodeDescription=function(e){var t,i,n=$('<div class="document-graph" />'),a=void 0,o=[];if(e.model instanceof QuickBase.DocumentDataModel&&e.model.agent.subscriberCount())return(o=e.model.agent.getSubscribers().filter(function(e){return!_.includes(e.substring(0,3),"ds")})).length&&(a=o.length+" subscriber",1<o.length&&(a+="s")),_.isEmpty(this.nodeSettings)||(t=(i=_.find(this.nodeSettings,{id:e.id})).metrics,i="streaming"===(e=e.model.attributes?e.model.attributes._subscriptionType:"")?"Execution rate per minute: "+i.counter:"Total executions: "+i.counter,e=!isNaN(t.totalTime)&&"streaming"!==e,n.html(T.DocumentGraphTooltip({bool:e,executions:i,label:a,subscribers:o,totalTime:t.totalTime.toFixed(0),subscriptionPercent:100*t.subscriptionPercent,executionPercent:100*t.executionPercent,dataModelPercent:100*t.dataModelPercent,subscriptionTime:t.subscriptionTime.toFixed(0),executionTime:t.executionTime.toFixed(0),dataModelTime:t.dataModelTime.toFixed(0)}))),n.html()},aoa.prototype.getPerformanceSummary=function(e){var t=e.model.performance.perf,i=t.paramChange||t.apply;t.serverStart<i&&(i=t.apply);var n=t.onAgentNotify-i,e=t.serverStart?t.serverStart-i:0,i=t.serverStart&&t.serverEnd?t.serverEnd-t.serverStart:n,t=t.serverEnd?t.onAgentNotify-t.serverEnd:0;return{totalTime:n,subscriptionTime:e,executionTime:i,dataModelTime:t,subscriptionPercent:e/n,executionPercent:i/n,dataModelPercent:t/n}},aoa.prototype.getTheme=function(){for(var e="dashboard-theme=",t=decodeURIComponent(document.cookie).split(";"),i=0;i<t.length;i++){for(var n=t[i];" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(e))return n.substring(e.length,n.length)}return""},aoa.prototype.onNodeUpdate=function(i){var n=this;return function(){var e,t;_.isEmpty(n.nodeSettings)||(e=_.find(n.nodeSettings,{id:i}),"streaming"===((t=n.data.nodes._data[i]).model.attributes?t.model.attributes._subscriptionType:"")?e.counter=t.model.getExecutionRate().toFixed():e.counter++,e.color="kx-light"===n.getTheme()?"white":"#282828",e.strokeStyle="#7fb4f5",setTimeout(function(){e.color="#2bac76",e.strokeStyle="#2bac76",t.model.agent&&t.model.agent.subscriberCount()&&n.data.nodes.update({id:i,title:n.getNodeDescription(t)})},300),n.data.nodes.update({id:i}))}},aoa);function aoa(e,t,i,n,a,o){this.nodes={},this.edges={},this.data={},this.nodeSettings=[],this.activeViewStateToSubscriptions={},this.onViewStateSelect=i,this.onDataSourceSelect=n,this.getDataSourceByPath=a,this.onClose=o,this.documentGraph=new QuickBase.DocumentGraph(e,t,a,this.onNodeUpdate.bind(this)),this.nodes=this.documentGraph.nodes,this.edges=this.documentGraph.edges,this.activeViewStateToSubscriptions=this.documentGraph.activeViewStateToSubscriptions}var PropertiesPanelDocument=Backbone.View.extend({$documentProperties:null,$propertyEditor:null,$connectionsBtn:null,$documentGraphBtn:null,className:"document-properties",initialize:function(e){this.api=e.api,this.appModel=e.appModel,this.dialogContainer=e.dialogContainer,this.viewModel=e.viewModel,(e=this.viewModel.get("selectedDocumentId"))&&(this.appModel.get("documents").get(e)?this.onDocumentChanged():this.listenToOnce(this.appModel.get("documents"),"reset",this.onDocumentChanged)),this.listenTo(this.viewModel,"change:selectedDocumentId",this.onDocumentChanged),this.initEvents()},initEvents:function(){var i=this;this.$el.on("click",'[name="root[Basics][Link]"]',function(){this.select()}),this.$el.on("dblclick",'[name="root[Basics][Link]"]',function(){var e,t,t=(e=location.href,t=e.indexOf("edit"),(t=e.substr(0,t)+"#"+i.model.id).match(/^((([A-Za-z]{3,9}:(?:\/\/)?)(?:[\-;:&=\+\$,\w]+@)?[A-Za-z0-9\.\-]+|(?:www\.|[\-;:&=\+\$,\w]+@)[A-Za-z0-9\.\-]+)((?:\/[\+~%\/\.\w\-_]*)?\??(?:[\-\+=&;%@\.\w_]*)#?(?:[\.\!\/\\\w]*))?)$/)?t:"");window.open(t,"_blank")})},initializeEvents:function(){var e=this;this.listenTo(this.model,"change",function(){this.editor&&this.editor.setValue(_.extend(this.editor.getValue(),DashbordDefinition.createConfigFromDashboardModel(e.model)))}),this.listenTo(this.model,"detail-downloaded",this.onDocumentChanged),this.listenTo(this.model.get("popups"),"add remove change",this.onPopupsChange),this.listenTo(this.model.get("popups"),"remove",this.onPopupRemoved),this.listenTo(this.model.get("Shortcuts"),"add remove change",this.onShortcutsChange)},applyDashboardTheme:function(e){this.model.set("dashboardTheme",e),this.viewModel.set("DashboardTheme",e)},onDocumentChanged:function(){var e;this.remove(),(e=this.viewModel.get("selectedDocumentId"))&&(this.model=this.appModel.get("documents").get(e),this.model&&(this.render(),this.initializeEvents(),this.applyDashboardTheme(this.model.get("dashboardTheme"))))},onPopupsChange:function(){this.editor&&this.editor.setValueByPath(this.model.get("popups").toJSON(),"root.Popups")},onPopupRemoved:function(){this.popupView&&!_.includes(this.model.get("popups").pluck("id"),this.popupView.model.get("id"))&&(this.popupView.remove(),this.popupView=null)},onShortcutsChange:function(){this.editor&&this.editor.setValueByPath(this.model.get("Shortcuts").toJSON(),"root.Shortcuts")},remove:function(){this.model&&this.stopListening(this.model),this.documentGraph&&this.documentGraph.remove(),this.editor&&this.editor.remove()},render:function(){var e=this;e.$el.html(T.PropertiesPanelDocument()),e.$documentProperties=e.$el.find(".document-properties"),e.$propertyEditor=e.$el.find(".property-editor"),e.$connectionsBtn=e.$el.find(".connectionMgmtBtn"),e.$documentGraphBtn=e.$el.find(".documentGraphBtn"),e.model.get("dashboardTheme")&&_.delay(function(){e.applyDashboardTheme(e.model.get("dashboardTheme"))},1e3),e.$el.find(".connectionMgmtBtn").button({icons:{primary:"fa fa-cogs"}}).click($.proxy(e.openConnectionsDialog,e)),e.$el.find(".documentGraphBtn").button({icons:{primary:"fa fa-sitemap"}}).click($.proxy(e.openDocumentGraph,e)),e.renderPropertyEditor()},renderPropertyEditor:function(){var e,n=this,t=n.model.get("popups").toJSON(),i=n.model.get("shortcuts")||[],a=this.model.get("screens"),o=QuickBase.NotificationManager;o.setDocumentDataModel(n.appModel.get("documents").get(n.viewModel.get("selectedDocumentId")).get("data")),n.stopListening(n.model,"basePanelLayoutChanged",n.onBasePanelLayoutChanged),n.editor&&n.editor.remove(),a&&a.length&&(e=o.CONFIG.upgradeConfig(n.model.get("notifications")),a=$.extend(!0,{},DashbordDefinition.SCHEMA,o.CONFIG.SCHEMA,{properties:_.omit({Permissions:{type:"backbone",options:{collapsed:!0,parameters:["model"],view:DashboardPermissions}},Screens:{type:"backbone",options:{collapsed:!0,parameters:["appModel","model","viewModel"],view:ScreenList}}},n.appModel.get("isLite")?["Permissions"]:[])}),e=$.extend(!0,{},e,DashbordDefinition.createConfigFromDashboardModel(n.model)),_.set(e,"Popups",_.map(t,function(e){return e.Actions=e.Actions||[],_.omit(e,"widgets")})),_.set(e,"Shortcuts",i),_.set(e,"Permissions",{}),_.set(e,"Screens",[]),_.set(e,"Basics.Link","../"+(n.appModel.get("saml")?"?auth=saml#":"#")+n.model.id),n.editor=new PropertyEditor(a,e,null,n.$propertyEditor[0],n.api),n.editor.subscribe(function(e){var i,t;e===PropertyEditor.ChangeType.Value&&(t=n.editor.getValue(),t=$.extend(!0,{},t),e=_.pick(t,"Notifications"),o.setOptions(e),n.model.set("notifications",e),i=_.pick(t,"Popups"),n.model.get("popups").length===i.Popups.length&&!n.model.get("popups").some(function(e,t){return e.changedAttributes(i.Popups[t])})||n.model.get("popups").commandSet(i.Popups),n.model.set("shortcuts",t.Shortcuts),t=_.omit(t,"Notifications","Popups","Shortcuts"),t=DashbordDefinition.createModelConfig(t),n.model.get("dashboardTheme")!==t.dashboardTheme&&n.applyDashboardTheme(t.dashboardTheme),n.model.changedAttributes(t)&&n.model.commandSet(t),n.editor.reloadHeaderTemplates())}),n.listenTo(n.model,"basePanelLayoutChanged",n.onBasePanelLayoutChanged))},openConnectionsDialog:function(){new ConnectionManagement({container:this.dialogContainer,docViewModel:this.model.get("viewState"),appModel:this.appModel})},openDocumentGraph:function(){var e=this.viewModel.get("selectedDocumentId"),e=this.appModel.get("documents").get(e);try{this.documentGraph||(this.documentGraph=new DocumentGraphVisual(e.get("viewState"),e.get("data").flatten(),this.api.showViewStateDialog.bind(this.api),this.api.showDataDialog.bind(this.api),e.get("data").getByPath.bind(e.get("data")),function(){this.documentGraph=null}.bind(this)),this.documentGraph.displayGraph("body > div > .content-panel"))}catch(e){}},showPopupEditor:function(e){e=this.model.get("popups").get(e);this.popupView&&this.popupView.remove(),this.popupView=new QuickBase.PopupView({viewModel:this.viewModel,appModel:this.appModel,model:e,isEditing:!0}),this.popupView.toggleDialog(!0)},onBasePanelLayoutChanged:function(){var e;this.editor&&(e=this.editor.getValue(),_.set(e,"Basics.ColCount",this.model.get("colCount")),_.set(e,"Basics.RowCount",this.model.get("rowCount")),_.set(e,"Basics.RowHeight",this.model.get("rowHeight")),_.set(e,"Basics.FillHeight",this.model.get("relativeHeight")),_.set(e,"Basics.Floatable",this.model.get("floatable")),this.editor.setValue(e))}}),PropertiesPanel=Backbone.View.extend({KEYCODE_C:67,KEYCODE_V:86,$pinButton:null,$documentPanel:null,$propertiesPanel:null,$expandBtn:null,documentProperties:null,prevComponentModel:null,copiedJson:{},clipboardCopied:{},initialize:function(e){this.options=e,this.appModel=e.appModel,this.dialogContainer=e.dialogContainer,this.viewModel=e.viewModel,this.$el.html(T.PropertiesPanel()),this.$panelHeader=this.$el.find(".panel-header"),this.$properties=this.$el.find(".panel-content"),this.$properties.hide(),this.$propertiesPanel=this.$el,this.$documentPanel=this.$el.find(".panel-document"),this.$pinButton=this.$(".pin-button"),this.$expandBtn=this.$(".expand-button"),this.$lblWidgetName=this.$(".lblWidgetName"),this.$dashboardHelp=this.$(".dashboardHelp"),this.$searchInput=this.$(".searchInput"),this.$searchIcon=this.$(".searchIcon"),this.api=new PropertiesPanelApi({appModel:this.appModel,dialogContainer:this.dialogContainer,viewModel:this.viewModel}),this.api.setDocument(this.appModel.get("documents").get(this.viewModel.get("selectedDocumentId"))),this.documentProperties=new PropertiesPanelDocument({el:this.$documentPanel,api:this.api,appModel:this.appModel,dialogContainer:this.dialogContainer,viewModel:this.viewModel}),this.copiedJson=null,this.render(),this.debouncedSubComponentSelected=_.debounce(this.onSubComponentSelected,100),this.initializeEvents(),this.onPropertiesPinnedChanged()},initializeEvents:function(){var t=this;this.listenTo(this.viewModel,"change:selectedDocumentId",this.onViewModelSelectedDocumentChanged),this.listenTo(this.viewModel,"change:selectedWidget",this.onViewModelSelectedWidgetChanged),this.listenTo(this.viewModel,"change:selectedWidgetId",this.onViewModelSelectedWidgetIdChanged),this.listenTo(this.viewModel,"change:selectedSubComponent",this.debouncedSubComponentSelected),this.listenTo(this.appModel,"change:propertiesPinned",this.onPropertiesPinnedChanged),this.listenTo(this.api,"showPopupEditor",function(e){this.documentProperties.showPopupEditor(e)}),this.listenTo(t.api,"startInspecting",function(){this.trigger("startInspecting")}),this.listenTo(t.api,"stopInspecting",function(){this.trigger("stopInspecting")}),this.$pinButton.on("click",function(){t.appModel.set("propertiesPinned",!t.appModel.get("propertiesPinned"))}),this.$expandBtn.on("click",function(){t.appModel.set("propertiesPinned",!t.appModel.get("propertiesPinned"))}),this.$searchInput.on("keyup",function(e){27===e.keyCode&&(e.preventDefault(),t.$searchInput.val(""),t.editor&&t.editor.filter(null))}),this.$searchInput.on("input",function(){t.editor&&t.editor.filter(this.value)}),this.$searchInput.on("blur",function(){this.value||t.togglePropertySearch()}),this.$el.on("paste",$.proxy(this.onPaste,this)),$(window).on("keydown",$.proxy(this.onKeyDown,this))},getArgs:function(e,t,i){var n=_.clone(t.attributes),t="",i=i?e.get("appArgs").json:n;return n.Basics&&n.Basics.Data&&(t=n.Basics.Data),e.get("appArgs")[t+"Args"]&&(i=e.get("appArgs")[t+"Args"]),_.omit(i,"version")},getSchema:function(e,t){return e.get("appArgs").schema},handleLinkButton:function(t,n){var a,i=[],e=this.appModel.get("documents").get(this.viewModel.get("selectedDocumentId"));this.appModel.get("documents").each(function(e){i.push({title:e.get("name"),value:e.id})}),_.isEqual([],i)?t.possible_dashboards=[{title:"none",value:"none"}]:(i.unshift({title:"none",value:"none"}),t.possible_dashboards=i),t.possible_viewstates=[],_.each(e.get("viewState").getViewStateList(),function(e){t.possible_viewstates.push(e.path)}),t.possible_viewstates.sort(),a=n.get("ViewState"),this.listenTo(n,"change:ViewState",function(e,t,i){a.target_screen!==t.target_screen&&"none"!==t.target_screen&&(n.get("ViewState").target_dashboard="none"),a=t})},onPropertiesPinnedChanged:function(){this.appModel.get("propertiesPinned")?(this.$pinButton.find("i").removeClass("fa-caret-left").addClass("fa-caret-right"),this.$propertiesPanel.removeClass("unpinned")):(this.$pinButton.find("i").removeClass("fa-caret-right").addClass("fa-caret-left"),this.$propertiesPanel.addClass("unpinned"))},onViewModelSelectedDocumentChanged:function(){var e=this,t=e.appModel.get("documents").get(e.viewModel.get("selectedDocumentId"));t&&this.listenToOnce(t,"view-state-init",function(){e.api.setDocument(t)})},onViewModelSelectedWidgetChanged:function(e,t,i){var n=this.viewModel.get("selectedWidget");n?(this.viewModel.set("selectedWidgetId",n.id,{silent:!0}),this.showWidgetProperties(n,i.reset),this.$el.removeClass("doc")):(this.viewModel.set("selectedWidgetId",null,{silent:!0}),this.showWidgetProperties(null,i.reset),this.$el.addClass("doc"))},reloadHeaderTemplates:function(){this.editor.reloadHeaderTemplates()},showWidgetProperties:function(e,i){var n,a,o,s=this;if(this.prevComponentModel&&(this.stopListening(this.prevComponentModel),this.prevComponentModel=null),this.dontRemoveSubComponent)this.dontRemoveSubComponent=!1;else if(this.viewModel.get("selectedSubComponent"))return void this.viewModel.set({selectedSubComponent:null});if(s.editor&&(s.$el.find(".btnBulkEditor").off(),s.$el.find(".btnReset").off(),s.editor.remove(),s.editor=null,s.$panelHeader.removeClass("search-open")),e&&(n=e.get("component")),!(n=(o=this.viewModel.get("selectedSubComponent"))?o:n))return this.$searchIcon.off("click"),this.$lblWidgetName.text(t("dashboard")),this.$documentPanel.show(),this.$properties.hide(),void(this.componentItem=null);this.$documentPanel.hide(),this.$properties.show(),n&&(s.componentModel=a=n.get("options"),s.api.setWidget(e),s.componentItem=n,o=(o=s.appModel.get("components").get(n.get("definitionId")))||s.appModel.get("components").find({appKey:n.get("key")}),s.componentOptions=n.get("options"),window.ops=s.componentOptions,this.$lblWidgetName.text(o.get("componentName")),this.$dashboardHelp.off("click"),this.$dashboardHelp.click($.proxy(this.onDashboardHelp,this)),this.$searchIcon.off("click"),this.$searchIcon.click($.proxy(this.togglePropertySearch,this)),o.get("appArgs")&&(e=s.getArgs(o,s.componentOptions,i),i=s.getSchema(o,e.Basics?e.Basics.Data:null),!a.get("Basics")||"GeoMap"!==a.get("Basics").ComponentName&&"ContextMenu"!==a.get("Basics").ComponentName||s.handleLinkButton(e,a),s.stopListening(a,"change",s.onComponentModelChanged),s.listenTo(a,"change",s.onComponentModelChanged),s.stopListening(a,"quickStart",s.onComponentQuickStart),s.listenTo(a,"quickStart",s.onComponentQuickStart),s.stopListening(a,"transform",s.quickStartTransform),s.listenTo(a,"transform",s.quickStartTransform),s.prevComponentDefinition=o,s.prevComponentModel=a,s.editor=new PropertyEditor(i,e,s.componentOptions.expanded,s.$properties[0],s.api,n.get("hasOnSettingsChange")),s.editor.subscribe(this.onEditorChange.bind(this))))},onComponentQuickStart:function(e){this.editor.focusItemByPath("root."+e)},quickStartTransform:function(e,t){this.editor.setValueByPath(e,"root."+t)},onComponentModelChanged:function(e,t){e=_.clone(e.attributes);this.editor&&this.editor.setValue(_.omit(e,"version"))},onDashboardHelp:function(){var e,t;this.componentItem&&(t=/\s/g,t={radarchartbeta:"radar",layoutpanel:"layout",bipartitechart:"bipartite",reportmanagement:"reportmanager"}[e=this.appModel.get("components").get(this.componentItem.get("definitionId")).get("componentName").toLowerCase().replace(t,"")]);new QuickBase.HelpDialog({appModel:this.appModel,container:this.dialogContainer,viewMode:this.viewModel,tag:t||e})},togglePropertySearch:function(){this.$panelHeader.toggleClass("search-open"),this.$panelHeader.hasClass("search-open")?(this.editor&&this.editor.filter(this.$searchInput[0].value),_.defer(function(){this.$searchInput.focus()}.bind(this))):this.editor&&this.editor.filter("")},onEditorChange:function(e){e===PropertyEditor.ChangeType.Expanded?this.componentOptions.expanded=this.editor.getExpanded():(e=this.editor.getValue(),e=_.extend({},e),this.componentOptions.commandSet(this.componentOptions.changedAttributes(e)),this.reloadHeaderTemplates(),this.args=this.getArgs(this.prevComponentDefinition,this.componentOptions,!1))},createClipboardEvent:function(){try{var t=new ClipboardEvent("paste");navigator.clipboard.readText().then(function(e){this.clipboardCopied=e.toString(),this.$el[0].dispatchEvent(t)}.bind(this)).catch(function(e){QuickBase.Log.Info("Please enable Clipboard Access to copy and paste via Property Panel Icons")})}catch(e){this.showModal()}},showModal:function(){new QuickBase.ErrorDialog.ShowError("Pasting is unavailable via this action currently, but you can still use: CTRL-V for paste")},onKeyDown:function(e){if(112===e.keyCode&&(e.preventDefault(),e.stopPropagation(),this.onDashboardHelp()),this.editor&&this.editor.getFocusedPath()){var t,i=e.keyCode;if(e.ctrlKey||e.metaKey)switch(i){case this.KEYCODE_V:this.pastePath=this.editor.getFocusedPath(),this.clipboardCopied=null,e.originalEvent?(this.$el.attr("contenteditable",!0),this.$el.focus()):window.Promise?this.createClipboardEvent():this.showModal();break;case this.KEYCODE_C:this.copiedJson=this.editor.copy(),this.copiedJson&&(t=QuickBase.ComponentOptions.setDataProperties(this.getCopyJSON(this.copiedJson)),this.copy(JSON.stringify(t),!1))}}},getCopyJSON:function(e){var t,i,n={},a=this.appModel.get("documents").get(this.viewModel.get("selectedDocumentId"));return n._property=this.copiedJson,i=CopyPasteHelpers.getComponentViewStates(this.copiedJson),n._dataSources=_.extend(CopyPasteHelpers.getComponentDataSources(e,i,a),CopyPasteHelpers.getMappingDataSources(i,a)),n._viewState={},_.each(i,function(e){(t=a.get("viewState").getByPath(e))&&(n._viewState[e]=t.toJSON(),"dict"===t.get("_type")&&(n._viewState[e]._default=_.mapValues(t.get("_default"),function(e){var t;return e instanceof Backbone.Model?(_.includes(i,e.path)||n._viewState[e.path]||(t=a.get("viewState").getByPath(e.path))&&(n._viewState[e.path]=t.toJSON()),"<%"+e.path+"%>"):e})))}),n},copy:function(e,t){var i,n;if(navigator.clipboard)navigator.clipboard.writeText(e).then(function(){$("window").focus()},function(e){$("window").focus()});else{(i=$(document.createElement("textarea"))).css({position:"absolute",width:0,height:0,top:0,left:0}),i[0].value=e,i.appendTo(this.$el),i[0].focus(),i[0].select();try{document.execCommand("SelectAll")&&(n=document.execCommand("copy",!1,null))}catch(e){console.log(e)}i.remove(),$("window").focus(),t&&t(n)}},onPaste:function(e){if(this.pastePath){var t,i,n,a,o;if(this.editor.canPaste(this.pastePath)){if(e.stopPropagation(),e.preventDefault(),this.$el.removeAttr("contenteditable"),e=e.originalEvent.clipboardData||window.clipboardData,!this.clipboardCopied&&!e)return void QuickBase.Log.Info("Please copy a property section prior to pasting");if(this.clipboardCopied)t=this.clipboardCopied;else if(!(t=e.getData("Text")))return;if(!t)return;e=this.appModel.get("documents").get(this.viewModel.get("selectedDocumentId"));try{(o=JSON.parse(t))._property&&(CopyPasteHelpers.mergeViewStates(o._viewState,e),n={},a={},_.each(o._dataSources,function(e,t){"virtual"===e._dataType?a[t]=e:n[t]=e}),CopyPasteHelpers.mergeDataSources(n,e),CopyPasteHelpers.mergeDataSources(a,e),(i=this.convertToModel(JSON.parse(t)))&&this.editor.pasteProperties(i._property,this.pastePath))}catch(e){console.log("cannot get pasted data",e)}}this.pastedEditor=null}},convertToModel:function(i){var n=this,a=n.appModel.get("documents").get(n.viewModel.get("selectedDocumentId"));return i instanceof Object&&_.each(i,function(e,t){e instanceof Object&&e._dashboardsType?"viewstate"===e._dashboardsType?i[t]=a.get("viewState").getByPath(e.value):"data"===e._dashboardsType&&(i[t]=a.get("data").getByPath(e.value)):n.convertToModel(e)}),i},onSubComponentSelected:function(){this.viewModel.get("selectedSubComponent")&&(this.dontRemoveSubComponent=!0),this.onViewModelSelectedWidgetChanged(null,null,{reset:!1})},remove:function(){this.$pinButton.off(),this.$expandBtn.off(),this.$searchInput.off(),this.$searchInput.off(),this.$el.off(),Backbone.View.prototype.remove.apply(this,arguments)}}),ComponentListView=Backbone.View.extend({tagName:"div",attributes:{draggable:!0},initialize:function(e){var i=this;i.options=e,i.$el.html(T.ComponentListView(i.model.toJSON())),i.el.setAttribute("title",t(i.model.get("componentName"))+" - "+t(i.model.get("componentDescription"))),e.dblclick&&i.$el.dblclick(function(){e.dblclick(i.model)}),i.proxiedOnDragEnd=$.proxy(this.onDragEnd,this),i.proxiedOnDragStart=$.proxy(this.onDragStart,this),i.initializeEvents()},initializeEvents:function(){this.el.addEventListener("dragend",this.proxiedOnDragEnd,!1),this.el.addEventListener("dragstart",this.proxiedOnDragStart,!1)},onDragEnd:function(e){this.options.onDragEnd&&this.options.onDragEnd()},onDragStart:function(e){var t=e.dataTransfer,e=this.model.id.toString();t.effectAllowed="copy",t.setData("text",e),this.options.onDragStart&&this.options.onDragStart(e)},remove:function(){this.el.removeEventListener("dragend",this.proxiedOnDragEnd),this.el.removeEventListener("dragstart",this.proxiedOnDragStart),Backbone.View.prototype.remove.call(this)}}),ComponentDialog=Backbone.View.extend({$img:null,$fileInput:null,$uploadBtn:null,appModel:null,className:"component-dialog",dataView:null,propertiesView:null,isModelChanged:!1,initialize:function(e){var i,n,a,o=this;this.appModel=e.appModel,this.updateFn=e.updateFn,n=[{text:t("Save"),click:$.proxy(o.onSaveButtonClick,o),icons:{primary:"fa fa-floppy-o"}},{text:t("Cancel"),click:$.proxy(o.onCancelButtonClick,o),icons:{primary:"fa fa-times"}}],a=(e.model?"Edit":"Add")+" Widget",e.model?(this.editModel=new Backbone.Model(e.model.attributes),n.splice(1,0,{text:t("Delete"),click:$.proxy(o.onDeleteButtonClick,o),icons:{primary:"fa fa-trash-o"}})):(i=QuickBase.Helpers.getGUID(),this.editModel=new Backbone.Model({id:i,componentName:t("my component"),componentDescription:t("A description of my component"),appKey:"",listViewThumb:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAAyCAYAAACXpx/YAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyJpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoV2luZG93cykiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QTMzQURFOTkxOEY2MTFFNUFDMEJBRDUyMDNDODMyQkMiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QTMzQURFOUExOEY2MTFFNUFDMEJBRDUyMDNDODMyQkMiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDpBMzNBREU5NzE4RjYxMUU1QUMwQkFENTIwM0M4MzJCQyIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDpBMzNBREU5ODE4RjYxMUU1QUMwQkFENTIwM0M4MzJCQyIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pnt3JAMAABOnSURBVHja7FxpdBzVlb61dFV19d6tVrd2ybJWLxLeMGAgGAM2sTMD5kDOTAJkYRlmCXNmmJksJ2TCARKSyY+cnGGGGUMyYcZkbBaDccY2tsEsNtjyImwtXmTt6pa61Yt6qequrpp3qyVhvKnbBNkRfj7tLlVX1at637vf/e597xWlaRpMR6l7bLv+jdXNKTaDzWiA6kIR/EkK3BYBMurU90GOERZXWZ+dW2JawjI0p2S0TFxWkpKiRZ0i628bjA9GpUy/aKC6Nx8NddW5BX/fqOwXWEpJpDJQ4uBh48EAJNIq0FT2mlirwAAYmew2lhq3CHcv8YKqqrDp0AhUOgXgWBrG5AxQ5LwxKQNGloJURoUG8ixvd4zqJ1uMLJTaeTg+nICW3ghwDD3lMx388bLPtd1ZuEQFgRYMDEjhBNTOMsPNjW5QpgbZ7TDz91Ok3TSV/EUam6YE/NLPrXQb9YNSigq3zS+AaFKJEDCG/BH5+Ggsvf+YP/GyrKhHM6TyiZo0/V4omKmFvdQ3IKUz8MJ7fVBBrIQnVpImVkGdv1OkDSwTFnnWrmqnQzRp4ZPbaGl20WBzmgy2WW5jPU1Rawjg/0Ss/dHXDo08Jxg+sS6F1KnpPSZb8DITn1yY5QrAFyik4XVgkdYYAlahVdBBPhfKBFOlQtXS+m/a1AyBlpoh2+lM9mATzxgfuLHk6XZfbH1SUccYKlvJSESCuKQBTWcBZRnKZuToZpWcbDOyvWTfEGEFSSLUTn4bB526AnCuhSEOMZxIw8GeMPzF8iowEN+lnkMbEJdIk2MZuEijwtNSaSXhFTWCEaV3LoXsFGkha8kEOK+Va3hkRcUmr42vwXtYWO1IhuOp/nBc6RgISQf7Q1LLYEhuldOZbgQcz8Hj6MsUcPZyuRH0x51DMVj3bj84zTwB89MoojVaBZb/Sy/5MQcLPhdTGIj1/eeO409tb/UlRI7R6yi0m6Cq0KpvJwlgyxudf1XjEWtiREhhxzPxtNEqGGsqCqiaqyqta5ANYpIS90XktlMjiffJ37uMBmZfJKEMGVgVNO0KwBcsvlASghH5LMGFf3usvJOmKTFfcBnCCCJ50v/Y1vb4+n0jz3IcD3EVJpV078gYYDSRICpZyxS6sGpt3ORxv3qGrzcLrKlONCxuLLEsJtT96DWzHaOkc35wzBd/dSQiv0lcjB9pPENpVwA+IwyC2UQJN5XbzhI3SIOkYZ0sMUUtD4RJOAWxZEr+t7c7v/H2x0PrDZyR+FpKvwICnMmkdQA1vf4MtHQFt3x5YfE9U93n6fdHhJzzhnrX6hvqnKuDsbR/3Tu9jxI6f8lIWOIKwOcInY4RwXVwIAYEzEnPhvR5Y52zEKkVt3MpFKFlltZg/a62B366Y2R9uZgB3gC638UrZ5QUDATlye6CWuyN/b0b7lpS/FhDuWtuMpXJqR5kF2X8WI+N8xSYmCaOyrwk0HAF4LNBAQjGJDASuypzGCEzjqVEGtBr4SqByl3M8CQU2nmob8P2Vv9viy0ccMT25XHuRTDNWoLsS6Atj1cOhKaV5LNbWh995lvXb6UpmlHzcKro54lYTO9uG/ptQpJASdNXAD53QxFfTEIXhsQtiprNaCRTChSYudqcO4quujV48UPfs0fDNFh4DcY0A6F6Rbc4nkUBxYHhjBiaE3g42B3esadtcONNTeX35GrFEx1q/8nA3r5Ass3CsZdFJHVJM1kKMSNMIcaJuMFtZTxeRUsYIgDPKbaATRR0/yulVCi08ZU55x0o0OPpUUkdZlgGFCobyCjoy40sfKma+HmF0H6jC2LxJBTZ+Ulhh2CLHP0/clq9J1/2ae8L/85hYsn5bP5Sf6YALJOGtRnBUuQQbl1bZFlALM1gFZiuAgv3BgF5IJt6VMEXlcDMswQoPWQRPTa+OtfMEnYgTKA0ekyzomPyURQ82FEwgdVYYobqAhE6BseI0mVh+9FRuHVeoR5/I3tgjCxllACmPA3E0nNhaRRuJF5OtQ9EttmJZGd0iU6d1QEmbh81AEXNMICxoZLpDKrktd9eXvVUscNYi0l8ajzbtKDK8aPW7tB31+/tfwGfvjuYwHSj3iEKrXypTTQUqWo+CpqCRVX2tVsODb0h8gzYieV6zJzucSeyW2hlGPNaTUbYfSwII7EUUdYaNFfa3V8m5yDIuRQcWDjiGzt8uDd6gmXp86pvTJGSPqMPVCiZz9/Cp00FoEXKaQW+dk3pQ4+vbdxY7hJrdYqWsxSNDeky855bm4uev7bW9c/IbqFEGvpJXMwRoJwmrlbkWS4f0YNqe2WT9+7ZReZFfsIGmOhAP3lmH0FLMuh1GKDlVBi2HhmGYrtwD+7LPRsHcPDU6FtRKa3JpBOf/kkp2W8TR0OFywgVTh6SkgzHh6Mzx4Kt5OEaq+yLfnBH4y+RoKRzhDroM1E1P7B81g9jSSX2k80dP5tXZgWJdID6YksTNng+vR6tXeAY46/ubf7f773UetfJ4fiBIit3zmPT5Ni6IjPMKxLh+lrn6jULi+9KptS83E4sLr+9uMKqDy2eHkIhI+DHQjoQMreWofQQkJlJFO0xG+Chm2c9KXA0h1Z7XlAIfkTcwIM3V/9EU9Wj88rtW17b12+f7bV8VVXzrxcb3mM3Vv3sa81vv9Ey8C+HukZ/Q/Z1I2PgSBYCgEoZOxcBVFg+1/ONP11S9gxL04Z0Rs3ReikIjsmRQFRqNQusLhInG5jwcSSW1sHMaNM/SDFtANvM3PzmSucKKQerGB/RoR++tWZDYEz+/fdK59QX2oQ5spI/wticSI/Ef1u+edOsHw0vKPn7wVDio0BEai2wCl0lDmP8lqYi9yyPpabAwi9z24Q6dAO5gjvh6/2hZMdgKOnDzBk1XjHWW+Wxks00qHBpyrQBvKy24HaTwNAXst4zQSaWQJSzsJYaD3k+kwbQwzAdaLPLbF+ulcFytDS87jW1BcRPanreOXURnQgV9EAw3ioTJqD5rOrGfR4SKhi5S5vsmDaAr6l1zctXNeqC6g8sNM/MI2PJtdNdiCVODsdaZHK/FA4fEl9yc70HfGHpkk8YmDaAg/F0AVJZSoEZVZBd0Ic7RLbr6monEVgMfNwX0cXi5TB0OG0Ak1Ano2kw4woOaCRlRdl1xNfrCyeJErdiiDXJFPjQ2AEymgoqlR1MoWciwEpK7pmB+GZz3pqWPhFMxgdHk7DyqlIIxWSQCFU5zfzcMrdp1bJ6TxMOYPUH43s6ByPrY4lUcMYB/OZHp95c3lz+cL7WoV3mZo8ultCysGpOYWEwKvVjsoRnqab5la7H51c61wgcy542RffPhsPJx17cdfxvDveGNk3Hk00bW+xv796652j/+2Zh6kFwnIGB4QbOjcURpcu5YAfkDQz1lasrvt9Qal9UWmD+6b3La/curi28g6ZpFkMlpGj84JAnCc3K/3rNnJebK12rMxl15liwL5JM//x3795X7Lxta1mRszpF4uEz044IKsdSMByKD2zd2/bEyYHQ0fvXLH2l2GVxKxn1sgUZ7212ke3OcrflTj0VquLkvnMrcwzDSIdg/uGOec+Fx5Lzya7AjLBgVJcjodjJ1985fMPxHv+LaUWRyYMCWjR+G1gaguFY/6bdR57afaBzYUe3/98H4tR7g8F4C8tc/lNUs8kZWo+3p8qXo1WXu01F1zV47p0xFjxhoYTSBjtODX195/5jTzqtpls1iq4vLbAmDx/v35OU0zu7hkKjNzZVgkwZYXaxA6wiT/2xTD7PRy/gIzWUO1eSzV/MGIAnhBNHLDYSS3YMDEc6dhzogrU3zoGBQBS8TjOYBAPIKgtpioNTvghLDi+jYOYtLUkrGlQUmCpmlAV/SkgR8cQZWDAZOf0bKRwtPJxQoDuYAq/DiNTt8jjEkoyqzjiA0do5ljbMGBWdwyPr47cOVwEkiI8aiUo4KF9t5FjbZ2FoZAzMOVPjn8ulYGcORKXwjLXgM5MFCELniAKShtadwuwQlHtsc0wCe1G5Ykz2I0ukFRxwV1Lo9sjfgsAbJpWv+gfw7QgUDhem87weRn/D4fhxANfMBlhfOUA+cU3UR3sERtUzAgqJgeu8lusvSrETHx9Pyv4Tvb4X3z90cpuiUScbKgszu/Z3ehY3VjTVVXhvLy9yrTKLAne+cCZXcH3BSFefL7hjfk3Zn/OcQcw1nNMHKPoDW2FB+cwFGDM8JoGDAz0xoDkjAYYaBx3AyLNcdbH9aiXP9sew68OjPZt7h4KPaJraNzw6BrTBoE8X8o+OdbefGvowEBp7bue+9uaV1859uqbCuzKVyuQ9aIV0Tzpk5vnN++6TkvH3Nr/f/vsffPO2jSzD0FOpfuyAPf6ob097/yuPfGXBzPLBSJ04e9GAY6hhGXh7IRgEI+BiEsxgMeOr4otd5oYSl3l2PuPAOLHurQNd//fD59+6k7R9n8Cx4xRKZ1c5MFlhh590Wjn08lv7V7+68+B/GYX8l5hg3N7jjxw/MSx90B/OwM59na+++c6hv8Xbv5Cvx3thKA3WbWn57lut/TPHB6f1WYQUROIp2HMsAB+diEA8haAyMBqLfOrYuKRAc7X7ZrORpeNSbiaMDReMJELrXv/owXAslR4IxKCmxHHOqanoM5FK2/tCmW37Tz3YUFXUVF/pbZLzoGtkn0AkcdBtE1WKEmF4xAQ9Q4Ffnuzz26pKvT8GioaMvrBcm+zY2MFShEn2Hel5/GjX4K9N/OcuoqcP4OoSN+CC6329SeJfk0AzLNjE7Hg+dQaR4CzKq2s9a/KJjgSOgpff7XqpKyD3WWx2eK1lEBaOSlAokkY97ToMlQX3uH8MxtLEFVgs8ht7Op6or/RszCvMIwCf9I91ftwfApGEegajWZ86G47Gn9h7uHOQgPx3Lru5wcBmmzielFKBUHTPuweO/ZwGbbORx8l/iZkD8LL64pyyPahEjbxh1pyKgqVyOr/4t+XU6K4QAS0la/p7N945EQYzUeQrm4on1S5a6YmhMWBYAUoKRF3gDQbiu0fCiZDDKjpyHQCQFQ2cRnboziWVOuWPRmLk4ZK6pfqD4XWdPf7/HgklmjlGKye9OWky8scIxp24MtLrME9fODZdFXUMjOZ0XIKERysXVa2xmTkhmU94pOHrFjjRLvIgCuykWEspDAySti8IjEF3IAEtfg2iiVR2aiu+h4P8RyLkwANRyee2mwjAuQisbH0HukaOd/aN6kkaFFZXlZt16iZCC12G1OcP7VXkxF6KsFV9VUk2VTvNy1mmDWADTeWEEnG79ILZnq/nm7zCZlta612992jfb0Se/RQYfSNx6PWFwekqBAfNTAKE31r2RSu8wDFi7pPqKUgQZ7qo2u1vqnBlr0f+U5X0p+ZgGQjwtMoCAkzTlybJMm0Aex3ilMcohPbKCi1L68tdC/KNT5HOl9QXrbKYhFl9I9EutKpPYu2syHHbBX2K60RCYmI+VXOtu7mi0FqqKLnPg44lU9ENu9uDeJ8T86BxjvWfLK0EC3f5JAinz4JzGPIjoQ3Uljm/ZeIZKiblBzBajsPCm+68ruYf/3VTy0OigT4rseALRPRkyuwSJ3gcJti456Q+Oe7+2+b9mIQ9jJLJvU6iJcKNlYUhtPqJwRA9O6YLxswXD2AmM7Vi5DQVfD7/psER50Kb1dyECQFFX/aRm2XhUpPbF1ffd7Bz8FdDwdjHpy8CQ+tMpdIkXKPAYxfB6zTB3ctq4Ib55U9fM6fslnz8Pca5sYTcaxcNKbzHCbc6wQhUJg0sTX2xAI4nU1NTNAFyOBh9/b2W9q0kjlxZXe79qtdtv8VpNbsQLPTLymmx5bkUuEU08CsWVn3nld3t38ZEx8QLeUjMqo/B4qnjeWNuaUPJM9fNLftOvmodMR0MxiIbdncQQWc44xk0qCw0waJKG1BfpAXguYzk4DGYySL+Ug6GY5u2fdC6SZLT3hsX1V9P4saVLodlmafAPps3GGiGocYXkWdfXTQBOlbjsAgFhOZBB5jKHoOLv9B3ZlQK0umMfdXSmg1FTssKDJsuZl6frKj4op6zVyrSNPQEklDhEoH+Iq/wn5LSCdA8iS9jCck3Go5t6PUFNvQMjfI3La6v43nDYpHnl7gc1gXeAns1UasOzIihrZJ4dHjHh22/3tfepwOMwMsarSdWdBqX07D2S41PVnmsK8aki/OVuDKysdwV/8XDK86pjjGrFo7GYcO2oM4qDHMF4CmtGpMJFEXLBKDW4dFoqz84ti6WSMC1TTXuYCQ6a9UNCwsH/KOpD1raDg+NJHwYi2bVMw0mPf4cp2FGhdICc8Nnuifyj6hnJSGlx1fyn13MJiMQFwNt7Scu6dTfyx7gMxMMGJKwJATiiXXKaRZV8Ug8IY+gmsU8L47/suMmg/tcJg6uqrRPxqcK+f1Ud+/3Z3mtLzhs1jojj0Iu67/x+NzA0Fc/MjhZ8HzxLa5PumlJPRRYeNj5URtol+j1ln9UAJ/Pwica+XyzNk5/WwayQTIp73lpy/sLrmqsuo5Y4srqMs91doupzmIS7XgtnsOJAuMditbfkal/9CyUll0uahZ5M2bB6AtoC7yX6xc3YqXgGw7pObMrAH8ORYNPFilO0Dax1EQymdq+9YMj2+srPWA1G4ujyVRpTam7cSAQKZ0/u7SK5bjCWCzpcNhEMxF5AnETHDmXkWQ5tqf11Ibh0djUE/MpnDLMQmRMApfdCNM9QfT/BRgAj7qO9qX403UAAAAASUVORK5CYII="})),this.editModel.schema={componentName:{title:t("Name"),type:"Text",validators:["required"]},componentDescription:{title:t("Description"),type:"Text"},appKey:{title:t("Url"),type:"Text",validators:["required"]}},this.$dialog=o.$el.dialog(_.extend({appendTo:e.container,title:a,dialogClass:"quick-dash edit-component-dialog",resizable:!1,height:"auto",width:"auto",modal:!0,autoOpen:!0,buttons:n,drag:function(){o.form&&o.form.validate()},open:function(){$('<i class="fa fa-plus" />').insertBefore(o.$el.parent().find(".ui-dialog-title")),o.form=new BBForm({model:o.editModel}).render(),o.$el.html(T.ComponentDialog(o.editModel.toJSON())),o.$el.find(".form").append(o.form.el),o.initializeEvents(),o.$fileInput=o.$el.find(".file-input"),o.$uploadBtn=o.$el.find(".upload-btn"),o.$img=o.$el.find("img"),o.$fileInput.on("change",$.proxy(o.onFileInput,o)),o.$uploadBtn.button({icons:{primary:"fa fa-upload"},text:!0}).click($.proxy(o.onUploadClick,o))},close:function(){o.remove()}},this.options))},initializeEvents:function(){this.listenTo(this.editModel,"change",this.onModelCopyChanged)},onCancelButtonClick:function(){this.$el.dialog("close"),this.remove()},onDeleteButtonClick:function(){var e=this;QuickBase.DeltaClientLib.deleteComponent(e.editModel.get("id"),function(){e.updateFn(),e.onCancelButtonClick()},function(e){alert("Todo set component error"+JSON.stringify(e))})},onFileInput:function(e){var t,i=this;0<e.target.files.length&&((t=new FileReader).onload=function(e){e=e.target.result;i.$img.attr("src",e),i.editModel.set("listViewThumb",e)},t.readAsDataURL(e.target.files[0]))},onModelCopyChanged:function(e){this.isModelChanged||(this.isModelChanged=!0,this.setSaveEnabled(this.isModelChanged))},onSaveButtonClick:function(){var e=this;e.editModel&&!e.form.validate()&&_.defer(function(){e.isModelChanged=!1,e.setSaveEnabled(e.isModelChanged),e.form.commit(),QuickBase.DeltaClientLib.setComponent(e.editModel.get("id"),e.editModel.get("componentName"),e.editModel.get("componentDescription"),e.editModel.toJSON(),function(){e.updateFn(),e.onCancelButtonClick()},function(e){alert("Todo set component error"+JSON.stringify(e))}),Log.Info("Save Component",JSON.stringify(e.editModel))})},onUploadClick:function(){this.$fileInput.click()},remove:function(){this.editModel&&(this.stopListening(this.editModel),this.editModel=null),QuickBase.ErrorTooltip.clearAll(),Backbone.View.prototype.remove.call(this)},setSaveEnabled:function(e){this.$el.next().find("button:nth-of-type(1)").button({disabled:!e})}}),ComponentsPanel=Backbone.View.extend({ITEM_HEIGHT:34,componentViews:null,sortedComponents:null,viewModel:null,initialize:function(e){this.componentViews={},this.options=e,this.sortedComponents=[],this.dialogContainer=e.dialogContainer,this.viewModel=e.viewModel,this.$el.html(T.ComponentsPanel({isLite:e.isLite})),this.$pinButton=this.$(".pin-button"),this.$componentsList=this.$el.find(".components-list"),this.$componentsListClone={},this.$clearSearch=this.$el.find(".fa-times"),this.$scrollUp=this.$el.find(".scroll-up"),this.$scrollDown=this.$el.find(".scroll-down"),this.$searchInput=this.$el.find(".search-box input"),this.$addLink=this.$el.find("a.add"),this.initializeEvents(),this.onModelReset(this.model),String.prototype.includes||(String.prototype.includes=function(){"use strict";return-1!==String.prototype.indexOf.apply(this,arguments)})},initializeEvents:function(){var t=this;this.listenTo(this.model,"add",this.onModelAdd),this.listenTo(this.model,"remove",this.onModelRemove),this.listenTo(this.model,"reset",this.onModelReset),this.listenTo(this.viewModel,"change:componentsPinned",this.onComponentsPinnedChanged),this.$addLink.click(function(){t.onComponentEdit()}),this.$clearSearch.on("click",function(){t.$searchInput.val(""),t.filter(t.$searchInput.val()),t.$searchInput.blur()}),this.$componentsList.on("scroll",function(){t.$scrollUp.toggle(0!==t.$componentsList.scrollTop()),t.$scrollDown.toggle(t.$componentsList.scrollTop()+t.$componentsList.innerHeight()<t.$componentsList[0].scrollHeight)}),this.$pinButton.on("click",function(){t.viewModel.set("componentsPinned",!t.viewModel.get("componentsPinned"))}),this.$scrollDown.on("click",function(){t.onScrollDown()}),this.$scrollUp.on("click",function(){t.onScrollUp()}),this.$searchInput.on("input",function(){t.filter(t.$searchInput.val())}),this.$searchInput.on("keydown",function(e){27===e.keyCode&&(t.$searchInput.val(""),t.filter(null),_.delay(function(){t.$searchInput.blur()},100))})},applyHighlight:function(e,t){e.html(t)},detachAll:function(){var e;for(key in this.componentViews)this.componentViews.hasOwnProperty(key)&&(_.isUndefined(this.componentViews[key].options.sort)?(e=this.sortedComponents.length,this.sortedComponents[+e]=this.componentViews[key].$el.detach()):this.sortedComponents[this.componentViews[key].options.sort]=this.componentViews[key].$el.detach())},highlight:function(e,a){var o=this,s=e.item.$el,r=e.matches;this.unhighlight(s);try{_.each(["name","description"],function(e){var t=s.find("."+e),i=t.text(),n=new RegExp("("+a+")","gi"),i=i.replace(n,"<mark>$1</mark>");o.applyHighlight(t,i),!i.includes("<mark>")&&"description"!=e&&r.length&&_.each(r,function(e){i=o.highlightFuzzyMatches(i,e)})})}catch(e){}},highlightFuzzyMatches:function(e,t){for(var i,n,a=t.indices,o=(t.value,e),s=a.length-1;0<=s;s--)t.key.includes("componentDescription")||(n=a[s][0],i=a[s][1]+"<mark>".length+1,o=(o=o.substr(0,n)+"<mark>"+o.substr(n)).substr(0,i)+"</mark>"+o.substr(i));return o||e},highlightTags:function(e,t){_.each(e.find(".ui-widget-content"),function(e){-1<$(e).html().toLowerCase().indexOf(t.toLowerCase())?$(e).addClass("marked"):$(e).removeClass("marked")})},unhighlight:function(e){e.find("mark").contents().unwrap()},filter:function(t){if(t){this.detachAll();var e=_.map(this.componentViews,function(e,t){return e}),i=new Fuse(e,{distance:100,includeMatches:!0,includeScore:!0,keys:["model.attributes.componentName","model.attributes.componentDescription"],location:0,maxPatternLength:32,minMatchCharLength:2,shouldSort:!0,threshold:.6}),n=t.toLowerCase(),e=i.search(t.toLowerCase()),i=_.map(e,function(e){return e.item.el}),i=_.flatten(_.map(i,_.bind(function(t){return _.filter(this.sortedComponents,function(e){return e[0]===t})},this)));_.each(i,_.bind(function(e){this.$componentsList.append(e)},this)),_.each(e,_.bind(function(e){this.highlight(e,t),e.item.$el.removeClass("showTags"),_.some(e.item.model.get("tags"),function(e){return-1<e.indexOf(n)})&&(e.item.$el.addClass("showTags"),this.highlightTags(e.item.$el,t))},this))}else{for(key in this.componentViews)this.componentViews.hasOwnProperty(key)&&(this.unhighlight(this.componentViews[key].$el),this.componentViews[key].$el.removeClass("showTags"));_.each(this.sortedComponents,_.bind(function(e){this.$componentsList.append(e)},this))}},onComponentEdit:function(e){var t=this;new ComponentDialog({container:t.dialogContainer,updateFn:function(){t.updateUserComponents()},model:e})},onComponentsPinnedChanged:function(){var e=this;this.viewModel.get("componentsPinned")?(this.$pinButton.find("i").removeClass("fa-caret-right").addClass("fa-caret-left"),this.$el.removeClass("unpinned"),_.delay(function(){e.$searchInput.focus()},100)):(this.$pinButton.find("i").removeClass("fa-caret-left").addClass("fa-caret-right"),this.$el.addClass("unpinned"))},onModelAdd:function(e){var t,i=this;/^data/gi.test(e.get("listViewThumb"))&&e.set("listViewThumb",'<img src="'+e.get("listViewThumb")+'" />'),t=new ComponentListView({model:e,dblclick:e.get("user")?function(e){i.onComponentEdit(e)}:void 0,onDragEnd:this.options.onDragEnd,onDragStart:this.options.onDragStart,sort:e.get("index")}),this.componentViews[e.id]=t,this.$componentsList.append(t.el)},onModelRemove:function(e){var t=this.componentViews[e.id];t&&(t.remove(),delete this.componentViews[e.id])},onModelReset:function(e,t){var i=this,n=0;t&&t.previousModels&&_.each(t.previousModels,function(e){i.onModelRemove(e)}),e.each(function(e){e.get("hidden")||(e.set("index",n++),i.onModelAdd(e))})},onScrollDown:function(){this.$componentsList.scrollTop(this.$componentsList.scrollTop()+this.ITEM_HEIGHT)},onScrollUp:function(){this.$componentsList.scrollTop(this.$componentsList.scrollTop()-this.ITEM_HEIGHT)},updateUserComponents:function(){var t=this;QuickBase.DeltaClientLib.getComponents(function(e){t.model.remove(t.model.where({user:!0})),_.each(e,function(e){e=$.parseJSON(e.dataJSON);e.user=!0,t.model.add(e)})},function(e){Log.Error("DeltaClientLib.getComponents: Error",e)})}}),AppRouter=Backbone.Router.extend({model:null,previousRoutes:null,viewModel:null,routes:{":dashboardId(/)(:screenId)":"onDashboard"},initialize:function(e){this.model=e.model,this.viewModel=e.viewModel,this.dialogContainer=e.dialogContainer,this.previousRoutes=[],this.initializeEvents()},initializeEvents:function(){this.on("route",function(){this.previousRoutes.push(Backbone.history.fragment)})},getViewstateFromQueryString:function(e){e=/(^|&)viewstate=([^&;]+?)(&|;|$)/.exec(e);return e?JSON.parse(decodeURIComponent(e[2])):null},navigateToDash:function(e,t,i){var n=this.viewModel.get("selectedDocumentId"),a=this.model.get("documents").get(e);a?(i=this.getViewstateFromQueryString(i),this.viewModel.set("incomingViewState",i,{silent:!0}),n===e&&i&&this.viewModel.trigger("processIncomingViewState",a),this.viewModel.set({selectedDocumentId:e,selectedScreenId:t})):(Log.Error("dashboard NOT found (?)"),n?Log.Error("dashboard doesn't exist or user doesnt have required permissions. (2)"):0<this.model.get("documents").length?this.navigate(this.model.get("documents").first().id,{trigger:!0}):(Log.Error("dashboard doesn't exist or user doesnt have required permissions. (1)"),$(document).find(".loadingScreen").css({display:"none"}),this.dialog=$("<div>The Selected dashboard does not exist or user does not have required permissions or no dashboards are permissioned to this user.</div>").dialog({autoOpen:!0,height:350,width:350,modal:!0,title:"Error loading Dashboard"})))},onDashboard:function(t,i,n){var a,o=this,e=this.viewModel.get("selectedDocumentId"),s=this.model.get("documents").get(e);!s||(a=[],_.each(QuickBase.ComponentView.getInstances(),function(e){e=e.beforeRemove();e&&e.callback&&a.push(e)}),t===e||!s.get("wasChanged")&&_.isEmpty(a))?o.navigateToDash(t,i,n):new QuickBase.AreYouSureDialog({components:a,container:this.dialogContainer,dashChanged:s.get("wasChanged"),model:s,userClass:"quick-dash"}).on("close",function(e){"cancel"==e?(o.previousRoutes.pop(),o.navigate(_.last(o.previousRoutes),{replace:!0}),o.onNavCancel&&(o.onNavCancel(),o.onNavCancel=null)):(o.navigateToDash(t,i,n),o.previousRoutes=[Backbone.history.fragment])})}}),ContentPanel=Backbone.View.extend({$contentPanel:null,$el:null,appModel:null,contentToolbar:null,currentWidgetCopy:null,documentView:null,viewModel:null,CSS_COPIED:"copied",CSS_NOT_COPIED:"not-copied",KEYCODE_C:67,KEYCODE_DEL:46,KEYCODE_V:86,KEYCODE_X:88,initialize:function(e){this.appModel=e.appModel,this.viewModel=e.viewModel,this.$el.toggleClass("open",this.appModel.get("showBreadcrumbs")),this.listenTo(this.viewModel,"change:isInspecting",this.onIsInspectingChanged),this.listenTo(this.viewModel,"change:selectedDocumentId",this.onSelectedDocumentChanged),this.listenTo(this.viewModel,"change:selectedScreenId",this.onSelectedScreenChanged),this.listenTo(this.appModel,"change:propertiesPinned",this.onPropertiesPinnedChanged),this.listenTo(this.viewModel,"change:componentsPinned",this.onComponentsPinnedChanged),this.listenTo(this.appModel,"change:showBreadcrumbs",this.onResize),this.listenTo(this.viewModel,"processIncomingViewState",function(e){this.processIncomingViewState(e)}),this.$el.on("keydown",this.onKeyDown.bind(this)),this.listenTo(this.viewModel,"change:selectedWidget",function(e){e._previousAttributes.selectedWidget&&(e=!(e=e._previousAttributes.selectedWidgetView.$el.parent()).data("widgetid")?e.parent():e).removeClass(this.CSS_COPIED),_.defer(function(){$(".content-panel:visible:last").focus()})}.bind(this)),this.showLoadingScreen(t("loading dashboard")+"...")},downloadDash:function(e){var i=this;e.fetch({success:function(e){var t;i.hideLoadingScreen(),e.get("screens").length<=0&&(t=new QuickBase.Screen({},{},e.get("screens")),e.get("screens").add(t),i.viewModel.set("selectedScreenId",t.id)),e.trigger("view-state-init"),e.trigger("detail-downloaded"),e.set("wasChanged",!1),i.resetDocumentView(e),i.processIncomingViewState(e)},error:function(){i.hideLoadingScreen(),alert(t("connection error while downloading dashboard"))},silent:!0})},generateThumb:function(){this.documentView.screenView.regenerateThumb()},hideLoadingScreen:function(){this.$loadingScreen&&(this.$loadingScreen.$el.fadeOut(function(){$(this).remove()}),this.$loadingScreen=null)},onKeyDown:function(e){var n=this,a=e.keyCode;if($(e.target).hasClass("content-panel")){if(!this.appModel.get("userName"))return!1;if(a===this.KEYCODE_DEL)this.removeSelectedWidget();else if(e.ctrlKey||e.metaKey)switch(a){case this.KEYCODE_V:this.viewModel.get("buildMode")&&($(document).one("paste",$.proxy(this.onPaste,this)),this.$el.attr("contenteditable",!0),this.$el.focus());break;case this.KEYCODE_C:case this.KEYCODE_X:this._copying||(this._copying=!0,this.onCopy(),this._copy&&this.copy(this._copy,function(e){var t,i=n.viewModel.get("selectedWidgetView");i&&((t=i.$el.parent()).data("widgetid")||(t=t.parent())),e?a===n.KEYCODE_X?n.removeSelectedWidget():t&&t.addClass(n.CSS_COPIED):t&&(t.addClass(n.CSS_NOT_COPIED),setTimeout(function(){t.removeClass(n.CSS_NOT_COPIED)},1e3)),n.$el.focus(),n._copying=!1}))}}},onCopy:function(){var t,i,e,n={},a=this,o=this.viewModel.get("selectedWidget");o&&((e=this.viewModel.get("selectedWidgetView"))&&e.$el&&(0===(e=e.$el).height()&&(e=e.closest("[data-widgetid]")),n._widgetSize=[e.width(),e.height()]),n._widget=o.toJSON(),i=CopyPasteHelpers.getComponentViewStates(o.attributes.component),n._dataSources=_.extend(CopyPasteHelpers.getComponentDataSources(o.attributes.component,i,a.documentView.model),CopyPasteHelpers.getMappingDataSources(i,a.documentView.model)),n._viewState={},_.each(i,function(e){(t=a.documentView.model.get("viewState").getByPath(e))&&(n._viewState[e]=t.toJSON(),"dict"===t.get("_type")&&(n._viewState[e]._default=_.mapValues(t.get("_default"),function(e){var t;return e instanceof Backbone.Model?(_.includes(i,e.path)||n._viewState[e.path]||(t=a.documentView.model.get("viewState").getByPath(e.path))&&(n._viewState[e.path]=t.toJSON()),"<%"+e.path+"%>"):e})))}),this._copy=JSON.stringify(n))},onPaste:function(e){var t,i;if(e.stopPropagation(),e.preventDefault(),this.$el.removeAttr("contenteditable"),(e=e.originalEvent.clipboardData||window.clipboardData)&&(t=e.getData("Text"))){try{if(!(t=JSON.parse(t))._widget)return;this.appModel.set("copiedWidgetSize",t._widgetSize),i=t._widget,CopyPasteHelpers.mergeViewStates(t._viewState,this.documentView.model);var n={},a={};if(_.each(t._dataSources,function(e,t){"virtual"===e._dataType?a[t]=e:n[t]=e}),CopyPasteHelpers.mergeDataSources(n,this.documentView.model),CopyPasteHelpers.mergeDataSources(a,this.documentView.model),this.documentView.applyDataSources(),!i.component||!i.id||!i.layout)return void(i=null)}catch(e){return void console.log("something is wrong with the widget",e)}this.documentView&&i&&this.documentView.pasteWidget(new QuickBase.Widget(i))}},copy:function(e,t){var i,n;if(navigator.clipboard)navigator.clipboard.writeText(e).then(function(){$("window").focus(),t&&t(!0)},function(e){$("window").focus(),t&&t(!1)});else{(i=$(document.createElement("textarea"))).css({position:"absolute",width:0,height:0,top:0,left:0}),i[0].value=e,i.appendTo(this.$el),i[0].focus(),i[0].select();try{document.execCommand("SelectAll")&&(n=document.execCommand("copy",!1,null))}catch(e){console.log(e)}i.remove(),$("window").focus(),t&&t(n)}},processIncomingViewState:function(i){var e=this,t=this.viewModel.get("incomingViewState");t&&(_.each(t,function(e,t){".settings"===t||(t=i.get("viewState").getByPath(t))&&t.set("value",e)}),_.delay(function(){e.viewModel.unset("incomingViewState")},500))},resetDocumentView:function(e){this.documentView&&(this.documentView.remove(),this.documentView=null),this.documentView=new QuickBase.DocumentView({appModel:this.appModel,model:e,viewModel:this.viewModel}),this.$el.append(this.documentView.$el)},onIsInspectingChanged:function(){this.$el.toggleClass("inspecting",this.viewModel.get("isInspecting"))},onComponentsPinnedChanged:function(){var e=this;this.viewModel.get("componentsPinned")?(this.$el.removeClass("components-unpinned"),this.onResize()):(this.$el.addClass("components-unpinned"),_.defer(function(){e.onResize()}))},onPropertiesPinnedChanged:function(){var e=this;this.appModel.get("propertiesPinned")?(this.$el.removeClass("unpinned"),this.onResize()):(this.$el.addClass("unpinned"),_.defer(function(){e.onResize()}))},onResize:function(){this.$el.toggleClass("open",this.appModel.get("showBreadcrumbs")),this.documentView&&this.documentView.onResize()},onSelectedDocumentChanged:function(){var e;this.currentWidgetCopy=null,(e=this.viewModel.get("selectedDocumentId"))&&((e=this.appModel.get("documents").get(e))?(this.showLoadingScreen(t("loading")+" "+e.get("name")+"..."),this.documentView&&this.documentView.remove(),this.downloadDash(e)):this.viewModel.set("selectedDocumentId",null))},removeSelectedWidget:function(){var e=this.viewModel.get("selectedWidget");e&&e.trigger("removeWidget")},showLoadingScreen:function(e){this.$loadingScreen||(this.$loadingScreen=new LoadingScreen({loadingText:e}),this.$loadingScreen.$el.appendTo($("body")))}}),AppModel=(sva=Backbone.Model,__extends(tva,sva),tva.prototype.defaults=function(){return{api:null,CanExecuteQueries:!0,components:null,deltaClient:null,documents:null,language:"en",publisherUrl:null,smartDrop:!0,websiteUrl:null,userName:null,paths:null,propertiesPinned:!0,isHelpDialogTabbed:!0,showBreadcrumbs:"false"!==$.cookie("dashboard-breadcrumbs")}},tva),sva;function tva(e){var t,i=sva.call(this,e)||this,n=[];for(t in e.versions)e.versions.hasOwnProperty(t)&&n.push({key:t,value:e.versions[t]});return i.set({api:e.api,components:new QuickBase.ComponentDefinitionCollection,documents:e.documents,PackageName:e.PackageName,paths:_.sortBy(n,"key"),publisherUrl:e.publisherUrl,websiteUrl:e.websiteUrl}),i.listenTo(i,"change:showBreadcrumbs",function(){return $.cookie("dashboard-breadcrumbs",i.get("showBreadcrumbs"),{expires:90})}),i}var DocumentImporter=function(e,t){this.appModel=e,this.viewModel=t};_.extend(DocumentImporter.prototype,Backbone.Events,{doImport:function(e,t){function n(){0===--i&&_.isFunction(t)&&t()}var i=e.length;_.each(e,_.bind(function(e){var t=e.data.id,i=this.appModel.get("documents").get(t);i&&"replace"===e.data.action?(this.appModel.get("documents").remove(t),this.appModel.get("documents").add(e.data),(i=this.appModel.get("documents").get(t)).save(i.attributes,{success:function(){n()},error:function(e){QuickBase.Log.Error(e),n()}},this)):"add"===e.data.action?(this.appModel.get("documents").add(e.data),(i=this.appModel.get("documents").get(t)).save(i.attributes,{success:function(){n()},error:function(e){QuickBase.Log.Error(e),n()}})):n()},this))},importCheck:function(a,o){var s=this,r=[],l=_.cloneDeep(a),c=function(){var e,i,n;0!==l.length?(i=l.splice(0,1)[0],(n=s.appModel.get("documents").get(i.data.id))?e=new MessageDialog({title:t("Confirm Replace"),dialogClass:"replace-dash-dialog",message:t('Dashboard "'+i.data.name+'" with id "'+i.data.id+'" already exists!<br><br>"Are you sure you would like to replace this dashboard?<br><br>'),check:t(" Apply this action to all existing Dashboards"),buttons:[{text:t("Replace"),click:function(){e.close(),e.$el.find('input[type="checkbox"]').is(":checked")?(_.each(a,function(e){n=s.appModel.get("documents").get(e.data.id),e.data.action=n?"replace":"action"}),r=r.concat(a),l=[]):(i.data.action="replace",r.push(i)),c()}},{text:t("Skip"),click:function(){e.close(),e.$el.find('input[type="checkbox"]').is(":checked")?l=[]:(i.data.action="skip",r.push(i)),c()}},{text:t("Cancel"),click:function(){e.close()}}]}):(i.data.action="add",r.push(i),c())):s.doImport(r,o)};c()},importFiles:function(r,l,c){var d,p=this,r=r||[],u=[];_.each(r,function(s){var e=new FileReader;e.onload=function(e){try{var t,i,n,a=e.target.result;"text/xml"===s.type?(t=$.parseXML(a),n=(i=$(t)).find("data"),(o=JSON.parse(n.text().replace(/&gt;/g,">").replace(/&gt;/g,"<").replace(/&amp;/g,"&"))).id=i.find("name").text()):o=JSON.parse(a),s.data=o,u.push(s),d=d||o.id,r.length===u.length&&p.importCheck(u,function(){_.isFunction(l)&&l(d)})}catch(e){var o="Import Error: parsing "+s.name;QuickBase.Log.Error(o),_.isFunction(c)&&c(o)}},e.readAsText(s)})}});var Notificator=Backbone.View.extend({className:"notificator",initialize:function(e){this.appModel=e.appModel,this.render()},notify:function(e,t){this.$title.text(e),this.$items.append(t),this.$panel.fadeIn("slow")},onClose:function(){var e=this;this.$panel.fadeOut("slow",function(){e.$items.html("")})},render:function(){return this.$el.addClass(this.className),this.$el.html(T.Notificator()),this.$title=this.$(".title"),this.$items=this.$(".items"),this.$panel=this.$(".panel"),this.$close=this.$(".close-button"),this.$close.button({text:!1,icons:{primary:"fa fa-times"}}).click($.proxy(this.onClose,this)),this.$panel.hide(),this}}),FailedLoginsNotification=Backbone.View.extend({className:"failed-logins",initialize:function(e){this.appModel=e.appModel,this.render()},render:function(){var e=this.model.toJSON();return _.each(e.rows,function(e){var t=Tools.convertKDBTemporalToMoment(e.time);e.time=t.format("YYYY-MM-DD HH:mm:ss"),e.timeSort=t.valueOf()}),e.rows=_.sortBy(e.rows,"timeSort").reverse(),$(this.$el).css("max-height",$(".quick-base").height()/2),this.$el.addClass(this.className),this.$el.html(T.FailedLoginsNotification(e)),this}}),BreadcrumbsWrapper=Backbone.View.extend({initialize:function(e){var a=this;this.appModel=e.appModel,this.viewModel=e.viewModel,this.componentDefinition=Breadcrumbs.getComponentDefinition({websiteUrl:this.appModel.get("websiteUrl"),settingsModel:new Backbone.Model}),this.app=new Breadcrumbs({el:this.$el,websiteUrl:this.appModel.get("websiteUrl"),settingsModel:this.componentDefinition,api:{setProperty:function(e,t){var i,n=[];t?("Basic.Path"===e&&(n=t.split(",")),(i=a.currentPath?a.currentPath.items[n.length-1]:i)&&a.appModel.set("pendingSelectionWidgetId",i.widgetId)):(a.viewModel.set("selectedWidget",null),a.viewModel.set("selectedWidgetView",null,{silent:!0}))}},disableSortable:!0}),this.listenTo(this.viewModel,"change:selectedWidget",this.onSelectedWidgetChanged),this.listenTo(this.viewModel,"change:componentsPinned",this.onComponentsPinnedChanged),this.onSelectedWidgetChanged()},findWidget:function(e,t,i){if(i=i||{value:"",items:[]},e.includes(t)||t.get("component")&&e.includes(t.get("component")))return component=this.appModel.get("components").get(t.get("component").get("definitionId"))||this.appModel.get("components").find({appKey:t.get("component").get("key")}),i.value+=component.get("componentName"),i.items.push(t),i;for(var n=0;n<e.length;n+=1){var a=e.at(n),o=null,s=null;if(a.get("component")?(s=a.get("id"),a=a.get("component")):s=$("#"+a.get("containerId")).attr("data-widgetId"),(!(o=a.get("widgets"))||o.length<=0)&&(o=a.get("components")||o),a.widgetId=s,o){s={value:"",items:[]};s.value+=this.appModel.get("components").find({appKey:a.get("key")}).get("componentName")+",",s.items.push(a);o=this.findWidget(o,t);if(o&&o.value)return i.value+=s.value+o.value,i.items=i.items.concat(s.items.concat(o.items)),i}}},findWidgetFromPopups:function(e,t){var i,n=this;return e.each(function(e){if(i=n.findWidget(e.get("widgets"),t))return!1}),i},onComponentsPinnedChanged:function(e,t){this.$el.parent().toggleClass("left-open",t)},onSelectedWidgetChanged:function(){var e,t,i=this.viewModel.get("selectedWidget");i?(t=(e=this.appModel.get("documents").get(this.viewModel.get("selectedDocumentId"))).get("screens").get(this.viewModel.get("selectedScreenId")),(t=(t=this.findWidget(t.get("widgets"),i))||this.findWidgetFromPopups(e.get("popups"),i))&&t.value&&(this.currentPath=t,this.app.onSettingsChange({"Basic.Breakdown":t.value.split(","),"Basic.Path":t.value.split(",")}))):(this.currentPath=null,this.app.onSettingsChange({"Basic.Breakdown":[],"Basic.Path":[]}))}}),Tools=QuickBase.Tools,App=Backbone.View.extend({DOCUMENT_TITLE:{SEPARATOR:" - ",SUFFIX:"Dashboards"},THEMES:[{id:"kx-darkroom",name:"Dark"},{id:"kx-light",name:"Light"}],$documentDialogPanel:null,$dropzone:null,$environmentDialogPanel:null,$propertiesPanelDiv:null,componentsPanel:null,contentPanel:null,DeltaClientLogin:!1,dropzoneAdded:!1,environmentTheme:null,observer:null,propertiesPanel:null,toolbar:null,viewModel:null,appid:"dashboards",initialize:function(t){var i,o=this,n=[32,99,1001,1002,1003,1006,1010];-1!=document.location.href.indexOf("auth=saml")&&(this.saml=!0),QuickBase.Helpers.preventBackspaceBack(),QuickBase.DocumentCollection.requiredAccessLevel="update",i=-1!==document.location.pathname.indexOf(".")?document.location.pathname.substr(0,document.location.pathname.lastIndexOf("/")+1):document.location.pathname,t.isLite?(QuickBase.Document.prototype.sync=QuickBase.DashClientLib.documentSync,QuickBase.DocumentCollection.prototype.sync=QuickBase.DashClientLib.documentCollectionSync,QuickBase.Connection.prototype.sync=QuickBase.DashClientLib.connectionSync,QuickBase.ConnectionCollection.prototype.sync=QuickBase.DashClientLib.connectionCollectionSync,_.extend(QuickBase.DocumentDataModel.prototype,QuickBase.DashClientLib),QuickBase.DeltaClientLib.PIVOT_SOURCE_CODE=QuickBase.DashClientLib.PIVOT_SOURCE_CODE):(QuickBase.Document.prototype.sync=QuickBase.DeltaClientLib.documentSync,QuickBase.DocumentCollection.prototype.sync=QuickBase.DeltaClientLib.documentCollectionSync,QuickBase.Connection.prototype.sync=QuickBase.DeltaClientLib.connectionSync,QuickBase.ConnectionCollection.prototype.sync=QuickBase.DeltaClientLib.connectionCollectionSync,QuickBase.ConnectionGroup.prototype.sync=QuickBase.DeltaClientLib.connectionGroupSync,QuickBase.ConnectionGroupCollection.prototype.sync=QuickBase.DeltaClientLib.connectionGroupCollectionSync,QuickBase.Service.prototype.sync=QuickBase.DeltaClientLib.servicesSync,QuickBase.ServiceCollection.prototype.sync=QuickBase.DeltaClientLib.servicesCollectionSync),this.model=new AppModel(_.extend(t,{api:"//"+document.location.host+i+"api/",websiteUrl:"//"+document.location.host+i,saml:this.saml,documents:new QuickBase.DocumentCollection,components:t.isLite?_.filter(t.components,function(e){return-1==n.indexOf(e.id)}):t.components,connections:new QuickBase.ConnectionCollection,connectionGroups:t.isLite?null:new QuickBase.ConnectionGroupCollection,services:t.isLite?null:new QuickBase.ServiceCollection,DocsUrl:t.isLite?"https://code.kx.com/dashboards":void 0})),t.isLite&&(QuickBase.DocumentDataModel.connections=this.model.get("connections"),this.$el.addClass("is-lite")),this.viewModel=new QuickBase.AppViewModel(_.pick(t,"buildMode")),this.documentImporter=new DocumentImporter(this.model,this.viewModel),this.model.documentImporter=this.documentImporter,"FSBL"in window&&this.finsembleInitEvents(),this.$el.addClass("quick-dash quick-base main-app buildMode"),i=function(e){o.$el.html(T.app()),o.$notificationsDiv=o.$(".notifications-div"),o.notificator=new Notificator({el:o.$notificationsDiv}),o.$documentDialogPanel=o.$el.find("> .dialog-panel .document"),o.$environmentDialogPanel=o.$el.find("> .dialog-panel .environment"),$.extend($.ui.dialog.prototype.options,{appendTo:o.$documentDialogPanel}),o.toolbar=new MainToolbar({el:o.$el.find("> .toolbar"),appModel:o.model,dialogContainer:o.$environmentDialogPanel,themes:o.THEMES,viewModel:o.viewModel}),o.componentsPanel=new ComponentsPanel({el:o.$el.find("> .components-panel"),dialogContainer:o.$environmentDialogPanel,model:o.model.get("components"),onDragEnd:function(){$(".ui-dialog-content:visible>.content-panel").removeClass("outlined"),o.contentPanel.$el.removeClass("outlined"),o.model.unset("draggedComponentId")},onDragStart:function(e){var t=$(".ui-dialog-content:visible>.content-panel");(t.length?t:o.contentPanel.$el).addClass("outlined"),o.model.set("draggedComponentId",e)},viewModel:o.viewModel,isLite:o.model.get("isLite")}),o.propertiesPanel=new PropertiesPanel({el:o.$el.find("> .properties-panel"),appModel:o.model,dialogContainer:o.$environmentDialogPanel,viewModel:o.viewModel}),o.listenTo(o.viewModel,"screenshot",function(){o.contentPanel.generateThumb()}),o.contentPanel=new ContentPanel({el:o.$el.find("> .content-panel"),appModel:o.model,deltaClient:o.deltaClient,viewModel:o.viewModel,websiteUrl:o.model.get("websiteUrl")}),o.$breadcrumbs=o.$el.find("> .breadcrumbs-div"),o.$breadcrumbs.hide(),o.onDashboardThemeChanged(),o.setThemeFromCookie(),o.model.get("hideToolbar")&&o.onHideToolbarChange(),"MutationObserver"in window&&(o.observer=new MutationObserver(function(e){for(var t=0;t<e.length;t++){var i=e[t].addedNodes;if(i)for(var n=0;n<i.length;n++){var a=i[n];"ui-datepicker-div"===a.id?o.$documentDialogPanel[0].appendChild(a):_.isString(a.className)&&-1!==a.className.indexOf("select2-container")&&(-1!==a.className.indexOf("select2-container--document-selector")||-1!==a.className.indexOf("select2-container--dashboards-properties")||-1!==a.className.indexOf("select2--environment")?o.$environmentDialogPanel:o.$documentDialogPanel)[0].appendChild(a)}}}),o.observer.observe(document.querySelector("body"),{attributes:!1,childList:!0,characterData:!1})),o.model.get("components").reset(t.components),t.deltaToken=t.deltaToken||$.cookie("deltaToken"),o.model.get("isLite")?(QuickBase.DashClient.client=new QuickBase.DashClient(t),QuickBase.DeltaClientLib=QuickBase.DashClient):o.saml?o.initializeDeltaClient(null,null,function(e){alert(e)},null,!0):t&&t.delta?(o.model.set({userName:t.delta.username,DeltaClientHost:t.delta.options.host,DeltaClientPort:t.delta.options.port,DeltaClientSecure:t.delta.options.secure,DeltaClientFromUrl:t.delta.options.fromURL}),QuickBase.DeltaClientLib.initializeDeltaClientCopy(t.delta.client,o.model.get("DeltaClientHost"),o.model.get("DeltaClientPort"),o.model.get("DeltaClientSecure"),o.model.get("DeltaClientFromUrl"),t.delta.username,t.delta.password,null,function(e){alert(e)},o.appid)):t.deltaToken||t.credentials?($(QuickBase.DeltaClientLib).one("DeltaClientLogin",function(e){o.model.set("userName",QuickBase.DeltaClientLib.deltaClient.user()),t.deltaToken&&$.cookie("deltaToken",t.deltaToken,{expires:30,path:"/"})}),o.initializeDeltaClient(t.credentials?t.credentials.username:null,t.credentials?t.credentials.password:null,null,t.deltaToken)):o.showLogin(),o.initializeEvents(),o.fixSelect2DialogIssue()};try{QuickBase.InitializeQuickbase(i)}catch(e){Log.Error("error loading quickbase",e),window.t=function(e){return e},i()}},initializeEvents:function(){var a=this,o=this.model.get("isLite")?QuickBase.DashClient.client:QuickBase.DeltaClientLib;$(window).resize($.proxy(this.onResize,this)),this.listenTo(this.toolbar,"themeChange",this.setThemeFromCookie),this.listenTo(this.model.get("documents"),"remove",this.onDocumentRemoved),$(o).one("DeltaClientConnect",function(){a.contentPanel.hideLoadingScreen(),$(o).on("DeltaClientConnect",function(){a.contentPanel.hideLoadingScreen();var e=a.getCurrentDocument();e&&e.get("data").getTreeList().forEach(function(e){e.stop(),e.start()})})}),$(o).on("DeltaClientDisconnect",function(e,i){var n=a.getCurrentDocument();i=i?_.startCase(i)+": ":"",a.contentPanel.showLoadingScreen(i+t("reconnecting...")),n&&a.getCurrentDocument().get("data").getTreeList().forEach(function(e){e.stop()})}),$(o).one("DeltaClientLogin",$.proxy(this.onDeltaClientLogin,this)),this.listenTo(this.viewModel,"change:buildMode",this.onBuildModeChange),this.listenTo(this.model,"change:hideToolbar",this.onHideToolbarChange),this.listenTo(this.viewModel,"change:DashboardTheme",this.onDashboardThemeChanged),this.listenTo(this.viewModel,"change:selectedDocumentId",this.onSelectedDocumentChanged),this.listenTo(this.model,"change:showBreadcrumbs",this.onShowBreadcrumbs),this.$el.on("dragenter",_.bind(this.onDragEnter,this)),"FSBL"in window||(window.onbeforeunload=function(e){var t=a.getCurrentDocument(),i="There are unsaved changes in this dashboard.",n=!1;if(t&&(t.get("data").getTreeList().forEach(function(e){e.stop()}),(t.get("wasChanged")||_.some(QuickBase.ComponentView.getInstances(),function(e){return e.beforeRemove()}))&&(n=!0)),n)return(e||window.event).returnValue=i;o&&o.ws&&o.ws.close()})},initializeDeltaClient:function(i,n,a,o,s,e){var r=this;QuickBase.DeltaClientLib.initializeDeltaClient(r.model.get("DeltaClientHost"),r.model.get("DeltaClientPort"),r.model.get("DeltaClientSecure"),r.model.get("DeltaClientFromUrl"),i,n,null,function(e){var t;_.isFunction(a)?a(e):(t=_.isString(e)?e.toLowerCase():null,"loginRequired"===e?r.showLogin():"userSessionLimit"===e?r.showForceLoginPrompt(function(){r.initializeDeltaClient(i,n,a,o,s,!0)}):(t&&_.some(["login","token","session","websocket"]),r.showLogin(e)))},o,r.appid,!0,!!s,!!e)},initializeDropzone:function(){this.$dropzone=$("<form />"),this.$dropzone.addClass("simpleDropzone"),this.$dropzone.appendTo(this.$el),this.dropzone=new DropzoneView({el:this.$dropzone,documentImporter:this.model.documentImporter,router:this.router}),this.dropzoneAdded=!0},finsembleInitEvents:function(){function t(){return QuickBase.DeltaClientLib.deltaClient}this.listenTo(this.model.get("documents"),"update",function(){var e=this.model.get("documents").map(function(e){return _.pick(e.toJSON(),["name","id"])});window.finApi.applyUserConfig(window.finApi.generateConfig(e,!0))}),this.listenTo(this.viewModel,"change:selectedDocumentId",function(){var e=this.viewModel.get("selectedDocumentId");e&&(e=this.model.get("documents").get(e),window.finApi.deltaClientGetter=t,window.finApi.initApi(e,this.viewModel))})},fixSelect2DialogIssue:function(){var t;$.ui&&$.ui.dialog&&$.ui.dialog.prototype._allowInteraction&&(t=$.ui.dialog.prototype._allowInteraction,$.ui.dialog.prototype._allowInteraction=function(e){return!!$(e.target).closest(".select2-dropdown").length||t.apply(this,arguments)})},getAPIPrefix:function(){return"file:"===location.protocol||"FSBL"in window?"http://localhost:10001/api/":"/api/"},getCurrentDocument:function(){var t=this.viewModel.get("selectedDocumentId");return this.model.get("documents").find(function(e){return e.id===t})},onBuildModeChange:function(e,t){this.$el.toggleClass("buildMode",t),this.contentPanel.onResize(),BBForm.ErrorTooltip.clearAll()},onDashboardThemeChanged:function(){var t=this.viewModel.get("DashboardTheme")||$.cookie("dashboard-theme")||this.THEMES[0].id;_.each([this.contentPanel.$el,this.$documentDialogPanel],function(e){if(e&&(e.removeClass("Dark Light kx-darkroom kx-light"),"None"!==t))switch(e.addClass(t),t){case"Dark":e.addClass("kx-darkroom"),$("#appdiv").css("background","#222222");break;case"Light":e.addClass("kx-light"),$("#appdiv").css("background","#f0f0f0")}})},onDocumentsFetched:function(e){var t,i;Log.Log("Dash Documents Complete"),this.model.get("isFinsembleLiteAuth")?window.finApi.applyUserConfig(window.finApi.generateConfig(JSON.stringify(e))):(this.router=new AppRouter({dialogContainer:this.$environmentDialogPanel,model:this.model,viewModel:this.viewModel}),this.model.set("router",this.router),Backbone.history.start(),document.location.hash.length<=0&&((t=this.viewModel.get("selectedDocumentId"))||0<(e=this.model.get("documents").getSortedDocuments()).length&&(t=e[0].id),t?this.router.navigate(t,{trigger:!0}):(Log.Error("this user doesn't have any dashboards"),(i=new QuickBase.Document({name:"My New Dashboard (1)",creationDate:(new Date).toUTCString()})).save(null,{success:function(e,t){this.model.get("documents").add(i),this.viewModel.set("selectedDocumentId",i.id)}.bind(this),error:function(e,t){MainToolbar.ShowError_unableToCreateNewDashboard(t),$(document).find(".loadingScreen").css({display:"none"})}}))),this.onShowBreadcrumbs())},onDeltaClientLogin:function(){var e;Log.Log("Dash Documents Fetch"),this.model.get("documents").fetch({success:$.proxy(this.onDocumentsFetched,this),error:function(){alert("document fetch error")},reset:!0}),this.model.get("isLite")?this.model.set("userName","User"):(this.model.set("userName",QuickBase.DeltaClientLib.username),this.componentsPanel.updateUserComponents(),this.onPopulateDeltaClientInformation(),QuickBase.DeltaClientLib.showLastLoginAttempts&&this.onShowLastLoginAttempts(),e="true"==QuickBase.DeltaClientLib.getDashboardProperty("hideQueryEditor"),this.model.set("CanExecuteQueries",!e))},onDragEnter:function(e){document.getElementById("appdiv");this.dropzoneAdded||this.initializeDropzone(),_.includes(e.originalEvent.dataTransfer.types,"Files")&&(void 0===e.originalEvent.dataTransfer.items||_.some(e.originalEvent.dataTransfer.items,function(e){return _.includes(["application/json","text/xml"],e.type)}))&&(this.$el.addClass("dragging"),e.preventDefault())},onHideToolbarChange:function(){var e=this.model.get("hideToolbar");this.$el.toggleClass("hideToolbar",!!e),this.toolbar.toggleTitle(e),this.onResize({target:window})},onPopulateDeltaClientInformation:function(){var t=this;QuickBase.DeltaClientLib.getAPIQueryData("kdb",void 0,".ui.controlDetails",[],function(e){t.model.set("dashboardControlDetails",e.rows.reduce(function(e,t){return e[t.Property]=_.isArray(t.Value)?t.Value.join(""):t.Value,e},{}))},function(e){console.log("Error Fetching Delta Client Information:",e)},100,!1)},onDocumentRemoved:function(e){var e=e.id;this.viewModel.get("selectedDocumentId")===e&&((e=this.model.get("documents").first())?(e=e.id,this.viewModel.set("selectedDocumentId",e)):this.viewModel.set("selectedDocumentId",null))},onResize:function(e){e.target===window&&(this.contentPanel.onResize(),this.toolbar.onResize())},onSelectedDocumentChanged:function(){var e=this.model.get("documents").get(this.viewModel.get("selectedDocumentId")),t=this.model.get("documents").get(this.viewModel.previous("selectedDocumentId"));t&&this.stopListening(t),t=e?e.get("name")+this.DOCUMENT_TITLE.SEPARATOR+this.DOCUMENT_TITLE.SUFFIX:this.DOCUMENT_TITLE.SUFFIX,$(document).attr("title",t),this.listenTo(e,"change:name",this.onSelectedDocumentChanged)},onShowBreadcrumbs:function(){this.model.get("showBreadcrumbs")?(this.$breadcrumbs.show(),this.breadcrumbs=new BreadcrumbsWrapper({appModel:this.model,viewModel:this.viewModel}),this.breadcrumbs.$el.appendTo(this.$breadcrumbs)):this.breadcrumbs&&(this.$breadcrumbs.hide(),this.breadcrumbs.remove())},onShowLastLoginAttempts:function(){var e,t=QuickBase.DeltaClientLib.showLastLoginAttempts,i="",n=this;if("failures"===t||"true"===t)e=".session.getFailedLoginsUI",i="Unsuccessful login attempts:";else{if("all"!==t)return;e=".session.getLoginsUI",i="Last 10 login attempts:"}QuickBase.DeltaClientLib.getAPIQueryData("kdb",void 0,e,[],function(e){var e=_.filter(e.rows,function(e){return e.machineID&&0<e.machineID.length});0<e.length&&(e=new FailedLoginsNotification({appModel:n.model,model:new Backbone.Model({rows:e})}),n.notificator.notify(i,e.$el))},function(e){console.log("show last login attempts error:",e)},100,!1)},remove:function(){this.observer.disconnect(),Backbone.View.prototype.remove.call(this)},setThemeFromCookie:function(){var t=this,i=_.map(this.THEMES,function(e){return e.id}).join(" ").concat(" Dark Light");this.environmentTheme=$.cookie("dashboard-theme")||this.THEMES[0].id,_.each([this.toolbar.$el,this.componentsPanel.$el,this.propertiesPanel.$el,this.$environmentDialogPanel,this.$notificationsDiv,this.$breadcrumbs],function(e){e&&e.removeClass(i).addClass(t.environmentTheme)}),_.includes(t.THEMES,this.environmentTheme)&&require(["css!"+this.environmentTheme])},showForceLoginPrompt:function(e){QuickBase.ConfirmDialog.ShowConfirm({dialogTitle:"Session Limit exceeded",renderTemplate:function(){return t("User session limit has been reached, terminate oldest open session?")},callback:e,cancelBtnCallback:this.showLogin.bind(this),container:this.$environmentDialogPanel})},showLogin:function(e){var a=this;new QuickBase.LoginDialog({appModel:this.model,container:this.$environmentDialogPanel,errorMessage:e,doLogin:function(t,i,n){a.initializeDeltaClient(t,i,function(e){"loginRequired"===e?a.showLogin():"userSessionLimit"===e?a.showForceLoginPrompt(function(){a.initializeDeltaClient(t,i,n,null,null,!0)}):n(e)})}})}});return App});