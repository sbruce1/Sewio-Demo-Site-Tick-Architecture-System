define(["backbone","jqueryui","moment","purify","QuickBase","Handlebars","css!./css/app.css"],function(Backbone,jqui,moment,DOMPurify,QuickBase,Handlebars){var Tools=QuickBase.Tools,RTTI=QuickBase.RTTI,Form=Backbone.View.extend({events:{submit:function(e){this.trigger("submit",e)}},initialize:function(t){var i=this;t=this.options=_.extend({resetButton:!1,submitButton:!1},t);var s=this.schema=function(){if(t.schema)return _.result(t,"schema");var e=t.model;return e&&e.schema?_.result(e,"schema"):i.schema?_.result(i,"schema"):{}}();_.extend(this,_.pick(t,"model","data","idPrefix","templateData","viewStates","base64"));var e=this.constructor;this.template=t.template||this.template||e.template,this.Fieldset=t.Fieldset||this.Fieldset||e.Fieldset,this.Field=t.Field||this.Field||e.Field,this.NestedField=t.NestedField||this.NestedField||e.NestedField;var e=this.selectedFields=t.fields||_.keys(s),n=this.fields={};_.each(e,_.bind(function(e){var t=s[e];n[e]=this.createField(e,t)},this));e=t.fieldsets||_.result(this,"fieldsets")||_.result(this.model,"fieldsets")||[e],this.fieldsets=[];_.each(e,_.bind(function(e){this.fieldsets.push(this.createFieldset(e))},this)),this.resizeEnd=_.debounce(function(){this.validate(),this.resizeStart=!0},300)},createFieldset:function(e){e={schema:e,fields:this.fields,legend:e.legend||null};return new this.Fieldset(e)},createField:function(e,t){t={form:this,key:e,schema:t,idPrefix:this.idPrefix};this.model?t.model=this.model:this.data?t.value=this.data[e]:t.value=null;t=new this.Field(t);return this.listenTo(t.editor,"all",this.handleEditorEvent),t},handleEditorEvent:function(e,t){var i,s=t.key+":"+e;switch(this.trigger.call(this,s,this,t,Array.prototype.slice.call(arguments,2)),e){case"change":this.trigger("change",this,t);break;case"focus":this.hasFocus||this.trigger("focus",this);break;case"blur":this.hasFocus&&(i=this,setTimeout(function(){_.find(i.fields,function(e){return e.editor.hasFocus})||i.trigger("blur",i)},0));break;case"changeList":this.trigger("changeList",this)}},templateData:function(){var e=this.options;return{resetButton:e.resetButton,submitButton:e.submitButton}},onResize:function(){this.resizeStart&&_.each(this.fields,function(e){e.onResize()}),this.resizeEnd(),this.resizeStart=!1},render:function(){var s=this,n=this.fields,a=Backbone.$,e=a(a.trim(this.template(_.result(this,"templateData"))));return e.find("[data-editors]").add(e).each(function(e,t){var i=a(t),t=i.attr("data-editors");_.isUndefined(t)||(t="*"==t?s.selectedFields||_.keys(n):t.split(","),_.each(t,function(e){e=n[e];i.append(e.editor.render().el)}))}),e.find("[data-fields]").add(e).each(function(e,t){var i=a(t),t=i.attr("data-fields");_.isUndefined(t)||(t="*"==t?s.selectedFields||_.keys(n):t.split(","),_.each(t,function(e){e=n[e];i.append(e.render().el)}))}),e.find("[data-fieldsets]").add(e).each(function(e,t){var i=a(t),t=i.attr("data-fieldsets");_.isUndefined(t)||_.each(s.fieldsets,function(e){i.append(e.render().el)})}),this.setElement(e),e.addClass(this.className),this},validate:function(i){var e,s=this.fields,t=this.model,n={};return i=i||{},_.each(s,function(e){var t=e.validate(i);t&&(n[e.key]=t)}),i.skipModelValidate||!t||!t.validate||(e=t.validate(this.getValue()))&&((t=_.isObject(e)&&!_.isArray(e))||(n._others=n._others||[],n._others.push(e)),t&&_.each(e,function(e,t){var i;s[t]&&!n[t]?(s[t].setError(e),n[t]=e):(n._others=n._others||[],(i={})[t]=e,n._others.push(i))})),_.isEmpty(n)?null:n},commit:function(e){var i,t={skipModelValidate:!(e=e||{}).validate,appendToBody:!1},t=this.validate(t);if(t)return t;e=_.extend({error:function(e,t){i=t}},e);return this.model.set(this.getValue(),e),i||void 0},getValue:function(e){if(e)return this.fields[e].getValue();var t={};return _.each(this.fields,function(e){t[e.key]=e.getValue()}),t},setValue:function(e,t){var i,s={};for(i in"string"==typeof e?s[e]=t:s=e,this.schema)void 0!==s[i]&&this.fields[i].setValue(s[i])},getEditor:function(e){var t=this.fields[e];if(!t)throw new Error("Field not found: "+e);return t.editor},focus:function(){var e;this.hasFocus||(e=this.fieldsets[0].getFieldAt(0))&&e.editor.focus()},blur:function(){var e;!this.hasFocus||(e=_.find(this.fields,function(e){return e.editor.hasFocus}))&&e.editor.blur()},trigger:function(e){return"focus"===e?this.hasFocus=!0:"blur"===e&&(this.hasFocus=!1),Backbone.View.prototype.trigger.apply(this,arguments)},remove:function(){return _.each(this.fieldsets,function(e){e.remove()}),_.each(this.fields,function(e){e.remove()}),Backbone.View.prototype.remove.apply(this,arguments)}},{editors:{}}),k0,v2,zf,k8,l8,m8,n8,o8,p8;function l0(l,e){var c=this;c.options=l,c.$element=k0(e),c.tooltip=c.options.tooltip,c.applyTooltip=function(e,t){t.prop("title",_.isFunction(c.tooltip)?c.tooltip(e.text):e.text)},k0.fn.select2.amd.require(["select2/dropdown/closeOnSelect","select2/dropdown/attachBody","select2/dropdown","select2/keys","select2/dropdown/search","select2/selection/single","select2/utils"],function(e,t,i,s,n,a,o){function r(){}n=!(r.prototype.update=function(e,t){a.prototype.update.apply(this,[t]),c.applyTooltip(t,this.$selection.find(".select2-selection__rendered"))})===l.showSearch?i:o.Decorate(i,n),n=o.Decorate(o.Decorate(n,t),e),o=o.Decorate(a,r),c.select2=c.$element.select2({ajax:l.ajax,closeOnSelect:!0,dropdownAdapter:n,matcher:l.matcher||k0.fn.select2.defaults.defaults.matcher,minimumResultsForSearch:!1===l.showSearch?-1:0,selectionAdapter:o,theme:l.theme,width:l.width,wrapClass:"wrap"}).data("select2"),c.select2.$selection.find("span.select2-selection__arrow").hide(),o=k0("<i />").addClass("fa fa-caret-down select2-dropdown-arrow"),c.select2.$selection.append(o),c.select2.$container.css("width",c.width),_.isFunction(l.initCallback)&&l.initCallback(c.select2)})}Form.Editor=Form.editors.Base=Backbone.View.extend({defaultValue:null,hasFocus:!1,initialize:function(e){if((e=e||{}).model){if(!e.key)throw new Error("Missing option: 'key'");this.model=e.model,this.value=this.model.get(e.key)}else void 0!==e.value&&(this.value=e.value);void 0===this.value&&(this.value=this.defaultValue),_.extend(this,_.pick(e,"key","form"));var t=this.schema=e.schema||{};this.validators=e.validators||t.validators,this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),t.editorClass&&this.$el.addClass(t.editorClass),t.editorAttrs&&this.$el.attr(t.editorAttrs),this.listenTo(this.model,"change:"+e.key,this.onModelValueChange)},getName:function(){return(this.key||"").replace(/\./g,"_")},getValue:function(){return this.value},onModelValueChange:function(e,t){try{this.setValue(t)}catch(e){console.log("BBForm on change error",e)}},setValue:function(e){this.value=e},focus:function(){throw new Error("Not implemented")},blur:function(){throw new Error("Not implemented")},commit:function(e){var i=this.validate();return i||(this.listenTo(this.model,"invalid",function(e,t){i=t}),this.model.set(this.key,this.getValue(),e),i||void 0)},validate:function(){this.$el;var t=null,i=this.model,s=this.getValue(),n=this.form?this.form.getValue():{},e=this.validators,a=this.getValidator;return e&&_.every(e,function(e){return!(t=a(e)(s,n,i))}),t},trigger:function(e){return"focus"===e?this.hasFocus=!0:"blur"===e&&(this.hasFocus=!1),Backbone.View.prototype.trigger.apply(this,arguments)},getValidator:function(e){var t=Form.validators;if(_.isRegExp(e))return t.regexp({regexp:e});if(_.isString(e)){if(!t[e])throw new Error('Validator "'+e+'" not found');return t[e]()}if(_.isFunction(e))return e;if(_.isObject(e)&&e.type)return t[e.type](e);throw new Error("Invalid validator: "+e)}}),Form.editors.Checkbox=Form.editors.Base.extend({defaultValue:!1,tagName:"input",events:{click:function(e){this.trigger("change",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){Form.editors.Base.prototype.initialize.call(this,e),this.$el.attr("type","checkbox")},render:function(){return this.setValue(this.value),this},getValue:function(){return this.$el.prop("checked")},setValue:function(e){e?this.$el.prop("checked",!0):this.$el.prop("checked",!1),this.value=!!e},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()}}),k0=jQuery,k0.fn.extend({dashSingleSelect:function(){var e=k0.extend({wrapClass:"wrap"},arguments[0]);this.each(function(){new l0(e,this)})}}),Form.editors.Select=Form.editors.Base.extend({tagName:"select",pageSize:100,paginationThreshold:500,previousValue:"",openDropdownOnFocus:!1,matcher:null,showSearch:null,events:{keyup:"determineChange",keypress:function(e){var t=this;setTimeout(function(){t.determineChange()},0)},change:function(e){this.trigger("change",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){if(Form.editors.Base.prototype.initialize.call(this,e),_.isObject(e)&&_.isObject(e.schema)&&(e.schema.acceptEmptyValues,1)&&(this.acceptEmptyValues=e.schema.acceptEmptyValues),e&&e.schema&&e.schema.enforceValue&&(this.enforceValue=e.schema.enforceValue),e&&e.schema&&_.isFunction(e.schema.matcher)&&(this.matcher=e.schema.matcher),e&&e.schema&&_.isBoolean(e.schema.showSearch)&&(this.showSearch=e.schema.showSearch),e&&e.schema&&e.schema.width&&(this.width=e.schema.width),e&&e.schema&&e.schema.tooltip&&(this.tooltip=e.schema.tooltip),!this.schema||!this.schema.options)throw new Error("Missing required 'schema.options'")},blur:function(){this.hasFocus&&this.$el.blur()},determineChange:function(e){var t=this.getValue();t!==this.previousValue&&(this.previousValue=t,this.trigger("change",this))},focus:function(){var e=this;this.hasFocus||(this.$el.focus(),_.defer(function(){e.openDropdownOnFocus&&e.$el.select2("open")}))},getPaginationSettings:function(o,e){var r,l=this;return o&&o.length>this.paginationThreshold?(r=l.matcher?function(e,t){return l.matcher({term:t},{text:e})}:e&&e.caseInsensitiveSort?function(e,t){return-1!==e.indexOf(t)}:function(e,t){return-1!==e.toLowerCase().indexOf(t.toLowerCase())},{ajax:{data:function(e){return{search:e.term,page:e.page||1}},transport:function(e,t,i){var s=e.data.page||1,n=e.data.search,a=(s-1)*l.pageSize,e=s*l.pageSize,s=n?_.filter(o,function(e){var t;return _.isString(e)?t=e:_.isObject(e)&&(t=e.label&&_.isFunction(e.label.toString)?e.label.toString():e.label||e.val),r(t,n)}):o;t({results:_.map(s,function(e){var t,i;return _.isString(e)?i=t=e:_.isObject(e)&&(t=e.label&&_.isFunction(e.label.toString)?e.label.toString():e.label||e.val,i=e.val),{id:i,text:t}}).slice(a,e),pagination:{more:s.length>e}})}}}):{}},getValue:function(){return"list"===this.schema.viewstateType?[this.$el.val()]:this.$el.val()},populateSelect:function(e,t){var i,s,n=this,a=this.value;this.availableOptions={},this.renderedOptions={},_.isString(t)?(e.html(t),$.each(e.find("option"),function(e,t){n.availableOptions[t.value]=t.label}),this.renderedOptions=this.availableValues):((i=!1===n.acceptEmptyValues?_.filter(this._getOptionsArray(t),function(e){return!(null==e.val||0===e.val.length)}):this._getOptionsArray(t)).length>this.paginationThreshold?(s=_.isArray(a)?_.filter(i,function(e){return-1!==a.indexOf(e.val)}):(s=_.find(i,{val:a}))&&[s],_.isEmpty(s)&&(s=i.slice(0,1))):s=i,t=this._arrayToHtml(s),e.html(t),_.each(i,function(e){_.isObject(e)&&e.hasOwnProperty("val")?n.availableOptions[e.val]=e.label||e.val:n.availableOptions[e]=e}),_.each(s,function(e){_.isObject(e)&&e.hasOwnProperty("val")?n.renderedOptions[e.val]=e.label||e.val:n.renderedOptions[e]=e}))},preRender:function(){return this},remove:function(){return this.$el.data("select2")&&(this.$el.select2("close"),this.$el.select2("destroy")),Backbone.View.prototype.remove.apply(this,arguments)},render:function(){return this.setOptions(this.schema.options),this},renderOptions:function(e){var t,i=this,s=this.$el,n=!1;this.currentOptions=e,this.populateSelect(s,e),i.schema.editorAttrs&&(n=i.schema.editorAttrs.caseInsensitiveSort,i.schema.editorAttrs.selectOnClose,i.openDropdownOnFocus=i.schema.editorAttrs.openDropdownOnFocus),t={initCallback:function(e){i.form&&i.form.options&&"environment"===i.form.options.theme&&e.on("open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")})},matcher:i.matcher,showSearch:i.showSearch,theme:"dashboards",tooltip:i.tooltip,width:i.width},_.extend(t,this.getPaginationSettings(e,{caseInsensitiveSort:n})),_.isBoolean(i.showSearch)&&(t.minimumResultsForSearch=i.showSearch?0:-1),n&&_.extend(t,{sorter:function(e){return e.sort(function(e,t){return e.text.toLowerCase().localeCompare(t.text.toLowerCase())})}}),s.dashSingleSelect(t),i.setValue(i.value),_.isUndefined(i.width)||i.setWidth(i.width)},setOptions:function(t){var e,i=this;t instanceof Backbone.Collection?0<(e=t).length?this.renderOptions(t):e.fetch({success:function(e){i.renderOptions(t)}}):_.isFunction(t)?t(function(e){i.renderOptions(e)},i):this.renderOptions(t)},setValue:function(e){var t=!1;!this.enforceValue||_.has(this.renderedOptions,e)?t=!0:_.has(this.availableOptions,e)&&(this.$el.append(new Option(this.availableOptions[e],e,!0,!0)),this.renderedOptions[e]=this.availableOptions[e],t=!0),t&&(this.value=e,this.$el.val(e).trigger("change.select2"))},setWidth:function(e){var t=this.$el.data("select2");this.width=e,t&&t.$container.css("width",this.width)},_arrayToHtml:function(e){var s="";return _.each(e,function(e,t){var i;_.isObject(e)?e.group?(i='<optgroup label="'+e.group+'">'+this._getOptionsHtml(e.options)+"</optgroup>",s+=i):(i=e.val||0===e.val?e.val:"",s+='<option value="'+i+'">'+e.label+"</option>"):s+="<option>"+e+"</option>"},this),s},_collectionToArray:function(e){var t=[];return e.each(function(e){t.push({val:e.id,label:e.toString()})}),t},_getOptionsArray:function(e){var t,e=_.isFunction(e)?(e(function(e){t=e},this),this._getOptionsArray(t)):_.isArray(e)?e:e instanceof Backbone.Collection?this._collectionToArray(e):this._objectToArray(e);return e},_getOptionsHtml:function(e,t){var i=_.isString(e)?e:(i=this._getOptionsArray(e),this._arrayToHtml(i));return i},_objectToArray:function(e){var t,i=[];for(t in e)e.hasOwnProperty(t)&&i.push({val:t,label:e[t]});return i}}),Form.editors.Checkboxes=Form.editors.Select.extend({tagName:"ul",groupNumber:0,events:{"click input[type=checkbox]":function(){this.trigger("change",this)},"focus input[type=checkbox]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=checkbox]":function(){var e;this.hasFocus&&(e=this,setTimeout(function(){e.$("input[type=checkbox]:focus")[0]||e.trigger("blur",e)},0))}},getValue:function(){var e=[];return this.$("input[type=checkbox]:checked").each(function(){e.push($(this).val())}),e},setValue:function(e){_.isArray(e)||(e=[e]),this.value=e,this.$("input[type=checkbox]").val(e)},focus:function(){this.hasFocus||this.$("input[type=checkbox]").first().focus()},blur:function(){this.hasFocus&&this.$("input[type=checkbox]:focus").blur()},_arrayToHtml:function(e){var n=$(),a=this;return _.each(e,function(e,t){var i,s=$("<li>");_.isObject(e)?e.group?(i=a.id,a.id+="-"+a.groupNumber++,s=(s=$('<fieldset class="group">').append($("<legend>").text(e.group))).append(a._arrayToHtml(e.options)),a.id=i,close=!1):(i=e.val||0===e.val?e.val:"",s.append($('<input type="checkbox" name="'+a.getName()+'" id="'+a.id+"-"+t+'" />').val(i)),e.labelHTML?s.append($('<label for="'+a.id+"-"+t+'">').html(e.labelHTML)):s.append($('<label for="'+a.id+"-"+t+'">').text(e.label))):(s.append($('<input type="checkbox" name="'+a.getName()+'" id="'+a.id+"-"+t+'" />').val(e)),s.append($('<label for="'+a.id+"-"+t+'">').text(e))),n=n.add(s)}),n}}),Form.editors.DateTimeBase=Form.editors.Base.extend({initialize:function(e,t){Form.editors.Base.prototype.initialize.call(t,e)},onKeyDown:function(){var s=this;this.$input.off("keydown"),this.$input.on("keydown",function(e){var t,i=$(this).val();s.setSelection(this.selectionStart),(65!=e.keyCode&&86!=e.keyCode&&67!=e.keyCode||!0!==e.ctrlKey&&!0!==e.metaKey)&&(-1===[9,13].indexOf(e.keyCode)?-1===[33,34,38,40].indexOf(e.keyCode)&&(-1===[35,36,37,39].indexOf(e.keyCode)?(-1!==[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105].indexOf(e.keyCode)?(/^[0-9]$/.test(i[s.lastSelection])||s.lastSelection++,t=-1!==[48,49,50,51,52,53,54,55,56,57].indexOf(e.keyCode)?String(e.keyCode-48):String(e.keyCode-96),s.lastSelection<i.length&&(i=s.replaceAt(i,s.lastSelection,t),$(this).val(i)),this.setSelectionRange(s.lastSelection+1,s.lastSelection+1),s.setSelection(s.lastSelection+1)):8===e.keyCode?(t=this.selectionStart===this.selectionEnd?Math.max(0,this.selectionStart-1):this.selectionStart,s.setSelection(t),$(this).val(s.zeroSelection(i,t,this.selectionEnd)),this.setSelectionRange(s.lastSelection,s.lastSelection)):46===e.keyCode&&(/^[0-9]$/.test(i[s.lastSelection])||s.lastSelection++,s.lastSelection<i.length&&(i=s.replaceAt(i,s.lastSelection,"0"),$(this).val(i)),this.setSelectionRange(s.lastSelection+1,s.lastSelection+1),s.setSelection(s.lastSelection+1)),e.preventDefault()):setTimeout(function(){s.updateSelection()},100)):s.$dateTimeInput?s.$dateTimeInput.datetimepicker("hide"):s.$dateInput&&s.$dateInput.datepicker("hide"))})},render:function(e){this.$input=e,this.onKeyDown()},replaceAt:function(e,t,i){return e.substr(0,t)+i+e.substr(t+i.length)},setSelection:function(e){var t,i;switch(this.lastSelection=e,":"===(i=(t=this.options.timeFormat||"HH:mm:ss.SSSSSSSSS").substring(e,e+1))?i=t.substr(e-1,1):e>=t.length&&(i=t.substr(-1,1)),"S"===(i=!_.includes(["H","m","s","S"],i)?null:i)&&(i="S1",e!==t.length&&(15<=e?i="S3":12<=e&&(i="S2"))),i){case"H":0;break;case"m":0;break;case"s":0;break;case"S1":0;break;case"S2":0}},updateSelection:function(){this.element&&this.setSelection(this.element[0].selectionStart)},zeroSelection:function(e,t,i){for(var s=e.substr(t,i),n=0;n<s.length;n++)/^[0-9]$/.test(s[n])&&(s=this.replaceAt(s,n,"0"));return this.replaceAt(e,t,s)}}),Form.editors.DatePicker=Form.editors.DateTimeBase.extend({initialize:function(e){var i=this;Form.editors.DateTimeBase.prototype.initialize.call(this,e=e||{},this);Form.editors.Date;var t=new Date;this.options=_.extend({},e),this.schema=$.extend(!0,{options:{yearStart:t.getFullYear()-100,yearEnd:t.getFullYear(),closeText:"Close",changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showAnim:"slideDown",showOn:"focus"}},e.schema||{}),this.schema.options.onClose=function(e,t){i.trigger("close",i)},this.momentFormat=this.schema.options.dateFormat?this.schema.options.dateFormat.replace("yy","YYYY").toUpperCase():"YYYY/MM/DD",this.value&&!_.isDate(this.value)&&(this.value=new Date(this.value)),this.value&&this.value instanceof Date||((t=new Date).setSeconds(0),t.setMilliseconds(0),this.value=t),this.template=e.template||this.constructor.template},initializeEvents:function(){var s=this;Form.editors.DateTimeBase.prototype.render.call(this,this.$dateInput),this.$dateInput.on("change",function(){s.updateHidden(),s.trigger("change",s)}),this.$dateInput.on("focus",function(){s.hasFocus||s.trigger("focus",s)}),this.$dateInput.on("blur",function(){s.hasFocus&&setTimeout(function(){s.$("input:focus")[0]||s.trigger("blur",s)},0)}),this.$dateInput.on("keyup",function(e){var t=s.$dateInput.val(),i=Tools.convertUserInputToMoment(t,s.momentFormat);_.includes([8,46,37,38,39,40],e.keyCode)||(i.isValid()&&moment(t,s.momentFormat,!0).isValid()?(i=i.toDashString(),s.setValue(i),s.trigger("change",s)):s.trigger("invalid",s))})},blur:function(){this.hasFocus&&this.$dateInput.first().blur()},convertISOStringToDate:function(e){var t;if(_.isDate(e)){if(_.isNaN(e.getTime()))return null;e=e.toISOString()}return e?!!(t="string"==typeof e?/^(\d\d\d\d)-(\d\d)-(\d\d)$/.exec(e.substr(0,10)):t)&&new Date(Number(t[1]),Number(t[2])-1,Number(t[3])):null},focus:function(){this.hasFocus||this.$dateInput.first().focus()},getValue:function(){var e=this.$dateInput.datepicker("getDate");return $.datepicker.formatDate("yy-mm-dd",e)},getWidth:function(){return this.schema.options.width},hide:function(){return this.$dateInput.datepicker("hide")},render:function(){var e=this.options,t=this.schema,i=Backbone.$,s=e.id;!s&&e.item&&(s=e.item.cid);s=i(this.template({key:s}));return this.$dateInput=s.find("input"),this.$dateInput.addClass("ui-state-default"),t.editorClass&&this.$dateInput.addClass(t.editorClass),this.$dateInput.datepicker(_.extend({defaultDate:this.value},t.options)),this.$hidden=i('<input type="hidden" name="'+this.key+'" />'),s.append(this.$hidden),this.setValue(this.value),this.setElement(s),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this},setValue:function(e){var t,i=this.schema&&this.schema.options&&this.schema.options.ignoreTimezone;e&&10<e.length&&(e=Tools.convertValueToMoment(e).format("YYYY-MM-DD")),t=this.convertISOStringToDate(e),i=Tools.convertValueToMoment(e,void 0,i),t&&i.isValid()?(this.$dateInput.datepicker("setDate",t),this.previousDate=e,this.updateHidden()):this.trigger("invalid",this)},setWidth:function(e){var t=this.$el.parents().closest(".datepicker-input"),e=e-this.$el.parents().closest(".datepicker-container").find(".datepicker-button").width();t.width(e)},show:function(){return this.$dateInput.datepicker("show")},updateHidden:function(){var e=this.getValue();_.isDate(e)&&!_.isNaN(e.getTime())&&(e=e.toISOString()),this.$hidden.val(e)}}),v2=function($){var Timepicker,isEmptyObject,extendRemove,detectSupport,convert24to12,computeEffectiveSetting,splitDateTime,parseDateTimeInternal,selectLocalTimezone;$.ui.timepicker=$.ui.timepicker||{},$.ui.timepicker.version||($.extend($.ui,{timepicker:{version:"1.6.1"}}),Timepicker=function(){this.regional=[],this.regional[""]={currentText:"Now",closeText:"Done",amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"HH:mm",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",microsecText:"Microsecond",timezoneText:"Time Zone",isRTL:!1},this._defaults={showButtonPanel:!0,timeOnly:!1,timeOnlyShowDate:!1,showHour:null,showMinute:null,showSecond:null,showMillisec:null,showMicrosec:null,showTimezone:null,showTime:!0,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,stepMicrosec:1,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,microsecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,microsecMax:999,minDateTime:null,maxDateTime:null,maxTime:null,minTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,microsecGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,altTimeFormat:null,altSeparator:null,altTimeSuffix:null,altRedirectFocus:!0,pickerTimeFormat:null,pickerTimeSuffix:null,showTimepicker:!0,timezoneList:null,addSliderAccess:!1,sliderAccessArgs:null,controlType:"slider",oneLine:!1,defaultValue:null,parse:"strict",afterInject:null},$.extend(this._defaults,this.regional[""])},$.extend(Timepicker.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,microsec_slider:null,timezone_select:null,maxTime:null,minTime:null,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,microsecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,microsecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,units:["hour","minute","second","millisec","microsec"],support:{},control:null,setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_newInst:function($input,opts){var tp_inst=new Timepicker,inlineSettings={},fns={},overrides,i,attrName;for(attrName in this._defaults)if(this._defaults.hasOwnProperty(attrName)){var attrValue=$input.attr("time:"+attrName);if(attrValue)try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}for(i in overrides={beforeShow:function(e,t){if($.isFunction(tp_inst._defaults.evnts.beforeShow))return tp_inst._defaults.evnts.beforeShow.call($input[0],e,t,tp_inst)},onChangeMonthYear:function(e,t,i){$.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)&&tp_inst._defaults.evnts.onChangeMonthYear.call($input[0],e,t,i,tp_inst)},onClose:function(e,t){!0===tp_inst.timeDefined&&""!==$input.val()&&tp_inst._updateDateTime(t),$.isFunction(tp_inst._defaults.evnts.onClose)&&tp_inst._defaults.evnts.onClose.call($input[0],e,t,tp_inst)}},overrides)overrides.hasOwnProperty(i)&&(fns[i]=opts[i]||this._defaults[i]||null);tp_inst._defaults=$.extend({},this._defaults,inlineSettings,opts,overrides,{evnts:fns,timepicker:tp_inst}),tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(e){return e.toUpperCase()}),tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(e){return e.toUpperCase()}),tp_inst.support=detectSupport(tp_inst._defaults.timeFormat+(tp_inst._defaults.pickerTimeFormat||"")+(tp_inst._defaults.altTimeFormat||"")),"string"==typeof tp_inst._defaults.controlType?("slider"===tp_inst._defaults.controlType&&void 0===$.ui.slider&&(tp_inst._defaults.controlType="select"),tp_inst.control=tp_inst._controls[tp_inst._defaults.controlType]):tp_inst.control=tp_inst._defaults.controlType;var timezoneList=[-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];null!==tp_inst._defaults.timezoneList&&(timezoneList=tp_inst._defaults.timezoneList);var tzl=timezoneList.length,tzi=0,tzv=null;if(0<tzl&&"object"!=typeof timezoneList[0])for(;tzi<tzl;tzi++)tzv=timezoneList[tzi],timezoneList[tzi]={value:tzv,label:$.timepicker.timezoneOffsetString(tzv,tp_inst.support.iso8601)};return tp_inst._defaults.timezoneList=timezoneList,tp_inst.timezone=null!==tp_inst._defaults.timezone?$.timepicker.timezoneOffsetNumber(tp_inst._defaults.timezone):-1*(new Date).getTimezoneOffset(),tp_inst.hour=tp_inst._defaults.hour<tp_inst._defaults.hourMin?tp_inst._defaults.hourMin:tp_inst._defaults.hour>tp_inst._defaults.hourMax?tp_inst._defaults.hourMax:tp_inst._defaults.hour,tp_inst.minute=tp_inst._defaults.minute<tp_inst._defaults.minuteMin?tp_inst._defaults.minuteMin:tp_inst._defaults.minute>tp_inst._defaults.minuteMax?tp_inst._defaults.minuteMax:tp_inst._defaults.minute,tp_inst.second=tp_inst._defaults.second<tp_inst._defaults.secondMin?tp_inst._defaults.secondMin:tp_inst._defaults.second>tp_inst._defaults.secondMax?tp_inst._defaults.secondMax:tp_inst._defaults.second,tp_inst.millisec=tp_inst._defaults.millisec<tp_inst._defaults.millisecMin?tp_inst._defaults.millisecMin:tp_inst._defaults.millisec>tp_inst._defaults.millisecMax?tp_inst._defaults.millisecMax:tp_inst._defaults.millisec,tp_inst.microsec=tp_inst._defaults.microsec<tp_inst._defaults.microsecMin?tp_inst._defaults.microsecMin:tp_inst._defaults.microsec>tp_inst._defaults.microsecMax?tp_inst._defaults.microsecMax:tp_inst._defaults.microsec,tp_inst.ampm="",tp_inst.$input=$input,tp_inst._defaults.altField&&(tp_inst.$altInput=$(tp_inst._defaults.altField),!0===tp_inst._defaults.altRedirectFocus&&tp_inst.$altInput.css({cursor:"pointer"}).focus(function(){$input.trigger("focus")})),0!==tp_inst._defaults.minDate&&0!==tp_inst._defaults.minDateTime||(tp_inst._defaults.minDate=new Date),0!==tp_inst._defaults.maxDate&&0!==tp_inst._defaults.maxDateTime||(tp_inst._defaults.maxDate=new Date),void 0!==tp_inst._defaults.minDate&&tp_inst._defaults.minDate instanceof Date&&(tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())),void 0!==tp_inst._defaults.minDateTime&&tp_inst._defaults.minDateTime instanceof Date&&(tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())),void 0!==tp_inst._defaults.maxDate&&tp_inst._defaults.maxDate instanceof Date&&(tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())),void 0!==tp_inst._defaults.maxDateTime&&tp_inst._defaults.maxDateTime instanceof Date&&(tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())),tp_inst.$input.bind("focus",function(){tp_inst._onFocus()}),tp_inst},_addTimePicker:function(e){var t=$.trim(this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val());this.timeDefined=this._parseTime(t),this._limitMinMaxDateTime(e,!1),this._injectTimePicker(),this._afterInject()},_parseTime:function(t,i){if(this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),i||!this._defaults.timeOnly){i=$.datepicker._get(this.inst,"dateFormat");try{var e=parseDateTimeInternal(i,this._defaults.timeFormat,t,$.datepicker._getFormatConfig(this.inst),this._defaults);if(!e.timeObj)return!1;$.extend(this,e.timeObj)}catch(e){return $.timepicker.log("Error parsing the date/time string: "+e+"\ndate/time string = "+t+"\ntimeFormat = "+this._defaults.timeFormat+"\ndateFormat = "+i),!1}return!0}t=$.datepicker.parseTime(this._defaults.timeFormat,t,this._defaults);return!!t&&($.extend(this,t),!0)},_afterInject:function(){var e=this.inst.settings;$.isFunction(e.afterInject)&&e.afterInject.call(this)},_injectTimePicker:function(){var e,t=this.inst.dpDiv,i=this.inst.settings,n=this,a="",s="",o=null,r={},l={},c=0,u=0;if(0===t.find("div.ui-timepicker-div").length&&i.showTimepicker){for(var h=" ui_tpicker_unit_hide",d='<div class="ui-timepicker-div'+(i.isRTL?" ui-timepicker-rtl":"")+(i.oneLine?" ui-timepicker-oneLine":"")+'"><dl><dt class="ui_tpicker_time_label'+(i.showTime?"":h)+'">'+i.timeText+'</dt><dd class="ui_tpicker_time '+(i.showTime?"":h)+'"><input class="ui_tpicker_time_input" '+(i.timeInput?"":"disabled")+"/></dd>",c=0,u=this.units.length;c<u;c++){if(o=null!==i["show"+(s=(a=this.units[c]).substr(0,1).toUpperCase()+a.substr(1))]?i["show"+s]:this.support[a],r[a]=parseInt(i[a+"Max"]-(i[a+"Max"]-i[a+"Min"])%i["step"+s],10),l[a]=0,d+='<dt class="ui_tpicker_'+a+"_label"+(o?"":h)+'">'+i[a+"Text"]+'</dt><dd class="ui_tpicker_'+a+(o?"":h)+'"><div class="ui_tpicker_'+a+"_slider"+(o?"":h)+'"></div>',o&&0<i[a+"Grid"]){if(d+='<div style="padding-left: 1px"><table class="ui-tpicker-grid-label"><tr>',"hour"===a)for(var m=i[a+"Min"];m<=r[a];m+=parseInt(i[a+"Grid"],10)){l[a]++;var p=$.datepicker.formatTime(this.support.ampm?"hht":"HH",{hour:m},i);d+='<td data-for="'+a+'">'+p+"</td>"}else for(var f=i[a+"Min"];f<=r[a];f+=parseInt(i[a+"Grid"],10))l[a]++,d+='<td data-for="'+a+'">'+(f<10?"0":"")+f+"</td>";d+="</tr></table></div>"}d+="</dd>"}var g=null!==i.showTimezone?i.showTimezone:this.support.timezone;d+='<dt class="ui_tpicker_timezone_label'+(g?"":h)+'">'+i.timezoneText+"</dt>",d+='<dd class="ui_tpicker_timezone'+(g?"":h)+'"></dd>';var v=$(d+="</dl></div>");for(!0===i.timeOnly&&(v.prepend('<div class="ui-widget-header ui-helper-clearfix ui-corner-all"><div class="ui-datepicker-title">'+i.timeOnlyTitle+"</div></div>"),t.find(".ui-datepicker-header, .ui-datepicker-calendar").hide()),c=0,u=n.units.length;c<u;c++)o=null!==i["show"+(s=(a=n.units[c]).substr(0,1).toUpperCase()+a.substr(1))]?i["show"+s]:this.support[a],n[a+"_slider"]=n.control.create(n,v.find(".ui_tpicker_"+a+"_slider"),a,n[a],i[a+"Min"],r[a],i["step"+s]),o&&0<i[a+"Grid"]&&(e=100*l[a]*i[a+"Grid"]/(r[a]-i[a+"Min"]),v.find(".ui_tpicker_"+a+" table").css({width:e+"%",marginLeft:i.isRTL?"0":e/(-2*l[a])+"%",marginRight:i.isRTL?e/(-2*l[a])+"%":"0",borderCollapse:"collapse"}).find("td").click(function(e){var t=$(this),i=t.html(),s=parseInt(i.replace(/[^0-9]/g),10),i=i.replace(/[^apm]/gi),t=t.data("for");"hour"===t&&(-1!==i.indexOf("p")&&s<12?s+=12:-1!==i.indexOf("a")&&12===s&&(s=0)),n.control.value(n,n[t+"_slider"],a,s),n._onTimeChange(),n._onSelectHandler()}).css({cursor:"pointer",width:100/l[a]+"%",textAlign:"center",overflow:"hidden"}));this.timezone_select=v.find(".ui_tpicker_timezone").append("<select></select>").find("select"),$.fn.append.apply(this.timezone_select,$.map(i.timezoneList,function(e,t){return $("<option />").val("object"==typeof e?e.value:e).text("object"==typeof e?e.label:e)})),void 0!==this.timezone&&null!==this.timezone&&""!==this.timezone?-1*new Date(this.inst.selectedYear,this.inst.selectedMonth,this.inst.selectedDay,12).getTimezoneOffset()===this.timezone?selectLocalTimezone(n):this.timezone_select.val(this.timezone):void 0!==this.hour&&null!==this.hour&&""!==this.hour?this.timezone_select.val(i.timezone):selectLocalTimezone(n),this.timezone_select.change(function(){n._onTimeChange(),n._onSelectHandler(),n._afterInject()});var _,y,g=t.find(".ui-datepicker-buttonpane");g.length?g.before(v):t.append(v),this.$timeObj=v.find(".ui_tpicker_time_input"),this.$timeObj.change(function(){var e=n.inst.settings.timeFormat,t=$.datepicker.parseTime(e,this.value),e=new Date;t?(e.setHours(t.hour),e.setMinutes(t.minute),e.setSeconds(t.second),$.datepicker._setTime(n.inst,e)):(this.value=n.formattedTime,this.blur())}),null!==this.inst&&(t=this.timeDefined,this._onTimeChange(),this.timeDefined=t),this._defaults.addSliderAccess&&(_=this._defaults.sliderAccessArgs,y=this._defaults.isRTL,_.isRTL=y,setTimeout(function(){var a;0===v.find(".ui-slider-access").length&&(v.find(".ui-slider:visible").sliderAccess(_),(a=v.find(".ui-slider-access:eq(0)").outerWidth(!0))&&v.find("table:visible").each(function(){var e=$(this),t=e.outerWidth(),i=e.css(y?"marginRight":"marginLeft").toString().replace("%",""),s=t-a,n={width:s,marginRight:0,marginLeft:0};n[y?"marginRight":"marginLeft"]=i*s/t+"%",e.css(n)}))},10)),n._limitMinMaxDateTime(this.inst,!0)}},_limitMinMaxDateTime:function(e,t){var i,s,n,a,o,r=this._defaults,l=new Date(e.selectedYear,e.selectedMonth,e.selectedDay);this._defaults.showTimepicker&&(null!==$.datepicker._get(e,"minDateTime")&&void 0!==$.datepicker._get(e,"minDateTime")&&l&&(s=$.datepicker._get(e,"minDateTime"),i=new Date(s.getFullYear(),s.getMonth(),s.getDate(),0,0,0,0),null!==this.hourMinOriginal&&null!==this.minuteMinOriginal&&null!==this.secondMinOriginal&&null!==this.millisecMinOriginal&&null!==this.microsecMinOriginal||(this.hourMinOriginal=r.hourMin,this.minuteMinOriginal=r.minuteMin,this.secondMinOriginal=r.secondMin,this.millisecMinOriginal=r.millisecMin,this.microsecMinOriginal=r.microsecMin),e.settings.timeOnly||i.getTime()===l.getTime()?(this._defaults.hourMin=s.getHours(),this.hour<=this._defaults.hourMin?(this.hour=this._defaults.hourMin,this._defaults.minuteMin=s.getMinutes(),this.minute<=this._defaults.minuteMin?(this.minute=this._defaults.minuteMin,this._defaults.secondMin=s.getSeconds(),this.second<=this._defaults.secondMin?(this.second=this._defaults.secondMin,this._defaults.millisecMin=s.getMilliseconds(),this.millisec<=this._defaults.millisecMin?(this.millisec=this._defaults.millisecMin,this._defaults.microsecMin=s.getMicroseconds()):(this.microsec<this._defaults.microsecMin&&(this.microsec=this._defaults.microsecMin),this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)):(this._defaults.hourMin=this.hourMinOriginal,this._defaults.minuteMin=this.minuteMinOriginal,this._defaults.secondMin=this.secondMinOriginal,this._defaults.millisecMin=this.millisecMinOriginal,this._defaults.microsecMin=this.microsecMinOriginal)),null!==$.datepicker._get(e,"maxDateTime")&&void 0!==$.datepicker._get(e,"maxDateTime")&&l&&(n=$.datepicker._get(e,"maxDateTime"),s=new Date(n.getFullYear(),n.getMonth(),n.getDate(),0,0,0,0),null!==this.hourMaxOriginal&&null!==this.minuteMaxOriginal&&null!==this.secondMaxOriginal&&null!==this.millisecMaxOriginal||(this.hourMaxOriginal=r.hourMax,this.minuteMaxOriginal=r.minuteMax,this.secondMaxOriginal=r.secondMax,this.millisecMaxOriginal=r.millisecMax,this.microsecMaxOriginal=r.microsecMax),e.settings.timeOnly||s.getTime()===l.getTime()?(this._defaults.hourMax=n.getHours(),this.hour>=this._defaults.hourMax?(this.hour=this._defaults.hourMax,this._defaults.minuteMax=n.getMinutes(),this.minute>=this._defaults.minuteMax?(this.minute=this._defaults.minuteMax,this._defaults.secondMax=n.getSeconds(),this.second>=this._defaults.secondMax?(this.second=this._defaults.secondMax,this._defaults.millisecMax=n.getMilliseconds(),this.millisec>=this._defaults.millisecMax?(this.millisec=this._defaults.millisecMax,this._defaults.microsecMax=n.getMicroseconds()):(this.microsec>this._defaults.microsecMax&&(this.microsec=this._defaults.microsecMax),this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)):(this._defaults.hourMax=this.hourMaxOriginal,this._defaults.minuteMax=this.minuteMaxOriginal,this._defaults.secondMax=this.secondMaxOriginal,this._defaults.millisecMax=this.millisecMaxOriginal,this._defaults.microsecMax=this.microsecMaxOriginal)),null!==e.settings.minTime&&(a=new Date("01/01/1970 "+e.settings.minTime),this.hour<a.getHours()?(this.hour=this._defaults.hourMin=a.getHours(),this.minute=this._defaults.minuteMin=a.getMinutes()):this.hour===a.getHours()&&this.minute<a.getMinutes()?this.minute=this._defaults.minuteMin=a.getMinutes():this._defaults.hourMin<a.getHours()?(this._defaults.hourMin=a.getHours(),this._defaults.minuteMin=a.getMinutes()):this._defaults.hourMin===a.getHours()===this.hour&&this._defaults.minuteMin<a.getMinutes()?this._defaults.minuteMin=a.getMinutes():this._defaults.minuteMin=0),null!==e.settings.maxTime&&(o=new Date("01/01/1970 "+e.settings.maxTime),this.hour>o.getHours()?(this.hour=this._defaults.hourMax=o.getHours(),this.minute=this._defaults.minuteMax=o.getMinutes()):this.hour===o.getHours()&&this.minute>o.getMinutes()?this.minute=this._defaults.minuteMax=o.getMinutes():this._defaults.hourMax>o.getHours()?(this._defaults.hourMax=o.getHours(),this._defaults.minuteMax=o.getMinutes()):this._defaults.hourMax===o.getHours()===this.hour&&this._defaults.minuteMax>o.getMinutes()?this._defaults.minuteMax=o.getMinutes():this._defaults.minuteMax=59),void 0!==t&&!0===t&&(n=parseInt(this._defaults.hourMax-(this._defaults.hourMax-this._defaults.hourMin)%this._defaults.stepHour,10),a=parseInt(this._defaults.minuteMax-(this._defaults.minuteMax-this._defaults.minuteMin)%this._defaults.stepMinute,10),e=parseInt(this._defaults.secondMax-(this._defaults.secondMax-this._defaults.secondMin)%this._defaults.stepSecond,10),o=parseInt(this._defaults.millisecMax-(this._defaults.millisecMax-this._defaults.millisecMin)%this._defaults.stepMillisec,10),t=parseInt(this._defaults.microsecMax-(this._defaults.microsecMax-this._defaults.microsecMin)%this._defaults.stepMicrosec,10),this.hour_slider&&(this.control.options(this,this.hour_slider,"hour",{min:this._defaults.hourMin,max:n,step:this._defaults.stepHour}),this.control.value(this,this.hour_slider,"hour",this.hour-this.hour%this._defaults.stepHour)),this.minute_slider&&(this.control.options(this,this.minute_slider,"minute",{min:this._defaults.minuteMin,max:a,step:this._defaults.stepMinute}),this.control.value(this,this.minute_slider,"minute",this.minute-this.minute%this._defaults.stepMinute)),this.second_slider&&(this.control.options(this,this.second_slider,"second",{min:this._defaults.secondMin,max:e,step:this._defaults.stepSecond}),this.control.value(this,this.second_slider,"second",this.second-this.second%this._defaults.stepSecond)),this.millisec_slider&&(this.control.options(this,this.millisec_slider,"millisec",{min:this._defaults.millisecMin,max:o,step:this._defaults.stepMillisec}),this.control.value(this,this.millisec_slider,"millisec",this.millisec-this.millisec%this._defaults.stepMillisec)),this.microsec_slider&&(this.control.options(this,this.microsec_slider,"microsec",{min:this._defaults.microsecMin,max:t,step:this._defaults.stepMicrosec}),this.control.value(this,this.microsec_slider,"microsec",this.microsec-this.microsec%this._defaults.stepMicrosec))))},_onTimeChange:function(){var e,t,i,s,n,a,o,r,l,c,u;this._defaults.showTimepicker&&(e=!!this.hour_slider&&this.control.value(this,this.hour_slider,"hour"),t=!!this.minute_slider&&this.control.value(this,this.minute_slider,"minute"),i=!!this.second_slider&&this.control.value(this,this.second_slider,"second"),s=!!this.millisec_slider&&this.control.value(this,this.millisec_slider,"millisec"),n=!!this.microsec_slider&&this.control.value(this,this.microsec_slider,"microsec"),c=!!this.timezone_select&&this.timezone_select.val(),o=(a=this._defaults).pickerTimeFormat||a.timeFormat,r=a.pickerTimeSuffix||a.timeSuffix,"object"==typeof t&&(t=!1),"object"==typeof i&&(i=!1),"object"==typeof s&&(s=!1),"object"==typeof n&&(n=!1),"object"==typeof c&&(c=!1),!1!==(e="object"==typeof e?!1:e)&&(e=parseInt(e,10)),!1!==t&&(t=parseInt(t,10)),!1!==i&&(i=parseInt(i,10)),!1!==s&&(s=parseInt(s,10)),!1!==n&&(n=parseInt(n,10)),!1!==c&&(c=c.toString()),u=a[e<12?"amNames":"pmNames"][0],(l=e!==parseInt(this.hour,10)||t!==parseInt(this.minute,10)||i!==parseInt(this.second,10)||s!==parseInt(this.millisec,10)||n!==parseInt(this.microsec,10)||0<this.ampm.length&&e<12!=(-1!==$.inArray(this.ampm.toUpperCase(),this.amNames))||null!==this.timezone&&c!==this.timezone.toString())&&(!1!==e&&(this.hour=e),!1!==t&&(this.minute=t),!1!==i&&(this.second=i),!1!==s&&(this.millisec=s),!1!==n&&(this.microsec=n),!1!==c&&(this.timezone=c),this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),this._limitMinMaxDateTime(this.inst,!0)),this.support.ampm&&(this.ampm=u),this.formattedTime=$.datepicker.formatTime(a.timeFormat,this,a),this.$timeObj&&(c=this.$timeObj[0].selectionStart,u=this.$timeObj[0].selectionEnd,o===a.timeFormat?this.$timeObj.val(this.formattedTime+r):this.$timeObj.val($.datepicker.formatTime(o,this,a)+r),this.$timeObj[0].setSelectionRange(c,u)),this.timeDefined=!0,l&&this._updateDateTime())},_onSelectHandler:function(){var e=this._defaults.onSelect||this.inst.settings.onSelect,t=this.$input?this.$input[0]:null;e&&t&&e.apply(t,[this.formattedDateTime,this])},_updateDateTime:function(e){var t=0<(e=this.inst||e).currentYear?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(e.selectedYear,e.selectedMonth,e.selectedDay),i=$.datepicker._daylightSavingAdjust(t),s=$.datepicker._get(e,"dateFormat"),n=$.datepicker._getFormatConfig(e),a=null!==i&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(s,null===i?new Date:i,n);t=this.formattedDate;""===e.lastVal&&(e.currentYear=e.selectedYear,e.currentMonth=e.selectedMonth,e.currentDay=e.selectedDay),!0===this._defaults.timeOnly&&!1===this._defaults.timeOnlyShowDate?t=this.formattedTime:(!0!==this._defaults.timeOnly&&(this._defaults.alwaysSetTime||a)||!0===this._defaults.timeOnly&&!0===this._defaults.timeOnlyShowDate)&&(t+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix),this.formattedDateTime=t,this._defaults.showTimepicker?this.$altInput&&!1===this._defaults.timeOnly&&!0===this._defaults.altFieldTimeOnly?(this.$altInput.val(this.formattedTime),this.$input.val(this.formattedDate)):this.$altInput?(this.$input.val(t),s="",e=null!==this._defaults.altSeparator?this._defaults.altSeparator:this._defaults.separator,a=null!==this._defaults.altTimeSuffix?this._defaults.altTimeSuffix:this._defaults.timeSuffix,this._defaults.timeOnly||(s=this._defaults.altFormat?$.datepicker.formatDate(this._defaults.altFormat,null===i?new Date:i,n):this.formattedDate)&&(s+=e),null!==this._defaults.altTimeFormat?s+=$.datepicker.formatTime(this._defaults.altTimeFormat,this,this._defaults)+a:s+=this.formattedTime+a,this.$altInput.val(s)):this.$input.val(t):this.$input.val(this.formattedDate),this.$input.trigger("change")},_onFocus:function(){if(!this.$input.val()&&this._defaults.defaultValue){this.$input.val(this._defaults.defaultValue);var e=$.datepicker._getInst(this.$input.get(0)),t=$.datepicker._get(e,"timepicker");if(t&&t._defaults.timeOnly&&e.input.val()!==e.lastVal)try{$.datepicker._updateDatepicker(e)}catch(e){$.timepicker.log(e)}}},_controls:{slider:{create:function(i,e,s,t,n,a,o){var r=i._defaults.isRTL;return e.prop("slide",null).slider({orientation:"horizontal",value:r?-1*t:t,min:r?-1*a:n,max:r?-1*n:a,step:o,slide:function(e,t){i.control.value(i,$(this),s,r?-1*t.value:t.value),i._onTimeChange()},stop:function(e,t){i._onSelectHandler()}})},options:function(e,t,i,s,n){if(e._defaults.isRTL){if("string"==typeof s)return"min"===s||"max"===s?void 0!==n?t.slider(s,-1*n):Math.abs(t.slider(s)):t.slider(s);var a=s.min,e=s.max;return s.min=s.max=null,void 0!==a&&(s.max=-1*a),void 0!==e&&(s.min=-1*e),t.slider(s)}return"string"==typeof s&&void 0!==n?t.slider(s,n):t.slider(s)},value:function(e,t,i,s){return e._defaults.isRTL?void 0!==s?t.slider("value",-1*s):Math.abs(t.slider("value")):void 0!==s?t.slider("value",s):t.slider("value")}},select:{create:function(t,e,i,s,n,a,o){for(var r='<select class="ui-timepicker-select ui-state-default ui-corner-all" data-unit="'+i+'" data-min="'+n+'" data-max="'+a+'" data-step="'+o+'">',l=t._defaults.pickerTimeFormat||t._defaults.timeFormat,c=n;c<=a;c+=o)r+='<option value="'+c+'"'+(c===s?" selected":"")+">",r+="hour"===i?$.datepicker.formatTime($.trim(l.replace(/[^ht ]/gi,"")),{hour:c},t._defaults):"millisec"===i||"microsec"===i||10<=c?c:"0"+c.toString(),r+="</option>";return r+="</select>",e.children("select").remove(),$(r).appendTo(e).change(function(e){t._onTimeChange(),t._onSelectHandler(),t._afterInject()}),e},options:function(e,t,i,s,n){var a={},o=t.children("select");if("string"==typeof s){if(void 0===n)return o.data(s);a[s]=n}else a=s;return e.control.create(e,t,o.data("unit"),o.val(),0<=a.min?a.min:o.data("min"),a.max||o.data("max"),a.step||o.data("step"))},value:function(e,t,i,s){t=t.children("select");return void 0!==s?t.val(s):t.val()}}}}),$.fn.extend({timepicker:function(e){e=e||{};var t=Array.prototype.slice.call(arguments);return"object"==typeof e&&(t[0]=$.extend(e,{timeOnly:!0})),$(this).each(function(){$.fn.datetimepicker.apply($(this),t)})},datetimepicker:function(t){t=t||{};var i=arguments;return"string"==typeof t?"getDate"===t||"option"===t&&2===i.length&&"string"==typeof i[1]?$.fn.datepicker.apply($(this[0]),i):this.each(function(){var e=$(this);e.datepicker.apply(e,i)}):this.each(function(){var e=$(this);e.datepicker($.timepicker._newInst(e,t)._defaults)})}}),$.datepicker.parseDateTime=function(e,t,i,s,n){s=parseDateTimeInternal(e,t,i,s,n);return s.timeObj&&(n=s.timeObj,s.date.setHours(n.hour,n.minute,n.second,n.millisec),s.date.setMicroseconds(n.microsec)),s.date},$.datepicker.parseTime=function(e,t,i){function n(e,t,a){var i="^"+e.toString().replace(/([hH]{1,2}|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g,function(e){var t,i,s,n=e.length;switch(e.charAt(0).toLowerCase()){case"h":case"m":case"s":return 1===n?"(\\d?\\d)":"(\\d{"+n+"})";case"l":case"c":return"(\\d?\\d?\\d)";case"z":return"(z|[-+]\\d\\d:?\\d\\d|\\S+)?";case"t":return t=a.amNames,i=a.pmNames,s=[],t&&$.merge(s,t),i&&$.merge(s,i),"("+(s=$.map(s,function(e){return e.replace(/[.*+?|()\[\]{}\\]/g,"\\$&")})).join("|")+")?";default:return"("+e.replace(/\'/g,"").replace(/(\.|\$|\^|\\|\/|\(|\)|\[|\]|\?|\+|\*)/g,function(e){return"\\"+e})+")?"}}).replace(/\s/g,"\\s?")+a.timeSuffix+"$",s=function(e){var t=e.toLowerCase().match(/(h{1,2}|m{1,2}|s{1,2}|l{1}|c{1}|t{1,2}|z|'.*?')/g),i={h:-1,m:-1,s:-1,l:-1,c:-1,t:-1,z:-1};if(t)for(var s=0;s<t.length;s++)-1===i[t[s].toString().charAt(0)]&&(i[t[s].toString().charAt(0)]=s+1);return i}(e),e="",t=t.match(new RegExp(i,"i")),i={hour:0,minute:0,second:0,millisec:0,microsec:0};return!!t&&(-1!==s.t&&(void 0===t[s.t]||0===t[s.t].length?i.ampm=e="":(e=-1!==$.inArray(t[s.t].toUpperCase(),$.map(a.amNames,function(e,t){return e.toUpperCase()}))?"AM":"PM",i.ampm=a["AM"===e?"amNames":"pmNames"][0])),-1!==s.h&&("AM"===e&&"12"===t[s.h]?i.hour=0:"PM"===e&&"12"!==t[s.h]?i.hour=parseInt(t[s.h],10)+12:i.hour=Number(t[s.h])),-1!==s.m&&(i.minute=Number(t[s.m])),-1!==s.s&&(i.second=Number(t[s.s])),-1!==s.l&&(i.millisec=Number(t[s.l])),-1!==s.c&&(i.microsec=Number(t[s.c])),-1!==s.z&&void 0!==t[s.z]&&(i.timezone=$.timepicker.timezoneOffsetNumber(t[s.z])),i)}i=extendRemove(extendRemove({},$.timepicker._defaults),i||{}),e.replace(/\'.*?\'/g,"").indexOf("Z");return"function"==typeof i.parse?i.parse(e,t,i):("loose"===i.parse?function(t,i,s){try{var e=new Date("2012-01-01 "+i);if(isNaN(e.getTime())&&(e=new Date("2012-01-01T"+i),isNaN(e.getTime())&&(e=new Date("01/01/2012 "+i),isNaN(e.getTime()))))throw"Unable to parse time with native Date: "+i;return{hour:e.getHours(),minute:e.getMinutes(),second:e.getSeconds(),millisec:e.getMilliseconds(),microsec:e.getMicroseconds(),timezone:-1*e.getTimezoneOffset()}}catch(e){try{return n(t,i,s)}catch(e){$.timepicker.log("Unable to parse \ntimeString: "+i+"\ntimeFormat: "+t)}}return!1}:n)(e,t,i)},$.datepicker.formatTime=function(e,t,i){i=i||{},i=$.extend({},$.timepicker._defaults,i),t=$.extend({hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null},t);var e=e,s=i.amNames[0],n=parseInt(t.hour,10);return 11<n&&(s=i.pmNames[0]),e=e.replace(/(?:HH?|hh?|mm?|ss?|[tT]{1,2}|[zZ]|[lc]|'.*?')/g,function(e){switch(e){case"HH":return("0"+n).slice(-2);case"H":return n;case"hh":return("0"+convert24to12(n)).slice(-2);case"h":return convert24to12(n);case"mm":return("0"+t.minute).slice(-2);case"m":return t.minute;case"ss":return("0"+t.second).slice(-2);case"s":return t.second;case"l":return("00"+t.millisec).slice(-3);case"c":return("00"+t.microsec).slice(-3);case"z":return $.timepicker.timezoneOffsetString((null===t.timezone?i:t).timezone,!1);case"Z":return $.timepicker.timezoneOffsetString((null===t.timezone?i:t).timezone,!0);case"T":return s.charAt(0).toUpperCase();case"TT":return s.toUpperCase();case"t":return s.charAt(0).toLowerCase();case"tt":return s.toLowerCase();default:return e.replace(/'/g,"")}})},$.datepicker._base_selectDate=$.datepicker._selectDate,$.datepicker._selectDate=function(e,t){var i=this._getInst($(e)[0]),s=this._get(i,"timepicker");s&&i.settings.showTimepicker?(s._limitMinMaxDateTime(i,!0),s=i.inline,i.inline=i.stay_open=!0,this._base_selectDate(e,t),i.inline=s,i.stay_open=!1,this._notifyChange(i),this._updateDatepicker(i)):this._base_selectDate(e,t)},$.datepicker._base_updateDatepicker=$.datepicker._updateDatepicker,$.datepicker._updateDatepicker=function(e){var t,i,s=e.input[0];$.datepicker._curInst&&$.datepicker._curInst!==e&&$.datepicker._datepickerShowing&&$.datepicker._lastInput!==s||("boolean"==typeof e.stay_open&&!1!==e.stay_open||(this._base_updateDatepicker(e),(t=this._get(e,"timepicker"))&&(i=s=0,t.$timeObj&&(s=t.$timeObj[0].selectionStart,i=t.$timeObj[0].selectionEnd),t._addTimePicker(e),t.$timeObj&&t.$timeObj[0].setSelectionRange(s,i))),$.datepicker._datepickerShowing&&(i=$("#ui-datepicker-div"),this.$closeButton=$('<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all">Close</button>'),0===i.find(".ui-datepicker-close").length&&(i.find(".ui-datepicker-buttonpane").append(this.$closeButton),this.$closeButton.on("click",function(){$($.datepicker._lastInput).datepicker("hide")}))))},$.datepicker._base_doKeyPress=$.datepicker._doKeyPress,$.datepicker._doKeyPress=function(e){var t=$.datepicker._getInst(e.target),i=$.datepicker._get(t,"timepicker");if(i&&$.datepicker._get(t,"constrainInput")){var s=i.support.ampm,n=null!==i._defaults.showTimezone?i._defaults.showTimezone:i.support.timezone,t=$.datepicker._possibleChars($.datepicker._get(t,"dateFormat")),n=i._defaults.timeFormat.toString().replace(/[hms]/g,"").replace(/TT/g,s?"APM":"").replace(/Tt/g,s?"AaPpMm":"").replace(/tT/g,s?"AaPpMm":"").replace(/T/g,s?"AP":"").replace(/tt/g,s?"apm":"").replace(/t/g,s?"ap":"")+" "+i._defaults.separator+i._defaults.timeSuffix+(n?i._defaults.timezoneList.join(""):"")+i._defaults.amNames.join("")+i._defaults.pmNames.join("")+t,i=String.fromCharCode(void 0===e.charCode?e.keyCode:e.charCode);return e.ctrlKey||i<" "||!t||-1<n.indexOf(i)}return $.datepicker._base_doKeyPress(e)},$.datepicker._base_updateAlternate=$.datepicker._updateAlternate,$.datepicker._updateAlternate=function(e){var t,i,s,n,a,o,r,l=this._get(e,"timepicker");l?(t=l._defaults.altField)&&(l._defaults.altFormat||l._defaults.dateFormat,i=this._getDate(e),s=$.datepicker._getFormatConfig(e),n="",a=l._defaults.altSeparator||l._defaults.separator,o=l._defaults.altTimeSuffix||l._defaults.timeSuffix,r=null!==l._defaults.altTimeFormat?l._defaults.altTimeFormat:l._defaults.timeFormat,n+=$.datepicker.formatTime(r,l,l._defaults)+o,l._defaults.timeOnly||l._defaults.altFieldTimeOnly||null===i||(n=l._defaults.altFormat?$.datepicker.formatDate(l._defaults.altFormat,i,s)+a+n:l.formattedDate+a+n),$(t).val(e.input.val()?n:"")):$.datepicker._base_updateAlternate(e)},$.datepicker._base_doKeyUp=$.datepicker._doKeyUp,$.datepicker._doKeyUp=function(e){var t,i=$.datepicker._getInst(e.target),s=0,n=i.input.val(),a=$.datepicker._get(i,"timepicker");if(a&&n!==i.lastVal)if(a._defaults.timeOnly)try{$.datepicker._updateDatepicker(i)}catch(e){$.timepicker.log(e)}else{t=new Date(n),(n=/\.\d{3}(\d+)$/g.exec(n))&&2===n.length&&a._defaults.hasNano&&(s=Number((n[1]+"000000").substr(0,6))),a.hour=t.getHours(),a.minute=t.getMinutes(),a.second=t.getSeconds(),a.millisec=t.getMilliseconds(),a.microsec=t.getMicroseconds(),a.nanosec=s,a._limitMinMaxDateTime(i,!0),a._onTimeChange(!0);try{$.datepicker._updateDatepicker(i)}catch(e){$.timepicker.log(e)}}return $.datepicker._base_doKeyUp(e)},$.datepicker._base_gotoToday=$.datepicker._gotoToday,$.datepicker._gotoToday=function(e){var t=this._getInst($(e)[0]);this._base_gotoToday(e);var i=this._get(t,"timepicker"),s=$.timepicker.timezoneOffsetNumber(i.timezone),e=new Date;e.setMinutes(e.getMinutes()+e.getTimezoneOffset()+s),this._setTime(t,e),this._setDate(t,e),i._onSelectHandler()},$.datepicker._disableTimepickerDatepicker=function(e){var t,i=this._getInst(e);i&&(t=this._get(i,"timepicker"),$(e).datepicker("getDate"),t&&(i.settings.showTimepicker=!1,t._defaults.showTimepicker=!1,t._updateDateTime(i)))},$.datepicker._enableTimepickerDatepicker=function(e){var t,i=this._getInst(e);i&&(t=this._get(i,"timepicker"),$(e).datepicker("getDate"),t&&(i.settings.showTimepicker=!0,t._defaults.showTimepicker=!0,t._addTimePicker(i),t._updateDateTime(i)))},$.datepicker._setTime=function(e,t){var i,s=this._get(e,"timepicker");s&&(i=s._defaults,s.hour=t?t.getHours():i.hour,s.minute=t?t.getMinutes():i.minute,s.second=t?t.getSeconds():i.second,s.millisec=t?t.getMilliseconds():i.millisec,s.microsec=t?t.getMicroseconds():i.microsec,s.nanosec=t&&t.getNanoseconds?t.getNanoseconds():i.nanosec,s._limitMinMaxDateTime(e,!0),s._onTimeChange(!0),s._updateDateTime(e))},$.datepicker._setTimeDatepicker=function(e,t,i){var s,n=this._getInst(e);!n||(e=this._get(n,"timepicker"))&&(this._setDateFromField(n),t&&("string"==typeof t?(e._parseTime(t,i),(s=new Date).setHours(e.hour,e.minute,e.second,e.millisec),s.setMicroseconds(e.microsec),s.setNanoseconds(e.nanosec)):((s=new Date(t.getTime())).setMicroseconds(t.getMicroseconds()),s.setNanoseconds(t.getNanoseconds())),"Invalid Date"===s.toString()&&(s=void 0),this._setTime(n,s)))},$.datepicker._base_setDateDatepicker=$.datepicker._setDateDatepicker,$.datepicker._setDateDatepicker=function(e,t){var i,s,n=this._getInst(e),a=t;n&&("string"==typeof t&&((a=new Date(t)).getTime()||(this._base_setDateDatepicker.apply(this,arguments),a=$(e).datepicker("getDate"))),i=this._get(n,"timepicker"),a instanceof Date?((s=new Date(a.getTime())).setMicroseconds(a.getMicroseconds()),s.setNanoseconds(a.getNanoseconds())):s=a,i&&s&&(i.support.timezone||null!==i._defaults.timezone||(i.timezone=-1*s.getTimezoneOffset()),a=$.timepicker.timezoneAdjust(a,i.timezone),s=$.timepicker.timezoneAdjust(s,i.timezone)),this._updateDatepicker(n),this._base_setDateDatepicker.apply(this,arguments),this._setTimeDatepicker(e,s,!0))},$.datepicker._base_getDateDatepicker=$.datepicker._getDateDatepicker,$.datepicker._getDateDatepicker=function(e,t){var i=this._getInst(e);if(i){var s=this._get(i,"timepicker");if(s){void 0===i.lastVal&&this._setDateFromField(i,t);var n=this._getDate(i),a=$.trim(s.$altInput&&s._defaults.altFieldTimeOnly?s.$input.val()+" "+s.$altInput.val():s.$input.val());return n&&s._parseTime(a,!i.settings.timeOnly)&&(n.setHours(s.hour,s.minute,s.second,s.millisec),n.setMicroseconds(s.microsec),n.setNanoseconds(s.nanosec),null!=s.timezone&&(s.support.timezone||null!==s._defaults.timezone||(s.timezone=-1*n.getTimezoneOffset()),n=$.timepicker.timezoneAdjust(n,s.timezone))),n}return this._base_getDateDatepicker(e,t)}},$.datepicker._base_parseDate=$.datepicker.parseDate,$.datepicker.parseDate=function(t,i,s){var n;try{n=this._base_parseDate(t,i,s)}catch(e){if(!(0<=e.indexOf(":")))throw e;n=this._base_parseDate(t,i.substring(0,i.length-(e.length-e.indexOf(":")-2)),s),$.timepicker.log("Error parsing the date string: "+e+"\ndate string = "+i+"\ndate format = "+t)}return n},$.datepicker._base_formatDate=$.datepicker._formatDate,$.datepicker._formatDate=function(e,t,i,s){var n=this._get(e,"timepicker");return n?(n._updateDateTime(e),n.$input.val()):this._base_formatDate(e)},$.datepicker._base_optionDatepicker=$.datepicker._optionDatepicker,$.datepicker._optionDatepicker=function(e,t,i){var s,n=this._getInst(e);if(!n)return null;var a=this._get(n,"timepicker");if(a){var o,r=null,l=null,n=null,c=a._defaults.evnts,u={};if("string"==typeof t){if("minDate"===t||"minDateTime"===t)r=i;else if("maxDate"===t||"maxDateTime"===t)l=i;else if("onSelect"===t)n=i;else if(c.hasOwnProperty(t)){if(void 0===i)return c[t];u[t]=i,s={}}}else if("object"==typeof t)for(o in t.minDate?r=t.minDate:t.minDateTime?r=t.minDateTime:t.maxDate?l=t.maxDate:t.maxDateTime&&(l=t.maxDateTime),c)c.hasOwnProperty(o)&&t[o]&&(u[o]=t[o]);for(o in u)u.hasOwnProperty(o)&&(c[o]=u[o],delete(s=s||$.extend({},t))[o]);if(s&&isEmptyObject(s))return;if(r?(r=0===r?new Date:new Date(r),a._defaults.minDate=r,a._defaults.minDateTime=r):l?(l=0===l?new Date:new Date(l),a._defaults.maxDate=l,a._defaults.maxDateTime=l):n&&(a._defaults.onSelect=n),r||l)return r=(n=$(e)).datetimepicker("getDate"),l=this._base_optionDatepicker.call($.datepicker,e,s||t,i),n.datetimepicker("setDate",r),l}return void 0===i?this._base_optionDatepicker.call($.datepicker,e,t):this._base_optionDatepicker.call($.datepicker,e,s||t,i)},isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},extendRemove=function(e,t){for(var i in $.extend(e,t),t)null!==t[i]&&void 0!==t[i]||(e[i]=t[i]);return e},detectSupport=function(e){function t(e,t){return-1!==e.indexOf(t)}var i=e.replace(/'.*?'/g,"").toLowerCase();return{hour:t(i,"h"),minute:t(i,"m"),second:t(i,"s"),millisec:t(i,"l"),microsec:t(i,"c"),timezone:t(i,"z"),ampm:t(i,"t")&&t(e,"h"),iso8601:t(e,"Z")}},convert24to12=function(e){return 0===(e%=12)&&(e=12),String(e)},computeEffectiveSetting=function(e,t){return(e&&e[t]?e:$.timepicker._defaults)[t]},splitDateTime=function(e,t){var i=computeEffectiveSetting(t,"separator"),s=computeEffectiveSetting(t,"timeFormat").split(i).length,n=e.split(i),t=n.length;return 1<t?{dateString:n.splice(0,t-s).join(i),timeString:n.splice(0,s).join(i)}:{dateString:e,timeString:""}},parseDateTimeInternal=function(e,t,i,s,n){i=splitDateTime(i,n),s=$.datepicker._base_parseDate(e,i.dateString,s);if(""===i.timeString)return{date:s};if(!(n=$.datepicker.parseTime(t,i.timeString,n)))throw"Wrong time format";return{date:s,timeObj:n}},selectLocalTimezone=function(e,t){e&&e.timezone_select&&(t=t||new Date,e.timezone_select.val(-t.getTimezoneOffset()))},$.timepicker=new Timepicker,$.timepicker.timezoneOffsetString=function(e,t){if(isNaN(e)||840<e||e<-720)return e;var i=e%60,t=t?":":"",i=(0<=e?"+":"-")+("0"+Math.abs((e-i)/60)).slice(-2)+t+("0"+Math.abs(i)).slice(-2);return"+00:00"==i?"Z":i},$.timepicker.timezoneOffsetNumber=function(e){var t=e.toString().replace(":","");return"Z"===t.toUpperCase()?0:/^(\-|\+)\d{4}$/.test(t)?("-"===t.substr(0,1)?-1:1)*(60*parseInt(t.substr(1,2),10)+parseInt(t.substr(3,2),10)):e},$.timepicker.timezoneAdjust=function(e,t){t=$.timepicker.timezoneOffsetNumber(t);return isNaN(t)||e.setMinutes(e.getMinutes()+-e.getTimezoneOffset()-t),e},$.timepicker.timeRange=function(e,t,i){return $.timepicker.handleRange("timepicker",e,t,i)},$.timepicker.datetimeRange=function(e,t,i){$.timepicker.handleRange("datetimepicker",e,t,i)},$.timepicker.dateRange=function(e,t,i){$.timepicker.handleRange("datepicker",e,t,i)},$.timepicker.handleRange=function(o,r,l,c){c=$.extend({},{minInterval:0,maxInterval:0,start:{},end:{}},c);var e=!1;function i(e,t){var i,s=r[o]("getDate"),n=l[o]("getDate"),a=e[o]("getDate");null!==s&&(i=new Date(s.getTime()),e=new Date(s.getTime()),i.setMilliseconds(i.getMilliseconds()+c.minInterval),e.setMilliseconds(e.getMilliseconds()+c.maxInterval),0<c.minInterval&&n<i?l[o]("setDate",i):0<c.maxInterval&&e<n?l[o]("setDate",e):n<s&&t[o]("setDate",a))}function t(e,t,i){e.val()&&(null!==(e=e[o].call(e,"getDate"))&&0<c.minInterval&&("minDate"===i&&e.setMilliseconds(e.getMilliseconds()+c.minInterval),"maxDate"===i&&e.setMilliseconds(e.getMilliseconds()-c.minInterval)),e.getTime&&t[o].call(t,"option",i,e))}return"timepicker"===o&&(e=!0,o="datetimepicker"),$.fn[o].call(r,$.extend({timeOnly:e,onClose:function(e,t){i($(this),l)},onSelect:function(e){t($(this),l,"minDate")}},c,c.start)),$.fn[o].call(l,$.extend({timeOnly:e,onClose:function(e,t){i($(this),r)},onSelect:function(e){t($(this),r,"maxDate")}},c,c.end)),i(r,l),t(r,l,"minDate"),t(l,r,"maxDate"),$([r.get(0),l.get(0)])},$.timepicker.log=function(){window.console&&window.console.log.apply(window.console,Array.prototype.slice.call(arguments))},$.timepicker._util={_extendRemove:extendRemove,_isEmptyObject:isEmptyObject,_convert24to12:convert24to12,_detectSupport:detectSupport,_selectLocalTimezone:selectLocalTimezone,_computeEffectiveSetting:computeEffectiveSetting,_splitDateTime:splitDateTime,_parseDateTimeInternal:parseDateTimeInternal},Date.prototype.getMicroseconds||(Date.prototype.microseconds=0,Date.prototype.getMicroseconds=function(){return this.microseconds},Date.prototype.setMicroseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+Math.floor(e/1e3)),this.microseconds=e%1e3,this}),$.timepicker.version="1.6.1")},v2(jQuery),zf=function($){var Timespinner,isEmptyObject,extendRemove,detectSupport,convert24to12,computeEffectiveSetting,splitDateTime,parseDateTimeInternal,selectLocalTimezone;$.ui.timespinner=$.ui.timespinner||{},$.ui.timespinner.version||($.extend($.ui,{timespinner:{version:"1.6.1"}}),Timespinner=function(){this.regional=[],this.regional[""]={currentText:"Now",closeText:"Done",amNames:["AM","A"],pmNames:["PM","P"],timeFormat:"HH:mm",timeSuffix:"",timeOnlyTitle:"Choose Time",timeText:"Time",hourText:"Hour",minuteText:"Minute",secondText:"Second",millisecText:"Millisecond",microsecText:"Microsecond",timezoneText:"Time Zone",isRTL:!1},this._defaults={showButtonPanel:!0,timeOnly:!1,timeOnlyShowDate:!1,showHour:null,showMinute:null,showSecond:null,showMillisec:null,showMicrosec:null,showTimezone:null,showTime:!0,stepHour:1,stepMinute:1,stepSecond:1,stepMillisec:1,stepMicrosec:1,hour:0,minute:0,second:0,millisec:0,microsec:0,nanosec:0,timezone:null,hourMin:0,minuteMin:0,secondMin:0,millisecMin:0,microsecMin:0,hourMax:23,minuteMax:59,secondMax:59,millisecMax:999,microsecMax:999,minDateTime:null,maxDateTime:null,maxTime:null,minTime:null,onSelect:null,hourGrid:0,minuteGrid:0,secondGrid:0,millisecGrid:0,microsecGrid:0,alwaysSetTime:!0,separator:" ",altFieldTimeOnly:!0,altTimeFormat:null,altSeparator:null,altTimeSuffix:null,altRedirectFocus:!0,pickerTimeFormat:null,pickerTimeSuffix:null,showTimespinner:!0,timezoneList:null,addSliderAccess:!1,sliderAccessArgs:null,controlType:"slider",oneLine:!1,defaultValue:null,parse:"strict",afterInject:null},$.extend(this._defaults,this.regional[""])},$.extend(Timespinner.prototype,{$input:null,$altInput:null,$timeObj:null,inst:null,hour_slider:null,minute_slider:null,second_slider:null,millisec_slider:null,microsec_slider:null,timezone_select:null,maxTime:null,minTime:null,hour:0,minute:0,second:0,millisec:0,microsec:0,timezone:null,hourMinOriginal:null,minuteMinOriginal:null,secondMinOriginal:null,millisecMinOriginal:null,microsecMinOriginal:null,hourMaxOriginal:null,minuteMaxOriginal:null,secondMaxOriginal:null,millisecMaxOriginal:null,microsecMaxOriginal:null,ampm:"",formattedDate:"",formattedTime:"",formattedDateTime:"",timezoneList:null,units:["hour","minute","second","millisec","microsec"],support:{},control:null,cursorLocation:null,setDefaults:function(e){return extendRemove(this._defaults,e||{}),this},_newInst:function($input,opts){var tp_inst=new Timespinner,inlineSettings={},fns={},overrides,i,attrName;for(attrName in this._defaults)if(this._defaults.hasOwnProperty(attrName)){var attrValue=$input.attr("time:"+attrName);if(attrValue)try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}for(i in overrides={beforeShow:function(e,t){if($.isFunction(tp_inst._defaults.evnts.beforeShow))return tp_inst._defaults.evnts.beforeShow.call($input[0],e,t,tp_inst)},onChangeMonthYear:function(e,t,i){$.isFunction(tp_inst._defaults.evnts.onChangeMonthYear)&&tp_inst._defaults.evnts.onChangeMonthYear.call($input[0],e,t,i,tp_inst)},onClose:function(e,t){!0===tp_inst.timeDefined&&""!==$input.val()&&tp_inst._updateDateTime(t),$.isFunction(tp_inst._defaults.evnts.onClose)&&tp_inst._defaults.evnts.onClose.call($input[0],e,t,tp_inst)}},overrides)overrides.hasOwnProperty(i)&&(fns[i]=opts[i]||this._defaults[i]||null);tp_inst._defaults=$.extend({},this._defaults,inlineSettings,opts,overrides,{evnts:fns,timepicker:tp_inst}),tp_inst.amNames=$.map(tp_inst._defaults.amNames,function(e){return e.toUpperCase()}),tp_inst.pmNames=$.map(tp_inst._defaults.pmNames,function(e){return e.toUpperCase()}),tp_inst.support=detectSupport(tp_inst._defaults.timeFormat+(tp_inst._defaults.pickerTimeFormat||"")+(tp_inst._defaults.altTimeFormat||"")),"string"==typeof tp_inst._defaults.controlType?("slider"===tp_inst._defaults.controlType&&void 0===$.ui.slider&&(tp_inst._defaults.controlType="select"),tp_inst.control=tp_inst._controls[tp_inst._defaults.controlType]):tp_inst.control=tp_inst._defaults.controlType;var timezoneList=[-720,-660,-600,-570,-540,-480,-420,-360,-300,-270,-240,-210,-180,-120,-60,0,60,120,180,210,240,270,300,330,345,360,390,420,480,525,540,570,600,630,660,690,720,765,780,840];null!==tp_inst._defaults.timezoneList&&(timezoneList=tp_inst._defaults.timezoneList);var tzl=timezoneList.length,tzi=0,tzv=null;if(0<tzl&&"object"!=typeof timezoneList[0])for(;tzi<tzl;tzi++)tzv=timezoneList[tzi],timezoneList[tzi]={value:tzv,label:$.timespinner.timezoneOffsetString(tzv,tp_inst.support.iso8601)};return tp_inst._defaults.timezoneList=timezoneList,tp_inst.timezone=null!==tp_inst._defaults.timezone?$.timespinner.timezoneOffsetNumber(tp_inst._defaults.timezone):-1*(new Date).getTimezoneOffset(),tp_inst.hour=tp_inst._defaults.hour<tp_inst._defaults.hourMin?tp_inst._defaults.hourMin:tp_inst._defaults.hour>tp_inst._defaults.hourMax?tp_inst._defaults.hourMax:tp_inst._defaults.hour,tp_inst.minute=tp_inst._defaults.minute<tp_inst._defaults.minuteMin?tp_inst._defaults.minuteMin:tp_inst._defaults.minute>tp_inst._defaults.minuteMax?tp_inst._defaults.minuteMax:tp_inst._defaults.minute,tp_inst.second=tp_inst._defaults.second<tp_inst._defaults.secondMin?tp_inst._defaults.secondMin:tp_inst._defaults.second>tp_inst._defaults.secondMax?tp_inst._defaults.secondMax:tp_inst._defaults.second,tp_inst.millisec=tp_inst._defaults.millisec<tp_inst._defaults.millisecMin?tp_inst._defaults.millisecMin:tp_inst._defaults.millisec>tp_inst._defaults.millisecMax?tp_inst._defaults.millisecMax:tp_inst._defaults.millisec,tp_inst.nanosec=tp_inst._defaults.nanosec<tp_inst._defaults.nanosecMin?tp_inst._defaults.nanosecMin:tp_inst._defaults.nanosec>tp_inst._defaults.nanosecMax?tp_inst._defaults.nanosecMax:tp_inst._defaults.nanosec,tp_inst.ampm="",tp_inst.$input=$input,tp_inst._defaults.altField&&(tp_inst.$altInput=$(tp_inst._defaults.altField),!0===tp_inst._defaults.altRedirectFocus&&tp_inst.$altInput.css({cursor:"pointer"}).focus(function(){$input.trigger("focus")})),0!==tp_inst._defaults.minDate&&0!==tp_inst._defaults.minDateTime||(tp_inst._defaults.minDate=new Date),0!==tp_inst._defaults.maxDate&&0!==tp_inst._defaults.maxDateTime||(tp_inst._defaults.maxDate=new Date),void 0!==tp_inst._defaults.minDate&&tp_inst._defaults.minDate instanceof Date&&(tp_inst._defaults.minDateTime=new Date(tp_inst._defaults.minDate.getTime())),void 0!==tp_inst._defaults.minDateTime&&tp_inst._defaults.minDateTime instanceof Date&&(tp_inst._defaults.minDate=new Date(tp_inst._defaults.minDateTime.getTime())),void 0!==tp_inst._defaults.maxDate&&tp_inst._defaults.maxDate instanceof Date&&(tp_inst._defaults.maxDateTime=new Date(tp_inst._defaults.maxDate.getTime())),void 0!==tp_inst._defaults.maxDateTime&&tp_inst._defaults.maxDateTime instanceof Date&&(tp_inst._defaults.maxDate=new Date(tp_inst._defaults.maxDateTime.getTime())),tp_inst.$input.bind("focus",function(){tp_inst._onFocus()}),tp_inst},_addTimePicker:function(e){this.cursorLocation=this.$input[0].selectionStart;var t=$.trim(this.$altInput&&this._defaults.altFieldTimeOnly?this.$input.val()+" "+this.$altInput.val():this.$input.val());this.timeDefined=this._parseTime(t),this._injectTimeSpinner(),this._afterInject()},_parseTime:function(t,i){if(this.inst||(this.inst=$.datepicker._getInst(this.$input[0])),i||!this._defaults.timeOnly){i=$.datepicker._get(this.inst,"dateFormat");try{var e=parseDateTimeInternal(i,this._defaults.timeFormat,t,$.datepicker._getFormatConfig(this.inst),this._defaults);if(!e.timeObj)return!1;$.extend(this,e.timeObj)}catch(e){return $.timespinner.log("Error parsing the date/time string: "+e+"\ndate/time string = "+t+"\ntimeFormat = "+this._defaults.timeFormat+"\ndateFormat = "+i),!1}return!0}t=$.datepicker.parseTime(this._defaults.timeFormat,t,this._defaults);return!!t&&($.extend(this,t),!0)},_afterInject:function(){var e=this.inst.settings;$.isFunction(e.afterInject)&&e.afterInject.call(this)},_injectTimeSpinner:function(){var e,t,i=this.inst.dpDiv,s=this.inst.settings,n=this;0===i.find("div.ui-timespinner-div").length&&s.showTimespinner&&(t=$(' <div class="ui-timespinner-div"><input type="text" value="" /></div>'),(e=i.find(".ui-datepicker-buttonpane")).length?e.before(t):i.append(t),this.$timeObj=t.find("input"),this.$timeObj.timespinner(s),this.$timeObj.timespinner("value",n.formattedTime),this.$timeObj.on("change input",function(){var e=n.inst.settings.timeFormat,e=moment(this.value,e).toObject();n.$timeObj&&(t=n.$timeObj.timespinner("value").toString(),t=(s.hasNano?t.substring(t.length-6,t.length):"")||0,t=s.hasNano?Number(t/1e6).toFixed(6).substring(2,8):"",e.nanoseconds=s.hasNano?Number(t/1e6).toFixed(6).substring(2,8):"");var t=new Date;e?(t.setHours(e.hours),t.setMinutes(e.minutes),t.setSeconds(e.seconds),t.setMilliseconds(e.milliseconds),t.setNanoseconds(e.nanoseconds),$.datepicker._setTime(n.inst,t)):(this.value=n.formattedTime,this.blur()),n.forceCaret()}),null!==this.inst&&(t=this.timeDefined,this._onTimeChange(!0),this.timeDefined=t))},forceCaret:function(){this.$timeObj&&this.$timeObj.is(":focus")&&_.debounce(function(){var e,t,i=this,s=this.inst.settings;i.$timeObj&&(e=i.$timeObj[0].selectionStart,t=i.$timeObj[0].selectionEnd,s.onSelect(),i.$timeObj[0].focus(),i.$timeObj[0].setSelectionRange(e,t))},500)},_limitMinMaxDateTime:function(e,t){},_onTimeChange:function(e){var t,i,s,n,a,o,r,l;this._defaults.showTimespinner&&(o="",r=((l=(n=this._defaults).timeFormat||"HH:mm:ss.SSS").match(/S/g)||[]).length-3,l=l.replace(/S{3,9}/,"SSS"),e?(t=moment({hours:this.hour,minutes:this.minute,seconds:this.second,milliseconds:this.millisec,nanoseconds:this.nanosec}),o=n.hasNano?Number(this.nanosec/Math.pow(10,r)).toFixed(r).substring(2,2+r):""):(s=this.$timeObj.timespinner("value").toString(),t=(n.hasNano?s.substring(0,s.length-r):s)||0,o=(n.hasNano?s.substring(s.length-r,s.length):"")||0,t=moment(t,"x"),o=n.hasNano?Number(o/Math.pow(10,r)).toFixed(r).substring(2,2+r):"",t=moment(this.$timeObj.val(),l)),t.isValid()&&(i=(a=t.toObject()).hours,e=a.minutes,s=a.seconds,n=a.milliseconds,r=Number(o)||0,(a=i!==parseInt(this.hour,10)||e!==parseInt(this.minute,10)||s!==parseInt(this.second,10)||n!==parseInt(this.millisec,10)||r!==parseInt(this.nanosec,10))&&(!1!==i&&(this.hour=i),!1!==e&&(this.minute=e),!1!==s&&(this.second=s),!1!==n&&(this.millisec=n),!1!==r&&(this.nanosec=r),this.inst||(this.inst=$.datepicker._getInst(this.$input[0]))),this.formattedTime=t.format(l)+o,this.$timeObj&&(l=this.$timeObj[0].selectionStart,o=this.$timeObj[0].selectionEnd,this.$timeObj.val(this.formattedTime),this.$timeObj[0].setSelectionRange(l,o)),a&&this._updateDateTime()))},_onSelectHandler:function(){var e=this._defaults.onSelect||this.inst.settings.onSelect,t=this.$input?this.$input[0]:null;e&&t&&e.apply(t,[this.formattedDateTime,this])},_updateDateTime:function(e){var t=0<(e=this.inst||e).currentYear?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(e.selectedYear,e.selectedMonth,e.selectedDay),i=$.datepicker._daylightSavingAdjust(t),s=$.datepicker._get(e,"dateFormat"),t=$.datepicker._getFormatConfig(e),e=null!==i&&this.timeDefined;this.formattedDate=$.datepicker.formatDate(s,null===i?new Date:i,t);t=this.formattedDate;!0===this._defaults.timeOnly&&!1===this._defaults.timeOnlyShowDate?t=this.formattedTime:(!0!==this._defaults.timeOnly&&(this._defaults.alwaysSetTime||e)||!0===this._defaults.timeOnly&&!0===this._defaults.timeOnlyShowDate)&&(t+=this._defaults.separator+this.formattedTime+this._defaults.timeSuffix),this.formattedDateTime=t,this._defaults.showTimespinner?this.$input.val(t):this.$input.val(this.formattedDate),this.$input.trigger("change"),this.forceCaret()},_onFocus:function(){if(!this.$input.val()&&this._defaults.defaultValue){this.$input.val(this._defaults.defaultValue);var e=$.datepicker._getInst(this.$input.get(0)),t=$.datepicker._get(e,"timepicker");if(t&&t._defaults.timeOnly&&e.input.val()!==e.lastVal)try{$.datepicker._updateDatepicker(e)}catch(e){$.timespinner.log(e)}}},_controls:{slider:{},select:{}}}),$.fn.extend({datetimespinner:function(t){t=t||{};var i=arguments;return"string"==typeof t?"getDate"===t||"option"===t&&2===i.length&&"string"==typeof i[1]?$.fn.datepicker.apply($(this[0]),i):this.each(function(){var e=$(this);e.datepicker.apply(e,i)}):this.each(function(){var e=$(this);e.datepicker($.timespinner._newInst(e,t)._defaults)})}}),isEmptyObject=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},extendRemove=function(e,t){for(var i in $.extend(e,t),t)null!==t[i]&&void 0!==t[i]||(e[i]=t[i]);return e},detectSupport=function(e){function t(e,t){return-1!==e.indexOf(t)}var i=e.replace(/'.*?'/g,"").toLowerCase();return{hour:t(i,"h"),minute:t(i,"m"),second:t(i,"s"),millisec:t(i,"l"),microsec:t(i,"c"),timezone:t(i,"z"),ampm:t(i,"t")&&t(e,"h"),iso8601:t(e,"Z")}},convert24to12=function(e){return 0===(e%=12)&&(e=12),String(e)},computeEffectiveSetting=function(e,t){return(e&&e[t]?e:$.timespinner._defaults)[t]},splitDateTime=function(e,t){var i=computeEffectiveSetting(t,"separator"),s=computeEffectiveSetting(t,"timeFormat").split(i).length,n=e.split(i),t=n.length;return 1<t?{dateString:n.splice(0,t-s).join(i),timeString:n.splice(0,s).join(i)}:{dateString:e,timeString:""}},parseDateTimeInternal=function(e,t,i,s,n){n=splitDateTime(i,n),s=$.datepicker._base_parseDate(e,n.dateString,s);if(""===n.timeString)return{date:s};if(!(t=moment(n.timeString,t).format(t)))throw"Wrong time format";return{date:s,timeObj:t}},selectLocalTimezone=function(e,t){e&&e.timezone_select&&(t=t||new Date,e.timezone_select.val(-t.getTimezoneOffset()))},$.timespinner=new Timespinner,$.timespinner.timezoneOffsetString=function(e,t){if(isNaN(e)||840<e||e<-720)return e;var i=e%60,t=t?":":"",i=(0<=e?"+":"-")+("0"+Math.abs((e-i)/60)).slice(-2)+t+("0"+Math.abs(i)).slice(-2);return"+00:00"==i?"Z":i},$.timespinner.timezoneOffsetNumber=function(e){var t=e.toString().replace(":","");return"Z"===t.toUpperCase()?0:/^(\-|\+)\d{4}$/.test(t)?("-"===t.substr(0,1)?-1:1)*(60*parseInt(t.substr(1,2),10)+parseInt(t.substr(3,2),10)):e},$.timespinner.timezoneAdjust=function(e,t){t=$.timespinner.timezoneOffsetNumber(t);return isNaN(t)||e.setMinutes(e.getMinutes()+-e.getTimezoneOffset()-t),e},$.timespinner.timeRange=function(e,t,i){return $.timespinner.handleRange("timespinner",e,t,i)},$.timespinner.datetimeRange=function(e,t,i){$.timespinner.handleRange("datetimespinner",e,t,i)},$.timespinner.dateRange=function(e,t,i){$.timespinner.handleRange("datepicker",e,t,i)},$.timespinner.handleRange=function(o,r,l,c){c=$.extend({},{minInterval:0,maxInterval:0,start:{},end:{}},c);var e=!1;function i(e,t){var i,s=r[o]("getDate"),n=l[o]("getDate"),a=e[o]("getDate");null!==s&&(i=new Date(s.getTime()),e=new Date(s.getTime()),i.setMilliseconds(i.getMilliseconds()+c.minInterval),e.setMilliseconds(e.getMilliseconds()+c.maxInterval),0<c.minInterval&&n<i?l[o]("setDate",i):0<c.maxInterval&&e<n?l[o]("setDate",e):n<s&&t[o]("setDate",a))}function t(e,t,i){e.val()&&(null!==(e=e[o].call(e,"getDate"))&&0<c.minInterval&&("minDate"===i&&e.setMilliseconds(e.getMilliseconds()+c.minInterval),"maxDate"===i&&e.setMilliseconds(e.getMilliseconds()-c.minInterval)),e.getTime&&t[o].call(t,"option",i,e))}return"timespinner"===o&&(e=!0,o="datetimespinner"),$.fn[o].call(r,$.extend({timeOnly:e,onClose:function(e,t){i($(this),l)},onSelect:function(e){t($(this),l,"minDate")}},c,c.start)),$.fn[o].call(l,$.extend({timeOnly:e,onClose:function(e,t){i($(this),r)},onSelect:function(e){t($(this),r,"maxDate")}},c,c.end)),i(r,l),t(r,l,"minDate"),t(l,r,"maxDate"),$([r.get(0),l.get(0)])},$.timespinner.log=function(){window.console&&window.console.log.apply(window.console,Array.prototype.slice.call(arguments))},$.timespinner._util={_extendRemove:extendRemove,_isEmptyObject:isEmptyObject,_convert24to12:convert24to12,_detectSupport:detectSupport,_selectLocalTimezone:selectLocalTimezone,_computeEffectiveSetting:computeEffectiveSetting,_splitDateTime:splitDateTime,_parseDateTimeInternal:parseDateTimeInternal},Date.prototype.getNanoseconds||(Date.prototype.nanoseconds=0,Date.prototype.getNanoseconds=function(){return this.nanoseconds},Date.prototype.setNanoseconds=function(e){return e=e||0,this.setMilliseconds(this.getMilliseconds()+Math.floor(e/1e6)),this.nanoseconds=e%1e6,this}),$.timespinner.version="1.6.1")},zf(jQuery),Form.editors.DateTimePicker=Form.editors.DateTimeBase.extend({initialize:function(e){var t,i=this;Form.editors.DateTimeBase.prototype.initialize.call(this,e=e||{},this),this.options=e,this.schema=$.extend(!0,{options:{dateFormat:"yy-mm-dd",timeInput:!0,timeFormat:"HH:mm",closeText:"Close",changeMonth:!0,changeYear:!0,showAnim:"slideDown",showOn:"focus"}},e.schema||{}),this.schema.options.isTimestamp&&(this.schema.options.max=86399999999999),this.schema.options.onSelect=function(e,t){t&&(t.inline=!0),i.updateHidden()},this.schema.options.onClose=function(e,t){t.inline=!1,i.trigger("change",i)},this.momentFormat=(this.schema.options.dateFormat?this.schema.options.dateFormat.replace("yy","YYYY").toUpperCase():"")+" "+this.schema.options.timeFormat,this.value||((t=new Date).setSeconds(0),t.setMilliseconds(0),this.value=t),this.template=e.template||this.constructor.template},initializeEvents:function(){var s=this;Form.editors.DateTimeBase.prototype.render.call(this,this.$dateTimeInput),this.$dateTimeInput.on("focus",function(){s.hasFocus||s.trigger("focus",s)}),this.$dateTimeInput.on("keyup",function(e){var t=s.$dateTimeInput.val(),i=Tools.convertUserInputToMoment(t,s.momentFormat);_.includes([8,46,37,38,39,40],e.keyCode)||(i.isValid()&&moment(t,s.momentFormat,!0).isValid()?(i=i.toDashString(),s.setValue(i),s.trigger("change",s)):s.trigger("invalid",s))}),this.$dateTimeInput.on("blur",function(){s.hasFocus&&setTimeout(function(){s.$("input:focus")[0]||s.trigger("blur",s)},0)})},blur:function(){this.hasFocus&&this.$dateTimeInput.first().blur()},convertISOStringToDate:function(e){var t,i;return _.isDate(e)?e:!!(i=/^(?:\d\d\d\d-\d\d-\d\dT)?(\d{2}:\d{2}:\d{2}.(?:\d{9}|\d{3}))(?:Z)?$/.exec(e))&&(t=new Date(e),i[1]&&"string"==typeof e&&(i=i[1].substring(12,6),t.nanoseconds=Number(i)),t)},focus:function(){this.hasFocus||this.$dateTimeInput.first().focus()},getValue:function(){var e=this.schema&&this.schema.options&&this.schema.options.ignoreTimezone,e=Tools.convertUserInputToMoment(this.$dateTimeInput.val(),this.momentFormat,e);return this.schema.options.hasNano?e.toISOStringNano():e.toISOString()},getWidth:function(){return this.schema.options.width},hide:function(){return this.$dateTimeInput.datetimespinner("hide")},render:function(){var e=this.options,t=this.schema,n=Backbone.$,i=e.id;!i&&e.item&&(i=e.item.cid);i=n(this.template({key:i}));return this.$dateTimeInput=i.find("input"),this.$dateTimeInput.addClass("ui-state-default"),t.editorClass&&this.$dateTimeInput.addClass(t.editorClass),this.$dateTimeInput.datetimespinner(t.options),n.datepicker._gotoToday=function(e){var t=this._getInst(n(e)[0]);this._base_gotoToday(e);var i=this._get(t,"timepicker"),s=Tools.convertMomentToDatePicker(Tools.convertValueToMoment());this._setTime(t,s),this._setDate(t,s),i._onSelectHandler(),this._setDateDatepicker(n(e)[0],s)},this.$hidden=n('<input type="hidden" name="'+this.key+'" />'),i.append(this.$hidden),this.setValue(this.value),this.setElement(i),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this},setValue:function(e){var t=this.schema&&this.schema.options&&this.schema.options.ignoreTimezone,i=e;(e=e&&10===e.length?Tools.convertUserInputToMoment(e+"T00:00:00.000",void 0,t):_.isString(e)&&"1970-01-01"===e.substr(0,10)?Tools.convertUserInputToMoment(e.replace("Z",""),void 0,t):""===e?Tools.convertValueToMoment():Tools.convertValueToMoment(e,void 0,t))&&e.isValid()?(this.$dateTimeInput.datetimespinner("setDate",Tools.convertMomentToDatePicker(e,t)),this.updateHidden(),this.previousDate=i):this.trigger("invalid",this)},setWidth:function(e){var t=this.$el.parents().closest(".datepicker-input"),e=e-this.$el.parents().closest(".datepicker-container").find(".datepicker-button").width();t.width(e)},show:function(){return this.$dateTimeInput.datetimespinner("show")},updateHidden:function(){var e=this.getValue();_.isDate(e)&&!_.isNaN(e.getTime())&&(e=e.toISOString()),this.$hidden.val(e)}}),Form.editors.DatePickerRolling=Form.editors.DatePicker.extend({initialize:function(e){Form.editors.Base.prototype.initialize.call(this,e=e||{});Form.editors.Date;var t=new Date;this.options=e,this.editorModel=this.options.schema.options.editorModel,this.schema=$.extend(!0,{options:{yearStart:t.getFullYear()-100,yearEnd:t.getFullYear(),closeText:"Close",changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showAnim:"slideDown",showOn:"focus"}},e.schema||{}),this.editorModel.get("rolling")||(this.value&&!_.isDate(this.value)?this.value=new Date(this.value):((t=new Date).setSeconds(0),t.setMilliseconds(0),this.value=t)),this.template=e.template||this.constructor.template},initializeEvents:function(){var e=this;Form.editors.DatePicker.prototype.initializeEvents.call(this),this.$rollingInput.on("keyup",function(){e.determineRollingChange()}),this.$rollingCheckbox.on("change",function(){e.$rollingCheckbox.is(":checked")?e.editorModel.set("rolling",!0):e.editorModel.set("rolling",!1)}),this.listenTo(this.editorModel,"change:rolling",function(){e.updateFieldType()})},determineRollingChange:function(e){var t=this.$rollingInput.val();t!==this.previousValue&&(this.previousValue=t,this.trigger("change",this))},getValue:function(){return this.editorModel.get("rolling")?this.$rollingInput.val():Form.editors.DatePicker.prototype.getValue.call(this)},render:function(){var e=this,t=(this.options,this.schema),i=Backbone.$,s=i(this.template({key:this.options.id}));return this.$dateInput=s.find("input#date_"+this.options.id+"_date"),this.$dateInput.addClass("ui-state-default"),this.$dateInput.after("<span class='ui-icon fa fa-calendar rolling'></span>").parent().css("position","relative"),this.$dateInput.datepicker(_.extend({defaultDate:this.value},t.options)),this.$rollingCheckbox=s.find("input#date_"+this.options.id+"_checkbox"),this.$rollingInput=s.find("input#date_"+this.options.id+"_rolling"),this.$hidden=i('<input type="hidden" name="'+this.key+'" />'),s.append(this.$hidden),_.defer(function(){e.setDefaultInputValues()}),this.setValue(this.value),this.setElement(s),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.$el.addClass("rolling"),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this.updateFieldType(),this},setValue:function(e){if(!this.editorModel.get("rolling"))return Form.editors.DatePicker.prototype.setValue.call(this,e);this.$rollingInput.val(e),this.updateHidden()},setDefaultInputValues:function(){var e;this.value&&this.value instanceof Date||((e=new Date).setSeconds(0),e.setMilliseconds(0),this.$dateInput.datepicker("setDate",e)),this.value&&this.value.toString().match(Form.RTTI.REGEX_ROLLING)?this.$rollingInput.val(this.value):this.$rollingInput.val("NOW"),this.determineRollingChange()},updateFieldType:function(){this.editorModel.get("rolling")?(this.$dateInput.hide(),this.$rollingInput.show(),this.$rollingCheckbox.attr("checked",!0)):(this.$dateInput.show(),this.$rollingInput.hide(),this.$rollingCheckbox.attr("checked",!1))}}),Form.editors.DateTimePickerRolling=Form.editors.DateTimePicker.extend({initialize:function(e){var i=this;Form.editors.Base.prototype.initialize.call(this,e=e||{});Form.editors.Date;var t=new Date;this.options=e,this.schema=$.extend(!0,{options:{yearStart:t.getFullYear()-100,yearEnd:t.getFullYear(),closeText:"Close",changeMonth:!0,changeYear:!0,dateFormat:"yy-mm-dd",showAnim:"slideDown",showOn:"focus",timeFormat:"HH:mm"}},e.schema||{}),this.schema.options.isTimestamp&&(this.schema.options.max=86399999999999),this.editorModel=this.options.schema.options.editorModel,this.schema.options.onSelect=function(e,t){t&&(t.inline=!0),i.updateHidden()},this.schema.options.onClose=function(e,t){t.inline=!1,i.trigger("change",i)},this.momentFormat=(this.schema.options.dateFormat?this.schema.options.dateFormat.replace("yy","YYYY").toUpperCase():"")+" "+this.schema.options.timeFormat,this.template=e.template||this.constructor.template},initializeEvents:function(){var e=this;Form.editors.DateTimePicker.prototype.initializeEvents.call(this),this.$rollingInput.on("keyup",function(){e.determineRollingChange()}),this.$rollingCheckbox.on("change",function(){e.$rollingCheckbox.is(":checked")?e.editorModel.set("rolling",!0):e.editorModel.set("rolling",!1)}),this.listenTo(this.editorModel,"change:rolling",function(){e.updateFieldType()})},determineRollingChange:function(e){var t=this.$rollingInput.val();t!==this.previousValue&&(this.previousValue=t,this.trigger("change",this))},getValue:function(){return this.editorModel.get("rolling")?this.$rollingInput.val():Tools.convertUserInputToMoment(this.$dateTimeInput.val(),this.momentFormat).toISOStringNano()},render:function(){var e=this,t=(this.options,this.schema),i=Backbone.$,s=i(this.template({key:this.options.id}));return this.$dateTimeInput=s.find("input#date_"+this.options.id+"_date"),this.$dateTimeInput.addClass("ui-state-default"),this.$dateTimeInput.datetimespinner(t.options),this.$rollingCheckbox=s.find("input#date_"+this.options.id+"_checkbox"),this.$rollingInput=s.find("input#date_"+this.options.id+"_rolling"),this.$hidden=i('<input type="hidden" name="'+this.key+'" />'),s.append(this.$hidden),_.defer(function(){e.setDefaultInputValues()}),this.setValue(this.value),this.setElement(s),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.$el.addClass("rolling"),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this.updateFieldType(),this},setDefaultInputValues:function(){this.value&&this.value.toString().match(Form.RTTI.REGEX_ROLLING)?this.$rollingInput.val(this.value):this.$rollingInput.val("NOW"),this.determineRollingChange()},setValue:function(e){if(!this.editorModel.get("rolling"))return Form.editors.DateTimePicker.prototype.setValue.call(this,e);this.$rollingInput.val(e),this.updateHidden()},updateFieldType:function(){this.editorModel.get("rolling")?(this.$dateTimeInput.hide(),this.$rollingInput.show(),this.$rollingCheckbox.attr("checked",!0)):(this.$dateTimeInput.show(),this.$rollingInput.hide(),this.$rollingCheckbox.attr("checked",!1))}}),function(u){var h,d,e=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],t="onwheel"in document||9<=document.documentMode?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],m=Array.prototype.slice;if(u.event.fixHooks)for(var i=e.length;i;)u.event.fixHooks[e[--i]]=u.event.mouseHooks;var p=u.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=t.length;e;)this.addEventListener(t[--e],s,!1);else this.onmousewheel=s;u.data(this,"mousewheel-line-height",p.getLineHeight(this)),u.data(this,"mousewheel-page-height",p.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=t.length;e;)this.removeEventListener(t[--e],s,!1);else this.onmousewheel=null;u.removeData(this,"mousewheel-line-height"),u.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var t=u(e),e=t["offsetParent"in u.fn?"offsetParent":"parent"]();return e.length||(e=u("body")),parseInt(e.css("fontSize"),10)||parseInt(t.css("fontSize"),10)||16},getPageHeight:function(e){return u(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function s(e){var t,i=e||window.event,s=m.call(arguments,1),n=0,a=0,o=0,r=0,l=0,c=0;if((e=u.event.fix(i)).type="mousewheel","detail"in i&&(o=-1*i.detail),"wheelDelta"in i&&(o=i.wheelDelta),"wheelDeltaY"in i&&(o=i.wheelDeltaY),"wheelDeltaX"in i&&(a=-1*i.wheelDeltaX),"axis"in i&&i.axis===i.HORIZONTAL_AXIS&&(a=-1*o,o=0),n=0===o?a:o,"deltaY"in i&&(n=o=-1*i.deltaY),"deltaX"in i&&(a=i.deltaX,0===o&&(n=-1*a)),0!==o||0!==a)return 1===i.deltaMode?(n*=t=u.data(this,"mousewheel-line-height"),o*=t,a*=t):2===i.deltaMode&&(n*=t=u.data(this,"mousewheel-page-height"),o*=t,a*=t),r=Math.max(Math.abs(o),Math.abs(a)),(!d||r<d)&&g(i,d=r)&&(d/=40),g(i,r)&&(n/=40,a/=40,o/=40),n=Math[1<=n?"floor":"ceil"](n/d),a=Math[1<=a?"floor":"ceil"](a/d),o=Math[1<=o?"floor":"ceil"](o/d),p.settings.normalizeOffset&&this.getBoundingClientRect&&(r=this.getBoundingClientRect(),l=e.clientX-r.left,c=e.clientY-r.top),e.deltaX=a,e.deltaY=o,e.deltaFactor=d,e.offsetX=l,e.offsetY=c,e.deltaMode=0,s.unshift(e,n,a,o),h&&clearTimeout(h),h=setTimeout(f,200),(u.event.dispatch||u.event.handle).apply(this,s)}function f(){d=null}function g(e,t){return p.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}u.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}($),k8=$,m8=navigator.userAgent,n8=/iphone/i.test(m8),o8=/chrome/i.test(m8),p8=/android/i.test(m8),k8.mask={definitions:{t:"[0-5]",h:"[0-1]",9:"[0-9]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},autoclear:!0,dataName:"rawMaskFn",placeholder:"_"},k8.fn.extend({caret:function(e,t){var i;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(t="number"==typeof t?t:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,t):this.createTextRange&&((i=this.createTextRange()).collapse(!0),i.moveEnd("character",t),i.moveStart("character",e),i.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,t=this[0].selectionEnd):document.selection&&document.selection.createRange&&(i=document.selection.createRange(),e=0-i.duplicate().moveStart("character",-1e5),t=e+i.text.length),{begin:e,end:t})},unmask:function(){return this.trigger("unmask")},mask:function(t,g){var i,v,_,y,$,b,k;if(!t&&0<this.length){var e=k8(this[0]).data(k8.mask.dataName);return e?e():void 0}return g=k8.extend({autoclear:k8.mask.autoclear,placeholder:k8.mask.placeholder,completed:null},g),i=k8.mask.definitions,v=[],_=b=t.length,y=null,k8.each(t.split(""),function(e,t){"?"==t?(b--,_=e):i[t]?(v.push(new RegExp(i[t])),null===y&&(y=v.length-1),e<_&&($=v.length-1)):v.push(null)}),this.trigger("unmask").each(function(){function o(){if(g.completed){for(var e=y;e<=$;e++)if(v[e]&&m[e]===r(e))return;g.completed.call(d)}}function r(e){return g.placeholder.charAt(e<g.placeholder.length?e:0)}function l(e){for(;++e<b&&!v[e];);return e}function c(e,t){var i,s;if(!(e<0)){for(i=e,s=l(t);i<b;i++)if(v[i]){if(!(s<b&&v[i].test(m[s])))break;m[i]=m[s],m[s]=r(s),s=l(s)}h(),d.caret(Math.max(y,e))}}function n(){a(),d.val()!=f&&d.change()}function u(e,t){for(var i=e;i<t&&i<b;i++)v[i]&&(m[i]=r(i))}function h(){d.val(m.join(""))}function a(e){for(var t,i=d.val(),s=-1,n=0,a=0;n<b;n++)if(v[n]){for(m[n]=r(n);a++<i.length;)if(t=i.charAt(a-1),v[n].test(t)){m[n]=t,s=n;break}if(a>i.length){u(n+1,b);break}}else m[n]===i.charAt(a)&&a++,n<_&&(s=n);return e?h():s+1<_?g.autoclear||m.join("")===p?(d.val()&&d.val(""),u(0,b)):h():(h(),d.val(d.val().substring(0,s+1))),_?n:y}var d=k8(this),m=k8.map(t.split(""),function(e,t){return"?"!=e?i[e]?r(t):e:void 0}),p=m.join(""),f=d.val();d.data(k8.mask.dataName,function(){return k8.map(m,function(e,t){return v[t]&&e!=r(t)?e:null}).join("")}),d.one("unmask",function(){d.off(".mask").removeData(k8.mask.dataName)}).on("focus.mask",function(){var e;d.prop("readonly")||(clearTimeout(l8),f=d.val(),e=a(),l8=setTimeout(function(){d.get(0)===document.activeElement&&(h(),e==t.replace("?","").length?d.caret(0,e):d.caret(e))},10))}).on("blur.mask",n).on("keydown.mask",function(e){var t,i,s;d.prop("readonly")||(s=e.which||e.keyCode,k=d.val(),8===s||46===s||n8&&127===s?(t=(i=d.caret()).begin,(i=i.end)-t==0&&(t=46!==s?function(e){for(;0<=--e&&!v[e];);return e}(t):i=l(t-1),i=46===s?l(i):i),u(t,i),c(t,i-1),e.preventDefault()):13===s?n.call(this,e):27===s&&(d.val(f),d.caret(0,a()),e.preventDefault()))}).on("keypress.mask",function(e){var t,i,s,n,a;d.prop("readonly")||(n=e.which||e.keyCode,a=d.caret(),e.ctrlKey||e.altKey||e.metaKey||n<32||!n||13===n||(a.end-a.begin!=0&&(u(a.begin,a.end),c(a.begin,a.end-1)),(t=l(a.begin-1))<b&&(i=String.fromCharCode(n),v[t].test(i))&&(function(e){for(var t,i,s=e,n=r(e);s<b;s++)if(v[s]){if(t=l(s),i=m[s],m[s]=n,!(t<b&&v[t].test(i)))break;n=i}}(t),m[t]=i,h(),s=l(t),p8?setTimeout(function(){k8.proxy(k8.fn.caret,d,s)()},0):d.caret(s),a.begin<=$&&o()),e.preventDefault()))}).on("input.mask paste.mask",function(){d.prop("readonly")||setTimeout(function(){var e=a(!0);d.caret(e),o()},0)}),o8&&p8&&d.off("input.mask").on("input.mask",function(){var e=d.val(),t=d.caret();if(k&&k.length&&k.length>e.length){for(a(!0);0<t.begin&&!v[t.begin-1];)t.begin--;if(0===t.begin)for(;t.begin<y&&!v[t.begin];)t.begin++;d.caret(t.begin,t.begin)}else{for(a(!0);t.begin<b&&!v[t.begin];)t.begin++;d.caret(t.begin,t.begin)}o()}),a()})}}),$.widget("ui.timespinner",$.ui.spinner,{options:{min:0,max:86399999e6,stop:function(e,t){var i=$(this).timespinner("getSel"),a=e.originalEvent?e.originalEvent.keyCode:void 0,s=$(this).val(),e=moment("1970-01-01T"+s+"Z"),e=Number(e.format("x"))/1e3-(60*e.minutes()+3600*e.hours());s.substring(12,18).length&&(e+=1e-9*Number(s.substring(12,18))),void 0!==a&&-1!==[8,35,36,37,39,46,48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105].indexOf(a)||$(this)[0].setSelectionRange(i,i);i=function(e){var t=moment.utc("1970-01-01T"+e+"Z");switch(e.length){case 5:return n(t,2);case 8:return n(t,3);case 12:return n(t,4);case 18:return function(e){for(var t=new RegExp(/(\d{2}):(\d{2}):(\d{2}).(\d{3})(\d{3})(\d{3})/),i=new RegExp(/^0+/),s=e.match(t),n="",a=0;a<s.length;a++)n=0==s[a]?"0":"",s[a]=s[a].replace(i,n);return o({hour:s[1],minute:s[2],second:s[3],millisecond:s[4],microsecond:s[5],nanosecond:s[6]},"Time must be between 0 and 99:59:59.999999999")}(e)}};function n(e,t){var i,s={},n=[{hour:e.hours()},{minute:e.minutes()},{second:e.seconds()},{millisecond:e.milliseconds()}];for(i in n)i<t&&_.merge(s,n[i]);return o(s,"Time must be between 0 and 23:59:59.999")}function o(e,t){var i,s,n="";for(a in e){if(isNaN(e[a]))return t;n+=(s=e[i=a])+" "+i+(1!==s?"s ":" ")}return n}void 0===$(this).closest(".bbf-field").attr("title")&&$(this).attr("title",i(s))}},_adjustValue:function(e){var t=this.options;return null!==t.max&&0<e.compareTo(new QuickBase.BigInteger(t.max.toString()))?new QuickBase.BigInteger(t.max.toString()):null!==t.min&&e.compareTo(new QuickBase.BigInteger(t.min.toString()))<0?new QuickBase.BigInteger(t.min.toString()):e},_create:function(){var s=this;this._super(),this.element.on("click focus",function(e){s._setSelection(this.selectionStart),$(this).parent().toggleClass("focused",!0)}),this.element.on("blur",function(e){$(this).parent().toggleClass("focused",!1)}),this.element.on("keydown",function(e){var t,i=$(this).val();-1===[33,34,38,40].indexOf(e.keyCode)&&(s._setSelection(this.selectionStart),-1===[9].indexOf(e.keyCode)&&(-1===[35,36,37,39].indexOf(e.keyCode)?(-1!==[48,49,50,51,52,53,54,55,56,57,96,97,98,99,100,101,102,103,104,105].indexOf(e.keyCode)?(/^[0-9]$/.test(i[s.lastSelection])||s.lastSelection++,t=-1!==[48,49,50,51,52,53,54,55,56,57].indexOf(e.keyCode)?String(e.keyCode-48):String(e.keyCode-96),s.lastSelection<i.length&&(i=s._replaceAt(i,s.lastSelection,t),$(this).val(i)),this.setSelectionRange(s.lastSelection+1,s.lastSelection+1),s._setSelection(s.lastSelection+1)):8===e.keyCode?(t=this.selectionStart===this.selectionEnd?Math.max(0,this.selectionStart-1):this.selectionStart,s._setSelection(t),$(this).val(s._zeroSelection(i,t,this.selectionEnd)),this.setSelectionRange(s.lastSelection,s.lastSelection)):46===e.keyCode&&(/^[0-9]$/.test(i[s.lastSelection])||s.lastSelection++,s.lastSelection<i.length&&(i=s._replaceAt(i,s.lastSelection,"0"),$(this).val(i)),this.setSelectionRange(s.lastSelection+1,s.lastSelection+1),s._setSelection(s.lastSelection+1)),e.preventDefault()):setTimeout(function(){s._updateSelection()},100)))}),this.element.on("keyup",function(e){$(this).trigger("change")})},_replaceAt:function(e,t,i){return e.substr(0,t)+i+e.substr(t+i.length)},_zeroSelection:function(e,t,i){for(var s=e.substr(t,i),n=0;n<s.length;n++)/^[0-9]$/.test(s[n])&&(s=this._replaceAt(s,n,"0"));return this._replaceAt(e,t,s)},getSel:function(){return this.lastSelection},_updateSelection:function(){this._setSelection(this.element[0].selectionStart)},_setSelection:function(e){var t,i,s=1;switch(this.lastSelection=e,":"===(i=(t=this.options.timeFormat||"HH:mm:ss.SSS").substr(e,1))||"."===i?i=t.substr(e-1,1):e>=t.length&&(i=t.substr(-1,1)),"S"===(i=!_.includes(["H","m","s","S"],i)?null:i)&&(i="S1",e!==t.length&&(15<=e?i="S3":12<=e&&(i="S2"))),i){case"H":s=36e11;break;case"m":s=6e10;break;case"s":s=1e9;break;case"S1":s=1e6;break;case"S2":s=1e3}s!==this.options.step&&this._setOption("step",s)},_format:function(e){var e=e.toString(),e={class:this.options.hasNano?"1216":"1219",i:this.options.hasNano?Number(e):Math.floor(Number(e)/1e6)};return Tools.convertKDBTemporalToMoment(e).formatNano(this.options.timeFormat||"HH:mm:ss.SSS",{trim:!1,trimNano:!this.options.hasNano})},_parse:function(e){var t,i=this.options.timeFormat||"HH:mm:ss.SSS";return"string"==typeof e&&0<e.length?(t=e.substr(e.indexOf("T")+1,12)||moment(0).format(i),"Z"===(i=(this.options.hasNano?e.substr(e.indexOf("T")+13,6):"")||"000000")&&(i="000000"),-1===e.indexOf(".")&&(i=""),i=Tools.convertValueToDuration(t+i).valueOfNano().toString(),new QuickBase.BigInteger(i)):e||new QuickBase.BigInteger("0")},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i.add(new QuickBase.BigInteger((e*this._increment(this.counter)).toString()))),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++,$(this.element).trigger("change"))},value:function(e){var t=this.element[0].selectionStart;if(!arguments.length)return this._parse(this.element.val());this._value.call(this,e),t&&t!==this.element[0].value.length&&(this.element[0].selectionStart=t,this.element[0].selectionEnd=t)}}),Form.editors.TimePicker=Form.editors.DateTimeBase.extend({initialize:function(e){var t=this;Form.editors.DateTimeBase.prototype.initialize.call(this,e=e||{},this),this.options=e,this.schema=$.extend(!0,{options:{value:0,step:1e3,page:60,spin:function(){t.determineChange()}}},e.schema||{}),this.schema.options.isTimespan&&(this.schema.options.max=359999999999999),this.schema.options.onSelect=function(){t.updateHidden(),t.trigger("change",t)},this.value||(this.value="T00:00:00.000000000Z"),this.template=e.template||this.constructor.template},initializeEvents:function(){var t=this;Form.editors.DateTimeBase.prototype.render.call(this,this.$timeInput),this.$timeInput.on("focus",function(){t.hasFocus||t.trigger("focus",t)}),this.$timeInput.on("blur",function(){t.hasFocus&&setTimeout(function(){t.$("input:focus")[0]||t.trigger("blur",t)},0)}),this.$timeInput.on("change input",function(e){t.determineChange(e)})},blur:function(){this.hasFocus&&this.$timeInput.first().blur()},determineChange:function(e){var t=this.$timeInput.val();t!==this.previousValue&&(this.previousValue=t,this.trigger("change",this))},focus:function(){this.hasFocus||this.$timeInput.first().focus()},getWidth:function(){return this.schema.options.width},getValue:function(){var e="",t=this.schema.options.isDuration?Tools.convertValueToDuration(this.$timeInput.val()):(t=moment().toISOString().substr(0,10),Tools.convertValueToMoment(t+" "+this.$timeInput.val()));return(e=Number(this.$timeInput.val().substr(12,18)))&&!_.isNaN(e)?(t.nanoseconds(e),"1970-01-01T"+t.formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1,trimNano:!this.schema.options.hasNano})+"Z"):"1970-01-01T"+t.formatNano("HH:mm:ss.SSS",{trim:!1,trimNano:!this.schema.options.hasNano})+"Z"},render:function(){var e=$(this.template({key:this.options.id}));return this.$timeInput=e.find("input"),this.$timeInput.timespinner(this.schema.options),this.schema.editorClass&&this.$timeInput.addClass(this.schema.editorClass),this.$hidden=$('<input type="hidden" name="'+this.key+'" />'),e.append(this.$hidden),this.setValue(this.value),this.setElement(e),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this},setValue:function(e){var t=e&&"1970-01-01"===e.substr(0,10)?e.substr(11).replace("Z",""):Tools.convertValueToMoment(e).formatNano("HH:mm:ss.SSSSSSSSS",{trim:!1,trimNano:!this.schema.options.hasNano}),i="T"+(this.schema.options.isDuration?Tools.convertValueToDuration(t):Tools.convertValueToMoment(e)).formatNano(this.schema.options.hasNano?"HH:mm:ss.SSSSSSSSS":"HH:mm:ss.SSS",{trim:!1,trimNano:!this.schema.options.hasNano})+"Z";this.$timeInput.timespinner("value",i),this.updateHidden()},setWidth:function(e){this.$el.parents().closest(".datepicker-input").width(e)},updateHidden:function(){var e=this.getValue();this.$hidden.val(e)}}),Form.editors.TimePickerRolling=Form.editors.TimePicker.extend({initialize:function(e){var t=this;Form.editors.Base.prototype.initialize.call(this,e=e||{}),this.options=e,this.schema=$.extend(!0,{options:{value:0,step:1e3,page:60,spin:function(){t.determineChange()}}},e.schema||{}),this.schema.options.isTimespan&&(this.schema.options.max=359999999999999),this.editorModel=this.options.schema.options.editorModel,this.schema.options.onSelect=function(){t.updateHidden(),t.trigger("change",t)},this.value||(this.value="T00:00:00.000000000Z"),this.template=e.template||this.constructor.template},initializeEvents:function(){var t=this;this.$timeInput.on("focus",function(){t.hasFocus||t.trigger("focus",t)}),this.$timeInput.on("blur",function(){t.hasFocus&&setTimeout(function(){t.$("input:focus")[0]||t.trigger("blur",t)},0)}),this.$timeInput.on("change input",function(e){t.determineChange(e)}),this.$rollingInput.on("keyup",function(){t.determineRollingChange()}),this.$rollingCheckbox.on("change",function(){t.$rollingCheckbox.is(":checked")?t.editorModel.set("rolling",!0):t.editorModel.set("rolling",!1)}),this.listenTo(this.editorModel,"change:rolling",function(){t.updateFieldType()})},determineRollingChange:function(e){var t=this.$rollingInput.val();t!==this.previousValue&&(this.previousValue=t,this.trigger("change",this))},getValue:function(){return this.editorModel.get("rolling")?this.$rollingInput.val():Form.editors.TimePicker.prototype.getValue.call(this)},render:function(){var e=this,t=$(this.template({key:this.options.id}));return this.$timeInput=t.find("input#time_"+this.options.id+"_time"),this.spinner=this.$timeInput.timespinner(this.schema.options),this.$rollingCheckbox=t.find("input#time_"+this.options.id+"_checkbox"),this.$rollingInput=t.find("input#time_"+this.options.id+"_rolling"),this.$hidden=$('<input type="hidden" name="'+this.key+'" />'),t.append(this.$hidden),this.setValue(this.value),_.defer(function(){e.setDefaultInputValues()}),this.setElement(t),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.$el.addClass("rolling"),this.hasFocus&&this.trigger("blur",this),this.initializeEvents(),this.updateFieldType(),this},setDefaultInputValues:function(){this.value&&this.value.toString().match(Form.RTTI.REGEX_ROLLING)?this.$rollingInput.val(this.value):this.$rollingInput.val("NOW"),this.determineRollingChange()},setValue:function(e){if(!this.editorModel.get("rolling"))return Form.editors.TimePicker.prototype.setValue.call(this,e);this.$rollingInput.val(e),this.updateHidden()},updateFieldType:function(){this.editorModel.get("rolling")?(this.$timeInput.parent().hide(),this.$rollingInput.show(),this.$rollingCheckbox.attr("checked",!0)):(this.$timeInput.parent().css("display","inline-block"),this.$rollingInput.hide(),this.$rollingCheckbox.attr("checked",!1))}}),Form.editors.Text=Form.Editor.extend({tagName:"input",defaultValue:"",previousValue:"",events:{keyup:"determineChange",keypress:function(e){var t=this;setTimeout(function(){t.determineChange()},0)},select:function(e){this.trigger("select",this)},focus:function(e){this.trigger("focus",this)},blur:function(e){this.trigger("blur",this)}},initialize:function(e){Form.editors.Base.prototype.initialize.call(this,e);e=this.schema;this.inputType="text",e&&e.editorAttrs&&e.editorAttrs.type&&(this.inputType=e.editorAttrs.type),e&&e.dataType&&(this.inputType=e.dataType),this.previousValue=this.value,this.$el.attr("type",this.inputType),this.$el.on("change",_.debounce($.proxy(this.determineChange,this),200))},render:function(){return this.setValue(this.value),this},determineChange:function(e){var t=this.$el.val();t!==this.previousValue&&(this.previousValue=t,this.trigger("change",this))},getValue:function(){return DOMPurify.sanitize(this.$el.val(),{ADD_ATTR:["target"]})},setValue:function(e){var t,i;"text"===this.inputType&&(t=this.$el[0].selectionEnd,i=this.$el[0].selectionStart),this.value=e,this.$el.val(e),"text"===this.inputType&&i!==t&&this.$el[0].setSelectionRange(i,t)},focus:function(){this.hasFocus||this.$el.focus()},blur:function(){this.hasFocus&&this.$el.blur()},select:function(){this.$el.select()}}),Form.editors.Hidden=Form.editors.Text.extend({defaultValue:"",noField:!0,initialize:function(e){Form.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","hidden")},focus:function(){},blur:function(){}}),Form.editors.Month=Form.editors.Base.extend({events:{"change select":function(){this.updateHidden(),this.isChanging||this.trigger("change",this)},"focus select":function(){this.hasFocus||this.trigger("focus",this)},"blur select":function(){var e;this.hasFocus&&(e=this,setTimeout(function(){e.$("select:focus")[0]||e.trigger("blur",e)},0))}},initialize:function(e){Form.editors.Base.prototype.initialize.call(this,e=e||{});var t=Form.editors.Month,i=new Date;this.options=_.extend({monthNames:t.monthNames,showMonthNames:t.showMonthNames},e),this.schema=_.extend({yearStart:i.getFullYear()-100,yearEnd:i.getFullYear()+100},e.schema||{}),this.value&&!_.isDate(this.value)&&(this.value=this.convertStringToDate(this.value)),this.value||((i=new Date).setSeconds(0),i.setMilliseconds(0),this.value=i),this.template=e.template||this.constructor.template},render:function(){var t=this.options,e=this.schema,i=Backbone.$,s=_.map(_.range(0,12),function(e){return{name:t.showMonthNames?t.monthNames[e]:e+1,value:e}}),e=e.yearStart<e.yearEnd?_.range(e.yearStart,e.yearEnd+1):_.range(e.yearStart,e.yearEnd-1,-1),e=_.map(e,function(e){return{name:e,value:e}}),e=i(i.trim(this.template({months:s,years:e})));return this.$month=e.find('[data-type="month"]'),this.$year=e.find('[data-type="year"]'),this.$hidden=i('<input type="hidden" name="'+this.key+'" />'),e.append(this.$hidden),this.setValue(this.value),this.setElement(e),this.$el.attr("id",this.id),this.$el.attr("name",this.getName()),this.$el.addClass("bff-month-editor"),this.hasFocus&&this.trigger("blur",this),this.$month.dashSingleSelect({initCallback:function(e){e.$container.addClass("bff-month-input bff-month"),self.form&&self.form.options&&"environment"===self.form.options.theme&&e.on("open",function(){i("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")})},showSearch:self.showSearch,theme:"dashboards",tooltip:self.tooltip,width:self.width}),this.$year.dashSingleSelect({initCallback:function(e){e.$container.addClass("bff-month-input bff-year"),self.form&&self.form.options&&"environment"===self.form.options.theme&&e.on("open",function(){i("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")})},showSearch:self.showSearch,theme:"dashboards",tooltip:self.tooltip,width:self.width}),this},convertStringToDate:function(e){var t=/(\d{4})-(\d{1,2})/.exec(e);return t&&3===t.length?(e=Number(t[1]),t=Math.min(Math.max(0,Number(t[2])-1),11),new Date(e,t)):new Date},getValue:function(){var e=this.$year.val(),t=Number(this.$month.val())+1;return e&&t?e+"-"+("00"+t).slice(-2):null},setValue:function(e){_.isDate(e)||(e=this.convertStringToDate(e)),this.value=e,this.$month.val(e.getMonth()),this.$year.val(e.getFullYear()),this.isChanging=!0,this.$month.trigger("change"),this.$year.trigger("change"),this.isChanging=!1,this.updateHidden()},setWidth:function(e){var t=this.$el.find(".bff-month-input"),i=e/2-2;this.$el.parent().width(e),_.each(t,function(e){$(e).width(i)})},focus:function(){this.hasFocus||this.$("select").first().focus()},blur:function(){this.hasFocus&&this.$("select:focus").blur()},updateHidden:function(){var e=this.getValue();_.isDate(e)&&!_.isNaN(e.getTime())&&(e=e.toISOString()),this.$hidden.val(e)}},{showMonthNames:!0,monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"]}),Form.editors.Dict=Form.editors.Base.extend({initialize:function(e){var t=Form.editors;t.Base.prototype.initialize.call(this,e=e||{}),this.schema.listItemTemplate="listKeyValueItem";var i=this.schema;if(!i)throw new Error("Missing required option 'schema'");this.openViewStateDialog=e.form.options.openViewStateDialog,this.template=e.template||this.constructor.template,this.model?this.value=this.setValueFromModel(e.key):void 0!==e.value&&(this.value=e.value),this.Editor=(i=i.itemType)?t.Dict[i]||t[i]:t.Text;var a=this,o=new RegExp(/^((_default|value)_.+)$/);$(document).on("dnd_stop.vakata",function(e,t){var i,s,n=$(t.event.target);n.closest(".jstree").length||n.closest(".viewstate-control").length&&(i=n.closest(".viewstate-control"),s=o.exec(i.data("key")),n=t.data.origin.get_path(t.data.nodes[0]),t=_.takeRight(n,n.length-1).join("/"),n=_.find(a.form.viewStates,{path:t}),(t=a.form.fields[s[2]])&&t.editor&&n&&"dict"!==n.model.get("_type")&&((s=_.find(t.editor.items,{key:s[1]}))&&($(i).hasClass("dict-default")?s.editorDefault:s.editorValue).setModel(n.model)))}),this.items=[],this.elementHeight},render:function(){var e=this,t=Backbone.$,t=t(t.trim(this.template()));this.$list=t.is("[data-items]")?t:t.find("[data-items]"),this.populateListFromValue(),this.setElement(t),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this);function i(){event.preventDefault(),e.setAddButton(this),e.setLabelAdd(),e.addItem(null,"",!0)}return t.find('[data-action="add"]').click(i),t.find('[data-action="add"]').keypress(function(e){13==e.which&&i()}),this},addItem:function(e,t,i){var s=this,n={};n[t]=e,t=void 0===t?"":t,e=void 0===e?"":e;var a=this.createDictItem(n),n=function(){s.items.push(a),s.$list.append(a.$el),a.on("changeKey",function(){var e=a.editorKey.getValue();e!==a.previousKey&&(s.value&&s.value.hasOwnProperty(a.previousKey)?(_.extend(s.value,a.getValue()),delete s.value[a.previousKey]):_.extend(s.value,a.getValue()),a.previousKey=e),s.trigger("change",s)}),a.on("changeValue",function(){s.value||(s.value={}),_.extend(s.value,a.getValue()),s.trigger("change",s)},s),a.on("remove",function(){s.removeItem(Item),s.trigger("change",s)}),a.editorKey.on("focus",function(){this.hasFocus||this.trigger("focus",this)},s),a.editorKey.on("blur",function(){var e;this.hasFocus&&(e=this,setTimeout(function(){_.find(e.items,function(e){return e.hasFocus})||e.trigger("blur",e)},0))},s),(i||e)&&(a.addEventTriggered=!0)};return this.Editor.isAsync?a.editorValue.on("readyToAdd",n,this):(n(),i&&a.editorKey.focus()),a},createDictItem:function(e){return new Form.editors.Dict.Item({list:this,form:this.form,schema:this.schema,value:e,Editor:this.Editor,key:this.key+"_"+this.items.length,index:this.items.length,openViewStateDialog:this.openViewStateDialog}).render()},onModelValueChange:function(e,t){try{this.setValue(_.clone(this.model.get(this.key)),e.forceRender),e.forceRender=!1}catch(e){console.log("BBForm on change error",e)}},populateListFromValue:function(){var i=this,e=this.value||[];_.each(_.clone(this.items),function(e){i.removeItem(e)}),this.items=[],this.$list.empty(),_.isEmpty(e)?this.Editor.isAsync||this.addItem():_.defer(function(){_.each(e,function(e,t){i.addItem(e,t)})})},removeItem:function(e){var t=this.schema.confirmDelete;t&&!confirm(t)||(t=_.indexOf(this.items,e),this.items[t].remove(),this.items.splice(t,1),e.addEventTriggered&&(this.trigger("remove",this,e.editor),this.trigger("change",this)),this.items.length||this.Editor.isAsync||this.addItem())},getValue:function(){var t={};return _.each(this.items,function(e){$.extend(t,e.getValue())}),t},setAddButton:function(e){$(e).closest(".bbf-field").css("margin-bottom","0px"),$(e).css("left",0)},setLabelAdd:function(){var e=$(this.el).closest("div.bbf-editor"),t=$(this.el).closest("li.bbf-field").find("label");this.elementHeight=this.elementHeight||$(this.el).closest("li.bbf-field").find("div.bbf-dict").first().outerHeight(!0),"inline"===e.css("display")&&(e=$(this.el).closest("li.bbf-field").find(".bbf-dict").length,t.height((e+1)*this.elementHeight))},setValueFromModel:function(e){var i={};return _.each(this.model.get(e),function(e,t){e&&(!(e instanceof Backbone.Model)&&_.isObject(e)&&e.name?i[t]=e.name:i[t]=e)}),i},setValue:function(e,t){this.value=e,t&&this.populateListFromValue()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editorKey.focus()},blur:function(){var e;!this.hasFocus||(e=_.find(this.items,function(e){return e.editorKey.hasFocus}))&&e.editorKey.blur()},remove:function(){_.invokeMap(this.items,"remove"),Form.editors.Base.prototype.remove.call(this)},validate:function(){if(!this.validators)return null;var e=_.map(this.items,function(e){return e.validate()});return!_.compact(e).length?null:{type:"list",message:"Some of the items in the list failed validation",errors:e}}}),Form.editors.Dict.Item=Form.editors.Base.extend({events:{'click [data-action="remove"]':function(e){e.preventDefault(),1<this.list.items.length&&this.setLabelRemove(),this.list.removeItem(this)},'keypress [data-action="remove"]':function(e){13==e.which&&(e.preventDefault(),1<this.list.items.length&&this.setLabelRemove(),this.list.removeItem(this))}},initialize:function(e){this.list=e.list,this.schema=e.schema||this.list.schema,this.value=e.value,this.Editor=e.Editor||Form.editors.Text,this.key=e.key,this.index=e.index,this.template=e.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=e.errorClassName||this.constructor.errorClassName,this.form=e.form,this.openViewStateDialog=e.form.openViewStateDialog,this.viewStates=e.form.viewStates,this.elementHeight},render:function(){var e,t,i=Backbone.$,s=this.schema;s.options=_.map(_.filter(this.viewStates,function(e){return"dict"!==e.model.get("_type")}),function(e){return e.path}),e=this.value&&Object.keys(this.value)?Object.keys(this.value)[0]:"",t=(t=this.value&&Object.keys(this.value)?this.value[Object.keys(this.value)[0]]:"")||s.options[0],!_.isObject(t)||!t.type||t instanceof Backbone.Model||(t=t.value),this.editorKey=new Form.editors.Text({key:this.key+"_key",schema:this.schema,value:e,list:this.list,item:this,model:new Backbone.Model}).render(),this.editorValue=new Form.editors.TextViewState({key:this.key+"_value",schema:s,value:t,list:this.list,item:this,model:new Backbone.Model,openViewStateDialog:this.form.options.openViewStateDialog}).render(),this.previousKey=e,this.editorKey.on("change",function(){this.trigger("changeKey",this)},this),this.editorValue.on("change",function(){this.trigger("changeValue",this)},this),this.editorKey.el.className="dict-key",this.editorValue.el.className="dict-value viewstate-control",this.editorValue.el.setAttribute("data-key",this.key);i=i(i.trim(this.template()));return i.find(".bbf-tmp-key").replaceWith(this.editorKey.el),i.find(".bbf-tmp-value").replaceWith(this.editorValue.el),this.setElement(i),"undefined"!=e?this.editorKey.setValue(e):this.editorKey.setValue(""),this.setEditorValue(this.editorValue,this.valueViewState,t),this},getValue:function(){var e={};return e[this.editorKey.getValue()]=this.editorValue.getValue(),e},setEditorValue:function(e,t,i){t&&(this.stopListening(t),t=null),(t=_.find(this.viewStates,function(e){return e.path===i}))&&t.model?t.model instanceof Backbone.Model?e.setModel(t.model):(e.setValue({type:this.viewState.model.get("_type"),IsKdbParam:!0,isViewState:!0,name:i,orderIndex:this.orderIndex,value:this.viewState.model.get("value")}),e.$el.val(i)):e.setValue(i)},setLabelRemove:function(){var e=$(this.el).closest("div.bbf-editor"),t=$(this.el).closest("li.bbf-field").find("label");this.elementHeight=this.elementHeight||$(this.el).closest("li.bbf-field").find("div.bbf-dict").first().outerHeight(!0),"inline"===e.css("display")&&(e=$(this.el).closest("li.bbf-field").find(".bbf-dict").length,t.height((e-1)*this.elementHeight))},setValue:function(e,t){this.editorValue.setValue(e),_.isUndefined(t)||this.editorKey.setValue(t)},focus:function(){this.editorKey.focus()},blur:function(){this.editorKey.blur()},remove:function(){this.editorKey.remove(),this.editorValue.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var t=this.getValue(),i=this.list.form?this.list.form.getValue():{},e=this.schema.validators,s=this.getValidator;if(!e)return null;var n=null;return _.every(e,function(e){return!(n=s(e)(t,i))}),n?this.setError(n):this.clearError(),n||null},setError:function(e){this.$el.addClass(this.errorClassName),this.$el.attr("title",e.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{errorClassName:"error"}),Form.editors.ThreeColumnDict=Form.editors.Dict.extend({initialize:function(e){Form.editors.Dict.prototype.initialize.call(this,e),this.listenTo(this.model,"change:_default",this.onModelValueChange),this.listenTo(this.model,"change:value",this.onModelValueChange)},createDictItem:function(e){return new Form.editors.ThreeColumnDict.Item({list:this,form:this.form,schema:this.schema,value:e,Editor:this.Editor,key:this.key+"_"+this.items.length,index:this.items.length,openViewStateDialog:this.openViewStateDialog}).render()},setValueFromModel:function(e){if(this.model){var i=this.model.get("_default"),t=this.model.get("value"),s={};return _.each(t,function(e,t){s[t]={_default:i[t],value:e}}),s}},setValue:function(e,t){this.value=this.setValueFromModel(),t&&this.populateListFromValue()}}),Form.editors.ThreeColumnDict.Item=Form.editors.Dict.Item.extend({events:{'click [data-action="remove"]':function(e){e.preventDefault(),1<this.list.items.length&&this.setLabelRemove(),this.list.removeItem(this)}},render:function(){var e,t,i,s=Backbone.$,n=this.schema;n.options=_.map(_.filter(this.viewStates,function(e){return"dict"!==e.model.get("_type")}),function(e){return e.path}),e=this.value&&Object.keys(this.value)?Object.keys(this.value)[0]:"",i=(i=this.value&&Object.keys(this.value)?this.value[Object.keys(this.value)[0]]:"")?(t=i._default,i.value):(t=n.options[0],n.options[0]),!_.isObject(i)||!i.type||i instanceof Backbone.Model||(i=i.value),!_.isObject(t)||!t.type||t instanceof Backbone.Model||(t=t.value),this.editorKey=new Form.editors.Text({key:this.key+"_key",schema:this.schema,value:e,list:this.list,item:this,model:new Backbone.Model}).render(),this.editorValue=new Form.editors.TextViewState({key:this.key+"_value",schema:n,value:i,list:this.list,item:this,model:new Backbone.Model,openViewStateDialog:this.form.options.openViewStateDialog}).render(),this.editorDefault=new Form.editors.TextViewState({key:this.key+"_default",schema:n,value:t,list:this.list,item:this,model:new Backbone.Model,openViewStateDialog:this.form.options.openViewStateDialog}).render(),this.previousKey=e,this.editorKey.on("change",function(){this.trigger("changeKey",this)},this),this.editorValue.on("change",function(){this.trigger("changeValue",this)},this),this.editorDefault.on("change",function(){this.trigger("changeValue",this)},this),this.editorKey.el.className="dict-key three-items",this.editorValue.el.className="dict-value viewstate-control three-items",this.editorValue.el.setAttribute("data-key",this.key),this.editorDefault.el.className="dict-default viewstate-control three-items",this.editorDefault.el.setAttribute("data-key",this.key);s=s(s.trim(this.template()));return s.find(".bbf-tmp-key").replaceWith(this.editorKey.el),s.find(".bbf-tmp-value").replaceWith(this.editorValue.el),s.find(".bbf-tmp-default").replaceWith(this.editorDefault.el),this.setElement(s),"undefined"!=e?this.editorKey.setValue(e):this.editorKey.setValue(""),this.setEditorValue(this.editorValue,this.valueViewState,i),this.setEditorValue(this.editorDefault,this.defaultViewState,t),this},getValue:function(){var e={};return e[this.editorKey.getValue()]={_default:this.editorDefault.getValue(),value:this.editorValue.getValue()},e},setValue:function(e,t){this.editorDefault.setValue(e._default),this.editorValue.setValue(e.value),_.isUndefined(t)||this.editorKey.setValue(t)}});var FormsModal=Backbone.View.extend({tagName:"form",$dialog:null,callback:null,initialize:function(e){var i=this;this.options=_.extend({dialogClass:"quick-base login-dialog",title:t("List Editor"),resizable:!1,minHeight:260,width:300,modal:!0,autoOpen:!1,draggable:!1,buttons:[{text:t("OK"),click:function(){i.trigger("ok"),i.callback&&i.callback(),this._preventClose||i.$dialog.close()},icons:{primary:"fa fa-check"}},{text:t("Cancel"),click:function(){i.trigger("cancel"),this._preventClose||i.$dialog.close()},icons:{primary:"fa fa-close"}}],open:function(){$('<i class="fa fa-list" />').insertBefore(i.$el.parent().find(".ui-dialog-title")),$(".quick-base.main-app").addClass("disturbed"),_.defer(function(){i.trigger("shown")})},close:function(){i.trigger("hidden"),i.remove()}},e)},render:function(){return this.options.template&&this.$el.render(this.options.template()),this.$dialog=this.$el.dialog(this.options),this.isRendered=!0,this},open:function(e){this.callback=e,this.isRendered||this.render(),this.$dialog.open()},close:function(){var i=this,s=this.$el;this._preventClose?this._preventClose=!1:(s.one("hidden.bs.modal",function e(t){return t.target!==t.currentTarget?s.one("hidden",e):(i.remove(),i.options.content&&i.options.content.trigger&&i.options.content.trigger("hidden",i),void i.trigger("hidden"))}),s.modal("hide"),FormsModal.count--)},preventClose:function(){this._preventClose=!0}},{count:0}),po;Form.editors.List=Form.editors.Base.extend({events:{'click [data-action="add"]':function(e){e.preventDefault(),this.addItem(void 0,!0)}},initialize:function(e){var t=Form.editors;t.Base.prototype.initialize.call(this,e=e||{});var i=this.schema;if(!i)throw new Error("Missing required option 'schema'");this.schema=_.extend({addLabel:"Add"},i),this.template=e.template||i.listTemplate||this.constructor.template,this.Editor=(e=i.itemType)?t.List[e]||(_.isString(e)?t[e]:e):t.Text,this.ListItem=i.itemClass||t.List.Item,this.items=[]},render:function(){var t=this,e=this.value||[],i=Backbone.$,i=i(i.trim(this.template({addLabel:this.schema.addLabel})));return this.$list=i.is("[data-items]")?i:i.find("[data-items]"),(e=e instanceof Backbone.Collection?e.toJSON():e).length?_.each(e,function(e){t.addItem(e)}):this.Editor.isAsync&&this.addItem(),this._checkMaxCardinalityReached(i),this.setElement(i),this.$el.attr("id",this.id),this.$el.attr("name",this.key),this.hasFocus&&this.trigger("blur",this),this},_checkMaxCardinalityReached:function(e){this.schema.maxListLength&&this.items.length>=this.schema.maxListLength&&e.find('button[data-action="add"]').hide()},addItem:function(e,t){function i(){s.items.push(a),s.$list.append(a.el),s._checkMaxCardinalityReached(s.$el),a.editor.on("all",function(e){var t;"change"!==e&&((t=_.toArray(arguments))[0]="item:"+e,t.splice(1,0,s),n.List.prototype.trigger.apply(this,t))},s),a.editor.on("change",function(){a.addEventTriggered||(a.addEventTriggered=!0,this.trigger("add",this,a.editor)),this.trigger("item:change",this,a.editor),this.trigger("change",this)},s),a.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},s),a.editor.on("blur",function(){var e;this.hasFocus&&(e=this,setTimeout(function(){_.find(e.items,function(e){return e.editor.hasFocus})||e.trigger("blur",e)},0))},s),(t||e)&&(a.addEventTriggered=!0),t&&(s.trigger("add",s,a.editor),s.trigger("change",s))}var s=this,n=Form.editors,a=new this.ListItem({list:this,form:this.form,schema:this.schema,value:e,Editor:this.Editor,key:this.key}).render();return this.Editor.isAsync?a.editor.on("readyToAdd",i,this):(i(),a.editor.focus()),a},removeItem:function(e){var t=this.schema.confirmDelete;t&&!confirm(t)||(t=_.indexOf(this.items,e),this.items[t].remove(),this.items.splice(t,1),e.addEventTriggered&&(this.trigger("remove",this,e.editor),this.trigger("change",this)),!this.items.length&&this.Editor.isAsync&&this.addItem(),this.schema.maxListLength&&this.items.length<this.schema.maxListLength&&this.$el.find('button[data-action="add"]').show())},getValue:function(){var e=_.map(this.items,function(e){return e.getValue()});return _.without(e,void 0,"")},setValue:function(e){this.value=e,this.render()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function(){var e;!this.hasFocus||(e=_.find(this.items,function(e){return e.editor.hasFocus}))&&e.editor.blur()},remove:function(){_.invokeMap(this.items,"remove"),Form.editors.Base.prototype.remove.call(this)},validate:function(){var e=_.map(this.items,function(e){return e.validate()});return!_.compact(e).length?null:{type:"list",message:"Some of the items in the list failed validation",errors:e}}}),Form.editors.List.Item=Form.editors.Base.extend({events:{'click [data-action="remove"]':function(e){e.preventDefault(),this.list.removeItem(this)},"keydown input[type=text]":function(e){13===e.keyCode&&(e.preventDefault(),this.list.addItem(),this.list.$list.find("> li:last input").focus())}},initialize:function(e){this.list=e.list,this.schema=e.schema||this.list.schema,this.value=e.value,this.Editor=e.Editor||Form.editors.Text,this.key=e.key,this.template=e.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=e.errorClassName||this.constructor.errorClassName,this.form=e.form},render:function(){var e=Backbone.$;this.editor=new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form}).render();e=e(e.trim(this.template()));return e.find("[data-editor]").append(this.editor.el),this.setElement(e),this},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var t=this.getValue(),i=this.list.form?this.list.form.getValue():{},e=this.schema.validators,s=this.getValidator;if(this.editor.nestedForm&&this.editor.nestedForm.validate)return this.editor.nestedForm.validate();if(!e)return null;var n=null;return _.every(e,function(e){return!(n=s(e)(t,i))}),n?this.setError(n):this.clearError(),n||null},setError:function(e){this.$el.addClass(this.errorClassName),this.$el.attr("title",e.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{errorClassName:"error"}),Form.editors.List.Modal=Form.editors.Base.extend({events:{click:"openEditor"},initialize:function(e){if(Form.editors.Base.prototype.initialize.call(this,e=e||{}),!Form.editors.List.Modal.ModalAdapter)throw new Error("A ModalAdapter is required");if(this.form=e.form,!e.form)throw new Error('Missing required option: "form"');this.template=e.template||this.constructor.template},render:function(){var e=this;return _.isEmpty(this.value)?this.openEditor():(this.renderSummary(),setTimeout(function(){e.trigger("readyToAdd")},0)),this.hasFocus&&this.trigger("blur",this),this},renderSummary:function(){this.$el.html($.trim(this.template({summary:this.getStringValue()})))},itemToString:function(i){i=i||{};var s=[];return _.each(this.nestedSchema,function(e,t){e=e.title||Form.Field.prototype.createTitle.call({key:t}),t=i[t];(_.isUndefined(t)||_.isNull(t))&&(t=""),s.push(e+": "+t)}),s.join("<br />")},getStringValue:function(){var e=this.schema,t=this.getValue();return _.isEmpty(t)?"[Empty]":(e.itemToString?e:this).itemToString(t)},openEditor:function(){var e=this.form.constructor,e=this.modalForm=new e({schema:this.nestedSchema,data:this.value}),e=this.modal=new Form.editors.List.Modal.ModalAdapter({content:e,animate:!0});e.open(),this.trigger("open",this),this.trigger("focus",this),e.on("cancel",this.onModalClosed,this),e.on("ok",_.bind(this.onModalSubmitted,this))},onModalSubmitted:function(){var e=this.modal,t=this.modalForm,i=!this.value;if(t.validate())return e.preventClose();this.value=t.getValue(),this.renderSummary(),i&&this.trigger("readyToAdd"),this.trigger("change",this),this.onModalClosed()},onModalClosed:function(){this.modal=null,this.modalForm=null,this.trigger("close",this),this.trigger("blur",this)},getValue:function(){return this.value},setValue:function(e){this.value=e},focus:function(){this.hasFocus||this.openEditor()},blur:function(){this.hasFocus&&this.modal&&this.modal.trigger("cancel")}},{ModalAdapter:FormsModal,isAsync:!0}),Form.editors.List.Object=Form.editors.List.Modal.extend({initialize:function(){Form.editors.List.Modal.prototype.initialize.apply(this,arguments);var e=this.schema;if(!e.subSchema)throw new Error('Missing required option "schema.subSchema"');this.nestedSchema=e.subSchema}}),Form.editors.List.NestedModel=Form.editors.List.Modal.extend({initialize:function(){Form.editors.List.Modal.prototype.initialize.apply(this,arguments);var e=this.schema;if(!e.model)throw new Error('Missing required option "schema.model"');e=e.model.prototype.schema;this.nestedSchema=_.isFunction(e)?e():e},getStringValue:function(){var e=this.schema,t=this.getValue();return _.isEmpty(t)?null:e.itemToString?e.itemToString(t):new e.model(t).toString()}}),jQuery.fn.caret=function(e){var t=this[0],i="true"===t.contentEditable;if(0!=arguments.length)return-1==e&&(e=this[i?"text":"val"]().length),window.getSelection?i?(t.focus(),window.getSelection().collapse(t.firstChild,e)):t.setSelectionRange(e,e):document.body.createTextRange&&(i?((n=document.body.createTextRange()).moveToElementText(t),n.moveStart("character",e),n.collapse(!0)):(n=t.createTextRange()).move("character",e),n.select()),i||t.focus(),e;if(window.getSelection)return i?(t.focus(),(a=(s=window.getSelection().getRangeAt(0)).cloneRange()).selectNodeContents(t),a.setEnd(s.endContainer,s.endOffset),a.toString().length):t.selectionStart;if(document.selection){if(t.focus(),i){var s=document.selection.createRange();return(a=document.body.createTextRange()).moveToElementText(t),a.setEndPoint("EndToEnd",s),a.text.length}var e=0,n=t.createTextRange(),a=(a=document.selection.createRange().duplicate()).getBookmark();for(n.moveToBookmark(a);0!==n.moveStart("character",-1);)e++;return e}return t.selectionStart||0},po=jQuery,po.fn.tagEditorInput=function(){var t=" ",i=po(this),s=parseInt(i.css("fontSize")),n=po("<span/>").css({position:"absolute",top:-9999,left:-9999,width:"auto",fontSize:i.css("fontSize"),fontFamily:i.css("fontFamily"),fontWeight:i.css("fontWeight"),letterSpacing:i.css("letterSpacing"),whiteSpace:"nowrap"});return n.insertAfter(i),i.bind("keyup keydown focus",function(){var e;t!==(t=i.val())&&(n.html(t.replace(/&/g,"&amp;").replace(/\s/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")),(e=(e=n.width()+s)<20?20:e)!=i.width()&&i.width(e))})},po.fn.tagEditor=function(s,n,a){function p(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}var f,g=po.extend({},po.fn.tagEditor.defaults,s);if(g.dregex=new RegExp("["+g.delimiter.replace("-","-")+"]","g"),"string"!=typeof s)return window.getSelection&&po(document).off("keydown.tag-editor").on("keydown.tag-editor",function(e){if(8==e.which||46==e.which||e.ctrlKey&&88==e.which){try{var t=getSelection(),s=po(t.getRangeAt(0).commonAncestorContainer)}catch(e){s=0}if(s&&s.hasClass("tag-editor")){var n=[],a=t.toString().split(s.prev().data("options").dregex);for(i=0;i<a.length;i++){var o=po.trim(a[i]);o&&n.push(o)}return po(".tag-editor-tag",s).each(function(){~po.inArray(po(this).html(),n)&&po(this).closest("li").find(".tag-editor-delete").click()}),!1}}}),this.each(function(){var l=po(this),c=[],u=po("<ul "+(g.clickDelete?'oncontextmenu="return false;" ':"")+'class="tag-editor"></ul>').insertAfter(l);l.addClass("tag-editor-hidden-src").data("options",g).on("focus.tag-editor",function(){u.click()}),u.append('<li style="width:1px">&nbsp;</li>');var t,i,h='<li><div class="tag-editor-spacer">&nbsp;'+g.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>';function n(){!g.placeholder||c.length||po(".deleted, .placeholder, input",u).length||u.append('<li class="placeholder"><div>'+g.placeholder+"</div></li>")}function d(e){var t=c.toString();c=po(".tag-editor-tag:not(.deleted)",u).map(function(e,t){t=po.trim(po(this).hasClass("active")?po(this).find("input").val():po(t).text());if(t)return t}).get(),u.data("tags",c),l.val(c.join(g.delimiter[0])),e||t!=c.toString()&&g.onChange(l,u,c),n()}function a(e){for(var t,i=e.closest("li"),s=e.val().replace(/ +/," ").split(g.dregex),n=e.data("old_tag"),a=c.slice(0),o=!1,r=0;r<s.length;r++)if(m=po.trim(s[r]).slice(0,g.maxLength),g.forceLowercase&&(m=m.toLowerCase()),t=g.beforeTagSave(l,u,a,n,m),m=t||m,!1!==t&&m&&(g.removeDuplicates&&~po.inArray(m,a)&&po(".tag-editor-tag",u).each(function(){po(this).html()==m&&po(this).closest("li").remove()}),a.push(m),i.before('<li><div class="tag-editor-spacer">&nbsp;'+g.delimiter[0]+'</div><div class="tag-editor-tag">'+p(m)+'</div><div class="tag-editor-delete"><i></i></div></li>'),g.maxTags&&a.length>=g.maxTags)){o=!0;break}e.attr("maxlength",g.maxLength).removeData("old_tag").val(""),o?e.blur():e.focus(),d()}u.click(function(s,n){var a,o,r=99999;if(!window.getSelection||""==getSelection())return g.maxTags&&u.data("tags").length>=g.maxTags?(u.find("input").blur(),!1):(f=!0,po("input:focus",u).blur(),f&&(f=!0,po(".placeholder",u).remove(),n&&n.length?o="before":po(".tag-editor-tag",u).each(function(){var e=po(this),t=e.offset(),i=t.left,t=t.top;s.pageY>=t&&s.pageY<=t+e.height()&&(a=s.pageX<i?(o="before",i-s.pageX):(o="after",s.pageX-i-e.width()))<r&&(r=a,n=e)}),("before"==o?po(h).insertBefore(n.closest("li")):"after"==o?po(h).insertAfter(n.closest("li")):po(h).appendTo(u)).find(".tag-editor-tag").click()),!1)}),u.on("click",".tag-editor-delete",function(e){if(po(this).prev().hasClass("active"))return po(this).closest("li").find("input").caret(-1),!1;var t=po(this).closest("li"),i=t.find(".tag-editor-tag");return!1===g.beforeTagDelete(l,u,c,i.html())||(i.addClass("deleted").animate({width:0},g.animateDelete,function(){t.remove(),n()}),d()),!1}),g.clickDelete&&u.on("mousedown",".tag-editor-tag",function(e){if(e.ctrlKey||1<e.which){var t=po(this).closest("li"),e=t.find(".tag-editor-tag");return!1===g.beforeTagDelete(l,u,c,e.html())?!1:(e.addClass("deleted").animate({width:0},g.animateDelete,function(){t.remove(),n()}),d(),!1)}}),u.on("click",".tag-editor-tag",function(e){return g.clickDelete&&(e.ctrlKey||1<e.which)||po(this).hasClass("active")||(t=po(this).html(),i=Math.abs((po(this).offset().left-e.pageX)/po(this).width()),e=parseInt(t.length*i),(i=po(this).html('<input type="text" maxlength="'+g.maxLength+'" value="'+t+'">').addClass("active").find("input")).data("old_tag",t).tagEditorInput().focus().caret(e),g.autocomplete&&(e=po.extend({},g.autocomplete),s="select"in e?g.autocomplete.select:"",e.select=function(e,t){s&&s(e,t),setTimeout(function(){u.trigger("click",[po(".active",u).find("input").closest("li").next("li").find(".tag-editor-tag")])},20)},i.autocomplete(e))),!1;var t,i,s}),u.on("blur","input",function(e){e.stopPropagation();var t=po(this),i=t.data("old_tag"),s=po.trim(t.val().replace(/ +/," ").replace(g.dregex,g.delimiter[0]));if(s){if(0<=s.indexOf(g.delimiter[0]))return void a(t);if(s!=i)if(g.forceLowercase&&(s=s.toLowerCase()),cb_val=g.beforeTagSave(l,u,c,i,s),s=cb_val||s,!1===cb_val){if(i)return t.val(i).focus(),f=!1,void d();try{t.closest("li").remove()}catch(e){}i&&d()}else g.removeDuplicates&&po(".tag-editor-tag:not(.active)",u).each(function(){po(this).html()==s&&po(this).closest("li").remove()})}else{if(i&&!1===g.beforeTagDelete(l,u,c,i))return t.val(i).focus(),f=!1,void d();try{t.closest("li").remove()}catch(e){}i&&d()}t.parent().html(p(s)).removeClass("active"),s!=i&&d(),n()}),u.on("paste","input",function(e){po(this).removeAttr("maxlength"),t=po(this),setTimeout(function(){a(t)},30)}),u.on("keypress","input",function(e){0<=g.delimiter.indexOf(String.fromCharCode(e.which))&&(i=po(this),setTimeout(function(){a(i)},20))}),u.on("keydown","input",function(e){var t,i,s=po(this);if((37==e.which||!g.autocomplete&&38==e.which)&&!s.caret()||8==e.which&&!s.val())return(t=s.closest("li").prev("li").find(".tag-editor-tag")).length?t.click().find("input").caret(-1):!s.val()||g.maxTags&&u.data("tags").length>=g.maxTags||po(h).insertBefore(s.closest("li")).find(".tag-editor-tag").click(),!1;if((39==e.which||!g.autocomplete&&40==e.which)&&s.caret()==s.val().length)return(i=s.closest("li").next("li").find(".tag-editor-tag")).length?i.click().find("input").caret(0):s.val()&&u.click(),!1;if(9==e.which){if(e.shiftKey){if((t=s.closest("li").prev("li").find(".tag-editor-tag")).length)t.click().find("input").caret(0);else{if(!s.val()||g.maxTags&&u.data("tags").length>=g.maxTags)return l.attr("disabled","disabled"),void setTimeout(function(){l.removeAttr("disabled")},30);po(h).insertBefore(s.closest("li")).find(".tag-editor-tag").click()}return!1}if((i=s.closest("li").next("li").find(".tag-editor-tag")).length)i.click().find("input").caret(0);else{if(!s.val())return;u.click()}return!1}if(!(46!=e.which||po.trim(s.val())&&s.caret()!=s.val().length))return(i=s.closest("li").next("li").find(".tag-editor-tag")).length?i.click().find("input").caret(0):s.val()&&u.click(),!1;if(13==e.which)return u.trigger("click",[s.closest("li").next("li").find(".tag-editor-tag")]),!1;if(36!=e.which||s.caret()){if(35==e.which&&s.caret()==s.val().length)u.find(".tag-editor-tag").last().click();else if(27==e.which)return s.val(s.data("old_tag")?s.data("old_tag"):"").blur(),!1}else u.find(".tag-editor-tag").first().click()});for(var e=g.initialTags.length?g.initialTags:l.val().split(g.dregex),s=0;s<e.length&&!(g.maxTags&&s>=g.maxTags);s++){var m=po.trim(e[s].replace(/ +/," "));m&&(g.forceLowercase&&(m=m.toLowerCase()),c.push(m),u.append('<li><div class="tag-editor-spacer">&nbsp;'+g.delimiter[0]+'</div><div class="tag-editor-tag">'+p(m)+'</div><div class="tag-editor-delete"><i></i></div></li>'))}d(!0),g.sortable&&po.fn.sortable&&u.sortable({distance:5,cancel:".tag-editor-spacer, input",helper:"clone",update:function(){d()}})});var o=[];return this.each(function(){var e=po(this),t=e.data("options"),i=e.next(".tag-editor");if("getTags"==s)o.push({field:e[0],editor:i,tags:i.data("tags")});else if("addTag"==s){if(t.maxTags&&i.data("tags").length>=t.maxTags)return!1;po('<li><div class="tag-editor-spacer">&nbsp;'+t.delimiter[0]+'</div><div class="tag-editor-tag"></div><div class="tag-editor-delete"><i></i></div></li>').appendTo(i).find(".tag-editor-tag").html('<input type="text" maxlength="'+t.maxLength+'">').addClass("active").find("input").val(n).blur(),a?po(".placeholder",i).remove():i.click()}else"removeTag"==s?(po(".tag-editor-tag",i).filter(function(){return po(this).html()==n}).closest("li").find(".tag-editor-delete").click(),a||i.click()):"destroy"==s&&e.removeClass("tag-editor-hidden-src").removeData("options").off("focus.tag-editor").next(".tag-editor").remove()}),"getTags"==s?o:this},po.fn.tagEditor.defaults={initialTags:[],maxTags:0,maxLength:50,delimiter:",;",placeholder:"",forceLowercase:!0,removeDuplicates:!0,clickDelete:!1,animateDelete:175,sortable:!0,autocomplete:null,onChange:function(){},beforeTagSave:function(){},beforeTagDelete:function(){}};var TagEditorView=Backbone.View.extend({tagName:"textarea",className:"tagEditor",preventModelUpdate:!1,tagsList:[],initialize:function(e){this.$el.addClass(this.className),this.$el.tagEditor("destroy"),this.$el.val(""),this.$el.tagEditor({initialTags:e.tagsList,forceLowercase:!1,animateDelete:0,delimiter:"",maxLength:1e4,sortable:!0,removeDuplicates:e.removeDuplicates||!1,onChange:$.proxy(this.onTagsChanged,this)})},addMultipleTags:function(e){var t=this;_.each(e,function(e){t.$el.tagEditor("addTag",e,!0)})},onTagsChanged:function(e,t,i){this.trigger("changeList",i)},refreshTags:function(e){this.preventModelUpdate=!0,this.removeAllTags(),this.addMultipleTags(e),this.preventModelUpdate=!1},removeAllTags:function(){var t=this,e=t.$el.tagEditor("getTags")[0].tags;_.each(e,function(e){t.$el.tagEditor("removeTag",e,!0)})}}),sr;function tr(c,e){var u,h=this;h.options=c,h.$element=sr(e),h.dropdownId=c&&c.dropdownId?c.dropdownId:"",h.inputItemLimit=c&&_.isNumber(c.inputItemLimit)?c.inputItemLimit:5,h.tooltip=c.tooltip,h.tooltipItemLimit=c&&_.isNumber(c.tooltipItemLimit)?c.tooltipItemLimit:5,h.width=c&&_.isNumber(c.width)?c.width:"auto",u=h.$element.val(),h.$element.removeAttr("multiple"),h.applyTooltip=function(e,t){items=_.map(e,function(e){return e.title||e.text}),items&&_.isArray(items)?tooltip=items.slice(0,h.tooltipItemLimit||items.length).join(", "):items&&_.isString(items)&&(tooltip=items),items.length>h.tooltipItemLimit&&0!=h.tooltipItemLimit&&(tooltip+=" and "+(items.length-h.tooltipItemLimit)+" more"),t.prop("title",_.isFunction(h.tooltip)?h.tooltip(tooltip):tooltip)},sr.fn.select2.amd.require(["select2/utils","select2/selection/multiple","select2/selection/eventRelay","select2/dropdown","select2/dropdown/attachBody","select2/dropdown/search"],function(l,s,e,t,i,n){var a;function o(){}function r(){}s.prototype.bind=function(e,t){var i=this;s.__super__.bind.apply(this,arguments),this.$selection.on("click",function(e){i.trigger("toggle",{originalEvent:e})}),this.$selection.on("click",".select2-selection__choice__remove",function(e){var t;i.options.get("disabled")||(t=sr(this).parent().data("data"),i.trigger("unselect",{originalEvent:e,data:t}),e.stopPropagation())})},o.prototype.render=function(e){var t,a=this,i=e.call(this),o=_.keys(h.options.availableOptions);return getIconClass=function(e){var t="fa ";return e&&0!==e.length?_.isArray(e)&&e.length===o.length?t+="fa-check-square":t+="fa-minus-square":t+="fa-square",t+=" select2-select-all-checkbox"},e=sr("<i />").addClass("fa fa-caret-down select2-dropdown-arrow"),t=sr("<i />").addClass(getIconClass(a.$element.val())).attr("aria-selected",!1),i.append(e),i.prepend(t),a.$element.on("change",function(e){t[0].className=getIconClass(sr(e.target).val())}),t.click(function(e){var t,i=a.$element.val()||[],s=sr(".select2-search__field").val(),n=s?_.filter(o,function(e){return c.matcher({term:s},{text:e})}):o;_.isEmpty(_.difference(n,i))?(t=_.difference(i,n),a.$element.trigger("select-none")):(t=i.concat(n),a.$element.trigger("select-all")),a.$element.val(t).trigger("change"),e.stopPropagation()}),a.$element.width(h.width),i},o.prototype.update=function(e,t){var i,s,n,a;if(this.clear(),0!==t.length){if(n=this.$selection.find(".select2-selection__rendered"),t.length>h.inputItemLimit)i=this.display(s,a),n.empty().append('<div class="summary">'+i+"</div>");else{for(var o=[],r=0;r<t.length;r++)s=t[r],a=this.selectionContainer(),i=l.escapeMarkup(s.text),a.append(i),a.prop("title",s.title||s.text),a.data("data",s),o.push(a);l.appendMany(n,o)}h.applyTooltip(t,n)}},n=!(r.prototype.render=function(e){e=e.call(this);return e.find(".select2-dropdown .select2-results").attr("id",h.dropdownId),e})===c.showSearch?t:l.Decorate(t,n),n=l.Decorate(l.Decorate(n,i),r),e=l.Decorate(l.Decorate(s,o),e),h.select2=h.$element.select2({ajax:c.ajax,closeOnSelect:!1,dropdownAdapter:n,matcher:c.matcher,minimumResultsForSearch:!1===c.showSearch?-1:0,placeholder:c.placeholder,selectionAdapter:e,theme:c.theme,templateSelection:function(){return h.options.templateSelection(h.$element.val()||[])},templateResult:function(e){return void 0!==e.loading?e.text:sr("<div>").text(e.text).addClass(h.options.wrapClass)}}).data("select2"),h.select2.$container.css("width",h.width),h.select2.$results.off("mouseup").on("mouseup",".select2-results__option[aria-selected]",(a=h.select2,function(e){var t=sr(this),i=t.data("data");if("true"===t.attr("aria-selected"))return a.trigger("unselect",{originalEvent:e,data:i}),void t.addClass("select2-results__option--highlighted").siblings().removeClass("select2-results__option--highlighted");a.$element.trigger("select",i),a.trigger("select",{originalEvent:e,data:i}),t.addClass("select2-results__option--highlighted").siblings().removeClass("select2-results__option--highlighted")})),h.$element.off("select-all.dash-multiselect").on("select-all.dash-multiselect",function(){h.select2.$results.find(".select2-results__option:not(.select2-results__option--load-more)").attr("aria-selected",!0)}),h.$element.off("select-none.dash-multiselect").on("select-none.dash-multiselect",function(){h.select2.$results.find(".select2-results__option:not(.select2-results__option--load-more)").attr("aria-selected",!1)}),h.$element.attr("multiple","multiple").val(u).trigger("change.select2"),_.isFunction(c.initCallback)&&c.initCallback(h.select2)})}Form.editors.CustomList=Form.editors.Base.extend({events:{},initialize:function(e){var t=Form.editors;t.Base.prototype.initialize.call(this,e=e||{});var i=this.schema;if(!i)throw new Error("Missing required option 'schema'");this.template=e.template||this.constructor.template,this.Editor=(i=i.itemType)?t.List[i]||t[i]:t.Text,this.items=[]},render:function(){this.value;var e=Backbone.$,t=e(e.trim(this.template()));return this.$list=t.is("[data-items]")?t:t.find("[data-items]"),this.setElement(t),this.$el.attr("id",this.id),this.$el.attr("name",this.key),e("<textarea></textarea>").insertBefore(t.find(".bbf-actions")),this.tagEditor=new TagEditorView({el:t.find("textarea"),removeDuplicates:!1}),this.populateListFromValue(),this.hasFocus&&this.trigger("blur",this),this.$el.find('button[data-action="add"]').click(function(e){e.preventDefault(),this.addItem(null,!0)}.bind(this)),t.find("ul[data-items]").hide(),t.find("textarea li.ui-sortable-handle").remove(),t.find('button[data-action="add"]').hide(),this.schema.editorClass&&t.find("ul.tag-editor").addClass(this.schema.editorClass),this.listenTo(this.tagEditor,"changeList",function(e){this.items=[],_.each(e,function(e){e=new Form.editors.List.Item({list:this.items,form:this.form,schema:this.schema,value:e,Editor:this.Editor,key:this.key}).render();this.items.push(e)}.bind(this)),this.trigger("changeList",this)}),this},addItem:function(e,t){function i(){s.items.push(a),s.$list.append(a.$el),a.editor.on("all",function(e){var t;"change"!==e&&((t=_.toArray(arguments))[0]="item:"+e,t.splice(1,0,s),n.List.prototype.trigger.apply(this,t))},s),a.editor.on("change",function(){a.addEventTriggered||(a.addEventTriggered=!0),this.trigger("changeList",this)},s),a.on("changeList",function(){this.trigger("changeList",this)},s),a.editor.on("focus",function(){this.hasFocus||this.trigger("focus",this)},s),a.editor.on("blur",function(){var e;this.hasFocus&&(e=this,setTimeout(function(){_.find(e.items,function(e){return e.editor.hasFocus})||e.trigger("blur",e)},0))},s),(t||e)&&(a.addEventTriggered=!0),t&&(s.trigger("add",s,a.editor),s.trigger("changeList",this))}var s=this,n=Form.editors,a=new n.List.Item({list:this.items,form:this.form,schema:this.schema,value:e,Editor:this.Editor,key:this.key}).render();return this.Editor.isAsync?a.editor.on("readyToAdd",i,this):(i(),a.editor.focus()),a},onModelValueChange:function(e,t){t=t instanceof Backbone.Model?t:_.clone(t);try{this.setValue(t,e.forceRender),e.forceRender=!1}catch(e){console.log("BBForm on change error",e)}},populateListFromValue:function(){var t=this,e=this.value||[];this.items=[],this.$list.empty(),_.isArray(e)?_.each(e,function(e){t.addItem(e)}):_.isString(e)?t.addItem(e):this.Editor.isAsync||this.addItem(),e=1===this.items.length&&void 0===this.items[0].value?[]:this.items,this.tagEditor&&this.tagEditor.refreshTags(_.map(e,function(e){return e.value}))},removeItem:function(e){var t=this.schema.confirmDelete;t&&!confirm(t)||(t=_.indexOf(this.items,e),this.items[t].remove(),this.items.splice(t,1),e.addEventTriggered&&(this.trigger("remove",this,e.editor),this.trigger("change",this)),this.items.length||this.Editor.isAsync||this.addItem())},getValue:function(){var e=_.map(this.items,function(e){return e.value});return _.without(e,void 0,"")},setValue:function(e,t){this.value=e,t&&this.populateListFromValue()},focus:function(){this.hasFocus||this.items[0]&&this.items[0].editor.focus()},blur:function(){var e;!this.hasFocus||(e=_.find(this.items,function(e){return e.editor.hasFocus}))&&e.editor.blur()},remove:function(){_.invokeMap(this.items,"remove"),Form.editors.Base.prototype.remove.call(this)},validate:function(){if(!this.validators)return null;var e=_.map(this.items,function(e){return e.validate()});return!_.compact(e).length?null:{type:"list",message:"Some of the items in the list failed validation",errors:e}}}),Form.editors.CustomList.Item=Form.editors.Base.extend({events:{'click [data-action="remove"]':function(e){e.preventDefault(),-1<(e=this.list.indexOf(this))&&this.list.splice(e,1),this.remove(),this.trigger("changeList",this)},"keydown input[type=text]":function(e){13===e.keyCode&&e.preventDefault()}},initialize:function(e){this.list=e.list,this.schema=e.schema||this.list.schema,this.value=e.value,this.Editor=e.Editor||Form.editors.Text,this.key=e.key,this.template=e.template||this.schema.itemTemplate||this.constructor.template,this.errorClassName=e.errorClassName||this.constructor.errorClassName,this.form=e.form},render:function(){var e=Backbone.$;this.editor=new this.Editor({key:this.key,schema:this.schema,value:this.value,list:this.list,item:this,form:this.form,model:new Backbone.Model}).render();e=e(e.trim(this.template()));return e.find("[data-editor]").append(this.editor.el),this.setElement(e),e.find("input").val(this.value),this},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var t=this.getValue(),i=this.list.form?this.list.form.getValue():{},e=this.schema.validators,s=this.getValidator;if(!e)return null;var n=null;return _.every(e,function(e){return!(n=s(e)(t,i))}),n?this.setError(n):this.clearError(),n||null},setError:function(e){this.$el.addClass(this.errorClassName),this.$el.attr("title",e.message)},clearError:function(){this.$el.removeClass(this.errorClassName),this.$el.attr("title",null)}},{errorClassName:"error"}),Form.editors.Long=Form.editors.Text.extend({defaultValue:"0",events:_.extend({},Form.editors.Text.prototype.events,{keypress:"onKeyPress",change:"onKeyPress"}),initialize:function(e){Form.editors.Text.prototype.initialize.call(this,e)},onKeyPress:function(e){function t(){setTimeout(function(){s.determineChange()},0)}var i,s=this;0!==e.charCode&&13!==e.charCode&&45!==e.charCode?(i=this.$el.val().trim(),null!=e.charCode&&(i+=String.fromCharCode(e.charCode)),/^\-?[0-9]*?$/.test(i)||""===i?t():e.preventDefault()):t()},getValue:function(){return this.$el.val()},setValue:function(e){_.isString(e)&&/^\-?[0-9]*?$/.test(e)||(e=null),Form.editors.Text.prototype.setValue.call(this,e)}}),sr=jQuery,sr.fn.extend({dashMultiSelect:function(){var e=sr.extend({templateSelection:function(e){return e.length+" selected"},wrapClass:"wrap"},arguments[0]);this.each(function(){new tr(e,this)})}}),Form.editors.MultiSelect=Form.editors.Select.extend({inputItemLimit:5,tooltipItemLimit:10,matcher:null,tagName:"select",initialize:function(e){if(this.$el.prop("multiple","multiple"),e.schema&&(e.schema.dropdownId&&(this.dropdownId=e.schema.dropdownId),_.isNumber(e.schema.inputItemLimit)&&(this.inputItemLimit=e.schema.inputItemLimit),this.matcher=(_.isFunction(e.schema.matcher)?e.schema:$.fn.select2.defaults.defaults).matcher,e.schema.selectAllValue&&(this.selectAllValue=e.schema.selectAllValue),e.schema.tooltip&&(this.tooltip=e.schema.tooltip),_.isNumber(e.schema.tooltipItemLimit)&&(this.tooltipItemLimit=e.schema.tooltipItemLimit),_.isFunction(e.schema.onReadyCallback)&&(this.onReadyCallback=e.schema.onReadyCallback),this.modelKey=e.schema.modelKey||"SelectedValue",e.schema.multiSelect&&(this.multiSelect=e.schema.multiSelect),this.viewstateType=e.schema.viewstateType||"list",e.schema.width&&(this.width=e.schema.width)),Form.editors.Select.prototype.initialize.call(this,e),!this.schema||!this.schema.options)throw new Error("Missing required 'schema.options'")},isEqualUnordered:function(e,t){return!(!_.isArray(e)||!_.isArray(t))&&(e.length===t.length&&e.length===_.intersection(e,t).length)},getValue:function(){var e;return!this.$el.data("select2")||this.renderingOptions?this.value||[]:(e=this.$el.val(),(e=this.isEqualUnordered(e,this.value)?this.value:e)&&e.length===_.keys(this.availableOptions).length&&this.selectAllValue?"list"===this.viewstateType?[this.selectAllValue]:this.selectAllValue:e||[])},renderOptions:function(e){var t,i=this,s=this.$el;this.currentOptions=e,this.populateSelect(s,e),this.renderingOptions=!0,t={initCallback:function(e){var t=i.model.get(i.modelKey);i.renderingOptions=!1,i.form&&i.form.options&&"environment"===i.form.options.theme&&e.on("open",function(){$("body > .select2-container--dashboards.select2-container--open").addClass("select2--environment")}),t=i.multiSelect&&i.selectAllValue&&(t===i.selectAllValue||_.isArray(t)&&t[0]===i.selectAllValue)?i.selectAllValue:t,i.setValue(t),i.setWidth(i.width),i.onReadyCallback&&i.onReadyCallback(i.dropdownId)},availableOptions:i.availableOptions,dropdownId:i.dropdownId,inputItemLimit:i.inputItemLimit,matcher:i.matcher,showSearch:i.showSearch,templateSelection:function(e){return e.length<i.inputItemLimit?e.join(", "):e.length+" of "+_.keys(i.availableOptions).length+" selected"},theme:"dashboards",tooltip:i.tooltip,tooltipItemLimit:i.tooltipItemLimit,width:i.width},_.extend(t,this.getPaginationSettings(e)),s.dashMultiSelect(t),s.off("select-all.multiselect").on("select-all.multiselect",function(){var t=$(".select2-search__field").val(),e=t?_.filter(_.keys(i.availableOptions),function(e){return i.matcher({term:t},{text:e})}):_.keys(i.availableOptions);i.setValue(e)}),s.off("select-none.multiselect").on("select-none.multiselect",function(){i.setValue([])}),s.off("select").on("select",function(e,t){i.renderedOptions[t.id]=t.text||t.id})},setUIValueOnce:function(e){(this.setUIValueOnce=_.once(function(e){this.value=e,this.$el.val(e).trigger("change.select2")}.bind(this)))(e)},setValue:function(e){var t,i,s,n=this;this.$el.data("select2")&&!this.renderingOptions?(t=_.keys(this.availableOptions).sort(),i=(this.$el.val()||[]).slice().sort(),s=_.keys(this.renderedOptions).sort(),this.selectAllValue&&(e===this.selectAllValue||_.isArray(e)&&e[0]===this.selectAllValue)&&(e=t),t.length?(!_.isArray(e)&&_.includes(t,e)&&(e=[e]),t=_.intersection(e,t),_.each(_.difference(t,s),function(e){n.$el.append(new Option(n.availableOptions[e],e)),n.renderedOptions[e]=n.availableOptions[e]}),this.setUIValueOnce(t),this.isEqualUnordered(t,i)||(this.value=t,this.$el.val([]).val(this.value).trigger("change.select2"))):(this.value=e,this.$el.val([]).val(this.value).trigger("change.select2"))):this.value=e},setWidth:function(e){var t=this.$el.data("select2");this.width=e,t&&t.$container.css("width",this.width)}}),Form.editors.Object=Form.editors.Base.extend({hasNestedForm:!0,initialize:function(e){if(this.value={},Form.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!this.schema.subSchema)throw new Error("Missing required 'schema.subSchema' option for Object editor")},render:function(){var e=this.form.constructor;return this.nestedForm=new e({schema:this.schema.subSchema,data:this.value,idPrefix:this.id+"_",Field:e.NestedField}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},getValue:function(){return this.nestedForm?this.nestedForm.getValue():this.value},setValue:function(e){this.value=e,this.render()},focus:function(){this.hasFocus||this.nestedForm.focus()},blur:function(){this.hasFocus&&this.nestedForm.blur()},remove:function(){this.nestedForm.remove(),Backbone.View.prototype.remove.call(this)},validate:function(){var e=_.extend({},Form.editors.Base.prototype.validate.call(this),this.nestedForm.validate());return!_.isEmpty(e)&&e},_observeFormEvents:function(){this.nestedForm&&this.nestedForm.on("all",function(){var e=_.toArray(arguments);(e[1]=this).trigger.apply(this,e)},this)}}),Form.editors.NestedModel=Form.editors.Object.extend({initialize:function(e){if(Form.editors.Base.prototype.initialize.call(this,e),!this.form)throw new Error('Missing required option "form"');if(!e.schema.model)throw new Error('Missing required "schema.model" option for NestedModel editor')},render:function(){var e=this.form.constructor,t=this.value||{},i=(this.key,this.schema.model),t=t.constructor===i?t:new i(t);return this.nestedForm=new e({model:t,idPrefix:this.id+"_",fieldTemplate:"nestedField"}),this._observeFormEvents(),this.$el.html(this.nestedForm.render().el),this.hasFocus&&this.trigger("blur",this),this},commit:function(){var e=this.nestedForm.commit();return e?(this.$el.addClass("error"),e):Form.editors.Object.prototype.commit.call(this)}}),Form.editors.Number=Form.editors.Text.extend({defaultValue:0,events:_.extend({},Form.editors.Text.prototype.events,{keypress:"onKeyPress",change:"onKeyPress"}),initialize:function(e){Form.editors.Text.prototype.initialize.call(this,e);e=this.schema;e&&e.editorAttrs&&e.editorAttrs.step||this.$el.attr("step","any")},onKeyPress:function(e){function t(){setTimeout(function(){s.determineChange()},0)}var i,s=this;0!==e.charCode&&13!==e.charCode&&45!==e.charCode?(i=this.$el.val().trim(),null!=e.charCode&&(i+=String.fromCharCode(e.charCode)),(_.some(this.validators,function(e){return _.isFunction(e)&&"wholeNumber"===e.name})?/^\-?[0-9]*?$/:/^\-?[0-9]*\.?[0-9]*?$/).test(i)||""===i?t():e.preventDefault()):t()},postRender:function(){this.$el.spinner({classes:{"ui-spinner":"highlight"},step:1}),this.$el.off("spin").on("spin",function(e,t){var i=parseFloat($(this).val()),s=$(this);if(i){var n=Number.isInteger(i)?0:s.val().split(".")[1].length,i=i<t.value?i+1:i-1;return s.val(i.toFixed(n)),!1}s.val(0)})},getValue:function(){var e=this.$el.val();return""===e?null:parseFloat(e,10)},setValue:function(e){e=_.isNumber(e)?e:_.isString(e)&&""!==e?parseFloat(e,10):null,_.isNaN(e)&&(e=null),this.value=e,Form.editors.Text.prototype.setValue.call(this,e)}}),Form.editors.Password=Form.editors.Text.extend({initialize:function(e){Form.editors.Text.prototype.initialize.call(this,e),this.$el.attr("type","password")},getValue:function(){return this.$el.val()}}),Form.editors.Radio=Form.editors.Select.extend({tagName:"ul",events:{"change input[type=radio]":function(){this.trigger("change",this)},"focus input[type=radio]":function(){this.hasFocus||this.trigger("focus",this)},"blur input[type=radio]":function(){var e;this.hasFocus&&(e=this,setTimeout(function(){e.$("input[type=radio]:focus")[0]||e.trigger("blur",e)},0))}},getTemplate:function(){return this.schema.template||this.constructor.template},getValue:function(){return this.$("input[type=radio]:checked").val()},setValue:function(e){this.value=e,this.$("input[type=radio]").val([e])},focus:function(){var e;this.hasFocus||((e=this.$("input[type=radio]:checked"))[0]?e:this.$("input[type=radio]").first()).focus()},blur:function(){this.hasFocus&&this.$("input[type=radio]:focus").blur()},_arrayToHtml:function(e){var t=this.getTemplate(),i=this.getName(),s=this.id;return t({items:_.map(e,function(e,t){t={name:i,id:s+"-"+t};return _.isObject(e)?(t.value=e.val||0===e.val?e.val:"",t.label=e.label,t.labelHTML=e.labelHTML):(t.value=e,t.label=e),t})})}}),Form.editors.TextArea=Form.editors.Text.extend({tagName:"textarea",initialize:function(e){Form.editors.Base.prototype.initialize.call(this,e)}});var ErrorTooltip={clearAll:function(e){e?$("body .field-error").fadeOut():$("body .field-error").remove()},clear:function(e,t){e&&(t?e.fadeOut():e.remove())},show:function(e,t,i){if(e&&t){i=i||{appendToBody:!0};$(t).position().left,$(t).position().top;return(e=i.appendToBody?$("<div/>",{text:e}).addClass("field-error").appendTo("body"):$("<div/>",{text:e}).addClass("field-error").appendTo($(t).parent())).position({of:$(t),my:i.onLeft?"right center":"left center",at:i.onLeft?"left center":"right center",collision:"flip fit",using:function(e,t){var i=0,i="right"===t.horizontal?($(this).addClass("error-left-side"),-10):($(this).removeClass("error-left-side"),10);$(this).css({left:e.left+i+"px",top:e.top+"px"})}}),e}}},Zu;Form.Field=Backbone.View.extend({initialize:function(e){e=e||{},_.extend(this,_.pick(e,"form","key","model","value","idPrefix")),this.base64=e.form.base64;var t=this.schema=this.createSchema(e.schema);this.template=e.template||t.template||this.template||this.constructor.template,this.errorClassName=e.errorClassName||this.errorClassName||this.constructor.errorClassName,this.editor=this.createEditor()},createSchema:function(e){return _.isString(e)&&(e={type:e}),(e=_.extend({type:"Text",title:e.fieldAttrs&&e.fieldAttrs.title?e.fieldAttrs.title:this.createTitle(),tooltipTitle:e.fieldAttrs&&e.fieldAttrs.tooltipTitle?e.fieldAttrs.tooltipTitle:this.createTooltipTitle()},e)).type=_.isString(e.type)?Form.editors[e.type]:e.type,e},createEditor:function(){var e=_.extend(_.pick(this,"schema","form","key","model","value"),{id:this.createEditorId()});return new this.schema.type(e)},createEditorId:function(){var e=this.idPrefix,t=(t=this.key).replace(/\./g,"_");return _.isString(e)||_.isNumber(e)?e+t:!_.isNull(e)&&this.model?this.model.cid+"_"+t:t},createTitle:function(){var e=this.key;return(e=(e=(e=(e=(e=-1<(e=this.base64?atob(e):e).indexOf("/")?e.split("/").pop():e).replace("_"," ")).trim()).replace(/([A-Z])/g," $1")).replace(/^./,function(e){return e.toUpperCase()})).trim()},createTooltipTitle:function(){var e=this.key;return e=this.base64?atob(e):e},getEditorElement:function(){var e=this.editor.$el;return e=this.editor.schema.options&&e.siblings(".select2").length?e.siblings(".select2"):e},getErrorClickEvent:function(){return"click.errorTooltip-"+this.editor.id},templateData:function(){var e=this.schema;return{help:e.help||"",title:e.title,titleHTML:e.titleHTML,tooltipTitle:e.tooltipTitle,fieldAttrs:e.fieldAttrs,editorAttrs:e.editorAttrs,key:this.key,editorId:this.editor.id}},render:function(){var e=this.schema,s=this.editor,t=this,n=Backbone.$;if(!0===this.editor.noField)return this.setElement(s.render().el);var i=n(n.trim(this.template(_.result(this,"templateData"))));return e.fieldClass&&i.addClass(e.fieldClass),e.fieldAttrs&&i.attr(e.fieldAttrs),i.find("[data-editor]").add(i).each(function(e,t){var i=n(t),t=i.attr("data-editor");_.isUndefined(t)||(_.isFunction(s.preRender)?(i.append(s.preRender().el),s.render()):i.append(s.render().el),_.isFunction(s.postRender)&&s.postRender())}),i.click(function(e){t.clearError()}),this.setElement(i),this},disable:function(){_.isFunction(this.editor.disable)?this.editor.disable():($input=this.editor.$el,$input=$input.is("input")?$input:$input.find("input"),$input.attr("disabled",!0))},enable:function(){_.isFunction(this.editor.enable)?this.editor.enable():($input=this.editor.$el,$input=$input.is("input")?$input:$input.find("input"),$input.attr("disabled",!1))},validate:function(e){var t=this.editor.validate();return t?this.setError(t.message,e):this.clearError(),t},setError:function(e,t){var i=this.getEditorElement(),s=this.getErrorClickEvent();this.editor.hasNestedForm||(i.addClass(this.errorClassName),this.$errorTooltip&&ErrorTooltip.clear(this.$errorTooltip),this.$errorTooltip=ErrorTooltip.show(e,i,t),$("#appdiv").off(s),$("#appdiv").on(s,$.proxy(function(e){ErrorTooltip.clear(this.$errorTooltip)},this)))},clearError:function(){this.getEditorElement().removeClass(this.errorClassName),ErrorTooltip.clear(this.$errorTooltip),$("#appdiv").off(this.getErrorClickEvent())},commit:function(){return this.editor.commit()},getValue:function(){return this.editor.getValue()},setValue:function(e){this.editor.setValue(e)},focus:function(){this.editor.focus()},onResize:function(){this.$errorTooltip&&ErrorTooltip.clear(this.$errorTooltip)},blur:function(){this.editor.blur()},remove:function(){this.editor.remove(),this.$errorTooltip&&($("#appdiv").off(this.getErrorClickEvent()),this.$errorTooltip.remove()),Backbone.View.prototype.remove.call(this)}},{errorClassName:"error"}),Form.Fieldset=Backbone.View.extend({initialize:function(e){var t=this.schema=this.createSchema((e=e||{}).schema);this.fields=_.pick(e.fields,t.fields),this.template=e.template||t.template||this.template||this.constructor.template},createSchema:function(e){return(e=_.isArray(e)?{fields:e}:e).legend=e.legend||null,e},getFieldAt:function(e){e=this.schema.fields[e];return this.fields[e]},templateData:function(){return this.schema},render:function(){this.schema;var s=this.fields,n=Backbone.$,e=n(n.trim(this.template(_.result(this,"templateData"))));return e.find("[data-fields]").add(e).each(function(e,t){var i=n(t),t=i.attr("data-fields");_.isUndefined(t)||_.each(s,function(e){i.append(e.render().el)})}),this.setElement(e),this},remove:function(){_.each(this.fields,function(e){e.remove()}),Backbone.View.prototype.remove.call(this)}}),Form.NestedField=Form.Field.extend({}),Form.validators=(Zu={},Zu.errMessages={required:"Required",regexp:"Invalid",number:"Must be a number",range:Handlebars.compile("Must be a number between {{min}} and {{max}}"),email:"Invalid email address",url:"Invalid URL",match:Handlebars.compile('Must match field "{{field}}"')},Zu.required=function(i){return i=_.extend({type:"required",message:this.errMessages.required},i),function(e){i.value=e;var t={type:i.type,message:_.isFunction(i.message)?i.message(i):i.message};if(null==e||!1===e||""===e)return t}},Zu.regexp=function(i){if(!i.regexp)throw new Error('Missing required "regexp" option for "regexp" validator');return i=_.extend({type:"regexp",match:!0,message:this.errMessages.regexp},i),function(e){i.value=e;var t={type:i.type,message:_.isFunction(i.message)?i.message(i):i.message};if(null!=e&&""!==e)return"string"==typeof i.regexp&&(i.regexp=new RegExp(i.regexp,i.flags)),(i.match?!i.regexp.test(e):i.regexp.test(e))?t:void 0}},Zu.number=function(e){return e=_.extend({type:"number",message:this.errMessages.number,regexp:/^\-?[0-9]*\.?[0-9]*?$/},e),Zu.regexp(e)},Zu.range=function(i){return i=_.extend({type:"range",message:this.errMessages.range,numberMessage:this.errMessages.number,min:0,max:100},i),function(e){i.value=e;var t={type:i.type,message:_.isFunction(i.message)?i.message(i):i.message};if(null!=e&&""!==e){e=Zu.number({message:i.numberMessage})(e);if(e)return e;e=parseFloat(i.value);return e<i.min||e>i.max?t:void 0}}},Zu.email=function(e){return e=_.extend({type:"email",message:this.errMessages.email,regexp:/^[\w\-]{1,}([\w\-\+.]{1,1}[\w\-]{1,}){0,}[@][\w\-]{1,}([.]([\w\-]{1,})){1,3}$/},e),Zu.regexp(e)},Zu.url=function(e){return e=_.extend({type:"url",message:this.errMessages.url,regexp:/^(http|https):\/\/[-a-zA-Z0-9@:%_\+.~#?&//=]{2,256}\.[a-z]{2,4}\b(\/[-a-zA-Z0-9@:%_\+.~#?&//=]*)?/gi},e),Zu.regexp(e)},Zu.match=function(s){if(!s.field)throw new Error('Missing required "field" options for "match" validator');return s=_.extend({type:"match",message:this.errMessages.match},s),function(e,t){s.value=e;var i={type:s.type,message:_.isFunction(s.message)?s.message(s):s.message};if(null!=e&&""!==e)return e!==t[s.field]?i:void 0}},Zu);var viewStateMethods=function(i){return{initialize:function(e){i.prototype.initialize.apply(this,[e]),this.form=e.form,e.openViewStateDialog?this.quickdashOpenViewStateDialog=e.openViewStateDialog:e.form&&(this.quickdashOpenViewStateDialog=e.form.options.openViewStateDialog)},render:function(){var e,t;return this.form&&i.prototype.render.apply(this),this.cache={text:this.defaultValue||"",viewState:""},t=$(this.el),e=$("<div/>"),this.$viewStateApply=$("<i/>").addClass("fa fa-fw watermark fa-eye viewstate-apply"),this.$viewStateClear=$("<i/>").addClass("fa fa-fw watermark fa-eraser viewstate-clear"),this.$viewStateContainer=$("<div/>").addClass("viewstate-container"),this.$viewStateIcon=$("<i/>").addClass("fa fa-fw watermark fa-eye viewstate-icon"),this.$viewStateInput=$("<input/>").attr("type","text"),e.insertBefore(t),e.append(t),e.append(this.$viewStateApply),e.append(this.$viewStateContainer),e.addClass("viewstate-control"),this.$viewStateContainer.append(this.$viewStateClear),this.$viewStateContainer.append(this.$viewStateIcon),this.$viewStateContainer.append(this.$viewStateInput),this.$viewStateContainer.append(this.$viewStateToggle),this.$viewStateInput.attr("name",this.formname),this.$viewStateInput.attr("tabindex",-1),this.$viewStateClear.attr("tabindex",0),this.$viewStateInput.prop("readonly",!0),this.originalEl=this.el,this.el=e[0],this.isViewState=!1,this.applyControlState(),this.setValue(this.value),this},applyControlState:function(){var t,e=this,i=$(this.el);this.$viewStateApply.off("click"),this.$viewStateIcon.off("click"),this.$viewStateInput.off("click"),this.$viewStateClear.off("click"),this.isViewState?(i.addClass("is-viewstate"),this.$viewStateInput.click(function(){e.openViewStateDialog()}),this.$viewStateIcon.click(function(){e.openViewStateDialog()}),t=function(){e.isViewState=!1,e.model=null,e.$viewStateInput.val(""),e.setValue(e.cache.text),e.applyControlState()},this.$viewStateClear.keypress(function(e){13==e.which&&t()}),this.$viewStateClear.click(t)):(i.removeClass("is-viewstate"),this.$viewStateApply.click(function(){e.cache.text=e.value,e.openViewStateDialog()}))},destroy:function(){$(this.input).off("click"),this.$viewStateApply&&(this.$viewStateApply.off("click"),this.$viewStateApply=null),this.$viewStateIcon&&(this.$viewStateIcon.off("click"),this.$viewStateIcon=null),this.$viewStateInput&&(this.$viewStateInput.off("click"),this.$viewStateInput=null),this.$viewStateClear&&(this.$viewStateClear.off("click"),this.$viewStateClear=null),this._super()},determineChange:function(e){var t=this.getValue();t!==this.previousValue&&(this.previousValue=t,this.trigger("change",this))},formatValue:function(e){return e},getModel:function(){return this.model},getValue:function(){return this.isViewState?this.model||this.formatValue(""):this.formatValue(i.prototype.getValue.apply(this))},openViewStateDialog:function(){var t=this;this.quickdashOpenViewStateDialog&&this.quickdashOpenViewStateDialog(this.$viewStateInput.val(),function(e){t.isViewState=!0,t.setModel(e),t.applyControlState()})},setModel:function(e){var t=this.getModel()!==e,i=e?e.path:"";this.model=e,this.value=null,i!==this.$viewStateInput.val()&&this.$viewStateInput.val(i),this.isViewState||(this.isViewState=!0,this.applyControlState()),this.determineChange(t)},setTextValue:function(e){this.originalEl.value=e,this.value=e},setValue:function(e){var t,i,s;(_.isNull(e)||_.isUndefined(e))&&(e=""),t=this.value!==e,this.ignoreModelChanges||("viewstate"===(s=e,_.isObject(s)&&_.isFunction(s.get)?s.get("_viewType")?"viewstate":s.get("_dataType")?"datasource":void 0:"none")?(this.ignoreModelChanges=!0,this.setModel(e),i=(s=e).path,this.ignoreModelChanges=!1,this.value=s,this.$viewStateInput.val(i),i=!1===this.isViewState,this.isViewState=!0):(this.setTextValue(e),i=!0===this.isViewState,this.isViewState=!1)),i&&this.applyControlState(),this.determineChange(t)},validate:function(){return!this.isViewState&&i.prototype.validate.apply(this)}}};Form.editors.ViewState=Form.editors.Text.extend({initialize:function(e){Form.editors.Text.prototype.initialize.call(this,e),this.template=e.template||this.constructor.template,e.openViewStateDialog?this.baseOpenViewStateDialog=e.openViewStateDialog:e.form?this.baseOpenViewStateDialog=e.form.options.openViewStateDialog:this.baseOpenViewStateDialog=$.noop},initializeEvents:function(){this.$input.click(_.bind(this.openViewStateDialog,this))},getValue:function(){return this.value},openViewStateDialog:function(){var t=this,e=t.value instanceof Backbone.Model?t.value:null;t.baseOpenViewStateDialog(e,function(e){_.isEqual(e,t.value)||(t.setValue(e),t.trigger("change",t))})},setValue:function(e){var t=e?e.path:"";this.value=e,this.$input.val(t||"")},render:function(){var e=$(this.template());return this.$input=e.find("input"),this.setValue(this.value),this.setElement(e),this.initializeEvents(),this}});var T=(_v.CustomList=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return'<div class="bbf-customlist">\r\n    <ul data-items></ul>\r\n    <div class="bbf-actions"><button type="button" data-action="add"><i class="fa fa-plus" /></button></div>\r\n</div>'},useData:!0}),_v.DatePicker=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a=null!=t?t:e.nullContext||{},o=i.helperMissing,r="function",l=e.escapeExpression;return'<div>\r\n    <input type="text" name="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" id="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" value="" />\r\n</div>'},useData:!0}),_v.DatePickerRolling=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a=null!=t?t:e.nullContext||{},o=i.helperMissing,r="function",l=e.escapeExpression;return'<div>\r\n    <label for="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_checkbox"><i class="fa fa-info-circle" title="Specify a date using NOW, T+x or T-x"></i> Rolling</label>\r\n    <input type="checkbox" name="rolling" value="rolling" id="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_checkbox">\r\n    <input type="text" name="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" id="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_date" value="" />\r\n    <input type="text" name="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" id="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_rolling" value="NOW" />\r\n</div>'},useData:!0}),_v.DateTime=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a=null!=t?t:e.nullContext||{},o=i.helperMissing,r="function",l=e.escapeExpression;return'<div class="bbf-datetime">\r\n    <div class="bbf-date-container" data-date></div>\r\n    <select data-type="hour">'+l(typeof(e=null!=(e=i.hours||(null!=t?t.hours:t))?e:o)==r?e.call(a,{name:"hours",hash:{},data:n}):e)+'</select>:\r\n    <select data-type="min">'+l(typeof(e=null!=(e=i.mins||(null!=t?t.mins:t))?e:o)==r?e.call(a,{name:"mins",hash:{},data:n}):e)+"</select>\r\n</div>\r\n"},useData:!0}),_v.DateTimePicker=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a=null!=t?t:e.nullContext||{},o=i.helperMissing,r="function",l=e.escapeExpression;return'<div>\r\n    <input type="text" name="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" id="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" value="" />\r\n</div>'},useData:!0}),_v.DateTimePickerRolling=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a=null!=t?t:e.nullContext||{},o=i.helperMissing,r="function",l=e.escapeExpression;return'<div>\r\n    <label for="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_checkbox"><i class="fa fa-info-circle" title="Specify a date using NOW, T+x or T-x"></i> Rolling</label>\r\n    <input type="checkbox" name="rolling" value="rolling" id="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_checkbox">\r\n    <input type="text" name="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" id="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_date" value="" />\r\n    <input type="text" name="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" id="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_rolling" value="NOW" />\r\n</div>\r\n'},useData:!0}),_v.Dict=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return'<div>\r\n    <ul data-items class="dict-items"></ul>\r\n    <i tabindex="0" class="fa fa-plus dict-button" data-action="add" title="Add" />\r\n</div>'},useData:!0}),_v.DictItem=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return'<li>\r\n    <i tabindex="0" class="fa fa-trash dict-button" data-action="remove" title="Remove" />\r\n    <div class="bbf-dict">\r\n        <span class="bbf-tmp-key"></span>: <span class="bbf-tmp-default"></span><span class="bbf-tmp-value"></span>\r\n    </div>\r\n</li>\r\n'},useData:!0}),_v.Field=Handlebars.template({1:function(e,t,i,s,n){var a;return e.escapeExpression("function"==typeof(a=null!=(a=i.titleHTML||(null!=t?t.titleHTML:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"titleHTML",hash:{},data:n}):a)},3:function(e,t,i,s,n){var a;return e.escapeExpression("function"==typeof(a=null!=(a=i.title||(null!=t?t.title:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:n}):a)},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a,o=null!=t?t:e.nullContext||{},r=i.helperMissing,l="function",c=e.escapeExpression;return'<li class="bbf-field field-'+c(typeof(a=null!=(a=i.key||(null!=t?t.key:t))?a:r)==l?a.call(o,{name:"key",hash:{},data:n}):a)+'">\r\n    <label for="'+c(typeof(a=null!=(a=i.editorId||(null!=t?t.editorId:t))?a:r)==l?a.call(o,{name:"editorId",hash:{},data:n}):a)+'" title="'+c(typeof(a=null!=(a=i.tooltipTitle||(null!=t?t.tooltipTitle:t))?a:r)==l?a.call(o,{name:"tooltipTitle",hash:{},data:n}):a)+'">'+(null!=(e=i.if.call(o,null!=t?t.titleHTML:t,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.program(3,n,0),data:n}))?e:"")+'</label>\r\n    <div class="bbf-editor" data-editor></div>\r\n    <div class="bbf-help">'+c(typeof(a=null!=(a=i.help||(null!=t?t.help:t))?a:r)==l?a.call(o,{name:"help",hash:{},data:n}):a)+'</div>\r\n    <div class="bbf-error" data-error></div>\r\n</li>\r\n'},useData:!0}),_v.Fieldset=Handlebars.template({1:function(e,t,i,s,n){var a;return"    <legend>"+e.escapeExpression("function"==typeof(a=null!=(a=i.legend||(null!=t?t.legend:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"legend",hash:{},data:n}):a)+"</legend>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return"<fieldset>\r\n"+(null!=(n=i.if.call(null!=t?t:e.nullContext||{},null!=t?t.legend:t,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?n:"")+"    <ul data-fields></ul>\r\n</fieldset>"},useData:!0}),_v.List=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return'<div class="bbf-list">\r\n    <ul data-items></ul>\r\n    <div class="bbf-actions"><button type="button" data-action="add"><i class="fa fa-plus" /></button></div>\r\n</div>'},useData:!0}),_v.ListItem=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return'<li>\r\n    <button type="button" data-action="remove" class="bbf-remove"><i class="fa fa-close" /></button>\r\n    <div class="bbf-editor-container" data-editor></div>\r\n</li>'},useData:!0}),_v.ListObject=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a;return'<div class="bbf-list-modal">'+e.escapeExpression("function"==typeof(a=null!=(a=i.summary||(null!=t?t.summary:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"summary",hash:{},data:n}):a)+"</div>"},useData:!0}),_v.Modal=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a;return"<div>"+e.escapeExpression("function"==typeof(a=null!=(a=i.summary||(null!=t?t.summary:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"summary",hash:{},data:n}):a)+"</div>"},useData:!0}),_v.Month=Handlebars.template({1:function(e,t,i,s,n){var a=e.lambda,e=e.escapeExpression;return'                <option value="'+e(a(null!=t?t.value:t,t))+'">'+e(a(null!=t?t.name:t,t))+"</option>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a,o=null!=t?t:e.nullContext||{};return'    <div class="bbf-date">\r\n        <select class="bbf-month" data-type="month">\r\n'+(null!=(a=i.each.call(o,null!=t?t.months:t,{name:"each",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?a:"")+'        </select>\r\n        <select class="bbf-year" data-type="year">\r\n'+(null!=(a=i.each.call(o,null!=t?t.years:t,{name:"each",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?a:"")+"        </select>\r\n    </div>"},useData:!0}),_v.NestedField=Handlebars.template({1:function(e,t,i,s,n){var a;return"        "+e.escapeExpression("function"==typeof(a=null!=(a=i.titleHTML||(null!=t?t.titleHTML:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"titleHTML",hash:{},data:n}):a)+"\r\n"},3:function(e,t,i,s,n){var a;return"        "+e.escapeExpression("function"==typeof(a=null!=(a=i.title||(null!=t?t.title:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"title",hash:{},data:n}):a)+"\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a,o=null!=t?t:e.nullContext||{},r=i.helperMissing,l="function",c=e.escapeExpression;return'<li class="bbf-field bbf-nested-field field-'+c(typeof(a=null!=(a=i.key||(null!=t?t.key:t))?a:r)==l?a.call(o,{name:"key",hash:{},data:n}):a)+'">\r\n    <label for="'+c(typeof(a=null!=(a=i.editorId||(null!=t?t.editorId:t))?a:r)==l?a.call(o,{name:"editorId",hash:{},data:n}):a)+'">\r\n'+(null!=(e=i.if.call(o,null!=t?t.titleHTML:t,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.program(3,n,0),data:n}))?e:"")+'    </label>\r\n    <div class="bbf-editor" data-editor></div>\r\n    <div class="bbf-help">'+c(typeof(a=null!=(a=i.help||(null!=t?t.help:t))?a:r)==l?a.call(o,{name:"help",hash:{},data:n}):a)+'</div>\r\n    <div class="bbf-error" data-error></div>\r\n</li>'},useData:!0}),_v.NewObjectDialog=Handlebars.template({1:function(e,t,i,s,n){var a;return'<div style="padding: 1em;">\r\n    '+e.escapeExpression("function"==typeof(a=null!=(a=i.message||(null!=t?t.message:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"message",hash:{},data:n}):a)+"\r\n</div>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return(null!=(n=i.if.call(null!=t?t:e.nullContext||{},null!=t?t.message:t,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?n:"")+'<div class="bbForm-holder"></div>'},useData:!0}),_v.Radio=Handlebars.template({1:function(e,t,i,s,n){var a,o=null!=t?t:e.nullContext||{},r=i.helperMissing,l="function",c=e.escapeExpression;return'<li>\n<input type="radio" name="'+c(typeof(a=null!=(a=i.name||(null!=t?t.name:t))?a:r)==l?a.call(o,{name:"name",hash:{},data:n}):a)+'" value="'+c(typeof(a=null!=(a=i.value||(null!=t?t.value:t))?a:r)==l?a.call(o,{name:"value",hash:{},data:n}):a)+'" id="'+c(typeof(a=null!=(a=i.id||(null!=t?t.id:t))?a:r)==l?a.call(o,{name:"id",hash:{},data:n}):a)+'" />\n<label for="'+c(typeof(a=null!=(a=i.id||(null!=t?t.id:t))?a:r)==l?a.call(o,{name:"id",hash:{},data:n}):a)+'">'+(null!=(n=i.if.call(o,null!=t?t.labelHTML:t,{name:"if",hash:{},fn:e.program(2,n,0),inverse:e.program(4,n,0),data:n}))?n:"")+"</label>\n</li>\n"},2:function(e,t,i,s,n){var a;return e.escapeExpression("function"==typeof(a=null!=(a=i.labelHTML||(null!=t?t.labelHTML:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"labelHTML",hash:{},data:n}):a)},4:function(e,t,i,s,n){var a;return e.escapeExpression("function"==typeof(a=null!=(a=i.label||(null!=t?t.label:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"label",hash:{},data:n}):a)},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return null!=(n=i.each.call(null!=t?t:e.nullContext||{},null!=t?t.items:t,{name:"each",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?n:""},useData:!0}),_v.ThreeColumnDict=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return'<div>\n    <ul class="dict-legend"><li>Key</li><li>Default</li><li>Value</li></ul>\n    <ul data-items class="dict-items"></ul>\n    <i class="fa fa-plus dict-button" data-action="add" title="Add" />\n</div>'},useData:!0}),_v.TimePicker=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a=null!=t?t:e.nullContext||{},o=i.helperMissing,r="function",l=e.escapeExpression;return'<div>\r\n    <input type="text" name="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" id="date_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" value="" />\r\n</div>'},useData:!0}),_v.TimePickerRolling=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a=null!=t?t:e.nullContext||{},o=i.helperMissing,r="function",l=e.escapeExpression;return'<div>\r\n    <div>\r\n        <label for="time_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_checkbox">\r\n            <i class="fa fa-info-circle" title="Specify a time using NOW, T+x or T-x"></i> \r\n            Rolling\r\n        </label>\r\n        <input type="checkbox" name="rolling" value="rolling" id="time_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_checkbox">\r\n    </div>\r\n    <input type="text" name="time_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" id="time_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_time" value="" />\r\n    <input type="text" name="time_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'" id="time_'+l(typeof(e=null!=(e=i.key||(null!=t?t.key:t))?e:o)==r?e.call(a,{name:"key",hash:{},data:n}):e)+'_rolling" value="NOW" />\r\n</div>'},useData:!0}),_v.ViewState=Handlebars.template({compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){return'<div class="viewstate-control is-viewstate">\r\n    <div class="viewstate-container">\r\n        <i class="fa fa-fw watermark fa-eye viewstate-icon"></i>\r\n        <input type="text" tabindex="-1" readonly " />\r\n    </div>\r\n</div>'},useData:!0}),_v.template=Handlebars.template({1:function(e,t,i,s,n){var a;return'    <button type="button" class="reset">'+e.escapeExpression("function"==typeof(a=null!=(a=i.resetButton||(null!=t?t.resetButton:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"resetButton",hash:{},data:n}):a)+"</button>\r\n"},3:function(e,t,i,s,n){var a;return'    <button type="submit">'+e.escapeExpression("function"==typeof(a=null!=(a=i.submitButton||(null!=t?t.submitButton:t))?a:i.helperMissing)?a.call(null!=t?t:e.nullContext||{},{name:"submitButton",hash:{},data:n}):a)+"</button>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,i,s,n){var a,o=null!=t?t:e.nullContext||{};return'<form class="bbf-form">\r\n    <div data-fieldsets></div>\r\n'+(null!=(a=i.if.call(o,null!=t?t.resetButton:t,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?a:"")+(null!=(a=i.if.call(o,null!=t?t.submitButton:t,{name:"if",hash:{},fn:e.program(3,n,0),inverse:e.noop,data:n}))?a:"")+"</form>"},useData:!0}),_v);function _v(){}Form.template=T.template,Form.Fieldset.template=T.Fieldset,Form.Field.template=T.Field,Form.NestedField.template=T.NestedField,Form.editors.DateTimePicker.template=T.DateTimePicker,Form.editors.DatePicker.template=T.DatePicker,Form.editors.DatePickerRolling.template=T.DatePickerRolling,Form.editors.DateTimePickerRolling.template=T.DateTimePickerRolling,Form.editors.Dict.template=T.Dict,Form.editors.Dict.Item.template=T.DictItem,Form.editors.ThreeColumnDict.template=T.ThreeColumnDict,Form.editors.ThreeColumnDict.Item.template=T.DictItem,Form.editors.Month.template=T.Month,Form.editors.Radio.template=T.Radio,Form.editors.TimePicker.template=T.TimePicker,Form.editors.TimePickerRolling.template=T.TimePickerRolling,Form.editors.ViewState.template=T.ViewState,Form.editors.List&&(Form.editors.List.template=T.List,Form.editors.List.Item.template=T.ListItem,Form.editors.List.Modal=T.Modal,Form.editors.List.Object.template=Form.editors.List.NestedModel.template=T.ListObject),Form.editors.CustomList&&(Form.editors.CustomList.template=T.CustomList,Form.editors.CustomList.Item.template=T.ListItem);var NewObjectDialog=QuickBase.DialogBase.extend({okBtnLabel:"Add",constructor:function(e){QuickBase.DialogBase.prototype.constructor.call(this,_.extend({iconClass:"fa-list-alt",width:400,minHeight:100},e)),e.okBtnLabel&&(this.okBtnLabel=e.okBtnLabel),e.message&&(this.message=e.message)},dialogButtons:function(){var e=this;return[{text:this.okBtnLabel,click:$.proxy(this.onSave,this),icons:{primary:"fa fa-plus"}},{text:"Cancel",click:function(){e.isCancel=!0,e.dialogClose()},icons:{primary:"fa fa-times"}}]},postRender:function(){this.model.schema=this.model.schema||this.appModel.get("dataStore").getFormSchema(this.schemaKey),this.model.schema&&(this.form=new Form({model:this.model}).render(),this.form.$el.keydown(function(e){if(13===e.which)return!1}),this.$el.find(".bbForm-holder").append(this.form.$el),this.onResize(),this.onFormRendered&&this.onFormRendered())},renderTemplate:function(){var e=this.message;return e?T.NewObjectDialog({message:e}):T.NewObjectDialog()},onSave:function(){this.isCancel=!1,this.form.commit(),this.dialogClose()}}),App=Backbone.Form=Form;return Form.RTTI=RTTI,Form.editors.NumberViewState=Form.editors.Number.extend(viewStateMethods(Form.editors.Number)),Form.editors.TextViewState=Form.editors.Text.extend(viewStateMethods(Form.editors.Text)),Form.editors.TimePicker=Form.editors.TimePicker,Form.editors.ListViewState=Form.editors.CustomList.extend({defaultValue:[]}).extend(viewStateMethods(Form.editors.CustomList)).extend({setTextValue:function(e){this.value=e,this.model&&this.model.forceRender&&this.populateListFromValue()}}),Form.NewObjectDialog=NewObjectDialog,Form.ErrorTooltip=ErrorTooltip,App});