define(["Handlebars","echarts","QuickBase","moment","xlsx","backbone","css!./css/app.css"],function(i,r,c,s,e,n){"use strict";var a,o,l=this&&this.__extends||(a=function(e,t){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}a(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),p=this&&this.__assign||function(){return(p=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var a in t=arguments[o])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},u=(o=n.DeepModel,l(h,o),h.prototype.setBreakdown=function(e){this.breakdownCol=e},h.prototype.setTreeMapOpts=function(e){var t=this.get("NodeLabel"),o=t.Show,r=t.BorderColor,a=t.BorderWidth,i=t.gapWidth,n=t.upperLabel,s=t.upperLabelColour,l=t.labelColor,p=t.upperLabelHeight,u=t.upperFontSize,c=(t.MinValue,t.MaxValue,this.get("ColorPalette")),h=c.FixedColor,d=c.HoverColor,t=this.get("GroupBy").headerColor,c=this.get("Animation");return{series:[{animation:c.Duration,animationEasing:c.Easing,breadcrumb:{show:!1},data:e,emphasis:{itemStyle:{color:""===d?null:d}},height:"100%",itemStyle:{normal:{borderColor:t}},label:{color:l,show:o},levels:[{color:[h]},{itemStyle:{normal:{borderColor:r,borderWidth:a,gapWidth:_.clone(i)}}}],nodeClick:"false",roam:"false",type:"treemap",upperLabel:{normal:{color:s,fontSize:u,height:p,show:n}},width:"100%"}]}},h.prototype.getPaletteColor=function(e,t,o){var r,a,i,n,s,l,p,u,c,h,d,m,g,f,y,b,C,S=this.get("ColorPalette"),v=S.ColorScheme,x=S.ColorType,D=S.FixedColor,S=this.get("NodeLabel").Scale,w=_.clone(v);return"Fixed"===x?(u=_.map(this.treeData,function(e){return{type:D}}),r=_.map(u,"type")):"Iterative Children"===x?(u=_.map(this.treeData,function(e){return{type:w[t%w.length].type}}),r=_.map(u,"type")):"Iterative"===x?(r=[],_.each(this.treeData,function(e,t){r.push(w[t%w.length].type)}),r=_.reverse(r)):"Scaled"===x?(a="{breakdownId}"===e.Size?this.breakdownCol:e.Size,i="{breakdownId}"===e.Color?this.breakdownCol:e.Color,f=_.map(this.treeData,function(e){return{color:isNaN(parseFloat(e.get(i)))?0:parseFloat(e.get(i)),size:isNaN(parseFloat(e.get(a)))?0:parseFloat(e.get(a))}}),n=this.getMinVal(f,"color"),s=this.getMaxVal(f,"color"),f=S?_.reverse(_.sortBy(f,"size")):_.reverse(f),r=n===s?D:_.map(f,function(e){return I.getHexSaturation(D,(e.color-n)/(s-n))})):"Gradient"===x?(l="{breakdownId}"===e.Size?this.breakdownCol:e.Size,p="{breakdownId}"===e.Color?this.breakdownCol:e.Color,u=this.treeData,f=_.map(u,function(e){return{color:isNaN(parseFloat(e.get(p)))?0:parseFloat(e.get(p)),size:isNaN(parseFloat(e.get(l)))?0:parseFloat(e.get(l))}}),c=this.getMinVal(f,"color"),h=this.getMaxVal(f,"color"),o&&(f=this.getGrouping(f,o,p,l)),d=_.map(w,"type"),f=S?_.reverse(_.sortBy(f,"size")):_.reverse(f),r=_.map(f,function(e){e=.99<(e=(e.color-c)/(h-c))?.99:e,e=isNaN(e*d.length)?0:Math.floor(e*d.length);return d[e]})):"Gradient Percentage"===x&&(m="{breakdownId}"===e.Size?this.breakdownCol:e.Size,g="{breakdownId}"===e.Color?this.breakdownCol:e.Color,f=_.map(this.treeData,function(e){return{color:isNaN(parseFloat(e.get(g)))?0:parseFloat(e.get(g)),size:isNaN(parseFloat(e.get(m)))?0:parseFloat(e.get(m))}}),x=this.get("NodeLabel"),y=x.MinValue,b=x.MaxValue,o&&(f=this.getGrouping(f,o,g,m)),C=_.map(w,"type"),f=_.reverse(_.sortBy(f,"size")),r=_.map(f,function(e){return C[Math.floor((e.color-y)/(b-y)*(C.length-1))]})),this.getHighlightRules(r,e,t)},h.prototype.getHighlightRules=function(e,t,s){var l=this,o=t.HighlightRules,p=e,u=[],c=this.get("NodeLabel").Scale;return _.each(o,function(o,e){var e=l.get("Data."+s+".HighlightRules."+e),r=e.BackgroundColor,a=e.ConditionOperator,i=e.ConditionSource,n=e.ConditionValue,e=c?_.sortBy(l.treeData,[function(e){return parseFloat(e.get(t.Size))}]):l.treeData;_.each(_.reverse(e),function(e,t){u[t]||u.push(_.isString(p)?p:p[t]),u[t]=I.getConditionResult(e.get("{breakdownId}"===i?l.breakdownCol:i),n,a,o.Inverse)?l.blendColors(u[t],r,o.Opacity/100):u[t]})}),0===u.length?e:u},h.prototype.getTreeData=function(e,t){var n,s=this,o=this.get("NodeLabel"),l=o.Scale,r=o.customLabel,p=this.get("ColorPalette").ColorType,a=this.collection.models[0].get("GroupBy"),o=a.UseGroupBy,u=a.ShowHeader,c=a.GroupByColumns,h=a.ScaleByChildren;if(this.treeData=t,n=void 0!==r&&""!==r?i.compile(r):function(e){},o){var d=t.map(function(e){e=e.get(c);return s.setGeneralFormat(e)}).filter(function(e,t,o){return o.indexOf(e)===t});return _.map(e,function(a,o){var i=2*Math.abs(_.min(_.map(t,function(e){return parseFloat(e.get(a.Size))})));return{children:_.map(d,function(r){return{children:_.map(t,function(e,t){return s.getNodeObject(l,e,t,a,s.breakdownCol,p,n,c,r,i,o)}),color:s.getPaletteColor(a,o,r),name:r,upperLabel:{show:u},value:h?_.reduce(t,function(e,t,o){return e+s.getNodeValue(l,t,a.Size,s.breakdownCol,p,c,r,i)},0):1}}),name:a.Name,value:1}})}return _.map(e,function(o,r){var a=2*Math.abs(_.min(_.map(t,function(e){return parseFloat(e.get(o.Size))})));return{children:_.map(t,function(e,t){return s.getNodeObject(l,e,t,o,s.breakdownCol,p,n,void 0,void 0,a,r)}),color:s.getPaletteColor(o,r,null),name:o.Name,value:1}})},h.prototype.setFormat=function(e){var t=this.get("NodeLabel"),o=t.Format,r=t.Precision,a=t.HideTrailingZeroes,i=t.PieceLabelRender,n=t.Prefix,t=t.Suffix;return n+I.getFormatter(o,r,a,i)(e)+t},h.prototype.blendColors=function(e,t,o){var r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),t=[parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16)],r=[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)],e=[];return e[0]=Math.round(r[0]*o+t[0]*(1-o)),e[1]=Math.round(r[1]*o+t[1]*(1-o)),e[2]=Math.round(r[2]*o+t[2]*(1-o)),"#"+this.componentToHex(e[0])+this.componentToHex(e[1])+this.componentToHex(e[2])},h.prototype.componentToHex=function(e){e=e.toString(16);return 1===e.length?"0"+e:e},h.prototype.getGrouping=function(e,t,o,r){this.treeData;var a="{breakdownId}"===(a=this.get("GroupBy.GroupByColumns"))?this.breakdownCol:a,i=_.filter(this.treeData,function(e){return e.get(a)===t});return _.map(i,function(e){return{color:isNaN(parseFloat(e.get(o)))?0:parseFloat(e.get(o)),size:isNaN(parseFloat(e.get(r)))?0:parseFloat(e.get(r))}})},h.prototype.getMinVal=function(e,t){e=_.minBy(e,function(e){return e[t]});return _.get(e,t)?_.get(e,t):null},h.prototype.getMaxVal=function(e,t){e=_.maxBy(e,function(e){return e[t]});return _.get(e,t)?_.get(e,t):null},h.prototype.getNodeValue=function(e,t,o,r,a,i,n,s){return void 0!==i?this.setGeneralFormat(t.get(i))===n?this.getNodeValue(e,t,o,r,a,void 0,void 0,s):0:e||"Scaled"===a?(this.get("NodeLabel.ShowAbsolute")?s:0)+parseFloat(t.get(this.getColumn(o,r))):1},h.prototype.getNodeObject=function(e,t,o,r,a,i,n,s,l,p,u){p=this.getNodeValue(e,t,r.Size,a,i,s,l,p);return{displayVal:this.getNodeValue(e,t,r.Size,a,i,s,l,0),id:o,label:{formatter:n(t.attributes)},name:this.setFormat(t.get(this.getColumn(r.Column,a))),parentId:u,value:p}},h.prototype.setGeneralFormat=function(e){return I.getFormatter("General",void 0,void 0,void 0)(e)},h.prototype.getColumn=function(e,t){return"{breakdownId}"!==e?e:t},h);function h(){var e=null!==o&&o.apply(this,arguments)||this;return e.colorCache={},e.columns=[],e.labels=[],e.labelData=[],e.previousChartData={},e.chartType="treeMap",e}var d,m=(d=n.Collection,l(g,d),g.prototype.modelId=function(e){return e},g);function g(){var e=null!==d&&d.apply(this,arguments)||this;return e.model=u,e}var f=(y.sourceKey=function(e){return e.getPath()},y.mergeChanges=function(t,o,e,r,a,i){return e&&(t=_.fromPairs(_.map(e,function(e){return[o(e),e]}))),r&&_.each(r,function(e){return _.extend(t[o(e)],e)}),a&&_.each(a,function(e){t[o(e)]=e}),i&&_.each(i,function(e){delete t[o(e)]}),t},y.prototype.setFocus=function(e){this.focus=e,this.updateChildren(),this.childDataSource&&this.childDataSource.setFocus(e)},y.prototype.isFocused=function(){return this.focus.length===this.depth&&(0===this.depth||this.source.id===this.focus[this.depth])},y.prototype.getColumnNames=function(){if(this.breakdownColumns&&this.breakdownColumns.length)return[y.BREAKDOWN_ID,this.breakdownColumns[0]].concat(_.difference(_.keys(this.meta),this.breakdownColumns));try{return _.map(this.meta,function(e){return[e.id,e.index]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}catch(e){return _.keys(this.meta)}},y.prototype.getColumnType=function(e){return this.childDataSource?this.childDataSource.getColumnType(e):e===y.BREAKDOWN_ID?this.meta[this.primaryKey].kdbType:this.meta[e]?this.meta[e].kdbType:11},y.prototype.getData=function(){return this.childDataSource?this.childDataSource.getData():this.source.dataSet&&this.source.dataSet.collection},y.prototype.getDepth=function(){return this.childDataSource?this.childDataSource.getDepth():this.depth},y.prototype.getKey=function(){return this.source.cid},y.prototype.getPrimaryKey=function(){return this.childDataSource?this.childDataSource.getPrimaryKey():this.primaryKey},y.prototype.getPropertyFromColumn=function(e){return e===y.BREAKDOWN_ID?this.getPrimaryKey():e},y.prototype.getPath=function(){return this.source.path},y.prototype.getSource=function(){return this.source},y.prototype.hasData=function(){return this.childDataSource?this.childDataSource.hasData():this.hasDataFlag},y.prototype.onData=function(e,t,o){e.primaryKey!==this.primaryKey&&(this.primaryKey=e.primaryKey),this.meta=y.mergeChanges(this.meta,function(e){return e.id},e.columns.reset,e.columns.change,e.columns.add,e.columns.remove),0!==this.depth||_.isEqual(e.breakdownColumns,this.breakdownColumns)||(this.breakdownColumns=e.breakdownColumns,this.removeChild()),t.reset&&0<t.reset.length&&this.removeChild(),o?this.updateError(this,o):this.listener&&this.listener.updateError(this,void 0),this.hasDataFlag=!0,this.updateChildren()&&this.listener.updateDataSource(this)},y.prototype.subscribe=function(){this.api.subscribe(this.source,this.onData.bind(this))},y.prototype.updateDataSource=function(e){this.listener.updateDataSource(this)},y.prototype.updateError=function(e,t){this.listener.updateError(this,t)},y.prototype.unsubscribe=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource),this.api.unsubscribe(this.source)},y.prototype.removeChild=function(){this.childDataSource&&(this.childDataSource.unsubscribe(),delete this.childDataSource)},y.prototype.updateChildren=function(){var e;return!(this.breakdownColumns&&this.breakdownColumns.length&&this.depth<this.breakdownColumns.length-1)||(this.focus.length>this.depth?(this.childDataSource&&this.focus[this.depth]!==this.childDataSource.getSource().id&&this.removeChild(),this.childDataSource||(e=this.source.dataSet&&this.source.dataSet.collection.get(this.focus[this.depth]))&&(this.childDataSource=new y(e,this,this.api,this.focus,this.depth+1,this.breakdownColumns),this.childDataSource.subscribe())):(this.removeChild(),this.focus.length!==this.depth||!this.hasDataFlag||0!==this.depth&&this.focus[this.depth-1]!==this.source.id||this.listener.updateDataSource(this)),!1)},y.BREAKDOWN_ID="{breakdownId}",y);function y(e,t,o,r,a,i){this.breakdownColumns=[],this.hasDataFlag=!1,this.focus=[],this.meta={},this.source=e,this.listener=t,this.api=o,this.depth=a||0,this.breakdownColumns=i,this.setFocus(r)}var b,C=(b=n.DeepModel,l(S,b),S);function S(){return null!==b&&b.apply(this,arguments)||this}var v,x=(v=n.DeepModel,l(D,v),D);function D(){return null!==v&&v.apply(this,arguments)||this}var w,k=(w=n.DeepModel,l(F,w),F);function F(){return null!==w&&w.apply(this,arguments)||this}var E,T=(E=n.DeepModel,l(O,E),O);function O(){return null!==E&&E.apply(this,arguments)||this}var B,N=(B=n.DeepModel,l(M,B),M);function M(){return null!==B&&B.apply(this,arguments)||this}var I=(P.compareKDBTimes=function(e,t){return e.i>t.i?1:e.i<t.i?-1:e.n>t.n?1:e.n<t.n?-1:0},P.expandNestedViewStates=function(e,t){var o,r=!1,a=Object.keys(e);if(r=1===a.length?(o=t.getPropertyMeta(a[0]))&&"viewstate"===o.type:r){r=/^((?:\w+\.)*)(\d+)/.exec(a[0]);if(r){a=r[1].slice(0,-1),r=t.getProperty(a),t={};return t[a]=r,t}}return e},P.focus2Array=function(e){var t=[],o=/"([^"]*)"/g,e=e.toString?e.toString():"",r=/^\[([^\]]*)]$/.exec(e);if(null!=r){if(/^(?:"[^"\\]*(?:\\[\S\s][^"\\]*)*")(?:,"[^"\\]*(?:\\[\S\s][^"\\]*)*")*/.test(r[1]))for(var a=void 0;null!==(a=o.exec(r[1]));)t.push(_.map(a[1].split(","),function(e){return e.replace(/&#44;/g,",")}))}else t.push(e.split(","));return _.filter(t,function(e){return 0<(""+e).length})},P.getConditionResult=function(e,t,o,r){var i={isMatch:function(e,t){var o,r=!1,a=e.split(/ +and +| +/);for(_.includes(a,"or")&&(a=_.without(a,"or"),r=!0),o=0;o<a.length;o++)0!==a[o].indexOf("-")&&a[o].indexOf("*")<0&&(a[o]="*"+a[o]+"*");return _[r?"some":"every"](a,function(e){return i.isSimpleMatch(e,t)})},isSimpleMatch:function(e,t){var o=!1;return 0===e.indexOf("-")&&(e=e.replace("-",""),o=!0),t=new RegExp("^"+e.replace(/\*/g,".*")+"$").test(t),o?!t:t}},a=!1,n=isNaN(parseFloat(e))?(""+e).toLowerCase():parseFloat(e),s=isNaN(parseFloat(t))?(""+t).toLowerCase():parseFloat(t);switch(o){case"contains":a=0<=n.toString().indexOf(s.toString());break;case"starts with":a=0===n.toString().indexOf(s.toString());break;case"ends with":a=-1!==n.toString().indexOf(s.toString(),n.toString().length-s.toString().length);break;case"==":a=n==s;break;case"<":a=n<s;break;case">":a=s<n;break;case"<=":a=n<=s;break;case">=":a=s<=n;break;case"!=":a=n!==s;break;case"search":a=i.isMatch(s,n);break;case"regexp":a=new RegExp(t.toString()).test(e.toString())}return a=r?!a:a},P.getHexSaturation=function(e,t){var o,r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),a=parseInt(r[1],16),i=parseInt(r[2],16),n=parseInt(r[3],16),s=Math.max(a,i,n),e=Math.min(a,i,n),l=s,p=s-e;if(s===e)o=0;else{switch(s){case a:o=(i-n)/p+(i<n?6:0);break;case i:o=(n-a)/p+2;break;case n:o=(a-i)/p+4}o/=6}r=.2+.8*t;var s=Math.floor(6*o),t=6*o-s,u=l*(1-r),c=l*(1-t*r),h=l*(1-(1-t)*r);switch(s%6){case 0:a=l,i=h,n=u;break;case 1:a=c,i=l,n=u;break;case 2:a=u,i=l,n=h;break;case 3:a=u,i=c,n=l;break;case 4:a=h,i=u,n=l;break;case 5:a=l,i=u,n=c}return a=parseInt(a.toString(),10),i=parseInt(i.toString(),10),n=parseInt(n.toString(),10),"#"+this.componentToHex(a)+this.componentToHex(i)+this.componentToHex(n)},P.getSaturatedArray=function(e){var l,p,u=this,t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),o=parseInt(t[1],16),r=parseInt(t[2],16),a=parseInt(t[3],16),e=Math.max(o,r,a),t=Math.min(o,r,a),c=e,i=e-t;if(e===t)l=0;else{switch(e){case o:l=(r-a)/i+(r<a?6:0);break;case r:l=(a-o)/i+2;break;case a:l=(o-r)/i+4}l/=6}var h=[];return _.each([.2,.28,.36,.44,.52,.6,.68,.76,.84,.92,.1],function(e){var t,o,r;p=e;var a=Math.floor(6*l),e=6*l-a,i=c*(1-p),n=c*(1-e*p),s=c*(1-(1-e)*p);switch(a%6){case 0:t=c,o=s,r=i;break;case 1:t=n,o=c,r=i;break;case 2:t=i,o=c,r=s;break;case 3:t=i,o=n,r=c;break;case 4:t=s,o=i,r=c;break;case 5:t=c,o=i,r=n}t=parseInt(t,10),o=parseInt(o,10),r=parseInt(r,10),h.push("#"+u.componentToHex(t)+u.componentToHex(o)+u.componentToHex(r))}),h},P.componentToHex=function(e){e=e.toString(16);return 1===e.length?"0"+e:e},P.getFormatter=function(r,a,i,n){return"Number"===r||"Formatted Number"===r||"Smart Number"===r||"Datetime"===r||"Currency"===r||"SmartCurrency"===r?function(e){var t=e;if(null==(e=!("Smart Number"!==r&&"Formatted Number"!==r||_.isNumber(e))?_.isNumber(parseFloat(e))?parseFloat(e):e:e)||null==e)return"";if("Smart Number"===r)t=_.isNumber(e)?q.smartFormatNumber(e,a):_.escape(e);else{if("Datetime"===r){var o=e;return s.isMoment(e)||s.isDuration(e)?e.format(n):q.isKDBTemporal(e)?q.convertKDBTemporalToMoment(e).format(n):("number"==typeof e&&(o=new Date(e)),q.convertDateStringValueToMoment(o.toString()).format(n))}t="Formatted Number"===r&&e.toFixed?q.formatNumber(e,a):e.toFixed?e.toFixed(a):_.escape(t)}if(i&&0<=t.toString().indexOf(".")){for(;"0"===t[t.length-1];)t=t.slice(0,-1);"."===t[t.length-1]&&(t=t.slice(0,-1))}return t}:"General"===r?function(e){return s.isMoment(e)||s.isDuration(e)?e.format():e}:"Boolean"===r?function(e){return _.escape(e)}:void 0},P.pump=function(o){if(null!=o&&void 0!==o){if(!_.isObject(o))return o;var e=Object.getPrototypeOf(o);if(_.isObject(o)&&e!==Object.prototype&&e!==Array.prototype)return o;if(e===Array.prototype)return o.map(P.pump);var r=/^(\d+)((?:\.\w+)+)$/;if(Object.keys(o).every(function(e){return r.test(e)}))return Object.keys(o).map(function(e){var t=r.exec(e);return{index:Number(t[1]),tail:t[2].substring(1),value:o[e]}}).reduce(function(e,t){var o={};return o[t.index]={},o[t.index][t.tail]=t.value,$.extend(!0,e,P.pump(o))},[]);var a={greedy:/^(\w+)((?:\.\w+)*)$/,nonGreedy:/^(\w+)((?:\.\w+)+)$/};return Object.keys(o).some(function(e){return a.nonGreedy.test(e)})?Object.keys(o).map(function(e){var t=a.greedy.exec(e);return{head:t[1],tail:""!==t[2]?t[2].substring(1):null,value:o[e]}}).reduce(function(e,t){var o={};return null!==t.tail?(o[t.head]={},o[t.head][t.tail]=t.value):o[t.head]=t.value,$.extend(!0,e,P.pump(o))},{}):_.mapValues(o,P.pump)}},P.replaceViewStatesWithValue=function(e,t,o){return P.replaceViewStates(e,t,function(e,t,o,r){return r.value},o)},P.replaceViewStatesWithModel=function(e,t,a){return P.replaceViewStates(e,t,function(e,t,o,r){if(o instanceof n.Model&&o.get("_viewType"))return o;t=a.getProperty(e)[t];return _.isUndefined(o)?void 0:(t.get("value")!==o&&t.set("value",o),t)},a)},P.safeHandle=function(o){return function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{o.apply(this,e)}catch(e){}}},P.alpha=function(e,t){return new Color(e).alpha(t/100).rgbaString()},P.replaceViewStates=function(o,e,s,l){var p=function(e,t){return function o(e,t,r){r=r?r+".":"";t+="";var a=l.getPropertyMeta(r+t);{if(a&&"data"===a.type)return e;if(a&&"viewstate"===a.type){var i=(r+t).split("."),n=i.pop(),i=i.join(".");return s(i,n,e,a)}return!_.isArray(e)&&!_.isObject(e)||e.has&&e.has("_dataSource")&&e.has("_dataType")?e:(r+=t,p=function(e,t){return o(e,t,r)},(u=_.isArray(e)?_.map:_.mapValues)(e,p))}}(e,t,o||"")},u=_.isArray(e)?_.map:_.mapValues;return u(e,p)},P);function P(){}var L={Trigger:{default:"Click",enum:["Click","Hover","Double Click"],propertyOrder:2,title:"Trigger Action",type:"string"},TriggerColumn:{default:"",enumSource:"possible_columns",propertyOrder:1,title:"Trigger Column",type:"string",watch:{possible_columns:"root.possibleLabels"}}},H=(A.getSchemes=function(){return{"blue green":[{type:"#5680bf"},{type:"#5792bd"},{type:"#629fc7"},{type:"#63b0c7"},{type:"#63c7c7"},{type:"#65c2af"},{type:"#54bf9d"},{type:"#5dbd86"},{type:"#69bf74"},{type:"#67b860"}],default:[{type:"#0061FF"},{type:"#F23A66"},{type:"#009BAB"},{type:"#7647CC"},{type:"#FFC300"},{type:"#9FA3A6"},{type:"#003A99"},{type:"#A90B31"},{type:"#005D67"},{type:"#452481"}],"green blue":[{type:"#67b860"},{type:"#69bf74"},{type:"#5dbd86"},{type:"#54bf9d"},{type:"#65c2af"},{type:"#63c7c7"},{type:"#63b0c7"},{type:"#629fc7"},{type:"#5792bd"},{type:"#5680bf"}],"green red":[{type:"#63BE7B"},{type:"#86C97E"},{type:"#A9D27F"},{type:"#CCDD82"},{type:"#EEE683"},{type:"#FEDC81"},{type:"#FCBF7B"},{type:"#FBA276"},{type:"#F98570"},{type:"#F8696B"}],"green yellow":[{type:"#83c478"},{type:"#8ad67c"},{type:"#97e388"},{type:"#b1e396"},{type:"#cbe396"},{type:"#e2e398"},{type:"#e8de88"},{type:"#ebdc6c"},{type:"#f2df4b"},{type:"#f7da36"}],"red green":[{type:"#F8696B"},{type:"#F98570"},{type:"#FBA276"},{type:"#FCBF7B"},{type:"#FEDC81"},{type:"#EEE683"},{type:"#CCDD82"},{type:"#A9D27F"},{type:"#86C97E"},{type:"#63BE7B"}],"yellow green":[{type:"#f7da36"},{type:"#f2df4b"},{type:"#ebdc6c"},{type:"#e8de88"},{type:"#e2e398"},{type:"#cbe396"},{type:"#b1e396"},{type:"#97e388"},{type:"#8ad67c"},{type:"#83c478"}]}},A.getComponentDefinition=function(e){var t,o,r={appArgs:{quickStart:[{path:"Basics.Data",message:"populate Data Source"}],json:{Animation:{Duration:1500,Easing:"quinticInOut"},Basics:{Actions:[],Data:"",Focus:"",Selected:"",SelectedAttr:"",Theme:"Dark"},ColorPalette:{ColorScheme:A.getSchemes()["red green"],ColorType:"Fixed",FixedColor:"#0061FF",HoverColor:"",SelectedColor:"",SelectedColorScheme:"red green"},Data:[{Color:"",Column:"",HighlightRules:[],Name:"",Size:""}],FileExport:{FileName:[],ShowExportCsvButton:!1,ShowExportExcelButton:!1,ShowScreenshot:!1},GroupBy:{GroupByColumns:"",ScaleByChildren:!1,ShowHeader:!1,UseGroupBy:!1,headerColor:"#ffffff"},NodeLabel:{BorderColor:"#f0f0f0",BorderWidth:2,DateFormat:"HHHH-MM-DD",Format:"General",HideTrailingZeros:!1,MaxValue:100,MinValue:0,Precision:0,Prefix:"",Scale:!0,Show:!0,ShowAbsolute:!1,ShowLegend:!0,Suffix:"",customLabel:"",gapWidth:2,labelColor:"#ffffff",upperFontSize:"12",upperLabel:!1,upperLabelColour:"#000",upperLabelHeight:"15"},Tooltip:{ShowTooltip:!0,TooltipTemplate:'<table><thead><tr style="padding-right: 10px;"><th>{{_name}}</th><th></th></tr></thead><tr><td><svg style="padding: 0 5px; vertical-align: middle;" width="12" height="12"><rect width="12" height="12"style="fill: {{_color}} ;stroke-width:3;stroke: {{_color}}"></rect></svg>{{_label}}:</td><td style="padding-right: 10px; text-align: left;"><span style="padding-left:10px">{{_value}}</span></td></tr></table>'},possibleColumns:[""],possibleLabels:[""],version:"4.5.0"},schema:{notificationEvent:{default:["sym"],format:"table",items:{type:"string"},options:{collapsed:!0,hidden:!0},type:"array"},properties:{possibleColumns:{default:["sym"],format:"table",items:{type:"string"},options:{collapsed:!0,hidden:!0},propertyOrder:2,type:"array"},possibleLabels:{default:["sym"],format:"table",items:{type:"string"},options:{collapsed:!0,hidden:!0},propertyOrder:1,type:"array"},possibleRules:{default:[],format:"table",items:{type:"string"},options:{collapsed:!0,hidden:!0},propertyOrder:1,type:"array"},Basics:{options:{collapsed:!1},properties:{Actions:{fields:{map:_.extend({Current:{enumSource:"possible_columns",title:"Source",type:"string",watch:{possible_columns:"root.possibleColumns"}}},L),nav:L,query:L,url:L},options:{collapsed:!0},type:"actions"},DashboardTheme:{options:{hidden:!0}},Data:{default:"",format:"string",propertyOrder:1,title:"Data Source",type:"data"},FixedColumn:{title:"Column Def",type:"string"},Focus:{default:"",propertyOrder:4,title:"Focus",type:"viewstate"},Selected:{default:"",propertyOrder:3,title:"Selected Value",type:"viewstate"},SelectedAttr:{enumSource:"possible_labels",propertyOrder:2,title:"Selected Value Attribute",type:"string",watch:{possible_labels:"root.possibleLabels"}},Theme:{enum:["Light","Dark"],options:{hidden:!0},title:"Theme",type:"string"}},propertyOrder:3,title:"Basics",type:"object"},Data:{format:"object",items:{properties:{Color:{default:"",enumSource:"possibleColumns",propertyOrder:3,title:"Color",type:"string",watch:{possibleColumns:"root.possibleColumns"}},Column:{default:"",enumSource:"possibleColumns",propertyOrder:2,title:"Column",type:"string",watch:{possibleColumns:"root.possibleColumns"}},HighlightRules:{format:"object",items:{headerTemplate:"Rule {{ i1 }} {{self.Name}}",options:{collapsed:!0},properties:{BackgroundColor:{default:"",options:{gradient:!0,noColor:!0},title:"Background Color",type:"gradient"},ConditionOperator:{default:"",enum:["","search","contains","starts with","ends with","==","<",">","<=",">=","!=","Fill Left-to-Right","Fill Right-to-Left"],title:"Condition Operator",type:"string"},ConditionSource:{default:"",enumSource:"possibleColumns",title:"Condition Source",type:"string",watch:{possibleColumns:"root.possibleColumns"}},ConditionValue:{default:"previous value",title:"Condition Value",type:"string"},Inverse:{default:!1,format:"checkbox",title:"Inverse",type:"boolean"},Opacity:{default:100,format:"range",maximum:100,minimum:0,title:"Opacity",type:"number"}},propertyOrder:5,title:"Rule",type:"object"},options:{collapsed:!0,hidden:!1},title:"Highlight Rules",type:"array"},Name:{propertyOrder:1,title:"Name",type:"string"},Size:{default:"",enumSource:"possibleColumns",propertyOrder:3,title:"Size",type:"string",watch:{possibleColumns:"root.possibleColumns"}}},title:"Column",type:"object"},options:{collapsed:!0,reset:!0},propertyOrder:4,title:"Data",type:"array",uniqueItems:!1},ColorPalette:{options:{collapsed:!0},properties:{ColorScheme:{format:"table",items:{properties:{type:{default:"#0061FF",options:{gradient:!1},title:"Color",type:"gradient"}},title:"Color",type:"object"},options:{collapsed:!1},propertyOrder:5,title:"Color Scheme",type:"array",uniqueItems:!1},ColorType:{enum:["Fixed","Iterative","Iterative Children","Scaled","Gradient","Gradient Percentage"],propertyOrder:1,title:"Coloring",type:"string"},FixedColor:{propertyOrder:2,title:"Fixed Color",type:"gradient"},HoverColor:{options:{gradient:!1,noColor:!0},propertyOrder:3,title:"Hover Color",type:"gradient"},SelectedColor:{options:{gradient:!1,noColor:!0},propertyOrder:3,title:"Selected Color",type:"gradient"},SelectedColorScheme:{default:"red green",enum:["default","red green","green red","green yellow","yellow green","blue green","green blue"],propertyOrder:4,title:"Color Scheme Defaults",type:"string"}},propertyOrder:5,title:"Color Palette",type:"object"},NodeLabel:{options:{collapsed:!0},properties:{BorderColor:{propertyOrder:20,title:"Border Color",type:"gradient"},BorderWidth:{default:"0",propertyOrder:19,title:"Border Width",type:"number"},DateFormat:{default:"YYYY-MM-DD",enum:["YYYY-MM-DD","YYYY-MMM-DD","YYYY-MMMM-DD","YYYY-MM","YYYY-MMM","YYYY-MMMM","MMM DD","MMM Do","YYYY-MM-DD HH:mm:ss","YYYY-MM-DD hh:mm:ss","YYYY-MM-DD kk:mm:ss","hh:mm:ss","kk:mm:ss","hh:mm:ss.SS","hh:mm","kk:mm","mm:ss","mm:ss.SS"],propertyOrder:3,title:"Date/Time format",type:"string"},Format:{enum:["General","Number","Smart Number","Formatted Number","Datetime"],propertyOrder:2,title:"Format",type:"string"},HideTrailingZeros:{default:!1,format:"checkbox",propertyOrder:4,title:"Hide Trailing Zeros",type:"boolean"},MaxValue:{default:100,propertyOrder:9,title:"Max Value",type:"number"},MinValue:{default:0,propertyOrder:10,title:"Min Value",type:"number"},Precision:{default:2,format:"number",maximum:10,minimum:0,propertyOrder:5,title:"Precision",type:"number"},Prefix:{default:"",propertyOrder:6,title:"Prefix",type:"string"},Scale:{format:"checkbox",title:"Scale Node Size",type:"boolean"},Show:{format:"checkbox",propertyOrder:1,title:"Show Label",type:"boolean"},ShowAbsolute:{format:"checkbox",propertyOrder:12,title:"Show Absolute",type:"boolean"},ShowLegend:{format:"checkbox",propertyOrder:13,title:"Show Legend",type:"boolean"},Suffix:{default:"",propertyOrder:7,title:"Suffix",type:"string"},customLabel:{default:"",propertyOrder:8,title:"Custom Label",type:"handlebar"},gapWidth:{default:"0",propertyOrder:18,title:"Gap Width",type:"number"},labelColor:{default:"#ffffff",propertyOrder:2,title:"Label Color",type:"gradient"},upperFontSize:{default:"12",enum:["12","14","16","18","20","22","24","26","28"],propertyOrder:17,title:"Header Font Size",type:"string"},upperLabel:{default:!0,format:"checkbox",propertyOrder:14,title:"Show Node Header",type:"boolean"},upperLabelColour:{propertyOrder:15,title:"Header Font Colour",type:"gradient"},upperLabelHeight:{format:"range",maximum:"30",minimum:"12",propertyOrder:16,title:"Header Height",type:"number"}},propertyOrder:6,title:"Node",type:"object"},Tooltip:{options:{collapsed:!0},properties:{ShowTooltip:{format:"checkbox",title:"Show Tooltip",type:"boolean"},TooltipTemplate:{title:"Custom Template",type:"tooltipTemplate"}},propertyOrder:7,title:"Tooltip",type:"object"},GroupBy:{options:{collapsed:!0},properties:{GroupByColumns:{default:"",enumSource:"possibleColumns",title:"Group By",type:"string",watch:{possibleColumns:"root.possibleColumns"}},ScaleByChildren:{format:"checkbox",title:"Scale By Children",type:"boolean"},ShowHeader:{format:"checkbox",title:"Show Group By Header",type:"boolean"},UseGroupBy:{format:"checkbox",title:"Use Group By",type:"boolean"},headerColor:{title:"Header Color",type:"gradient"}},propertyOrder:8,title:"Group By",type:"object"},Style:{options:{collapsed:!0},properties:{advanced:{default:"",propertyOrder:14,title:"Advanced CSS",type:"css"}},propertyOrder:11,title:"Style",type:"object"},Animation:{options:{collapsed:!0},properties:{Duration:{default:"1500",format:"range",maximum:"3000",minimum:"0",title:"Duration",type:"number"},Easing:{default:"quinticInOut",enum:["linear","quadraticIn","quadraticOut","quadraticInOut","cubicIn","cubicOut","cubicInOut","quarticIn","quarticOut","quarticInOut","quinticIn","quinticOut","quinticInOut","sinusoidalIn","sinusoidalOut","sinusoidalInOut","exponentialIn","exponentialOut","exponentialInOut","circularIn","circularOut","circularInOut","elasticIn","elasticOut","elasticInOut","backIn","backOut","backInOut","bounceIn","bounceOut","bounceInOut"],title:"Animation Effect",type:"string"}},propertyOrder:9,title:"Animation",type:"object"},FileExport:{options:{collapsed:!0},properties:{FileName:{format:"table",items:{options:{collapsed:!0},properties:{FileNamePart:{title:"FileName Part",type:"string"}},title:"Filename Part",type:"object"},options:{collapsed:!0,hidden:!1},title:"FileName",type:"array"},ShowExportCsvButton:{default:!1,format:"checkbox",title:"Show Export Csv Button",type:"boolean"},ShowExportExcelButton:{default:!1,format:"checkbox",title:"Show Export Excel Button",type:"boolean"},ShowFullExportButton:{default:!1,format:"checkbox",options:{hidden:!0},title:"Show Full Export Button",type:"boolean"},ShowScreenshot:{default:!1,format:"checkbox",title:"Show Screenshot Button",type:"boolean"}},propertyOrder:10,title:"File Export",type:"object"}},title:"properties",type:"object"}},componentDescription:"",componentName:"Treemap",id:1,version:"4.5.0"};if(0<_.keys(e.settingsModel.attributes).length)for(o=A.upgrades.indexOf(_.find(A.upgrades,{version:e.settingsModel.get("version")}))+1;o<A.upgrades.length;o+=1)(t=A.upgrades[o]).fn(e.settingsModel),e.settingsModel.set("version",t.version);return r},A);function A(){}H.upgrades=[{fn:function(a){var e=a.get("Data"),t=a.get("Group"),o=a.get("Style"),r=a.get("Data.0.KeyByDisplay"),i=a.get("Basics.ColorScale"),n=a.get("Style.percentage"),s=a.get("Data.0.Color"),l=a.get("SelectedNode.SelectedColor"),p=a.get("Basics.ShowScaleLegend"),u=a.get("Format.labelFormat"),c=a.get("Style.ColorText"),h=a.get("Style.HeaderColorText"),d=a.get("Style.advancedLabel"),m=a.get("Style.min"),g=a.get("Style.max"),f=a.get("Basics.SizeScale"),y=!a.get("Style.hideTooltips");t&&(b={GroupByColumns:t.Data,ScaleByChildren:!1,ShowHeader:t.ShowHeader,UseGroupBy:t.IsGroupBy,headerColor:h},a.set("GroupBy",b));var h=a.get("heatmap_possibleColumns"),b=a.get("heatmap_possibleLabels");h&&(a.set("possibleRules",h),a.set("possibleColumns",h)),h&&a.set("possibleLabels",b);h="Fixed",b="#0061FF";r&&(h="Iterative"),i&&(h="Gradient"),!1===n&&(h="Gradient Percentage"),s&&(b=a.get("Data.0.Color"));l={ColorScheme:o.colorScale,ColorType:h,FixedColor:b,HoverColor:"",SelectedColor:l,SelectedColorScheme:void 0===o.ColorScheme?null:o.ColorScheme};a.get("ColorPalette")||a.set("ColorPalette",l),a.get("Basics.Actions")||a.set("Basics.Actions",[]);o="General",l=0;u&&0<=u.indexOf("Number")?o="Number":!u||"Date"!==u&&"Datetime"!==u&&"Time"!==u||(o="Datetime"),u&&0<=u.indexOf("Number")&&("Number - 1 decimal"===u?l=1:"Number - 2 decimal"===u?l=2:"Number - 3 decimal"===u?l=3:"Number - 4 decimal"===u?l=4:"Number - 5 decimal"===u?l=5:"Number - 6 decimal"===u&&(l=6));c={BorderColor:"#f0f0f0",BorderWidth:2,DateFormat:"YYYY-MM-DD",Format:o,HideTrailingZeros:!1,MaxValue:g,MinValue:m,Precision:l,Prefix:"",Scale:f,Show:!0,ShowLegend:p,Suffix:"",customLabel:d,gapWidth:2,labelColor:c,upperFontSize:"12",upperLabel:!1,upperLabelColour:"#000",upperLabelHeight:"15"};a.get("NodeLabel")||a.set("NodeLabel",c);a.get("Animation")||a.set("Animation",{Duration:1500,Easing:"quinticInOut"});y={ShowTooltip:y,TooltipTemplate:'<table><thead><tr style="padding-right: 10px;"><th>{{_name}}</th><th></th></tr></thead><tr><td><svg style="padding: 0 5px; vertical-align: middle;" width="12" height="12"><rect width="12" height="12"style="fill: {{_color}} ;stroke-width:3;stroke: {{_color}}"></rect></svg>{{_label}}:</td><td style="padding-right: 10px; text-align: left;"><span style="padding-left:10px">{{_value}}</span></td></tr></table>'};a.get("Tooltip")||a.set("Tooltip",y),_.each(e,function(o,r){o.Size=void 0===o.Size?o.Column:o.Size,o.Column=void 0===o.Display?void 0===o.Column?o.Name:o.Column:o.Display,o.Name=void 0===o.Display?o.Name:o.Display,_.each(o.HighlightRules,function(e,t){a.unset("Data."+r+".HighlightRules."+t+".RuleName"),a.unset("Data."+r+".HighlightRules."+t+".RuleBorderColor"),a.unset("Data."+r+".HighlightRules."+t+".Show"),o.HighlightRules[t].ConditionSource=e.RuleSource,o.HighlightRules[t].ConditionOperator=e.RuleOperation,o.HighlightRules[t].ConditionValue=e.RuleValue,o.HighlightRules[t].BackgroundColor=e.RuleColor,a.unset("Data."+r+".HighlightRules."+t+".RuleSource"),a.unset("Data."+r+".HighlightRules."+t+".RuleOperation"),a.unset("Data."+r+".HighlightRules."+t+".RuleValue"),a.unset("Data."+r+".HighlightRules."+t+".RuleColor")}),a.unset("Data."+r+".KeyByDisplay"),a.unset("Data."+r+".ColumnColor"),a.unset("Data."+r+".Color"),a.unset("Data."+r+".Display")}),a.set("Data",e),a.unset("Basics.Source"),a.unset("Basics.Calc"),a.unset("Basics.NodeFillColour"),a.unset("Basics.Node"),a.unset("Basics.NodeLabel"),a.unset("Basics.AdjustForNeg"),a.unset("Basics.ColorScale"),a.unset("Basics.RelativeScale"),a.unset("Basics.ShowScaleLegend"),a.unset("Basics.SizeScale"),a.unset("Basics.SelectedObjectRouting"),a.unset("Group"),a.unset("SelectedNode"),a.unset("heatmap_possibleColumns"),a.unset("heatmap_possibleLabels"),a.unset("Style.ColorText"),a.unset("Style.colorScale"),a.unset("Style.handlebarhelper"),a.unset("Style.advancedTooltip"),a.unset("Style.FontSize"),a.unset("Style.StyleArea"),a.unset("Style.ColorTextOverride"),a.unset("Style.ColorScheme"),a.unset("Style.hideTooltips"),a.unset("Style.min"),a.unset("Style.max"),a.unset("Style.percentage"),a.unset("Style.colorScaleLabelFormat"),a.unset("Style.advancedLabel"),a.unset("Style.DashboardTheme")},version:"4.4.0"},{fn:function(e){e=e.get("Data");_.each(e,function(e){_.each(e.HighlightRules,function(e){e.Opacity=void 0===e.Opacity?100:e.Opacity,e.Inverse=void 0!==e.Inverse&&e.Inverse})})},version:"4.4.0p2"},{fn:function(e){e=e.get("Data");_.each(e,function(e){e.Color=void 0===e.Color?e.Size:e.Color})},version:"4.4.1"},{fn:function(e){var t=e.get("NodeLabel");t.ShowAbsolute=void 0!==t.ShowAbsolute&&t.ShowAbsolute,e.set("NodeLabel",t)},version:"4.5.0"}];var V=(R.app=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,o,r,a){var i;return'<div class="treemap-container">\r\n    <div class="treemap" id='+e.escapeExpression("function"==typeof(i=null!=(i=o.id||(null!=t?t.id:t))?i:o.helperMissing)?i.call(null!=t?t:e.nullContext||{},{name:"id",hash:{},data:a}):i)+' >\r\n    </div>\r\n    <div class="legend"></div>\r\n\r\n</div>'},useData:!0}),R.fileExporter=i.template({compiler:[7,">= 4.0.0"],main:function(e,t,o,r,a){var i=null!=t?t:e.nullContext||{},n=o.helperMissing,e=e.escapeExpression;return'<div class="tools-panel">\r\n    <div class="pnlButtons">\r\n        <span class="lnksExport link-disabled">\r\n            <i class="fa fa-fw fa-download" title="'+e((o.t||t&&t.t||n).call(i,"Data",{name:"t",hash:{},data:a}))+'"></i>\r\n            <a class="lnkExcelExport" title="'+e((o.t||t&&t.t||n).call(i,"Download the current dataset in Excel format",{name:"t",hash:{},data:a}))+'">'+e((o.t||t&&t.t||n).call(i,"Excel",{name:"t",hash:{},data:a}))+'</a>\r\n            <a class="lnkCsvExport" title="'+e((o.t||t&&t.t||n).call(i,"Download the current dataset in CSV format",{name:"t",hash:{},data:a}))+'">'+e((o.t||t&&t.t||n).call(i,"CSV",{name:"t",hash:{},data:a}))+'</a>\r\n            <a class="lnkDownloadScreenshot" title="'+e((o.t||t&&t.t||n).call(i,"Download a PNG image of the chart",{name:"t",hash:{},data:a}))+'">'+e((o.t||t&&t.t||n).call(i,"PNG",{name:"t",hash:{},data:a}))+"</a>\r\n        </span>\r\n    </div>\r\n</div>"},useData:!0}),R.legend=i.template({1:function(e,t,o,r,a){var i=null!=t?t:e.nullContext||{},n=o.helperMissing,s="function",l=e.escapeExpression;return'<li class="colorscaleItem" style="background-color:'+l(typeof(e=null!=(e=o.color||(null!=t?t.color:t))?e:n)==s?e.call(i,{name:"color",hash:{},data:a}):e)+";width:"+l(typeof(e=null!=(e=o.width||(null!=t?t.width:t))?e:n)==s?e.call(i,{name:"width",hash:{},data:a}):e)+'%"></li>\r\n'},3:function(e,t,o,r,a){var i=null!=t?t:e.nullContext||{},n=o.helperMissing,s="function",l=e.escapeExpression;return'    <li class="colorscaleItemIndex" style="width:'+l(typeof(e=null!=(e=o.width||(null!=t?t.width:t))?e:n)==s?e.call(i,{name:"width",hash:{},data:a}):e)+'%">'+l(typeof(e=null!=(e=o.percentage||(null!=t?t.percentage:t))?e:n)==s?e.call(i,{name:"percentage",hash:{},data:a}):e)+"%</li>\r\n"},compiler:[7,">= 4.0.0"],main:function(e,t,o,r,a){var i,n=null!=t?t:e.nullContext||{};return'<ul class="colorscale">\r\n'+(null!=(i=o.each.call(n,t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?i:"")+'</ul>\r\n<i class="indicatorIcon fa fa-map-marker"></i>\r\n<ul class="colorscaleIndex">\r\n'+(null!=(i=o.each.call(n,t,{name:"each",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a}))?i:"")+"</ul>"},useData:!0}),R.legendMenu=i.template({1:function(e,t,o,r,a){var i=null!=t?t:e.nullContext||{},n=o.helperMissing,s="function",l=e.escapeExpression;return'    <li class="legendMenuListItem">\n        <i class="fa fa-square" style="color:'+l(typeof(e=null!=(e=o.color||(null!=t?t.color:t))?e:n)==s?e.call(i,{name:"color",hash:{},data:a}):e)+'"></i> '+l(typeof(e=null!=(e=o.text||(null!=t?t.text:t))?e:n)==s?e.call(i,{name:"text",hash:{},data:a}):e)+"\n    </li>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,o,r,a){return'<ul class="legendMenulList">\n'+(null!=(a=o.each.call(null!=t?t:e.nullContext||{},t,{name:"each",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a}))?a:"")+"</ul>"},useData:!0}),R);function R(){}var j=(z.getConfig=function(e){var t=this,o={},r={".csv":"Csv",".xlsx":"Excel"}[e.fileFormat],a=e.columnsConfig,i=a.dataSource;return o.fileName=c.ExportTools.getExportFileName(e.fileName,"",r),o.metaData=[],o.fileFormat=e.fileFormat,o.workSheetTitle=e.workSheetTitle,i&&(o.dataSet=i.getData().toJSON(),_.each(a.columns,function(e){e=e.Column,e=c.ExportTools.regExValidateColumnIDs(e,i.getColumnNames());0<e.length&&e.forEach(function(e){o.metaData.push(t.getExportMetaData({colFormats:a.formats,colId:e,kdbType:i.getColumnType(e)},"layers"))})})),o},z.getExportMetaData=function(e,t){var o={},r=e.kdbType,a=(this.getValidPrecission(Number(e.colFormats.Precision)),e.colFormats.Prefix),i=e.colFormats.Suffix,n=e.colFormats.Format,s=e.colFormats.DateFormat,l=e.colFormats.HideTrailingZeroes,r=this.resolveColumnTypeAndFormat(n,s,e.colFormats.Precision,r);return o.colId=e.colId,o.colName=e.colId,o.dataType=r.dataType,o.dataKdbType=r.dataKdbType,o.dataFormat=r.dataFormat,o.hideTrailingZeroes=l,o.prefix=a,o.suffix=i,o},z.resolveColumnTypeAndFormat=function(e,t,o,r){var a=11<r&&r<20,i=o?"."+Array(o+1).join("0"):"";switch((3===r||r<1||19<r)&&(r=11,t="TO_STRING",e="String"),e){case"Number":t="#0"+i;break;case"Smart Number":e="Number",t="SmartNumber"+i;break;case"Datetime":e=c.ExportTools.getTemporalTypeFromFormat(t),t=c.ExportTools.CHARTS_DATE_FORMAT_MAP[t],t=a?t||"":(e="String","");break;case"General":default:e="String",t=""}return{dataFormat:t,dataKdbType:r,dataType:e=1===r?"Boolean":e}},z.getValidPrecission=function(e){e=void 0!==e?e:0;return e<0?e=0:10<e&&(e=10),e},z);function z(){}var G,Y=(G=n.View,l(K,G),K.prototype.initializeEvents=function(){this.listenTo(this.model,"change",this.displayChoiceLinkButtons),this.$lnkCsvExport.click(_.bind(this.fileExport,this,".csv")),this.$lnkExcelExport.click(_.bind(this.fileExport,this,".xlsx")),this.$lnkDownloadScreenshot.click(_.bind(this.downloadImage,this,".png"))},K.prototype.displayChoiceLinkButtons=function(e){var t=this.model.get("FileExport");!t||_.keys(t).length<5||(t.ShowExportCsvButton||t.ShowExportExcelButton||t.ShowScreenshot?(this.$lnksExport.removeClass("link-disabled"),this.$lnkCsvExport.toggleClass("link-disabled",!t.ShowExportCsvButton),this.$lnkExcelExport.toggleClass("link-disabled",!t.ShowExportExcelButton),this.$lnkDownloadScreenshot.toggleClass("link-disabled",!t.ShowScreenshot),this.$chartContainer.toggleClass("links-enabled",!this.$chartContainer.hasClass("links-enabled")),t.Enabled||this.model.set("FileExport.Enabled",!0)):(this.$lnksExport.addClass("link-disabled"),this.$chartContainer.removeClass("links-enabled"),t.Enabled&&this.model.set("FileExport.Enabled",!1)))},K.prototype.downloadImage=function(e){var t=("string"==typeof(t=c.ExportTools.getExportFileName(this.getExportConfig().fileName,"","Screenshot"))?t:"Screenshot")+e;this.generateImage(t)},K.prototype.fileExport=function(e){var t=c.ExportTools,e=j.getConfig(_.extend(this.getExportConfig(),{fileFormat:e}));t.openFileExportDialog(e)},K.prototype.generateImage=function(e){var t,o=this.getChart();o&&(t=o.getDataURL({type:"png",pixelRatio:2}).replace(/^data:image\/[^;]+/,"data:application/octet-stream"),(o=document.createElement("a")).download=e,o.href=t,o.click())},K.prototype.getTheme=function(){return this.appView.dashboardViewModel.get("DashboardTheme")},K.prototype.renderLinks=function(){this.$lnksExport=this.$el.find(".lnksExport"),this.$lnkCsvExport=this.$el.find("a.lnkCsvExport"),this.$lnkExcelExport=this.$el.find("a.lnkExcelExport"),this.$lnkDownloadScreenshot=this.$el.find("a.lnkDownloadScreenshot")},K.prototype.remove=function(){return this.$lnkCsvExport.off(),this.$lnkExcelExport.off(),this.$lnkDownloadScreenshot.off(),this.stopListening(),n.View.prototype.remove.apply(this)},K);function K(e){var t=G.call(this,e)||this;return t.api=e.api,t.getChart=e.getChart,t.appView=e.appView,t.getExportConfig=e.getExportConfig,t.isIE=!1,HTMLCanvasElement&&HTMLCanvasElement.prototype&&HTMLCanvasElement.prototype.msToBlob&&(t.isIE=!0),t.$chartContainer=t.appView.$el.find(".chart-container"),t.render(),t.renderLinks(),t.initializeEvents(),t}var W,q=c.Tools;function U(e){var r=W.call(this,e)||this;r.focus=[],r.layers=new m,r.dataSources={},r.treemapData=[],r.treemapID="",r.errors={},_.extend(r,_.pick(e,["api","dashboardViewModel"])),U.componentApi=e.api;var a=r.api.setProperty;r.api.setProperty=function(e,t,o){o&&o.bypass||(t=I.replaceViewStatesWithModel(e,t,r.api)),a.call(r.api,e,t,o)};var o=r.onSettingsChange;return r.onSettingsChange=function(e){var t=this.onSettingsChange!==(this.onSettingsChange=o);this.onSettingsChange(e),t&&(this.isReadyForThemeChange=!0,this.setThemeAccordingToDashboardSettings())}.bind(r),r.treemapID="treemap-"+r.cid,r.$el.html(V.app({id:r.treemapID})),r.$el.addClass("treemap-app"),r.$treemap=r.$el.find(".treemap"),r.listenTo(r.layers,"add",function(e){this.setThemeAccordingToDashboardSettings()}),r.listenTo(r.layers,"reset",function(e){this.setThemeAccordingToDashboardSettings()}),r.listenTo(r.layers,"remove",function(e){e.stopListening()}),r.listenTo(r.layers,"update",function(e,t){this.updatePossibleLayers();t=0<t.changes.added.length+t.changes.removed.length;I.safeHandle(!t&&this.animation&&this.animation.get("Enabled")?this.updateChart:this.initializeChart).call(this)}),r.nodeLabel=new C,r.colorPalette=new x,r.groupBy=new k,r.tooltip=new T,r.animation=new N,r.fileExportModel=new n.DeepModel,r.fileExporterView=new Y({api:r.api,appView:r,el:V.fileExporter({id:r.id}),getChart:function(){return r.chart},getExportConfig:function(){var e=r.layers.at(0);return{altFileName:"",columnsConfig:{columns:e.get("Data"),dataSource:r.dataSources[e.get("Basics.Data").cid],formats:e.get("NodeLabel")},fileName:r.fileExportModel.get("FileExport.FileName"),workSheetTitle:"Treemap"}},model:r.fileExportModel}),r.$el.prepend(r.fileExporterView.$el),r.listenTo(r.fileExportModel,"change:FileExport.Enabled",I.safeHandle(r.toggleToolsPanel)),r}return W=n.View,l(U,W),U.prototype.onSettingsChange=function(e){e=I.expandNestedViewStates(e,this.api),e=I.replaceViewStatesWithValue("",e,this.api),e=I.pump(e);this.onSettingsChangeProcessed.call(this,e)},U.prototype.updateDataSource=function(o){var r=this;if(this.dataSources[o.getKey()]){var a=!1,e=this.layers.filter(function(e){e=e.get("Basics.Data");return e&&e.cid===o.getKey()}),i=c.HeuristicHelpers.getScalarColumns(o),n=c.HeuristicHelpers.getStringColumns(o),s=c.HeuristicHelpers.getListColumns(o),l=0===i.length?s:i,p=this.errors[o.getKey()],u=0===n.length?0===s.length?i:s:n;if(0===l.length&&(!p||"Loading"===_.get(p,"type")))return void this.api.showQueryStatus({error:t("Data Source provided is not valid for Heatmap"),type:"Warning"});e.forEach(function(e,t){e.set("possibleColumns",o.getColumnNames()),e.set("possibleRules",o.getColumnNames()),e.set("possibleLabels",o.getColumnNames()),r.api.setProperty("possibleColumns",e.get("possibleColumns")),r.api.setProperty("possibleRules",e.get("possibleRules")),r.api.setProperty("possibleLabels",e.get("possibleLabels")),0!==t||e.get("Data.0.Size")||(e.set("Data.0.Size",l[0]),r.api.setProperty("Data.0.Size",l[0]),a=!0),0!==t||e.get("Data.0.Column")||(e.set("Data.0.Column",u[0]),r.api.setProperty("Data.0.Column",u[0]),a=!0)}),a&&this.api.setProperty("Data",[{Color:"",Column:u[0],HighlightRules:[],Name:"",Size:l[0]}])}I.safeHandle(this.initializeChart).call(this)},U.prototype.onResize=function(){this.chart&&this.chart.resize()},U.prototype.updateError=function(e,t){var o=this,e=e.getKey();t?this.errors[e]=t:delete this.errors[e];function r(e){return"Error"===e?3:"Loading"===e?2:"NoResults"===e?1:0}t=_.reduce(this.errors,function(e,t){t=t.type;return r(t)>r(e)?t:e},"");t&&("NoResults"!==t||Object.keys(this.dataSources).length===Object.keys(this.errors).length)?(e=_.map(this.errors,function(e,t){e=e.error,t=o.dataSources[t];return e?"["+t.getPath()+"]: "+e:null}).filter(function(e){return e}),this.api.showQueryStatus({error:e.join("\n"),type:t})):this.api.hideQueryStatus()},U.prototype.hideTooltip=function(){this.genericTooltip&&(this.api.removeTooltip(),delete this.genericTooltip)},U.prototype.onSettingsChangeProcessed=function(e){var t,o,r=this.layers.models[0];_.isObject(e.Basics)&&this.onSettingsBasicsChanged.call(this,e.Basics),_.isObject(e.Basics)&&e.Basics.Data&&this.onSettingsLayersChanged.call(this,e),_.isObject(e.Data)&&void 0!==r&&(r.get("NodeLabel")||r.set("NodeLabel",I.replaceViewStatesWithValue("",this.nodeLabel.attributes,this.api)),r.get("ColorPalette")||r.set("ColorPalette",I.replaceViewStatesWithValue("",this.colorPalette.attributes,this.api)),r.get("Tooltip")||r.set("Tooltip",I.replaceViewStatesWithValue("",this.tooltip.attributes,this.api)),r.get("Animation")||r.set("Animation",I.replaceViewStatesWithValue("",this.animation.attributes,this.api)),r.get("GroupBy")||r.set("GroupBy",I.replaceViewStatesWithValue("",this.groupBy.attributes,this.api)),this.onSettingsOnData(I.replaceViewStatesWithValue("",e,this.api))),_.isObject(e.NodeLabel)&&(this.onSettingsChanged(e,"NodeLabel"),this.nodeLabel.set(this.api.getProperty("NodeLabel"))),_.isObject(e.ColorPalette)&&(0===_.indexOf(Object.keys(e.ColorPalette),"SelectedColorScheme")&&(t=e.ColorPalette.SelectedColorScheme,o=H.getSchemes(),this.api.setProperty("ColorPalette.ColorScheme",o[t],{bypass:!0})),this.onSettingsChanged(e,"ColorPalette"),this.colorPalette.set(this.api.getProperty("ColorPalette"))),_.isObject(e.Tooltip)&&(this.onSettingsChanged(e,"Tooltip"),this.tooltip.set(this.api.getProperty("Tooltip"))),_.isObject(e.Animation)&&(this.onSettingsChanged(e,"Animation"),this.tooltip.set(this.api.getProperty("Animation"))),_.isObject(e.GroupBy)&&(this.onSettingsChanged(e,"GroupBy"),this.groupBy.set(this.api.getProperty("GroupBy"))),_.isObject(e.FileExport)&&this.onSettingsFileExportChanged.call(this,e.FileExport),r&&this.initializeChart()},U.prototype.onSettingsFileExportChanged=function(e){var o=this;this.fileExportModel&&(_.each(e,function(e,t){o.fileExportModel.set("FileExport."+t,e)}),4===_.keys(e).length&&void 0===this.fileExportModel.get("FileExport.Enabled")&&(e.ShowExportCsvButton||e.ShowExportExcelButton||e.ShowScreenshot?this.fileExportModel.set("FileExport.Enabled",!0):this.fileExportModel.set("FileExport.Enabled",!1)))},U.prototype.onSettingsChanged=function(e,o){var r=this.layers.models[0];r&&_.each(e[o],function(e,t){r.set(o+"."+t,e)})},U.prototype.onSettingsLayersChanged=function(e){this.layers.set(e);var t=e.Basics.Data,e=this.dataSources[t.cid];e?e.hasData()&&this.updateDataSource(e):(e=new f(t,this,this.api,this.focus),(this.dataSources[t.cid]=e).subscribe()),this.initializeChart()},U.prototype.onSettingsOnData=function(e){var a=this.layers.models[0];a&&(void 0===a.get("Data")||a.get("Data").length>e.Data.length?a.set("Data",e.Data):_.each(e.Data,function(t,r){_.each(Object.keys(t),function(e){"HighlightRules"===e?_.each(t.HighlightRules,function(t,o){_.each(Object.keys(t),function(e){a.set("Data."+r+".HighlightRules."+o+"."+e,t[e])})}):a.set("Data."+r+"."+e,t[e])})}),this.initializeChart())},U.prototype.onSettingsBasicsChanged=function(e){var t=this;void 0!==e.Focus&&(this.focus=_.first(I.focus2Array(e.Focus))||[],_.each(this.dataSources,function(e){e.setFocus(t.focus)})),void 0!==e.Selected&&0<this.layers.models.length&&(this.layers.models[0].set("Basics.Selected",e.Selected),this.initializeChart())},U.prototype.getSelectedAttr=function(e){var t,o=this.layers.models[0];return"{breakdownId}"===e&&(o=(t=o.get("Basics")).Data,t=t.Focus,e=o.dataSet.breakdownColumns[void 0===(t=t?_.first(I.focus2Array(t)):[])?0:t.length]),e},U.prototype.setActions=function(r,a){var i=this,n=[];this.api.getProperty("Basics.Actions").forEach(function(e,t){var o=i.getSelectedAttr(e.Current),o=r.get(o);e.Trigger===a&&(n.push(p(p({},e),{Current:o,_PropertyIndex:t})),i.api.doActions(n,"Basics.Actions"))})},U.prototype.setMousePosition=function(e){this.$el.find(".indicatorIcon").css({left:"calc("+e+"% - 3px)"})},U.prototype.setMouseData=function(e,t,o){var r=_.get(e,"data.parentId")?_.get(e,"data.parentId"):e.seriesIndex,a=this.layers.models[0],e=a.get("ColorPalette.ColorType"),i=this.api.getProperty("Data."+r+".Color"),r=_.map(t,function(e){return parseFloat(e.get(i))}),t=a.get("NodeLabel"),a=t.MinValue,t=t.MaxValue;"Gradient"!==e&&"Scaled"!==e||(a=_.min(r),t=_.max(r));o=parseFloat(o.get(i));this.setMousePosition((o-a)/(t-a)*100)},U.prototype.setSelected=function(l){var p=this,u=this.layers.models[0];this.chart.off("click",null),this.chart.on("click",function(a){var e,t,o=u.get("Basics.SelectedAttr"),i=u.get("NodeLabel.Scale"),n=u.get("ColorPalette.SelectedColor"),r=l[a.data.id],s=p.chart.getOption();_.each(s.series[0].data,function(e,o){var e=_.clone(e.children),r=u.get("Data."+o+".Name");i&&(e=_.sortBy(e,"value")),_.each(e,function(e,t){e.id===a.data.id&&a.treePathInfo[1].name===r&&""!==n&&((e=s.series[0].data[o].color)[e.length-1-t]=n)})}),p.chart.setOption(s),void 0!==r&&(o=p.getSelectedAttr(o),p.api.setProperty("Basics.Selected",r.get(o),{bypass:!0}),e=u.get("Basics.Data"),(t=p.dataSources[e.cid])&&0!==t.length&&(o=t.breakdownColumns,(e=t.getDepth())<o.length-1&&((t=p.focus)[e]=r.get(o[e]),p.api.setProperty("Basics.Focus",t.join(","),{bypass:!0}))),p.setActions(r,"Click"))}),this.chart.off("mousemove",null),this.chart.on("mousemove",function(e){var t;e&&e.data&&(void 0!==(t=l[e.data.id])&&(p.setMouseData(e,l,t),p.setActions(t,"Hover"),p.showTooltip(e,u,l)))}),this.chart.off("mouseout",null),this.chart.on("mouseout",this.hideTooltip.bind(this)),this.chart.off("dblclick",null),this.chart.on("dblclick",function(e){e=l[e.data.id];void 0!==e&&p.setActions(e,"Double Click")})},U.prototype.initializeChart=function(){var e=this.layers.models[0],t=e.get("Basics.Data"),o=this.dataSources[t.cid];this.chart=r.init(document.getElementById(this.treemapID)),o&&0!==o.length&&(this.treemapData=o.getData().models,t=o.breakdownColumns,o=void 0===(o=(o=this.focus)?_.first(I.focus2Array(o)):[])?0:o.length,void 0!==t&&e.setBreakdown(t[o]),this.treemapData&&0!==this.treemapData.length&&(t=void 0,o=e.get("Data"),this.displayLegend(),t=0!==_.size(o)?(o=e.getTreeData(o,this.treemapData),e.setTreeMapOpts(o)):{series:[{breadcrumb:{show:!1},data:[],height:0,type:"treemap",width:0}]},this.chart.setOption(t),this.setSelected(this.treemapData)))},U.prototype.displayLegend=function(){var e,o,t,r,a,i,n,s,l,p=this,u=this.layers.models[0];u.get("NodeLabel")&&u.get("ColorPalette")&&(e=(a=u.get("NodeLabel")).ShowLegend,o=a.Scale,t=this.$el.find(".legend"),this.$el.find(".treemap"),n=u.get("ColorPalette"),r=n.ColorScheme,a=n.ColorType,i=n.FixedColor,n=this.fileExportModel.get("FileExport.Enabled"),e&&"Iterative Children"===a?t.html(V.legendMenu(_.map(u.get("Data"),function(e,t){return{color:r[t%r.length].type,text:e.Name}}))):e&&0<=a.indexOf("Gradient")?t.html(V.legend(_.map(_.clone(r),function(e,t){return{color:e.type,percentage:t*(100/r.length),width:100/r.length}}))):e&&0<=a.indexOf("Scale")?(s=I.getSaturatedArray(i),t.html(V.legend(_.map([0,10,20,30,40,50,60,70,80,90],function(e,t){return{color:s[t],percentage:e,width:10}})))):e&&"Fixed"===a?t.html(V.legendMenu(_.map(u.get("Data"),function(e){return{color:i,text:e.Name}}))):e&&"Iterative"===a?(l=[],_.each(u.get("Data"),function(t){var e=_.map(p.treemapData,function(e){return e.get(t.Column)});o&&(e=_.map(_.sortBy(p.treemapData,[function(e){return parseFloat(e.get(t.Size))}]),function(e){return e.get(t.Column)})),_.each(e,function(e,t){l.push({color:r[t%r.length].type,text:e})})}),t.html(V.legendMenu(l))):t.html(""),e?this.adjustChart(40,35,30,n):this.adjustChart(0,0,30,n))},U.prototype.adjustChart=function(e,t,o,r){var a=this.$el.find(".legend"),i=this.$el.find(".treemap"),n=(r?o:0)+e;a.css({height:e+"px"}),i.css({height:"calc(100% - "+n+"px)"}),r?(i.css({top:o+"px"}),a.css({marginTop:t+"px"})):(i.css({top:0}),a.css({marginTop:0})),this.chart.resize()},U.prototype.doActions=function(e){var t,o=this.chart.getElementAtEvent(e);o.length&&(o=(e=o[0])._datasetIndex,e=e._index,((o=this.layers.models.length-1-o)<0||o>this.layers.models.length-1)&&(o=this.layers.models.length-1),o=this.layers.models[o].get("Basics.Data"),t=this.dataSources[o.cid].getData().at(e),e=this.api.getProperty("Basics.Actions").map(function(e){return p(p({},e),{Current:t.get(e.Current)})}),this.api.doActions(e,"Basics.Actions"))},U.prototype.setThemeAccordingToDashboardSettings=function(){this.isReadyForThemeChange&&this.setTheme(this.dashboardViewModel.get("DashboardTheme"))},U.prototype.setTheme=function(e){var t;if("Light"===e)t="Dark";else{if("Dark"!==e)return;t="Light"}q.hasDefaultThemeColors(t,this.api.getProperty("NodeLabel.BorderColor"))&&this.api.setProperty("NodeLabel.BorderColor",q.getDefaultThemeColors(e)[0],{bypass:!0}),e=e.toLowerCase(),this.$el.removeClass("dark light"),this.$el.addClass(e)},U.prototype.showTooltip=function(e,t,o){var r=t.get("Tooltip"),a=r.TooltipTemplate;r.ShowTooltip&&void 0!==e&&void 0!==e.data&&void 0!==e.data.id&&(r=e.data.id,o=_.extend({},o[r]).attributes,r=e.treePathInfo&&e.treePathInfo[1]?e.treePathInfo[1].name:"",o._name=e.data.name,o._value=void 0===e.data.displayVal?e.data.value:e.data.displayVal,o._treePathInfo=e.treePathInfo,o._label="{breakdownId}"===r?t.breakdownCol:r,o._color=e.color,o.breakdownId=t.breakdownCol?o[t.breakdownCol]:"",this.genericTooltip=this.api.setTooltip({data:o,text:a,anchorEl:this.el,position:{left:e.event.offsetX+20,top:e.event.offsetY+20}}))},U.prototype.toggleToolsPanel=function(){this.fileExportModel.has("FileExport")&&0<this.layers.length&&(this.fileExportModel.get("FileExport.Enabled")?this.$el.find(".tools-panel").removeClass("disabled"):this.$el.find(".tools-panel").toggleClass("disabled",!this.$el.find(".tools-panel").hasClass("disabled")),this.initializeChart())},U.prototype.updatePossibleLayers=function(){this.layers.filter(function(e){return"Line"===e.get("_Hidden._Type")}).forEach(function(r){var e=r.collection.reduceRight(function(e,t,o){return[r===t?"nofill":"Layer "+(o+1)].concat(e)},["origin"]);r.set("_Hidden._PossibleLayers",e)})},U.getComponentDefinition=H.getComponentDefinition,U});